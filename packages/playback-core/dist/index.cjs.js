"use strict";var se=Object.create;var k=Object.defineProperty;var ie=Object.getOwnPropertyDescriptor;var ce=Object.getOwnPropertyNames;var de=Object.getPrototypeOf,ue=Object.prototype.hasOwnProperty;var le=(e,t)=>{for(var r in t)k(e,r,{get:t[r],enumerable:!0})},N=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of ce(t))!ue.call(e,o)&&o!==r&&k(e,o,{get:()=>t[o],enumerable:!(n=ie(t,o))||n.enumerable});return e};var _=(e,t,r)=>(r=e!=null?se(de(e)):{},N(t||!e||!e.__esModule?k(r,"default",{value:e,enumerable:!0}):r,e)),pe=e=>N(k({},"__esModule",{value:!0}),e);var Re={};le(Re,{AutoplayTypes:()=>v,CmcdTypeValues:()=>ye,CmcdTypes:()=>L,ExtensionMimeTypeMap:()=>y,Hls:()=>T.default,MediaError:()=>u,MimeTypeShorthandMap:()=>b,PlaybackTypes:()=>R,StreamTypes:()=>E,addTextTrack:()=>C,allMediaTypes:()=>Te,generatePlayerInitTime:()=>ve,generateUUID:()=>J,getError:()=>_e,getStreamTypeConfig:()=>te,initialize:()=>Ae,isKeyOf:()=>A,isMuxVideoSrc:()=>w,loadMedia:()=>ne,mux:()=>P.default,removeTextTrack:()=>Y,setupHls:()=>ee,setupMux:()=>re,shorthandKeys:()=>fe,teardown:()=>Z,toMuxVideoURL:()=>Le});module.exports=pe(Re);var P=_(require("mux-embed")),T=_(require("hls.js"));var M=class extends Error{constructor(r,n=M.MEDIA_ERR_CUSTOM,o){var a;super(r);this.name="MediaError",this.code=n,this.fatal=o!=null?o:n>=M.MEDIA_ERR_NETWORK&&n<=M.MEDIA_ERR_ENCRYPTED,this.message||(this.message=(a=M.defaultMessages[this.code])!=null?a:"")}},u=M;u.MEDIA_ERR_ABORTED=1,u.MEDIA_ERR_NETWORK=2,u.MEDIA_ERR_DECODE=3,u.MEDIA_ERR_SRC_NOT_SUPPORTED=4,u.MEDIA_ERR_ENCRYPTED=5,u.MEDIA_ERR_CUSTOM=100,u.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail.",3:"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.",4:"An unsupported error occurred. The server or network failed, or your browser does not support this format.",5:"The media is encrypted and there are no keys to decrypt it."};var S=_(require("hls.js"));var A=(e,t)=>e in t,v={ANY:"any",MUTED:"muted"},E={VOD:"on-demand",ON_DEMAND:"on-demand",LIVE:"live",LL_LIVE:"ll-live",DVR:"live:dvr",LL_DVR:"ll-live:dvr"},R={MSE:"mse",NATIVE:"native"},L={HEADER:"header",QUERY:"query",NONE:"none"},ye=Object.values(L),y={M3U8:"application/vnd.apple.mpegurl",MP4:"video/mp4"},b={HLS:y.M3U8},fe=Object.keys(b),Te=[...Object.values(y),"hls","HLS"];var m=(e,t,r,n)=>{e.addEventListener(t,r,n),e.addEventListener("teardown",()=>{e.removeEventListener(t,r)},{once:!0})};function V(e,t,r){t&&r>t&&(r=t);for(let n=0;n<e.length;n++)if(e.start(n)<=r&&e.end(n)>=r)return!0;return!1}var U=e=>{let t=e.indexOf("?");if(t<0)return[e];let r=e.slice(0,t),n=e.slice(t);return[r,n]},h=e=>{let t=e.type;if(t){let n=t.toUpperCase();return A(n,b)?b[n]:t}let{src:r}=e;return r?me(r):""},me=e=>{let t="";try{t=new URL(e).pathname}catch{console.error("invalid url")}let r=t.lastIndexOf(".");if(r<0)return"";let o=t.slice(r+1).toUpperCase();return A(o,y)?y[o]:""};var Me=Object.values(v),K=e=>typeof e=="boolean"||typeof e=="string"&&Me.includes(e),B=({autoplay:e},t,r)=>{let n=!1,o=!1,a=K(e)?e:!!e,i=()=>{n||m(t,"playing",()=>{n=!0},{once:!0})};if(i(),m(t,"loadstart",()=>{n=!1,i(),I(t,a)},{once:!0}),m(t,"loadstart",()=>{r||(o=!Number.isFinite(t.duration)),I(t,a)},{once:!0}),r&&r.once(S.default.Events.LEVEL_LOADED,(c,d)=>{var l;o=(l=d.details.live)!=null?l:!1}),!a){let c=()=>{!o||(r!=null&&r.liveSyncPosition?t.currentTime=r.liveSyncPosition:Number.isFinite(t.seekable.end(0))&&(t.currentTime=t.seekable.end(0)))};r&&m(t,"play",()=>{t.preload==="metadata"?r.once(S.default.Events.LEVEL_UPDATED,c):c()},{once:!0})}return c=>{n||(a=K(c)?c:!!c,I(t,a))}},I=(e,t)=>{if(!t)return;let r=e.muted,n=()=>e.muted=r;switch(t){case v.ANY:e.play().catch(()=>{e.muted=!0,e.play().catch(n)});break;case v.MUTED:e.muted=!0,e.play().catch(n);break;default:e.play().catch(()=>{});break}};var F=({preload:e,src:t},r,n)=>{let o=p=>{p!=null&&["","none","metadata","auto"].includes(p)?r.setAttribute("preload",p):r.removeAttribute("preload")};if(!n)return o(e),o;let a=!1,i=!1,s=n.config.maxBufferLength,c=n.config.maxBufferSize,d=p=>{o(p);let f=p!=null?p:r.preload;i||f==="none"||(f==="metadata"?(n.config.maxBufferLength=1,n.config.maxBufferSize=1):(n.config.maxBufferLength=s,n.config.maxBufferSize=c),l())},l=()=>{!a&&t&&(a=!0,n.loadSource(t))};return m(r,"play",()=>{i=!0,n.config.maxBufferLength=s,n.config.maxBufferSize=c,l()},{once:!0}),d(e),d};var x=_(require("hls.js"));function q(e,t){t.on(x.default.Events.NON_NATIVE_TEXT_TRACKS_FOUND,(o,{tracks:a})=>{a.forEach(i=>{var d;let s=(d=i.subtitleTrack)!=null?d:i.closedCaptions,c=t.subtitleTracks.findIndex(({lang:l,name:p,type:f})=>l==(s==null?void 0:s.lang)&&p===i.label&&f.toLowerCase()===i.kind);C(e,i.kind,i.label,s==null?void 0:s.lang,`${i.kind}${c}`)})});let r=()=>{var i;if(!t.subtitleTracks.length)return;let o=Array.from(e.textTracks).find(s=>s.id&&s.mode==="showing"&&["subtitles","captions"].includes(s.kind)),a=`${(i=t.subtitleTracks[t.subtitleTrack])==null?void 0:i.type.toLowerCase()}${t.subtitleTrack}`;if(o&&(t.subtitleTrack<0||(o==null?void 0:o.id)!==a)){let s=t.subtitleTracks.findIndex(({lang:c,name:d,type:l})=>c==o.language&&d===o.label&&l.toLowerCase()===o.kind);t.subtitleTrack=s}o&&(o==null?void 0:o.id)===a&&o.cues&&Array.from(o.cues).forEach(s=>{o.addCue(s)})};e.textTracks.addEventListener("change",r),t.on(x.default.Events.CUES_PARSED,(o,{track:a,cues:i})=>{let s=e.textTracks.getTrackById(a);if(!s)return;let c=s.mode==="disabled";c&&(s.mode="hidden"),i.forEach(d=>{var l;(l=s.cues)!=null&&l.getCueById(d.id)||s.addCue(d)}),c&&(s.mode="disabled")}),t.once(x.default.Events.DESTROYING,()=>{e.textTracks.removeEventListener("change",r),e.querySelectorAll("track[data-removeondestroy]").forEach(a=>{a.remove()})});let n=()=>{Array.from(e.textTracks).forEach(o=>{var a,i;if(!["subtitles","caption"].includes(o.kind)&&o.label==="thumbnails"){if(!((a=o.cues)!=null&&a.length)){let s=e.querySelector('track[label="thumbnails"]'),c=(i=s==null?void 0:s.getAttribute("src"))!=null?i:"";s==null||s.removeAttribute("src"),setTimeout(()=>{s==null||s.setAttribute("src",c)},0)}o.mode!=="hidden"&&(o.mode="hidden")}})};t.once(x.default.Events.MANIFEST_LOADED,n),t.once(x.default.Events.MEDIA_ATTACHED,n)}function C(e,t,r,n,o){let a=document.createElement("track");return a.kind=t,a.label=r,n&&(a.srclang=n),o&&(a.id=o),a.track.mode="disabled",a.setAttribute("data-removeondestroy",""),e.append(a),a.track}function Y(e,t){let r=Array.prototype.find.call(e.querySelectorAll("track"),n=>n.track===t);r==null||r.remove()}var W,z,Ee=(z=(W=globalThis==null?void 0:globalThis.navigator)==null?void 0:W.userAgent)!=null?z:"",xe=Ee.toLowerCase().indexOf("android")!==-1,g=new WeakMap,X="mux.com",$,Q,G=(Q=($=T.default).isSupported)==null?void 0:Q.call($),ge=xe,ve=()=>P.default.utils.now(),J=P.default.utils.generateUUID,Le=(e,{domain:t=X}={})=>{if(!e)return;let[r,n=""]=U(e);return`https://stream.${t}/${r}.m3u8${n}`},be=e=>{if(!e)return;let[t]=e.split("?");return t||void 0},Pe=e=>{if(!e||!e.startsWith("https://stream."))return;let[t]=new URL(e).pathname.slice(1).split(".m3u8");return t||void 0},ke=e=>{var t,r,n;return(t=e==null?void 0:e.metadata)!=null&&t.video_id?e.metadata.video_id:w(e)&&(n=(r=be(e.playbackId))!=null?r:Pe(e.src))!=null?n:e.src},_e=e=>{var t;return(t=g.get(e))==null?void 0:t.error},Ae=(e,t,r)=>{Z(t,r);let{metadata:n={}}=e,{view_session_id:o=J()}=n,a=ke(e);n.view_session_id=o,n.video_id=a,e.metadata=n,g.set(t,{});let i=ee(e,t);re(e,t,i),ne(e,t,i);let s=B(e,t,i),c=F(e,t,i);return{engine:i,setAutoplay:s,setPreload:c}},Z=(e,t)=>{let r=t==null?void 0:t.engine;r&&(r.detachMedia(),r.destroy()),(e==null?void 0:e.mux)&&!e.mux.deleted&&(e.mux.destroy(),delete e.mux),e&&(e.removeAttribute("src"),e.load(),e.removeEventListener("error",ae),e.removeEventListener("error",H),e.removeEventListener("durationchange",oe),g.delete(e),e.dispatchEvent(new Event("teardown")))};function j(e,t){var d;let r=h(e);if(!(r===y.M3U8))return!0;let o=!r||((d=t.canPlayType(r))!=null?d:!0),{preferPlayback:a}=e,i=a===R.MSE,s=a===R.NATIVE;return o&&(s||!(G&&(i||ge)))}var ee=(e,t)=>{let{debug:r,streamType:n,startTime:o=-1,metadata:a,preferCmcd:i}=e,c=h(e)===y.M3U8,d=j(e,t);if(c&&!d&&G){let l={backBufferLength:30,renderTextTracksNatively:!1,liveDurationInfinity:!0},p=te(n),f=i!==L.NONE?{useHeaders:i===L.HEADER,sessionId:a.view_session_id,contentId:a.video_id}:void 0;return new T.default({debug:r,startPosition:o,cmcd:f,...l,...p})}},te=e=>[E.LIVE,E.DVR].includes(e)?{backBufferLength:8}:[E.LL_LIVE,E.LL_DVR].includes(e)?{backBufferLength:4,maxFragLookUpTolerance:.001}:{},w=({playbackId:e,src:t,customDomain:r})=>{if(e)return!0;if(typeof t!="string")return!1;let n=window==null?void 0:window.location.href,o=new URL(t,n).hostname.toLocaleLowerCase();return o.includes(X)||!!r&&o.includes(r.toLocaleLowerCase())},re=(e,t,r)=>{var a;let{envKey:n}=e,o=w(e);if(n||o){let{playerInitTime:i,playerSoftwareName:s,playerSoftwareVersion:c,beaconCollectionDomain:d,debug:l,disableCookies:p}=e,f={...e.metadata,video_title:((a=e==null?void 0:e.metadata)==null?void 0:a.video_title)||void 0},O=D=>typeof D.player_error_code=="string"?!1:typeof e.errorTranslator=="function"?e.errorTranslator(D):D;P.default.monitor(t,{debug:l,beaconCollectionDomain:d,hlsjs:r,Hls:r?T.default:void 0,automaticErrorTracking:!1,errorTranslator:O,disableCookies:p,data:{...n?{env_key:n}:{},player_software_name:s,player_software:s,player_software_version:c,player_init_time:i,...f}})}},ne=(e,t,r)=>{var a;let n=j(e,t),{src:o}=e;t&&n?(typeof o=="string"?(t.setAttribute("src",o),e.startTime&&(((a=g.get(t))!=null?a:{}).startTime=e.startTime,t.addEventListener("durationchange",oe,{once:!0}))):t.removeAttribute("src"),t.addEventListener("error",ae),t.addEventListener("error",H)):r&&o?(r.on(T.default.Events.ERROR,(i,s)=>{let c={[T.default.ErrorTypes.NETWORK_ERROR]:u.MEDIA_ERR_NETWORK,[T.default.ErrorTypes.MEDIA_ERROR]:u.MEDIA_ERR_DECODE},d=new u("",c[s.type]);d.fatal=s.fatal,d.data=s,t.dispatchEvent(new CustomEvent("error",{detail:d}))}),t.addEventListener("error",H),q(t,r),r.attachMedia(t)):console.error("It looks like the video you're trying to play will not work on this system! If possible, try upgrading to the newest versions of your browser or software.")};function oe(e){var n;let t=e.target,r=(n=g.get(t))==null?void 0:n.startTime;if(!!r&&V(t.seekable,t.duration,r)){let o=t.preload==="auto";o&&(t.preload="none"),t.currentTime=r,o&&(t.preload="auto")}}async function ae(e){if(!e.isTrusted)return;e.stopImmediatePropagation();let t=e.target;if(!(t!=null&&t.error))return;let{message:r,code:n}=t.error,o=new u(r,n);if(t.src&&(n!==u.MEDIA_ERR_DECODE||n!==void 0))try{let{status:a}=await fetch(t.src);o.data={response:{code:a}}}catch{}t.dispatchEvent(new CustomEvent("error",{detail:o}))}function H(e){var n,o;if(!(e instanceof CustomEvent)||!(e.detail instanceof u))return;let t=e.target,r=e.detail;!r||!r.fatal||(((n=g.get(t))!=null?n:{}).error=r,(o=t.mux)==null||o.emit("error",{player_error_code:r.code,player_error_message:r.message}))}
//# sourceMappingURL=index.cjs.js.map
