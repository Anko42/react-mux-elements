var Ld=Object.create;var vo=Object.defineProperty;var Dd=Object.getOwnPropertyDescriptor;var Id=Object.getOwnPropertyNames;var Rd=Object.getPrototypeOf,Md=Object.prototype.hasOwnProperty;var mo=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var Cd=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Id(t))!Md.call(r,a)&&a!==e&&vo(r,a,{get:()=>t[a],enumerable:!(n=Dd(t,a))||n.enumerable});return r};var an=(r,t,e)=>(e=r!=null?Ld(Rd(r)):{},Cd(t||!r||!r.__esModule?vo(e,"default",{value:r,enumerable:!0}):e,r));var Ma=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var _e=(r,t,e)=>(Ma(r,t,"read from private field"),e?e.call(r):t.get(r)),Fe=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},pt=(r,t,e,n)=>(Ma(r,t,"write to private field"),n?n.call(r,e):t.set(r,e),e);var He=(r,t,e)=>(Ma(r,t,"access private method"),e);var Dl=mo((wn,Ls)=>{(function(){var r,t;r=this,t=function(){return function(){var e={80:function(u,M,C){u.exports=C(728).default},728:function(u,M,C){"use strict";C.d(M,{default:function(){return xd}});var O=C(48),L=C.n(O),A=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(U){var k=16*Math.random()|0;return(U==="x"?k:3&k|8).toString(16)})},x=function(){return("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6)},I=function(U){return U&&U.nodeName!==void 0?(U.muxId||(U.muxId=U.id||x()),U.muxId):U},_=function(U){var k;U&&U.nodeName!==void 0?U=I(k=U):k=document.querySelector(U);var w=k&&k.nodeName?k.nodeName.toLowerCase():"";return[k,U,w]},b=C(640),S=C.n(b),v=S().methodFactory;S().methodFactory=function(U,k,w){var K=v(U,k,w);return function(){for(var W=["[mux]"],z=0;z<arguments.length;z++)W.push(arguments[z]);K.apply(void 0,W)}},S().setLevel(S().getLevel());var i=S();function d(){return(L().doNotTrack||L().navigator&&L().navigator.doNotTrack)==="1"}var p={now:function(){var U=L().performance,k=U&&U.timing,w=U&&U.timeOrigin||k&&k.navigationStart;return typeof w=="number"&&typeof U.now=="function"?w+U.now():Date.now()}},T=C(678),l=C.n(T),o=function(U){return h(U)[0]},h=function(U){if(typeof U!="string"||U==="")return["localhost"];var k,w=(U.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/)||[])[4];return w&&(k=(w.match(/[^\.]+\.[^\.]+$/)||[])[0]),[w,k]},E={exists:function(){var U=L().performance;return(U&&U.timing)!==void 0},domContentLoadedEventEnd:function(){var U=L().performance,k=U&&U.timing;return k&&k.domContentLoadedEventEnd},navigationStart:function(){var U=L().performance,k=U&&U.timing;return k&&k.navigationStart}};function s(U,k,w){w=w===void 0?1:w,U[k]=U[k]||0,U[k]+=w}var c=["x-cdn","content-type","x-request-id"];function m(U){var k={};return(U=U||"").trim().split(/[\r\n]+/).forEach(function(w){if(w){var K=w.split(": "),W=K.shift();W&&(c.indexOf(W.toLowerCase())>=0||W.toLowerCase().indexOf("x-litix-")===0)&&(k[W]=K.join(": "))}}),k}var f=function(U){var k={};for(var w in U){var K=U[w];K["DATA-ID"].search("io.litix.data.")!==-1&&(k[K["DATA-ID"].replace("io.litix.data.","")]=K.VALUE)}return k};function g(U,k){var w=Object.keys(U);if(Object.getOwnPropertySymbols){var K=Object.getOwnPropertySymbols(U);k&&(K=K.filter(function(W){return Object.getOwnPropertyDescriptor(U,W).enumerable})),w.push.apply(w,K)}return w}function y(U){for(var k=1;k<arguments.length;k++){var w=arguments[k]!=null?arguments[k]:{};k%2?g(Object(w),!0).forEach(function(K){R(U,K,w[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(U,Object.getOwnPropertyDescriptors(w)):g(Object(w)).forEach(function(K){Object.defineProperty(U,K,Object.getOwnPropertyDescriptor(w,K))})}return U}function R(U,k,w){return k in U?Object.defineProperty(U,k,{value:w,enumerable:!0,configurable:!0,writable:!0}):U[k]=w,U}var D=function(U){if(!U)return{};var k=E.navigationStart(),w=U.loading,K=w?w.start:U.trequest,W=w?w.first:U.tfirst,z=w?w.end:U.tload;return{bytesLoaded:U.total,requestStart:Math.round(k+K),responseStart:Math.round(k+W),responseEnd:Math.round(k+z)}},P=function(U){if(U&&typeof U.getAllResponseHeaders=="function")return m(U.getAllResponseHeaders())},N=function(U,k){if(!U||typeof U.getRequests!="function")return{};var w=U.getRequests({state:"executed"});if(w.length===0)return{};var K,W=w[w.length-1],z=o(W.url),Y=W.bytesLoaded,Z=new Date(W.requestStartDate).getTime(),q=new Date(W.firstByteDate).getTime(),Q=new Date(W.requestEndDate).getTime(),se=isNaN(W.duration)?0:W.duration,Te=typeof k.getMetricsFor=="function"?k.getMetricsFor(W.mediaType).HttpList:k.getDashMetrics().getHttpRequests(W.mediaType);return Te.length>0&&(K=m(Te[Te.length-1]._responseHeaders||"")),{requestStart:Z,requestResponseStart:q,requestResponseEnd:Q,requestBytesLoaded:Y,requestResponseHeaders:K,requestMediaDuration:se,requestHostname:z}},B=function(U,k){var w=k.getQualityFor(U),K=k.getCurrentTrackFor(U).bitrateList;return K?{currentLevel:w,renditionWidth:K[w].width||null,renditionHeight:K[w].height||null,renditionBitrate:K[w].bandwidth}:{}};function F(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}var H=0,j=function(){function U(){(function(W,z){if(!(W instanceof z))throw new TypeError("Cannot call a class as a function")})(this,U)}var k,w,K;return k=U,w=[{key:"on",value:function(W,z,Y){return z._eventEmitterGuid=z._eventEmitterGuid||++H,this._listeners=this._listeners||{},this._listeners[W]=this._listeners[W]||[],Y&&(z=z.bind(Y)),this._listeners[W].push(z),z}},{key:"off",value:function(W,z){var Y=this._listeners&&this._listeners[W];Y&&Y.forEach(function(Z,q){Z._eventEmitterGuid===z._eventEmitterGuid&&Y.splice(q,1)})}},{key:"one",value:function(W,z,Y){var Z=this;z._eventEmitterGuid=z._eventEmitterGuid||++H;var q=function Q(){Z.off(W,Q),z.apply(Y||this,arguments)};q._eventEmitterGuid=z._eventEmitterGuid,this.on(W,q)}},{key:"emit",value:function(W,z){var Y=this;if(this._listeners){z=z||{};var Z=this._listeners["before*"]||[],q=this._listeners[W]||[],Q=this._listeners["after"+W]||[],se=function(Te,ke){(Te=Te.slice()).forEach(function(Ie){Ie.call(Y,{type:W},ke)})};se(Z,z),se(q,z),se(Q,z)}}}],w&&F(k.prototype,w),K&&F(k,K),Object.defineProperty(k,"prototype",{writable:!1}),U}(),X=j;function $(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}var G=function(){function U(W){var z=this;(function(Y,Z){if(!(Y instanceof Z))throw new TypeError("Cannot call a class as a function")})(this,U),this.pm=W,this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,W.on("playing",function(){z._playheadShouldBeProgressing=!0}),W.on("play",this._startPlaybackHeartbeatInterval.bind(this)),W.on("playing",this._startPlaybackHeartbeatInterval.bind(this)),W.on("adbreakstart",this._startPlaybackHeartbeatInterval.bind(this)),W.on("adplay",this._startPlaybackHeartbeatInterval.bind(this)),W.on("adplaying",this._startPlaybackHeartbeatInterval.bind(this)),W.on("seeking",this._startPlaybackHeartbeatInterval.bind(this)),W.on("devicewake",this._startPlaybackHeartbeatInterval.bind(this)),W.on("viewstart",this._startPlaybackHeartbeatInterval.bind(this)),W.on("rebufferstart",this._startPlaybackHeartbeatInterval.bind(this)),W.on("pause",this._stopPlaybackHeartbeatInterval.bind(this)),W.on("ended",this._stopPlaybackHeartbeatInterval.bind(this)),W.on("viewend",this._stopPlaybackHeartbeatInterval.bind(this)),W.on("error",this._stopPlaybackHeartbeatInterval.bind(this)),W.on("aderror",this._stopPlaybackHeartbeatInterval.bind(this)),W.on("adpause",this._stopPlaybackHeartbeatInterval.bind(this)),W.on("adended",this._stopPlaybackHeartbeatInterval.bind(this)),W.on("adbreakend",this._stopPlaybackHeartbeatInterval.bind(this)),W.on("seeked",function(){W.data.player_is_paused?z._stopPlaybackHeartbeatInterval():z._startPlaybackHeartbeatInterval()}),W.on("timeupdate",function(){z._playbackHeartbeatInterval!==null&&W.emit("playbackheartbeat")}),W.on("devicesleep",function(Y,Z){z._playbackHeartbeatInterval!==null&&(L().clearInterval(z._playbackHeartbeatInterval),W.emit("playbackheartbeatend",{viewer_time:Z.viewer_time}),z._playbackHeartbeatInterval=null)})}var k,w,K;return k=U,(w=[{key:"_startPlaybackHeartbeatInterval",value:function(){var W=this;this._playbackHeartbeatInterval===null&&(this.pm.emit("playbackheartbeat"),this._playbackHeartbeatInterval=L().setInterval(function(){W.pm.emit("playbackheartbeat")},this.pm.playbackHeartbeatTime))}},{key:"_stopPlaybackHeartbeatInterval",value:function(){this._playheadShouldBeProgressing=!1,this._playbackHeartbeatInterval!==null&&(L().clearInterval(this._playbackHeartbeatInterval),this.pm.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)}}])&&$(k.prototype,w),K&&$(k,K),Object.defineProperty(k,"prototype",{writable:!1}),U}();function J(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}function ee(U,k,w){return k&&J(U.prototype,k),w&&J(U,w),Object.defineProperty(U,"prototype",{writable:!1}),U}var te=ee(function U(k){var w=this;(function(K,W){if(!(K instanceof W))throw new TypeError("Cannot call a class as a function")})(this,U),k.on("viewinit",function(){w.viewErrored=!1}),k.on("error",function(){try{var K=k.errorTranslator({player_error_code:k.data.player_error_code,player_error_message:k.data.player_error_message});K?(k.data.player_error_code=K.player_error_code,k.data.player_error_message=K.player_error_message,w.viewErrored=!0):(delete k.data.player_error_code,delete k.data.player_error_message)}catch(W){k.mux.log.warn("Exception in error translator callback.",W),w.viewErrored=!0}})});function oe(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}var ue=function(){function U(W){(function(z,Y){if(!(z instanceof Y))throw new TypeError("Cannot call a class as a function")})(this,U),this.pm=W,this._watchTimeTrackerLastCheckedTime=null,W.on("playbackheartbeat",this._updateWatchTime.bind(this)),W.on("playbackheartbeatend",this._clearWatchTimeState.bind(this))}var k,w,K;return k=U,(w=[{key:"_updateWatchTime",value:function(W,z){var Y=z.viewer_time;this._watchTimeTrackerLastCheckedTime===null&&(this._watchTimeTrackerLastCheckedTime=Y),s(this.pm.data,"view_watch_time",Y-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=Y}},{key:"_clearWatchTimeState",value:function(W,z){this._updateWatchTime(W,z),this._watchTimeTrackerLastCheckedTime=null}}])&&oe(k.prototype,w),K&&oe(k,K),Object.defineProperty(k,"prototype",{writable:!1}),U}();function ne(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}var he=function(){function U(W){(function(z,Y){if(!(z instanceof Y))throw new TypeError("Cannot call a class as a function")})(this,U),this.pm=W,this._playbackTimeTrackerLastPlayheadPosition=-1,W.on("playbackheartbeat",this._updatePlaybackTime.bind(this)),W.on("playbackheartbeatend",this._clearPlaybackTimeState.bind(this)),W.on("seeking",this._clearPlaybackTimeState.bind(this))}var k,w,K;return k=U,(w=[{key:"_updatePlaybackTime",value:function(){var W=this.pm.data.player_playhead_time;if(this._playbackTimeTrackerLastPlayheadPosition>=0&&W>this._playbackTimeTrackerLastPlayheadPosition){var z=W-this._playbackTimeTrackerLastPlayheadPosition;z<=1e3&&s(this.pm.data,"view_content_playback_time",z)}this._playbackTimeTrackerLastPlayheadPosition=W}},{key:"_clearPlaybackTimeState",value:function(){this._updatePlaybackTime(),this._playbackTimeTrackerLastPlayheadPosition=-1}}])&&ne(k.prototype,w),K&&ne(k,K),Object.defineProperty(k,"prototype",{writable:!1}),U}();function me(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}var ae=function(){function U(W){(function(Y,Z){if(!(Y instanceof Z))throw new TypeError("Cannot call a class as a function")})(this,U),this.pm=W;var z=this._updatePlayheadTime.bind(this);W.on("playbackheartbeat",z),W.on("playbackheartbeatend",z),W.on("timeupdate",z),W.on("destroy",function(){W.off("timeupdate",z)})}var k,w,K;return k=U,(w=[{key:"_updateMaxPlayheadPosition",value:function(){this.pm.data.view_max_playhead_position=this.pm.data.view_max_playhead_position===void 0?this.pm.data.player_playhead_time:Math.max(this.pm.data.view_max_playhead_position,this.pm.data.player_playhead_time)}},{key:"_updatePlayheadTime",value:function(W,z){var Y=this,Z=function(){Y.pm.currentFragmentPDT&&Y.pm.currentFragmentStart&&(Y.pm.data.player_program_time=Y.pm.currentFragmentPDT+Y.pm.data.player_playhead_time-Y.pm.currentFragmentStart)};if(z&&z.player_playhead_time)this.pm.data.player_playhead_time=z.player_playhead_time,Z(),this._updateMaxPlayheadPosition();else if(this.pm.getPlayheadTime){var q=this.pm.getPlayheadTime();q!==void 0&&(this.pm.data.player_playhead_time=q,Z(),this._updateMaxPlayheadPosition())}}}])&&me(k.prototype,w),K&&me(k,K),Object.defineProperty(k,"prototype",{writable:!1}),U}();function Me(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}function Se(U,k,w){return k&&Me(U.prototype,k),w&&Me(U,w),Object.defineProperty(U,"prototype",{writable:!1}),U}var xe=Se(function U(k){if(function(W,z){if(!(W instanceof z))throw new TypeError("Cannot call a class as a function")}(this,U),!k.disableRebufferTracking){var w,K=function(){if(w){var W=k.data.viewer_time-w;s(k.data,"view_rebuffer_duration",W),w=k.data.viewer_time}k.data.view_watch_time>=0&&k.data.view_rebuffer_count>0&&(k.data.view_rebuffer_frequency=k.data.view_rebuffer_count/k.data.view_watch_time,k.data.view_rebuffer_percentage=k.data.view_rebuffer_duration/k.data.view_watch_time)};k.on("playbackheartbeat",function(){return K()}),k.on("rebufferstart",function(){w||(s(k.data,"view_rebuffer_count",1),w=k.data.viewer_time,k.one("rebufferend",function(){K(),w=void 0}))})}});function be(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}var Ue=function(){function U(W){var z=this;(function(Y,Z){if(!(Y instanceof Z))throw new TypeError("Cannot call a class as a function")})(this,U),this.pm=W,W.disableRebufferTracking||W.disablePlayheadRebufferTracking||(this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,W.on("playbackheartbeat",this._checkIfRebuffering.bind(this)),W.on("playbackheartbeatend",this._cleanupRebufferTracker.bind(this)),W.on("seeking",function(){z._cleanupRebufferTracker(null,{viewer_time:p.now()})}))}var k,w,K;return k=U,w=[{key:"_checkIfRebuffering",value:function(W,z){if(this.pm.seekingTracker.isSeeking||this.pm.adTracker.isAdBreak||!this.pm.playbackHeartbeat._playheadShouldBeProgressing)this._cleanupRebufferTracker(W,z);else if(this._lastCheckedTime!==null)if(this._lastPlayheadTime===this.pm.data.player_playhead_time){var Y=z.viewer_time-this._lastPlayheadTimeUpdatedTime;typeof this.pm.sustainedRebufferThreshold=="number"&&Y>=this.pm.sustainedRebufferThreshold&&(this._rebuffering||(this._rebuffering=!0,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}))),this._lastCheckedTime=z.viewer_time}else this._cleanupRebufferTracker(W,z,!0);else this._prepareRebufferTrackerState(z.viewer_time)}},{key:"_clearRebufferTrackerState",value:function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null}},{key:"_prepareRebufferTrackerState",value:function(W){this._lastCheckedTime=W,this._lastPlayheadTime=this.pm.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=W}},{key:"_cleanupRebufferTracker",value:function(W,z){var Y=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(this._rebuffering)this._rebuffering=!1,this.pm.emit("rebufferend",{viewer_time:z.viewer_time});else{if(this._lastCheckedTime===null)return;var Z=this.pm.data.player_playhead_time-this._lastPlayheadTime,q=z.viewer_time-this._lastPlayheadTimeUpdatedTime;typeof this.pm.minimumRebufferDuration=="number"&&Z>0&&q-Z>this.pm.minimumRebufferDuration&&(this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.pm.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+q-Z}))}Y?this._prepareRebufferTrackerState(z.viewer_time):this._clearRebufferTrackerState()}}],w&&be(k.prototype,w),K&&be(k,K),Object.defineProperty(k,"prototype",{writable:!1}),U}(),Je=Ue;function Ge(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}var rt=function(){function U(W){var z=this;(function(Y,Z){if(!(Y instanceof Z))throw new TypeError("Cannot call a class as a function")})(this,U),this.pm=W,W.on("viewinit",function(){var Y=W.data,Z=Y.view_id;if(!Y.view_program_changed){var q=function(Q,se){var Te=se.viewer_time;Q.type==="playing"&&W.data.view_time_to_first_frame===void 0?z.calculateTimeToFirstFrame(Te||p.now(),Z):Q.type!=="adplaying"||W.data.view_time_to_first_frame!==void 0&&!z._inPrerollPosition()||z.calculateTimeToFirstFrame(Te||p.now(),Z)};W.one("playing",q),W.one("adplaying",q),W.one("viewend",function(){W.off("playing",q),W.off("adplaying",q)})}})}var k,w,K;return k=U,(w=[{key:"_inPrerollPosition",value:function(){return this.pm.data.view_content_playback_time===void 0||this.pm.data.view_content_playback_time<=1e3}},{key:"calculateTimeToFirstFrame",value:function(W,z){z===this.pm.data.view_id&&(this.pm.watchTimeTracker._updateWatchTime(null,{viewer_time:W}),this.pm.data.view_time_to_first_frame=this.pm.data.view_watch_time,(this.pm.data.player_autoplay_on||this.pm.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.pm.data.view_aggregate_startup_time=this.pm.data.view_start+this.pm.data.view_watch_time-this.NAVIGATION_START))}}])&&Ge(k.prototype,w),K&&Ge(k,K),Object.defineProperty(k,"prototype",{writable:!1}),U}();function Ke(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}function lt(U,k,w){return k&&Ke(U.prototype,k),w&&Ke(U,w),Object.defineProperty(U,"prototype",{writable:!1}),U}var ft=lt(function U(k){var w=this;(function(K,W){if(!(K instanceof W))throw new TypeError("Cannot call a class as a function")})(this,U),k.on("viewinit",function(){w._lastPlayheadPosition=-1}),["pause","rebufferstart","seeking","error","adbreakstart","hb"].forEach(function(K){k.on(K,function(){if(w._lastPlayheadPosition>=0&&k.data.player_playhead_time>=0&&w._lastPlayerWidth>=0&&w._lastSourceWidth>0&&w._lastPlayerHeight>=0&&w._lastSourceHeight>0){var W=k.data.player_playhead_time-w._lastPlayheadPosition;if(W<0)return void(w._lastPlayheadPosition=-1);var z=Math.min(w._lastPlayerWidth/w._lastSourceWidth,w._lastPlayerHeight/w._lastSourceHeight),Y=Math.max(0,z-1),Z=Math.max(0,1-z);k.data.view_max_upscale_percentage=Math.max(k.data.view_max_upscale_percentage||0,Y),k.data.view_max_downscale_percentage=Math.max(k.data.view_max_downscale_percentage||0,Z),s(k.data,"view_total_content_playback_time",W),s(k.data,"view_total_upscaling",Y*W),s(k.data,"view_total_downscaling",Z*W)}w._lastPlayheadPosition=-1})}),["playing","hb"].forEach(function(K){k.on(K,function(){w._lastPlayheadPosition=k.data.player_playhead_time,w._lastPlayerWidth=k.data.player_width,w._lastPlayerHeight=k.data.player_height,w._lastSourceWidth=k.data.video_source_width,w._lastSourceHeight=k.data.video_source_height})})});function ht(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}function ut(U,k,w){return k&&ht(U.prototype,k),w&&ht(U,w),Object.defineProperty(U,"prototype",{writable:!1}),U}var Mt=ut(function U(k){var w=this;(function(K,W){if(!(K instanceof W))throw new TypeError("Cannot call a class as a function")})(this,U),this.isSeeking=!1,k.on("seeking",function(K,W){l()(k.data,W),w._lastSeekingTime=p.now(),w.isSeeking===!1&&(w.isSeeking=!0,k.send("seeking"))}),k.on("seeked",function(){w.isSeeking=!1;var K=w._lastSeekingTime||p.now(),W=p.now()-K;s(k.data,"view_seek_count",1),s(k.data,"view_seek_duration",W);var z=k.data.view_max_seek_time||0;k.data.view_max_seek_time=Math.max(z,W)}),k.on("viewend",function(){w.isSeeking=!1})});function it(U,k){return function(w){if(Array.isArray(w))return w}(U)||function(w,K){var W=w==null?null:typeof Symbol!="undefined"&&w[Symbol.iterator]||w["@@iterator"];if(W!=null){var z,Y,Z=[],q=!0,Q=!1;try{for(W=W.call(w);!(q=(z=W.next()).done)&&(Z.push(z.value),!K||Z.length!==K);q=!0);}catch(se){Q=!0,Y=se}finally{try{q||W.return==null||W.return()}finally{if(Q)throw Y}}return Z}}(U,k)||function(w,K){if(w){if(typeof w=="string")return Ct(w,K);var W=Object.prototype.toString.call(w).slice(8,-1);return W==="Object"&&w.constructor&&(W=w.constructor.name),W==="Map"||W==="Set"?Array.from(w):W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W)?Ct(w,K):void 0}}(U,k)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Ct(U,k){(k==null||k>U.length)&&(k=U.length);for(var w=0,K=new Array(k);w<k;w++)K[w]=U[w];return K}function Ye(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}var qe=function(U,k){U.push(k),U.sort(function(w,K){return w.viewer_time-K.viewer_time})},bt=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror"],et=function(){function U(W){var z=this;(function(Z,q){if(!(Z instanceof q))throw new TypeError("Cannot call a class as a function")})(this,U),this.pm=W,W.on("viewinit",function(){z.isAdBreak=!1,z._currentAdRequestNumber=0,z._currentAdResponseNumber=0,z._adRequests=[],z._adResponses=[],z._adHasPlayed=!1,z._wouldBeNewAdPlay=!0,z._prerollPlayTime=void 0}),bt.forEach(function(Z){return W.on(Z,z._updateAdData.bind(z))});var Y=function(){z.isAdBreak=!1};W.on("adbreakstart",function(){z.isAdBreak=!0}),W.on("play",Y),W.on("playing",Y),W.on("viewend",Y),W.on("adrequest",function(Z,q){q=l()({ad_request_id:"generatedAdRequestId"+z._currentAdRequestNumber++},q),qe(z._adRequests,q),s(W.data,"view_ad_request_count"),z.inPrerollPosition()&&(W.data.view_preroll_requested=!0,z._adHasPlayed||s(W.data,"view_preroll_request_count"))}),W.on("adresponse",function(Z,q){q=l()({ad_request_id:"generatedAdRequestId"+z._currentAdResponseNumber++},q),qe(z._adResponses,q);var Q=z.findAdRequest(q.ad_request_id);Q&&s(W.data,"view_ad_request_time",Math.max(0,q.viewer_time-Q.viewer_time))}),W.on("adplay",function(Z,q){z._adHasPlayed=!0,z._wouldBeNewAdPlay&&(z._wouldBeNewAdPlay=!1,s(W.data,"view_ad_played_count")),z.inPrerollPosition()&&!W.data.view_preroll_played&&(W.data.view_preroll_played=!0,z._adRequests.length>0&&(W.data.view_preroll_request_time=Math.max(0,q.viewer_time-z._adRequests[0].viewer_time)),W.data.view_start&&(W.data.view_startup_preroll_request_time=Math.max(0,q.viewer_time-W.data.view_start)),z._prerollPlayTime=q.viewer_time)}),W.on("adplaying",function(Z,q){z.inPrerollPosition()&&W.data.view_preroll_load_time===void 0&&z._prerollPlayTime!==void 0&&(W.data.view_preroll_load_time=q.viewer_time-z._prerollPlayTime,W.data.view_startup_preroll_load_time=q.viewer_time-z._prerollPlayTime)}),W.on("adended",function(){z._wouldBeNewAdPlay=!0}),W.on("aderror",function(){z._wouldBeNewAdPlay=!0})}var k,w,K;return k=U,(w=[{key:"inPrerollPosition",value:function(){return this.pm.data.view_content_playback_time===void 0||this.pm.data.view_content_playback_time<=1e3}},{key:"findAdRequest",value:function(W){for(var z=0;z<this._adRequests.length;z++)if(this._adRequests[z].ad_request_id===W)return this._adRequests[z]}},{key:"_updateAdData",value:function(W,z){if(this.inPrerollPosition()){if(!this.pm.data.view_preroll_ad_tag_hostname&&z.ad_tag_url){var Y=it(h(z.ad_tag_url),2),Z=Y[0],q=Y[1];this.pm.data.view_preroll_ad_tag_domain=q,this.pm.data.view_preroll_ad_tag_hostname=Z}if(!this.pm.data.view_preroll_ad_asset_hostname&&z.ad_asset_url){var Q=it(h(z.ad_asset_url),2),se=Q[0],Te=Q[1];this.pm.data.view_preroll_ad_asset_domain=Te,this.pm.data.view_preroll_ad_asset_hostname=se}}}}])&&Ye(k.prototype,w),K&&Ye(k,K),Object.defineProperty(k,"prototype",{writable:!1}),U}();function je(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}function wt(U,k,w){return k&&je(U.prototype,k),w&&je(U,w),Object.defineProperty(U,"prototype",{writable:!1}),U}var vt=wt(function U(k){var w,K;(function(Z,q){if(!(Z instanceof q))throw new TypeError("Cannot call a class as a function")})(this,U);var W=function(){k.disableRebufferTracking||w&&(s(k.data,"view_waiting_rebuffer_duration",p.now()-w),w=!1,L().clearInterval(K))},z=!1,Y=function(){z=!1,W()};k.on("waiting",function(){z&&(k.disableRebufferTracking||(s(k.data,"view_waiting_rebuffer_count",1),w=p.now(),K=L().setInterval(function(){if(w){var Z=p.now();s(k.data,"view_waiting_rebuffer_duration",Z-w),w=Z}},250)))}),k.on("playing",function(){W(),z=!0}),k.on("pause",Y),k.on("seeking",Y)});function Gt(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}function yr(U,k,w){return k&&Gt(U.prototype,k),w&&Gt(U,w),Object.defineProperty(U,"prototype",{writable:!1}),U}var xt=yr(function U(k){var w=this;(function(z,Y){if(!(z instanceof Y))throw new TypeError("Cannot call a class as a function")})(this,U);var K=function(){w.lastWallClockTime=p.now(),k.on("before*",W)},W=function(z){var Y=p.now(),Z=w.lastWallClockTime;w.lastWallClockTime=Y,Y-Z>3e4&&(k.emit("devicesleep",{viewer_time:Z}),l()(k.data,{viewer_time:Z}),k.send("devicesleep"),k.emit("devicewake",{viewer_time:Y}),l()(k.data,{viewer_time:Y}),k.send("devicewake"))};k.one("playbackheartbeat",K),k.on("playbackheartbeatend",function(){k.off("before*",W),k.one("playbackheartbeat",K)})}),Nr=C(375),Tr=C(655),Ut=C.n(Tr),jt="muxData",Nt=function(){var U;try{U=Nr.parse(Ut().get(jt)||"")}catch{U={}}return U},br=function(U){try{Ut().set(jt,Nr.stringify(U),{expires:7300})}catch{}},or=function(){var U=Nt();return U.mux_viewer_id=U.mux_viewer_id||A(),U.msn=U.msn||Math.random(),br(U),{mux_viewer_id:U.mux_viewer_id,mux_sample_number:U.msn}};function ya(U,k){var w=k.beaconCollectionDomain,K=k.beaconDomain;if(w)return"https://"+w;var W=K||"litix.io";return(U=U||"inferred").match(/^[a-z0-9]+$/)?"https://"+U+"."+W:"https://img.litix.io/a.gif"}var ci=function(){var U;switch(Br()){case"cellular":U="cellular";break;case"ethernet":U="wired";break;case"wifi":U="wifi";break;case void 0:break;default:U="other"}return U},Br=function(){var U=L().navigator,k=U&&(U.connection||U.mozConnection||U.webkitConnection);return k&&k.type};ci.getConnectionFromAPI=Br;var Lt=ci,Ji=qi({a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",i:"internal",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"}),fi=qi({ad:"ad",ag:"aggregate",ap:"api",al:"application",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",br:"break",bw:"browser",by:"bytes",ca:"cached",cb:"cancel",cd:"code",cg:"category",ch:"changed",cn:"config",co:"count",ce:"counter",cp:"complete",cr:"creative",ct:"content",cu:"current",cx:"connection",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",du:"duration",dv:"device",ec:"encoding",ed:"edge",en:"end",eg:"engine",em:"embed",er:"error",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",ep:"experiments",fi:"first",fm:"family",ft:"format",fp:"fps",fq:"frequency",fr:"frame",fs:"fullscreen",hb:"holdback",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mf:"manifest",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",ne:"newest",nm:"name",no:"number",on:"on",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pr:"preload",ps:"position",pt:"part",py:"property",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",se:"session",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",st:"start",su:"startup",sv:"server",sw:"software",ta:"tag",tc:"tech",te:"text",tg:"target",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"});function qi(U){var k={};for(var w in U)U.hasOwnProperty(w)&&(k[U[w]]=w);return k}function hi(U){var k={},w={};return Object.keys(U).forEach(function(K){var W=!1;if(U.hasOwnProperty(K)&&U[K]!==void 0){var z=K.split("_"),Y=z[0],Z=Ji[Y];Z||(i.info("Data key word `"+z[0]+"` not expected in "+K),Z=Y+"_"),z.splice(1).forEach(function(q){q==="url"&&(W=!0),fi[q]?Z+=fi[q]:Number(q)&&Math.floor(Number(q))===Number(q)?Z+=q:(i.info("Data key word `"+q+"` not expected in "+K),Z+="_"+q+"_")}),W?w[Z]=U[K]:k[Z]=U[K]}}),l()(k,w)}var Ta={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:1e4,maxPayloadKBSize:500},ba=["hb","requestcompleted","requestfailed","requestcanceled"],Bt=function(U,k){this._beaconUrl=U||"https://img.litix.io",this._eventQueue=[],this._postInFlight=!1,this._failureCount=0,this._sendTimeout=!1,this._options=l()({},Ta,k)};Bt.prototype.queueEvent=function(U,k){var w=l()({},k);return(this._eventQueue.length<=this._options.maxQueueLength||U==="eventrateexceeded")&&(this._eventQueue.push(w),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength)},Bt.prototype.flushEvents=function(){this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending()},Bt.prototype.destroy=function(){var U=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.destroyed=!0,U?this._clearBeaconQueue():this.flushEvents(),L().clearTimeout(this._sendTimeout)},Bt.prototype._clearBeaconQueue=function(){var U=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,k=this._eventQueue.slice(U);U>0&&l()(k[k.length-1],hi({mux_view_message:"event queue truncated"}));var w=this._createPayload(k);Fr(this._beaconUrl,w,!0,function(){})},Bt.prototype._sendBeaconQueue=function(){var U=this;if(!this._postInFlight){var k=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0;var w=this._createPayload(k),K=p.now();Fr(this._beaconUrl,w,!1,function(W,z){z?(U._eventQueue=k.concat(U._eventQueue),U._failureCount+=1,i.info("Error sending beacon: "+z)):U._failureCount=0,U._roundTripTime=p.now()-K,U._postInFlight=!1})}},Bt.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var U=Math.pow(2,this._failureCount-1);return(1+(U*=Math.random()))*this._options.baseTimeBetweenBeacons},Bt.prototype._startBeaconSending=function(){var U=this;L().clearTimeout(this._sendTimeout),this.destroyed||(this._sendTimeout=L().setTimeout(function(){U._eventQueue.length&&U._sendBeaconQueue(),U._startBeaconSending()},this._getNextBeaconTime()))},Bt.prototype._createPayload=function(U){var k,w,K,W=this,z={transmission_timestamp:Math.round(p.now())};this._roundTripTime&&(z.rtt_ms=Math.round(this._roundTripTime));var Y=function(){k=JSON.stringify({metadata:z,events:w||U}),K=k.length/1024},Z=function(){return K<=W._options.maxPayloadKBSize};return Y(),Z()||(i.info("Payload size is too big ("+K+" kb). Removing unnecessary events."),w=U.filter(function(q){return ba.indexOf(q.e)===-1}),Y()),Z()||(i.info("Payload size still too big ("+K+" kb). Cropping fields.."),w.forEach(function(q){for(var Q in q){var se=q[Q];typeof se=="string"&&se.length>51200&&(q[Q]=se.substring(0,51200))}}),Y()),k};var Fr=function(U,k,w,K){if(w&&navigator&&navigator.sendBeacon&&navigator.sendBeacon(U,k))K();else if(L().fetch)L().fetch(U,{method:"POST",body:k,headers:{"Content-Type":"text/plain"},keepalive:!0}).then(function(z){return K(null,z.ok?null:"Error")}).catch(function(z){return K(null,z)});else{if(L().XMLHttpRequest){var W=new(L()).XMLHttpRequest;return W.onreadystatechange=function(){if(W.readyState===4)return K(null,W.status!==200?"error":void 0)},W.open("POST",U),W.setRequestHeader("Content-Type","text/plain"),void W.send(k)}K()}},en=Bt;function Ar(U){return Ar=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},Ar(U)}var Aa=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id"],Yu=["viewstart","error","ended","viewend"],tn=function(U,k){var w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.mux=U,this.envKey=k,this.eventQueue=new en(ya(k,w)),this.previousBeaconData=null,this.lastEventTime=null,this.sampleRate=w.sampleRate,this.disableCookies=w.disableCookies,this.respectDoNotTrack=w.respectDoNotTrack;var K=w.platform||{};this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:K.name,viewer_application_version:K.version,viewer_application_engine:K.layout,viewer_device_name:K.product,viewer_device_category:"",viewer_device_manufacturer:K.manufacturer,viewer_os_family:K.os&&K.os.family,viewer_os_architecture:K.os&&K.os.architecture,viewer_os_version:K.os&&K.os.version};var W=Lt();W&&(this.pageLevelData=l()(this.pageLevelData,{viewer_connection_type:W})),L()!==void 0&&L().location&&L().location.href&&(this.pageLevelData.page_url=L().location.href),this.viewerData=this.disableCookies?{}:or()};tn.prototype.send=function(U,k){if(U){if(this.respectDoNotTrack&&d())return i.info("Not sending `"+U+"` because Do Not Track is enabled");if(!k||Ar(k)!=="object")return i.error("A data object was expected in send() but was not provided");var w,K,W=this.disableCookies?{}:(w=Nt(),K=p.now(),w.session_start&&(w.sst=w.session_start,delete w.session_start),w.session_id&&(w.sid=w.session_id,delete w.session_id),w.session_expires&&(w.sex=w.session_expires,delete w.session_expires),(!w.sex||w.sex<K)&&(w.sid=A(),w.sst=K),w.sex=K+15e5,br(w),{session_id:w.sid,session_start:w.sst,session_expires:w.sex}),z={};l()(z,this.pageLevelData),l()(z,k),l()(z,W),l()(z,this.viewerData),z.event=U,z.env_key=this.envKey,z.user_id&&(z.viewer_user_id=z.user_id,delete z.user_id);var Y=z.mux_sample_number>=this.sampleRate,Z=hi(this._deduplicateBeaconData(U,z));if(this.lastEventTime=this.mux.utils.now(),Y)return i.info("Not sending event due to sample rate restriction",U,z,Z);if(this.envKey||i.info("Missing environment key (envKey) - beacons will be dropped if the video source is not a valid mux video URL",U,z,Z),!this.rateLimited){if(i.info("Sending event",U,z,Z),this.rateLimited=!this.eventQueue.queueEvent(U,Z),this.mux.WINDOW_UNLOADING&&U==="viewend")this.eventQueue.destroy(!0);else if((Yu.indexOf(U)>=0||this.mux.WINDOW_HIDDEN&&U==="hb")&&this.eventQueue.flushEvents(),this.rateLimited)return z.event="eventrateexceeded",Z=hi(z),this.eventQueue.queueEvent(z.event,Z),i.error("Beaconing disabled due to rate limit.")}}},tn.prototype.destroy=function(){this.eventQueue.destroy(!1)},tn.prototype._deduplicateBeaconData=function(U,k){var w=this,K={},W=k.view_id;if(!W||U==="viewstart"||U==="viewend"||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=6e5)K=l()({},k),W&&(this.previousBeaconData=K),W&&U==="viewend"&&(this.previousBeaconData=null);else{var z=U.indexOf("request")===0;Object.keys(k).forEach(function(Y){var Z=k[Y];(Z!==w.previousBeaconData[Y]||Aa.indexOf(Y)>-1||function(q,Q,se,Te){return!(!q||Q.indexOf("request_")!==0||Q!=="request_response_headers"&&Ar(se)==="object"&&Ar(Te)==="object"&&Object.keys(se||{}).length===Object.keys(Te||{}).length)}(z,Y,Z,w.previousBeaconData[Y])||function(q,Q){return q==="renditionchange"&&Q.indexOf("video_source_")===0}(U,Y))&&(K[Y]=Z,w.previousBeaconData[Y]=Z)})}return K};var zu=tn;function ao(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}function Xu(U,k,w){return k&&ao(U.prototype,k),w&&ao(U,w),Object.defineProperty(U,"prototype",{writable:!1}),U}var Qu=Xu(function U(k){(function(Q,se){if(!(Q instanceof se))throw new TypeError("Cannot call a class as a function")})(this,U);var w=0,K=0,W=0,z=0,Y=0,Z=0,q=0;k.on("requestcompleted",function(Q,se){var Te,ke,Ie=se.request_start,ve=se.request_response_start,Ee=se.request_response_end,Ne=se.request_bytes_loaded;if(z++,ve?(Te=ve-Ie,ke=Ee-ve):ke=Ee-Ie,ke>0&&Ne>0){var At=Ne/ke*8e3;Y++,K+=Ne,W+=ke,k.data.view_min_request_throughput=Math.min(k.data.view_min_request_throughput||1/0,At),k.data.view_average_request_throughput=K/W*8e3,k.data.view_request_count=z,Te>0&&(w+=Te,k.data.view_max_request_latency=Math.max(k.data.view_max_request_latency||0,Te),k.data.view_average_request_latency=w/Y)}}),k.on("requestfailed",function(Q,se){z++,Z++,k.data.view_request_count=z,k.data.view_request_failed_count=Z}),k.on("requestcanceled",function(Q,se){z++,q++,k.data.view_request_count=z,k.data.view_request_canceled_count=q})});function so(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}function Zu(U,k,w){return k&&so(U.prototype,k),w&&so(U,w),Object.defineProperty(U,"prototype",{writable:!1}),U}var Ju=Zu(function U(k){var w=this;(function(K,W){if(!(K instanceof W))throw new TypeError("Cannot call a class as a function")})(this,U),k.on("before*",function(K,W){var z=W.viewer_time,Y=p.now(),Z=w._lastEventTime;if(w._lastEventTime=Y,Z&&Y-Z>36e5){var q=Object.keys(k.data).reduce(function(Q,se){return se.indexOf("video_")===0?l()(Q,function(Te,ke,Ie){return ke in Te?Object.defineProperty(Te,ke,{value:Ie,enumerable:!0,configurable:!0,writable:!0}):Te[ke]=Ie,Te}({},se,k.data[se])):Q},{});k.mux.log.info("Received event after at least an hour inactivity, creating a new view"),k.emit("viewinit",l()({viewer_time:z},q)),k.playbackHeartbeat._playheadShouldBeProgressing&&K.type!=="play"&&K.type!=="adbreakstart"&&(k.emit("play",{viewer_time:z}),K.type!=="playing"&&k.emit("playing",{viewer_time:z}))}})});function _a(U){return _a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},_a(U)}function qu(U,k){return function(w){if(Array.isArray(w))return w}(U)||function(w,K){var W=w==null?null:typeof Symbol!="undefined"&&w[Symbol.iterator]||w["@@iterator"];if(W!=null){var z,Y,Z=[],q=!0,Q=!1;try{for(W=W.call(w);!(q=(z=W.next()).done)&&(Z.push(z.value),!K||Z.length!==K);q=!0);}catch(se){Q=!0,Y=se}finally{try{q||W.return==null||W.return()}finally{if(Q)throw Y}}return Z}}(U,k)||function(w,K){if(w){if(typeof w=="string")return oo(w,K);var W=Object.prototype.toString.call(w).slice(8,-1);return W==="Object"&&w.constructor&&(W=w.constructor.name),W==="Map"||W==="Set"?Array.from(w):W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W)?oo(w,K):void 0}}(U,k)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function oo(U,k){(k==null||k>U.length)&&(k=U.length);for(var w=0,K=new Array(k);w<k;w++)K[w]=U[w];return K}function lo(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}function Sa(U,k){return Sa=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(w,K){return w.__proto__=K,w},Sa(U,k)}function ed(U){var k=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var w,K=rn(U);if(k){var W=rn(this).constructor;w=Reflect.construct(K,arguments,W)}else w=K.apply(this,arguments);return td(this,w)}}function td(U,k){if(k&&(_a(k)==="object"||typeof k=="function"))return k;if(k!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return at(U)}function at(U){if(U===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return U}function rn(U){return rn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(k){return k.__proto__||Object.getPrototypeOf(k)},rn(U)}var rd=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],id=function(U){(function(Y,Z){if(typeof Z!="function"&&Z!==null)throw new TypeError("Super expression must either be null or a function");Y.prototype=Object.create(Z&&Z.prototype,{constructor:{value:Y,writable:!0,configurable:!0}}),Object.defineProperty(Y,"prototype",{writable:!1}),Z&&Sa(Y,Z)})(z,U);var k,w,K,W=ed(z);function z(Y,Z,q){var Q;(function(ve,Ee){if(!(ve instanceof Ee))throw new TypeError("Cannot call a class as a function")})(this,z),(Q=W.call(this)).DOM_CONTENT_LOADED_EVENT_END=E.domContentLoadedEventEnd(),Q.NAVIGATION_START=E.navigationStart(),Q.mux=Y,Q.id=Z,(q=l()({debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,disablePlayheadRebufferTracking:!1,errorTranslator:function(ve){return ve}},q)).data=q.data||{},q.data.property_key&&(q.data.env_key=q.data.property_key,delete q.data.property_key),i.setLevel(q.debug?"debug":"warn"),Q.getPlayheadTime=q.getPlayheadTime,Q.getStateData=q.getStateData||function(){return{}},Q.getAdData=q.getAdData||function(){},Q.minimumRebufferDuration=q.minimumRebufferDuration,Q.sustainedRebufferThreshold=q.sustainedRebufferThreshold,Q.playbackHeartbeatTime=q.playbackHeartbeatTime,Q.disableRebufferTracking=q.disableRebufferTracking,Q.disableRebufferTracking&&Q.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),Q.disablePlayheadRebufferTracking=q.disablePlayheadRebufferTracking,Q.errorTranslator=q.errorTranslator,Q.playbackEventDispatcher=new zu(Y,q.data.env_key,q),Q.data={player_instance_id:A(),mux_sample_rate:q.sampleRate,beacon_domain:q.beaconCollectionDomain?q.beaconCollectionDomain:q.beaconDomain},Q.data.view_sequence_number=1,Q.data.player_sequence_number=1,Q.oldEmit=Q.emit,Q.emit=function(ve,Ee){Ee=l()({viewer_time:this.mux.utils.now()},Ee),this.oldEmit(ve,Ee)};var se=function(){this.data.view_start===void 0&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}.bind(at(Q));Q.on("viewinit",function(ve,Ee){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),l()(this.data,Ee),this._initializeViewData(),this.one("play",se),this.one("adbreakstart",se)});var Te=function(ve){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",ve)}.bind(at(Q));if(Q.on("videochange",function(ve,Ee){Te(Ee)}),Q.on("programchange",function(ve,Ee){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),Te(l()(Ee,{view_program_changed:!0})),se(),this.emit("play"),this.emit("playing")}),Q.on("fragmentchange",function(ve,Ee){this.currentFragmentPDT=Ee.currentFragmentPDT,this.currentFragmentStart=Ee.currentFragmentStart}),Q.on("destroy",Q.destroy),typeof window!="undefined"&&typeof window.addEventListener=="function"&&typeof window.removeEventListener=="function"){var ke=function(){var ve=Q.data.view_start!==void 0;Q.mux.WINDOW_HIDDEN=document.visibilityState==="hidden",ve&&Q.mux.WINDOW_HIDDEN&&(Q.data.player_is_paused||Q.emit("hb"))};window.addEventListener("visibilitychange",ke,!1);var Ie=function(ve){ve.persisted||Q.destroy()};window.addEventListener("pagehide",Ie,!1),Q.on("destroy",function(){window.removeEventListener("visibilitychange",ke),window.removeEventListener("pagehide",Ie)})}return Q.on("playerready",function(ve,Ee){l()(this.data,Ee)}),rd.forEach(function(ve){Q.on(ve,function(Ee,Ne){ve.indexOf("ad")!==0&&this._updateStateData(),l()(this.data,Ne),this._sanitizeData()}),Q.on("after"+ve,function(){(ve!=="error"||this.errorTracker.viewErrored)&&this.send(ve)})}),Q.on("viewend",function(ve,Ee){l()(Q.data,Ee)}),Q.one("playerready",function(ve){var Ee=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=Ee-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time}),Q.longResumeTracker=new Ju(at(Q)),Q.errorTracker=new te(at(Q)),new xt(at(Q)),Q.seekingTracker=new Mt(at(Q)),Q.playheadTime=new ae(at(Q)),Q.playbackHeartbeat=new G(at(Q)),new ft(at(Q)),Q.watchTimeTracker=new ue(at(Q)),new he(at(Q)),Q.adTracker=new et(at(Q)),new Je(at(Q)),new xe(at(Q)),new rt(at(Q)),new vt(at(Q)),new Qu(at(Q)),q.hlsjs&&Q.addHLSJS(q),q.dashjs&&Q.addDashJS(q),Q.emit("viewinit",q.data),Q}return k=z,w=[{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,this.data.view_start!==void 0&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),window.clearTimeout(this._heartBeatTimeout))}},{key:"send",value:function(Y){var Z=l()({},this.data);if(Z.video_source_is_live===void 0&&(Z.player_source_duration===1/0||Z.video_source_duration===1/0?Z.video_source_is_live=!0:(Z.player_source_duration>0||Z.video_source_duration>0)&&(Z.video_source_is_live=!1)),Z.video_source_is_live||["player_program_time","player_manifest_newest_program_time","player_live_edge_program_time","player_program_time","video_holdback","video_part_holdback","video_target_duration","video_part_target_duration"].forEach(function(Te){Z[Te]=void 0}),Z.video_source_url=Z.video_source_url||Z.player_source_url,Z.video_source_url){var q=qu(h(Z.video_source_url),2),Q=q[0],se=q[1];Z.video_source_domain=se,Z.video_source_hostname=Q}delete Z.ad_request_id,this.playbackEventDispatcher.send(Y,Z),this.data.view_sequence_number++,this.data.player_sequence_number++,this._restartHeartBeat()}},{key:"_updateStateData",value:function(){l()(this.data,this.getStateData()),this.playheadTime._updatePlayheadTime(),this._sanitizeData()}},{key:"_sanitizeData",value:function(){var Y=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach(function(Z){var q=parseInt(Y.data[Z],10);Y.data[Z]=isNaN(q)?void 0:q}),["player_source_url","video_source_url"].forEach(function(Z){if(Y.data[Z]){var q=Y.data[Z].toLowerCase();q.indexOf("data:")!==0&&q.indexOf("blob:")!==0||(Y.data[Z]="MSE style URL")}})}},{key:"_resetVideoData",value:function(Y,Z){var q=this;Object.keys(this.data).forEach(function(Q){Q.indexOf("video_")===0&&delete q.data[Q]})}},{key:"_resetViewData",value:function(){var Y=this;Object.keys(this.data).forEach(function(Z){Z.indexOf("view_")===0&&delete Y.data[Z]}),this.data.view_sequence_number=1}},{key:"_resetErrorData",value:function(Y,Z){delete this.data.player_error_code,delete this.data.player_error_message}},{key:"_initializeViewData",value:function(){var Y=this,Z=this.data.view_id=A(),q=function(){Z===Y.data.view_id&&s(Y.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",q):q()}},{key:"_restartHeartBeat",value:function(){var Y=this;window.clearTimeout(this._heartBeatTimeout),this.errorTracker.viewErrored||(this._heartBeatTimeout=window.setTimeout(function(){Y.data.player_is_paused||Y.emit("hb")},1e4))}},{key:"addHLSJS",value:function(Y){Y.hlsjs?this.hlsjs?this.mux.log.warn("An instance of HLS.js is already being monitored for this player."):(this.hlsjs=Y.hlsjs,function(Z,q,Q){var se=arguments.length>4?arguments[4]:void 0,Te=Z.log,ke=Z.utils.secondsToMs,Ie=function(Pe){var ge,Ae=parseInt(se.version);return Ae===1&&Pe.programDateTime!==null&&(ge=Pe.programDateTime),Ae===0&&Pe.pdt!==null&&(ge=Pe.pdt),ge};if(E.exists()){var ve=function(Pe,ge){return Z.emit(q,Pe,ge)},Ee=function(Pe,ge){var Ae=ge.levels,ye=ge.audioTracks,Re=ge.url,ze=ge.stats,We=ge.networkDetails,Pt=ge.sessionData,Rt={},Vt={};Ae.forEach(function(zt,gi){Rt[gi]={width:zt.width,height:zt.height,bitrate:zt.bitrate,attrs:zt.attrs}}),ye.forEach(function(zt,gi){Vt[gi]={name:zt.name,language:zt.lang,bitrate:zt.bitrate}});var $t=D(ze),Yt=$t.bytesLoaded,gt=$t.requestStart,Ia=$t.responseStart,Ra=$t.responseEnd;ve("requestcompleted",y(y({},f(Pt)),{},{request_event_type:Pe,request_bytes_loaded:Yt,request_start:gt,request_response_start:Ia,request_response_end:Ra,request_type:"manifest",request_hostname:o(Re),request_response_headers:P(We),request_rendition_lists:{media:Rt,audio:Vt,video:{}}}))};Q.on(se.Events.MANIFEST_LOADED,Ee);var Ne=function(Pe,ge){var Ae=ge.details,ye=ge.level,Re=ge.networkDetails,ze=ge.stats,We=D(ze),Pt=We.bytesLoaded,Rt=We.requestStart,Vt=We.responseStart,$t=We.responseEnd,Yt=Ae.fragments[Ae.fragments.length-1],gt=Ie(Yt)+ke(Yt.duration);ve("requestcompleted",{request_event_type:Pe,request_bytes_loaded:Pt,request_start:Rt,request_response_start:Vt,request_response_end:$t,request_current_level:ye,request_type:"manifest",request_hostname:o(Ae.url),request_response_headers:P(Re),video_holdback:Ae.holdBack&&ke(Ae.holdBack),video_part_holdback:Ae.partHoldBack&&ke(Ae.partHoldBack),video_part_target_duration:Ae.partTarget&&ke(Ae.partTarget),video_target_duration:Ae.targetduration&&ke(Ae.targetduration),video_source_is_live:Ae.live,player_manifest_newest_program_time:isNaN(gt)?void 0:gt})};Q.on(se.Events.LEVEL_LOADED,Ne);var At=function(Pe,ge){var Ae=ge.details,ye=ge.networkDetails,Re=ge.stats,ze=D(Re),We=ze.bytesLoaded,Pt=ze.requestStart,Rt=ze.responseStart,Vt=ze.responseEnd;ve("requestcompleted",{request_event_type:Pe,request_bytes_loaded:We,request_start:Pt,request_response_start:Rt,request_response_end:Vt,request_type:"manifest",request_hostname:o(Ae.url),request_response_headers:P(ye)})};Q.on(se.Events.AUDIO_TRACK_LOADED,At);var Dt=function(Pe,ge){var Ae=ge.stats,ye=ge.networkDetails,Re=ge.frag;Ae=Ae||Re.stats;var ze=D(Ae),We={request_event_type:Pe,request_bytes_loaded:ze.bytesLoaded,request_start:ze.requestStart,request_response_start:ze.responseStart,request_response_end:ze.responseEnd,request_hostname:ye?o(ye.responseURL):void 0,request_response_headers:P(ye),request_media_duration:Re.duration};Re.type==="main"?(We.request_type="media",We.request_current_level=Re.level,We.request_video_width=(Q.levels[Re.level]||{}).width,We.request_video_height=(Q.levels[Re.level]||{}).height):We.request_type=Re.type,ve("requestcompleted",We)};Q.on(se.Events.FRAG_LOADED,Dt);var _r=function(Pe,ge){var Ae=ge.frag,ye=Ae.start,Re={currentFragmentPDT:Ie(Ae),currentFragmentStart:ke(ye)};ve("fragmentchange",Re)};Q.on(se.Events.FRAG_CHANGED,_r);var Be=function(Pe,ge){var Ae=ge.type,ye=ge.details,Re=ge.response,ze=ge.fatal,We=ge.context,Pt=ge.frag;if(ye===se.ErrorDetails.MANIFEST_LOAD_ERROR||ye===se.ErrorDetails.MANIFEST_LOAD_TIMEOUT||ye===se.ErrorDetails.FRAG_LOAD_ERROR||ye===se.ErrorDetails.FRAG_LOAD_TIMEOUT||ye===se.ErrorDetails.LEVEL_LOAD_ERROR||ye===se.ErrorDetails.LEVEL_LOAD_TIMEOUT){var Rt=Pt&&Pt.url||We&&We.url||"";ve("requestfailed",{request_error:ye,request_url:Rt,request_hostname:o(Rt),request_type:ye===se.ErrorDetails.FRAG_LOAD_ERROR||ye===se.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":"manifest",request_error_code:Re&&Re.code,request_error_text:Re&&Re.text})}ze&&ve("error",{player_error_code:Ae,player_error_message:ye})};Q.on(se.Events.ERROR,Be);var It=function(Pe,ge){var Ae=ge.frag,ye=Ae&&Ae._url||"";ve("requestcanceled",{request_event_type:Pe,request_url:ye,request_type:"media",request_hostname:o(ye)})};Q.on(se.Events.FRAG_LOAD_EMERGENCY_ABORTED,It);var mt=function(Pe,ge){var Ae=ge.level,ye=Q.levels[Ae];if(ye&&ye.attrs&&ye.attrs.BANDWIDTH){var Re,ze=ye.attrs.BANDWIDTH,We=parseFloat(ye.attrs["FRAME-RATE"]);isNaN(We)||(Re=We),ze?ve("renditionchange",{video_source_fps:Re,video_source_bitrate:ze,video_source_width:ye.width,video_source_height:ye.height}):Te.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};Q.on(se.Events.LEVEL_SWITCHED,mt),Q._stopMuxMonitor=function(){Q.off(se.Events.MANIFEST_LOADED,Ee),Q.off(se.Events.LEVEL_LOADED,Ne),Q.off(se.Events.AUDIO_TRACK_LOADED,At),Q.off(se.Events.FRAG_LOADED,Dt),Q.off(se.Events.FRAG_CHANGED,_r),Q.off(se.Events.ERROR,Be),Q.off(se.Events.FRAG_LOAD_EMERGENCY_ABORTED,It),Q.off(se.Events.LEVEL_SWITCHED,mt),Q.off(se.Events.DESTROYING,Q._stopMuxMonitor),delete Q._stopMuxMonitor},Q.on(se.Events.DESTROYING,Q._stopMuxMonitor)}else Te.warn("performance timing not supported. Not tracking HLS.js.")}(this.mux,this.id,Y.hlsjs,{},Y.Hls||window.Hls)):this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.")}},{key:"removeHLSJS",value:function(){var Y;this.hlsjs&&((Y=this.hlsjs)&&typeof Y._stopMuxMonitor=="function"&&Y._stopMuxMonitor(),this.hlsjs=void 0)}},{key:"addDashJS",value:function(Y){Y.dashjs?this.dashjs?this.mux.log.warn("An instance of Dash.js is already being monitored for this player."):(this.dashjs=Y.dashjs,function(Z,q,Q){var se=Z.log;if(Q&&Q.on){var Te=function(Be,It){return Z.emit(q,Be,It)},ke=function(Be){var It=Be.type,mt=(Be.data||{}).url;Te("requestcompleted",{request_event_type:It,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:o(mt)})};Q.on("manifestLoaded",ke);var Ie={},ve=function(Be){var It=Be.type,mt=Be.fragmentModel,Pe=(Be.chunk||{}).mediaInfo||{},ge=Pe.type,Ae=Pe.bitrateList,ye={};(Ae=Ae||[]).forEach(function(Yt,gt){ye[gt]={},ye[gt].width=Yt.width,ye[gt].height=Yt.height,ye[gt].bitrate=Yt.bandwidth,ye[gt].attrs={}}),ge==="video"?Ie.video=ye:ge==="audio"?Ie.audio=ye:Ie.media=ye;var Re=N(mt,Q),ze=Re.requestStart,We=Re.requestResponseStart,Pt=Re.requestResponseEnd,Rt=Re.requestResponseHeaders,Vt=Re.requestMediaDuration,$t=Re.requestHostname;Te("requestcompleted",{request_event_type:It,request_start:ze,request_response_start:We,request_response_end:Pt,request_bytes_loaded:-1,request_type:ge+"_init",request_response_headers:Rt,request_hostname:$t,request_media_duration:Vt,request_rendition_lists:Ie})};Q.on("initFragmentLoaded",ve);var Ee=function(Be){var It=Be.type,mt=Be.fragmentModel,Pe=Be.chunk||{},ge=Pe.mediaInfo,Ae=Pe.start,ye=(ge||{}).type,Re=N(mt,Q),ze=Re.requestStart,We=Re.requestResponseStart,Pt=Re.requestResponseEnd,Rt=Re.requestBytesLoaded,Vt=Re.requestResponseHeaders,$t=Re.requestMediaDuration,Yt=Re.requestHostname,gt=B(ye,Q),Ia=gt.currentLevel,Ra=gt.renditionWidth,zt=gt.renditionHeight,gi=gt.renditionBitrate;Te("requestcompleted",{request_event_type:It,request_start:ze,request_response_start:We,request_response_end:Pt,request_bytes_loaded:Rt,request_type:ye,request_response_headers:Vt,request_hostname:Yt,request_media_start_time:Ae,request_media_duration:$t,request_current_level:Ia,request_labeled_bitrate:gi,request_video_width:Ra,request_video_height:zt})};Q.on("mediaFragmentLoaded",Ee);var Ne={video:void 0,audio:void 0,totalBitrate:void 0},At=function(){if(Ne.video&&typeof Ne.video.bitrate=="number"){if(Ne.video.width&&Ne.video.height){var Be=Ne.video.bitrate;return Ne.audio&&typeof Ne.audio.bitrate=="number"&&(Be+=Ne.audio.bitrate),Be!==Ne.totalBitrate?(Ne.totalBitrate=Be,{video_source_bitrate:Be,video_source_height:Ne.video.height,video_source_width:Ne.video.width}):void 0}se.warn("have bitrate info for video but missing width/height")}},Dt=function(Be,It,mt){if(typeof Be.newQuality=="number"){var Pe=Be.mediaType;if(Pe==="audio"||Pe==="video"){var ge=Q.getBitrateInfoListFor(Pe).find(function(ye){return ye.qualityIndex===Be.newQuality});if(ge&&typeof ge.bitrate=="number"){Ne[Pe]=ge;var Ae=At();Ae&&Te("renditionchange",Ae)}else se.warn("missing bitrate info for ".concat(Pe))}}else se.warn("missing evt.newQuality in qualityChangeRendered event",Be)};Q.on("qualityChangeRendered",Dt);var _r=function(Be){var It=Be.error,mt=Be.event,Pe=(mt=mt||{}).request||{},ge=L().event&&L().event.currentTarget||{};Te("requestfailed",{request_error:It+"_"+mt.id+"_"+Pe.type,request_url:mt.url,request_hostname:o(mt.url),request_type:Pe.mediaType,request_error_code:ge.status,request_error_type:ge.statusText})};Q.on("error",_r),Q._stopMuxMonitor=function(){Q.off("manifestLoaded",ke),Q.off("initFragmentLoaded",ve),Q.off("mediaFragmentLoaded",Ee),Q.off("qualityChangeRendered",Dt),Q.off("error",_r),delete Q._stopMuxMonitor}}else se.warn("Invalid dash.js player reference. Monitoring blocked.")}(this.mux,this.id,Y.dashjs)):this.mux.log.warn("You must pass a valid dashjs instance in order to track it.")}},{key:"removeDashJS",value:function(){var Y;this.dashjs&&((Y=this.dashjs)&&typeof Y._stopMuxMonitor=="function"&&Y._stopMuxMonitor(),this.dashjs=void 0)}}],w&&lo(k.prototype,w),K&&lo(k,K),Object.defineProperty(k,"prototype",{writable:!1}),z}(X),nd=id,ad=C(153),vi=C.n(ad);function xa(U){return xa=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},xa(U)}function uo(U,k){return function(w){if(Array.isArray(w))return w}(U)||function(w,K){var W=w==null?null:typeof Symbol!="undefined"&&w[Symbol.iterator]||w["@@iterator"];if(W!=null){var z,Y,Z=[],q=!0,Q=!1;try{for(W=W.call(w);!(q=(z=W.next()).done)&&(Z.push(z.value),!K||Z.length!==K);q=!0);}catch(se){Q=!0,Y=se}finally{try{q||W.return==null||W.return()}finally{if(Q)throw Y}}return Z}}(U,k)||function(w,K){if(w){if(typeof w=="string")return co(w,K);var W=Object.prototype.toString.call(w).slice(8,-1);return W==="Object"&&w.constructor&&(W=w.constructor.name),W==="Map"||W==="Set"?Array.from(w):W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W)?co(w,K):void 0}}(U,k)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function co(U,k){(k==null||k>U.length)&&(k=U.length);for(var w=0,K=new Array(k);w<k;w++)K[w]=U[w];return K}var Kr,sd=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],od={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"};L()&&L().WeakMap&&(Kr=new WeakMap);var ld="#EXT-X-TARGETDURATION",ud="#EXT-X-PART-INF",dd="#EXT-X-SERVER-CONTROL",cd="#EXTINF",fd="#EXT-X-PROGRAM-DATE-TIME",hd="#EXT-X-VERSION",vd="#EXT-X-SESSION-DATA",nn=function(U){return this.buffer="",this.manifest={segments:[],serverControl:{},sessionData:{}},this.currentUri={},this.process(U),this.manifest};nn.prototype.process=function(U){var k;for(this.buffer+=U,k=this.buffer.indexOf(`
`);k>-1;k=this.buffer.indexOf(`
`))this.processLine(this.buffer.substring(0,k)),this.buffer=this.buffer.substring(k+1)},nn.prototype.processLine=function(U){var k=U.indexOf(":"),w=Ed(U,k),K=w[0],W=w.length===2?Da(w[1]):void 0;if(K[0]!=="#")this.currentUri.uri=K,this.manifest.segments.push(this.currentUri),this.manifest.targetDuration&&!("duration"in this.currentUri)&&(this.currentUri.duration=this.manifest.targetDuration),this.currentUri={};else switch(K){case ld:if(!isFinite(W)||W<0)return;this.manifest.targetDuration=W,this.setHoldBack();break;case ud:La(this.manifest,w),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),this.setHoldBack();break;case dd:La(this.manifest,w),this.setHoldBack();break;case cd:W===0?this.currentUri.duration=.01:W>0&&(this.currentUri.duration=W);break;case fd:var z=W,Y=new Date(z);this.manifest.dateTimeString||(this.manifest.dateTimeString=z,this.manifest.dateTimeObject=Y),this.currentUri.dateTimeString=z,this.currentUri.dateTimeObject=Y;break;case hd:La(this.manifest,w);break;case vd:var Z=yd(w[1]),q=f(Z);l()(this.manifest.sessionData,q)}},nn.prototype.setHoldBack=function(){var U=this.manifest,k=U.serverControl,w=U.targetDuration,K=U.partTargetDuration;if(k){var W="holdBack",z="partHoldBack",Y=w&&3*w,Z=K&&2*K;w&&!k.hasOwnProperty(W)&&(k[W]=Y),Y&&k[W]<Y&&(k[W]=Y),K&&!k.hasOwnProperty(z)&&(k[z]=3*K),K&&k[z]<Z&&(k[z]=Z)}};var La=function(U,k){var w,K=fo(k[0].replace("#EXT-X-",""));pd(k[1])?(w={},w=l()(gd(k[1]),w)):w=Da(k[1]),U[K]=w},fo=function(U){return U.toLowerCase().replace(/-(\w)/g,function(k){return k[1].toUpperCase()})},Da=function(U){if(U.toLowerCase()==="yes"||U.toLowerCase()==="no")return U.toLowerCase()==="yes";var k=U.indexOf(":")!==-1?U:parseFloat(U);return isNaN(k)?U:k},md=function(U){var k={},w=U.split("=");return w.length>1&&(k[fo(w[0])]=Da(w[1])),k},gd=function(U){for(var k=U.split(","),w={},K=0;k.length>K;K++){var W=k[K],z=md(W);w=l()(z,w)}return w},pd=function(U){return U.indexOf("=")>-1},Ed=function(U,k){return k===-1?[U]:[U.substring(0,k),U.substring(k+1)]},yd=function(U){var k={};if(U){var w=U.search(",");return[U.slice(0,w),U.slice(w+1)].forEach(function(K,W){for(var z=K.replace(/['"]+/g,"").split("="),Y=0;Y<z.length;Y++)z[Y]==="DATA-ID"&&(k["DATA-ID"]=z[1-Y]),z[Y]==="VALUE"&&(k.VALUE=z[1-Y])}),{data:k}}},Td=nn,bd={safeCall:function(U,k,w,K){var W=K;if(U&&typeof U[k]=="function")try{W=U[k].apply(U,w)}catch(z){i.info("safeCall error",z)}return W},safeIncrement:s,getComputedStyle:function(U,k){var w;if(U&&k&&L()&&typeof L().getComputedStyle=="function")return Kr&&Kr.has(U)&&(w=Kr.get(U)),w||(w=L().getComputedStyle(U,null),Kr&&Kr.set(U,w)),w.getPropertyValue(k)},secondsToMs:function(U){return Math.floor(1e3*U)},assign:l(),headersStringToObject:m,extractHostnameAndDomain:h,extractHostname:o,manifestParser:Td,generateShortID:x,generateUUID:A,now:p.now},Ad={PLAYER_READY:"playerready",VIEW_INIT:"viewinit",VIDEO_CHANGE:"videochange",PLAY:"play",PAUSE:"pause",PLAYING:"playing",TIME_UPDATE:"timeupdate",SEEKING:"seeking",SEEKED:"seeked",REBUFFER_START:"rebufferstart",REBUFFER_END:"rebufferend",ERROR:"error",ENDED:"ended",RENDITION_CHANGE:"renditionchange",ORIENTATION_CHANGE:"orientationchange",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_BREAK_START:"adbreakstart",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_FIRST_QUARTILE:"adfirstquartile",AD_MID_POINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile",AD_ENDED:"adended",AD_BREAK_END:"adbreakend",AD_ERROR:"aderror",REQUEST_COMPLETED:"requestcompleted",REQUEST_FAILED:"requestfailed",REQUEST_CANCELLED:"requestcanceled"};function _d(U,k){return function(w){if(Array.isArray(w))return w}(U)||function(w,K){var W=w==null?null:typeof Symbol!="undefined"&&w[Symbol.iterator]||w["@@iterator"];if(W!=null){var z,Y,Z=[],q=!0,Q=!1;try{for(W=W.call(w);!(q=(z=W.next()).done)&&(Z.push(z.value),!K||Z.length!==K);q=!0);}catch(se){Q=!0,Y=se}finally{try{q||W.return==null||W.return()}finally{if(Q)throw Y}}return Z}}(U,k)||function(w,K){if(w){if(typeof w=="string")return ho(w,K);var W=Object.prototype.toString.call(w).slice(8,-1);return W==="Object"&&w.constructor&&(W=w.constructor.name),W==="Map"||W==="Set"?Array.from(w):W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W)?ho(w,K):void 0}}(U,k)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function ho(U,k){(k==null||k>U.length)&&(k=U.length);for(var w=0,K=new Array(k);w<k;w++)K[w]=U[w];return K}var Ot={},mi=function U(k){var w=arguments;typeof k=="string"?U.hasOwnProperty(k)?L().setTimeout(function(){w=Array.prototype.splice.call(w,1),U[k].apply(null,w)},0):i.warn("`"+k+"` is an unknown task"):typeof k=="function"?L().setTimeout(function(){k(U)},0):i.warn("`"+k+"` is invalid.")},Sd={loaded:p.now(),NAME:"mux-embed",VERSION:"4.14.0",API_VERSION:"2.1",PLAYER_TRACKED:!1,monitor:function(U,k){return function(w,K,W){var z=uo(_(K),3),Y=z[0],Z=z[1],q=z[2],Q=w.log,se=w.utils.getComputedStyle,Te=w.utils.secondsToMs;if(!Y)return Q.error("No element was found with the `"+Z+"` query selector.");if(q!=="video"&&q!=="audio")return Q.error("The element of `"+Z+"` was not a media element.");Y.mux&&(Y.mux.destroy(),delete Y.mux,Q.warn("Already monitoring this video element, replacing existing event listeners")),(W=l()({automaticErrorTracking:!0},W)).data=l()({player_software:"HTML5 Video Element",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:w.VERSION},W.data),W.getPlayheadTime=function(){return Te(Y.currentTime)},W.getStateData=function(){var Ie=this.hlsjs&&this.hlsjs.url,ve=this.dashjs&&xa(this.dashjs.getSource==="function")&&this.dashjs.getSource(),Ee={player_is_paused:Y.paused,player_playhead_time:Te(Y.currentTime),player_width:parseInt(se(Y,"width")),player_height:parseInt(se(Y,"height")),player_autoplay_on:Y.autoplay,player_preload_on:Y.preload,player_language_code:Y.lang,player_is_fullscreen:vi()&&!!(vi().fullscreenElement||vi().webkitFullscreenElement||vi().mozFullScreenElement||vi().msFullscreenElement),video_poster_url:Y.poster,video_source_url:Ie||ve||Y.currentSrc,video_source_duration:Te(Y.duration),video_source_height:Y.videoHeight,video_source_width:Y.videoWidth},Ne=W.getPlayheadTime();if(Y.getStartDate&&Ne>0){var At=Y.getStartDate();if(At&&typeof At.getTime=="function"&&At.getTime()){var Dt=At.getTime();if(Ee.player_program_time=Dt+Ne,Y.seekable.length>0){var _r=Dt+Y.seekable.end(Y.seekable.length-1);Ee.player_live_edge_program_time=_r}}}return Ee},Y.mux=Y.mux||{},Y.mux.deleted=!1,Y.mux.emit=function(Ie,ve){w.emit(Z,Ie,ve)};var ke=function(){Q.error("The monitor for this video element has already been destroyed.")};Y.mux.destroy=function(){Object.keys(Y.mux.listeners).forEach(function(Ie){Y.removeEventListener(Ie,Y.mux.listeners[Ie],!1)}),delete Y.mux.listeners,Y.mux.destroy=ke,Y.mux.swapElement=ke,Y.mux.emit=ke,Y.mux.addHLSJS=ke,Y.mux.addDashJS=ke,Y.mux.removeHLSJS=ke,Y.mux.removeDashJS=ke,Y.mux.deleted=!0,w.emit(Z,"destroy")},Y.mux.swapElement=function(Ie){var ve=uo(_(Ie),3),Ee=ve[0],Ne=ve[1],At=ve[2];return Ee?At!=="video"&&At!=="audio"?w.log.error("The element of `"+Ne+"` was not a media element."):(Ee.muxId=Y.muxId,delete Y.muxId,Ee.mux=Ee.mux||{},Ee.mux.listeners=l()({},Y.mux.listeners),delete Y.mux.listeners,Object.keys(Ee.mux.listeners).forEach(function(Dt){Y.removeEventListener(Dt,Ee.mux.listeners[Dt],!1),Ee.addEventListener(Dt,Ee.mux.listeners[Dt],!1)}),Ee.mux.swapElement=Y.mux.swapElement,Ee.mux.destroy=Y.mux.destroy,delete Y.mux,void(Y=Ee)):w.log.error("No element was found with the `"+Ne+"` query selector.")},Y.mux.addHLSJS=function(Ie){w.addHLSJS(Z,Ie)},Y.mux.addDashJS=function(Ie){w.addDashJS(Z,Ie)},Y.mux.removeHLSJS=function(){w.removeHLSJS(Z)},Y.mux.removeDashJS=function(){w.removeDashJS(Z)},w.init(Z,W),w.emit(Z,"playerready"),Y.paused||(w.emit(Z,"play"),Y.readyState>2&&w.emit(Z,"playing")),Y.mux.listeners={},sd.forEach(function(Ie){(Ie!=="error"||W.automaticErrorTracking)&&(Y.mux.listeners[Ie]=function(){var ve={};if(Ie==="error"){if(!Y.error||Y.error.code===1)return;ve.player_error_code=Y.error.code,ve.player_error_message=od[Y.error.code]||Y.error.message}w.emit(Z,Ie,ve)},Y.addEventListener(Ie,Y.mux.listeners[Ie],!1))})}(mi,U,k)},destroyMonitor:function(U){var k=_d(_(U),1)[0];k&&k.mux&&typeof k.mux.destroy=="function"?k.mux.destroy():i.error("A video element monitor for `"+U+"` has not been initialized via `mux.monitor`.")},addHLSJS:function(U,k){var w=I(U);Ot[w]?Ot[w].addHLSJS(k):i.error("A monitor for `"+w+"` has not been initialized.")},addDashJS:function(U,k){var w=I(U);Ot[w]?Ot[w].addDashJS(k):i.error("A monitor for `"+w+"` has not been initialized.")},removeHLSJS:function(U){var k=I(U);Ot[k]?Ot[k].removeHLSJS():i.error("A monitor for `"+k+"` has not been initialized.")},removeDashJS:function(U){var k=I(U);Ot[k]?Ot[k].removeDashJS():i.error("A monitor for `"+k+"` has not been initialized.")},init:function(U,k){d()&&k&&k.respectDoNotTrack&&i.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var w=I(U);Ot[w]=new nd(mi,w,k)},emit:function(U,k,w){var K=I(U);Ot[K]?(Ot[K].emit(k,w),k==="destroy"&&delete Ot[K]):i.error("A monitor for `"+K+"` has not been initialized.")},checkDoNotTrack:d,log:i,utils:bd,events:Ad,WINDOW_HIDDEN:!1,WINDOW_UNLOADING:!1};Object.assign(mi,Sd),L()!==void 0&&typeof L().addEventListener=="function"&&L().addEventListener("pagehide",function(U){U.persisted||(mi.WINDOW_UNLOADING=!0)},!1);var xd=mi},655:function(u,M,C){var O,L;function A(x){return A=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},A(x);}(function(x){var I=!1;if((L=typeof(O=x)=="function"?O.call(M,C,M,u):O)===void 0||(u.exports=L),I=!0,A(M)==="object"&&(u.exports=x(),I=!0),!I){var _=window.Cookies,b=window.Cookies=x();b.noConflict=function(){return window.Cookies=_,b}}})(function(){var x=function(){for(var I=0,_={};I<arguments.length;I++){var b=arguments[I];for(var S in b)_[S]=b[S]}return _};return function I(_){function b(S,v,i){var d;if(typeof document!="undefined"){if(arguments.length>1){if(typeof(i=x({path:"/"},b.defaults,i)).expires=="number"){var p=new Date;p.setMilliseconds(p.getMilliseconds()+864e5*i.expires),i.expires=p}try{d=JSON.stringify(v),/^[\{\[]/.test(d)&&(v=d)}catch{}return v=_.write?_.write(v,S):encodeURIComponent(String(v)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),S=(S=(S=encodeURIComponent(String(S))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[S,"=",v,i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}S||(d={});for(var T=document.cookie?document.cookie.split("; "):[],l=/(%[0-9A-Z]{2})+/g,o=0;o<T.length;o++){var h=T[o].split("="),E=h.slice(1).join("=");E.charAt(0)==='"'&&(E=E.slice(1,-1));try{var s=h[0].replace(l,decodeURIComponent);if(E=_.read?_.read(E,s):_(E,s)||E.replace(l,decodeURIComponent),this.json)try{E=JSON.parse(E)}catch{}if(S===s){d=E;break}S||(d[s]=E)}catch{}}return d}}return b.set=b,b.get=function(S){return b.call(b,S)},b.getJSON=function(){return b.apply({json:!0},[].slice.call(arguments))},b.defaults={},b.remove=function(S,v){b(S,"",x(v,{expires:-1}))},b.withConverter=I,b}(function(){})})},153:function(u,M,C){var O,L=C.g!==void 0?C.g:typeof window!="undefined"?window:{},A=C(558);typeof document!="undefined"?O=document:(O=L["__GLOBAL_DOCUMENT_CACHE@4"])||(O=L["__GLOBAL_DOCUMENT_CACHE@4"]=A),u.exports=O},48:function(u,M,C){var O;O=typeof window!="undefined"?window:C.g!==void 0?C.g:typeof self!="undefined"?self:{},u.exports=O},678:function(u){var M=9007199254740991,C="[object Arguments]",O="[object Function]",L="[object GeneratorFunction]",A=/^(?:0|[1-9]\d*)$/;function x(R,D,P){switch(P.length){case 0:return R.call(D);case 1:return R.call(D,P[0]);case 2:return R.call(D,P[0],P[1]);case 3:return R.call(D,P[0],P[1],P[2])}return R.apply(D,P)}var I,_,b=Object.prototype,S=b.hasOwnProperty,v=b.toString,i=b.propertyIsEnumerable,d=(I=Object.keys,_=Object,function(R){return I(_(R))}),p=Math.max,T=!i.call({valueOf:1},"valueOf");function l(R,D){var P=c(R)||function(H){return function(j){return function(X){return!!X&&typeof X=="object"}(j)&&m(j)}(H)&&S.call(H,"callee")&&(!i.call(H,"callee")||v.call(H)==C)}(R)?function(H,j){for(var X=-1,$=Array(H);++X<H;)$[X]=j(X);return $}(R.length,String):[],N=P.length,B=!!N;for(var F in R)!D&&!S.call(R,F)||B&&(F=="length"||h(F,N))||P.push(F);return P}function o(R,D,P){var N=R[D];S.call(R,D)&&s(N,P)&&(P!==void 0||D in R)||(R[D]=P)}function h(R,D){return!!(D=D==null?M:D)&&(typeof R=="number"||A.test(R))&&R>-1&&R%1==0&&R<D}function E(R){var D=R&&R.constructor;return R===(typeof D=="function"&&D.prototype||b)}function s(R,D){return R===D||R!=R&&D!=D}var c=Array.isArray;function m(R){return R!=null&&function(D){return typeof D=="number"&&D>-1&&D%1==0&&D<=M}(R.length)&&!function(D){var P=f(D)?v.call(D):"";return P==O||P==L}(R)}function f(R){var D=typeof R;return!!R&&(D=="object"||D=="function")}var g,y=(g=function(R,D){if(T||E(D)||m(D))(function(N,B,F,H){F||(F={});for(var j=-1,X=B.length;++j<X;){var $=B[j],G=H?H(F[$],N[$],$,F,N):void 0;o(F,$,G===void 0?N[$]:G)}})(D,function(N){return m(N)?l(N):function(B){if(!E(B))return d(B);var F=[];for(var H in Object(B))S.call(B,H)&&H!="constructor"&&F.push(H);return F}(N)}(D),R);else for(var P in D)S.call(D,P)&&o(R,P,D[P])},function(R,D){return D=p(D===void 0?R.length-1:D,0),function(){for(var P=arguments,N=-1,B=p(P.length-D,0),F=Array(B);++N<B;)F[N]=P[D+N];N=-1;for(var H=Array(D+1);++N<D;)H[N]=P[N];return H[D]=F,x(R,this,H)}}(function(R,D){var P=-1,N=D.length,B=N>1?D[N-1]:void 0,F=N>2?D[2]:void 0;for(B=g.length>3&&typeof B=="function"?(N--,B):void 0,F&&function(j,X,$){if(!f($))return!1;var G=typeof X;return!!(G=="number"?m($)&&h(X,$.length):G=="string"&&X in $)&&s($[X],j)}(D[0],D[1],F)&&(B=N<3?void 0:B,N=1),R=Object(R);++P<N;){var H=D[P];H&&g(R,H,P,B)}return R}));u.exports=y},640:function(u,M,C){var O,L;(function(A,x){"use strict";O=function(){var I=function(){},_="undefined",b=typeof window!==_&&typeof window.navigator!==_&&/Trident\/|MSIE /.test(window.navigator.userAgent),S=["trace","debug","info","warn","error"];function v(c,m){var f=c[m];if(typeof f.bind=="function")return f.bind(c);try{return Function.prototype.bind.call(f,c)}catch{return function(){return Function.prototype.apply.apply(f,[c,arguments])}}}function i(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function d(c){return c==="debug"&&(c="log"),typeof console!==_&&(c==="trace"&&b?i:console[c]!==void 0?v(console,c):console.log!==void 0?v(console,"log"):I)}function p(c,m){for(var f=0;f<S.length;f++){var g=S[f];this[g]=f<c?I:this.methodFactory(g,c,m)}this.log=this.debug}function T(c,m,f){return function(){typeof console!==_&&(p.call(this,m,f),this[c].apply(this,arguments))}}function l(c,m,f){return d(c)||T.apply(this,arguments)}function o(c,m,f){var g,y=this;m=m==null?"WARN":m;var R="loglevel";function D(F){var H=(S[F]||"silent").toUpperCase();if(typeof window!==_&&R){try{return void(window.localStorage[R]=H)}catch{}try{window.document.cookie=encodeURIComponent(R)+"="+H+";"}catch{}}}function P(){var F;if(typeof window!==_&&R){try{F=window.localStorage[R]}catch{}if(typeof F===_)try{var H=window.document.cookie,j=H.indexOf(encodeURIComponent(R)+"=");j!==-1&&(F=/^([^;]+)/.exec(H.slice(j))[1])}catch{}return y.levels[F]===void 0&&(F=void 0),F}}function N(){if(typeof window!==_&&R){try{return void window.localStorage.removeItem(R)}catch{}try{window.document.cookie=encodeURIComponent(R)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}typeof c=="string"?R+=":"+c:typeof c=="symbol"&&(R=void 0),y.name=c,y.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},y.methodFactory=f||l,y.getLevel=function(){return g},y.setLevel=function(F,H){if(typeof F=="string"&&y.levels[F.toUpperCase()]!==void 0&&(F=y.levels[F.toUpperCase()]),!(typeof F=="number"&&F>=0&&F<=y.levels.SILENT))throw"log.setLevel() called with invalid level: "+F;if(g=F,H!==!1&&D(F),p.call(y,F,c),typeof console===_&&F<y.levels.SILENT)return"No console available for logging"},y.setDefaultLevel=function(F){m=F,P()||y.setLevel(F,!1)},y.resetLevel=function(){y.setLevel(m,!1),N()},y.enableAll=function(F){y.setLevel(y.levels.TRACE,F)},y.disableAll=function(F){y.setLevel(y.levels.SILENT,F)};var B=P();B==null&&(B=m),y.setLevel(B,!1)}var h=new o,E={};h.getLogger=function(c){if(typeof c!="symbol"&&typeof c!="string"||c==="")throw new TypeError("You must supply a name when creating a logger.");var m=E[c];return m||(m=E[c]=new o(c,h.getLevel(),h.methodFactory)),m};var s=typeof window!==_?window.log:void 0;return h.noConflict=function(){return typeof window!==_&&window.log===h&&(window.log=s),h},h.getLoggers=function(){return E},h.default=h,h},(L=typeof O=="function"?O.call(M,C,M,u):O)===void 0||(u.exports=L)})()},375:function(u,M){"use strict";var C=Object.prototype.hasOwnProperty;function O(A){try{return decodeURIComponent(A.replace(/\+/g," "))}catch{return null}}function L(A){try{return encodeURIComponent(A)}catch{return null}}M.stringify=function(A,x){x=x||"";var I,_,b=[];for(_ in typeof x!="string"&&(x="?"),A)if(C.call(A,_)){if((I=A[_])||I!=null&&!isNaN(I)||(I=""),_=L(_),I=L(I),_===null||I===null)continue;b.push(_+"="+I)}return b.length?x+b.join("&"):""},M.parse=function(A){for(var x,I=/([^=?#&]+)=?([^&]*)/g,_={};x=I.exec(A);){var b=O(x[1]),S=O(x[2]);b===null||S===null||b in _||(_[b]=S)}return _}},558:function(){}},n={};function a(u){var M=n[u];if(M!==void 0)return M.exports;var C=n[u]={exports:{}};return e[u].call(C.exports,C,C.exports,a),C.exports}return a.n=function(u){var M=u&&u.__esModule?function(){return u.default}:function(){return u};return a.d(M,{a:M}),M},a.d=function(u,M){for(var C in M)a.o(M,C)&&!a.o(u,C)&&Object.defineProperty(u,C,{enumerable:!0,get:M[C]})},a.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),a.o=function(u,M){return Object.prototype.hasOwnProperty.call(u,M)},a(80)}()},typeof wn=="object"&&typeof Ls=="object"?Ls.exports=t():typeof wn=="object"?wn.mux=t():r.mux=t()})()});var Un=mo((Pi,Ds)=>{typeof window!="undefined"&&function(t,e){typeof Pi=="object"&&typeof Ds=="object"?Ds.exports=e():typeof define=="function"&&define.amd?define([],e):typeof Pi=="object"?Pi.Hls=e():t.Hls=e()}(Pi,function(){return function(r){var t={};function e(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return r[n].call(a.exports,a,a.exports,e),a.l=!0,a.exports}return e.m=r,e.c=t,e.d=function(n,a,u){e.o(n,a)||Object.defineProperty(n,a,{enumerable:!0,get:u})},e.r=function(n){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,a){if(a&1&&(n=e(n)),a&8||a&4&&typeof n=="object"&&n&&n.__esModule)return n;var u=Object.create(null);if(e.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:n}),a&2&&typeof n!="string")for(var M in n)e.d(u,M,function(C){return n[C]}.bind(null,M));return u},e.n=function(n){var a=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(a,"a",a),a},e.o=function(n,a){return Object.prototype.hasOwnProperty.call(n,a)},e.p="/dist/",e(e.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(r,t,e){"use strict";var n=Object.prototype.hasOwnProperty,a="~";function u(){}Object.create&&(u.prototype=Object.create(null),new u().__proto__||(a=!1));function M(A,x,I){this.fn=A,this.context=x,this.once=I||!1}function C(A,x,I,_,b){if(typeof I!="function")throw new TypeError("The listener must be a function");var S=new M(I,_||A,b),v=a?a+x:x;return A._events[v]?A._events[v].fn?A._events[v]=[A._events[v],S]:A._events[v].push(S):(A._events[v]=S,A._eventsCount++),A}function O(A,x){--A._eventsCount===0?A._events=new u:delete A._events[x]}function L(){this._events=new u,this._eventsCount=0}L.prototype.eventNames=function(){var x=[],I,_;if(this._eventsCount===0)return x;for(_ in I=this._events)n.call(I,_)&&x.push(a?_.slice(1):_);return Object.getOwnPropertySymbols?x.concat(Object.getOwnPropertySymbols(I)):x},L.prototype.listeners=function(x){var I=a?a+x:x,_=this._events[I];if(!_)return[];if(_.fn)return[_.fn];for(var b=0,S=_.length,v=new Array(S);b<S;b++)v[b]=_[b].fn;return v},L.prototype.listenerCount=function(x){var I=a?a+x:x,_=this._events[I];return _?_.fn?1:_.length:0},L.prototype.emit=function(x,I,_,b,S,v){var i=a?a+x:x;if(!this._events[i])return!1;var d=this._events[i],p=arguments.length,T,l;if(d.fn){switch(d.once&&this.removeListener(x,d.fn,void 0,!0),p){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,I),!0;case 3:return d.fn.call(d.context,I,_),!0;case 4:return d.fn.call(d.context,I,_,b),!0;case 5:return d.fn.call(d.context,I,_,b,S),!0;case 6:return d.fn.call(d.context,I,_,b,S,v),!0}for(l=1,T=new Array(p-1);l<p;l++)T[l-1]=arguments[l];d.fn.apply(d.context,T)}else{var o=d.length,h;for(l=0;l<o;l++)switch(d[l].once&&this.removeListener(x,d[l].fn,void 0,!0),p){case 1:d[l].fn.call(d[l].context);break;case 2:d[l].fn.call(d[l].context,I);break;case 3:d[l].fn.call(d[l].context,I,_);break;case 4:d[l].fn.call(d[l].context,I,_,b);break;default:if(!T)for(h=1,T=new Array(p-1);h<p;h++)T[h-1]=arguments[h];d[l].fn.apply(d[l].context,T)}}return!0},L.prototype.on=function(x,I,_){return C(this,x,I,_,!1)},L.prototype.once=function(x,I,_){return C(this,x,I,_,!0)},L.prototype.removeListener=function(x,I,_,b){var S=a?a+x:x;if(!this._events[S])return this;if(!I)return O(this,S),this;var v=this._events[S];if(v.fn)v.fn===I&&(!b||v.once)&&(!_||v.context===_)&&O(this,S);else{for(var i=0,d=[],p=v.length;i<p;i++)(v[i].fn!==I||b&&!v[i].once||_&&v[i].context!==_)&&d.push(v[i]);d.length?this._events[S]=d.length===1?d[0]:d:O(this,S)}return this},L.prototype.removeAllListeners=function(x){var I;return x?(I=a?a+x:x,this._events[I]&&O(this,I)):(this._events=new u,this._eventsCount=0),this},L.prototype.off=L.prototype.removeListener,L.prototype.addListener=L.prototype.on,L.prefixed=a,L.EventEmitter=L,r.exports=L},"./node_modules/url-toolkit/src/url-toolkit.js":function(r,t,e){(function(n){var a=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,u=/^(?=([^\/?#]*))\1([^]*)$/,M=/(?:\/|^)\.(?=\/)/g,C=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,O={buildAbsoluteURL:function(L,A,x){if(x=x||{},L=L.trim(),A=A.trim(),!A){if(!x.alwaysNormalize)return L;var I=O.parseURL(L);if(!I)throw new Error("Error trying to parse base URL.");return I.path=O.normalizePath(I.path),O.buildURLFromParts(I)}var _=O.parseURL(A);if(!_)throw new Error("Error trying to parse relative URL.");if(_.scheme)return x.alwaysNormalize?(_.path=O.normalizePath(_.path),O.buildURLFromParts(_)):A;var b=O.parseURL(L);if(!b)throw new Error("Error trying to parse base URL.");if(!b.netLoc&&b.path&&b.path[0]!=="/"){var S=u.exec(b.path);b.netLoc=S[1],b.path=S[2]}b.netLoc&&!b.path&&(b.path="/");var v={scheme:b.scheme,netLoc:_.netLoc,path:null,params:_.params,query:_.query,fragment:_.fragment};if(!_.netLoc&&(v.netLoc=b.netLoc,_.path[0]!=="/"))if(!_.path)v.path=b.path,_.params||(v.params=b.params,_.query||(v.query=b.query));else{var i=b.path,d=i.substring(0,i.lastIndexOf("/")+1)+_.path;v.path=O.normalizePath(d)}return v.path===null&&(v.path=x.alwaysNormalize?O.normalizePath(_.path):_.path),O.buildURLFromParts(v)},parseURL:function(L){var A=a.exec(L);return A?{scheme:A[1]||"",netLoc:A[2]||"",path:A[3]||"",params:A[4]||"",query:A[5]||"",fragment:A[6]||""}:null},normalizePath:function(L){for(L=L.split("").reverse().join("").replace(M,"");L.length!==(L=L.replace(C,"")).length;);return L.split("").reverse().join("")},buildURLFromParts:function(L){return L.scheme+L.netLoc+L.path+L.params+L.query+L.fragment}};r.exports=O})(this)},"./node_modules/webworkify-webpack/index.js":function(r,t,e){function n(x){var I={};function _(S){if(I[S])return I[S].exports;var v=I[S]={i:S,l:!1,exports:{}};return x[S].call(v.exports,v,v.exports,_),v.l=!0,v.exports}_.m=x,_.c=I,_.i=function(S){return S},_.d=function(S,v,i){_.o(S,v)||Object.defineProperty(S,v,{configurable:!1,enumerable:!0,get:i})},_.r=function(S){Object.defineProperty(S,"__esModule",{value:!0})},_.n=function(S){var v=S&&S.__esModule?function(){return S.default}:function(){return S};return _.d(v,"a",v),v},_.o=function(S,v){return Object.prototype.hasOwnProperty.call(S,v)},_.p="/",_.oe=function(S){throw console.error(S),S};var b=_(_.s=ENTRY_MODULE);return b.default||b}var a="[\\.|\\-|\\+|\\w|/|@]+",u="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+a+").*?\\)";function M(x){return(x+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function C(x){return!isNaN(1*x)}function O(x,I,_){var b={};b[_]=[];var S=I.toString(),v=S.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!v)return b;for(var i=v[1],d=new RegExp("(\\\\n|\\W)"+M(i)+u,"g"),p;p=d.exec(S);)p[3]!=="dll-reference"&&b[_].push(p[3]);for(d=new RegExp("\\("+M(i)+'\\("(dll-reference\\s('+a+'))"\\)\\)'+u,"g");p=d.exec(S);)x[p[2]]||(b[_].push(p[1]),x[p[2]]=e(p[1]).m),b[p[2]]=b[p[2]]||[],b[p[2]].push(p[4]);for(var T=Object.keys(b),l=0;l<T.length;l++)for(var o=0;o<b[T[l]].length;o++)C(b[T[l]][o])&&(b[T[l]][o]=1*b[T[l]][o]);return b}function L(x){var I=Object.keys(x);return I.reduce(function(_,b){return _||x[b].length>0},!1)}function A(x,I){for(var _={main:[I]},b={main:[]},S={main:{}};L(_);)for(var v=Object.keys(_),i=0;i<v.length;i++){var d=v[i],p=_[d],T=p.pop();if(S[d]=S[d]||{},!(S[d][T]||!x[d][T])){S[d][T]=!0,b[d]=b[d]||[],b[d].push(T);for(var l=O(x,x[d][T],d),o=Object.keys(l),h=0;h<o.length;h++)_[o[h]]=_[o[h]]||[],_[o[h]]=_[o[h]].concat(l[o[h]])}}return b}r.exports=function(x,I){I=I||{};var _={main:e.m},b=I.all?{main:Object.keys(_.main)}:A(_,x),S="";Object.keys(b).filter(function(T){return T!=="main"}).forEach(function(T){for(var l=0;b[T][l];)l++;b[T].push(l),_[T][l]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",S=S+"var "+T+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(l))+")({"+b[T].map(function(o){return""+JSON.stringify(o)+": "+_[T][o].toString()}).join(",")+`});
`}),S=S+"new (("+n.toString().replace("ENTRY_MODULE",JSON.stringify(x))+")({"+b.main.map(function(T){return""+JSON.stringify(T)+": "+_.main[T].toString()}).join(",")+"}))(self);";var v=new window.Blob([S],{type:"text/javascript"});if(I.bare)return v;var i=window.URL||window.webkitURL||window.mozURL||window.msURL,d=i.createObjectURL(v),p=new window.Worker(d);return p.objectURL=d,p}},"./src/config.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"hlsDefaultConfig",function(){return h}),e.d(t,"mergeConfig",function(){return s}),e.d(t,"enableStreamingMode",function(){return c});var n=e("./src/controller/abr-controller.ts"),a=e("./src/controller/audio-stream-controller.ts"),u=e("./src/controller/audio-track-controller.ts"),M=e("./src/controller/subtitle-stream-controller.ts"),C=e("./src/controller/subtitle-track-controller.ts"),O=e("./src/controller/buffer-controller.ts"),L=e("./src/controller/timeline-controller.ts"),A=e("./src/controller/cap-level-controller.ts"),x=e("./src/controller/fps-controller.ts"),I=e("./src/controller/eme-controller.ts"),_=e("./src/controller/cmcd-controller.ts"),b=e("./src/utils/xhr-loader.ts"),S=e("./src/utils/fetch-loader.ts"),v=e("./src/utils/cues.ts"),i=e("./src/utils/mediakeys-helper.ts"),d=e("./src/utils/logger.ts");function p(){return p=Object.assign?Object.assign.bind():function(m){for(var f=1;f<arguments.length;f++){var g=arguments[f];for(var y in g)Object.prototype.hasOwnProperty.call(g,y)&&(m[y]=g[y])}return m},p.apply(this,arguments)}function T(m,f){var g=Object.keys(m);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(m);f&&(y=y.filter(function(R){return Object.getOwnPropertyDescriptor(m,R).enumerable})),g.push.apply(g,y)}return g}function l(m){for(var f=1;f<arguments.length;f++){var g=arguments[f]!=null?arguments[f]:{};f%2?T(Object(g),!0).forEach(function(y){o(m,y,g[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(g)):T(Object(g)).forEach(function(y){Object.defineProperty(m,y,Object.getOwnPropertyDescriptor(g,y))})}return m}function o(m,f,g){return f in m?Object.defineProperty(m,f,{value:g,enumerable:!0,configurable:!0,writable:!0}):m[f]=g,m}var h=l(l({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:b.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:n.default,bufferController:O.default,capLevelController:A.default,fpsController:x.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:i.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},E()),{},{subtitleStreamController:M.SubtitleStreamController,subtitleTrackController:C.default,timelineController:L.TimelineController,audioStreamController:a.default,audioTrackController:u.default,emeController:I.default,cmcdController:_.default});function E(){return{cueHandler:v.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function s(m,f){if((f.liveSyncDurationCount||f.liveMaxLatencyDurationCount)&&(f.liveSyncDuration||f.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(f.liveMaxLatencyDurationCount!==void 0&&(f.liveSyncDurationCount===void 0||f.liveMaxLatencyDurationCount<=f.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(f.liveMaxLatencyDuration!==void 0&&(f.liveSyncDuration===void 0||f.liveMaxLatencyDuration<=f.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return p({},m,f)}function c(m){var f=m.loader;if(f!==S.default&&f!==b.default)d.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),m.progressive=!1;else{var g=Object(S.fetchSupported)();g&&(m.loader=S.default,m.progressive=!0,m.enableSoftwareAES=!0,d.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(r,t,e){"use strict";e.r(t);var n=e("./src/polyfills/number.ts"),a=e("./src/utils/ewma-bandwidth-estimator.ts"),u=e("./src/events.ts"),M=e("./src/utils/buffer-helper.ts"),C=e("./src/errors.ts"),O=e("./src/types/loader.ts"),L=e("./src/utils/logger.ts");function A(_,b){for(var S=0;S<b.length;S++){var v=b[S];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(_,v.key,v)}}function x(_,b,S){return b&&A(_.prototype,b),S&&A(_,S),Object.defineProperty(_,"prototype",{writable:!1}),_}var I=function(){function _(S){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=S;var v=S.config;this.bwEstimator=new a.default(v.abrEwmaSlowVoD,v.abrEwmaFastVoD,v.abrEwmaDefaultEstimate),this.registerListeners()}var b=_.prototype;return b.registerListeners=function(){var v=this.hls;v.on(u.Events.FRAG_LOADING,this.onFragLoading,this),v.on(u.Events.FRAG_LOADED,this.onFragLoaded,this),v.on(u.Events.FRAG_BUFFERED,this.onFragBuffered,this),v.on(u.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.on(u.Events.ERROR,this.onError,this)},b.unregisterListeners=function(){var v=this.hls;v.off(u.Events.FRAG_LOADING,this.onFragLoading,this),v.off(u.Events.FRAG_LOADED,this.onFragLoaded,this),v.off(u.Events.FRAG_BUFFERED,this.onFragBuffered,this),v.off(u.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.off(u.Events.ERROR,this.onError,this)},b.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},b.onFragLoading=function(v,i){var d=i.frag;if(d.type===O.PlaylistLevelType.MAIN&&!this.timer){var p;this.fragCurrent=d,this.partCurrent=(p=i.part)!=null?p:null,this.timer=self.setInterval(this.onCheck,100)}},b.onLevelLoaded=function(v,i){var d=this.hls.config;i.details.live?this.bwEstimator.update(d.abrEwmaSlowLive,d.abrEwmaFastLive):this.bwEstimator.update(d.abrEwmaSlowVoD,d.abrEwmaFastVoD)},b._abandonRulesCheck=function(){var v=this.fragCurrent,i=this.partCurrent,d=this.hls,p=d.autoLevelEnabled,T=d.config,l=d.media;if(!(!v||!l)){var o=i?i.stats:v.stats,h=i?i.duration:v.duration;if(o.aborted){L.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!p||l.paused||!l.playbackRate||!l.readyState)){var E=performance.now()-o.loading.start,s=Math.abs(l.playbackRate);if(!(E<=500*h/s)){var c=d.levels,m=d.minAutoLevel,f=c[v.level],g=o.total||Math.max(o.loaded,Math.round(h*f.maxBitrate/8)),y=Math.max(1,o.bwEstimate?o.bwEstimate/8:o.loaded*1e3/E),R=(g-o.loaded)/y,D=l.currentTime,P=(M.BufferHelper.bufferInfo(l,D,T.maxBufferHole).end-D)/s;if(!(P>=2*h/s||R<=P)){var N=Number.POSITIVE_INFINITY,B;for(B=v.level-1;B>m;B--){var F=c[B].maxBitrate;if(N=h*F/(8*.8*y),N<P)break}if(!(N>=R)){var H=this.bwEstimator.getEstimate();L.logger.warn("Fragment "+v.sn+(i?" part "+i.index:"")+" of level "+v.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+B+`
      Current BW estimate: `+(Object(n.isFiniteNumber)(H)?(H/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+R.toFixed(3)+` s
      Estimated load time for the next fragment: `+N.toFixed(3)+` s
      Time to underbuffer: `+P.toFixed(3)+" s"),d.nextLoadLevel=B,this.bwEstimator.sample(E,o.loaded),this.clearTimer(),v.loader&&(this.fragCurrent=this.partCurrent=null,v.loader.abort()),d.trigger(u.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:v,part:i,stats:o})}}}}}},b.onFragLoaded=function(v,i){var d=i.frag,p=i.part;if(d.type===O.PlaylistLevelType.MAIN&&Object(n.isFiniteNumber)(d.sn)){var T=p?p.stats:d.stats,l=p?p.duration:d.duration;if(this.clearTimer(),this.lastLoadedFragLevel=d.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var o=this.hls.levels[d.level],h=(o.loaded?o.loaded.bytes:0)+T.loaded,E=(o.loaded?o.loaded.duration:0)+l;o.loaded={bytes:h,duration:E},o.realBitrate=Math.round(8*h/E)}if(d.bitrateTest){var s={stats:T,frag:d,part:p,id:d.type};this.onFragBuffered(u.Events.FRAG_BUFFERED,s)}}},b.onFragBuffered=function(v,i){var d=i.frag,p=i.part,T=p?p.stats:d.stats;if(!T.aborted&&!(d.type!==O.PlaylistLevelType.MAIN||d.sn==="initSegment")){var l=T.parsing.end-T.loading.start;this.bwEstimator.sample(l,T.loaded),T.bwEstimate=this.bwEstimator.getEstimate(),d.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}},b.onError=function(v,i){switch(i.details){case C.ErrorDetails.FRAG_LOAD_ERROR:case C.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}},b.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},b.getNextABRAutoLevel=function(){var v=this.fragCurrent,i=this.partCurrent,d=this.hls,p=d.maxAutoLevel,T=d.config,l=d.minAutoLevel,o=d.media,h=i?i.duration:v?v.duration:0,E=o?o.currentTime:0,s=o&&o.playbackRate!==0?Math.abs(o.playbackRate):1,c=this.bwEstimator?this.bwEstimator.getEstimate():T.abrEwmaDefaultEstimate,m=(M.BufferHelper.bufferInfo(o,E,T.maxBufferHole).end-E)/s,f=this.findBestLevel(c,l,p,m,T.abrBandWidthFactor,T.abrBandWidthUpFactor);if(f>=0)return f;L.logger.trace((m?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var g=h?Math.min(h,T.maxStarvationDelay):T.maxStarvationDelay,y=T.abrBandWidthFactor,R=T.abrBandWidthUpFactor;if(!m){var D=this.bitrateTestDelay;if(D){var P=h?Math.min(h,T.maxLoadingDelay):T.maxLoadingDelay;g=P-D,L.logger.trace("bitrate test took "+Math.round(1e3*D)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*g)+" ms"),y=R=1}}return f=this.findBestLevel(c,l,p,m+g,y,R),Math.max(f,0)},b.findBestLevel=function(v,i,d,p,T,l){for(var o,h=this.fragCurrent,E=this.partCurrent,s=this.lastLoadedFragLevel,c=this.hls.levels,m=c[s],f=!!(m!=null&&(o=m.details)!==null&&o!==void 0&&o.live),g=m==null?void 0:m.codecSet,y=E?E.duration:h?h.duration:0,R=d;R>=i;R--){var D=c[R];if(!(!D||g&&D.codecSet!==g)){var P=D.details,N=(E?P==null?void 0:P.partTarget:P==null?void 0:P.averagetargetduration)||y,B=void 0;R<=s?B=T*v:B=l*v;var F=c[R].maxBitrate,H=F*N/B;if(L.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+R+"/"+Math.round(B)+"/"+F+"/"+N+"/"+p+"/"+H),B>F&&(!H||f&&!this.bitrateTestDelay||H<p))return R}}return-1},x(_,[{key:"nextAutoLevel",get:function(){var v=this._nextAutoLevel,i=this.bwEstimator;if(v!==-1&&!i.canEstimate())return v;var d=this.getNextABRAutoLevel();return v!==-1&&this.hls.levels[d].loadError?v:(v!==-1&&(d=Math.min(v,d)),d)},set:function(v){this._nextAutoLevel=v}}]),_}();t.default=I},"./src/controller/audio-stream-controller.ts":function(r,t,e){"use strict";e.r(t);var n=e("./src/polyfills/number.ts"),a=e("./src/controller/base-stream-controller.ts"),u=e("./src/events.ts"),M=e("./src/utils/buffer-helper.ts"),C=e("./src/controller/fragment-tracker.ts"),O=e("./src/types/level.ts"),L=e("./src/types/loader.ts"),A=e("./src/loader/fragment.ts"),x=e("./src/demux/chunk-cache.ts"),I=e("./src/demux/transmuxer-interface.ts"),_=e("./src/types/transmuxer.ts"),b=e("./src/controller/fragment-finders.ts"),S=e("./src/utils/discontinuities.ts"),v=e("./src/errors.ts");function i(){return i=Object.assign?Object.assign.bind():function(o){for(var h=1;h<arguments.length;h++){var E=arguments[h];for(var s in E)Object.prototype.hasOwnProperty.call(E,s)&&(o[s]=E[s])}return o},i.apply(this,arguments)}function d(o,h){o.prototype=Object.create(h.prototype),o.prototype.constructor=o,p(o,h)}function p(o,h){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,c){return s.__proto__=c,s},p(o,h)}var T=100,l=function(o){d(h,o);function h(s,c){var m;return m=o.call(this,s,c,"[audio-stream-controller]")||this,m.videoBuffer=null,m.videoTrackCC=-1,m.waitingVideoCC=-1,m.audioSwitch=!1,m.trackId=-1,m.waitingData=null,m.mainDetails=null,m.bufferFlushed=!1,m.cachedTrackLoadedData=null,m._registerListeners(),m}var E=h.prototype;return E.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},E._registerListeners=function(){var c=this.hls;c.on(u.Events.MEDIA_ATTACHED,this.onMediaAttached,this),c.on(u.Events.MEDIA_DETACHING,this.onMediaDetaching,this),c.on(u.Events.MANIFEST_LOADING,this.onManifestLoading,this),c.on(u.Events.LEVEL_LOADED,this.onLevelLoaded,this),c.on(u.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),c.on(u.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),c.on(u.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),c.on(u.Events.ERROR,this.onError,this),c.on(u.Events.BUFFER_RESET,this.onBufferReset,this),c.on(u.Events.BUFFER_CREATED,this.onBufferCreated,this),c.on(u.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),c.on(u.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),c.on(u.Events.FRAG_BUFFERED,this.onFragBuffered,this)},E._unregisterListeners=function(){var c=this.hls;c.off(u.Events.MEDIA_ATTACHED,this.onMediaAttached,this),c.off(u.Events.MEDIA_DETACHING,this.onMediaDetaching,this),c.off(u.Events.MANIFEST_LOADING,this.onManifestLoading,this),c.off(u.Events.LEVEL_LOADED,this.onLevelLoaded,this),c.off(u.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),c.off(u.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),c.off(u.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),c.off(u.Events.ERROR,this.onError,this),c.off(u.Events.BUFFER_RESET,this.onBufferReset,this),c.off(u.Events.BUFFER_CREATED,this.onBufferCreated,this),c.off(u.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),c.off(u.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),c.off(u.Events.FRAG_BUFFERED,this.onFragBuffered,this)},E.onInitPtsFound=function(c,m){var f=m.frag,g=m.id,y=m.initPTS;if(g==="main"){var R=f.cc;this.initPTS[f.cc]=y,this.log("InitPTS for cc: "+R+" found from main: "+y),this.videoTrackCC=R,this.state===a.State.WAITING_INIT_PTS&&this.tick()}},E.startLoad=function(c){if(!this.levels){this.startPosition=c,this.state=a.State.STOPPED;return}var m=this.lastCurrentTime;this.stopLoad(),this.setInterval(T),this.fragLoadError=0,m>0&&c===-1?(this.log("Override startPosition with lastCurrentTime @"+m.toFixed(3)),c=m,this.state=a.State.IDLE):(this.loadedmetadata=!1,this.state=a.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=c,this.tick()},E.doTick=function(){switch(this.state){case a.State.IDLE:this.doTickIdle();break;case a.State.WAITING_TRACK:{var c,m=this.levels,f=this.trackId,g=m==null||(c=m[f])===null||c===void 0?void 0:c.details;if(g){if(this.waitForCdnTuneIn(g))break;this.state=a.State.WAITING_INIT_PTS}break}case a.State.FRAG_LOADING_WAITING_RETRY:{var y,R=performance.now(),D=this.retryDate;(!D||R>=D||(y=this.media)!==null&&y!==void 0&&y.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=a.State.IDLE);break}case a.State.WAITING_INIT_PTS:{var P=this.waitingData;if(P){var N=P.frag,B=P.part,F=P.cache,H=P.complete;if(this.initPTS[N.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=a.State.FRAG_LOADING;var j=F.flush(),X={frag:N,part:B,payload:j,networkDetails:null};this._handleFragmentLoadProgress(X),H&&o.prototype._handleFragmentLoadComplete.call(this,X)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+N.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var $=this.getLoadPosition(),G=M.BufferHelper.bufferInfo(this.mediaBuffer,$,this.config.maxBufferHole),J=Object(b.fragmentWithinToleranceTest)(G.end,this.config.maxFragLookUpTolerance,N);J<0&&(this.log("Waiting fragment cc ("+N.cc+") @ "+N.start+" cancelled because another fragment at "+G.end+" is needed"),this.clearWaitingFragment())}}else this.state=a.State.IDLE}}this.onTickEnd()},E.clearWaitingFragment=function(){var c=this.waitingData;c&&(this.fragmentTracker.removeFragment(c.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=a.State.IDLE)},E.resetLoadingState=function(){this.clearWaitingFragment(),o.prototype.resetLoadingState.call(this)},E.onTickEnd=function(){var c=this.media;if(!(!c||!c.readyState)){var m=this.mediaBuffer?this.mediaBuffer:c,f=m.buffered;!this.loadedmetadata&&f.length&&(this.loadedmetadata=!0),this.lastCurrentTime=c.currentTime}},E.doTickIdle=function(){var c,m,f=this.hls,g=this.levels,y=this.media,R=this.trackId,D=f.config;if(!(!g||!g[R])&&!(!y&&(this.startFragRequested||!D.startFragPrefetch))){var P=g[R],N=P.details;if(!N||N.live&&this.levelLastLoaded!==R||this.waitForCdnTuneIn(N)){this.state=a.State.WAITING_TRACK;return}var B=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&B&&(this.bufferFlushed=!1,this.afterBufferFlushed(B,A.ElementaryStreamTypes.AUDIO,L.PlaylistLevelType.AUDIO));var F=this.getFwdBufferInfo(B,L.PlaylistLevelType.AUDIO);if(F!==null){var H=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,L.PlaylistLevelType.MAIN),j=F.len,X=this.getMaxBufferLength(H==null?void 0:H.len),$=this.audioSwitch;if(!(j>=X&&!$)){if(!$&&this._streamEnded(F,N)){f.trigger(u.Events.BUFFER_EOS,{type:"audio"}),this.state=a.State.ENDED;return}var G=N.fragments,J=G[0].start,ee=F.end;if($&&y){var te=this.getLoadPosition();ee=te,N.PTSKnown&&te<J&&(F.end>J||F.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),y.currentTime=J+.05)}if(!(H&&ee>H.end+N.targetduration)&&!((!H||!H.len)&&F.len)){var oe=this.getNextFragment(ee,N);if(!oe){this.bufferFlushed=!0;return}((c=oe.decryptdata)===null||c===void 0?void 0:c.keyFormat)==="identity"&&!((m=oe.decryptdata)!==null&&m!==void 0&&m.key)?this.loadKey(oe,N):this.loadFragment(oe,N,ee)}}}}},E.getMaxBufferLength=function(c){var m=o.prototype.getMaxBufferLength.call(this);return c?Math.max(m,c):m},E.onMediaDetaching=function(){this.videoBuffer=null,o.prototype.onMediaDetaching.call(this)},E.onAudioTracksUpdated=function(c,m){var f=m.audioTracks;this.resetTransmuxer(),this.levels=f.map(function(g){return new O.Level(g)})},E.onAudioTrackSwitching=function(c,m){var f=!!m.url;this.trackId=m.id;var g=this.fragCurrent;g!=null&&g.loader&&g.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),f?this.setInterval(T):this.resetTransmuxer(),f?(this.audioSwitch=!0,this.state=a.State.IDLE):this.state=a.State.STOPPED,this.tick()},E.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},E.onLevelLoaded=function(c,m){this.mainDetails=m.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(u.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},E.onAudioTrackLoaded=function(c,m){var f;if(this.mainDetails==null){this.cachedTrackLoadedData=m;return}var g=this.levels,y=m.details,R=m.id;if(!g){this.warn("Audio tracks were reset while loading level "+R);return}this.log("Track "+R+" loaded ["+y.startSN+","+y.endSN+"],duration:"+y.totalduration);var D=g[R],P=0;if(y.live||(f=D.details)!==null&&f!==void 0&&f.live){var N=this.mainDetails;if(y.fragments[0]||(y.deltaUpdateFailed=!0),y.deltaUpdateFailed||!N)return;!D.details&&y.hasProgramDateTime&&N.hasProgramDateTime?(Object(S.alignMediaPlaylistByPDT)(y,N),P=y.fragments[0].start):P=this.alignPlaylists(y,D.details)}D.details=y,this.levelLastLoaded=R,!this.startFragRequested&&(this.mainDetails||!y.live)&&this.setStartPosition(D.details,P),this.state===a.State.WAITING_TRACK&&!this.waitForCdnTuneIn(y)&&(this.state=a.State.IDLE),this.tick()},E._handleFragmentLoadProgress=function(c){var m,f=c.frag,g=c.part,y=c.payload,R=this.config,D=this.trackId,P=this.levels;if(!P){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+f.sn+" of level "+f.level+" will not be buffered");return}var N=P[D];console.assert(N,"Audio track is defined on fragment load progress");var B=N.details;console.assert(B,"Audio track details are defined on fragment load progress");var F=R.defaultAudioCodec||N.audioCodec||"mp4a.40.2",H=this.transmuxer;H||(H=this.transmuxer=new I.default(this.hls,L.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var j=this.initPTS[f.cc],X=(m=f.initSegment)===null||m===void 0?void 0:m.data;if(j!==void 0){var $=!1,G=g?g.index:-1,J=G!==-1,ee=new _.ChunkMetadata(f.level,f.sn,f.stats.chunkCount,y.byteLength,G,J);H.push(y,X,F,"",f,g,B.totalduration,$,ee,j)}else{this.log("Unknown video PTS for cc "+f.cc+", waiting for video PTS before demuxing audio frag "+f.sn+" of ["+B.startSN+" ,"+B.endSN+"],track "+D);var te=this.waitingData=this.waitingData||{frag:f,part:g,cache:new x.default,complete:!1},oe=te.cache;oe.push(new Uint8Array(y)),this.waitingVideoCC=this.videoTrackCC,this.state=a.State.WAITING_INIT_PTS}},E._handleFragmentLoadComplete=function(c){if(this.waitingData){this.waitingData.complete=!0;return}o.prototype._handleFragmentLoadComplete.call(this,c)},E.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},E.onBufferCreated=function(c,m){var f=m.tracks.audio;f&&(this.mediaBuffer=f.buffer||null),m.tracks.video&&(this.videoBuffer=m.tracks.video.buffer||null)},E.onFragBuffered=function(c,m){var f=m.frag,g=m.part;if(f.type===L.PlaylistLevelType.AUDIO){if(this.fragContextChanged(f)){this.warn("Fragment "+f.sn+(g?" p: "+g.index:"")+" of level "+f.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}f.sn!=="initSegment"&&(this.fragPrevious=f,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(u.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(f,g)}},E.onError=function(c,m){switch(m.details){case v.ErrorDetails.FRAG_LOAD_ERROR:case v.ErrorDetails.FRAG_LOAD_TIMEOUT:case v.ErrorDetails.KEY_LOAD_ERROR:case v.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(L.PlaylistLevelType.AUDIO,m);break;case v.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case v.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==a.State.ERROR&&this.state!==a.State.STOPPED&&(this.state=m.fatal?a.State.ERROR:a.State.IDLE,this.warn(m.details+" while loading frag, switching to "+this.state+" state"));break;case v.ErrorDetails.BUFFER_FULL_ERROR:if(m.parent==="audio"&&(this.state===a.State.PARSING||this.state===a.State.PARSED)){var f=!0,g=this.getFwdBufferInfo(this.mediaBuffer,L.PlaylistLevelType.AUDIO);g&&g.len>.5&&(f=!this.reduceMaxBufferLength(g.len)),f&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,o.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break;default:break}},E.onBufferFlushed=function(c,m){var f=m.type;f===A.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},E._handleTransmuxComplete=function(c){var m,f="audio",g=this.hls,y=c.remuxResult,R=c.chunkMeta,D=this.getCurrentContext(R);if(!D){this.warn("The loading context changed while buffering fragment "+R.sn+" of level "+R.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(R.level);return}var P=D.frag,N=D.part,B=D.level.details,F=y.audio,H=y.text,j=y.id3,X=y.initSegment;if(!(this.fragContextChanged(P)||!B)){if(this.state=a.State.PARSING,this.audioSwitch&&F&&this.completeAudioSwitch(),X!=null&&X.tracks&&(this._bufferInitSegment(X.tracks,P,R),g.trigger(u.Events.FRAG_PARSING_INIT_SEGMENT,{frag:P,id:f,tracks:X.tracks})),F){var $=F.startPTS,G=F.endPTS,J=F.startDTS,ee=F.endDTS;N&&(N.elementaryStreams[A.ElementaryStreamTypes.AUDIO]={startPTS:$,endPTS:G,startDTS:J,endDTS:ee}),P.setElementaryStreamInfo(A.ElementaryStreamTypes.AUDIO,$,G,J,ee),this.bufferFragmentData(F,P,N,R)}if(j!=null&&(m=j.samples)!==null&&m!==void 0&&m.length){var te=i({id:f,frag:P,details:B},j);g.trigger(u.Events.FRAG_PARSING_METADATA,te)}if(H){var oe=i({id:f,frag:P,details:B},H);g.trigger(u.Events.FRAG_PARSING_USERDATA,oe)}}},E._bufferInitSegment=function(c,m,f){if(this.state===a.State.PARSING){c.video&&delete c.video;var g=c.audio;if(!!g){g.levelCodec=g.codec,g.id="audio",this.log("Init audio buffer, container:"+g.container+", codecs[parsed]=["+g.codec+"]"),this.hls.trigger(u.Events.BUFFER_CODECS,c);var y=g.initSegment;if(y!=null&&y.byteLength){var R={type:"audio",frag:m,part:null,chunkMeta:f,parent:m.type,data:y};this.hls.trigger(u.Events.BUFFER_APPENDING,R)}this.tick()}}},E.loadFragment=function(c,m,f){var g=this.fragmentTracker.getState(c);this.fragCurrent=c,(this.audioSwitch||g===C.FragmentState.NOT_LOADED||g===C.FragmentState.PARTIAL)&&(c.sn==="initSegment"?this._loadInitSegment(c):m.live&&!Object(n.isFiniteNumber)(this.initPTS[c.cc])?(this.log("Waiting for video PTS in continuity counter "+c.cc+" of live stream before loading audio fragment "+c.sn+" of level "+this.trackId),this.state=a.State.WAITING_INIT_PTS):(this.startFragRequested=!0,o.prototype.loadFragment.call(this,c,m,f)))},E.completeAudioSwitch=function(){var c=this.hls,m=this.media,f=this.trackId;m&&(this.log("Switching audio track : flushing all audio"),o.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,c.trigger(u.Events.AUDIO_TRACK_SWITCHED,{id:f})},h}(a.default);t.default=l},"./src/controller/audio-track-controller.ts":function(r,t,e){"use strict";e.r(t);var n=e("./src/events.ts"),a=e("./src/errors.ts"),u=e("./src/controller/base-playlist-controller.ts"),M=e("./src/types/loader.ts");function C(I,_){for(var b=0;b<_.length;b++){var S=_[b];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(I,S.key,S)}}function O(I,_,b){return _&&C(I.prototype,_),b&&C(I,b),Object.defineProperty(I,"prototype",{writable:!1}),I}function L(I,_){I.prototype=Object.create(_.prototype),I.prototype.constructor=I,A(I,_)}function A(I,_){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(S,v){return S.__proto__=v,S},A(I,_)}var x=function(I){L(_,I);function _(S){var v;return v=I.call(this,S,"[audio-track-controller]")||this,v.tracks=[],v.groupId=null,v.tracksInGroup=[],v.trackId=-1,v.trackName="",v.selectDefaultTrack=!0,v.registerListeners(),v}var b=_.prototype;return b.registerListeners=function(){var v=this.hls;v.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),v.on(n.Events.LEVEL_LOADING,this.onLevelLoading,this),v.on(n.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),v.on(n.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),v.on(n.Events.ERROR,this.onError,this)},b.unregisterListeners=function(){var v=this.hls;v.off(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),v.off(n.Events.LEVEL_LOADING,this.onLevelLoading,this),v.off(n.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),v.off(n.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),v.off(n.Events.ERROR,this.onError,this)},b.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,I.prototype.destroy.call(this)},b.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},b.onManifestParsed=function(v,i){this.tracks=i.audioTracks||[]},b.onAudioTrackLoaded=function(v,i){var d=i.id,p=i.details,T=this.tracksInGroup[d];if(!T){this.warn("Invalid audio track id "+d);return}var l=T.details;T.details=i.details,this.log("audioTrack "+d+" loaded ["+p.startSN+"-"+p.endSN+"]"),d===this.trackId&&(this.retryCount=0,this.playlistLoaded(d,i,l))},b.onLevelLoading=function(v,i){this.switchLevel(i.level)},b.onLevelSwitching=function(v,i){this.switchLevel(i.level)},b.switchLevel=function(v){var i=this.hls.levels[v];if(!!(i!=null&&i.audioGroupIds)){var d=i.audioGroupIds[i.urlId];if(this.groupId!==d){this.groupId=d;var p=this.tracks.filter(function(l){return!d||l.groupId===d});this.selectDefaultTrack&&!p.some(function(l){return l.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=p;var T={audioTracks:p};this.log("Updating audio tracks, "+p.length+' track(s) found in "'+d+'" group-id'),this.hls.trigger(n.Events.AUDIO_TRACKS_UPDATED,T),this.selectInitialTrack()}}},b.onError=function(v,i){I.prototype.onError.call(this,v,i),!(i.fatal||!i.context)&&i.context.type===M.PlaylistContextType.AUDIO_TRACK&&i.context.id===this.trackId&&i.context.groupId===this.groupId&&this.retryLoadingOrFail(i)},b.setAudioTrack=function(v){var i=this.tracksInGroup;if(v<0||v>=i.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var d=i[this.trackId];this.log("Now switching to audio-track index "+v);var p=i[v],T=p.id,l=p.groupId,o=l===void 0?"":l,h=p.name,E=p.type,s=p.url;if(this.trackId=v,this.trackName=h,this.selectDefaultTrack=!1,this.hls.trigger(n.Events.AUDIO_TRACK_SWITCHING,{id:T,groupId:o,name:h,type:E,url:s}),!(p.details&&!p.details.live)){var c=this.switchParams(p.url,d==null?void 0:d.details);this.loadPlaylist(c)}},b.selectInitialTrack=function(){var v=this.tracksInGroup;console.assert(v.length,"Initial audio track should be selected when tracks are known");var i=this.trackName,d=this.findTrackId(i)||this.findTrackId();d!==-1?this.setAudioTrack(d):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},b.findTrackId=function(v){for(var i=this.tracksInGroup,d=0;d<i.length;d++){var p=i[d];if((!this.selectDefaultTrack||p.default)&&(!v||v===p.name))return p.id}return-1},b.loadPlaylist=function(v){var i=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(i)){var d=i.id,p=i.groupId,T=i.url;if(v)try{T=v.addDirectives(T)}catch(l){this.warn("Could not construct new URL with HLS Delivery Directives: "+l)}this.log("loading audio-track playlist for id: "+d),this.clearTimer(),this.hls.trigger(n.Events.AUDIO_TRACK_LOADING,{url:T,id:d,groupId:p,deliveryDirectives:v||null})}},O(_,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(v){this.selectDefaultTrack=!1,this.setAudioTrack(v)}}]),_}(u.default);t.default=x},"./src/controller/base-playlist-controller.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return O});var n=e("./src/polyfills/number.ts"),a=e("./src/types/level.ts"),u=e("./src/controller/level-helper.ts"),M=e("./src/utils/logger.ts"),C=e("./src/errors.ts"),O=function(){function L(x,I){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=M.logger.log.bind(M.logger,I+":"),this.warn=M.logger.warn.bind(M.logger,I+":"),this.hls=x}var A=L.prototype;return A.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},A.onError=function(I,_){_.fatal&&_.type===C.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},A.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},A.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},A.stopLoad=function(){this.canLoad=!1,this.clearTimer()},A.switchParams=function(I,_){var b=_==null?void 0:_.renditionReports;if(b)for(var S=0;S<b.length;S++){var v=b[S],i=""+v.URI;if(i===I.slice(-i.length)){var d=parseInt(v["LAST-MSN"]),p=parseInt(v["LAST-PART"]);if(_&&this.hls.config.lowLatencyMode){var T=Math.min(_.age-_.partTarget,_.targetduration);p!==void 0&&T>_.partTarget&&(p+=1)}if(Object(n.isFiniteNumber)(d))return new a.HlsUrlParameters(d,Object(n.isFiniteNumber)(p)?p:void 0,a.HlsSkip.No)}}},A.loadPlaylist=function(I){},A.shouldLoadTrack=function(I){return this.canLoad&&I&&!!I.url&&(!I.details||I.details.live)},A.playlistLoaded=function(I,_,b){var S=this,v=_.details,i=_.stats,d=i.loading.end?Math.max(0,self.performance.now()-i.loading.end):0;if(v.advancedDateTime=Date.now()-d,v.live||b!=null&&b.live){if(v.reloaded(b),b&&this.log("live playlist "+I+" "+(v.advanced?"REFRESHED "+v.lastPartSn+"-"+v.lastPartIndex:"MISSED")),b&&v.fragments.length>0&&Object(u.mergeDetails)(b,v),!this.canLoad||!v.live)return;var p,T=void 0,l=void 0;if(v.canBlockReload&&v.endSN&&v.advanced){var o=this.hls.config.lowLatencyMode,h=v.lastPartSn,E=v.endSN,s=v.lastPartIndex,c=s!==-1,m=h===E,f=o?0:s;c?(T=m?E+1:h,l=m?f:s+1):T=E+1;var g=v.age,y=g+v.ageHeader,R=Math.min(y-v.partTarget,v.targetduration*1.5);if(R>0){if(b&&R>b.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+b.tuneInGoal+" to: "+R+" with playlist age: "+v.age),R=0;else{var D=Math.floor(R/v.targetduration);if(T+=D,l!==void 0){var P=Math.round(R%v.targetduration/v.partTarget);l+=P}this.log("CDN Tune-in age: "+v.ageHeader+"s last advanced "+g.toFixed(2)+"s goal: "+R+" skip sn "+D+" to part "+l)}v.tuneInGoal=R}if(p=this.getDeliveryDirectives(v,_.deliveryDirectives,T,l),o||!m){this.loadPlaylist(p);return}}else p=this.getDeliveryDirectives(v,_.deliveryDirectives,T,l);var N=Object(u.computeReloadInterval)(v,i);T!==void 0&&v.canBlockReload&&(N-=v.partTarget||1),this.log("reload live playlist "+I+" in "+Math.round(N)+" ms"),this.timer=self.setTimeout(function(){return S.loadPlaylist(p)},N)}else this.clearTimer()},A.getDeliveryDirectives=function(I,_,b,S){var v=Object(a.getSkipValue)(I,b);return _!=null&&_.skip&&I.deltaUpdateFailed&&(b=_.msn,S=_.part,v=a.HlsSkip.No),new a.HlsUrlParameters(b,S,v)},A.retryLoadingOrFail=function(I){var _=this,b=this.hls.config,S=this.retryCount<b.levelLoadingMaxRetry;if(S){var v;if(this.retryCount++,I.details.indexOf("LoadTimeOut")>-1&&(v=I.context)!==null&&v!==void 0&&v.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+I.details+'"'),this.loadPlaylist();else{var i=Math.min(Math.pow(2,this.retryCount)*b.levelLoadingRetryDelay,b.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return _.loadPlaylist()},i),this.warn("retry playlist loading #"+this.retryCount+" in "+i+' ms after "'+I.details+'"')}}else this.warn('cannot recover from error "'+I.details+'"'),this.clearTimer(),I.fatal=!0;return S},L}()},"./src/controller/base-stream-controller.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"State",function(){return E}),e.d(t,"default",function(){return s});var n=e("./src/polyfills/number.ts"),a=e("./src/task-loop.ts"),u=e("./src/controller/fragment-tracker.ts"),M=e("./src/utils/buffer-helper.ts"),C=e("./src/utils/logger.ts"),O=e("./src/events.ts"),L=e("./src/errors.ts"),A=e("./src/types/transmuxer.ts"),x=e("./src/utils/mp4-tools.ts"),I=e("./src/utils/discontinuities.ts"),_=e("./src/controller/fragment-finders.ts"),b=e("./src/controller/level-helper.ts"),S=e("./src/loader/fragment-loader.ts"),v=e("./src/crypt/decrypter.ts"),i=e("./src/utils/time-ranges.ts"),d=e("./src/types/loader.ts");function p(c,m){for(var f=0;f<m.length;f++){var g=m[f];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(c,g.key,g)}}function T(c,m,f){return m&&p(c.prototype,m),f&&p(c,f),Object.defineProperty(c,"prototype",{writable:!1}),c}function l(c){if(c===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return c}function o(c,m){c.prototype=Object.create(m.prototype),c.prototype.constructor=c,h(c,m)}function h(c,m){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,y){return g.__proto__=y,g},h(c,m)}var E={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},s=function(c){o(m,c);function m(g,y,R){var D;return D=c.call(this)||this,D.hls=void 0,D.fragPrevious=null,D.fragCurrent=null,D.fragmentTracker=void 0,D.transmuxer=null,D._state=E.STOPPED,D.media=null,D.mediaBuffer=null,D.config=void 0,D.bitrateTest=!1,D.lastCurrentTime=0,D.nextLoadPosition=0,D.startPosition=0,D.loadedmetadata=!1,D.fragLoadError=0,D.retryDate=0,D.levels=null,D.fragmentLoader=void 0,D.levelLastLoaded=null,D.startFragRequested=!1,D.decrypter=void 0,D.initPTS=[],D.onvseeking=null,D.onvended=null,D.logPrefix="",D.log=void 0,D.warn=void 0,D.logPrefix=R,D.log=C.logger.log.bind(C.logger,R+":"),D.warn=C.logger.warn.bind(C.logger,R+":"),D.hls=g,D.fragmentLoader=new S.default(g.config),D.fragmentTracker=y,D.config=g.config,D.decrypter=new v.default(g,g.config),g.on(O.Events.KEY_LOADED,D.onKeyLoaded,l(D)),g.on(O.Events.LEVEL_SWITCHING,D.onLevelSwitching,l(D)),D}var f=m.prototype;return f.doTick=function(){this.onTickEnd()},f.onTickEnd=function(){},f.startLoad=function(y){},f.stopLoad=function(){this.fragmentLoader.abort();var y=this.fragCurrent;y&&this.fragmentTracker.removeFragment(y),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=E.STOPPED},f._streamEnded=function(y,R){var D=this.fragCurrent,P=this.fragmentTracker;if(!R.live&&D&&this.media&&D.sn>=R.endSN&&!y.nextStart){var N=R.partList;if(N!=null&&N.length){var B=N[N.length-1],F=M.BufferHelper.isBuffered(this.media,B.start+B.duration/2);return F}var H=P.getState(D);return H===u.FragmentState.PARTIAL||H===u.FragmentState.OK}return!1},f.onMediaAttached=function(y,R){var D=this.media=this.mediaBuffer=R.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),D.addEventListener("seeking",this.onvseeking),D.addEventListener("ended",this.onvended);var P=this.config;this.levels&&P.autoStartLoad&&this.state===E.STOPPED&&this.startLoad(P.startPosition)},f.onMediaDetaching=function(){var y=this.media;y!=null&&y.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),y&&this.onvseeking&&this.onvended&&(y.removeEventListener("seeking",this.onvseeking),y.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},f.onMediaSeeking=function(){var y=this.config,R=this.fragCurrent,D=this.media,P=this.mediaBuffer,N=this.state,B=D?D.currentTime:0,F=M.BufferHelper.bufferInfo(P||D,B,y.maxBufferHole);if(this.log("media seeking to "+(Object(n.isFiniteNumber)(B)?B.toFixed(3):B)+", state: "+N),N===E.ENDED)this.resetLoadingState();else if(R&&!F.len){var H=y.maxFragLookUpTolerance,j=R.start-H,X=R.start+R.duration+H,$=B>X;(B<j||$)&&($&&R.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),R.loader.abort()),this.resetLoadingState())}D&&(this.lastCurrentTime=B),!this.loadedmetadata&&!F.len&&(this.nextLoadPosition=this.startPosition=B),this.tickImmediate()},f.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},f.onKeyLoaded=function(y,R){if(!(this.state!==E.KEY_LOADING||R.frag!==this.fragCurrent||!this.levels)){this.state=E.IDLE;var D=this.levels[R.frag.level].details;D&&this.loadFragment(R.frag,D,R.frag.start)}},f.onLevelSwitching=function(y,R){this.fragLoadError=0},f.onHandlerDestroying=function(){this.stopLoad(),c.prototype.onHandlerDestroying.call(this)},f.onHandlerDestroyed=function(){this.state=E.STOPPED,this.hls.off(O.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(O.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,c.prototype.onHandlerDestroyed.call(this)},f.loadKey=function(y,R){this.log("Loading key for "+y.sn+" of ["+R.startSN+"-"+R.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+y.level),this.state=E.KEY_LOADING,this.fragCurrent=y,this.hls.trigger(O.Events.KEY_LOADING,{frag:y})},f.loadFragment=function(y,R,D){this._loadFragForPlayback(y,R,D)},f._loadFragForPlayback=function(y,R,D){var P=this,N=function(F){if(P.fragContextChanged(y)){P.warn("Fragment "+y.sn+(F.part?" p: "+F.part.index:"")+" of level "+y.level+" was dropped during download."),P.fragmentTracker.removeFragment(y);return}y.stats.chunkCount++,P._handleFragmentLoadProgress(F)};this._doFragLoad(y,R,D,N).then(function(B){if(!!B){P.fragLoadError=0;var F=P.state;if(P.fragContextChanged(y)){(F===E.FRAG_LOADING||!P.fragCurrent&&F===E.PARSING)&&(P.fragmentTracker.removeFragment(y),P.state=E.IDLE);return}"payload"in B&&(P.log("Loaded fragment "+y.sn+" of level "+y.level),P.hls.trigger(O.Events.FRAG_LOADED,B)),P._handleFragmentLoadComplete(B)}}).catch(function(B){P.state===E.STOPPED||P.state===E.ERROR||(P.warn(B),P.resetFragmentLoading(y))})},f.flushMainBuffer=function(y,R,D){if(D===void 0&&(D=null),!!(y-R)){var P={startOffset:y,endOffset:R,type:D};this.fragLoadError=0,this.hls.trigger(O.Events.BUFFER_FLUSHING,P)}},f._loadInitSegment=function(y){var R=this;this._doFragLoad(y).then(function(D){if(!D||R.fragContextChanged(y)||!R.levels)throw new Error("init load aborted");return D}).then(function(D){var P=R.hls,N=D.payload,B=y.decryptdata;if(N&&N.byteLength>0&&B&&B.key&&B.iv&&B.method==="AES-128"){var F=self.performance.now();return R.decrypter.webCryptoDecrypt(new Uint8Array(N),B.key.buffer,B.iv.buffer).then(function(H){var j=self.performance.now();return P.trigger(O.Events.FRAG_DECRYPTED,{frag:y,payload:H,stats:{tstart:F,tdecrypt:j}}),D.payload=H,D})}return D}).then(function(D){var P=R.fragCurrent,N=R.hls,B=R.levels;if(!B)throw new Error("init load aborted, missing levels");var F=B[y.level].details;console.assert(F,"Level details are defined when init segment is loaded");var H=y.stats;R.state=E.IDLE,R.fragLoadError=0,y.data=new Uint8Array(D.payload),H.parsing.start=H.buffering.start=self.performance.now(),H.parsing.end=H.buffering.end=self.performance.now(),D.frag===P&&N.trigger(O.Events.FRAG_BUFFERED,{stats:H,frag:P,part:null,id:y.type}),R.tick()}).catch(function(D){R.state===E.STOPPED||R.state===E.ERROR||(R.warn(D),R.resetFragmentLoading(y))})},f.fragContextChanged=function(y){var R=this.fragCurrent;return!y||!R||y.level!==R.level||y.sn!==R.sn||y.urlId!==R.urlId},f.fragBufferedComplete=function(y,R){var D=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+y.type+" sn: "+y.sn+(R?" part: "+R.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+y.level+" "+(D?i.default.toString(M.BufferHelper.getBuffered(D)):"(detached)")),this.state=E.IDLE,D&&(!this.loadedmetadata&&D.buffered.length&&this.fragCurrent===this.fragPrevious&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},f.seekToStartPos=function(){},f._handleFragmentLoadComplete=function(y){var R=this.transmuxer;if(!!R){var D=y.frag,P=y.part,N=y.partsLoaded,B=!N||N.length===0||N.some(function(H){return!H}),F=new A.ChunkMetadata(D.level,D.sn,D.stats.chunkCount+1,0,P?P.index:-1,!B);R.flush(F)}},f._handleFragmentLoadProgress=function(y){},f._doFragLoad=function(y,R,D,P){var N=this;if(D===void 0&&(D=null),!this.levels)throw new Error("frag load aborted, missing levels");if(D=Math.max(y.start,D||0),this.config.lowLatencyMode&&R){var B=R.partList;if(B&&P){D>y.end&&R.fragmentHint&&(y=R.fragmentHint);var F=this.getNextPart(B,y,D);if(F>-1){var H=B[F];return this.log("Loading part sn: "+y.sn+" p: "+H.index+" cc: "+y.cc+" of playlist ["+R.startSN+"-"+R.endSN+"] parts [0-"+F+"-"+(B.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+y.level+", target: "+parseFloat(D.toFixed(3))),this.nextLoadPosition=H.start+H.duration,this.state=E.FRAG_LOADING,this.hls.trigger(O.Events.FRAG_LOADING,{frag:y,part:B[F],targetBufferTime:D}),this.doFragPartsLoad(y,B,F,P).catch(function(j){return N.handleFragLoadError(j)})}else if(!y.url||this.loadedEndOfParts(B,D))return Promise.resolve(null)}}return this.log("Loading fragment "+y.sn+" cc: "+y.cc+" "+(R?"of ["+R.startSN+"-"+R.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+y.level+", target: "+parseFloat(D.toFixed(3))),Object(n.isFiniteNumber)(y.sn)&&!this.bitrateTest&&(this.nextLoadPosition=y.start+y.duration),this.state=E.FRAG_LOADING,this.hls.trigger(O.Events.FRAG_LOADING,{frag:y,targetBufferTime:D}),this.fragmentLoader.load(y,P).catch(function(j){return N.handleFragLoadError(j)})},f.doFragPartsLoad=function(y,R,D,P){var N=this;return new Promise(function(B,F){var H=[],j=function X($){var G=R[$];N.fragmentLoader.loadPart(y,G,P).then(function(J){H[G.index]=J;var ee=J.part;N.hls.trigger(O.Events.FRAG_LOADED,J);var te=R[$+1];if(te&&te.fragment===y)X($+1);else return B({frag:y,part:ee,partsLoaded:H})}).catch(F)};j(D)})},f.handleFragLoadError=function(y){var R=y.data;return R&&R.details===L.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(R.frag,R.part):this.hls.trigger(O.Events.ERROR,R),null},f._handleTransmuxerFlush=function(y){var R=this.getCurrentContext(y);if(!R||this.state!==E.PARSING){this.fragCurrent||(this.state=E.IDLE);return}var D=R.frag,P=R.part,N=R.level,B=self.performance.now();D.stats.parsing.end=B,P&&(P.stats.parsing.end=B),this.updateLevelTiming(D,P,N,y.partial)},f.getCurrentContext=function(y){var R=this.levels,D=y.level,P=y.sn,N=y.part;if(!R||!R[D])return this.warn("Levels object was unset while buffering fragment "+P+" of level "+D+". The current chunk will not be buffered."),null;var B=R[D],F=N>-1?Object(b.getPartWith)(B,P,N):null,H=F?F.fragment:Object(b.getFragmentWithSN)(B,P,this.fragCurrent);return H?{frag:H,part:F,level:B}:null},f.bufferFragmentData=function(y,R,D,P){if(!(!y||this.state!==E.PARSING)){var N=y.data1,B=y.data2,F=N;if(N&&B&&(F=Object(x.appendUint8Array)(N,B)),!(!F||!F.length)){var H={type:y.type,frag:R,part:D,chunkMeta:P,parent:R.type,data:F};this.hls.trigger(O.Events.BUFFER_APPENDING,H),y.dropped&&y.independent&&!D&&this.flushBufferGap(R)}}},f.flushBufferGap=function(y){var R=this.media;if(!!R){if(!M.BufferHelper.isBuffered(R,R.currentTime)){this.flushMainBuffer(0,y.start);return}var D=R.currentTime,P=M.BufferHelper.bufferInfo(R,D,0),N=y.duration,B=Math.min(this.config.maxFragLookUpTolerance*2,N*.25),F=Math.max(Math.min(y.start-B,P.end-B),D+B);y.start-F>B&&this.flushMainBuffer(F,y.start)}},f.getFwdBufferInfo=function(y,R){var D=this.config,P=this.getLoadPosition();if(!Object(n.isFiniteNumber)(P))return null;var N=M.BufferHelper.bufferInfo(y,P,D.maxBufferHole);if(N.len===0&&N.nextStart!==void 0){var B=this.fragmentTracker.getBufferedFrag(P,R);if(B&&N.nextStart<B.end)return M.BufferHelper.bufferInfo(y,P,Math.max(N.nextStart,D.maxBufferHole))}return N},f.getMaxBufferLength=function(y){var R=this.config,D;return y?D=Math.max(8*R.maxBufferSize/y,R.maxBufferLength):D=R.maxBufferLength,Math.min(D,R.maxMaxBufferLength)},f.reduceMaxBufferLength=function(y){var R=this.config,D=y||R.maxBufferLength;return R.maxMaxBufferLength>=D?(R.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+R.maxMaxBufferLength+"s"),!0):!1},f.getNextFragment=function(y,R){var D=R.fragments,P=D.length;if(!P)return null;var N=this.config,B=D[0].start,F;if(R.live){var H=N.initialLiveManifestSize;if(P<H)return this.warn("Not enough fragments to start playback (have: "+P+", need: "+H+")"),null;!R.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(F=this.getInitialLiveFragment(R,D),this.startPosition=F?this.hls.liveSyncPosition||F.start:y)}else y<=B&&(F=D[0]);if(!F){var j=N.lowLatencyMode?R.partEnd:R.fragmentEnd;F=this.getFragmentAtPosition(y,j,R)}return this.mapToInitFragWhenRequired(F)},f.mapToInitFragWhenRequired=function(y){return y!=null&&y.initSegment&&!(y!=null&&y.initSegment.data)&&!this.bitrateTest?y.initSegment:y},f.getNextPart=function(y,R,D){for(var P=-1,N=!1,B=!0,F=0,H=y.length;F<H;F++){var j=y[F];if(B=B&&!j.independent,P>-1&&D<j.start)break;var X=j.loaded;!X&&(N||j.independent||B)&&j.fragment===R&&(P=F),N=X}return P},f.loadedEndOfParts=function(y,R){var D=y[y.length-1];return D&&R>D.start&&D.loaded},f.getInitialLiveFragment=function(y,R){var D=this.fragPrevious,P=null;if(D){if(y.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+D.programDateTime),P=Object(_.findFragmentByPDT)(R,D.endProgramDateTime,this.config.maxFragLookUpTolerance)),!P){var N=D.sn+1;if(N>=y.startSN&&N<=y.endSN){var B=R[N-y.startSN];D.cc===B.cc&&(P=B,this.log("Live playlist, switching playlist, load frag with next SN: "+P.sn))}P||(P=Object(_.findFragWithCC)(R,D.cc),P&&this.log("Live playlist, switching playlist, load frag with same CC: "+P.sn))}}else{var F=this.hls.liveSyncPosition;F!==null&&(P=this.getFragmentAtPosition(F,this.bitrateTest?y.fragmentEnd:y.edge,y))}return P},f.getFragmentAtPosition=function(y,R,D){var P=this.config,N=this.fragPrevious,B=D.fragments,F=D.endSN,H=D.fragmentHint,j=P.maxFragLookUpTolerance,X=!!(P.lowLatencyMode&&D.partList&&H);X&&H&&!this.bitrateTest&&(B=B.concat(H),F=H.sn);var $;if(y<R){var G=y>R-j?0:j;$=Object(_.findFragmentByPTS)(N,B,y,G)}else $=B[B.length-1];if($){var J=$.sn-D.startSN;if(N&&$.sn===N.sn&&!X){var ee=N&&$.level===N.level;if(ee){var te=B[J+1];$.sn<F&&this.fragmentTracker.getState(te)!==u.FragmentState.OK?(this.log("SN "+$.sn+" just loaded, load next one: "+te.sn),$=te):$=null}}}return $},f.synchronizeToLiveEdge=function(y){var R=this.config,D=this.media;if(!!D){var P=this.hls.liveSyncPosition,N=D.currentTime,B=y.fragments[0].start,F=y.edge,H=N>=B-R.maxFragLookUpTolerance&&N<=F;if(P!==null&&D.duration>P&&(N<P||!H)){var j=R.liveMaxLatencyDuration!==void 0?R.liveMaxLatencyDuration:R.liveMaxLatencyDurationCount*y.targetduration;(!H&&D.readyState<4||N<F-j)&&(this.loadedmetadata||(this.nextLoadPosition=P),D.readyState&&(this.warn("Playback: "+N.toFixed(3)+" is located too far from the end of live sliding playlist: "+F+", reset currentTime to : "+P.toFixed(3)),D.currentTime=P))}}},f.alignPlaylists=function(y,R){var D=this.levels,P=this.levelLastLoaded,N=this.fragPrevious,B=P!==null?D[P]:null,F=y.fragments.length;if(!F)return this.warn("No fragments in live playlist"),0;var H=y.fragments[0].start,j=!R,X=y.alignedSliding&&Object(n.isFiniteNumber)(H);if(j||!X&&!H){Object(I.alignStream)(N,B,y);var $=y.fragments[0].start;return this.log("Live playlist sliding: "+$.toFixed(2)+" start-sn: "+(R?R.startSN:"na")+"->"+y.startSN+" prev-sn: "+(N?N.sn:"na")+" fragments: "+F),$}return H},f.waitForCdnTuneIn=function(y){var R=3;return y.live&&y.canBlockReload&&y.partTarget&&y.tuneInGoal>Math.max(y.partHoldBack,y.partTarget*R)},f.setStartPosition=function(y,R){var D=this.startPosition;if(D<R&&(D=-1),D===-1||this.lastCurrentTime===-1){var P=y.startTimeOffset;Object(n.isFiniteNumber)(P)?(D=R+P,P<0&&(D+=y.totalduration),D=Math.min(Math.max(R,D),R+y.totalduration),this.log("Start time offset "+P+" found in playlist, adjust startPosition to "+D),this.startPosition=D):y.live?D=this.hls.liveSyncPosition||R:this.startPosition=D=0,this.lastCurrentTime=D}this.nextLoadPosition=D},f.getLoadPosition=function(){var y=this.media,R=0;return this.loadedmetadata&&y?R=y.currentTime:this.nextLoadPosition&&(R=this.nextLoadPosition),R},f.handleFragLoadAborted=function(y,R){this.transmuxer&&y.sn!=="initSegment"&&y.stats.aborted&&(this.warn("Fragment "+y.sn+(R?" part"+R.index:"")+" of level "+y.level+" was aborted"),this.resetFragmentLoading(y))},f.resetFragmentLoading=function(y){(!this.fragCurrent||!this.fragContextChanged(y)&&this.state!==E.FRAG_LOADING_WAITING_RETRY)&&(this.state=E.IDLE)},f.onFragmentOrKeyLoadError=function(y,R){if(!R.fatal){var D=R.frag;if(!(!D||D.type!==y)){var P=this.fragCurrent;console.assert(P&&D.sn===P.sn&&D.level===P.level&&D.urlId===P.urlId,"Frag load error must match current frag to retry");var N=this.config;if(this.fragLoadError+1<=N.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var B=Math.min(Math.pow(2,this.fragLoadError)*N.fragLoadingRetryDelay,N.fragLoadingMaxRetryTimeout);this.warn("Fragment "+D.sn+" of "+y+" "+D.level+" failed to load, retrying in "+B+"ms"),this.retryDate=self.performance.now()+B,this.fragLoadError++,this.state=E.FRAG_LOADING_WAITING_RETRY}else R.levelRetry?(y===d.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=E.IDLE):(C.logger.error(R.details+" reaches max retry, redispatch as fatal ..."),R.fatal=!0,this.hls.stopLoad(),this.state=E.ERROR)}}},f.afterBufferFlushed=function(y,R,D){if(!!y){var P=M.BufferHelper.getBuffered(y);this.fragmentTracker.detectEvictedFragments(R,P,D),this.state===E.ENDED&&this.resetLoadingState()}},f.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=E.IDLE},f.resetStartWhenNotLoaded=function(y){if(!this.loadedmetadata){this.startFragRequested=!1;var R=this.levels?this.levels[y].details:null;R!=null&&R.live?(this.startPosition=-1,this.setStartPosition(R,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},f.updateLevelTiming=function(y,R,D,P){var N=this,B=D.details;console.assert(!!B,"level.details must be defined");var F=Object.keys(y.elementaryStreams).reduce(function(H,j){var X=y.elementaryStreams[j];if(X){var $=X.endPTS-X.startPTS;if($<=0)return N.warn("Could not parse fragment "+y.sn+" "+j+" duration reliably ("+$+")"),H||!1;var G=P?0:Object(b.updateFragPTSDTS)(B,y,X.startPTS,X.endPTS,X.startDTS,X.endDTS);return N.hls.trigger(O.Events.LEVEL_PTS_UPDATED,{details:B,level:D,drift:G,type:j,frag:y,start:X.startPTS,end:X.endPTS}),!0}return H},!1);F||(this.warn("Found no media in fragment "+y.sn+" of level "+D.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=E.PARSED,this.hls.trigger(O.Events.FRAG_PARSED,{frag:y,part:R})},f.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},T(m,[{key:"state",get:function(){return this._state},set:function(y){var R=this._state;R!==y&&(this._state=y,this.log(R+"->"+y))}}]),m}(a.default)},"./src/controller/buffer-controller.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return _});var n=e("./src/polyfills/number.ts"),a=e("./src/events.ts"),u=e("./src/utils/logger.ts"),M=e("./src/errors.ts"),C=e("./src/utils/buffer-helper.ts"),O=e("./src/utils/mediasource-helper.ts"),L=e("./src/loader/fragment.ts"),A=e("./src/controller/buffer-operation-queue.ts"),x=Object(O.getMediaSource)(),I=/([ha]vc.)(?:\.[^.,]+)+/,_=function(){function b(v){var i=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var d=i.hls,p=i.media,T=i.mediaSource;u.logger.log("[buffer-controller]: Media source opened"),p&&(i.updateMediaElementDuration(),d.trigger(a.Events.MEDIA_ATTACHED,{media:p})),T&&T.removeEventListener("sourceopen",i._onMediaSourceOpen),i.checkPendingTracks()},this._onMediaSourceClose=function(){u.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){u.logger.log("[buffer-controller]: Media source ended")},this.hls=v,this._initSourceBuffer(),this.registerListeners()}var S=b.prototype;return S.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},S.destroy=function(){this.unregisterListeners(),this.details=null},S.registerListeners=function(){var i=this.hls;i.on(a.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(a.Events.BUFFER_RESET,this.onBufferReset,this),i.on(a.Events.BUFFER_APPENDING,this.onBufferAppending,this),i.on(a.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.on(a.Events.BUFFER_EOS,this.onBufferEos,this),i.on(a.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.on(a.Events.LEVEL_UPDATED,this.onLevelUpdated,this),i.on(a.Events.FRAG_PARSED,this.onFragParsed,this),i.on(a.Events.FRAG_CHANGED,this.onFragChanged,this)},S.unregisterListeners=function(){var i=this.hls;i.off(a.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(a.Events.BUFFER_RESET,this.onBufferReset,this),i.off(a.Events.BUFFER_APPENDING,this.onBufferAppending,this),i.off(a.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.off(a.Events.BUFFER_EOS,this.onBufferEos,this),i.off(a.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.off(a.Events.LEVEL_UPDATED,this.onLevelUpdated,this),i.off(a.Events.FRAG_PARSED,this.onFragParsed,this),i.off(a.Events.FRAG_CHANGED,this.onFragChanged,this)},S._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new A.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},S.onManifestParsed=function(i,d){var p=2;(d.audio&&!d.video||!d.altAudio)&&(p=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=p,this.details=null,u.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},S.onMediaAttaching=function(i,d){var p=this.media=d.media;if(p&&x){var T=this.mediaSource=new x;T.addEventListener("sourceopen",this._onMediaSourceOpen),T.addEventListener("sourceended",this._onMediaSourceEnded),T.addEventListener("sourceclose",this._onMediaSourceClose),p.src=self.URL.createObjectURL(T),this._objectUrl=p.src}},S.onMediaDetaching=function(){var i=this.media,d=this.mediaSource,p=this._objectUrl;if(d){if(u.logger.log("[buffer-controller]: media source detaching"),d.readyState==="open")try{d.endOfStream()}catch(T){u.logger.warn("[buffer-controller]: onMediaDetaching: "+T.message+" while calling endOfStream")}this.onBufferReset(),d.removeEventListener("sourceopen",this._onMediaSourceOpen),d.removeEventListener("sourceended",this._onMediaSourceEnded),d.removeEventListener("sourceclose",this._onMediaSourceClose),i&&(p&&self.URL.revokeObjectURL(p),i.src===p?(i.removeAttribute("src"),i.load()):u.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(a.Events.MEDIA_DETACHED,void 0)},S.onBufferReset=function(){var i=this;this.getSourceBufferTypes().forEach(function(d){var p=i.sourceBuffer[d];try{p&&(i.removeBufferListeners(d),i.mediaSource&&i.mediaSource.removeSourceBuffer(p),i.sourceBuffer[d]=void 0)}catch(T){u.logger.warn("[buffer-controller]: Failed to reset the "+d+" buffer",T)}}),this._initSourceBuffer()},S.onBufferCodecs=function(i,d){var p=this,T=this.getSourceBufferTypes().length;Object.keys(d).forEach(function(l){if(T){var o=p.tracks[l];if(o&&typeof o.buffer.changeType=="function"){var h=d[l],E=h.id,s=h.codec,c=h.levelCodec,m=h.container,f=h.metadata,g=(o.levelCodec||o.codec).replace(I,"$1"),y=(c||s).replace(I,"$1");if(g!==y){var R=m+";codecs="+(c||s);p.appendChangeType(l,R),u.logger.log("[buffer-controller]: switching codec "+g+" to "+y),p.tracks[l]={buffer:o.buffer,codec:s,container:m,levelCodec:c,metadata:f,id:E}}}}else p.pendingTracks[l]=d[l]}),!T&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},S.appendChangeType=function(i,d){var p=this,T=this.operationQueue,l={execute:function(){var h=p.sourceBuffer[i];h&&(u.logger.log("[buffer-controller]: changing "+i+" sourceBuffer type to "+d),h.changeType(d)),T.shiftAndExecuteNext(i)},onStart:function(){},onComplete:function(){},onError:function(h){u.logger.warn("[buffer-controller]: Failed to change "+i+" SourceBuffer type",h)}};T.append(l,i)},S.onBufferAppending=function(i,d){var p=this,T=this.hls,l=this.operationQueue,o=this.tracks,h=d.data,E=d.type,s=d.frag,c=d.part,m=d.chunkMeta,f=m.buffering[E],g=self.performance.now();f.start=g;var y=s.stats.buffering,R=c?c.stats.buffering:null;y.start===0&&(y.start=g),R&&R.start===0&&(R.start=g);var D=o.audio,P=E==="audio"&&m.id===1&&(D==null?void 0:D.container)==="audio/mpeg",N={execute:function(){if(f.executeStart=self.performance.now(),P){var F=p.sourceBuffer[E];if(F){var H=s.start-F.timestampOffset;Math.abs(H)>=.1&&(u.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+s.start+" (delta: "+H+") sn: "+s.sn+")"),F.timestampOffset=s.start)}}p.appendExecutor(h,E)},onStart:function(){},onComplete:function(){var F=self.performance.now();f.executeEnd=f.end=F,y.first===0&&(y.first=F),R&&R.first===0&&(R.first=F);var H=p.sourceBuffer,j={};for(var X in H)j[X]=C.BufferHelper.getBuffered(H[X]);p.appendError=0,p.hls.trigger(a.Events.BUFFER_APPENDED,{type:E,frag:s,part:c,chunkMeta:m,parent:s.type,timeRanges:j})},onError:function(F){u.logger.error("[buffer-controller]: Error encountered while trying to append to the "+E+" SourceBuffer",F);var H={type:M.ErrorTypes.MEDIA_ERROR,parent:s.type,details:M.ErrorDetails.BUFFER_APPEND_ERROR,err:F,fatal:!1};F.code===DOMException.QUOTA_EXCEEDED_ERR?H.details=M.ErrorDetails.BUFFER_FULL_ERROR:(p.appendError++,H.details=M.ErrorDetails.BUFFER_APPEND_ERROR,p.appendError>T.config.appendErrorMaxRetry&&(u.logger.error("[buffer-controller]: Failed "+T.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),H.fatal=!0,T.stopLoad())),T.trigger(a.Events.ERROR,H)}};l.append(N,E)},S.onBufferFlushing=function(i,d){var p=this,T=this.operationQueue,l=function(h){return{execute:p.removeExecutor.bind(p,h,d.startOffset,d.endOffset),onStart:function(){},onComplete:function(){p.hls.trigger(a.Events.BUFFER_FLUSHED,{type:h})},onError:function(s){u.logger.warn("[buffer-controller]: Failed to remove from "+h+" SourceBuffer",s)}}};d.type?T.append(l(d.type),d.type):this.getSourceBufferTypes().forEach(function(o){T.append(l(o),o)})},S.onFragParsed=function(i,d){var p=this,T=d.frag,l=d.part,o=[],h=l?l.elementaryStreams:T.elementaryStreams;h[L.ElementaryStreamTypes.AUDIOVIDEO]?o.push("audiovideo"):(h[L.ElementaryStreamTypes.AUDIO]&&o.push("audio"),h[L.ElementaryStreamTypes.VIDEO]&&o.push("video"));var E=function(){var c=self.performance.now();T.stats.buffering.end=c,l&&(l.stats.buffering.end=c);var m=l?l.stats:T.stats;p.hls.trigger(a.Events.FRAG_BUFFERED,{frag:T,part:l,stats:m,id:T.type})};o.length===0&&u.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+T.type+" level: "+T.level+" sn: "+T.sn),this.blockBuffers(E,o)},S.onFragChanged=function(i,d){this.flushBackBuffer()},S.onBufferEos=function(i,d){var p=this,T=this.getSourceBufferTypes().reduce(function(l,o){var h=p.sourceBuffer[o];return(!d.type||d.type===o)&&h&&!h.ended&&(h.ended=!0,u.logger.log("[buffer-controller]: "+o+" sourceBuffer now EOS")),l&&!!(!h||h.ended)},!0);T&&this.blockBuffers(function(){var l=p.mediaSource;!l||l.readyState!=="open"||l.endOfStream()})},S.onLevelUpdated=function(i,d){var p=d.details;!p.fragments.length||(this.details=p,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},S.flushBackBuffer=function(){var i=this.hls,d=this.details,p=this.media,T=this.sourceBuffer;if(!(!p||d===null)){var l=this.getSourceBufferTypes();if(!!l.length){var o=d.live&&i.config.liveBackBufferLength!==null?i.config.liveBackBufferLength:i.config.backBufferLength;if(!(!Object(n.isFiniteNumber)(o)||o<0)){var h=p.currentTime,E=d.levelTargetDuration,s=Math.max(o,E),c=Math.floor(h/E)*E-s;l.forEach(function(m){var f=T[m];if(f){var g=C.BufferHelper.getBuffered(f);g.length>0&&c>g.start(0)&&(i.trigger(a.Events.BACK_BUFFER_REACHED,{bufferEnd:c}),d.live&&i.trigger(a.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:c}),i.trigger(a.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:c,type:m}))}})}}}},S.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var i=this.details,d=this.hls,p=this.media,T=this.mediaSource,l=i.fragments[0].start+i.totalduration,o=p.duration,h=Object(n.isFiniteNumber)(T.duration)?T.duration:0;i.live&&d.config.liveDurationInfinity?(u.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),T.duration=1/0,this.updateSeekableRange(i)):(l>h&&l>o||!Object(n.isFiniteNumber)(o))&&(u.logger.log("[buffer-controller]: Updating Media Source duration to "+l.toFixed(3)),T.duration=l)}},S.updateSeekableRange=function(i){var d=this.mediaSource,p=i.fragments,T=p.length;if(T&&i.live&&d!==null&&d!==void 0&&d.setLiveSeekableRange){var l=Math.max(0,p[0].start),o=Math.max(l,l+i.totalduration);d.setLiveSeekableRange(l,o)}},S.checkPendingTracks=function(){var i=this.bufferCodecEventsExpected,d=this.operationQueue,p=this.pendingTracks,T=Object.keys(p).length;if(T&&!i||T===2){this.createSourceBuffers(p),this.pendingTracks={};var l=this.getSourceBufferTypes();if(l.length===0){this.hls.trigger(a.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}l.forEach(function(o){d.executeNext(o)})}},S.createSourceBuffers=function(i){var d=this.sourceBuffer,p=this.mediaSource;if(!p)throw Error("createSourceBuffers called when mediaSource was null");var T=0;for(var l in i)if(!d[l]){var o=i[l];if(!o)throw Error("source buffer exists for track "+l+", however track does not");var h=o.levelCodec||o.codec,E=o.container+";codecs="+h;u.logger.log("[buffer-controller]: creating sourceBuffer("+E+")");try{var s=d[l]=p.addSourceBuffer(E),c=l;this.addBufferListener(c,"updatestart",this._onSBUpdateStart),this.addBufferListener(c,"updateend",this._onSBUpdateEnd),this.addBufferListener(c,"error",this._onSBUpdateError),this.tracks[l]={buffer:s,codec:h,container:o.container,levelCodec:o.levelCodec,metadata:o.metadata,id:o.id},T++}catch(m){u.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+m.message),this.hls.trigger(a.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:m,mimeType:E})}}T&&this.hls.trigger(a.Events.BUFFER_CREATED,{tracks:this.tracks})},S._onSBUpdateStart=function(i){var d=this.operationQueue,p=d.current(i);p.onStart()},S._onSBUpdateEnd=function(i){var d=this.operationQueue,p=d.current(i);p.onComplete(),d.shiftAndExecuteNext(i)},S._onSBUpdateError=function(i,d){u.logger.error("[buffer-controller]: "+i+" SourceBuffer error",d),this.hls.trigger(a.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var p=this.operationQueue.current(i);p&&p.onError(d)},S.removeExecutor=function(i,d,p){var T=this.media,l=this.mediaSource,o=this.operationQueue,h=this.sourceBuffer,E=h[i];if(!T||!l||!E){u.logger.warn("[buffer-controller]: Attempting to remove from the "+i+" SourceBuffer, but it does not exist"),o.shiftAndExecuteNext(i);return}var s=Object(n.isFiniteNumber)(T.duration)?T.duration:1/0,c=Object(n.isFiniteNumber)(l.duration)?l.duration:1/0,m=Math.max(0,d),f=Math.min(p,s,c);f>m?(u.logger.log("[buffer-controller]: Removing ["+m+","+f+"] from the "+i+" SourceBuffer"),console.assert(!E.updating,i+" sourceBuffer must not be updating"),E.remove(m,f)):o.shiftAndExecuteNext(i)},S.appendExecutor=function(i,d){var p=this.operationQueue,T=this.sourceBuffer,l=T[d];if(!l){u.logger.warn("[buffer-controller]: Attempting to append to the "+d+" SourceBuffer, but it does not exist"),p.shiftAndExecuteNext(d);return}l.ended=!1,console.assert(!l.updating,d+" sourceBuffer must not be updating"),l.appendBuffer(i)},S.blockBuffers=function(i,d){var p=this;if(d===void 0&&(d=this.getSourceBufferTypes()),!d.length){u.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(i);return}var T=this.operationQueue,l=d.map(function(o){return T.appendBlocker(o)});Promise.all(l).then(function(){i(),d.forEach(function(o){var h=p.sourceBuffer[o];(!h||!h.updating)&&T.shiftAndExecuteNext(o)})})},S.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},S.addBufferListener=function(i,d,p){var T=this.sourceBuffer[i];if(!!T){var l=p.bind(this,i);this.listeners[i].push({event:d,listener:l}),T.addEventListener(d,l)}},S.removeBufferListeners=function(i){var d=this.sourceBuffer[i];!d||this.listeners[i].forEach(function(p){d.removeEventListener(p.event,p.listener)})},b}()},"./src/controller/buffer-operation-queue.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return a});var n=e("./src/utils/logger.ts"),a=function(){function u(C){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=C}var M=u.prototype;return M.append=function(O,L){var A=this.queues[L];A.push(O),A.length===1&&this.buffers[L]&&this.executeNext(L)},M.insertAbort=function(O,L){var A=this.queues[L];A.unshift(O),this.executeNext(L)},M.appendBlocker=function(O){var L,A=new Promise(function(I){L=I}),x={execute:L,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(x,O),A},M.executeNext=function(O){var L=this.buffers,A=this.queues,x=L[O],I=A[O];if(I.length){var _=I[0];try{_.execute()}catch(b){n.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),_.onError(b),(!x||!x.updating)&&(I.shift(),this.executeNext(O))}}},M.shiftAndExecuteNext=function(O){this.queues[O].shift(),this.executeNext(O)},M.current=function(O){return this.queues[O][0]},u}()},"./src/controller/cap-level-controller.ts":function(r,t,e){"use strict";e.r(t);var n=e("./src/events.ts");function a(C,O){for(var L=0;L<O.length;L++){var A=O[L];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(C,A.key,A)}}function u(C,O,L){return O&&a(C.prototype,O),L&&a(C,L),Object.defineProperty(C,"prototype",{writable:!1}),C}var M=function(){function C(L){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=L,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var O=C.prototype;return O.setStreamController=function(A){this.streamController=A},O.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},O.registerListeners=function(){var A=this.hls;A.on(n.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),A.on(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),A.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),A.on(n.Events.BUFFER_CODECS,this.onBufferCodecs,this),A.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},O.unregisterListener=function(){var A=this.hls;A.off(n.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),A.off(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),A.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),A.off(n.Events.BUFFER_CODECS,this.onBufferCodecs,this),A.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},O.onFpsDropLevelCapping=function(A,x){C.isLevelAllowed(x.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(x.droppedLevel)},O.onMediaAttaching=function(A,x){this.media=x.media instanceof HTMLVideoElement?x.media:null},O.onManifestParsed=function(A,x){var I=this.hls;this.restrictedLevels=[],this.firstLevel=x.firstLevel,I.config.capLevelToPlayerSize&&x.video&&this.startCapping()},O.onBufferCodecs=function(A,x){var I=this.hls;I.config.capLevelToPlayerSize&&x.video&&this.startCapping()},O.onMediaDetaching=function(){this.stopCapping()},O.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var A=this.hls.levels;if(A.length){var x=this.hls;x.autoLevelCapping=this.getMaxLevel(A.length-1),x.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=x.autoLevelCapping}}},O.getMaxLevel=function(A){var x=this,I=this.hls.levels;if(!I.length)return-1;var _=I.filter(function(b,S){return C.isLevelAllowed(S,x.restrictedLevels)&&S<=A});return this.clientRect=null,C.getMaxLevelByMediaSize(_,this.mediaWidth,this.mediaHeight)},O.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},O.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},O.getDimensions=function(){if(this.clientRect)return this.clientRect;var A=this.media,x={width:0,height:0};if(A){var I=A.getBoundingClientRect();x.width=I.width,x.height=I.height,!x.width&&!x.height&&(x.width=I.right-I.left||A.width||0,x.height=I.bottom-I.top||A.height||0)}return this.clientRect=x,x},C.isLevelAllowed=function(A,x){return x===void 0&&(x=[]),x.indexOf(A)===-1},C.getMaxLevelByMediaSize=function(A,x,I){if(!A||!A.length)return-1;for(var _=function(d,p){return p?d.width!==p.width||d.height!==p.height:!0},b=A.length-1,S=0;S<A.length;S+=1){var v=A[S];if((v.width>=x||v.height>=I)&&_(v,A[S+1])){b=S;break}}return b},u(C,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var A=1;if(!this.hls.config.ignoreDevicePixelRatio)try{A=self.devicePixelRatio}catch{}return A}}]),C}();t.default=M},"./src/controller/cmcd-controller.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return _});var n=e("./src/events.ts"),a=e("./src/types/cmcd.ts"),u=e("./src/utils/buffer-helper.ts"),M=e("./src/utils/logger.ts");function C(b,S){for(var v=0;v<S.length;v++){var i=S[v];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(b,i.key,i)}}function O(b,S,v){return S&&C(b.prototype,S),v&&C(b,v),Object.defineProperty(b,"prototype",{writable:!1}),b}function L(b,S){var v=typeof Symbol!="undefined"&&b[Symbol.iterator]||b["@@iterator"];if(v)return(v=v.call(b)).next.bind(v);if(Array.isArray(b)||(v=A(b))||S&&b&&typeof b.length=="number"){v&&(b=v);var i=0;return function(){return i>=b.length?{done:!0}:{done:!1,value:b[i++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function A(b,S){if(!!b){if(typeof b=="string")return x(b,S);var v=Object.prototype.toString.call(b).slice(8,-1);if(v==="Object"&&b.constructor&&(v=b.constructor.name),v==="Map"||v==="Set")return Array.from(b);if(v==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(v))return x(b,S)}}function x(b,S){(S==null||S>b.length)&&(S=b.length);for(var v=0,i=new Array(S);v<S;v++)i[v]=b[v];return i}function I(){return I=Object.assign?Object.assign.bind():function(b){for(var S=1;S<arguments.length;S++){var v=arguments[S];for(var i in v)Object.prototype.hasOwnProperty.call(v,i)&&(b[i]=v[i])}return b},I.apply(this,arguments)}var _=function(){function b(v){var i=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){i.initialized&&(i.starved=!0),i.buffering=!0},this.onPlaying=function(){i.initialized||(i.initialized=!0),i.buffering=!1},this.applyPlaylistData=function(T){try{i.apply(T,{ot:a.CMCDObjectType.MANIFEST,su:!i.initialized})}catch(l){M.logger.warn("Could not generate manifest CMCD data.",l)}},this.applyFragmentData=function(T){try{var l=T.frag,o=i.hls.levels[l.level],h=i.getObjectType(l),E={d:l.duration*1e3,ot:h};(h===a.CMCDObjectType.VIDEO||h===a.CMCDObjectType.AUDIO||h==a.CMCDObjectType.MUXED)&&(E.br=o.bitrate/1e3,E.tb=i.getTopBandwidth(h)/1e3,E.bl=i.getBufferLength(h)),i.apply(T,E)}catch(s){M.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=v;var d=this.config=v.config,p=d.cmcd;p!=null&&(d.pLoader=this.createPlaylistLoader(),d.fLoader=this.createFragmentLoader(),this.sid=p.sessionId||b.uuid(),this.cid=p.contentId,this.useHeaders=p.useHeaders===!0,this.registerListeners())}var S=b.prototype;return S.registerListeners=function(){var i=this.hls;i.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(n.Events.MEDIA_DETACHED,this.onMediaDetached,this),i.on(n.Events.BUFFER_CREATED,this.onBufferCreated,this)},S.unregisterListeners=function(){var i=this.hls;i.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(n.Events.MEDIA_DETACHED,this.onMediaDetached,this),i.off(n.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},S.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},S.onMediaAttached=function(i,d){this.media=d.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},S.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},S.onBufferCreated=function(i,d){var p,T;this.audioBuffer=(p=d.tracks.audio)===null||p===void 0?void 0:p.buffer,this.videoBuffer=(T=d.tracks.video)===null||T===void 0?void 0:T.buffer},S.createData=function(){var i;return{v:a.CMCDVersion,sf:a.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(i=this.media)===null||i===void 0?void 0:i.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},S.apply=function(i,d){d===void 0&&(d={}),I(d,this.createData());var p=d.ot===a.CMCDObjectType.INIT||d.ot===a.CMCDObjectType.VIDEO||d.ot===a.CMCDObjectType.MUXED;if(this.starved&&p&&(d.bs=!0,d.su=!0,this.starved=!1),d.su==null&&(d.su=this.buffering),this.useHeaders){var T=b.toHeaders(d);if(!Object.keys(T).length)return;i.headers||(i.headers={}),I(i.headers,T)}else{var l=b.toQuery(d);if(!l)return;i.url=b.appendQueryToUri(i.url,l)}},S.getObjectType=function(i){var d=i.type;if(d==="subtitle")return a.CMCDObjectType.TIMED_TEXT;if(i.sn==="initSegment")return a.CMCDObjectType.INIT;if(d==="audio")return a.CMCDObjectType.AUDIO;if(d==="main")return this.hls.audioTracks.length?a.CMCDObjectType.VIDEO:a.CMCDObjectType.MUXED},S.getTopBandwidth=function(i){var d=0,p,T=this.hls;if(i===a.CMCDObjectType.AUDIO)p=T.audioTracks;else{var l=T.maxAutoLevel,o=l>-1?l+1:T.levels.length;p=T.levels.slice(0,o)}for(var h=L(p),E;!(E=h()).done;){var s=E.value;s.bitrate>d&&(d=s.bitrate)}return d>0?d:NaN},S.getBufferLength=function(i){var d=this.hls.media,p=i===a.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!p||!d)return NaN;var T=u.BufferHelper.bufferInfo(p,d.currentTime,this.config.maxBufferHole);return T.len*1e3},S.createPlaylistLoader=function(){var i=this.config.pLoader,d=this.applyPlaylistData,p=i||this.config.loader;return function(){function T(o){this.loader=void 0,this.loader=new p(o)}var l=T.prototype;return l.destroy=function(){this.loader.destroy()},l.abort=function(){this.loader.abort()},l.load=function(h,E,s){d(h),this.loader.load(h,E,s)},O(T,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),T}()},S.createFragmentLoader=function(){var i=this.config.fLoader,d=this.applyFragmentData,p=i||this.config.loader;return function(){function T(o){this.loader=void 0,this.loader=new p(o)}var l=T.prototype;return l.destroy=function(){this.loader.destroy()},l.abort=function(){this.loader.abort()},l.load=function(h,E,s){d(h),this.loader.load(h,E,s)},O(T,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),T}()},b.uuid=function(){var i=URL.createObjectURL(new Blob),d=i.toString();return URL.revokeObjectURL(i),d.slice(d.lastIndexOf("/")+1)},b.serialize=function(i){for(var d=[],p=function(P){return!Number.isNaN(P)&&P!=null&&P!==""&&P!==!1},T=function(P){return Math.round(P)},l=function(P){return T(P/100)*100},o=function(P){return encodeURIComponent(P)},h={br:T,d:T,bl:l,dl:l,mtp:l,nor:o,rtp:l,tb:T},E=Object.keys(i||{}).sort(),s=L(E),c;!(c=s()).done;){var m=c.value,f=i[m];if(!!p(f)&&!(m==="v"&&f===1)&&!(m=="pr"&&f===1)){var g=h[m];g&&(f=g(f));var y=typeof f,R=void 0;m==="ot"||m==="sf"||m==="st"?R=m+"="+f:y==="boolean"?R=m:y==="number"?R=m+"="+f:R=m+"="+JSON.stringify(f),d.push(R)}}return d.join(",")},b.toHeaders=function(i){for(var d=Object.keys(i),p={},T=["Object","Request","Session","Status"],l=[{},{},{},{}],o={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},h=0,E=d;h<E.length;h++){var s=E[h],c=o[s]!=null?o[s]:1;l[c][s]=i[s]}for(var m=0;m<l.length;m++){var f=b.serialize(l[m]);f&&(p["CMCD-"+T[m]]=f)}return p},b.toQuery=function(i){return"CMCD="+encodeURIComponent(b.serialize(i))},b.appendQueryToUri=function(i,d){if(!d)return i;var p=i.includes("?")?"&":"?";return""+i+p+d},b}()},"./src/controller/eme-controller.ts":function(r,t,e){"use strict";e.r(t);var n=e("./src/events.ts"),a=e("./src/errors.ts"),u=e("./src/utils/logger.ts"),M=e("./src/utils/mediakeys-helper.ts");function C(_,b){for(var S=0;S<b.length;S++){var v=b[S];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(_,v.key,v)}}function O(_,b,S){return b&&C(_.prototype,b),S&&C(_,S),Object.defineProperty(_,"prototype",{writable:!1}),_}var L=3,A=function(b,S,v){var i={audioCapabilities:[],videoCapabilities:[]};return b.forEach(function(d){i.audioCapabilities.push({contentType:'audio/mp4; codecs="'+d+'"',robustness:v.audioRobustness||""})}),S.forEach(function(d){i.videoCapabilities.push({contentType:'video/mp4; codecs="'+d+'"',robustness:v.videoRobustness||""})}),[i]},x=function(b,S,v,i){switch(b){case M.KeySystems.WIDEVINE:return A(S,v,i);default:throw new Error("Unknown key-system: "+b)}},I=function(){function _(S){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=S,this._config=S.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var b=_.prototype;return b.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},b._registerListeners=function(){this.hls.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(n.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this)},b._unregisterListeners=function(){this.hls.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(n.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this)},b.getLicenseServerUrl=function(v){switch(v){case M.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+v+'"')},b._attemptKeySystemAccess=function(v,i,d){var p=this,T=x(v,i,d,this._drmSystemOptions);u.logger.log("Requesting encrypted media key-system access");var l=this.requestMediaKeySystemAccess(v,T);this.mediaKeysPromise=l.then(function(o){return p._onMediaKeySystemAccessObtained(v,o)}),l.catch(function(o){u.logger.error('Failed to obtain key-system "'+v+'" access:',o)})},b._onMediaKeySystemAccessObtained=function(v,i){var d=this;u.logger.log('Access for key-system "'+v+'" obtained');var p={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:i,mediaKeySystemDomain:v};this._mediaKeysList.push(p);var T=Promise.resolve().then(function(){return i.createMediaKeys()}).then(function(l){return p.mediaKeys=l,u.logger.log('Media-keys created for key-system "'+v+'"'),d._onMediaKeysCreated(),l});return T.catch(function(l){u.logger.error("Failed to create media-keys:",l)}),T},b._onMediaKeysCreated=function(){var v=this;this._mediaKeysList.forEach(function(i){i.mediaKeysSession||(i.mediaKeysSession=i.mediaKeys.createSession(),v._onNewMediaKeySession(i.mediaKeysSession))})},b._onNewMediaKeySession=function(v){var i=this;u.logger.log("New key-system session "+v.sessionId),v.addEventListener("message",function(d){i._onKeySessionMessage(v,d.message)},!1)},b._onKeySessionMessage=function(v,i){u.logger.log("Got EME message event, creating license request"),this._requestLicense(i,function(d){u.logger.log("Received license data (length: "+(d&&d.byteLength)+"), updating key-session"),v.update(d).catch(function(p){u.logger.warn("Updating key-session failed: "+p)})})},b.onMediaEncrypted=function(v){var i=this;if(u.logger.log('Media is encrypted using "'+v.initDataType+'" init data type'),!this.mediaKeysPromise){u.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var d=function(T){!i._media||(i._attemptSetMediaKeys(T),i._generateRequestWithPreferredKeySession(v.initDataType,v.initData))};this.mediaKeysPromise.then(d).catch(d)},b._attemptSetMediaKeys=function(v){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var i=this._mediaKeysList[0];if(!i||!i.mediaKeys){u.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}u.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(i.mediaKeys),this._hasSetMediaKeys=!0}},b._generateRequestWithPreferredKeySession=function(v,i){var d=this,p=this._mediaKeysList[0];if(!p){u.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(p.mediaKeysSessionInitialized){u.logger.warn("Key-Session already initialized but requested again");return}var T=p.mediaKeysSession;if(!T){u.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!i){u.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}u.logger.log('Generating key-session request for "'+v+'" init data type'),p.mediaKeysSessionInitialized=!0,T.generateRequest(v,i).then(function(){u.logger.debug("Key-session generation succeeded")}).catch(function(l){u.logger.error("Error generating key-session request:",l),d.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},b._createLicenseXhr=function(v,i,d){var p=new XMLHttpRequest;p.responseType="arraybuffer",p.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,p,v,i,d);var T=this._licenseXhrSetup;if(T)try{T.call(this.hls,p,v),T=void 0}catch(l){u.logger.error(l)}try{p.readyState||p.open("POST",v,!0),T&&T.call(this.hls,p,v)}catch(l){throw new Error("issue setting up KeySystem license XHR "+l)}return p},b._onLicenseRequestReadyStageChange=function(v,i,d,p){switch(v.readyState){case 4:if(v.status===200){this._requestLicenseFailureCount=0,u.logger.log("License request succeeded");var T=v.response,l=this._licenseResponseCallback;if(l)try{T=l.call(this.hls,v,i)}catch(h){u.logger.error(h)}p(T)}else{if(u.logger.error("License Request XHR failed ("+i+"). Status: "+v.status+" ("+v.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>L){this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var o=L-this._requestLicenseFailureCount+1;u.logger.warn("Retrying license request, "+o+" attempts left"),this._requestLicense(d,p)}break}},b._generateLicenseRequestChallenge=function(v,i){switch(v.mediaKeySystemDomain){case M.KeySystems.WIDEVINE:return i}throw new Error("unsupported key-system: "+v.mediaKeySystemDomain)},b._requestLicense=function(v,i){u.logger.log("Requesting content license for key-system");var d=this._mediaKeysList[0];if(!d){u.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var p=this.getLicenseServerUrl(d.mediaKeySystemDomain),T=this._createLicenseXhr(p,v,i);u.logger.log("Sending license request to URL: "+p);var l=this._generateLicenseRequestChallenge(d,v);T.send(l)}catch(o){u.logger.error("Failure requesting DRM license: "+o),this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},b.onMediaAttached=function(v,i){if(!!this._emeEnabled){var d=i.media;this._media=d,d.addEventListener("encrypted",this._onMediaEncrypted)}},b.onMediaDetached=function(){var v=this._media,i=this._mediaKeysList;!v||(v.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(i.map(function(d){if(d.mediaKeysSession)return d.mediaKeysSession.close().catch(function(){})})).then(function(){return v.setMediaKeys(null)}).catch(function(){}))},b.onManifestParsed=function(v,i){if(!!this._emeEnabled){var d=i.levels.map(function(T){return T.audioCodec}).filter(function(T){return!!T}),p=i.levels.map(function(T){return T.videoCodec}).filter(function(T){return!!T});this._attemptKeySystemAccess(M.KeySystems.WIDEVINE,d,p)}},O(_,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),_}();t.default=I},"./src/controller/fps-controller.ts":function(r,t,e){"use strict";e.r(t);var n=e("./src/events.ts"),a=e("./src/utils/logger.ts"),u=function(){function M(O){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=O,this.registerListeners()}var C=M.prototype;return C.setStreamController=function(L){this.streamController=L},C.registerListeners=function(){this.hls.on(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},C.unregisterListeners=function(){this.hls.off(n.Events.MEDIA_ATTACHING,this.onMediaAttaching)},C.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},C.onMediaAttaching=function(L,A){var x=this.hls.config;if(x.capLevelOnFPSDrop){var I=A.media instanceof self.HTMLVideoElement?A.media:null;this.media=I,I&&typeof I.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),x.fpsDroppedMonitoringPeriod)}},C.checkFPS=function(L,A,x){var I=performance.now();if(A){if(this.lastTime){var _=I-this.lastTime,b=x-this.lastDroppedFrames,S=A-this.lastDecodedFrames,v=1e3*b/_,i=this.hls;if(i.trigger(n.Events.FPS_DROP,{currentDropped:b,currentDecoded:S,totalDroppedFrames:x}),v>0&&b>i.config.fpsDroppedMonitoringThreshold*S){var d=i.currentLevel;a.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(i.autoLevelCapping===-1||i.autoLevelCapping>=d)&&(d=d-1,i.trigger(n.Events.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:i.currentLevel}),i.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=I,this.lastDroppedFrames=x,this.lastDecodedFrames=A}},C.checkFPSInterval=function(){var L=this.media;if(L)if(this.isVideoPlaybackQualityAvailable){var A=L.getVideoPlaybackQuality();this.checkFPS(L,A.totalVideoFrames,A.droppedVideoFrames)}else this.checkFPS(L,L.webkitDecodedFrameCount,L.webkitDroppedFrameCount)},M}();t.default=u},"./src/controller/fragment-finders.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"findFragmentByPDT",function(){return u}),e.d(t,"findFragmentByPTS",function(){return M}),e.d(t,"fragmentWithinToleranceTest",function(){return C}),e.d(t,"pdtWithinToleranceTest",function(){return O}),e.d(t,"findFragWithCC",function(){return L});var n=e("./src/polyfills/number.ts"),a=e("./src/utils/binary-search.ts");function u(A,x,I){if(x===null||!Array.isArray(A)||!A.length||!Object(n.isFiniteNumber)(x))return null;var _=A[0].programDateTime;if(x<(_||0))return null;var b=A[A.length-1].endProgramDateTime;if(x>=(b||0))return null;I=I||0;for(var S=0;S<A.length;++S){var v=A[S];if(O(x,I,v))return v}return null}function M(A,x,I,_){I===void 0&&(I=0),_===void 0&&(_=0);var b=null;if(A?b=x[A.sn-x[0].sn+1]||null:I===0&&x[0].start===0&&(b=x[0]),b&&C(I,_,b)===0)return b;var S=a.default.search(x,C.bind(null,I,_));return S||b}function C(A,x,I){A===void 0&&(A=0),x===void 0&&(x=0);var _=Math.min(x,I.duration+(I.deltaPTS?I.deltaPTS:0));return I.start+I.duration-_<=A?1:I.start-_>A&&I.start?-1:0}function O(A,x,I){var _=Math.min(x,I.duration+(I.deltaPTS?I.deltaPTS:0))*1e3,b=I.endProgramDateTime||0;return b-_>A}function L(A,x){return a.default.search(A,function(I){return I.cc<x?1:I.cc>x?-1:0})}},"./src/controller/fragment-tracker.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"FragmentState",function(){return u}),e.d(t,"FragmentTracker",function(){return M});var n=e("./src/events.ts"),a=e("./src/types/loader.ts"),u;(function(L){L.NOT_LOADED="NOT_LOADED",L.APPENDING="APPENDING",L.PARTIAL="PARTIAL",L.OK="OK"})(u||(u={}));var M=function(){function L(x){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=x,this._registerListeners()}var A=L.prototype;return A._registerListeners=function(){var I=this.hls;I.on(n.Events.BUFFER_APPENDED,this.onBufferAppended,this),I.on(n.Events.FRAG_BUFFERED,this.onFragBuffered,this),I.on(n.Events.FRAG_LOADED,this.onFragLoaded,this)},A._unregisterListeners=function(){var I=this.hls;I.off(n.Events.BUFFER_APPENDED,this.onBufferAppended,this),I.off(n.Events.FRAG_BUFFERED,this.onFragBuffered,this),I.off(n.Events.FRAG_LOADED,this.onFragLoaded,this)},A.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},A.getAppendedFrag=function(I,_){if(_===a.PlaylistLevelType.MAIN){var b=this.activeFragment,S=this.activeParts;if(!b)return null;if(S)for(var v=S.length;v--;){var i=S[v],d=i?i.end:b.appendedPTS;if(i.start<=I&&d!==void 0&&I<=d)return v>9&&(this.activeParts=S.slice(v-9)),i}else if(b.start<=I&&b.appendedPTS!==void 0&&I<=b.appendedPTS)return b}return this.getBufferedFrag(I,_)},A.getBufferedFrag=function(I,_){for(var b=this.fragments,S=Object.keys(b),v=S.length;v--;){var i=b[S[v]];if((i==null?void 0:i.body.type)===_&&i.buffered){var d=i.body;if(d.start<=I&&I<=d.end)return d}}return null},A.detectEvictedFragments=function(I,_,b){var S=this;Object.keys(this.fragments).forEach(function(v){var i=S.fragments[v];if(!!i){if(!i.buffered){i.body.type===b&&S.removeFragment(i.body);return}var d=i.range[I];!d||d.time.some(function(p){var T=!S.isTimeBuffered(p.startPTS,p.endPTS,_);return T&&S.removeFragment(i.body),T})}})},A.detectPartialFragments=function(I){var _=this,b=this.timeRanges,S=I.frag,v=I.part;if(!(!b||S.sn==="initSegment")){var i=O(S),d=this.fragments[i];!d||(Object.keys(b).forEach(function(p){var T=S.elementaryStreams[p];if(!!T){var l=b[p],o=v!==null||T.partial===!0;d.range[p]=_.getBufferedTimes(S,v,o,l)}}),d.loaded=null,Object.keys(d.range).length?d.buffered=!0:this.removeFragment(d.body))}},A.fragBuffered=function(I){var _=O(I),b=this.fragments[_];b&&(b.loaded=null,b.buffered=!0)},A.getBufferedTimes=function(I,_,b,S){for(var v={time:[],partial:b},i=_?_.start:I.start,d=_?_.end:I.end,p=I.minEndPTS||d,T=I.maxStartPTS||i,l=0;l<S.length;l++){var o=S.start(l)-this.bufferPadding,h=S.end(l)+this.bufferPadding;if(T>=o&&p<=h){v.time.push({startPTS:Math.max(i,S.start(l)),endPTS:Math.min(d,S.end(l))});break}else if(i<h&&d>o)v.partial=!0,v.time.push({startPTS:Math.max(i,S.start(l)),endPTS:Math.min(d,S.end(l))});else if(d<=o)break}return v},A.getPartialFragment=function(I){var _=null,b,S,v,i=0,d=this.bufferPadding,p=this.fragments;return Object.keys(p).forEach(function(T){var l=p[T];!l||C(l)&&(S=l.body.start-d,v=l.body.end+d,I>=S&&I<=v&&(b=Math.min(I-S,v-I),i<=b&&(_=l.body,i=b)))}),_},A.getState=function(I){var _=O(I),b=this.fragments[_];return b?b.buffered?C(b)?u.PARTIAL:u.OK:u.APPENDING:u.NOT_LOADED},A.isTimeBuffered=function(I,_,b){for(var S,v,i=0;i<b.length;i++){if(S=b.start(i)-this.bufferPadding,v=b.end(i)+this.bufferPadding,I>=S&&_<=v)return!0;if(_<=S)return!1}return!1},A.onFragLoaded=function(I,_){var b=_.frag,S=_.part;if(!(b.sn==="initSegment"||b.bitrateTest||S)){var v=O(b);this.fragments[v]={body:b,loaded:_,buffered:!1,range:Object.create(null)}}},A.onBufferAppended=function(I,_){var b=this,S=_.frag,v=_.part,i=_.timeRanges;if(S.type===a.PlaylistLevelType.MAIN)if(this.activeFragment=S,v){var d=this.activeParts;d||(this.activeParts=d=[]),d.push(v)}else this.activeParts=null;this.timeRanges=i,Object.keys(i).forEach(function(p){var T=i[p];if(b.detectEvictedFragments(p,T),!v)for(var l=0;l<T.length;l++)S.appendedPTS=Math.max(T.end(l),S.appendedPTS||0)})},A.onFragBuffered=function(I,_){this.detectPartialFragments(_)},A.hasFragment=function(I){var _=O(I);return!!this.fragments[_]},A.removeFragmentsInRange=function(I,_,b){var S=this;Object.keys(this.fragments).forEach(function(v){var i=S.fragments[v];if(!!i&&i.buffered){var d=i.body;d.type===b&&d.start<_&&d.end>I&&S.removeFragment(d)}})},A.removeFragment=function(I){var _=O(I);I.stats.loaded=0,I.clearElementaryStreamInfo(),delete this.fragments[_]},A.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},L}();function C(L){var A,x;return L.buffered&&(((A=L.range.video)===null||A===void 0?void 0:A.partial)||((x=L.range.audio)===null||x===void 0?void 0:x.partial))}function O(L){return L.type+"_"+L.level+"_"+L.urlId+"_"+L.sn}},"./src/controller/gap-controller.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"STALL_MINIMUM_DURATION_MS",function(){return C}),e.d(t,"MAX_START_GAP_JUMP",function(){return O}),e.d(t,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return L}),e.d(t,"SKIP_BUFFER_RANGE_START",function(){return A}),e.d(t,"default",function(){return x});var n=e("./src/utils/buffer-helper.ts"),a=e("./src/errors.ts"),u=e("./src/events.ts"),M=e("./src/utils/logger.ts"),C=250,O=2,L=.1,A=.05,x=function(){function I(b,S,v,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=b,this.media=S,this.fragmentTracker=v,this.hls=i}var _=I.prototype;return _.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},_.poll=function(S,v){var i=this.config,d=this.media,p=this.stalled;if(d!==null){var T=d.currentTime,l=d.seeking,o=this.seeking&&!l,h=!this.seeking&&l;if(this.seeking=l,T!==S){if(this.moved=!0,p!==null){if(this.stallReported){var E=self.performance.now()-p;M.logger.warn("playback not stuck anymore @"+T+", after "+Math.round(E)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((h||o)&&(this.stalled=null),!(d.paused&&!l||d.ended||d.playbackRate===0||!n.BufferHelper.getBuffered(d).length)){var s=n.BufferHelper.bufferInfo(d,T,0),c=s.len>0,m=s.nextStart||0;if(!(!c&&!m)){if(l){var f=s.len>O,g=!m||v&&v.start<=T||m-T>O&&!this.fragmentTracker.getPartialFragment(T);if(f||g)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var y,R=Math.max(m,s.start||0)-T,D=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,P=D==null||(y=D.details)===null||y===void 0?void 0:y.live,N=P?D.details.targetduration*2:O;if(R>0&&R<=N){this._trySkipBufferHole(null);return}}var B=self.performance.now();if(p===null){this.stalled=B;return}var F=B-p;if(!(!l&&F>=C&&(this._reportStall(s),!this.media))){var H=n.BufferHelper.bufferInfo(d,T,i.maxBufferHole);this._tryFixBufferStall(H,F)}}}}},_._tryFixBufferStall=function(S,v){var i=this.config,d=this.fragmentTracker,p=this.media;if(p!==null){var T=p.currentTime,l=d.getPartialFragment(T);if(l){var o=this._trySkipBufferHole(l);if(o||!this.media)return}S.len>i.maxBufferHole&&v>i.highBufferWatchdogPeriod*1e3&&(M.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},_._reportStall=function(S){var v=this.hls,i=this.media,d=this.stallReported;!d&&i&&(this.stallReported=!0,M.logger.warn("Playback stalling at @"+i.currentTime+" due to low buffer ("+JSON.stringify(S)+")"),v.trigger(u.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:S.len}))},_._trySkipBufferHole=function(S){var v=this.config,i=this.hls,d=this.media;if(d===null)return 0;for(var p=d.currentTime,T=0,l=n.BufferHelper.getBuffered(d),o=0;o<l.length;o++){var h=l.start(o);if(p+v.maxBufferHole>=T&&p<h){var E=Math.max(h+A,d.currentTime+L);return M.logger.warn("skipping hole, adjusting currentTime from "+p+" to "+E),this.moved=!0,this.stalled=null,d.currentTime=E,S&&i.trigger(u.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+p+" to "+E,frag:S}),E}T=l.end(o)}return 0},_._tryNudgeBuffer=function(){var S=this.config,v=this.hls,i=this.media,d=this.nudgeRetry;if(i!==null){var p=i.currentTime;if(this.nudgeRetry++,d<S.nudgeMaxRetry){var T=p+(d+1)*S.nudgeOffset;M.logger.warn("Nudging 'currentTime' from "+p+" to "+T),i.currentTime=T,v.trigger(u.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else M.logger.error("Playhead still not moving while enough data buffered @"+p+" after "+S.nudgeMaxRetry+" nudges"),v.trigger(u.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},I}()},"./src/controller/id3-track-controller.ts":function(r,t,e){"use strict";e.r(t);var n=e("./src/polyfills/number.ts"),a=e("./src/events.ts"),u=e("./src/utils/texttrack-utils.ts"),M=e("./src/demux/id3.ts"),C=e("./src/loader/date-range.ts"),O=e("./src/types/demuxer.ts"),L=.25;function A(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function x(b,S){return b.getTime()/1e3-S}function I(b){return Uint8Array.from(b.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var _=function(){function b(v){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=v,this._registerListeners()}var S=b.prototype;return S.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},S._registerListeners=function(){var i=this.hls;i.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(a.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),i.on(a.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.on(a.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},S._unregisterListeners=function(){var i=this.hls;i.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(a.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),i.off(a.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.off(a.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},S.onMediaAttached=function(i,d){this.media=d.media},S.onMediaDetaching=function(){!this.id3Track||(Object(u.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},S.onManifestLoading=function(){this.dateRangeCuesAppended={}},S.createTrack=function(i){var d=this.getID3Track(i.textTracks);return d.mode="hidden",d},S.getID3Track=function(i){if(!!this.media){for(var d=0;d<i.length;d++){var p=i[d];if(p.kind==="metadata"&&p.label==="id3")return Object(u.sendAddTrackEvent)(p,this.media),p}return this.media.addTextTrack("metadata","id3")}},S.onFragParsingMetadata=function(i,d){if(!!this.media){var p=this.hls.config,T=p.enableEmsgMetadataCues,l=p.enableID3MetadataCues;if(!(!T&&!l)){var o=d.frag,h=d.samples,E=d.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var s=E.edge||o.end,c=A(),m=!1,f={},g=0;g<h.length;g++){var y=h[g].type;if(!(y===O.MetadataSchema.emsg&&!T||!l)){var R=M.getID3Frames(h[g].data);if(R){var D=h[g].pts,P=s,N=P-D;N<=0&&(P=D+L);for(var B=0;B<R.length;B++){var F=R[B];if(!M.isTimeStampFrame(F)){var H=new c(D,P,"");H.value=F,y&&(H.type=y),this.id3Track.addCue(H),f[F.key]=null,m=!0}}}}}m&&this.updateId3CueEnds(f)}}},S.updateId3CueEnds=function(i){var d,p=(d=this.id3Track)===null||d===void 0?void 0:d.cues;if(p)for(var T=p.length;T--;){var l,o=p[T],h=(l=o.value)===null||l===void 0?void 0:l.key;if(h&&h in i){var E=i[h];E&&o.endTime!==E&&(o.endTime=E),i[h]=o.startTime}}},S.onBufferFlushing=function(i,d){var p=d.startOffset,T=d.endOffset,l=d.type,o=this.id3Track,h=this.hls;if(!!h){var E=h.config,s=E.enableEmsgMetadataCues,c=E.enableID3MetadataCues;if(o&&(s||c)){var m;l==="audio"?m=function(g){return g.type===O.MetadataSchema.audioId3&&c}:l==="video"?m=function(g){return g.type===O.MetadataSchema.emsg&&s}:m=function(g){return g.type===O.MetadataSchema.audioId3&&c||g.type===O.MetadataSchema.emsg&&s},Object(u.removeCuesInRange)(o,p,T,m)}}},S.onLevelUpdated=function(i,d){var p=this,T=d.details;if(!(!this.media||!T.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var l=this.dateRangeCuesAppended,o=this.id3Track,h=T.dateRanges,E=Object.keys(h);if(o)for(var s=Object.keys(l).filter(function(N){return!E.includes(N)}),c=function(B){var F=s[B];Object.keys(l[F].cues).forEach(function(H){o.removeCue(l[F].cues[H])}),delete l[F]},m=s.length;m--;)c(m);var f=T.fragments[T.fragments.length-1];if(!(E.length===0||!Object(n.isFiniteNumber)(f==null?void 0:f.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var g=f.programDateTime/1e3-f.start,y=T.edge||f.end,R=A(),D=function(B){var F=E[B],H=h[F],j=l[F],X=(j==null?void 0:j.cues)||{},$=(j==null?void 0:j.durationKnown)||!1,G=x(H.startDate,g),J=y,ee=H.endDate;if(ee)J=x(ee,g),$=!0;else if(H.endOnNext&&!$){var te=E.reduce(function(ae,Me){var Se=h[Me];return Se.class===H.class&&Se.id!==Me&&Se.startDate>H.startDate&&ae.push(Se),ae},[]).sort(function(ae,Me){return ae.startDate.getTime()-Me.startDate.getTime()})[0];te&&(J=x(te.startDate,g),$=!0)}for(var oe=Object.keys(H.attr),ue=0;ue<oe.length;ue++){var ne=oe[ue];if(!(ne===C.DateRangeAttribute.ID||ne===C.DateRangeAttribute.CLASS||ne===C.DateRangeAttribute.START_DATE||ne===C.DateRangeAttribute.DURATION||ne===C.DateRangeAttribute.END_DATE||ne===C.DateRangeAttribute.END_ON_NEXT)){var he=X[ne];if(he)$&&!j.durationKnown&&(he.endTime=J);else{var me=H.attr[ne];he=new R(G,J,""),(ne===C.DateRangeAttribute.SCTE35_OUT||ne===C.DateRangeAttribute.SCTE35_IN)&&(me=I(me)),he.value={key:ne,data:me},he.type=O.MetadataSchema.dateRange,p.id3Track.addCue(he),X[ne]=he}}}l[F]={cues:X,dateRange:H,durationKnown:$}},P=0;P<E.length;P++)D(P)}}},b}();t.default=_},"./src/controller/latency-controller.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return O});var n=e("./src/errors.ts"),a=e("./src/events.ts"),u=e("./src/utils/logger.ts");function M(L,A){for(var x=0;x<A.length;x++){var I=A[x];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(L,I.key,I)}}function C(L,A,x){return A&&M(L.prototype,A),x&&M(L,x),Object.defineProperty(L,"prototype",{writable:!1}),L}var O=function(){function L(x){var I=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return I.timeupdate()},this.hls=x,this.config=x.config,this.registerListeners()}var A=L.prototype;return A.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},A.registerListeners=function(){this.hls.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(a.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(a.Events.ERROR,this.onError,this)},A.unregisterListeners=function(){this.hls.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(a.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(a.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(a.Events.ERROR,this.onError)},A.onMediaAttached=function(I,_){this.media=_.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},A.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},A.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},A.onLevelUpdated=function(I,_){var b=_.details;this.levelDetails=b,b.advanced&&this.timeupdate(),!b.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},A.onError=function(I,_){_.details===n.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,u.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},A.timeupdate=function(){var I=this.media,_=this.levelDetails;if(!(!I||!_)){this.currentTime=I.currentTime;var b=this.computeLatency();if(b!==null){this._latency=b;var S=this.config,v=S.lowLatencyMode,i=S.maxLiveSyncPlaybackRate;if(!(!v||i===1)){var d=this.targetLatency;if(d!==null){var p=b-d,T=Math.min(this.maxLatency,d+_.targetduration),l=p<T;if(_.live&&l&&p>.05&&this.forwardBufferLength>1){var o=Math.min(2,Math.max(1,i)),h=Math.round(2/(1+Math.exp(-.75*p-this.edgeStalled))*20)/20;I.playbackRate=Math.min(o,Math.max(1,h))}else I.playbackRate!==1&&I.playbackRate!==0&&(I.playbackRate=1)}}}}},A.estimateLiveEdge=function(){var I=this.levelDetails;return I===null?null:I.edge+I.age},A.computeLatency=function(){var I=this.estimateLiveEdge();return I===null?null:I-this.currentTime},C(L,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var I=this.config,_=this.levelDetails;return I.liveMaxLatencyDuration!==void 0?I.liveMaxLatencyDuration:_?I.liveMaxLatencyDurationCount*_.targetduration:0}},{key:"targetLatency",get:function(){var I=this.levelDetails;if(I===null)return null;var _=I.holdBack,b=I.partHoldBack,S=I.targetduration,v=this.config,i=v.liveSyncDuration,d=v.liveSyncDurationCount,p=v.lowLatencyMode,T=this.hls.userConfig,l=p&&b||_;(T.liveSyncDuration||T.liveSyncDurationCount||l===0)&&(l=i!==void 0?i:d*S);var o=S,h=1;return l+Math.min(this.stallCount*h,o)}},{key:"liveSyncPosition",get:function(){var I=this.estimateLiveEdge(),_=this.targetLatency,b=this.levelDetails;if(I===null||_===null||b===null)return null;var S=b.edge,v=I-_-this.edgeStalled,i=S-b.totalduration,d=S-(this.config.lowLatencyMode&&b.partTarget||b.targetduration);return Math.min(Math.max(i,v),d)}},{key:"drift",get:function(){var I=this.levelDetails;return I===null?1:I.drift}},{key:"edgeStalled",get:function(){var I=this.levelDetails;if(I===null)return 0;var _=(this.config.lowLatencyMode&&I.partTarget||I.targetduration)*3;return Math.max(I.age-_,0)}},{key:"forwardBufferLength",get:function(){var I=this.media,_=this.levelDetails;if(!I||!_)return 0;var b=I.buffered.length;return(b?I.buffered.end(b-1):_.edge)-this.currentTime}}]),L}()},"./src/controller/level-controller.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return v});var n=e("./src/types/level.ts"),a=e("./src/events.ts"),u=e("./src/errors.ts"),M=e("./src/utils/codecs.ts"),C=e("./src/controller/level-helper.ts"),O=e("./src/controller/base-playlist-controller.ts"),L=e("./src/types/loader.ts");function A(){return A=Object.assign?Object.assign.bind():function(i){for(var d=1;d<arguments.length;d++){var p=arguments[d];for(var T in p)Object.prototype.hasOwnProperty.call(p,T)&&(i[T]=p[T])}return i},A.apply(this,arguments)}function x(i,d){for(var p=0;p<d.length;p++){var T=d[p];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(i,T.key,T)}}function I(i,d,p){return d&&x(i.prototype,d),p&&x(i,p),Object.defineProperty(i,"prototype",{writable:!1}),i}function _(i,d){i.prototype=Object.create(d.prototype),i.prototype.constructor=i,b(i,d)}function b(i,d){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(T,l){return T.__proto__=l,T},b(i,d)}var S=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),v=function(i){_(d,i);function d(T){var l;return l=i.call(this,T,"[level-controller]")||this,l._levels=[],l._firstLevel=-1,l._startLevel=void 0,l.currentLevelIndex=-1,l.manualLevelIndex=-1,l.onParsedComplete=void 0,l._registerListeners(),l}var p=d.prototype;return p._registerListeners=function(){var l=this.hls;l.on(a.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.on(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.on(a.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),l.on(a.Events.FRAG_LOADED,this.onFragLoaded,this),l.on(a.Events.ERROR,this.onError,this)},p._unregisterListeners=function(){var l=this.hls;l.off(a.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.off(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.off(a.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),l.off(a.Events.FRAG_LOADED,this.onFragLoaded,this),l.off(a.Events.ERROR,this.onError,this)},p.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,i.prototype.destroy.call(this)},p.startLoad=function(){var l=this._levels;l.forEach(function(o){o.loadError=0}),i.prototype.startLoad.call(this)},p.onManifestLoaded=function(l,o){var h=[],E=[],s=[],c,m={},f,g=!1,y=!1,R=!1;if(o.levels.forEach(function(B){var F=B.attrs;g=g||!!(B.width&&B.height),y=y||!!B.videoCodec,R=R||!!B.audioCodec,S&&B.audioCodec&&B.audioCodec.indexOf("mp4a.40.34")!==-1&&(B.audioCodec=void 0);var H=B.bitrate+"-"+B.attrs.RESOLUTION+"-"+B.attrs.CODECS;f=m[H],f?f.url.push(B.url):(f=new n.Level(B),m[H]=f,h.push(f)),F&&(F.AUDIO&&Object(C.addGroupId)(f,"audio",F.AUDIO),F.SUBTITLES&&Object(C.addGroupId)(f,"text",F.SUBTITLES))}),(g||y)&&R&&(h=h.filter(function(B){var F=B.videoCodec,H=B.width,j=B.height;return!!F||!!(H&&j)})),h=h.filter(function(B){var F=B.audioCodec,H=B.videoCodec;return(!F||Object(M.isCodecSupportedInMp4)(F,"audio"))&&(!H||Object(M.isCodecSupportedInMp4)(H,"video"))}),o.audioTracks&&(E=o.audioTracks.filter(function(B){return!B.audioCodec||Object(M.isCodecSupportedInMp4)(B.audioCodec,"audio")}),Object(C.assignTrackIdsByGroup)(E)),o.subtitles&&(s=o.subtitles,Object(C.assignTrackIdsByGroup)(s)),h.length>0){c=h[0].bitrate,h.sort(function(B,F){return B.bitrate-F.bitrate}),this._levels=h;for(var D=0;D<h.length;D++)if(h[D].bitrate===c){this._firstLevel=D,this.log("manifest loaded, "+h.length+" level(s) found, first bitrate: "+c);break}var P=R&&!y,N={levels:h,audioTracks:E,subtitleTracks:s,firstLevel:this._firstLevel,stats:o.stats,audio:R,video:y,altAudio:!P&&E.some(function(B){return!!B.url})};this.hls.trigger(a.Events.MANIFEST_PARSED,N),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(a.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:o.url,reason:"no level with compatible codecs found in manifest"})},p.onError=function(l,o){var h;if(i.prototype.onError.call(this,l,o),!o.fatal){var E=o.context,s=this._levels[this.currentLevelIndex];if(E&&(E.type===L.PlaylistContextType.AUDIO_TRACK&&s.audioGroupIds&&E.groupId===s.audioGroupIds[s.urlId]||E.type===L.PlaylistContextType.SUBTITLE_TRACK&&s.textGroupIds&&E.groupId===s.textGroupIds[s.urlId])){this.redundantFailover(this.currentLevelIndex);return}var c=!1,m=!0,f;switch(o.details){case u.ErrorDetails.FRAG_LOAD_ERROR:case u.ErrorDetails.FRAG_LOAD_TIMEOUT:case u.ErrorDetails.KEY_LOAD_ERROR:case u.ErrorDetails.KEY_LOAD_TIMEOUT:if(o.frag){var g=o.frag.type===L.PlaylistLevelType.MAIN?o.frag.level:this.currentLevelIndex,y=this._levels[g];y?(y.fragmentError++,y.fragmentError>this.hls.config.fragLoadingMaxRetry&&(f=g)):f=g}break;case u.ErrorDetails.LEVEL_LOAD_ERROR:case u.ErrorDetails.LEVEL_LOAD_TIMEOUT:E&&(E.deliveryDirectives&&(m=!1),f=E.level),c=!0;break;case u.ErrorDetails.REMUX_ALLOC_ERROR:f=(h=o.level)!=null?h:this.currentLevelIndex,c=!0;break}f!==void 0&&this.recoverLevel(o,f,c,m)}},p.recoverLevel=function(l,o,h,E){var s=l.details,c=this._levels[o];if(c.loadError++,h){var m=this.retryLoadingOrFail(l);if(m)l.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(E){var f=c.url.length;if(f>1&&c.loadError<f)l.levelRetry=!0,this.redundantFailover(o);else if(this.manualLevelIndex===-1){for(var g=-1,y=this._levels,R=y.length;R--;){var D=(R+this.currentLevelIndex)%y.length;if(D!==this.currentLevelIndex&&y[D].loadError===0){g=D;break}}g>-1&&this.currentLevelIndex!==g&&(this.warn(s+": switch to "+g),l.levelRetry=!0,this.hls.nextAutoLevel=g)}}},p.redundantFailover=function(l){var o=this._levels[l],h=o.url.length;if(h>1){var E=(o.urlId+1)%h;this.warn("Switching to redundant URL-id "+E),this._levels.forEach(function(s){s.urlId=E}),this.level=l}},p.onFragLoaded=function(l,o){var h=o.frag;if(h!==void 0&&h.type===L.PlaylistLevelType.MAIN){var E=this._levels[h.level];E!==void 0&&(E.fragmentError=0,E.loadError=0)}},p.onLevelLoaded=function(l,o){var h,E=o.level,s=o.details,c=this._levels[E];if(!c){var m;this.warn("Invalid level index "+E),(m=o.deliveryDirectives)!==null&&m!==void 0&&m.skip&&(s.deltaUpdateFailed=!0);return}E===this.currentLevelIndex?(c.fragmentError===0&&(c.loadError=0,this.retryCount=0),this.playlistLoaded(E,o,c.details)):(h=o.deliveryDirectives)!==null&&h!==void 0&&h.skip&&(s.deltaUpdateFailed=!0)},p.onAudioTrackSwitched=function(l,o){var h=this.hls.levels[this.currentLevelIndex];if(!!h&&h.audioGroupIds){for(var E=-1,s=this.hls.audioTracks[o.id].groupId,c=0;c<h.audioGroupIds.length;c++)if(h.audioGroupIds[c]===s){E=c;break}E!==h.urlId&&(h.urlId=E,this.startLoad())}},p.loadPlaylist=function(l){var o=this.currentLevelIndex,h=this._levels[o];if(this.canLoad&&h&&h.url.length>0){var E=h.urlId,s=h.url[E];if(l)try{s=l.addDirectives(s)}catch(c){this.warn("Could not construct new URL with HLS Delivery Directives: "+c)}this.log("Attempt loading level index "+o+(l?" at sn "+l.msn+" part "+l.part:"")+" with URL-id "+E+" "+s),this.clearTimer(),this.hls.trigger(a.Events.LEVEL_LOADING,{url:s,level:o,id:E,deliveryDirectives:l||null})}},p.removeLevel=function(l,o){var h=function(c,m){return m!==o},E=this._levels.filter(function(s,c){return c!==l?!0:s.url.length>1&&o!==void 0?(s.url=s.url.filter(h),s.audioGroupIds&&(s.audioGroupIds=s.audioGroupIds.filter(h)),s.textGroupIds&&(s.textGroupIds=s.textGroupIds.filter(h)),s.urlId=0,!0):!1}).map(function(s,c){var m=s.details;return m!=null&&m.fragments&&m.fragments.forEach(function(f){f.level=c}),s});this._levels=E,this.hls.trigger(a.Events.LEVELS_UPDATED,{levels:E})},I(d,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(l){var o,h=this._levels;if(h.length!==0&&!(this.currentLevelIndex===l&&(o=h[l])!==null&&o!==void 0&&o.details)){if(l<0||l>=h.length){var E=l<0;if(this.hls.trigger(a.Events.ERROR,{type:u.ErrorTypes.OTHER_ERROR,details:u.ErrorDetails.LEVEL_SWITCH_ERROR,level:l,fatal:E,reason:"invalid level idx"}),E)return;l=Math.min(l,h.length-1)}this.clearTimer();var s=this.currentLevelIndex,c=h[s],m=h[l];this.log("switching to level "+l+" from "+s),this.currentLevelIndex=l;var f=A({},m,{level:l,maxBitrate:m.maxBitrate,uri:m.uri,urlId:m.urlId});delete f._urlId,this.hls.trigger(a.Events.LEVEL_SWITCHING,f);var g=m.details;if(!g||g.live){var y=this.switchParams(m.uri,c==null?void 0:c.details);this.loadPlaylist(y)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(l){this.manualLevelIndex=l,this._startLevel===void 0&&(this._startLevel=l),l!==-1&&(this.level=l)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(l){this._firstLevel=l}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var l=this.hls.config.startLevel;return l!==void 0?l:this._firstLevel}else return this._startLevel},set:function(l){this._startLevel=l}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(l){this.level=l,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=l)}}]),d}(O.default)},"./src/controller/level-helper.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"addGroupId",function(){return C}),e.d(t,"assignTrackIdsByGroup",function(){return O}),e.d(t,"updatePTS",function(){return L}),e.d(t,"updateFragPTSDTS",function(){return x}),e.d(t,"mergeDetails",function(){return I}),e.d(t,"mapPartIntersection",function(){return b}),e.d(t,"mapFragmentIntersection",function(){return S}),e.d(t,"adjustSliding",function(){return v}),e.d(t,"addSliding",function(){return i}),e.d(t,"computeReloadInterval",function(){return d}),e.d(t,"getFragmentWithSN",function(){return p}),e.d(t,"getPartWith",function(){return T});var n=e("./src/polyfills/number.ts"),a=e("./src/utils/logger.ts"),u=e("./src/loader/date-range.ts");function M(){return M=Object.assign?Object.assign.bind():function(l){for(var o=1;o<arguments.length;o++){var h=arguments[o];for(var E in h)Object.prototype.hasOwnProperty.call(h,E)&&(l[E]=h[E])}return l},M.apply(this,arguments)}function C(l,o,h){switch(o){case"audio":l.audioGroupIds||(l.audioGroupIds=[]),l.audioGroupIds.push(h);break;case"text":l.textGroupIds||(l.textGroupIds=[]),l.textGroupIds.push(h);break}}function O(l){var o={};l.forEach(function(h){var E=h.groupId||"";h.id=o[E]=o[E]||0,o[E]++})}function L(l,o,h){var E=l[o],s=l[h];A(E,s)}function A(l,o){var h=o.startPTS;if(Object(n.isFiniteNumber)(h)){var E=0,s;o.sn>l.sn?(E=h-l.start,s=l):(E=l.start-h,s=o),s.duration!==E&&(s.duration=E)}else if(o.sn>l.sn){var c=l.cc===o.cc;c&&l.minEndPTS?o.start=l.start+(l.minEndPTS-l.start):o.start=l.start+l.duration}else o.start=Math.max(l.start-o.duration,0)}function x(l,o,h,E,s,c){var m=E-h;m<=0&&(a.logger.warn("Fragment should have a positive duration",o),E=h+o.duration,c=s+o.duration);var f=h,g=E,y=o.startPTS,R=o.endPTS;if(Object(n.isFiniteNumber)(y)){var D=Math.abs(y-h);Object(n.isFiniteNumber)(o.deltaPTS)?o.deltaPTS=Math.max(D,o.deltaPTS):o.deltaPTS=D,f=Math.max(h,y),h=Math.min(h,y),s=Math.min(s,o.startDTS),g=Math.min(E,R),E=Math.max(E,R),c=Math.max(c,o.endDTS)}o.duration=E-h;var P=h-o.start;o.appendedPTS=E,o.start=o.startPTS=h,o.maxStartPTS=f,o.startDTS=s,o.endPTS=E,o.minEndPTS=g,o.endDTS=c;var N=o.sn;if(!l||N<l.startSN||N>l.endSN)return 0;var B,F=N-l.startSN,H=l.fragments;for(H[F]=o,B=F;B>0;B--)A(H[B],H[B-1]);for(B=F;B<H.length-1;B++)A(H[B],H[B+1]);return l.fragmentHint&&A(H[H.length-1],l.fragmentHint),l.PTSKnown=l.alignedSliding=!0,P}function I(l,o){for(var h=null,E=l.fragments,s=E.length-1;s>=0;s--){var c=E[s].initSegment;if(c){h=c;break}}l.fragmentHint&&delete l.fragmentHint.endPTS;var m=0,f;if(S(l,o,function(B,F){B.relurl&&(m=B.cc-F.cc),Object(n.isFiniteNumber)(B.startPTS)&&Object(n.isFiniteNumber)(B.endPTS)&&(F.start=F.startPTS=B.startPTS,F.startDTS=B.startDTS,F.appendedPTS=B.appendedPTS,F.maxStartPTS=B.maxStartPTS,F.endPTS=B.endPTS,F.endDTS=B.endDTS,F.minEndPTS=B.minEndPTS,F.duration=B.endPTS-B.startPTS,F.duration&&(f=F),o.PTSKnown=o.alignedSliding=!0),F.elementaryStreams=B.elementaryStreams,F.loader=B.loader,F.stats=B.stats,F.urlId=B.urlId,B.initSegment&&(F.initSegment=B.initSegment,h=B.initSegment)}),h){var g=o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments;g.forEach(function(B){var F;(!B.initSegment||B.initSegment.relurl===((F=h)===null||F===void 0?void 0:F.relurl))&&(B.initSegment=h)})}if(o.skippedSegments)if(o.deltaUpdateFailed=o.fragments.some(function(B){return!B}),o.deltaUpdateFailed){a.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var y=o.skippedSegments;y--;)o.fragments.shift();o.startSN=o.fragments[0].sn,o.startCC=o.fragments[0].cc}else o.canSkipDateRanges&&(o.dateRanges=_(l.dateRanges,o.dateRanges,o.recentlyRemovedDateranges));var R=o.fragments;if(m){a.logger.warn("discontinuity sliding from playlist, take drift into account");for(var D=0;D<R.length;D++)R[D].cc+=m}o.skippedSegments&&(o.startCC=o.fragments[0].cc),b(l.partList,o.partList,function(B,F){F.elementaryStreams=B.elementaryStreams,F.stats=B.stats}),f?x(o,f,f.startPTS,f.endPTS,f.startDTS,f.endDTS):v(l,o),R.length&&(o.totalduration=o.edge-R[0].start),o.driftStartTime=l.driftStartTime,o.driftStart=l.driftStart;var P=o.advancedDateTime;if(o.advanced&&P){var N=o.edge;o.driftStart||(o.driftStartTime=P,o.driftStart=N),o.driftEndTime=P,o.driftEnd=N}else o.driftEndTime=l.driftEndTime,o.driftEnd=l.driftEnd,o.advancedDateTime=l.advancedDateTime}function _(l,o,h){var E=M({},l);return h&&h.forEach(function(s){delete E[s]}),Object.keys(o).forEach(function(s){var c=new u.DateRange(o[s].attr,E[s]);c.isValid?E[s]=c:a.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(o[s].attr)+'"')}),E}function b(l,o,h){if(l&&o)for(var E=0,s=0,c=l.length;s<=c;s++){var m=l[s],f=o[s+E];m&&f&&m.index===f.index&&m.fragment.sn===f.fragment.sn?h(m,f):E--}}function S(l,o,h){for(var E=o.skippedSegments,s=Math.max(l.startSN,o.startSN)-o.startSN,c=(l.fragmentHint?1:0)+(E?o.endSN:Math.min(l.endSN,o.endSN))-o.startSN,m=o.startSN-l.startSN,f=o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments,g=l.fragmentHint?l.fragments.concat(l.fragmentHint):l.fragments,y=s;y<=c;y++){var R=g[m+y],D=f[y];E&&!D&&y<E&&(D=o.fragments[y]=R),R&&D&&h(R,D)}}function v(l,o){var h=o.startSN+o.skippedSegments-l.startSN,E=l.fragments;h<0||h>=E.length||i(o,E[h].start)}function i(l,o){if(o){for(var h=l.fragments,E=l.skippedSegments;E<h.length;E++)h[E].start+=o;l.fragmentHint&&(l.fragmentHint.start+=o)}}function d(l,o){var h=1e3*l.levelTargetDuration,E=h/2,s=l.age,c=s>0&&s<h*3,m=o.loading.end-o.loading.start,f,g=l.availabilityDelay;if(l.updated===!1)if(c){var y=333*l.misses;f=Math.max(Math.min(E,m*2),y),l.availabilityDelay=(l.availabilityDelay||0)+f}else f=E;else c?(g=Math.min(g||h/2,s),l.availabilityDelay=g,f=g+h-s):f=h-m;return Math.round(f)}function p(l,o,h){if(!l||!l.details)return null;var E=l.details,s=E.fragments[o-E.startSN];return s||(s=E.fragmentHint,s&&s.sn===o)?s:o<E.startSN&&h&&h.sn===o?h:null}function T(l,o,h){if(!l||!l.details)return null;var E=l.details.partList;if(E)for(var s=E.length;s--;){var c=E[s];if(c.index===h&&c.fragment.sn===o)return c}return null}},"./src/controller/stream-controller.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return T});var n=e("./src/polyfills/number.ts"),a=e("./src/controller/base-stream-controller.ts"),u=e("./src/is-supported.ts"),M=e("./src/events.ts"),C=e("./src/utils/buffer-helper.ts"),O=e("./src/controller/fragment-tracker.ts"),L=e("./src/types/loader.ts"),A=e("./src/loader/fragment.ts"),x=e("./src/demux/transmuxer-interface.ts"),I=e("./src/types/transmuxer.ts"),_=e("./src/controller/gap-controller.ts"),b=e("./src/errors.ts");function S(l,o){for(var h=0;h<o.length;h++){var E=o[h];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(l,E.key,E)}}function v(l,o,h){return o&&S(l.prototype,o),h&&S(l,h),Object.defineProperty(l,"prototype",{writable:!1}),l}function i(l,o){l.prototype=Object.create(o.prototype),l.prototype.constructor=l,d(l,o)}function d(l,o){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(E,s){return E.__proto__=s,E},d(l,o)}var p=100,T=function(l){i(o,l);function o(E,s){var c;return c=l.call(this,E,s,"[stream-controller]")||this,c.audioCodecSwap=!1,c.gapController=null,c.level=-1,c._forceStartLoad=!1,c.altAudio=!1,c.audioOnly=!1,c.fragPlaying=null,c.onvplaying=null,c.onvseeked=null,c.fragLastKbps=0,c.couldBacktrack=!1,c.backtrackFragment=null,c.audioCodecSwitch=!1,c.videoBuffer=null,c._registerListeners(),c}var h=o.prototype;return h._registerListeners=function(){var s=this.hls;s.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),s.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),s.on(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(M.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),s.on(M.Events.ERROR,this.onError,this),s.on(M.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.on(M.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.on(M.Events.BUFFER_CREATED,this.onBufferCreated,this),s.on(M.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.on(M.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),s.on(M.Events.FRAG_BUFFERED,this.onFragBuffered,this)},h._unregisterListeners=function(){var s=this.hls;s.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),s.off(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(M.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),s.off(M.Events.ERROR,this.onError,this),s.off(M.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.off(M.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.off(M.Events.BUFFER_CREATED,this.onBufferCreated,this),s.off(M.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.off(M.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),s.off(M.Events.FRAG_BUFFERED,this.onFragBuffered,this)},h.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},h.startLoad=function(s){if(this.levels){var c=this.lastCurrentTime,m=this.hls;if(this.stopLoad(),this.setInterval(p),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var f=m.startLevel;f===-1&&(m.config.testBandwidth&&this.levels.length>1?(f=0,this.bitrateTest=!0):f=m.nextAutoLevel),this.level=m.nextLoadLevel=f,this.loadedmetadata=!1}c>0&&s===-1&&(this.log("Override startPosition with lastCurrentTime @"+c.toFixed(3)),s=c),this.state=a.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=s,this.tick()}else this._forceStartLoad=!0,this.state=a.State.STOPPED},h.stopLoad=function(){this._forceStartLoad=!1,l.prototype.stopLoad.call(this)},h.doTick=function(){switch(this.state){case a.State.IDLE:this.doTickIdle();break;case a.State.WAITING_LEVEL:{var s,c=this.levels,m=this.level,f=c==null||(s=c[m])===null||s===void 0?void 0:s.details;if(f&&(!f.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(f))break;this.state=a.State.IDLE;break}break}case a.State.FRAG_LOADING_WAITING_RETRY:{var g,y=self.performance.now(),R=this.retryDate;(!R||y>=R||(g=this.media)!==null&&g!==void 0&&g.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=a.State.IDLE)}break;default:break}this.onTickEnd()},h.onTickEnd=function(){l.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},h.doTickIdle=function(){var s,c,m=this.hls,f=this.levelLastLoaded,g=this.levels,y=this.media,R=m.config,D=m.nextLoadLevel;if(!(f===null||!y&&(this.startFragRequested||!R.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!g||!g[D])){var P=g[D];this.level=m.nextLoadLevel=D;var N=P.details;if(!N||this.state===a.State.WAITING_LEVEL||N.live&&this.levelLastLoaded!==D){this.state=a.State.WAITING_LEVEL;return}var B=this.getMainFwdBufferInfo();if(B!==null){var F=B.len,H=this.getMaxBufferLength(P.maxBitrate);if(!(F>=H)){if(this._streamEnded(B,N)){var j={};this.altAudio&&(j.type="video"),this.hls.trigger(M.Events.BUFFER_EOS,j),this.state=a.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>B.end&&(this.backtrackFragment=null);var X=this.backtrackFragment?this.backtrackFragment.start:B.end,$=this.getNextFragment(X,N);if(this.couldBacktrack&&!this.fragPrevious&&$&&$.sn!=="initSegment"&&this.fragmentTracker.getState($)!==O.FragmentState.OK){var G,J=((G=this.backtrackFragment)!=null?G:$).sn,ee=J-N.startSN,te=N.fragments[ee-1];te&&$.cc===te.cc&&($=te,this.fragmentTracker.removeFragment(te))}else this.backtrackFragment&&B.len&&(this.backtrackFragment=null);if($&&this.fragmentTracker.getState($)===O.FragmentState.OK&&this.nextLoadPosition>X){var oe=this.audioOnly&&!this.altAudio?A.ElementaryStreamTypes.AUDIO:A.ElementaryStreamTypes.VIDEO;y&&this.afterBufferFlushed(y,oe,L.PlaylistLevelType.MAIN),$=this.getNextFragment(this.nextLoadPosition,N)}!$||($.initSegment&&!$.initSegment.data&&!this.bitrateTest&&($=$.initSegment),((s=$.decryptdata)===null||s===void 0?void 0:s.keyFormat)==="identity"&&!((c=$.decryptdata)!==null&&c!==void 0&&c.key)?this.loadKey($,N):this.loadFragment($,N,X))}}}},h.loadFragment=function(s,c,m){var f,g=this.fragmentTracker.getState(s);this.fragCurrent=s,g===O.FragmentState.NOT_LOADED?s.sn==="initSegment"?this._loadInitSegment(s):this.bitrateTest?(this.log("Fragment "+s.sn+" of level "+s.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(s)):(this.startFragRequested=!0,l.prototype.loadFragment.call(this,s,c,m)):g===O.FragmentState.APPENDING?this.reduceMaxBufferLength(s.duration)&&this.fragmentTracker.removeFragment(s):((f=this.media)===null||f===void 0?void 0:f.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},h.getAppendedFrag=function(s){var c=this.fragmentTracker.getAppendedFrag(s,L.PlaylistLevelType.MAIN);return c&&"fragment"in c?c.fragment:c},h.getBufferedFrag=function(s){return this.fragmentTracker.getBufferedFrag(s,L.PlaylistLevelType.MAIN)},h.followingBufferedFrag=function(s){return s?this.getBufferedFrag(s.end+.5):null},h.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},h.nextLevelSwitch=function(){var s=this.levels,c=this.media;if(c!=null&&c.readyState){var m,f=this.getAppendedFrag(c.currentTime);if(f&&f.start>1&&this.flushMainBuffer(0,f.start-1),!c.paused&&s){var g=this.hls.nextLoadLevel,y=s[g],R=this.fragLastKbps;R&&this.fragCurrent?m=this.fragCurrent.duration*y.maxBitrate/(1e3*R)+1:m=0}else m=0;var D=this.getBufferedFrag(c.currentTime+m);if(D){var P=this.followingBufferedFrag(D);if(P){this.abortCurrentFrag();var N=P.maxStartPTS?P.maxStartPTS:P.start,B=P.duration,F=Math.max(D.end,N+Math.min(Math.max(B-this.config.maxFragLookUpTolerance,B*.5),B*.75));this.flushMainBuffer(F,Number.POSITIVE_INFINITY)}}}},h.abortCurrentFrag=function(){var s=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,s!=null&&s.loader&&s.loader.abort(),this.state){case a.State.KEY_LOADING:case a.State.FRAG_LOADING:case a.State.FRAG_LOADING_WAITING_RETRY:case a.State.PARSING:case a.State.PARSED:this.state=a.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},h.flushMainBuffer=function(s,c){l.prototype.flushMainBuffer.call(this,s,c,this.altAudio?"video":null)},h.onMediaAttached=function(s,c){l.prototype.onMediaAttached.call(this,s,c);var m=c.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),m.addEventListener("playing",this.onvplaying),m.addEventListener("seeked",this.onvseeked),this.gapController=new _.default(this.config,m,this.fragmentTracker,this.hls)},h.onMediaDetaching=function(){var s=this.media;s&&this.onvplaying&&this.onvseeked&&(s.removeEventListener("playing",this.onvplaying),s.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),l.prototype.onMediaDetaching.call(this)},h.onMediaPlaying=function(){this.tick()},h.onMediaSeeked=function(){var s=this.media,c=s?s.currentTime:null;Object(n.isFiniteNumber)(c)&&this.log("Media seeked to "+c.toFixed(3)),this.tick()},h.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(M.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},h.onManifestParsed=function(s,c){var m=!1,f=!1,g;c.levels.forEach(function(y){g=y.audioCodec,g&&(g.indexOf("mp4a.40.2")!==-1&&(m=!0),g.indexOf("mp4a.40.5")!==-1&&(f=!0))}),this.audioCodecSwitch=m&&f&&!Object(u.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=c.levels,this.startFragRequested=!1},h.onLevelLoading=function(s,c){var m=this.levels;if(!(!m||this.state!==a.State.IDLE)){var f=m[c.level];(!f.details||f.details.live&&this.levelLastLoaded!==c.level||this.waitForCdnTuneIn(f.details))&&(this.state=a.State.WAITING_LEVEL)}},h.onLevelLoaded=function(s,c){var m,f=this.levels,g=c.level,y=c.details,R=y.totalduration;if(!f){this.warn("Levels were reset while loading level "+g);return}this.log("Level "+g+" loaded ["+y.startSN+","+y.endSN+"], cc ["+y.startCC+", "+y.endCC+"] duration:"+R);var D=this.fragCurrent;D&&(this.state===a.State.FRAG_LOADING||this.state===a.State.FRAG_LOADING_WAITING_RETRY)&&D.level!==c.level&&D.loader&&(this.state=a.State.IDLE,this.backtrackFragment=null,D.loader.abort());var P=f[g],N=0;if(y.live||(m=P.details)!==null&&m!==void 0&&m.live){if(y.fragments[0]||(y.deltaUpdateFailed=!0),y.deltaUpdateFailed)return;N=this.alignPlaylists(y,P.details)}if(P.details=y,this.levelLastLoaded=g,this.hls.trigger(M.Events.LEVEL_UPDATED,{details:y,level:g}),this.state===a.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(y))return;this.state=a.State.IDLE}this.startFragRequested?y.live&&this.synchronizeToLiveEdge(y):this.setStartPosition(y,N),this.tick()},h._handleFragmentLoadProgress=function(s){var c,m=s.frag,f=s.part,g=s.payload,y=this.levels;if(!y){this.warn("Levels were reset while fragment load was in progress. Fragment "+m.sn+" of level "+m.level+" will not be buffered");return}var R=y[m.level],D=R.details;if(!D){this.warn("Dropping fragment "+m.sn+" of level "+m.level+" after level details were reset");return}var P=R.videoCodec,N=D.PTSKnown||!D.live,B=(c=m.initSegment)===null||c===void 0?void 0:c.data,F=this._getAudioCodec(R),H=this.transmuxer=this.transmuxer||new x.default(this.hls,L.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),j=f?f.index:-1,X=j!==-1,$=new I.ChunkMetadata(m.level,m.sn,m.stats.chunkCount,g.byteLength,j,X),G=this.initPTS[m.cc];H.push(g,B,F,P,m,f,D.totalduration,N,$,G)},h.onAudioTrackSwitching=function(s,c){var m=this.altAudio,f=!!c.url,g=c.id;if(!f){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var y=this.fragCurrent;y!=null&&y.loader&&(this.log("Switching to main audio track, cancel main fragment load"),y.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var R=this.hls;m&&R.trigger(M.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),R.trigger(M.Events.AUDIO_TRACK_SWITCHED,{id:g})}},h.onAudioTrackSwitched=function(s,c){var m=c.id,f=!!this.hls.audioTracks[m].url;if(f){var g=this.videoBuffer;g&&this.mediaBuffer!==g&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=g)}this.altAudio=f,this.tick()},h.onBufferCreated=function(s,c){var m=c.tracks,f,g,y=!1;for(var R in m){var D=m[R];if(D.id==="main"){if(g=R,f=D,R==="video"){var P=m[R];P&&(this.videoBuffer=P.buffer)}}else y=!0}y&&f?(this.log("Alternate track found, use "+g+".buffered to schedule main fragment loading"),this.mediaBuffer=f.buffer):this.mediaBuffer=this.media},h.onFragBuffered=function(s,c){var m=c.frag,f=c.part;if(!(m&&m.type!==L.PlaylistLevelType.MAIN)){if(this.fragContextChanged(m)){this.warn("Fragment "+m.sn+(f?" p: "+f.index:"")+" of level "+m.level+" finished buffering, but was aborted. state: "+this.state),this.state===a.State.PARSED&&(this.state=a.State.IDLE);return}var g=f?f.stats:m.stats;this.fragLastKbps=Math.round(8*g.total/(g.buffering.end-g.loading.first)),m.sn!=="initSegment"&&(this.fragPrevious=m),this.fragBufferedComplete(m,f)}},h.onError=function(s,c){switch(c.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:case b.ErrorDetails.KEY_LOAD_ERROR:case b.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(L.PlaylistLevelType.MAIN,c);break;case b.ErrorDetails.LEVEL_LOAD_ERROR:case b.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==a.State.ERROR&&(c.fatal?(this.warn(""+c.details),this.state=a.State.ERROR):!c.levelRetry&&this.state===a.State.WAITING_LEVEL&&(this.state=a.State.IDLE));break;case b.ErrorDetails.BUFFER_FULL_ERROR:if(c.parent==="main"&&(this.state===a.State.PARSING||this.state===a.State.PARSED)){var m=!0,f=this.getFwdBufferInfo(this.media,L.PlaylistLevelType.MAIN);f&&f.len>.5&&(m=!this.reduceMaxBufferLength(f.len)),m&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break;default:break}},h.checkBuffer=function(){var s=this.media,c=this.gapController;if(!(!s||!c||!s.readyState)){if(this.loadedmetadata||!C.BufferHelper.getBuffered(s).length){var m=this.state!==a.State.IDLE?this.fragCurrent:null;c.poll(this.lastCurrentTime,m)}this.lastCurrentTime=s.currentTime}},h.onFragLoadEmergencyAborted=function(){this.state=a.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},h.onBufferFlushed=function(s,c){var m=c.type;if(m!==A.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var f=(m===A.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(f,m,L.PlaylistLevelType.MAIN)}},h.onLevelsUpdated=function(s,c){this.levels=c.levels},h.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},h.seekToStartPos=function(){var s=this.media;if(!!s){var c=s.currentTime,m=this.startPosition;if(m>=0&&c<m){if(s.seeking){this.log("could not seek to "+m+", already seeking at "+c);return}var f=C.BufferHelper.getBuffered(s),g=f.length?f.start(0):0,y=g-m;y>0&&(y<this.config.maxBufferHole||y<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+y+" to match buffer start"),m+=y,this.startPosition=m),this.log("seek to target start position "+m+" from current time "+c),s.currentTime=m}}},h._getAudioCodec=function(s){var c=this.config.defaultAudioCodec||s.audioCodec;return this.audioCodecSwap&&c&&(this.log("Swapping audio codec"),c.indexOf("mp4a.40.5")!==-1?c="mp4a.40.2":c="mp4a.40.5"),c},h._loadBitrateTestFrag=function(s){var c=this;s.bitrateTest=!0,this._doFragLoad(s).then(function(m){var f=c.hls;if(!(!m||f.nextLoadLevel||c.fragContextChanged(s))){c.fragLoadError=0,c.state=a.State.IDLE,c.startFragRequested=!1,c.bitrateTest=!1;var g=s.stats;g.parsing.start=g.parsing.end=g.buffering.start=g.buffering.end=self.performance.now(),f.trigger(M.Events.FRAG_LOADED,m),s.bitrateTest=!1}})},h._handleTransmuxComplete=function(s){var c,m="main",f=this.hls,g=s.remuxResult,y=s.chunkMeta,R=this.getCurrentContext(y);if(!R){this.warn("The loading context changed while buffering fragment "+y.sn+" of level "+y.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(y.level);return}var D=R.frag,P=R.part,N=R.level,B=g.video,F=g.text,H=g.id3,j=g.initSegment,X=N.details,$=this.altAudio?void 0:g.audio;if(!this.fragContextChanged(D)){if(this.state=a.State.PARSING,j){j.tracks&&(this._bufferInitSegment(N,j.tracks,D,y),f.trigger(M.Events.FRAG_PARSING_INIT_SEGMENT,{frag:D,id:m,tracks:j.tracks}));var G=j.initPTS,J=j.timescale;Object(n.isFiniteNumber)(G)&&(this.initPTS[D.cc]=G,f.trigger(M.Events.INIT_PTS_FOUND,{frag:D,id:m,initPTS:G,timescale:J}))}if(B&&g.independent!==!1){if(X){var ee=B.startPTS,te=B.endPTS,oe=B.startDTS,ue=B.endDTS;if(P)P.elementaryStreams[B.type]={startPTS:ee,endPTS:te,startDTS:oe,endDTS:ue};else if(B.firstKeyFrame&&B.independent&&(this.couldBacktrack=!0),B.dropped&&B.independent){var ne=this.getMainFwdBufferInfo(),he=(ne?ne.end:this.getLoadPosition())+this.config.maxBufferHole,me=B.firstKeyFramePTS?B.firstKeyFramePTS:ee;if(he<me-this.config.maxBufferHole){this.backtrack(D);return}D.setElementaryStreamInfo(B.type,D.start,te,D.start,ue,!0)}D.setElementaryStreamInfo(B.type,ee,te,oe,ue),this.backtrackFragment&&(this.backtrackFragment=D),this.bufferFragmentData(B,D,P,y)}}else if(g.independent===!1){this.backtrack(D);return}if($){var ae=$.startPTS,Me=$.endPTS,Se=$.startDTS,xe=$.endDTS;P&&(P.elementaryStreams[A.ElementaryStreamTypes.AUDIO]={startPTS:ae,endPTS:Me,startDTS:Se,endDTS:xe}),D.setElementaryStreamInfo(A.ElementaryStreamTypes.AUDIO,ae,Me,Se,xe),this.bufferFragmentData($,D,P,y)}if(X&&H!==null&&H!==void 0&&(c=H.samples)!==null&&c!==void 0&&c.length){var be={id:m,frag:D,details:X,samples:H.samples};f.trigger(M.Events.FRAG_PARSING_METADATA,be)}if(X&&F){var Ue={id:m,frag:D,details:X,samples:F.samples};f.trigger(M.Events.FRAG_PARSING_USERDATA,Ue)}}},h._bufferInitSegment=function(s,c,m,f){var g=this;if(this.state===a.State.PARSING){this.audioOnly=!!c.audio&&!c.video,this.altAudio&&!this.audioOnly&&delete c.audio;var y=c.audio,R=c.video,D=c.audiovideo;if(y){var P=s.audioCodec,N=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(P&&(P.indexOf("mp4a.40.5")!==-1?P="mp4a.40.2":P="mp4a.40.5"),y.metadata.channelCount!==1&&N.indexOf("firefox")===-1&&(P="mp4a.40.5")),N.indexOf("android")!==-1&&y.container!=="audio/mpeg"&&(P="mp4a.40.2",this.log("Android: force audio codec to "+P)),s.audioCodec&&s.audioCodec!==P&&this.log('Swapping manifest audio codec "'+s.audioCodec+'" for "'+P+'"'),y.levelCodec=P,y.id="main",this.log("Init audio buffer, container:"+y.container+", codecs[selected/level/parsed]=["+(P||"")+"/"+(s.audioCodec||"")+"/"+y.codec+"]")}R&&(R.levelCodec=s.videoCodec,R.id="main",this.log("Init video buffer, container:"+R.container+", codecs[level/parsed]=["+(s.videoCodec||"")+"/"+R.codec+"]")),D&&this.log("Init audiovideo buffer, container:"+D.container+", codecs[level/parsed]=["+(s.attrs.CODECS||"")+"/"+D.codec+"]"),this.hls.trigger(M.Events.BUFFER_CODECS,c),Object.keys(c).forEach(function(B){var F=c[B],H=F.initSegment;H!=null&&H.byteLength&&g.hls.trigger(M.Events.BUFFER_APPENDING,{type:B,data:H,frag:m,part:null,chunkMeta:f,parent:m.type})}),this.tick()}},h.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,L.PlaylistLevelType.MAIN)},h.backtrack=function(s){this.couldBacktrack=!0,this.backtrackFragment=s,this.resetTransmuxer(),this.flushBufferGap(s),this.fragmentTracker.removeFragment(s),this.fragPrevious=null,this.nextLoadPosition=s.start,this.state=a.State.IDLE},h.checkFragmentChanged=function(){var s=this.media,c=null;if(s&&s.readyState>1&&s.seeking===!1){var m=s.currentTime;if(C.BufferHelper.isBuffered(s,m)?c=this.getAppendedFrag(m):C.BufferHelper.isBuffered(s,m+.1)&&(c=this.getAppendedFrag(m+.1)),c){this.backtrackFragment=null;var f=this.fragPlaying,g=c.level;(!f||c.sn!==f.sn||f.level!==g||c.urlId!==f.urlId)&&(this.hls.trigger(M.Events.FRAG_CHANGED,{frag:c}),(!f||f.level!==g)&&this.hls.trigger(M.Events.LEVEL_SWITCHED,{level:g}),this.fragPlaying=c)}}},v(o,[{key:"nextLevel",get:function(){var s=this.nextBufferedFrag;return s?s.level:-1}},{key:"currentFrag",get:function(){var s=this.media;return s?this.fragPlaying||this.getAppendedFrag(s.currentTime):null}},{key:"currentProgramDateTime",get:function(){var s=this.media;if(s){var c=s.currentTime,m=this.currentFrag;if(m&&Object(n.isFiniteNumber)(c)&&Object(n.isFiniteNumber)(m.programDateTime)){var f=m.programDateTime+(c-m.start)*1e3;return new Date(f)}}return null}},{key:"currentLevel",get:function(){var s=this.currentFrag;return s?s.level:-1}},{key:"nextBufferedFrag",get:function(){var s=this.currentFrag;return s?this.followingBufferedFrag(s):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),o}(a.default)},"./src/controller/subtitle-stream-controller.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"SubtitleStreamController",function(){return i});var n=e("./src/events.ts"),a=e("./src/utils/buffer-helper.ts"),u=e("./src/controller/fragment-finders.ts"),M=e("./src/utils/discontinuities.ts"),C=e("./src/controller/level-helper.ts"),O=e("./src/controller/fragment-tracker.ts"),L=e("./src/controller/base-stream-controller.ts"),A=e("./src/types/loader.ts"),x=e("./src/types/level.ts");function I(p,T){for(var l=0;l<T.length;l++){var o=T[l];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(p,o.key,o)}}function _(p,T,l){return T&&I(p.prototype,T),l&&I(p,l),Object.defineProperty(p,"prototype",{writable:!1}),p}function b(p,T){p.prototype=Object.create(T.prototype),p.prototype.constructor=p,S(p,T)}function S(p,T){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,h){return o.__proto__=h,o},S(p,T)}var v=500,i=function(p){b(T,p);function T(o,h){var E;return E=p.call(this,o,h,"[subtitle-stream-controller]")||this,E.levels=[],E.currentTrackId=-1,E.tracksBuffered=[],E.mainDetails=null,E._registerListeners(),E}var l=T.prototype;return l.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},l._registerListeners=function(){var h=this.hls;h.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),h.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.on(n.Events.LEVEL_LOADED,this.onLevelLoaded,this),h.on(n.Events.ERROR,this.onError,this),h.on(n.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),h.on(n.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),h.on(n.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),h.on(n.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),h.on(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},l._unregisterListeners=function(){var h=this.hls;h.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),h.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.off(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.off(n.Events.LEVEL_LOADED,this.onLevelLoaded,this),h.off(n.Events.ERROR,this.onError,this),h.off(n.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),h.off(n.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),h.off(n.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),h.off(n.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),h.off(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},l.startLoad=function(){this.stopLoad(),this.state=L.State.IDLE,this.setInterval(v),this.tick()},l.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},l.onLevelLoaded=function(h,E){this.mainDetails=E.details},l.onSubtitleFragProcessed=function(h,E){var s=E.frag,c=E.success;if(this.fragPrevious=s,this.state=L.State.IDLE,!!c){var m=this.tracksBuffered[this.currentTrackId];if(!!m){for(var f,g=s.start,y=0;y<m.length;y++)if(g>=m[y].start&&g<=m[y].end){f=m[y];break}var R=s.start+s.duration;f?f.end=R:(f={start:g,end:R},m.push(f)),this.fragmentTracker.fragBuffered(s)}}},l.onBufferFlushing=function(h,E){var s=E.startOffset,c=E.endOffset;if(s===0&&c!==Number.POSITIVE_INFINITY){var m=this.currentTrackId,f=this.levels;if(!f.length||!f[m]||!f[m].details)return;var g=f[m].details,y=g.targetduration,R=c-y;if(R<=0)return;E.endOffsetSubtitles=Math.max(0,R),this.tracksBuffered.forEach(function(D){for(var P=0;P<D.length;){if(D[P].end<=R){D.shift();continue}else if(D[P].start<R)D[P].start=R;else break;P++}}),this.fragmentTracker.removeFragmentsInRange(s,R,A.PlaylistLevelType.SUBTITLE)}},l.onError=function(h,E){var s,c=E.frag;!c||c.type!==A.PlaylistLevelType.SUBTITLE||((s=this.fragCurrent)!==null&&s!==void 0&&s.loader&&this.fragCurrent.loader.abort(),this.state=L.State.IDLE)},l.onSubtitleTracksUpdated=function(h,E){var s=this,c=E.subtitleTracks;this.tracksBuffered=[],this.levels=c.map(function(m){return new x.Level(m)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(m){s.tracksBuffered[m.id]=[]}),this.mediaBuffer=null},l.onSubtitleTrackSwitch=function(h,E){if(this.currentTrackId=E.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.setInterval(v)},l.onSubtitleTrackLoaded=function(h,E){var s,c=E.details,m=E.id,f=this.currentTrackId,g=this.levels;if(!!g.length){var y=g[f];if(!(m>=g.length||m!==f||!y)){if(this.mediaBuffer=this.mediaBufferTimeRanges,c.live||(s=y.details)!==null&&s!==void 0&&s.live){var R=this.mainDetails;if(c.deltaUpdateFailed||!R)return;var D=R.fragments[0];if(!y.details)c.hasProgramDateTime&&R.hasProgramDateTime?Object(M.alignMediaPlaylistByPDT)(c,R):D&&Object(C.addSliding)(c,D.start);else{var P=this.alignPlaylists(c,y.details);P===0&&D&&Object(C.addSliding)(c,D.start)}}if(y.details=c,this.levelLastLoaded=m,this.tick(),c.live&&!this.fragCurrent&&this.media&&this.state===L.State.IDLE){var N=Object(u.findFragmentByPTS)(null,c.fragments,this.media.currentTime,0);N||(this.warn("Subtitle playlist not aligned with playback"),y.details=void 0)}}}},l._handleFragmentLoadComplete=function(h){var E=h.frag,s=h.payload,c=E.decryptdata,m=this.hls;if(!this.fragContextChanged(E)&&s&&s.byteLength>0&&c&&c.key&&c.iv&&c.method==="AES-128"){var f=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(s),c.key.buffer,c.iv.buffer).then(function(g){var y=performance.now();m.trigger(n.Events.FRAG_DECRYPTED,{frag:E,payload:g,stats:{tstart:f,tdecrypt:y}})})}},l.doTick=function(){if(!this.media){this.state=L.State.IDLE;return}if(this.state===L.State.IDLE){var h=this.currentTrackId,E=this.levels;if(!E.length||!E[h]||!E[h].details)return;var s=E[h].details,c=s.targetduration,m=this.config,f=this.media,g=a.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],f.currentTime-c,m.maxBufferHole),y=g.end,R=g.len,D=this.getMaxBufferLength()+c;if(R>D)return;console.assert(s,"Subtitle track details are defined on idle subtitle stream controller tick");var P=s.fragments,N=P.length,B=s.edge,F,H=this.fragPrevious;if(y<B){var j=m.maxFragLookUpTolerance;F=Object(u.findFragmentByPTS)(H,P,Math.max(P[0].start,y),j),!F&&H&&H.start<P[0].start&&(F=P[0])}else F=P[N-1];if(F=this.mapToInitFragWhenRequired(F),!F||this.fragmentTracker.getState(F)!==O.FragmentState.NOT_LOADED)return;F.encrypted?this.loadKey(F,s):this.loadFragment(F,s,y)}},l.loadFragment=function(h,E,s){this.fragCurrent=h,h.sn==="initSegment"?this._loadInitSegment(h):p.prototype.loadFragment.call(this,h,E,s)},_(T,[{key:"mediaBufferTimeRanges",get:function(){return new d(this.tracksBuffered[this.currentTrackId]||[])}}]),T}(L.default),d=function(T){this.buffered=void 0;var l=function(h,E,s){if(E=E>>>0,E>s-1)throw new DOMException("Failed to execute '"+h+"' on 'TimeRanges': The index provided ("+E+") is greater than the maximum bound ("+s+")");return T[E][h]};this.buffered={get length(){return T.length},end:function(h){return l("end",h,T.length)},start:function(h){return l("start",h,T.length)}}}},"./src/controller/subtitle-track-controller.ts":function(r,t,e){"use strict";e.r(t);var n=e("./src/events.ts"),a=e("./src/utils/texttrack-utils.ts"),u=e("./src/controller/base-playlist-controller.ts"),M=e("./src/types/loader.ts");function C(_,b){for(var S=0;S<b.length;S++){var v=b[S];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(_,v.key,v)}}function O(_,b,S){return b&&C(_.prototype,b),S&&C(_,S),Object.defineProperty(_,"prototype",{writable:!1}),_}function L(_,b){_.prototype=Object.create(b.prototype),_.prototype.constructor=_,A(_,b)}function A(_,b){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,i){return v.__proto__=i,v},A(_,b)}var x=function(_){L(b,_);function b(v){var i;return i=_.call(this,v,"[subtitle-track-controller]")||this,i.media=null,i.tracks=[],i.groupId=null,i.tracksInGroup=[],i.trackId=-1,i.selectDefaultTrack=!0,i.queuedDefaultTrack=-1,i.trackChangeListener=function(){return i.onTextTracksChanged()},i.asyncPollTrackChange=function(){return i.pollTrackChange(0)},i.useTextTrackPolling=!1,i.subtitlePollingInterval=-1,i._subtitleDisplay=!0,i.registerListeners(),i}var S=b.prototype;return S.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,_.prototype.destroy.call(this)},S.registerListeners=function(){var i=this.hls;i.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(n.Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(n.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(n.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.on(n.Events.ERROR,this.onError,this)},S.unregisterListeners=function(){var i=this.hls;i.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(n.Events.LEVEL_LOADING,this.onLevelLoading,this),i.off(n.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(n.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.off(n.Events.ERROR,this.onError,this)},S.onMediaAttached=function(i,d){this.media=d.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},S.pollTrackChange=function(i){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,i)},S.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var i=I(this.media.textTracks);i.forEach(function(d){Object(a.clearCurrentCues)(d)}),this.subtitleTrack=-1,this.media=null}},S.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},S.onManifestParsed=function(i,d){this.tracks=d.subtitleTracks},S.onSubtitleTrackLoaded=function(i,d){var p=d.id,T=d.details,l=this.trackId,o=this.tracksInGroup[l];if(!o){this.warn("Invalid subtitle track id "+p);return}var h=o.details;o.details=d.details,this.log("subtitle track "+p+" loaded ["+T.startSN+"-"+T.endSN+"]"),p===this.trackId&&(this.retryCount=0,this.playlistLoaded(p,d,h))},S.onLevelLoading=function(i,d){this.switchLevel(d.level)},S.onLevelSwitching=function(i,d){this.switchLevel(d.level)},S.switchLevel=function(i){var d=this.hls.levels[i];if(!!(d!=null&&d.textGroupIds)){var p=d.textGroupIds[d.urlId];if(this.groupId!==p){var T=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,l=this.tracks.filter(function(E){return!p||E.groupId===p});this.tracksInGroup=l;var o=this.findTrackId(T==null?void 0:T.name)||this.findTrackId();this.groupId=p;var h={subtitleTracks:l};this.log("Updating subtitle tracks, "+l.length+' track(s) found in "'+p+'" group-id'),this.hls.trigger(n.Events.SUBTITLE_TRACKS_UPDATED,h),o!==-1&&this.setSubtitleTrack(o,T)}}},S.findTrackId=function(i){for(var d=this.tracksInGroup,p=0;p<d.length;p++){var T=d[p];if((!this.selectDefaultTrack||T.default)&&(!i||i===T.name))return T.id}return-1},S.onError=function(i,d){_.prototype.onError.call(this,i,d),!(d.fatal||!d.context)&&d.context.type===M.PlaylistContextType.SUBTITLE_TRACK&&d.context.id===this.trackId&&d.context.groupId===this.groupId&&this.retryLoadingOrFail(d)},S.loadPlaylist=function(i){var d=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(d)){var p=d.id,T=d.groupId,l=d.url;if(i)try{l=i.addDirectives(l)}catch(o){this.warn("Could not construct new URL with HLS Delivery Directives: "+o)}this.log("Loading subtitle playlist for id "+p),this.hls.trigger(n.Events.SUBTITLE_TRACK_LOADING,{url:l,id:p,groupId:T,deliveryDirectives:i||null})}},S.toggleTrackModes=function(i){var d=this,p=this.media,T=this.trackId;if(!!p){var l=I(p.textTracks),o=l.filter(function(s){return s.groupId===d.groupId});if(i===-1)[].slice.call(l).forEach(function(s){s.mode="disabled"});else{var h=o[T];h&&(h.mode="disabled")}var E=o[i];E&&(E.mode=this.subtitleDisplay?"showing":"hidden")}},S.setSubtitleTrack=function(i,d){var p,T=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=i;return}if(this.trackId!==i&&this.toggleTrackModes(i),!(this.trackId===i&&(i===-1||(p=T[i])!==null&&p!==void 0&&p.details)||i<-1||i>=T.length)){this.clearTimer();var l=T[i];if(this.log("Switching to subtitle track "+i),this.trackId=i,l){var o=l.id,h=l.groupId,E=h===void 0?"":h,s=l.name,c=l.type,m=l.url;this.hls.trigger(n.Events.SUBTITLE_TRACK_SWITCH,{id:o,groupId:E,name:s,type:c,url:m});var f=this.switchParams(l.url,d==null?void 0:d.details);this.loadPlaylist(f)}else this.hls.trigger(n.Events.SUBTITLE_TRACK_SWITCH,{id:i})}},S.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var i=-1,d=I(this.media.textTracks),p=0;p<d.length;p++)if(d[p].mode==="hidden")i=p;else if(d[p].mode==="showing"){i=p;break}this.subtitleTrack!==i&&(this.subtitleTrack=i)}},O(b,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(i){this._subtitleDisplay=i,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(i){this.selectDefaultTrack=!1;var d=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(i,d)}}]),b}(u.default);function I(_){for(var b=[],S=0;S<_.length;S++){var v=_[S];v.kind==="subtitles"&&v.label&&b.push(_[S])}return b}t.default=x},"./src/controller/timeline-controller.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"TimelineController",function(){return _});var n=e("./src/polyfills/number.ts"),a=e("./src/events.ts"),u=e("./src/utils/cea-608-parser.ts"),M=e("./src/utils/output-filter.ts"),C=e("./src/utils/webvtt-parser.ts"),O=e("./src/utils/texttrack-utils.ts"),L=e("./src/utils/imsc1-ttml-parser.ts"),A=e("./src/utils/mp4-tools.ts"),x=e("./src/types/loader.ts"),I=e("./src/utils/logger.ts"),_=function(){function i(p){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=v(),this.captionsProperties=void 0,this.hls=p,this.config=p.config,this.Cues=p.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var T=new M.default(this,"textTrack1"),l=new M.default(this,"textTrack2"),o=new M.default(this,"textTrack3"),h=new M.default(this,"textTrack4");this.cea608Parser1=new u.default(1,T,l),this.cea608Parser2=new u.default(3,o,h)}p.on(a.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),p.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),p.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),p.on(a.Events.MANIFEST_LOADED,this.onManifestLoaded,this),p.on(a.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),p.on(a.Events.FRAG_LOADING,this.onFragLoading,this),p.on(a.Events.FRAG_LOADED,this.onFragLoaded,this),p.on(a.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),p.on(a.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),p.on(a.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),p.on(a.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),p.on(a.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var d=i.prototype;return d.destroy=function(){var T=this.hls;T.off(a.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),T.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),T.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),T.off(a.Events.MANIFEST_LOADED,this.onManifestLoaded,this),T.off(a.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),T.off(a.Events.FRAG_LOADING,this.onFragLoading,this),T.off(a.Events.FRAG_LOADED,this.onFragLoaded,this),T.off(a.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),T.off(a.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),T.off(a.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),T.off(a.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),T.off(a.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},d.addCues=function(T,l,o,h,E){for(var s=!1,c=E.length;c--;){var m=E[c],f=S(m[0],m[1],l,o);if(f>=0&&(m[0]=Math.min(m[0],l),m[1]=Math.max(m[1],o),s=!0,f/(o-l)>.5))return}if(s||E.push([l,o]),this.config.renderTextTracksNatively){var g=this.captionsTracks[T];this.Cues.newCue(g,l,o,h)}else{var y=this.Cues.newCue(null,l,o,h);this.hls.trigger(a.Events.CUES_PARSED,{type:"captions",cues:y,track:T})}},d.onInitPtsFound=function(T,l){var o=this,h=l.frag,E=l.id,s=l.initPTS,c=l.timescale,m=this.unparsedVttFrags;E==="main"&&(this.initPTS[h.cc]=s,this.timescale[h.cc]=c),m.length&&(this.unparsedVttFrags=[],m.forEach(function(f){o.onFragLoaded(a.Events.FRAG_LOADED,f)}))},d.getExistingTrack=function(T){var l=this.media;if(l)for(var o=0;o<l.textTracks.length;o++){var h=l.textTracks[o];if(h[T])return h}return null},d.createCaptionsTrack=function(T){this.config.renderTextTracksNatively?this.createNativeTrack(T):this.createNonNativeTrack(T)},d.createNativeTrack=function(T){if(!this.captionsTracks[T]){var l=this.captionsProperties,o=this.captionsTracks,h=this.media,E=l[T],s=E.label,c=E.languageCode,m=this.getExistingTrack(T);if(m)o[T]=m,Object(O.clearCurrentCues)(o[T]),Object(O.sendAddTrackEvent)(o[T],h);else{var f=this.createTextTrack("captions",s,c);f&&(f[T]=!0,o[T]=f)}}},d.createNonNativeTrack=function(T){if(!this.nonNativeCaptionsTracks[T]){var l=this.captionsProperties[T];if(!!l){var o=l.label,h={_id:T,label:o,kind:"captions",default:l.media?!!l.media.default:!1,closedCaptions:l.media};this.nonNativeCaptionsTracks[T]=h,this.hls.trigger(a.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[h]})}}},d.createTextTrack=function(T,l,o){var h=this.media;if(!!h)return h.addTextTrack(T,l,o)},d.onMediaAttaching=function(T,l){this.media=l.media,this._cleanTracks()},d.onMediaDetaching=function(){var T=this.captionsTracks;Object.keys(T).forEach(function(l){Object(O.clearCurrentCues)(T[l]),delete T[l]}),this.nonNativeCaptionsTracks={}},d.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=v(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},d._cleanTracks=function(){var T=this.media;if(!!T){var l=T.textTracks;if(l)for(var o=0;o<l.length;o++)Object(O.clearCurrentCues)(l[o])}},d.onSubtitleTracksUpdated=function(T,l){var o=this;this.textTracks=[];var h=l.subtitleTracks||[],E=h.some(function(f){return f.textCodec===L.IMSC1_CODEC});if(this.config.enableWebVTT||E&&this.config.enableIMSC1){var s=this.tracks&&h&&this.tracks.length===h.length;if(this.tracks=h||[],this.config.renderTextTracksNatively){var c=this.media?this.media.textTracks:[];this.tracks.forEach(function(f,g){var y;if(g<c.length){for(var R=null,D=0;D<c.length;D++)if(b(c[D],f)){R=c[D];break}R&&(y=R)}if(y)Object(O.clearCurrentCues)(y);else{var P=o._captionsOrSubtitlesFromCharacteristics(f);y=o.createTextTrack(P,f.name,f.lang),y&&(y.mode="disabled")}y&&(y.groupId=f.groupId,o.textTracks.push(y))})}else if(!s&&this.tracks&&this.tracks.length){var m=this.tracks.map(function(f){return{label:f.name,kind:f.type.toLowerCase(),default:f.default,subtitleTrack:f}});this.hls.trigger(a.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:m})}}},d._captionsOrSubtitlesFromCharacteristics=function(T){var l;if((l=T.attrs)!==null&&l!==void 0&&l.CHARACTERISTICS){var o=/transcribes-spoken-dialog/gi.test(T.attrs.CHARACTERISTICS),h=/describes-music-and-sound/gi.test(T.attrs.CHARACTERISTICS);if(o&&h)return"captions"}return"subtitles"},d.onManifestLoaded=function(T,l){var o=this;this.config.enableCEA708Captions&&l.captions&&l.captions.forEach(function(h){var E=/(?:CC|SERVICE)([1-4])/.exec(h.instreamId);if(!!E){var s="textTrack"+E[1],c=o.captionsProperties[s];!c||(c.label=h.name,h.lang&&(c.languageCode=h.lang),c.media=h)}})},d.onFragLoading=function(T,l){var o=this.cea608Parser1,h=this.cea608Parser2,E=this.lastSn,s=this.lastPartIndex;if(!(!this.enabled||!(o&&h))&&l.frag.type===x.PlaylistLevelType.MAIN){var c,m,f=l.frag.sn,g=(c=l==null||(m=l.part)===null||m===void 0?void 0:m.index)!=null?c:-1;f===E+1||f===E&&g===s+1||(o.reset(),h.reset()),this.lastSn=f,this.lastPartIndex=g}},d.onFragLoaded=function(T,l){var o=l.frag,h=l.payload,E=this.initPTS,s=this.unparsedVttFrags;if(o.type===x.PlaylistLevelType.SUBTITLE)if(h.byteLength){if(!Object(n.isFiniteNumber)(E[o.cc])){s.push(l),E.length&&this.hls.trigger(a.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:new Error("Missing initial subtitle PTS")});return}var c=o.decryptdata,m="stats"in l;if(c==null||c.key==null||c.method!=="AES-128"||m){var f=this.tracks[o.level],g=this.vttCCs;g[o.cc]||(g[o.cc]={start:o.start,prevCC:this.prevCC,new:!0},this.prevCC=o.cc),f&&f.textCodec===L.IMSC1_CODEC?this._parseIMSC1(o,h):this._parseVTTs(o,h,g)}}else this.hls.trigger(a.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:new Error("Empty subtitle payload")})},d._parseIMSC1=function(T,l){var o=this,h=this.hls;Object(L.parseIMSC1)(l,this.initPTS[T.cc],this.timescale[T.cc],function(E){o._appendCues(E,T.level),h.trigger(a.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:T})},function(E){I.logger.log("Failed to parse IMSC1: "+E),h.trigger(a.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:T,error:E})})},d._parseVTTs=function(T,l,o){var h,E=this,s=this.hls,c=(h=T.initSegment)!==null&&h!==void 0&&h.data?Object(A.appendUint8Array)(T.initSegment.data,new Uint8Array(l)):l;Object(C.parseWebVTT)(c,this.initPTS[T.cc],this.timescale[T.cc],o,T.cc,T.start,function(m){E._appendCues(m,T.level),s.trigger(a.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:T})},function(m){E._fallbackToIMSC1(T,l),I.logger.log("Failed to parse VTT cue: "+m),s.trigger(a.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:T,error:m})})},d._fallbackToIMSC1=function(T,l){var o=this,h=this.tracks[T.level];h.textCodec||Object(L.parseIMSC1)(l,this.initPTS[T.cc],this.timescale[T.cc],function(){h.textCodec=L.IMSC1_CODEC,o._parseIMSC1(T,l)},function(){h.textCodec="wvtt"})},d._appendCues=function(T,l){var o=this.hls;if(this.config.renderTextTracksNatively){var h=this.textTracks[l];if(!h||h.mode==="disabled")return;T.forEach(function(c){return Object(O.addCueToTrack)(h,c)})}else{var E=this.tracks[l];if(!E)return;var s=E.default?"default":"subtitles"+l;o.trigger(a.Events.CUES_PARSED,{type:"subtitles",cues:T,track:s})}},d.onFragDecrypted=function(T,l){var o=l.frag;if(o.type===x.PlaylistLevelType.SUBTITLE){if(!Object(n.isFiniteNumber)(this.initPTS[o.cc])){this.unparsedVttFrags.push(l);return}this.onFragLoaded(a.Events.FRAG_LOADED,l)}},d.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},d.onFragParsingUserdata=function(T,l){var o=this.cea608Parser1,h=this.cea608Parser2;if(!(!this.enabled||!(o&&h)))for(var E=0;E<l.samples.length;E++){var s=l.samples[E].bytes;if(s){var c=this.extractCea608Data(s);o.addData(l.samples[E].pts,c[0]),h.addData(l.samples[E].pts,c[1])}}},d.onBufferFlushing=function(T,l){var o=l.startOffset,h=l.endOffset,E=l.endOffsetSubtitles,s=l.type,c=this.media;if(!(!c||c.currentTime<h)){if(!s||s==="video"){var m=this.captionsTracks;Object.keys(m).forEach(function(g){return Object(O.removeCuesInRange)(m[g],o,h)})}if(this.config.renderTextTracksNatively&&o===0&&E!==void 0){var f=this.textTracks;Object.keys(f).forEach(function(g){return Object(O.removeCuesInRange)(f[g],o,E)})}}},d.extractCea608Data=function(T){for(var l=[[],[]],o=T[0]&31,h=2,E=0;E<o;E++){var s=T[h++],c=127&T[h++],m=127&T[h++];if(!(c===0&&m===0)){var f=(4&s)!==0;if(f){var g=3&s;(g===0||g===1)&&(l[g].push(c),l[g].push(m))}}}return l},i}();function b(i,d){return i&&i.label===d.name&&!(i.textTrack1||i.textTrack2)}function S(i,d,p,T){return Math.min(d,T)-Math.max(i,p)}function v(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return n});var n=function(){function a(M,C){this.subtle=void 0,this.aesIV=void 0,this.subtle=M,this.aesIV=C}var u=a.prototype;return u.decrypt=function(C,O){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},O,C)},a}()},"./src/crypt/aes-decryptor.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"removePadding",function(){return a}),e.d(t,"default",function(){return u});var n=e("./src/utils/typed-array.ts");function a(M){var C=M.byteLength,O=C&&new DataView(M.buffer).getUint8(C-1);return O?Object(n.sliceUint8)(M,0,C-O):M}var u=function(){function M(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var C=M.prototype;return C.uint8ArrayToUint32Array_=function(L){for(var A=new DataView(L),x=new Uint32Array(4),I=0;I<4;I++)x[I]=A.getUint32(I*4);return x},C.initTable=function(){var L=this.sBox,A=this.invSBox,x=this.subMix,I=x[0],_=x[1],b=x[2],S=x[3],v=this.invSubMix,i=v[0],d=v[1],p=v[2],T=v[3],l=new Uint32Array(256),o=0,h=0,E=0;for(E=0;E<256;E++)E<128?l[E]=E<<1:l[E]=E<<1^283;for(E=0;E<256;E++){var s=h^h<<1^h<<2^h<<3^h<<4;s=s>>>8^s&255^99,L[o]=s,A[s]=o;var c=l[o],m=l[c],f=l[m],g=l[s]*257^s*16843008;I[o]=g<<24|g>>>8,_[o]=g<<16|g>>>16,b[o]=g<<8|g>>>24,S[o]=g,g=f*16843009^m*65537^c*257^o*16843008,i[s]=g<<24|g>>>8,d[s]=g<<16|g>>>16,p[s]=g<<8|g>>>24,T[s]=g,o?(o=c^l[l[l[f^c]]],h^=l[l[h]]):o=h=1}},C.expandKey=function(L){for(var A=this.uint8ArrayToUint32Array_(L),x=!0,I=0;I<A.length&&x;)x=A[I]===this.key[I],I++;if(!x){this.key=A;var _=this.keySize=A.length;if(_!==4&&_!==6&&_!==8)throw new Error("Invalid aes key size="+_);var b=this.ksRows=(_+6+1)*4,S,v,i=this.keySchedule=new Uint32Array(b),d=this.invKeySchedule=new Uint32Array(b),p=this.sBox,T=this.rcon,l=this.invSubMix,o=l[0],h=l[1],E=l[2],s=l[3],c,m;for(S=0;S<b;S++){if(S<_){c=i[S]=A[S];continue}m=c,S%_===0?(m=m<<8|m>>>24,m=p[m>>>24]<<24|p[m>>>16&255]<<16|p[m>>>8&255]<<8|p[m&255],m^=T[S/_|0]<<24):_>6&&S%_===4&&(m=p[m>>>24]<<24|p[m>>>16&255]<<16|p[m>>>8&255]<<8|p[m&255]),i[S]=c=(i[S-_]^m)>>>0}for(v=0;v<b;v++)S=b-v,v&3?m=i[S]:m=i[S-4],v<4||S<=4?d[v]=m:d[v]=o[p[m>>>24]]^h[p[m>>>16&255]]^E[p[m>>>8&255]]^s[p[m&255]],d[v]=d[v]>>>0}},C.networkToHostOrderSwap=function(L){return L<<24|(L&65280)<<8|(L&16711680)>>8|L>>>24},C.decrypt=function(L,A,x){for(var I=this.keySize+6,_=this.invKeySchedule,b=this.invSBox,S=this.invSubMix,v=S[0],i=S[1],d=S[2],p=S[3],T=this.uint8ArrayToUint32Array_(x),l=T[0],o=T[1],h=T[2],E=T[3],s=new Int32Array(L),c=new Int32Array(s.length),m,f,g,y,R,D,P,N,B,F,H,j,X,$,G=this.networkToHostOrderSwap;A<s.length;){for(B=G(s[A]),F=G(s[A+1]),H=G(s[A+2]),j=G(s[A+3]),R=B^_[0],D=j^_[1],P=H^_[2],N=F^_[3],X=4,$=1;$<I;$++)m=v[R>>>24]^i[D>>16&255]^d[P>>8&255]^p[N&255]^_[X],f=v[D>>>24]^i[P>>16&255]^d[N>>8&255]^p[R&255]^_[X+1],g=v[P>>>24]^i[N>>16&255]^d[R>>8&255]^p[D&255]^_[X+2],y=v[N>>>24]^i[R>>16&255]^d[D>>8&255]^p[P&255]^_[X+3],R=m,D=f,P=g,N=y,X=X+4;m=b[R>>>24]<<24^b[D>>16&255]<<16^b[P>>8&255]<<8^b[N&255]^_[X],f=b[D>>>24]<<24^b[P>>16&255]<<16^b[N>>8&255]<<8^b[R&255]^_[X+1],g=b[P>>>24]<<24^b[N>>16&255]<<16^b[R>>8&255]<<8^b[D&255]^_[X+2],y=b[N>>>24]<<24^b[R>>16&255]<<16^b[D>>8&255]<<8^b[P&255]^_[X+3],c[A]=G(m^l),c[A+1]=G(y^o),c[A+2]=G(g^h),c[A+3]=G(f^E),l=B,o=F,h=H,E=j,A=A+4}return c.buffer},M}()},"./src/crypt/decrypter.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return A});var n=e("./src/crypt/aes-crypto.ts"),a=e("./src/crypt/fast-aes-key.ts"),u=e("./src/crypt/aes-decryptor.ts"),M=e("./src/utils/logger.ts"),C=e("./src/utils/mp4-tools.ts"),O=e("./src/utils/typed-array.ts"),L=16,A=function(){function x(_,b,S){var v=S===void 0?{}:S,i=v.removePKCS7Padding,d=i===void 0?!0:i;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=_,this.config=b,this.removePKCS7Padding=d,d)try{var p=self.crypto;p&&(this.subtle=p.subtle||p.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var I=x.prototype;return I.destroy=function(){this.observer=null},I.isSync=function(){return this.config.enableSoftwareAES},I.flush=function(){var b=this.currentResult;if(!b){this.reset();return}var S=new Uint8Array(b);return this.reset(),this.removePKCS7Padding?Object(u.removePadding)(S):S},I.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},I.decrypt=function(b,S,v,i){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(b),S,v);var d=this.flush();d&&i(d.buffer)}else this.webCryptoDecrypt(new Uint8Array(b),S,v).then(i)},I.softwareDecrypt=function(b,S,v){var i=this.currentIV,d=this.currentResult,p=this.remainderData;this.logOnce("JS AES decrypt"),p&&(b=Object(C.appendUint8Array)(p,b),this.remainderData=null);var T=this.getValidChunk(b);if(!T.length)return null;i&&(v=i);var l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new u.default),l.expandKey(S);var o=d;return this.currentResult=l.decrypt(T.buffer,0,v),this.currentIV=Object(O.sliceUint8)(T,-16).buffer,o||null},I.webCryptoDecrypt=function(b,S,v){var i=this,d=this.subtle;return(this.key!==S||!this.fastAesKey)&&(this.key=S,this.fastAesKey=new a.default(d,S)),this.fastAesKey.expandKey().then(function(p){if(!d)return Promise.reject(new Error("web crypto not initialized"));var T=new n.default(d,v);return T.decrypt(b.buffer,p)}).catch(function(p){return i.onWebCryptoError(p,b,S,v)})},I.onWebCryptoError=function(b,S,v,i){return M.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",b),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(S,v,i)},I.getValidChunk=function(b){var S=b,v=b.length-b.length%L;return v!==b.length&&(S=Object(O.sliceUint8)(b,0,v),this.remainderData=Object(O.sliceUint8)(b,v)),S},I.logOnce=function(b){!this.logEnabled||(M.logger.log("[decrypter.ts]: "+b),this.logEnabled=!1)},x}()},"./src/crypt/fast-aes-key.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return n});var n=function(){function a(M,C){this.subtle=void 0,this.key=void 0,this.subtle=M,this.key=C}var u=a.prototype;return u.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},a}()},"./src/demux/aacdemuxer.ts":function(r,t,e){"use strict";e.r(t);var n=e("./src/demux/base-audio-demuxer.ts"),a=e("./src/demux/adts.ts"),u=e("./src/utils/logger.ts"),M=e("./src/demux/id3.ts");function C(A,x){A.prototype=Object.create(x.prototype),A.prototype.constructor=A,O(A,x)}function O(A,x){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,b){return _.__proto__=b,_},O(A,x)}var L=function(A){C(x,A);function x(_,b){var S;return S=A.call(this)||this,S.observer=void 0,S.config=void 0,S.observer=_,S.config=b,S}var I=x.prototype;return I.resetInitSegment=function(b,S,v,i){A.prototype.resetInitSegment.call(this,b,S,v,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:S,duration:i,inputTimeScale:9e4,dropped:0}},x.probe=function(b){if(!b)return!1;for(var S=M.getID3Data(b,0)||[],v=S.length,i=b.length;v<i;v++)if(a.probe(b,v))return u.logger.log("ADTS sync word found !"),!0;return!1},I.canParse=function(b,S){return a.canParse(b,S)},I.appendFrame=function(b,S,v){a.initTrackConfig(b,this.observer,S,v,b.manifestCodec);var i=a.appendFrame(b,S,v,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i},x}(n.default);t.default=L},"./src/demux/adts.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"getAudioConfig",function(){return M}),e.d(t,"isHeaderPattern",function(){return C}),e.d(t,"getHeaderLength",function(){return O}),e.d(t,"getFullFrameLength",function(){return L}),e.d(t,"canGetFrameLength",function(){return A}),e.d(t,"isHeader",function(){return x}),e.d(t,"canParse",function(){return I}),e.d(t,"probe",function(){return _}),e.d(t,"initTrackConfig",function(){return b}),e.d(t,"getFrameDuration",function(){return S}),e.d(t,"parseFrameHeader",function(){return v}),e.d(t,"appendFrame",function(){return i});var n=e("./src/utils/logger.ts"),a=e("./src/errors.ts"),u=e("./src/events.ts");function M(d,p,T,l){var o,h,E,s,c=navigator.userAgent.toLowerCase(),m=l,f=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];o=((p[T+2]&192)>>>6)+1;var g=(p[T+2]&60)>>>2;if(g>f.length-1){d.trigger(u.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+g});return}return E=(p[T+2]&1)<<2,E|=(p[T+3]&192)>>>6,n.logger.log("manifest codec:"+l+", ADTS type:"+o+", samplingIndex:"+g),/firefox/i.test(c)?g>=6?(o=5,s=new Array(4),h=g-3):(o=2,s=new Array(2),h=g):c.indexOf("android")!==-1?(o=2,s=new Array(2),h=g):(o=5,s=new Array(4),l&&(l.indexOf("mp4a.40.29")!==-1||l.indexOf("mp4a.40.5")!==-1)||!l&&g>=6?h=g-3:((l&&l.indexOf("mp4a.40.2")!==-1&&(g>=6&&E===1||/vivaldi/i.test(c))||!l&&E===1)&&(o=2,s=new Array(2)),h=g)),s[0]=o<<3,s[0]|=(g&14)>>1,s[1]|=(g&1)<<7,s[1]|=E<<3,o===5&&(s[1]|=(h&14)>>1,s[2]=(h&1)<<7,s[2]|=2<<2,s[3]=0),{config:s,samplerate:f[g],channelCount:E,codec:"mp4a.40."+o,manifestCodec:m}}function C(d,p){return d[p]===255&&(d[p+1]&246)===240}function O(d,p){return d[p+1]&1?7:9}function L(d,p){return(d[p+3]&3)<<11|d[p+4]<<3|(d[p+5]&224)>>>5}function A(d,p){return p+5<d.length}function x(d,p){return p+1<d.length&&C(d,p)}function I(d,p){return A(d,p)&&C(d,p)&&L(d,p)<=d.length-p}function _(d,p){if(x(d,p)){var T=O(d,p);if(p+T>=d.length)return!1;var l=L(d,p);if(l<=T)return!1;var o=p+l;return o===d.length||x(d,o)}return!1}function b(d,p,T,l,o){if(!d.samplerate){var h=M(p,T,l,o);if(!h)return;d.config=h.config,d.samplerate=h.samplerate,d.channelCount=h.channelCount,d.codec=h.codec,d.manifestCodec=h.manifestCodec,n.logger.log("parsed codec:"+d.codec+", rate:"+h.samplerate+", channels:"+h.channelCount)}}function S(d){return 1024*9e4/d}function v(d,p){var T=O(d,p);if(p+T<=d.length){var l=L(d,p)-T;if(l>0)return{headerLength:T,frameLength:l}}}function i(d,p,T,l,o){var h=S(d.samplerate),E=l+o*h,s=v(p,T),c;if(s){var m=s.frameLength,f=s.headerLength,g=f+m,y=Math.max(0,T+g-p.length);y?(c=new Uint8Array(g-f),c.set(p.subarray(T+f,p.length),0)):c=p.subarray(T+f,T+g);var R={unit:c,pts:E};return y||d.samples.push(R),{sample:R,length:g,missing:y}}var D=p.length-T;c=new Uint8Array(D),c.set(p.subarray(T,p.length),0);var P={unit:c,pts:E};return{sample:P,length:D,missing:-1}}},"./src/demux/base-audio-demuxer.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"initPTSFn",function(){return A});var n=e("./src/polyfills/number.ts"),a=e("./src/demux/id3.ts"),u=e("./src/types/demuxer.ts"),M=e("./src/demux/dummy-demuxed-track.ts"),C=e("./src/utils/mp4-tools.ts"),O=e("./src/utils/typed-array.ts"),L=function(){function x(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null}var I=x.prototype;return I.resetInitSegment=function(b,S,v,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},I.resetTimeStamp=function(b){this.initPTS=b,this.resetContiguity()},I.resetContiguity=function(){this.basePTS=null,this.frameIndex=0},I.canParse=function(b,S){return!1},I.appendFrame=function(b,S,v){},I.demux=function(b,S){this.cachedData&&(b=Object(C.appendUint8Array)(this.cachedData,b),this.cachedData=null);var v=a.getID3Data(b,0),i=v?v.length:0,d,p,T=this._audioTrack,l=this._id3Track,o=v?a.getTimeStamp(v):void 0,h=b.length;for((this.basePTS===null||this.frameIndex===0&&Object(n.isFiniteNumber)(o))&&(this.basePTS=A(o,S,this.initPTS)),v&&v.length>0&&l.samples.push({pts:this.basePTS,dts:this.basePTS,data:v,type:u.MetadataSchema.audioId3}),p=this.basePTS;i<h;){if(this.canParse(b,i)){var E=this.appendFrame(T,b,i);E?(this.frameIndex++,p=E.sample.pts,i+=E.length,d=i):i=h}else a.canParse(b,i)?(v=a.getID3Data(b,i),l.samples.push({pts:p,dts:p,data:v,type:u.MetadataSchema.audioId3}),i+=v.length,d=i):i++;if(i===h&&d!==h){var s=Object(O.sliceUint8)(b,d);this.cachedData?this.cachedData=Object(C.appendUint8Array)(this.cachedData,s):this.cachedData=s}}return{audioTrack:T,videoTrack:Object(M.dummyTrack)(),id3Track:l,textTrack:Object(M.dummyTrack)()}},I.demuxSampleAes=function(b,S,v){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},I.flush=function(b){var S=this.cachedData;return S&&(this.cachedData=null,this.demux(S,0)),{audioTrack:this._audioTrack,videoTrack:Object(M.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(M.dummyTrack)()}},I.destroy=function(){},x}(),A=function(I,_,b){return Object(n.isFiniteNumber)(I)?I*90:_*9e4+(b||0)};t.default=L},"./src/demux/chunk-cache.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return n});var n=function(){function u(){this.chunks=[],this.dataLength=0}var M=u.prototype;return M.push=function(O){this.chunks.push(O),this.dataLength+=O.length},M.flush=function(){var O=this.chunks,L=this.dataLength,A;if(O.length)O.length===1?A=O[0]:A=a(O,L);else return new Uint8Array(0);return this.reset(),A},M.reset=function(){this.chunks.length=0,this.dataLength=0},u}();function a(u,M){for(var C=new Uint8Array(M),O=0,L=0;L<u.length;L++){var A=u[L];C.set(A,O),O+=A.length}return C}},"./src/demux/dummy-demuxed-track.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"dummyTrack",function(){return n});function n(a,u){return a===void 0&&(a=""),u===void 0&&(u=9e4),{type:a,id:-1,pid:-1,inputTimeScale:u,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(r,t,e){"use strict";e.r(t);var n=e("./src/utils/logger.ts"),a=function(){function u(C){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=C,this.bytesAvailable=C.byteLength,this.word=0,this.bitsAvailable=0}var M=u.prototype;return M.loadWord=function(){var O=this.data,L=this.bytesAvailable,A=O.byteLength-L,x=new Uint8Array(4),I=Math.min(4,L);if(I===0)throw new Error("no bytes available");x.set(O.subarray(A,A+I)),this.word=new DataView(x.buffer).getUint32(0),this.bitsAvailable=I*8,this.bytesAvailable-=I},M.skipBits=function(O){var L;this.bitsAvailable>O?(this.word<<=O,this.bitsAvailable-=O):(O-=this.bitsAvailable,L=O>>3,O-=L>>3,this.bytesAvailable-=L,this.loadWord(),this.word<<=O,this.bitsAvailable-=O)},M.readBits=function(O){var L=Math.min(this.bitsAvailable,O),A=this.word>>>32-L;return O>32&&n.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=L,this.bitsAvailable>0?this.word<<=L:this.bytesAvailable>0&&this.loadWord(),L=O-L,L>0&&this.bitsAvailable?A<<L|this.readBits(L):A},M.skipLZ=function(){var O;for(O=0;O<this.bitsAvailable;++O)if((this.word&2147483648>>>O)!==0)return this.word<<=O,this.bitsAvailable-=O,O;return this.loadWord(),O+this.skipLZ()},M.skipUEG=function(){this.skipBits(1+this.skipLZ())},M.skipEG=function(){this.skipBits(1+this.skipLZ())},M.readUEG=function(){var O=this.skipLZ();return this.readBits(O+1)-1},M.readEG=function(){var O=this.readUEG();return 1&O?1+O>>>1:-1*(O>>>1)},M.readBoolean=function(){return this.readBits(1)===1},M.readUByte=function(){return this.readBits(8)},M.readUShort=function(){return this.readBits(16)},M.readUInt=function(){return this.readBits(32)},M.skipScalingList=function(O){for(var L=8,A=8,x,I=0;I<O;I++)A!==0&&(x=this.readEG(),A=(L+x+256)%256),L=A===0?L:A},M.readSPS=function(){var O=0,L=0,A=0,x=0,I,_,b,S=this.readUByte.bind(this),v=this.readBits.bind(this),i=this.readUEG.bind(this),d=this.readBoolean.bind(this),p=this.skipBits.bind(this),T=this.skipEG.bind(this),l=this.skipUEG.bind(this),o=this.skipScalingList.bind(this);S();var h=S();if(v(5),p(3),S(),l(),h===100||h===110||h===122||h===244||h===44||h===83||h===86||h===118||h===128){var E=i();if(E===3&&p(1),l(),l(),p(1),d())for(_=E!==3?8:12,b=0;b<_;b++)d()&&(b<6?o(16):o(64))}l();var s=i();if(s===0)i();else if(s===1)for(p(1),T(),T(),I=i(),b=0;b<I;b++)T();l(),p(1);var c=i(),m=i(),f=v(1);f===0&&p(1),p(1),d()&&(O=i(),L=i(),A=i(),x=i());var g=[1,1];if(d()&&d()){var y=S();switch(y){case 1:g=[1,1];break;case 2:g=[12,11];break;case 3:g=[10,11];break;case 4:g=[16,11];break;case 5:g=[40,33];break;case 6:g=[24,11];break;case 7:g=[20,11];break;case 8:g=[32,11];break;case 9:g=[80,33];break;case 10:g=[18,11];break;case 11:g=[15,11];break;case 12:g=[64,33];break;case 13:g=[160,99];break;case 14:g=[4,3];break;case 15:g=[3,2];break;case 16:g=[2,1];break;case 255:{g=[S()<<8|S(),S()<<8|S()];break}}}return{width:Math.ceil((c+1)*16-O*2-L*2),height:(2-f)*(m+1)*16-(f?2:4)*(A+x),pixelRatio:g}},M.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},u}();t.default=a},"./src/demux/id3.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"isHeader",function(){return n}),e.d(t,"isFooter",function(){return a}),e.d(t,"getID3Data",function(){return u}),e.d(t,"canParse",function(){return C}),e.d(t,"getTimeStamp",function(){return O}),e.d(t,"isTimeStampFrame",function(){return L}),e.d(t,"getID3Frames",function(){return x}),e.d(t,"decodeFrame",function(){return I}),e.d(t,"utf8ArrayToStr",function(){return i}),e.d(t,"testables",function(){return d});var n=function(o,h){return h+10<=o.length&&o[h]===73&&o[h+1]===68&&o[h+2]===51&&o[h+3]<255&&o[h+4]<255&&o[h+6]<128&&o[h+7]<128&&o[h+8]<128&&o[h+9]<128},a=function(o,h){return h+10<=o.length&&o[h]===51&&o[h+1]===68&&o[h+2]===73&&o[h+3]<255&&o[h+4]<255&&o[h+6]<128&&o[h+7]<128&&o[h+8]<128&&o[h+9]<128},u=function(o,h){for(var E=h,s=0;n(o,h);){s+=10;var c=M(o,h+6);s+=c,a(o,h+10)&&(s+=10),h+=s}if(s>0)return o.subarray(E,E+s)},M=function(o,h){var E=0;return E=(o[h]&127)<<21,E|=(o[h+1]&127)<<14,E|=(o[h+2]&127)<<7,E|=o[h+3]&127,E},C=function(o,h){return n(o,h)&&M(o,h+6)+10<=o.length-h},O=function(o){for(var h=x(o),E=0;E<h.length;E++){var s=h[E];if(L(s))return v(s)}},L=function(o){return o&&o.key==="PRIV"&&o.info==="com.apple.streaming.transportStreamTimestamp"},A=function(o){var h=String.fromCharCode(o[0],o[1],o[2],o[3]),E=M(o,4),s=10;return{type:h,size:E,data:o.subarray(s,s+E)}},x=function(o){for(var h=0,E=[];n(o,h);){var s=M(o,h+6);h+=10;for(var c=h+s;h+8<c;){var m=A(o.subarray(h)),f=I(m);f&&E.push(f),h+=m.size+10}a(o,h)&&(h+=10)}return E},I=function(o){return o.type==="PRIV"?_(o):o.type[0]==="W"?S(o):b(o)},_=function(o){if(!(o.size<2)){var h=i(o.data,!0),E=new Uint8Array(o.data.subarray(h.length+1));return{key:o.type,info:h,data:E.buffer}}},b=function(o){if(!(o.size<2)){if(o.type==="TXXX"){var h=1,E=i(o.data.subarray(h),!0);h+=E.length+1;var s=i(o.data.subarray(h));return{key:o.type,info:E,data:s}}var c=i(o.data.subarray(1));return{key:o.type,data:c}}},S=function(o){if(o.type==="WXXX"){if(o.size<2)return;var h=1,E=i(o.data.subarray(h),!0);h+=E.length+1;var s=i(o.data.subarray(h));return{key:o.type,info:E,data:s}}var c=i(o.data);return{key:o.type,data:c}},v=function(o){if(o.data.byteLength===8){var h=new Uint8Array(o.data),E=h[3]&1,s=(h[4]<<23)+(h[5]<<15)+(h[6]<<7)+h[7];return s/=45,E&&(s+=4772185884e-2),Math.round(s)}},i=function(o,h){h===void 0&&(h=!1);var E=T();if(E){var s=E.decode(o);if(h){var c=s.indexOf("\0");return c!==-1?s.substring(0,c):s}return s.replace(/\0/g,"")}for(var m=o.length,f,g,y,R="",D=0;D<m;){if(f=o[D++],f===0&&h)return R;if(f===0||f===3)continue;switch(f>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:R+=String.fromCharCode(f);break;case 12:case 13:g=o[D++],R+=String.fromCharCode((f&31)<<6|g&63);break;case 14:g=o[D++],y=o[D++],R+=String.fromCharCode((f&15)<<12|(g&63)<<6|(y&63)<<0);break;default:}}return R},d={decodeTextFrame:b},p;function T(){return!p&&typeof self.TextDecoder!="undefined"&&(p=new self.TextDecoder("utf-8")),p}},"./src/demux/mp3demuxer.ts":function(r,t,e){"use strict";e.r(t);var n=e("./src/demux/base-audio-demuxer.ts"),a=e("./src/demux/id3.ts"),u=e("./src/utils/logger.ts"),M=e("./src/demux/mpegaudio.ts");function C(A,x){A.prototype=Object.create(x.prototype),A.prototype.constructor=A,O(A,x)}function O(A,x){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,b){return _.__proto__=b,_},O(A,x)}var L=function(A){C(x,A);function x(){return A.apply(this,arguments)||this}var I=x.prototype;return I.resetInitSegment=function(b,S,v,i){A.prototype.resetInitSegment.call(this,b,S,v,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:S,duration:i,inputTimeScale:9e4,dropped:0}},x.probe=function(b){if(!b)return!1;for(var S=a.getID3Data(b,0)||[],v=S.length,i=b.length;v<i;v++)if(M.probe(b,v))return u.logger.log("MPEG Audio sync word found !"),!0;return!1},I.canParse=function(b,S){return M.canParse(b,S)},I.appendFrame=function(b,S,v){if(this.basePTS!==null)return M.appendFrame(b,S,v,this.basePTS,this.frameIndex)},x}(n.default);t.default=L},"./src/demux/mp4demuxer.ts":function(r,t,e){"use strict";e.r(t);var n=e("./src/polyfills/number.ts"),a=e("./src/types/demuxer.ts"),u=e("./src/utils/mp4-tools.ts"),M=e("./src/demux/dummy-demuxed-track.ts"),C=/\/emsg[-/]ID3/i,O=function(){function L(x,I){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=I}var A=L.prototype;return A.resetTimeStamp=function(){},A.resetInitSegment=function(I,_,b,S){var v=Object(u.parseInitSegment)(I),i=this.videoTrack=Object(M.dummyTrack)("video",1),d=this.audioTrack=Object(M.dummyTrack)("audio",1),p=this.txtTrack=Object(M.dummyTrack)("text",1);if(this.id3Track=Object(M.dummyTrack)("id3",1),this.timeOffset=0,v.video){var T=v.video,l=T.id,o=T.timescale,h=T.codec;i.id=l,i.timescale=p.timescale=o,i.codec=h}if(v.audio){var E=v.audio,s=E.id,c=E.timescale,m=E.codec;d.id=s,d.timescale=c,d.codec=m}p.id=u.RemuxerTrackIdConfig.text,i.sampleDuration=0,i.duration=d.duration=S},A.resetContiguity=function(){},L.probe=function(I){return I=I.length>16384?I.subarray(0,16384):I,Object(u.findBox)(I,["moof"]).length>0},A.demux=function(I,_){this.timeOffset=_;var b=I,S=this.videoTrack,v=this.txtTrack;if(this.config.progressive){this.remainderData&&(b=Object(u.appendUint8Array)(this.remainderData,I));var i=Object(u.segmentValidRange)(b);this.remainderData=i.remainder,S.samples=i.valid||new Uint8Array}else S.samples=b;var d=this.extractID3Track(S,_);return v.samples=Object(u.parseSamples)(_,S),{videoTrack:S,audioTrack:this.audioTrack,id3Track:d,textTrack:this.txtTrack}},A.flush=function(){var I=this.timeOffset,_=this.videoTrack,b=this.txtTrack;_.samples=this.remainderData||new Uint8Array,this.remainderData=null;var S=this.extractID3Track(_,this.timeOffset);return b.samples=Object(u.parseSamples)(I,_),{videoTrack:_,audioTrack:Object(M.dummyTrack)(),id3Track:S,textTrack:Object(M.dummyTrack)()}},A.extractID3Track=function(I,_){var b=this.id3Track;if(I.samples.length){var S=Object(u.findBox)(I.samples,["emsg"]);S&&S.forEach(function(v){var i=Object(u.parseEmsg)(v);if(C.test(i.schemeIdUri)){var d=Object(n.isFiniteNumber)(i.presentationTime)?i.presentationTime/i.timeScale:_+i.presentationTimeDelta/i.timeScale,p=i.payload;b.samples.push({data:p,len:p.byteLength,dts:d,pts:d,type:a.MetadataSchema.emsg})}})}return b},A.demuxSampleAes=function(I,_,b){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},A.destroy=function(){},L}();t.default=O},"./src/demux/mpegaudio.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"appendFrame",function(){return O}),e.d(t,"parseHeader",function(){return L}),e.d(t,"isHeaderPattern",function(){return A}),e.d(t,"isHeader",function(){return x}),e.d(t,"canParse",function(){return I}),e.d(t,"probe",function(){return _});var n=null,a=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],u=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],M=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],C=[0,1,1,4];function O(b,S,v,i,d){if(!(v+24>S.length)){var p=L(S,v);if(p&&v+p.frameLength<=S.length){var T=p.samplesPerFrame*9e4/p.sampleRate,l=i+d*T,o={unit:S.subarray(v,v+p.frameLength),pts:l,dts:l};return b.config=[],b.channelCount=p.channelCount,b.samplerate=p.sampleRate,b.samples.push(o),{sample:o,length:p.frameLength,missing:0}}}}function L(b,S){var v=b[S+1]>>3&3,i=b[S+1]>>1&3,d=b[S+2]>>4&15,p=b[S+2]>>2&3;if(v!==1&&d!==0&&d!==15&&p!==3){var T=b[S+2]>>1&1,l=b[S+3]>>6,o=v===3?3-i:i===3?3:4,h=a[o*14+d-1]*1e3,E=v===3?0:v===2?1:2,s=u[E*3+p],c=l===3?1:2,m=M[v][i],f=C[i],g=m*8*f,y=Math.floor(m*h/s+T)*f;if(n===null){var R=navigator.userAgent||"",D=R.match(/Chrome\/(\d+)/i);n=D?parseInt(D[1]):0}var P=!!n&&n<=87;return P&&i===2&&h>=224e3&&l===0&&(b[S+3]=b[S+3]|128),{sampleRate:s,channelCount:c,frameLength:y,samplesPerFrame:g}}}function A(b,S){return b[S]===255&&(b[S+1]&224)===224&&(b[S+1]&6)!==0}function x(b,S){return S+1<b.length&&A(b,S)}function I(b,S){var v=4;return A(b,S)&&v<=b.length-S}function _(b,S){if(S+1<b.length&&A(b,S)){var v=4,i=L(b,S),d=v;i!=null&&i.frameLength&&(d=i.frameLength);var p=S+d;return p===b.length||x(b,p)}return!1}},"./src/demux/sample-aes.ts":function(r,t,e){"use strict";e.r(t);var n=e("./src/crypt/decrypter.ts"),a=e("./src/demux/tsdemuxer.ts"),u=function(){function M(O,L,A){this.keyData=void 0,this.decrypter=void 0,this.keyData=A,this.decrypter=new n.default(O,L,{removePKCS7Padding:!1})}var C=M.prototype;return C.decryptBuffer=function(L,A){this.decrypter.decrypt(L,this.keyData.key.buffer,this.keyData.iv.buffer,A)},C.decryptAacSample=function(L,A,x,I){var _=L[A].unit;if(!(_.length<=16)){var b=_.subarray(16,_.length-_.length%16),S=b.buffer.slice(b.byteOffset,b.byteOffset+b.length),v=this;this.decryptBuffer(S,function(i){var d=new Uint8Array(i);_.set(d,16),I||v.decryptAacSamples(L,A+1,x)})}},C.decryptAacSamples=function(L,A,x){for(;;A++){if(A>=L.length){x();return}if(!(L[A].unit.length<32)){var I=this.decrypter.isSync();if(this.decryptAacSample(L,A,x,I),!I)return}}},C.getAvcEncryptedData=function(L){for(var A=Math.floor((L.length-48)/160)*16+16,x=new Int8Array(A),I=0,_=32;_<L.length-16;_+=160,I+=16)x.set(L.subarray(_,_+16),I);return x},C.getAvcDecryptedUnit=function(L,A){for(var x=new Uint8Array(A),I=0,_=32;_<L.length-16;_+=160,I+=16)L.set(x.subarray(I,I+16),_);return L},C.decryptAvcSample=function(L,A,x,I,_,b){var S=Object(a.discardEPB)(_.data),v=this.getAvcEncryptedData(S),i=this;this.decryptBuffer(v.buffer,function(d){_.data=i.getAvcDecryptedUnit(S,d),b||i.decryptAvcSamples(L,A,x+1,I)})},C.decryptAvcSamples=function(L,A,x,I){if(L instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;A++,x=0){if(A>=L.length){I();return}for(var _=L[A].units;!(x>=_.length);x++){var b=_[x];if(!(b.data.length<=48||b.type!==1&&b.type!==5)){var S=this.decrypter.isSync();if(this.decryptAvcSample(L,A,x,I,b,S),!S)return}}}},M}();t.default=u},"./src/demux/transmuxer-interface.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return _});var n=e("./node_modules/webworkify-webpack/index.js"),a=e.n(n),u=e("./src/events.ts"),M=e("./src/demux/transmuxer.ts"),C=e("./src/utils/logger.ts"),O=e("./src/errors.ts"),L=e("./src/utils/mediasource-helper.ts"),A=e("./node_modules/eventemitter3/index.js"),x=e.n(A),I=Object(L.getMediaSource)()||{isTypeSupported:function(){return!1}},_=function(){function b(v,i,d,p){var T=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=v,this.id=i,this.onTransmuxComplete=d,this.onFlush=p;var l=v.config,o=function(m,f){f=f||{},f.frag=T.frag,f.id=T.id,v.trigger(m,f)};this.observer=new A.EventEmitter,this.observer.on(u.Events.FRAG_DECRYPTED,o),this.observer.on(u.Events.ERROR,o);var h={mp4:I.isTypeSupported("video/mp4"),mpeg:I.isTypeSupported("audio/mpeg"),mp3:I.isTypeSupported('audio/mp4; codecs="mp3"')},E=navigator.vendor;if(l.enableWorker&&typeof Worker!="undefined"){C.logger.log("demuxing in webworker");var s;try{s=this.worker=n("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),s.addEventListener("message",this.onwmsg),s.onerror=function(c){v.trigger(u.Events.ERROR,{type:O.ErrorTypes.OTHER_ERROR,details:O.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(c.message+"  ("+c.filename+":"+c.lineno+")")})},s.postMessage({cmd:"init",typeSupported:h,vendor:E,id:i,config:JSON.stringify(l)})}catch(c){C.logger.warn("Error in worker:",c),C.logger.error("Error while initializing DemuxerWorker, fallback to inline"),s&&self.URL.revokeObjectURL(s.objectURL),this.transmuxer=new M.default(this.observer,h,l,E,i),this.worker=null}}else this.transmuxer=new M.default(this.observer,h,l,E,i)}var S=b.prototype;return S.destroy=function(){var i=this.worker;if(i)i.removeEventListener("message",this.onwmsg),i.terminate(),this.worker=null,this.onwmsg=void 0;else{var d=this.transmuxer;d&&(d.destroy(),this.transmuxer=null)}var p=this.observer;p&&p.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},S.push=function(i,d,p,T,l,o,h,E,s,c){var m,f,g=this;s.transmuxing.start=self.performance.now();var y=this.transmuxer,R=this.worker,D=o?o.start:l.start,P=l.decryptdata,N=this.frag,B=!(N&&l.cc===N.cc),F=!(N&&s.level===N.level),H=N?s.sn-N.sn:-1,j=this.part?s.part-this.part.index:-1,X=H===0&&s.id>1&&s.id===(N==null?void 0:N.stats.chunkCount),$=!F&&(H===1||H===0&&(j===1||X&&j<=0)),G=self.performance.now();(F||H||l.stats.parsing.start===0)&&(l.stats.parsing.start=G),o&&(j||!$)&&(o.stats.parsing.start=G);var J=!(N&&((m=l.initSegment)===null||m===void 0?void 0:m.url)===((f=N.initSegment)===null||f===void 0?void 0:f.url)),ee=new M.TransmuxState(B,$,E,F,D,J);if(!$||B||J){C.logger.log("[transmuxer-interface, "+l.type+"]: Starting new transmux session for sn: "+s.sn+" p: "+s.part+" level: "+s.level+" id: "+s.id+`
        discontinuity: `+B+`
        trackSwitch: `+F+`
        contiguous: `+$+`
        accurateTimeOffset: `+E+`
        timeOffset: `+D+`
        initSegmentChange: `+J);var te=new M.TransmuxConfig(p,T,d,h,c);this.configureTransmuxer(te)}if(this.frag=l,this.part=o,R)R.postMessage({cmd:"demux",data:i,decryptdata:P,chunkMeta:s,state:ee},i instanceof ArrayBuffer?[i]:[]);else if(y){var oe=y.push(i,P,s,ee);Object(M.isPromise)(oe)?oe.then(function(ue){g.handleTransmuxComplete(ue)}):this.handleTransmuxComplete(oe)}},S.flush=function(i){var d=this;i.transmuxing.start=self.performance.now();var p=this.transmuxer,T=this.worker;if(T)T.postMessage({cmd:"flush",chunkMeta:i});else if(p){var l=p.flush(i);Object(M.isPromise)(l)?l.then(function(o){d.handleFlushResult(o,i)}):this.handleFlushResult(l,i)}},S.handleFlushResult=function(i,d){var p=this;i.forEach(function(T){p.handleTransmuxComplete(T)}),this.onFlush(d)},S.onWorkerMessage=function(i){var d=i.data,p=this.hls;switch(d.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(d.data);break}case"flush":{this.onFlush(d.data);break}case"workerLog":C.logger[d.data.logType]&&C.logger[d.data.logType](d.data.message);break;default:{d.data=d.data||{},d.data.frag=this.frag,d.data.id=this.id,p.trigger(d.event,d.data);break}}},S.configureTransmuxer=function(i){var d=this.worker,p=this.transmuxer;d?d.postMessage({cmd:"configure",config:i}):p&&p.configure(i)},S.handleTransmuxComplete=function(i){i.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(i)},b}()},"./src/demux/transmuxer-worker.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return O});var n=e("./src/demux/transmuxer.ts"),a=e("./src/events.ts"),u=e("./src/utils/logger.ts"),M=e("./node_modules/eventemitter3/index.js"),C=e.n(M);function O(_){var b=new M.EventEmitter,S=function(d,p){_.postMessage({event:d,data:p})};b.on(a.Events.FRAG_DECRYPTED,S),b.on(a.Events.ERROR,S);var v=function(){var d=function(l){var o=function(E){S("workerLog",{logType:l,message:E})};u.logger[l]=o};for(var p in u.logger)d(p)};_.addEventListener("message",function(i){var d=i.data;switch(d.cmd){case"init":{var p=JSON.parse(d.config);_.transmuxer=new n.default(b,d.typeSupported,p,d.vendor,d.id),Object(u.enableLogs)(p.debug),v(),S("init",null);break}case"configure":{_.transmuxer.configure(d.config);break}case"demux":{var T=_.transmuxer.push(d.data,d.decryptdata,d.chunkMeta,d.state);Object(n.isPromise)(T)?T.then(function(h){L(_,h)}):L(_,T);break}case"flush":{var l=d.chunkMeta,o=_.transmuxer.flush(l);Object(n.isPromise)(o)?o.then(function(h){x(_,h,l)}):x(_,o,l);break}default:break}})}function L(_,b){if(I(b.remuxResult))return!1;var S=[],v=b.remuxResult,i=v.audio,d=v.video;return i&&A(S,i),d&&A(S,d),_.postMessage({event:"transmuxComplete",data:b},S),!0}function A(_,b){b.data1&&_.push(b.data1.buffer),b.data2&&_.push(b.data2.buffer)}function x(_,b,S){var v=b.reduce(function(i,d){return L(_,d)||i},!1);v||_.postMessage({event:"transmuxComplete",data:b[0]}),_.postMessage({event:"flush",data:S})}function I(_){return!_.audio&&!_.video&&!_.text&&!_.id3&&!_.initSegment}},"./src/demux/transmuxer.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return S}),e.d(t,"isPromise",function(){return d}),e.d(t,"TransmuxConfig",function(){return p}),e.d(t,"TransmuxState",function(){return T});var n=e("./src/events.ts"),a=e("./src/errors.ts"),u=e("./src/crypt/decrypter.ts"),M=e("./src/demux/aacdemuxer.ts"),C=e("./src/demux/mp4demuxer.ts"),O=e("./src/demux/tsdemuxer.ts"),L=e("./src/demux/mp3demuxer.ts"),A=e("./src/remux/mp4-remuxer.ts"),x=e("./src/remux/passthrough-remuxer.ts"),I=e("./src/utils/logger.ts"),_;try{_=self.performance.now.bind(self.performance)}catch{I.logger.debug("Unable to use Performance API on this environment"),_=self.Date.now}var b=[{demux:O.default,remux:A.default},{demux:C.default,remux:x.default},{demux:M.default,remux:A.default},{demux:L.default,remux:A.default}],S=function(){function l(h,E,s,c,m){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=h,this.typeSupported=E,this.config=s,this.vendor=c,this.id=m}var o=l.prototype;return o.configure=function(E){this.transmuxConfig=E,this.decrypter&&this.decrypter.reset()},o.push=function(E,s,c,m){var f=this,g=c.transmuxing;g.executeStart=_();var y=new Uint8Array(E),R=this.config,D=this.currentTransmuxState,P=this.transmuxConfig;m&&(this.currentTransmuxState=m);var N=m||D,B=N.contiguous,F=N.discontinuity,H=N.trackSwitch,j=N.accurateTimeOffset,X=N.timeOffset,$=N.initSegmentChange,G=P.audioCodec,J=P.videoCodec,ee=P.defaultInitPts,te=P.duration,oe=P.initSegmentData;(F||H||$)&&this.resetInitSegment(oe,G,J,te),(F||$)&&this.resetInitialTimestamp(ee),B||this.resetContiguity();var ue=v(y,s);if(ue&&ue.method==="AES-128"){var ne=this.getDecrypter();if(R.enableSoftwareAES){var he=ne.softwareDecrypt(y,ue.key.buffer,ue.iv.buffer);if(!he)return g.executeEnd=_(),i(c);y=new Uint8Array(he)}else return this.decryptionPromise=ne.webCryptoDecrypt(y,ue.key.buffer,ue.iv.buffer).then(function(Me){var Se=f.push(Me,null,c);return f.decryptionPromise=null,Se}),this.decryptionPromise}this.needsProbing(y,F,H)&&this.configureTransmuxer(y,P);var me=this.transmux(y,ue,X,j,c),ae=this.currentTransmuxState;return ae.contiguous=!0,ae.discontinuity=!1,ae.trackSwitch=!1,g.executeEnd=_(),me},o.flush=function(E){var s=this,c=E.transmuxing;c.executeStart=_();var m=this.decrypter,f=this.currentTransmuxState,g=this.decryptionPromise;if(g)return g.then(function(){return s.flush(E)});var y=[],R=f.timeOffset;if(m){var D=m.flush();D&&y.push(this.push(D,null,E))}var P=this.demuxer,N=this.remuxer;if(!P||!N)return this.observer.emit(n.Events.ERROR,n.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),c.executeEnd=_(),[i(E)];var B=P.flush(R);return d(B)?B.then(function(F){return s.flushRemux(y,F,E),y}):(this.flushRemux(y,B,E),y)},o.flushRemux=function(E,s,c){var m=s.audioTrack,f=s.videoTrack,g=s.id3Track,y=s.textTrack,R=this.currentTransmuxState,D=R.accurateTimeOffset,P=R.timeOffset;I.logger.log("[transmuxer.ts]: Flushed fragment "+c.sn+(c.part>-1?" p: "+c.part:"")+" of level "+c.level);var N=this.remuxer.remux(m,f,g,y,P,D,!0,this.id);E.push({remuxResult:N,chunkMeta:c}),c.transmuxing.executeEnd=_()},o.resetInitialTimestamp=function(E){var s=this.demuxer,c=this.remuxer;!s||!c||(s.resetTimeStamp(E),c.resetTimeStamp(E))},o.resetContiguity=function(){var E=this.demuxer,s=this.remuxer;!E||!s||(E.resetContiguity(),s.resetNextTimestamp())},o.resetInitSegment=function(E,s,c,m){var f=this.demuxer,g=this.remuxer;!f||!g||(f.resetInitSegment(E,s,c,m),g.resetInitSegment(E,s,c))},o.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},o.transmux=function(E,s,c,m,f){var g;return s&&s.method==="SAMPLE-AES"?g=this.transmuxSampleAes(E,s,c,m,f):g=this.transmuxUnencrypted(E,c,m,f),g},o.transmuxUnencrypted=function(E,s,c,m){var f=this.demuxer.demux(E,s,!1,!this.config.progressive),g=f.audioTrack,y=f.videoTrack,R=f.id3Track,D=f.textTrack,P=this.remuxer.remux(g,y,R,D,s,c,!1,this.id);return{remuxResult:P,chunkMeta:m}},o.transmuxSampleAes=function(E,s,c,m,f){var g=this;return this.demuxer.demuxSampleAes(E,s,c).then(function(y){var R=g.remuxer.remux(y.audioTrack,y.videoTrack,y.id3Track,y.textTrack,c,m,!1,g.id);return{remuxResult:R,chunkMeta:f}})},o.configureTransmuxer=function(E,s){for(var c=this.config,m=this.observer,f=this.typeSupported,g=this.vendor,y=s.audioCodec,R=s.defaultInitPts,D=s.duration,P=s.initSegmentData,N=s.videoCodec,B,F=0,H=b.length;F<H;F++)if(b[F].demux.probe(E)){B=b[F];break}B||(I.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),B={demux:C.default,remux:x.default});var j=this.demuxer,X=this.remuxer,$=B.remux,G=B.demux;(!X||!(X instanceof $))&&(this.remuxer=new $(m,c,f,g)),(!j||!(j instanceof G))&&(this.demuxer=new G(m,c,f),this.probe=G.probe),this.resetInitSegment(P,y,N,D),this.resetInitialTimestamp(R)},o.needsProbing=function(E,s,c){return!this.demuxer||!this.remuxer||s||c},o.getDecrypter=function(){var E=this.decrypter;return E||(E=this.decrypter=new u.default(this.observer,this.config)),E},l}();function v(l,o){var h=null;return l.byteLength>0&&o!=null&&o.key!=null&&o.iv!==null&&o.method!=null&&(h=o),h}var i=function(o){return{remuxResult:{},chunkMeta:o}};function d(l){return"then"in l&&l.then instanceof Function}var p=function(o,h,E,s,c){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=o,this.videoCodec=h,this.initSegmentData=E,this.duration=s,this.defaultInitPts=c},T=function(o,h,E,s,c,m){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=o,this.contiguous=h,this.accurateTimeOffset=E,this.trackSwitch=s,this.timeOffset=c,this.initSegmentChange=m}},"./src/demux/tsdemuxer.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"discardEPB",function(){return p});var n=e("./src/demux/adts.ts"),a=e("./src/demux/mpegaudio.ts"),u=e("./src/demux/exp-golomb.ts"),M=e("./src/demux/sample-aes.ts"),C=e("./src/events.ts"),O=e("./src/utils/mp4-tools.ts"),L=e("./src/utils/logger.ts"),A=e("./src/errors.ts"),x=e("./src/types/demuxer.ts");function I(){return I=Object.assign?Object.assign.bind():function(T){for(var l=1;l<arguments.length;l++){var o=arguments[l];for(var h in o)Object.prototype.hasOwnProperty.call(o,h)&&(T[h]=o[h])}return T},I.apply(this,arguments)}var _=function(){function T(o,h,E){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=o,this.config=h,this.typeSupported=E}T.probe=function(h){return h[0]===71&&h[188]===71},T.createTrack=function(h,E){return{container:h==="video"||h==="audio"?"video/mp2t":void 0,type:h,id:O.RemuxerTrackIdConfig[h],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:h==="audio"?E:void 0}};var l=T.prototype;return l.resetInitSegment=function(h,E,s,c){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=T.createTrack("video"),this._audioTrack=T.createTrack("audio",c),this._id3Track=T.createTrack("id3"),this._txtTrack=T.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=E,this.videoCodec=s,this._duration=c},l.resetTimeStamp=function(){},l.resetContiguity=function(){var h=this._audioTrack,E=this._avcTrack,s=this._id3Track;h&&(h.pesData=null),E&&(E.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null},l.demux=function(h,E,s,c){s===void 0&&(s=!1),c===void 0&&(c=!1),s||(this.sampleAes=null);var m,f=this._avcTrack,g=this._audioTrack,y=this._id3Track,R=this._txtTrack,D=f.pid,P=f.pesData,N=g.pid,B=y.pid,F=g.pesData,H=y.pesData,j=null,X=this.pmtParsed,$=this._pmtId,G=h.length;if(this.remainderData&&(h=Object(O.appendUint8Array)(this.remainderData,h),G=h.length,this.remainderData=null),G<188&&!c)return this.remainderData=h,{audioTrack:g,videoTrack:f,id3Track:y,textTrack:R};G-=G%188,G<h.byteLength&&!c&&(this.remainderData=new Uint8Array(h.buffer,G,h.buffer.byteLength-G));for(var J=0,ee=0;ee<G;ee+=188)if(h[ee]===71){var te=!!(h[ee+1]&64),oe=((h[ee+1]&31)<<8)+h[ee+2],ue=(h[ee+3]&48)>>4,ne=void 0;if(ue>1){if(ne=ee+5+h[ee+4],ne===ee+188)continue}else ne=ee+4;switch(oe){case D:te&&(P&&(m=i(P))&&this.parseAVCPES(f,R,m,!1),P={data:[],size:0}),P&&(P.data.push(h.subarray(ne,ee+188)),P.size+=ee+188-ne);break;case N:if(te){if(F&&(m=i(F)))switch(g.segmentCodec){case"aac":this.parseAACPES(g,m);break;case"mp3":this.parseMPEGPES(g,m);break}F={data:[],size:0}}F&&(F.data.push(h.subarray(ne,ee+188)),F.size+=ee+188-ne);break;case B:te&&(H&&(m=i(H))&&this.parseID3PES(y,m),H={data:[],size:0}),H&&(H.data.push(h.subarray(ne,ee+188)),H.size+=ee+188-ne);break;case 0:te&&(ne+=h[ne]+1),$=this._pmtId=S(h,ne);break;case $:{te&&(ne+=h[ne]+1);var he=v(h,ne,this.typeSupported,s);D=he.avc,D>0&&(f.pid=D),N=he.audio,N>0&&(g.pid=N,g.segmentCodec=he.segmentCodec),B=he.id3,B>0&&(y.pid=B),j!==null&&!X&&(L.logger.log("unknown PID '"+j+"' in TS found"),j=null),X=this.pmtParsed=!0;break}case 17:case 8191:break;default:j=oe;break}}else J++;J>0&&this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+J+" TS packet/s that do not start with 0x47"}),f.pesData=P,g.pesData=F,y.pesData=H;var me={audioTrack:g,videoTrack:f,id3Track:y,textTrack:R};return c&&this.extractRemainingSamples(me),me},l.flush=function(){var h=this.remainderData;this.remainderData=null;var E;return h?E=this.demux(h,-1,!1,!0):E={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(E),this.sampleAes?this.decrypt(E,this.sampleAes):E},l.extractRemainingSamples=function(h){var E=h.audioTrack,s=h.videoTrack,c=h.id3Track,m=h.textTrack,f=s.pesData,g=E.pesData,y=c.pesData,R;if(f&&(R=i(f))?(this.parseAVCPES(s,m,R,!0),s.pesData=null):s.pesData=f,g&&(R=i(g))){switch(E.segmentCodec){case"aac":this.parseAACPES(E,R);break;case"mp3":this.parseMPEGPES(E,R);break}E.pesData=null}else g!=null&&g.size&&L.logger.log("last AAC PES packet truncated,might overlap between fragments"),E.pesData=g;y&&(R=i(y))?(this.parseID3PES(c,R),c.pesData=null):c.pesData=y},l.demuxSampleAes=function(h,E,s){var c=this.demux(h,s,!0,!this.config.progressive),m=this.sampleAes=new M.default(this.observer,this.config,E);return this.decrypt(c,m)},l.decrypt=function(h,E){return new Promise(function(s){var c=h.audioTrack,m=h.videoTrack;c.samples&&c.segmentCodec==="aac"?E.decryptAacSamples(c.samples,0,function(){m.samples?E.decryptAvcSamples(m.samples,0,0,function(){s(h)}):s(h)}):m.samples&&E.decryptAvcSamples(m.samples,0,0,function(){s(h)})})},l.destroy=function(){this._duration=0},l.parseAVCPES=function(h,E,s,c){var m=this,f=this.parseAVCNALu(h,s.data),g=!1,y=this.avcSample,R,D=!1;s.data=null,y&&f.length&&!h.audFound&&(d(y,h),y=this.avcSample=b(!1,s.pts,s.dts,"")),f.forEach(function(P){switch(P.type){case 1:{R=!0,y||(y=m.avcSample=b(!0,s.pts,s.dts,"")),g&&(y.debug+="NDR "),y.frame=!0;var N=P.data;if(D&&N.length>4){var B=new u.default(N).readSliceType();(B===2||B===4||B===7||B===9)&&(y.key=!0)}break}case 5:R=!0,y||(y=m.avcSample=b(!0,s.pts,s.dts,"")),g&&(y.debug+="IDR "),y.key=!0,y.frame=!0;break;case 6:{R=!0,g&&y&&(y.debug+="SEI "),Object(O.parseSEIMessageFromNALu)(p(P.data),s.pts,E.samples);break}case 7:if(R=!0,D=!0,g&&y&&(y.debug+="SPS "),!h.sps){var F=new u.default(P.data),H=F.readSPS();h.width=H.width,h.height=H.height,h.pixelRatio=H.pixelRatio,h.sps=[P.data],h.duration=m._duration;for(var j=P.data.subarray(1,4),X="avc1.",$=0;$<3;$++){var G=j[$].toString(16);G.length<2&&(G="0"+G),X+=G}h.codec=X}break;case 8:R=!0,g&&y&&(y.debug+="PPS "),h.pps||(h.pps=[P.data]);break;case 9:R=!1,h.audFound=!0,y&&d(y,h),y=m.avcSample=b(!1,s.pts,s.dts,g?"AUD ":"");break;case 12:R=!0;break;default:R=!1,y&&(y.debug+="unknown NAL "+P.type+" ");break}if(y&&R){var J=y.units;J.push(P)}}),c&&y&&(d(y,h),this.avcSample=null)},l.getLastNalUnit=function(h){var E,s=this.avcSample,c;if((!s||s.units.length===0)&&(s=h[h.length-1]),(E=s)!==null&&E!==void 0&&E.units){var m=s.units;c=m[m.length-1]}return c},l.parseAVCNALu=function(h,E){var s=E.byteLength,c=h.naluState||0,m=c,f=[],g=0,y,R,D,P=-1,N=0;for(c===-1&&(P=0,N=E[0]&31,c=0,g=1);g<s;){if(y=E[g++],!c){c=y?0:1;continue}if(c===1){c=y?0:2;continue}if(!y)c=3;else if(y===1){if(P>=0){var B={data:E.subarray(P,g-c-1),type:N};f.push(B)}else{var F=this.getLastNalUnit(h.samples);if(F&&(m&&g<=4-m&&F.state&&(F.data=F.data.subarray(0,F.data.byteLength-m)),R=g-c-1,R>0)){var H=new Uint8Array(F.data.byteLength+R);H.set(F.data,0),H.set(E.subarray(0,R),F.data.byteLength),F.data=H,F.state=0}}g<s?(D=E[g]&31,P=g,N=D,c=0):c=-1}else c=0}if(P>=0&&c>=0){var j={data:E.subarray(P,s),type:N,state:c};f.push(j)}if(f.length===0){var X=this.getLastNalUnit(h.samples);if(X){var $=new Uint8Array(X.data.byteLength+E.byteLength);$.set(X.data,0),$.set(E,X.data.byteLength),X.data=$}}return h.naluState=c,f},l.parseAACPES=function(h,E){var s=0,c=this.aacOverFlow,m=E.data;if(c){this.aacOverFlow=null;var f=c.missing,g=c.sample.unit.byteLength;if(f===-1){var y=new Uint8Array(g+m.byteLength);y.set(c.sample.unit,0),y.set(m,g),m=y}else{var R=g-f;c.sample.unit.set(m.subarray(0,f),R),h.samples.push(c.sample),s=c.missing}}var D,P;for(D=s,P=m.length;D<P-1&&!n.isHeader(m,D);D++);if(D!==s){var N,B;if(D<P-1?(N="AAC PES did not start with ADTS header,offset:"+D,B=!1):(N="no ADTS header found in AAC PES",B=!0),L.logger.warn("parsing error:"+N),this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.FRAG_PARSING_ERROR,fatal:B,reason:N}),B)return}n.initTrackConfig(h,this.observer,m,D,this.audioCodec);var F;if(E.pts!==void 0)F=E.pts;else if(c){var H=n.getFrameDuration(h.samplerate);F=c.sample.pts+H}else{L.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var j=0,X;D<P;)if(X=n.appendFrame(h,m,D,F,j),D+=X.length,X.missing){this.aacOverFlow=X;break}else for(j++;D<P-1&&!n.isHeader(m,D);D++);},l.parseMPEGPES=function(h,E){var s=E.data,c=s.length,m=0,f=0,g=E.pts;if(g===void 0){L.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;f<c;)if(a.isHeader(s,f)){var y=a.appendFrame(h,s,f,g,m);if(y)f+=y.length,m++;else break}else f++},l.parseID3PES=function(h,E){if(E.pts===void 0){L.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var s=I({},E,{type:this._avcTrack?x.MetadataSchema.emsg:x.MetadataSchema.audioId3});h.samples.push(s)},T}();function b(T,l,o,h){return{key:T,frame:!1,pts:l,dts:o,units:[],debug:h,length:0}}function S(T,l){return(T[l+10]&31)<<8|T[l+11]}function v(T,l,o,h){var E={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},s=(T[l+1]&15)<<8|T[l+2],c=l+3+s-4,m=(T[l+10]&15)<<8|T[l+11];for(l+=12+m;l<c;){var f=(T[l+1]&31)<<8|T[l+2];switch(T[l]){case 207:if(!h){L.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:E.audio===-1&&(E.audio=f);break;case 21:E.id3===-1&&(E.id3=f);break;case 219:if(!h){L.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:E.avc===-1&&(E.avc=f);break;case 3:case 4:o.mpeg!==!0&&o.mp3!==!0?L.logger.log("MPEG audio found, not supported in this browser"):E.audio===-1&&(E.audio=f,E.segmentCodec="mp3");break;case 36:L.logger.warn("Unsupported HEVC stream type found");break;default:break}l+=((T[l+3]&15)<<8|T[l+4])+5}return E}function i(T){var l=0,o,h,E,s,c,m=T.data;if(!T||T.size===0)return null;for(;m[0].length<19&&m.length>1;){var f=new Uint8Array(m[0].length+m[1].length);f.set(m[0]),f.set(m[1],m[0].length),m[0]=f,m.splice(1,1)}o=m[0];var g=(o[0]<<16)+(o[1]<<8)+o[2];if(g===1){if(h=(o[4]<<8)+o[5],h&&h>T.size-6)return null;var y=o[7];y&192&&(s=(o[9]&14)*536870912+(o[10]&255)*4194304+(o[11]&254)*16384+(o[12]&255)*128+(o[13]&254)/2,y&64?(c=(o[14]&14)*536870912+(o[15]&255)*4194304+(o[16]&254)*16384+(o[17]&255)*128+(o[18]&254)/2,s-c>60*9e4&&(L.logger.warn(Math.round((s-c)/9e4)+"s delta between PTS and DTS, align them"),s=c)):c=s),E=o[8];var R=E+9;if(T.size<=R)return null;T.size-=R;for(var D=new Uint8Array(T.size),P=0,N=m.length;P<N;P++){o=m[P];var B=o.byteLength;if(R)if(R>B){R-=B;continue}else o=o.subarray(R),B-=R,R=0;D.set(o,l),l+=B}return h&&(h-=E+3),{data:D,pts:s,dts:c,len:h}}return null}function d(T,l){if(T.units.length&&T.frame){if(T.pts===void 0){var o=l.samples,h=o.length;if(h){var E=o[h-1];T.pts=E.pts,T.dts=E.dts}else{l.dropped++;return}}l.samples.push(T)}T.debug.length&&L.logger.log(T.pts+"/"+T.dts+":"+T.debug)}function p(T){for(var l=T.byteLength,o=[],h=1;h<l-2;)T[h]===0&&T[h+1]===0&&T[h+2]===3?(o.push(h+2),h+=2):h++;if(o.length===0)return T;var E=l-o.length,s=new Uint8Array(E),c=0;for(h=0;h<E;c++,h++)c===o[0]&&(c++,o.shift()),s[h]=T[c];return s}t.default=_},"./src/errors.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"ErrorTypes",function(){return n}),e.d(t,"ErrorDetails",function(){return a});var n;(function(u){u.NETWORK_ERROR="networkError",u.MEDIA_ERROR="mediaError",u.KEY_SYSTEM_ERROR="keySystemError",u.MUX_ERROR="muxError",u.OTHER_ERROR="otherError"})(n||(n={}));var a;(function(u){u.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",u.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",u.KEY_SYSTEM_NO_SESSION="keySystemNoSession",u.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",u.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",u.MANIFEST_LOAD_ERROR="manifestLoadError",u.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",u.MANIFEST_PARSING_ERROR="manifestParsingError",u.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",u.LEVEL_EMPTY_ERROR="levelEmptyError",u.LEVEL_LOAD_ERROR="levelLoadError",u.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",u.LEVEL_SWITCH_ERROR="levelSwitchError",u.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",u.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",u.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",u.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",u.FRAG_LOAD_ERROR="fragLoadError",u.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",u.FRAG_DECRYPT_ERROR="fragDecryptError",u.FRAG_PARSING_ERROR="fragParsingError",u.REMUX_ALLOC_ERROR="remuxAllocError",u.KEY_LOAD_ERROR="keyLoadError",u.KEY_LOAD_TIMEOUT="keyLoadTimeOut",u.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",u.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",u.BUFFER_APPEND_ERROR="bufferAppendError",u.BUFFER_APPENDING_ERROR="bufferAppendingError",u.BUFFER_STALLED_ERROR="bufferStalledError",u.BUFFER_FULL_ERROR="bufferFullError",u.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",u.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",u.INTERNAL_EXCEPTION="internalException",u.INTERNAL_ABORTED="aborted",u.UNKNOWN="unknown"})(a||(a={}))},"./src/events.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"Events",function(){return n});var n;(function(a){a.MEDIA_ATTACHING="hlsMediaAttaching",a.MEDIA_ATTACHED="hlsMediaAttached",a.MEDIA_DETACHING="hlsMediaDetaching",a.MEDIA_DETACHED="hlsMediaDetached",a.BUFFER_RESET="hlsBufferReset",a.BUFFER_CODECS="hlsBufferCodecs",a.BUFFER_CREATED="hlsBufferCreated",a.BUFFER_APPENDING="hlsBufferAppending",a.BUFFER_APPENDED="hlsBufferAppended",a.BUFFER_EOS="hlsBufferEos",a.BUFFER_FLUSHING="hlsBufferFlushing",a.BUFFER_FLUSHED="hlsBufferFlushed",a.MANIFEST_LOADING="hlsManifestLoading",a.MANIFEST_LOADED="hlsManifestLoaded",a.MANIFEST_PARSED="hlsManifestParsed",a.LEVEL_SWITCHING="hlsLevelSwitching",a.LEVEL_SWITCHED="hlsLevelSwitched",a.LEVEL_LOADING="hlsLevelLoading",a.LEVEL_LOADED="hlsLevelLoaded",a.LEVEL_UPDATED="hlsLevelUpdated",a.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",a.LEVELS_UPDATED="hlsLevelsUpdated",a.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",a.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",a.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",a.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",a.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",a.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",a.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",a.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",a.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",a.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",a.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",a.CUES_PARSED="hlsCuesParsed",a.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",a.INIT_PTS_FOUND="hlsInitPtsFound",a.FRAG_LOADING="hlsFragLoading",a.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",a.FRAG_LOADED="hlsFragLoaded",a.FRAG_DECRYPTED="hlsFragDecrypted",a.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",a.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",a.FRAG_PARSING_METADATA="hlsFragParsingMetadata",a.FRAG_PARSED="hlsFragParsed",a.FRAG_BUFFERED="hlsFragBuffered",a.FRAG_CHANGED="hlsFragChanged",a.FPS_DROP="hlsFpsDrop",a.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",a.ERROR="hlsError",a.DESTROYING="hlsDestroying",a.KEY_LOADING="hlsKeyLoading",a.KEY_LOADED="hlsKeyLoaded",a.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",a.BACK_BUFFER_REACHED="hlsBackBufferReached"})(n||(n={}))},"./src/hls.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return l});var n=e("./node_modules/url-toolkit/src/url-toolkit.js"),a=e.n(n),u=e("./src/loader/playlist-loader.ts"),M=e("./src/loader/key-loader.ts"),C=e("./src/controller/id3-track-controller.ts"),O=e("./src/controller/latency-controller.ts"),L=e("./src/controller/level-controller.ts"),A=e("./src/controller/fragment-tracker.ts"),x=e("./src/controller/stream-controller.ts"),I=e("./src/is-supported.ts"),_=e("./src/utils/logger.ts"),b=e("./src/config.ts"),S=e("./node_modules/eventemitter3/index.js"),v=e.n(S),i=e("./src/events.ts"),d=e("./src/errors.ts");function p(o,h){for(var E=0;E<h.length;E++){var s=h[E];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(o,s.key,s)}}function T(o,h,E){return h&&p(o.prototype,h),E&&p(o,E),Object.defineProperty(o,"prototype",{writable:!1}),o}var l=function(){o.isSupported=function(){return Object(I.isSupported)()};function o(E){E===void 0&&(E={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new S.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var s=this.config=Object(b.mergeConfig)(o.DefaultConfig,E);this.userConfig=E,Object(_.enableLogs)(s.debug),this._autoLevelCapping=-1,s.progressive&&Object(b.enableStreamingMode)(s);var c=s.abrController,m=s.bufferController,f=s.capLevelController,g=s.fpsController,y=this.abrController=new c(this),R=this.bufferController=new m(this),D=this.capLevelController=new f(this),P=new g(this),N=new u.default(this),B=new M.default(this),F=new C.default(this),H=this.levelController=new L.default(this),j=new A.FragmentTracker(this),X=this.streamController=new x.default(this,j);D.setStreamController(X),P.setStreamController(X);var $=[N,B,H,X];this.networkControllers=$;var G=[y,R,D,P,F,j];this.audioTrackController=this.createController(s.audioTrackController,null,$),this.createController(s.audioStreamController,j,$),this.subtitleTrackController=this.createController(s.subtitleTrackController,null,$),this.createController(s.subtitleStreamController,j,$),this.createController(s.timelineController,null,G),this.emeController=this.createController(s.emeController,null,G),this.cmcdController=this.createController(s.cmcdController,null,G),this.latencyController=this.createController(O.default,null,G),this.coreComponents=G}var h=o.prototype;return h.createController=function(s,c,m){if(s){var f=c?new s(this,c):new s(this);return m&&m.push(f),f}return null},h.on=function(s,c,m){m===void 0&&(m=this),this._emitter.on(s,c,m)},h.once=function(s,c,m){m===void 0&&(m=this),this._emitter.once(s,c,m)},h.removeAllListeners=function(s){this._emitter.removeAllListeners(s)},h.off=function(s,c,m,f){m===void 0&&(m=this),this._emitter.off(s,c,m,f)},h.listeners=function(s){return this._emitter.listeners(s)},h.emit=function(s,c,m){return this._emitter.emit(s,c,m)},h.trigger=function(s,c){if(this.config.debug)return this.emit(s,s,c);try{return this.emit(s,s,c)}catch(m){_.logger.error("An internal error happened while handling event "+s+'. Error message: "'+m.message+'". Here is a stacktrace:',m),this.trigger(i.Events.ERROR,{type:d.ErrorTypes.OTHER_ERROR,details:d.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:s,error:m})}return!1},h.listenerCount=function(s){return this._emitter.listenerCount(s)},h.destroy=function(){_.logger.log("destroy"),this.trigger(i.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(s){return s.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(s){return s.destroy()}),this.coreComponents.length=0},h.attachMedia=function(s){_.logger.log("attachMedia"),this._media=s,this.trigger(i.Events.MEDIA_ATTACHING,{media:s})},h.detachMedia=function(){_.logger.log("detachMedia"),this.trigger(i.Events.MEDIA_DETACHING,void 0),this._media=null},h.loadSource=function(s){this.stopLoad();var c=this.media,m=this.url,f=this.url=n.buildAbsoluteURL(self.location.href,s,{alwaysNormalize:!0});_.logger.log("loadSource:"+f),c&&m&&m!==f&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(c)),this.trigger(i.Events.MANIFEST_LOADING,{url:s})},h.startLoad=function(s){s===void 0&&(s=-1),_.logger.log("startLoad("+s+")"),this.networkControllers.forEach(function(c){c.startLoad(s)})},h.stopLoad=function(){_.logger.log("stopLoad"),this.networkControllers.forEach(function(s){s.stopLoad()})},h.swapAudioCodec=function(){_.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},h.recoverMediaError=function(){_.logger.log("recoverMediaError");var s=this._media;this.detachMedia(),s&&this.attachMedia(s)},h.removeLevel=function(s,c){c===void 0&&(c=0),this.levelController.removeLevel(s,c)},T(o,[{key:"levels",get:function(){var s=this.levelController.levels;return s||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(s){_.logger.log("set currentLevel:"+s),this.loadLevel=s,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(s){_.logger.log("set nextLevel:"+s),this.levelController.manualLevel=s,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(s){_.logger.log("set loadLevel:"+s),this.levelController.manualLevel=s}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(s){this.levelController.nextLoadLevel=s}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(s){_.logger.log("set firstLevel:"+s),this.levelController.firstLevel=s}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(s){_.logger.log("set startLevel:"+s),s!==-1&&(s=Math.max(s,this.minAutoLevel)),this.levelController.startLevel=s}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(s){var c=!!s;c!==this.config.capLevelToPlayerSize&&(c?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=c)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(s){this._autoLevelCapping!==s&&(_.logger.log("set autoLevelCapping:"+s),this._autoLevelCapping=s)}},{key:"bandwidthEstimate",get:function(){var s=this.abrController.bwEstimator;return s?s.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var s=this.levels,c=this.config.minAutoBitrate;if(!s)return 0;for(var m=s.length,f=0;f<m;f++)if(s[f].maxBitrate>=c)return f;return 0}},{key:"maxAutoLevel",get:function(){var s=this.levels,c=this.autoLevelCapping,m;return c===-1&&s&&s.length?m=s.length-1:m=c,m}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(s){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,s)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"audioTracks",get:function(){var s=this.audioTrackController;return s?s.audioTracks:[]}},{key:"audioTrack",get:function(){var s=this.audioTrackController;return s?s.audioTrack:-1},set:function(s){var c=this.audioTrackController;c&&(c.audioTrack=s)}},{key:"subtitleTracks",get:function(){var s=this.subtitleTrackController;return s?s.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var s=this.subtitleTrackController;return s?s.subtitleTrack:-1},set:function(s){var c=this.subtitleTrackController;c&&(c.subtitleTrack=s)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var s=this.subtitleTrackController;return s?s.subtitleDisplay:!1},set:function(s){var c=this.subtitleTrackController;c&&(c.subtitleDisplay=s)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(s){this.config.lowLatencyMode=s}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.3"}},{key:"Events",get:function(){return i.Events}},{key:"ErrorTypes",get:function(){return d.ErrorTypes}},{key:"ErrorDetails",get:function(){return d.ErrorDetails}},{key:"DefaultConfig",get:function(){return o.defaultConfig?o.defaultConfig:b.hlsDefaultConfig},set:function(s){o.defaultConfig=s}}]),o}();l.defaultConfig=void 0},"./src/is-supported.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"isSupported",function(){return u}),e.d(t,"changeTypeSupported",function(){return M});var n=e("./src/utils/mediasource-helper.ts");function a(){return self.SourceBuffer||self.WebKitSourceBuffer}function u(){var C=Object(n.getMediaSource)();if(!C)return!1;var O=a(),L=C&&typeof C.isTypeSupported=="function"&&C.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),A=!O||O.prototype&&typeof O.prototype.appendBuffer=="function"&&typeof O.prototype.remove=="function";return!!L&&!!A}function M(){var C,O=a();return typeof(O==null||(C=O.prototype)===null||C===void 0?void 0:C.changeType)=="function"}},"./src/loader/date-range.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"DateRangeAttribute",function(){return L}),e.d(t,"DateRange",function(){return A});var n=e("./src/polyfills/number.ts"),a=e("./src/utils/attr-list.ts"),u=e("./src/utils/logger.ts");function M(){return M=Object.assign?Object.assign.bind():function(x){for(var I=1;I<arguments.length;I++){var _=arguments[I];for(var b in _)Object.prototype.hasOwnProperty.call(_,b)&&(x[b]=_[b])}return x},M.apply(this,arguments)}function C(x,I){for(var _=0;_<I.length;_++){var b=I[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(x,b.key,b)}}function O(x,I,_){return I&&C(x.prototype,I),_&&C(x,_),Object.defineProperty(x,"prototype",{writable:!1}),x}var L;(function(x){x.ID="ID",x.CLASS="CLASS",x.START_DATE="START-DATE",x.DURATION="DURATION",x.END_DATE="END-DATE",x.END_ON_NEXT="END-ON-NEXT",x.PLANNED_DURATION="PLANNED-DURATION",x.SCTE35_OUT="SCTE35-OUT",x.SCTE35_IN="SCTE35-IN"})(L||(L={}));var A=function(){function x(I,_){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,_){var b=_.attr;for(var S in b)if(Object.prototype.hasOwnProperty.call(I,S)&&I[S]!==b[S]){u.logger.warn('DATERANGE tag attribute: "'+S+'" does not match for tags with ID: "'+I.ID+'"'),this._badValueForSameId=S;break}I=M(new a.AttrList({}),b,I)}if(this.attr=I,this._startDate=new Date(I[L.START_DATE]),L.END_DATE in this.attr){var v=new Date(this.attr[L.END_DATE]);Object(n.isFiniteNumber)(v.getTime())&&(this._endDate=v)}}return O(x,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var _=this.duration;return _!==null?new Date(this._startDate.getTime()+_*1e3):null}},{key:"duration",get:function(){if(L.DURATION in this.attr){var _=this.attr.decimalFloatingPoint(L.DURATION);if(Object(n.isFiniteNumber)(_))return _}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return L.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(L.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(L.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(n.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),x}()},"./src/loader/fragment-loader.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return _}),e.d(t,"LoadError",function(){return S});var n=e("./src/polyfills/number.ts"),a=e("./src/errors.ts");function u(v,i){v.prototype=Object.create(i.prototype),v.prototype.constructor=v,A(v,i)}function M(v){var i=typeof Map=="function"?new Map:void 0;return M=function(p){if(p===null||!L(p))return p;if(typeof p!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(p))return i.get(p);i.set(p,T)}function T(){return C(p,arguments,x(this).constructor)}return T.prototype=Object.create(p.prototype,{constructor:{value:T,enumerable:!1,writable:!0,configurable:!0}}),A(T,p)},M(v)}function C(v,i,d){return O()?C=Reflect.construct.bind():C=function(T,l,o){var h=[null];h.push.apply(h,l);var E=Function.bind.apply(T,h),s=new E;return o&&A(s,o.prototype),s},C.apply(null,arguments)}function O(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function L(v){return Function.toString.call(v).indexOf("[native code]")!==-1}function A(v,i){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(p,T){return p.__proto__=T,p},A(v,i)}function x(v){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(d){return d.__proto__||Object.getPrototypeOf(d)},x(v)}var I=Math.pow(2,17),_=function(){function v(d){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=d}var i=v.prototype;return i.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},i.abort=function(){this.loader&&this.loader.abort()},i.load=function(p,T){var l=this,o=p.url;if(!o)return Promise.reject(new S({type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:p,networkDetails:null},"Fragment does not have a "+(o?"part list":"url")));this.abort();var h=this.config,E=h.fLoader,s=h.loader;return new Promise(function(c,m){l.loader&&l.loader.destroy();var f=l.loader=p.loader=E?new E(h):new s(h),g=b(p),y={timeout:h.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:h.fragLoadingMaxRetryTimeout,highWaterMark:p.sn==="initSegment"?1/0:I};p.stats=f.stats,f.load(g,y,{onSuccess:function(D,P,N,B){l.resetLoader(p,f),c({frag:p,part:null,payload:D.data,networkDetails:B})},onError:function(D,P,N){l.resetLoader(p,f),m(new S({type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:p,response:D,networkDetails:N}))},onAbort:function(D,P,N){l.resetLoader(p,f),m(new S({type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:p,networkDetails:N}))},onTimeout:function(D,P,N){l.resetLoader(p,f),m(new S({type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:p,networkDetails:N}))},onProgress:function(D,P,N,B){T&&T({frag:p,part:null,payload:N,networkDetails:B})}})})},i.loadPart=function(p,T,l){var o=this;this.abort();var h=this.config,E=h.fLoader,s=h.loader;return new Promise(function(c,m){o.loader&&o.loader.destroy();var f=o.loader=p.loader=E?new E(h):new s(h),g=b(p,T),y={timeout:h.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:h.fragLoadingMaxRetryTimeout,highWaterMark:I};T.stats=f.stats,f.load(g,y,{onSuccess:function(D,P,N,B){o.resetLoader(p,f),o.updateStatsFromPart(p,T);var F={frag:p,part:T,payload:D.data,networkDetails:B};l(F),c(F)},onError:function(D,P,N){o.resetLoader(p,f),m(new S({type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:p,part:T,response:D,networkDetails:N}))},onAbort:function(D,P,N){p.stats.aborted=T.stats.aborted,o.resetLoader(p,f),m(new S({type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:p,part:T,networkDetails:N}))},onTimeout:function(D,P,N){o.resetLoader(p,f),m(new S({type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:p,part:T,networkDetails:N}))}})})},i.updateStatsFromPart=function(p,T){var l=p.stats,o=T.stats,h=o.total;if(l.loaded+=o.loaded,h){var E=Math.round(p.duration/T.duration),s=Math.min(Math.round(l.loaded/h),E),c=E-s,m=c*Math.round(l.loaded/s);l.total=l.loaded+m}else l.total=Math.max(l.loaded,l.total);var f=l.loading,g=o.loading;f.start?f.first+=g.first-g.start:(f.start=g.start,f.first=g.first),f.end=g.end},i.resetLoader=function(p,T){p.loader=null,this.loader===T&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),T.destroy()},v}();function b(v,i){i===void 0&&(i=null);var d=i||v,p={frag:v,part:i,responseType:"arraybuffer",url:d.url,headers:{},rangeStart:0,rangeEnd:0},T=d.byteRangeStartOffset,l=d.byteRangeEndOffset;return Object(n.isFiniteNumber)(T)&&Object(n.isFiniteNumber)(l)&&(p.rangeStart=T,p.rangeEnd=l),p}var S=function(v){u(i,v);function i(d){for(var p,T=arguments.length,l=new Array(T>1?T-1:0),o=1;o<T;o++)l[o-1]=arguments[o];return p=v.call.apply(v,[this].concat(l))||this,p.data=void 0,p.data=d,p}return i}(M(Error))},"./src/loader/fragment.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"ElementaryStreamTypes",function(){return _}),e.d(t,"BaseSegment",function(){return b}),e.d(t,"Fragment",function(){return S}),e.d(t,"Part",function(){return v});var n=e("./src/polyfills/number.ts"),a=e("./node_modules/url-toolkit/src/url-toolkit.js"),u=e.n(a),M=e("./src/utils/logger.ts"),C=e("./src/loader/level-key.ts"),O=e("./src/loader/load-stats.ts");function L(i,d){i.prototype=Object.create(d.prototype),i.prototype.constructor=i,A(i,d)}function A(i,d){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(T,l){return T.__proto__=l,T},A(i,d)}function x(i,d){for(var p=0;p<d.length;p++){var T=d[p];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(i,T.key,T)}}function I(i,d,p){return d&&x(i.prototype,d),p&&x(i,p),Object.defineProperty(i,"prototype",{writable:!1}),i}var _;(function(i){i.AUDIO="audio",i.VIDEO="video",i.AUDIOVIDEO="audiovideo"})(_||(_={}));var b=function(){function i(p){var T;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(T={},T[_.AUDIO]=null,T[_.VIDEO]=null,T[_.AUDIOVIDEO]=null,T),this.baseurl=p}var d=i.prototype;return d.setByteRange=function(T,l){var o=T.split("@",2),h=[];o.length===1?h[0]=l?l.byteRangeEndOffset:0:h[0]=parseInt(o[1]),h[1]=parseInt(o[0])+h[0],this._byteRange=h},I(i,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(a.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(T){this._url=T}}]),i}(),S=function(i){L(d,i);function d(T,l){var o;return o=i.call(this,l)||this,o._decryptdata=null,o.rawProgramDateTime=null,o.programDateTime=null,o.tagList=[],o.duration=0,o.sn=0,o.levelkey=void 0,o.type=void 0,o.loader=null,o.level=-1,o.cc=0,o.startPTS=void 0,o.endPTS=void 0,o.appendedPTS=void 0,o.startDTS=void 0,o.endDTS=void 0,o.start=0,o.deltaPTS=void 0,o.maxStartPTS=void 0,o.minEndPTS=void 0,o.stats=new O.LoadStats,o.urlId=0,o.data=void 0,o.bitrateTest=!1,o.title=null,o.initSegment=null,o.type=T,o}var p=d.prototype;return p.createInitializationVector=function(l){for(var o=new Uint8Array(16),h=12;h<16;h++)o[h]=l>>8*(15-h)&255;return o},p.setDecryptDataFromLevelKey=function(l,o){var h=l;return(l==null?void 0:l.method)==="AES-128"&&l.uri&&!l.iv&&(h=C.LevelKey.fromURI(l.uri),h.method=l.method,h.iv=this.createInitializationVector(o),h.keyFormat="identity"),h},p.setElementaryStreamInfo=function(l,o,h,E,s,c){c===void 0&&(c=!1);var m=this.elementaryStreams,f=m[l];if(!f){m[l]={startPTS:o,endPTS:h,startDTS:E,endDTS:s,partial:c};return}f.startPTS=Math.min(f.startPTS,o),f.endPTS=Math.max(f.endPTS,h),f.startDTS=Math.min(f.startDTS,E),f.endDTS=Math.max(f.endDTS,s)},p.clearElementaryStreamInfo=function(){var l=this.elementaryStreams;l[_.AUDIO]=null,l[_.VIDEO]=null,l[_.AUDIOVIDEO]=null},I(d,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var l=this.sn;typeof l!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&M.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),l=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,l)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(n.isFiniteNumber)(this.programDateTime))return null;var l=Object(n.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+l*1e3}},{key:"encrypted",get:function(){var l;return!!((l=this.decryptdata)!==null&&l!==void 0&&l.keyFormat&&this.decryptdata.uri)}}]),d}(b),v=function(i){L(d,i);function d(p,T,l,o,h){var E;E=i.call(this,l)||this,E.fragOffset=0,E.duration=0,E.gap=!1,E.independent=!1,E.relurl=void 0,E.fragment=void 0,E.index=void 0,E.stats=new O.LoadStats,E.duration=p.decimalFloatingPoint("DURATION"),E.gap=p.bool("GAP"),E.independent=p.bool("INDEPENDENT"),E.relurl=p.enumeratedString("URI"),E.fragment=T,E.index=o;var s=p.enumeratedString("BYTERANGE");return s&&E.setByteRange(s,h),h&&(E.fragOffset=h.fragOffset+h.duration),E}return I(d,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var T=this.elementaryStreams;return!!(T.audio||T.video||T.audiovideo)}}]),d}(b)},"./src/loader/key-loader.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return M});var n=e("./src/events.ts"),a=e("./src/errors.ts"),u=e("./src/utils/logger.ts"),M=function(){function C(L){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=L,this.registerListeners()}var O=C.prototype;return O.startLoad=function(A){},O.stopLoad=function(){this.destroyInternalLoaders()},O.registerListeners=function(){this.hls.on(n.Events.KEY_LOADING,this.onKeyLoading,this)},O.unregisterListeners=function(){this.hls.off(n.Events.KEY_LOADING,this.onKeyLoading)},O.destroyInternalLoaders=function(){for(var A in this.loaders){var x=this.loaders[A];x&&x.destroy()}this.loaders={}},O.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},O.onKeyLoading=function(A,x){var I=x.frag,_=I.type,b=this.loaders[_];if(!I.decryptdata){u.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var S=I.decryptdata.uri;if(S!==this.decrypturl||this.decryptkey===null){var v=this.hls.config;if(b&&(u.logger.warn("abort previous key loader for type:"+_),b.abort()),!S){u.logger.warn("key uri is falsy");return}var i=v.loader,d=I.loader=this.loaders[_]=new i(v);this.decrypturl=S,this.decryptkey=null;var p={url:S,frag:I,responseType:"arraybuffer"},T={timeout:v.fragLoadingTimeOut,maxRetry:0,retryDelay:v.fragLoadingRetryDelay,maxRetryDelay:v.fragLoadingMaxRetryTimeout,highWaterMark:0},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};d.load(p,T,l)}else this.decryptkey&&(I.decryptdata.key=this.decryptkey,this.hls.trigger(n.Events.KEY_LOADED,{frag:I}))},O.loadsuccess=function(A,x,I){var _=I.frag;if(!_.decryptdata){u.logger.error("after key load, decryptdata unset");return}this.decryptkey=_.decryptdata.key=new Uint8Array(A.data),_.loader=null,delete this.loaders[_.type],this.hls.trigger(n.Events.KEY_LOADED,{frag:_})},O.loaderror=function(A,x){var I=x.frag,_=I.loader;_&&_.abort(),delete this.loaders[I.type],this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:I,response:A})},O.loadtimeout=function(A,x){var I=x.frag,_=I.loader;_&&_.abort(),delete this.loaders[I.type],this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:I})},C}()},"./src/loader/level-details.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"LevelDetails",function(){return C});var n=e("./src/polyfills/number.ts");function a(O,L){for(var A=0;A<L.length;A++){var x=L[A];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(O,x.key,x)}}function u(O,L,A){return L&&a(O.prototype,L),A&&a(O,A),Object.defineProperty(O,"prototype",{writable:!1}),O}var M=10,C=function(){function O(A){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=A}var L=O.prototype;return L.reloaded=function(x){if(!x){this.advanced=!0,this.updated=!0;return}var I=this.lastPartSn-x.lastPartSn,_=this.lastPartIndex-x.lastPartIndex;this.updated=this.endSN!==x.endSN||!!_||!!I,this.advanced=this.endSN>x.endSN||I>0||I===0&&_>0,this.updated||this.advanced?this.misses=Math.floor(x.misses*.6):this.misses=x.misses+1,this.availabilityDelay=x.availabilityDelay},u(O,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(n.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||M}},{key:"drift",get:function(){var x=this.driftEndTime-this.driftStartTime;if(x>0){var I=this.driftEnd-this.driftStart;return I*1e3/x}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var x;return(x=this.partList)!==null&&x!==void 0&&x.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var x;return(x=this.fragments)!==null&&x!==void 0&&x.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var x;return(x=this.partList)!==null&&x!==void 0&&x.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var x;return(x=this.partList)!==null&&x!==void 0&&x.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),O}()},"./src/loader/level-key.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"LevelKey",function(){return C});var n=e("./node_modules/url-toolkit/src/url-toolkit.js"),a=e.n(n);function u(O,L){for(var A=0;A<L.length;A++){var x=L[A];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(O,x.key,x)}}function M(O,L,A){return L&&u(O.prototype,L),A&&u(O,A),Object.defineProperty(O,"prototype",{writable:!1}),O}var C=function(){O.fromURL=function(A,x){return new O(A,x)},O.fromURI=function(A){return new O(A)};function O(L,A){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,A?this._uri=Object(n.buildAbsoluteURL)(L,A,{alwaysNormalize:!0}):this._uri=L}return M(O,[{key:"uri",get:function(){return this._uri}}]),O}()},"./src/loader/load-stats.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"LoadStats",function(){return n});var n=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return p});var n=e("./src/polyfills/number.ts"),a=e("./node_modules/url-toolkit/src/url-toolkit.js"),u=e.n(a),M=e("./src/loader/date-range.ts"),C=e("./src/loader/fragment.ts"),O=e("./src/loader/level-details.ts"),L=e("./src/loader/level-key.ts"),A=e("./src/utils/attr-list.ts"),x=e("./src/utils/logger.ts"),I=e("./src/utils/codecs.ts"),_=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,b=/#EXT-X-MEDIA:(.*)/g,S=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),v=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),i=/\.(mp4|m4s|m4v|m4a)$/i;function d(s){var c,m;return i.test((c=(m=a.parseURL(s))===null||m===void 0?void 0:m.path)!=null?c:"")}var p=function(){function s(){}return s.findGroup=function(m,f){for(var g=0;g<m.length;g++){var y=m[g];if(y.id===f)return y}},s.convertAVC1ToAVCOTI=function(m){var f=m.split(".");if(f.length>2){var g=f.shift()+".";return g+=parseInt(f.shift()).toString(16),g+=("000"+parseInt(f.shift()).toString(16)).slice(-4),g}return m},s.resolve=function(m,f){return a.buildAbsoluteURL(f,m,{alwaysNormalize:!0})},s.parseMasterPlaylist=function(m,f){var g=[],y={},R=!1;_.lastIndex=0;for(var D;(D=_.exec(m))!=null;)if(D[1]){var P=new A.AttrList(D[1]),N={attrs:P,bitrate:P.decimalInteger("AVERAGE-BANDWIDTH")||P.decimalInteger("BANDWIDTH"),name:P.NAME,url:s.resolve(D[2],f)},B=P.decimalResolution("RESOLUTION");B&&(N.width=B.width,N.height=B.height),T((P.CODECS||"").split(/[ ,]+/).filter(function(H){return H}),N),N.videoCodec&&N.videoCodec.indexOf("avc1")!==-1&&(N.videoCodec=s.convertAVC1ToAVCOTI(N.videoCodec)),g.push(N)}else if(D[3]){var F=new A.AttrList(D[3]);F["DATA-ID"]&&(R=!0,y[F["DATA-ID"]]=F)}return{levels:g,sessionData:R?y:null}},s.parseMasterPlaylistMedia=function(m,f,g,y){y===void 0&&(y=[]);var R,D=[],P=0;for(b.lastIndex=0;(R=b.exec(m))!==null;){var N=new A.AttrList(R[1]);if(N.TYPE===g){var B={attrs:N,bitrate:0,id:P++,groupId:N["GROUP-ID"],instreamId:N["INSTREAM-ID"],name:N.NAME||N.LANGUAGE||"",type:g,default:N.bool("DEFAULT"),autoselect:N.bool("AUTOSELECT"),forced:N.bool("FORCED"),lang:N.LANGUAGE,url:N.URI?s.resolve(N.URI,f):""};if(y.length){var F=s.findGroup(y,B.groupId)||y[0];l(B,F,"audioCodec"),l(B,F,"textCodec")}D.push(B)}}return D},s.parseLevelPlaylist=function(m,f,g,y,R){var D=new O.LevelDetails(f),P=D.fragments,N=null,B=0,F=0,H=0,j=0,X=null,$=new C.Fragment(y,f),G,J,ee,te=-1,oe=!1;for(S.lastIndex=0,D.m3u8=m;(G=S.exec(m))!==null;){oe&&(oe=!1,$=new C.Fragment(y,f),$.start=H,$.sn=B,$.cc=j,$.level=g,N&&($.initSegment=N,$.rawProgramDateTime=N.rawProgramDateTime,N.rawProgramDateTime=null));var ue=G[1];if(ue){$.duration=parseFloat(ue);var ne=(" "+G[2]).slice(1);$.title=ne||null,$.tagList.push(ne?["INF",ue,ne]:["INF",ue])}else if(G[3])Object(n.isFiniteNumber)($.duration)&&($.start=H,ee&&($.levelkey=ee),$.sn=B,$.level=g,$.cc=j,$.urlId=R,P.push($),$.relurl=(" "+G[3]).slice(1),h($,X),X=$,H+=$.duration,B++,F=0,oe=!0);else if(G[4]){var he=(" "+G[4]).slice(1);X?$.setByteRange(he,X):$.setByteRange(he)}else if(G[5])$.rawProgramDateTime=(" "+G[5]).slice(1),$.tagList.push(["PROGRAM-DATE-TIME",$.rawProgramDateTime]),te===-1&&(te=P.length);else{if(G=G[0].match(v),!G){x.logger.warn("No matches on slow regex match for level playlist!");continue}for(J=1;J<G.length&&typeof G[J]=="undefined";J++);var me=(" "+G[J]).slice(1),ae=(" "+G[J+1]).slice(1),Me=G[J+2]?(" "+G[J+2]).slice(1):"";switch(me){case"PLAYLIST-TYPE":D.type=ae.toUpperCase();break;case"MEDIA-SEQUENCE":B=D.startSN=parseInt(ae);break;case"SKIP":{var Se=new A.AttrList(ae),xe=Se.decimalInteger("SKIPPED-SEGMENTS");if(Object(n.isFiniteNumber)(xe)){D.skippedSegments=xe;for(var be=xe;be--;)P.unshift(null);B+=xe}var Ue=Se.enumeratedString("RECENTLY-REMOVED-DATERANGES");Ue&&(D.recentlyRemovedDateranges=Ue.split("	"));break}case"TARGETDURATION":D.targetduration=parseFloat(ae);break;case"VERSION":D.version=parseInt(ae);break;case"EXTM3U":break;case"ENDLIST":D.live=!1;break;case"#":(ae||Me)&&$.tagList.push(Me?[ae,Me]:[ae]);break;case"DISCONTINUITY":j++,$.tagList.push(["DIS"]);break;case"GAP":$.tagList.push([me]);break;case"BITRATE":$.tagList.push([me,ae]);break;case"DATERANGE":{var Je=new A.AttrList(ae),Ge=new M.DateRange(Je,D.dateRanges[Je.ID]);Ge.isValid||D.skippedSegments?D.dateRanges[Ge.id]=Ge:x.logger.warn('Ignoring invalid DATERANGE tag: "'+ae+'"'),$.tagList.push(["EXT-X-DATERANGE",ae]);break}case"DISCONTINUITY-SEQUENCE":j=parseInt(ae);break;case"KEY":{var rt,Ke=new A.AttrList(ae),lt=Ke.enumeratedString("METHOD"),ft=Ke.URI,ht=Ke.hexadecimalInteger("IV"),ut=Ke.enumeratedString("KEYFORMATVERSIONS"),Mt=Ke.enumeratedString("KEYID"),it=(rt=Ke.enumeratedString("KEYFORMAT"))!=null?rt:"identity",Ct=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(Ct.indexOf(it)>-1){x.logger.warn("Keyformat "+it+" is not supported from the manifest");continue}else if(it!=="identity")continue;lt&&(ee=L.LevelKey.fromURL(f,ft),ft&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(lt)>=0&&(ee.method=lt,ee.keyFormat=it,Mt&&(ee.keyID=Mt),ut&&(ee.keyFormatVersions=ut),ee.iv=ht));break}case"START":{var Ye=new A.AttrList(ae),qe=Ye.decimalFloatingPoint("TIME-OFFSET");Object(n.isFiniteNumber)(qe)&&(D.startTimeOffset=qe);break}case"MAP":{var bt=new A.AttrList(ae);if($.duration){var et=new C.Fragment(y,f);E(et,bt,g,ee),N=et,$.initSegment=N,N.rawProgramDateTime&&!$.rawProgramDateTime&&($.rawProgramDateTime=N.rawProgramDateTime)}else E($,bt,g,ee),N=$,oe=!0;break}case"SERVER-CONTROL":{var je=new A.AttrList(ae);D.canBlockReload=je.bool("CAN-BLOCK-RELOAD"),D.canSkipUntil=je.optionalFloat("CAN-SKIP-UNTIL",0),D.canSkipDateRanges=D.canSkipUntil>0&&je.bool("CAN-SKIP-DATERANGES"),D.partHoldBack=je.optionalFloat("PART-HOLD-BACK",0),D.holdBack=je.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var wt=new A.AttrList(ae);D.partTarget=wt.decimalFloatingPoint("PART-TARGET");break}case"PART":{var vt=D.partList;vt||(vt=D.partList=[]);var Gt=F>0?vt[vt.length-1]:void 0,yr=F++,xt=new C.Part(new A.AttrList(ae),$,f,yr,Gt);vt.push(xt),$.duration+=xt.duration;break}case"PRELOAD-HINT":{var Nr=new A.AttrList(ae);D.preloadHint=Nr;break}case"RENDITION-REPORT":{var Tr=new A.AttrList(ae);D.renditionReports=D.renditionReports||[],D.renditionReports.push(Tr);break}default:x.logger.warn("line parsed but not handled: "+G);break}}}X&&!X.relurl?(P.pop(),H-=X.duration,D.partList&&(D.fragmentHint=X)):D.partList&&(h($,X),$.cc=j,D.fragmentHint=$);var Ut=P.length,jt=P[0],Nt=P[Ut-1];if(H+=D.skippedSegments*D.targetduration,H>0&&Ut&&Nt){D.averagetargetduration=H/Ut;var br=Nt.sn;D.endSN=br!=="initSegment"?br:0,jt&&(D.startCC=jt.cc,jt.initSegment||D.fragments.every(function(or){return or.relurl&&d(or.relurl)})&&(x.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),$=new C.Fragment(y,f),$.relurl=Nt.relurl,$.level=g,$.sn="initSegment",jt.initSegment=$,D.needSidxRanges=!0))}else D.endSN=0,D.startCC=0;return D.fragmentHint&&(H+=D.fragmentHint.duration),D.totalduration=H,D.endCC=j,te>0&&o(P,te),D},s}();function T(s,c){["video","audio","text"].forEach(function(m){var f=s.filter(function(y){return Object(I.isCodecType)(y,m)});if(f.length){var g=f.filter(function(y){return y.lastIndexOf("avc1",0)===0||y.lastIndexOf("mp4a",0)===0});c[m+"Codec"]=g.length>0?g[0]:f[0],s=s.filter(function(y){return f.indexOf(y)===-1})}}),c.unknownCodecs=s}function l(s,c,m){var f=c[m];f&&(s[m]=f)}function o(s,c){for(var m=s[c],f=c;f--;){var g=s[f];if(!g)return;g.programDateTime=m.programDateTime-g.duration*1e3,m=g}}function h(s,c){s.rawProgramDateTime?s.programDateTime=Date.parse(s.rawProgramDateTime):c!=null&&c.programDateTime&&(s.programDateTime=c.endProgramDateTime),Object(n.isFiniteNumber)(s.programDateTime)||(s.programDateTime=null,s.rawProgramDateTime=null)}function E(s,c,m,f){s.relurl=c.URI,c.BYTERANGE&&s.setByteRange(c.BYTERANGE),s.level=m,s.sn="initSegment",f&&(s.levelkey=f),s.initSegment=null}},"./src/loader/playlist-loader.ts":function(r,t,e){"use strict";e.r(t);var n=e("./src/polyfills/number.ts"),a=e("./src/events.ts"),u=e("./src/errors.ts"),M=e("./src/utils/logger.ts"),C=e("./src/utils/mp4-tools.ts"),O=e("./src/loader/m3u8-parser.ts"),L=e("./src/types/loader.ts"),A=e("./src/utils/attr-list.ts");function x(b){var S=b.type;switch(S){case L.PlaylistContextType.AUDIO_TRACK:return L.PlaylistLevelType.AUDIO;case L.PlaylistContextType.SUBTITLE_TRACK:return L.PlaylistLevelType.SUBTITLE;default:return L.PlaylistLevelType.MAIN}}function I(b,S){var v=b.url;return(v===void 0||v.indexOf("data:")===0)&&(v=S.url),v}var _=function(){function b(v){this.hls=void 0,this.loaders=Object.create(null),this.hls=v,this.registerListeners()}var S=b.prototype;return S.startLoad=function(i){},S.stopLoad=function(){this.destroyInternalLoaders()},S.registerListeners=function(){var i=this.hls;i.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(a.Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(a.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),i.on(a.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},S.unregisterListeners=function(){var i=this.hls;i.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(a.Events.LEVEL_LOADING,this.onLevelLoading,this),i.off(a.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),i.off(a.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},S.createInternalLoader=function(i){var d=this.hls.config,p=d.pLoader,T=d.loader,l=p||T,o=new l(d);return i.loader=o,this.loaders[i.type]=o,o},S.getInternalLoader=function(i){return this.loaders[i.type]},S.resetInternalLoader=function(i){this.loaders[i]&&delete this.loaders[i]},S.destroyInternalLoaders=function(){for(var i in this.loaders){var d=this.loaders[i];d&&d.destroy(),this.resetInternalLoader(i)}},S.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},S.onManifestLoading=function(i,d){var p=d.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:L.PlaylistContextType.MANIFEST,url:p,deliveryDirectives:null})},S.onLevelLoading=function(i,d){var p=d.id,T=d.level,l=d.url,o=d.deliveryDirectives;this.load({id:p,groupId:null,level:T,responseType:"text",type:L.PlaylistContextType.LEVEL,url:l,deliveryDirectives:o})},S.onAudioTrackLoading=function(i,d){var p=d.id,T=d.groupId,l=d.url,o=d.deliveryDirectives;this.load({id:p,groupId:T,level:null,responseType:"text",type:L.PlaylistContextType.AUDIO_TRACK,url:l,deliveryDirectives:o})},S.onSubtitleTrackLoading=function(i,d){var p=d.id,T=d.groupId,l=d.url,o=d.deliveryDirectives;this.load({id:p,groupId:T,level:null,responseType:"text",type:L.PlaylistContextType.SUBTITLE_TRACK,url:l,deliveryDirectives:o})},S.load=function(i){var d,p=this.hls.config,T=this.getInternalLoader(i);if(T){var l=T.context;if(l&&l.url===i.url){M.logger.trace("[playlist-loader]: playlist request ongoing");return}M.logger.log("[playlist-loader]: aborting previous loader for type: "+i.type),T.abort()}var o,h,E,s;switch(i.type){case L.PlaylistContextType.MANIFEST:o=p.manifestLoadingMaxRetry,h=p.manifestLoadingTimeOut,E=p.manifestLoadingRetryDelay,s=p.manifestLoadingMaxRetryTimeout;break;case L.PlaylistContextType.LEVEL:case L.PlaylistContextType.AUDIO_TRACK:case L.PlaylistContextType.SUBTITLE_TRACK:o=0,h=p.levelLoadingTimeOut;break;default:o=p.levelLoadingMaxRetry,h=p.levelLoadingTimeOut,E=p.levelLoadingRetryDelay,s=p.levelLoadingMaxRetryTimeout;break}if(T=this.createInternalLoader(i),(d=i.deliveryDirectives)!==null&&d!==void 0&&d.part){var c;if(i.type===L.PlaylistContextType.LEVEL&&i.level!==null?c=this.hls.levels[i.level].details:i.type===L.PlaylistContextType.AUDIO_TRACK&&i.id!==null?c=this.hls.audioTracks[i.id].details:i.type===L.PlaylistContextType.SUBTITLE_TRACK&&i.id!==null&&(c=this.hls.subtitleTracks[i.id].details),c){var m=c.partTarget,f=c.targetduration;m&&f&&(h=Math.min(Math.max(m*3,f*.8)*1e3,h))}}var g={timeout:h,maxRetry:o,retryDelay:E,maxRetryDelay:s,highWaterMark:0},y={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};T.load(i,g,y)},S.loadsuccess=function(i,d,p,T){if(T===void 0&&(T=null),p.isSidxRequest){this.handleSidxRequest(i,p),this.handlePlaylistLoaded(i,d,p,T);return}this.resetInternalLoader(p.type);var l=i.data;if(l.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(i,p,"no EXTM3U delimiter",T);return}d.parsing.start=performance.now(),l.indexOf("#EXTINF:")>0||l.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(i,d,p,T):this.handleMasterPlaylist(i,d,p,T)},S.loaderror=function(i,d,p){p===void 0&&(p=null),this.handleNetworkError(d,p,!1,i)},S.loadtimeout=function(i,d,p){p===void 0&&(p=null),this.handleNetworkError(d,p,!0)},S.handleMasterPlaylist=function(i,d,p,T){var l=this.hls,o=i.data,h=I(i,p),E=O.default.parseMasterPlaylist(o,h),s=E.levels,c=E.sessionData;if(!s.length){this.handleManifestParsingError(i,p,"no level found in manifest",T);return}var m=s.map(function(P){return{id:P.attrs.AUDIO,audioCodec:P.audioCodec}}),f=s.map(function(P){return{id:P.attrs.SUBTITLES,textCodec:P.textCodec}}),g=O.default.parseMasterPlaylistMedia(o,h,"AUDIO",m),y=O.default.parseMasterPlaylistMedia(o,h,"SUBTITLES",f),R=O.default.parseMasterPlaylistMedia(o,h,"CLOSED-CAPTIONS");if(g.length){var D=g.some(function(P){return!P.url});!D&&s[0].audioCodec&&!s[0].attrs.AUDIO&&(M.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new A.AttrList({}),bitrate:0,url:""}))}l.trigger(a.Events.MANIFEST_LOADED,{levels:s,audioTracks:g,subtitles:y,captions:R,url:h,stats:d,networkDetails:T,sessionData:c})},S.handleTrackOrLevelPlaylist=function(i,d,p,T){var l=this.hls,o=p.id,h=p.level,E=p.type,s=I(i,p),c=Object(n.isFiniteNumber)(o)?o:0,m=Object(n.isFiniteNumber)(h)?h:c,f=x(p),g=O.default.parseLevelPlaylist(i.data,s,m,f,c);if(!g.fragments.length){l.trigger(a.Events.ERROR,{type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:s,reason:"no fragments found in level",level:typeof p.level=="number"?p.level:void 0});return}if(E===L.PlaylistContextType.MANIFEST){var y={attrs:new A.AttrList({}),bitrate:0,details:g,name:"",url:s};l.trigger(a.Events.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:s,stats:d,networkDetails:T,sessionData:null})}if(d.parsing.end=performance.now(),g.needSidxRanges){var R,D=(R=g.fragments[0].initSegment)===null||R===void 0?void 0:R.url;this.load({url:D,isSidxRequest:!0,type:E,level:h,levelDetails:g,id:o,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}p.levelDetails=g,this.handlePlaylistLoaded(i,d,p,T)},S.handleSidxRequest=function(i,d){var p=new Uint8Array(i.data),T=Object(C.findBox)(p,["sidx"])[0];if(!!T){var l=Object(C.parseSegmentIndex)(T);if(!!l){var o=l.references,h=d.levelDetails;o.forEach(function(E,s){var c=E.info,m=h.fragments[s];if(m.byteRange.length===0&&m.setByteRange(String(1+c.end-c.start)+"@"+String(c.start)),m.initSegment){var f=Object(C.findBox)(p,["moov"])[0],g=f?f.length:null;m.initSegment.setByteRange(String(g)+"@0")}})}}},S.handleManifestParsingError=function(i,d,p,T){this.hls.trigger(a.Events.ERROR,{type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:d.type===L.PlaylistContextType.MANIFEST,url:i.url,reason:p,response:i,context:d,networkDetails:T})},S.handleNetworkError=function(i,d,p,T){p===void 0&&(p=!1),M.logger.warn("[playlist-loader]: A network "+(p?"timeout":"error")+" occurred while loading "+i.type+" level: "+i.level+" id: "+i.id+' group-id: "'+i.groupId+'"');var l=u.ErrorDetails.UNKNOWN,o=!1,h=this.getInternalLoader(i);switch(i.type){case L.PlaylistContextType.MANIFEST:l=p?u.ErrorDetails.MANIFEST_LOAD_TIMEOUT:u.ErrorDetails.MANIFEST_LOAD_ERROR,o=!0;break;case L.PlaylistContextType.LEVEL:l=p?u.ErrorDetails.LEVEL_LOAD_TIMEOUT:u.ErrorDetails.LEVEL_LOAD_ERROR,o=!1;break;case L.PlaylistContextType.AUDIO_TRACK:l=p?u.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:u.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,o=!1;break;case L.PlaylistContextType.SUBTITLE_TRACK:l=p?u.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:u.ErrorDetails.SUBTITLE_LOAD_ERROR,o=!1;break}h&&this.resetInternalLoader(i.type);var E={type:u.ErrorTypes.NETWORK_ERROR,details:l,fatal:o,url:i.url,loader:h,context:i,networkDetails:d};T&&(E.response=T),this.hls.trigger(a.Events.ERROR,E)},S.handlePlaylistLoaded=function(i,d,p,T){var l=p.type,o=p.level,h=p.id,E=p.groupId,s=p.loader,c=p.levelDetails,m=p.deliveryDirectives;if(!(c!=null&&c.targetduration)){this.handleManifestParsingError(i,p,"invalid target duration",T);return}if(!!s)switch(c.live&&(s.getCacheAge&&(c.ageHeader=s.getCacheAge()||0),(!s.getCacheAge||isNaN(c.ageHeader))&&(c.ageHeader=0)),l){case L.PlaylistContextType.MANIFEST:case L.PlaylistContextType.LEVEL:this.hls.trigger(a.Events.LEVEL_LOADED,{details:c,level:o||0,id:h||0,stats:d,networkDetails:T,deliveryDirectives:m});break;case L.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(a.Events.AUDIO_TRACK_LOADED,{details:c,id:h||0,groupId:E||"",stats:d,networkDetails:T,deliveryDirectives:m});break;case L.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(a.Events.SUBTITLE_TRACK_LOADED,{details:c,id:h||0,groupId:E||"",stats:d,networkDetails:T,deliveryDirectives:m});break}},b}();t.default=_},"./src/polyfills/number.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"isFiniteNumber",function(){return n}),e.d(t,"MAX_SAFE_INTEGER",function(){return a});var n=Number.isFinite||function(u){return typeof u=="number"&&isFinite(u)},a=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(r,t,e){"use strict";e.r(t);var n=function(){function a(){}return a.getSilentFrame=function(M,C){switch(M){case"mp4a.40.2":if(C===1)return new Uint8Array([0,200,0,128,35,128]);if(C===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(C===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(C===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(C===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(C===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(C===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(C===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(C===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},a}();t.default=n},"./src/remux/mp4-generator.ts":function(r,t,e){"use strict";e.r(t);var n=Math.pow(2,32)-1,a=function(){function u(){}return u.init=function(){u.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var C;for(C in u.types)u.types.hasOwnProperty(C)&&(u.types[C]=[C.charCodeAt(0),C.charCodeAt(1),C.charCodeAt(2),C.charCodeAt(3)]);var O=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),L=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);u.HDLR_TYPES={video:O,audio:L};var A=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),x=new Uint8Array([0,0,0,0,0,0,0,0]);u.STTS=u.STSC=u.STCO=x,u.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),u.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),u.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),u.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var I=new Uint8Array([105,115,111,109]),_=new Uint8Array([97,118,99,49]),b=new Uint8Array([0,0,0,1]);u.FTYP=u.box(u.types.ftyp,I,b,I,_),u.DINF=u.box(u.types.dinf,u.box(u.types.dref,A))},u.box=function(C){for(var O=8,L=arguments.length,A=new Array(L>1?L-1:0),x=1;x<L;x++)A[x-1]=arguments[x];for(var I=A.length,_=I;I--;)O+=A[I].byteLength;var b=new Uint8Array(O);for(b[0]=O>>24&255,b[1]=O>>16&255,b[2]=O>>8&255,b[3]=O&255,b.set(C,4),I=0,O=8;I<_;I++)b.set(A[I],O),O+=A[I].byteLength;return b},u.hdlr=function(C){return u.box(u.types.hdlr,u.HDLR_TYPES[C])},u.mdat=function(C){return u.box(u.types.mdat,C)},u.mdhd=function(C,O){O*=C;var L=Math.floor(O/(n+1)),A=Math.floor(O%(n+1));return u.box(u.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,C>>24&255,C>>16&255,C>>8&255,C&255,L>>24,L>>16&255,L>>8&255,L&255,A>>24,A>>16&255,A>>8&255,A&255,85,196,0,0]))},u.mdia=function(C){return u.box(u.types.mdia,u.mdhd(C.timescale,C.duration),u.hdlr(C.type),u.minf(C))},u.mfhd=function(C){return u.box(u.types.mfhd,new Uint8Array([0,0,0,0,C>>24,C>>16&255,C>>8&255,C&255]))},u.minf=function(C){return C.type==="audio"?u.box(u.types.minf,u.box(u.types.smhd,u.SMHD),u.DINF,u.stbl(C)):u.box(u.types.minf,u.box(u.types.vmhd,u.VMHD),u.DINF,u.stbl(C))},u.moof=function(C,O,L){return u.box(u.types.moof,u.mfhd(C),u.traf(L,O))},u.moov=function(C){for(var O=C.length,L=[];O--;)L[O]=u.trak(C[O]);return u.box.apply(null,[u.types.moov,u.mvhd(C[0].timescale,C[0].duration)].concat(L).concat(u.mvex(C)))},u.mvex=function(C){for(var O=C.length,L=[];O--;)L[O]=u.trex(C[O]);return u.box.apply(null,[u.types.mvex].concat(L))},u.mvhd=function(C,O){O*=C;var L=Math.floor(O/(n+1)),A=Math.floor(O%(n+1)),x=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,C>>24&255,C>>16&255,C>>8&255,C&255,L>>24,L>>16&255,L>>8&255,L&255,A>>24,A>>16&255,A>>8&255,A&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return u.box(u.types.mvhd,x)},u.sdtp=function(C){var O=C.samples||[],L=new Uint8Array(4+O.length),A,x;for(A=0;A<O.length;A++)x=O[A].flags,L[A+4]=x.dependsOn<<4|x.isDependedOn<<2|x.hasRedundancy;return u.box(u.types.sdtp,L)},u.stbl=function(C){return u.box(u.types.stbl,u.stsd(C),u.box(u.types.stts,u.STTS),u.box(u.types.stsc,u.STSC),u.box(u.types.stsz,u.STSZ),u.box(u.types.stco,u.STCO))},u.avc1=function(C){var O=[],L=[],A,x,I;for(A=0;A<C.sps.length;A++)x=C.sps[A],I=x.byteLength,O.push(I>>>8&255),O.push(I&255),O=O.concat(Array.prototype.slice.call(x));for(A=0;A<C.pps.length;A++)x=C.pps[A],I=x.byteLength,L.push(I>>>8&255),L.push(I&255),L=L.concat(Array.prototype.slice.call(x));var _=u.box(u.types.avcC,new Uint8Array([1,O[3],O[4],O[5],255,224|C.sps.length].concat(O).concat([C.pps.length]).concat(L))),b=C.width,S=C.height,v=C.pixelRatio[0],i=C.pixelRatio[1];return u.box(u.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,b>>8&255,b&255,S>>8&255,S&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),_,u.box(u.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),u.box(u.types.pasp,new Uint8Array([v>>24,v>>16&255,v>>8&255,v&255,i>>24,i>>16&255,i>>8&255,i&255])))},u.esds=function(C){var O=C.config.length;return new Uint8Array([0,0,0,0,3,23+O,0,1,0,4,15+O,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([O]).concat(C.config).concat([6,1,2]))},u.mp4a=function(C){var O=C.samplerate;return u.box(u.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,C.channelCount,0,16,0,0,0,0,O>>8&255,O&255,0,0]),u.box(u.types.esds,u.esds(C)))},u.mp3=function(C){var O=C.samplerate;return u.box(u.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,C.channelCount,0,16,0,0,0,0,O>>8&255,O&255,0,0]))},u.stsd=function(C){return C.type==="audio"?C.segmentCodec==="mp3"&&C.codec==="mp3"?u.box(u.types.stsd,u.STSD,u.mp3(C)):u.box(u.types.stsd,u.STSD,u.mp4a(C)):u.box(u.types.stsd,u.STSD,u.avc1(C))},u.tkhd=function(C){var O=C.id,L=C.duration*C.timescale,A=C.width,x=C.height,I=Math.floor(L/(n+1)),_=Math.floor(L%(n+1));return u.box(u.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,O>>24&255,O>>16&255,O>>8&255,O&255,0,0,0,0,I>>24,I>>16&255,I>>8&255,I&255,_>>24,_>>16&255,_>>8&255,_&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,A>>8&255,A&255,0,0,x>>8&255,x&255,0,0]))},u.traf=function(C,O){var L=u.sdtp(C),A=C.id,x=Math.floor(O/(n+1)),I=Math.floor(O%(n+1));return u.box(u.types.traf,u.box(u.types.tfhd,new Uint8Array([0,0,0,0,A>>24,A>>16&255,A>>8&255,A&255])),u.box(u.types.tfdt,new Uint8Array([1,0,0,0,x>>24,x>>16&255,x>>8&255,x&255,I>>24,I>>16&255,I>>8&255,I&255])),u.trun(C,L.length+16+20+8+16+8+8),L)},u.trak=function(C){return C.duration=C.duration||4294967295,u.box(u.types.trak,u.tkhd(C),u.mdia(C))},u.trex=function(C){var O=C.id;return u.box(u.types.trex,new Uint8Array([0,0,0,0,O>>24,O>>16&255,O>>8&255,O&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},u.trun=function(C,O){var L=C.samples||[],A=L.length,x=12+16*A,I=new Uint8Array(x),_,b,S,v,i,d;for(O+=8+x,I.set([C.type==="video"?1:0,0,15,1,A>>>24&255,A>>>16&255,A>>>8&255,A&255,O>>>24&255,O>>>16&255,O>>>8&255,O&255],0),_=0;_<A;_++)b=L[_],S=b.duration,v=b.size,i=b.flags,d=b.cts,I.set([S>>>24&255,S>>>16&255,S>>>8&255,S&255,v>>>24&255,v>>>16&255,v>>>8&255,v&255,i.isLeading<<2|i.dependsOn,i.isDependedOn<<6|i.hasRedundancy<<4|i.paddingValue<<1|i.isNonSync,i.degradPrio&240<<8,i.degradPrio&15,d>>>24&255,d>>>16&255,d>>>8&255,d&255],12+16*_);return u.box(u.types.trun,I)},u.initSegment=function(C){u.types||u.init();var O=u.moov(C),L=new Uint8Array(u.FTYP.byteLength+O.byteLength);return L.set(u.FTYP),L.set(O,u.FTYP.byteLength),L},u}();a.types=void 0,a.HDLR_TYPES=void 0,a.STTS=void 0,a.STSC=void 0,a.STCO=void 0,a.STSZ=void 0,a.VMHD=void 0,a.SMHD=void 0,a.STSD=void 0,a.FTYP=void 0,a.DINF=void 0,t.default=a},"./src/remux/mp4-remuxer.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return i}),e.d(t,"normalizePts",function(){return d}),e.d(t,"flushTextTrackMetadataCueSamples",function(){return T}),e.d(t,"flushTextTrackUserdataCueSamples",function(){return l});var n=e("./src/polyfills/number.ts"),a=e("./src/remux/aac-helper.ts"),u=e("./src/remux/mp4-generator.ts"),M=e("./src/events.ts"),C=e("./src/errors.ts"),O=e("./src/utils/logger.ts"),L=e("./src/types/loader.ts"),A=e("./src/utils/timescale-conversion.ts");function x(){return x=Object.assign?Object.assign.bind():function(E){for(var s=1;s<arguments.length;s++){var c=arguments[s];for(var m in c)Object.prototype.hasOwnProperty.call(c,m)&&(E[m]=c[m])}return E},x.apply(this,arguments)}var I=10*1e3,_=1024,b=1152,S=null,v=null,i=function(){function E(c,m,f,g){if(g===void 0&&(g=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=c,this.config=m,this.typeSupported=f,this.ISGenerated=!1,S===null){var y=navigator.userAgent||"",R=y.match(/Chrome\/(\d+)/i);S=R?parseInt(R[1]):0}if(v===null){var D=navigator.userAgent.match(/Safari\/(\d+)/i);v=D?parseInt(D[1]):0}}var s=E.prototype;return s.destroy=function(){},s.resetTimeStamp=function(m){O.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=m},s.resetNextTimestamp=function(){O.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},s.resetInitSegment=function(){O.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},s.getVideoStartPts=function(m){var f=!1,g=m.reduce(function(y,R){var D=R.pts-y;return D<-4294967296?(f=!0,d(y,R.pts)):D>0?y:R.pts},m[0].pts);return f&&O.logger.debug("PTS rollover detected"),g},s.remux=function(m,f,g,y,R,D,P,N){var B,F,H,j,X,$,G=R,J=R,ee=m.pid>-1,te=f.pid>-1,oe=f.samples.length,ue=m.samples.length>0,ne=P&&oe>0||oe>1,he=(!ee||ue)&&(!te||ne)||this.ISGenerated||P;if(he){this.ISGenerated||(H=this.generateIS(m,f,R));var me=this.isVideoContiguous,ae=-1,Me;if(ne&&(ae=p(f.samples),!me&&this.config.forceKeyFrameOnDiscontinuity))if($=!0,ae>0){O.logger.warn("[mp4-remuxer]: Dropped "+ae+" out of "+oe+" video samples due to a missing keyframe");var Se=this.getVideoStartPts(f.samples);f.samples=f.samples.slice(ae),f.dropped+=ae,J+=(f.samples[0].pts-Se)/f.inputTimeScale,Me=J}else ae===-1&&(O.logger.warn("[mp4-remuxer]: No keyframe found out of "+oe+" video samples"),$=!1);if(this.ISGenerated){if(ue&&ne){var xe=this.getVideoStartPts(f.samples),be=d(m.samples[0].pts,xe)-xe,Ue=be/f.inputTimeScale;G+=Math.max(0,Ue),J+=Math.max(0,-Ue)}if(ue){if(m.samplerate||(O.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),H=this.generateIS(m,f,R)),F=this.remuxAudio(m,G,this.isAudioContiguous,D,te||ne||N===L.PlaylistLevelType.AUDIO?J:void 0),ne){var Je=F?F.endPTS-F.startPTS:0;f.inputTimeScale||(O.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),H=this.generateIS(m,f,R)),B=this.remuxVideo(f,J,me,Je)}}else ne&&(B=this.remuxVideo(f,J,me,0));B&&(B.firstKeyFrame=ae,B.independent=ae!==-1,B.firstKeyFramePTS=Me)}}return this.ISGenerated&&(g.samples.length&&(X=T(g,R,this._initPTS,this._initDTS)),y.samples.length&&(j=l(y,R,this._initPTS))),{audio:F,video:B,initSegment:H,independent:$,text:j,id3:X}},s.generateIS=function(m,f,g){var y=m.samples,R=f.samples,D=this.typeSupported,P={},N=!Object(n.isFiniteNumber)(this._initPTS),B="audio/mp4",F,H,j;if(N&&(F=H=1/0),m.config&&y.length){switch(m.timescale=m.samplerate,m.segmentCodec){case"mp3":D.mpeg?(B="audio/mpeg",m.codec=""):D.mp3&&(m.codec="mp3");break}P.audio={id:"audio",container:B,codec:m.codec,initSegment:m.segmentCodec==="mp3"&&D.mpeg?new Uint8Array(0):u.default.initSegment([m]),metadata:{channelCount:m.channelCount}},N&&(j=m.inputTimeScale,F=H=y[0].pts-Math.round(j*g))}if(f.sps&&f.pps&&R.length&&(f.timescale=f.inputTimeScale,P.video={id:"main",container:"video/mp4",codec:f.codec,initSegment:u.default.initSegment([f]),metadata:{width:f.width,height:f.height}},N)){j=f.inputTimeScale;var X=this.getVideoStartPts(R),$=Math.round(j*g);H=Math.min(H,d(R[0].dts,X)-$),F=Math.min(F,X-$)}if(Object.keys(P).length)return this.ISGenerated=!0,N&&(this._initPTS=F,this._initDTS=H),{tracks:P,initPTS:F,timescale:j}},s.remuxVideo=function(m,f,g,y){var R=m.inputTimeScale,D=m.samples,P=[],N=D.length,B=this._initPTS,F=this.nextAvcDts,H=8,j=this.videoSampleDuration,X,$,G=Number.POSITIVE_INFINITY,J=Number.NEGATIVE_INFINITY,ee=!1;if(!g||F===null){var te=f*R,oe=D[0].pts-d(D[0].dts,D[0].pts);F=te-oe}for(var ue=0;ue<N;ue++){var ne=D[ue];ne.pts=d(ne.pts-B,F),ne.dts=d(ne.dts-B,F),ne.dts<D[ue>0?ue-1:ue].dts&&(ee=!0)}ee&&D.sort(function(Fr,en){var Ar=Fr.dts-en.dts,Aa=Fr.pts-en.pts;return Ar||Aa}),X=D[0].dts,$=D[D.length-1].dts;var he=$-X,me=he?Math.round(he/(N-1)):j||m.inputTimeScale/30;if(g){var ae=X-F,Me=ae>me,Se=ae<-1;if(Me||Se){Me?O.logger.warn("AVC: "+Object(A.toMsFromMpegTsClock)(ae,!0)+" ms ("+ae+"dts) hole between fragments detected, filling it"):O.logger.warn("AVC: "+Object(A.toMsFromMpegTsClock)(-ae,!0)+" ms ("+ae+"dts) overlapping between fragments detected"),X=F;var xe=D[0].pts-ae;D[0].dts=X,D[0].pts=xe,O.logger.log("Video: First PTS/DTS adjusted: "+Object(A.toMsFromMpegTsClock)(xe,!0)+"/"+Object(A.toMsFromMpegTsClock)(X,!0)+", delta: "+Object(A.toMsFromMpegTsClock)(ae,!0)+" ms")}}X=Math.max(0,X);for(var be=0,Ue=0,Je=0;Je<N;Je++){for(var Ge=D[Je],rt=Ge.units,Ke=rt.length,lt=0,ft=0;ft<Ke;ft++)lt+=rt[ft].data.length;Ue+=lt,be+=Ke,Ge.length=lt,Ge.dts=Math.max(Ge.dts,X),G=Math.min(Ge.pts,G),J=Math.max(Ge.pts,J)}$=D[N-1].dts;var ht=Ue+4*be+8,ut;try{ut=new Uint8Array(ht)}catch{this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:C.ErrorTypes.MUX_ERROR,details:C.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ht,reason:"fail allocating video mdat "+ht});return}var Mt=new DataView(ut.buffer);Mt.setUint32(0,ht),ut.set(u.default.types.mdat,4);for(var it=!1,Ct=Number.POSITIVE_INFINITY,Ye=Number.POSITIVE_INFINITY,qe=Number.NEGATIVE_INFINITY,bt=Number.NEGATIVE_INFINITY,et=0;et<N;et++){for(var je=D[et],wt=je.units,vt=0,Gt=0,yr=wt.length;Gt<yr;Gt++){var xt=wt[Gt],Nr=xt.data,Tr=xt.data.byteLength;Mt.setUint32(H,Tr),H+=4,ut.set(Nr,H),H+=Tr,vt+=4+Tr}var Ut=void 0;if(et<N-1)j=D[et+1].dts-je.dts,Ut=D[et+1].pts-je.pts;else{var jt=this.config,Nt=et>0?je.dts-D[et-1].dts:me;if(Ut=et>0?je.pts-D[et-1].pts:me,jt.stretchShortVideoTrack&&this.nextAudioPts!==null){var br=Math.floor(jt.maxBufferHole*R),or=(y?G+y*R:this.nextAudioPts)-je.pts;or>br?(j=or-Nt,j<0?j=Nt:it=!0,O.logger.log("[mp4-remuxer]: It is approximately "+or/90+" ms to the next segment; using duration "+j/90+" ms for the last video frame.")):j=Nt}else j=Nt}var ya=Math.round(je.pts-je.dts);Ct=Math.min(Ct,j),qe=Math.max(qe,j),Ye=Math.min(Ye,Ut),bt=Math.max(bt,Ut),P.push(new o(je.key,j,vt,ya))}if(P.length){if(S){if(S<70){var ci=P[0].flags;ci.dependsOn=2,ci.isNonSync=0}}else if(v&&bt-Ye<qe-Ct&&me/qe<.025&&P[0].cts===0){O.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Br=X,Lt=0,Ji=P.length;Lt<Ji;Lt++){var fi=Br+P[Lt].duration,qi=Br+P[Lt].cts;if(Lt<Ji-1){var hi=fi+P[Lt+1].cts;P[Lt].duration=hi-qi}else P[Lt].duration=Lt?P[Lt-1].duration:me;P[Lt].cts=0,Br=fi}}}console.assert(j!==null,"mp4SampleDuration must be computed"),j=it||!j?me:j,this.nextAvcDts=F=$+j,this.videoSampleDuration=j,this.isVideoContiguous=!0;var Ta=u.default.moof(m.sequenceNumber++,X,x({},m,{samples:P})),ba="video",Bt={data1:Ta,data2:ut,startPTS:G/R,endPTS:(J+j)/R,startDTS:X/R,endDTS:F/R,type:ba,hasAudio:!1,hasVideo:!0,nb:P.length,dropped:m.dropped};return m.samples=[],m.dropped=0,console.assert(ut.length,"MDAT length must not be zero"),Bt},s.remuxAudio=function(m,f,g,y,R){var D=m.inputTimeScale,P=m.samplerate?m.samplerate:D,N=D/P,B=m.segmentCodec==="aac"?_:b,F=B*N,H=this._initPTS,j=m.segmentCodec==="mp3"&&this.typeSupported.mpeg,X=[],$=R!==void 0,G=m.samples,J=j?0:8,ee=this.nextAudioPts||-1,te=f*D;if(this.isAudioContiguous=g=g||G.length&&ee>0&&(y&&Math.abs(te-ee)<9e3||Math.abs(d(G[0].pts-H,te)-ee)<20*F),G.forEach(function(xt){xt.pts=d(xt.pts-H,te)}),!g||ee<0){if(G=G.filter(function(xt){return xt.pts>=0}),!G.length)return;R===0?ee=0:y&&!$?ee=Math.max(0,te):ee=G[0].pts}if(m.segmentCodec==="aac")for(var oe=this.config.maxAudioFramesDrift,ue=0,ne=ee;ue<G.length;ue++){var he=G[ue],me=he.pts,ae=me-ne,Me=Math.abs(1e3*ae/D);if(ae<=-oe*F&&$)ue===0&&(O.logger.warn("Audio frame @ "+(me/D).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*ae/D)+" ms."),this.nextAudioPts=ee=ne=me);else if(ae>=oe*F&&Me<I&&$){var Se=Math.round(ae/F);ne=me-Se*F,ne<0&&(Se--,ne+=F),ue===0&&(this.nextAudioPts=ee=ne),O.logger.warn("[mp4-remuxer]: Injecting "+Se+" audio frame @ "+(ne/D).toFixed(3)+"s due to "+Math.round(1e3*ae/D)+" ms gap.");for(var xe=0;xe<Se;xe++){var be=Math.max(ne,0),Ue=a.default.getSilentFrame(m.manifestCodec||m.codec,m.channelCount);Ue||(O.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Ue=he.unit.subarray()),G.splice(ue,0,{unit:Ue,pts:be}),ne+=F,ue++}}he.pts=ne,ne+=F}for(var Je=null,Ge=null,rt,Ke=0,lt=G.length;lt--;)Ke+=G[lt].unit.byteLength;for(var ft=0,ht=G.length;ft<ht;ft++){var ut=G[ft],Mt=ut.unit,it=ut.pts;if(Ge!==null){var Ct=X[ft-1];Ct.duration=Math.round((it-Ge)/N)}else if(g&&m.segmentCodec==="aac"&&(it=ee),Je=it,Ke>0){Ke+=J;try{rt=new Uint8Array(Ke)}catch{this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:C.ErrorTypes.MUX_ERROR,details:C.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Ke,reason:"fail allocating audio mdat "+Ke});return}if(!j){var Ye=new DataView(rt.buffer);Ye.setUint32(0,Ke),rt.set(u.default.types.mdat,4)}}else return;rt.set(Mt,J);var qe=Mt.byteLength;J+=qe,X.push(new o(!0,B,qe,0)),Ge=it}var bt=X.length;if(!!bt){var et=X[X.length-1];this.nextAudioPts=ee=Ge+N*et.duration;var je=j?new Uint8Array(0):u.default.moof(m.sequenceNumber++,Je/N,x({},m,{samples:X}));m.samples=[];var wt=Je/D,vt=ee/D,Gt="audio",yr={data1:je,data2:rt,startPTS:wt,endPTS:vt,startDTS:wt,endDTS:vt,type:Gt,hasAudio:!0,hasVideo:!1,nb:bt};return this.isAudioContiguous=!0,console.assert(rt.length,"MDAT length must not be zero"),yr}},s.remuxEmptyAudio=function(m,f,g,y){var R=m.inputTimeScale,D=m.samplerate?m.samplerate:R,P=R/D,N=this.nextAudioPts,B=(N!==null?N:y.startDTS*R)+this._initDTS,F=y.endDTS*R+this._initDTS,H=P*_,j=Math.ceil((F-B)/H),X=a.default.getSilentFrame(m.manifestCodec||m.codec,m.channelCount);if(O.logger.warn("[mp4-remuxer]: remux empty Audio"),!X){O.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var $=[],G=0;G<j;G++){var J=B+G*H;$.push({unit:X,pts:J,dts:J})}return m.samples=$,this.remuxAudio(m,f,g,!1)},E}();function d(E,s){var c;if(s===null)return E;for(s<E?c=-8589934592:c=8589934592;Math.abs(E-s)>4294967296;)E+=c;return E}function p(E){for(var s=0;s<E.length;s++)if(E[s].key)return s;return-1}function T(E,s,c,m){var f=E.samples.length;if(!!f){for(var g=E.inputTimeScale,y=0;y<f;y++){var R=E.samples[y];R.pts=d(R.pts-c,s*g)/g,R.dts=d(R.dts-m,s*g)/g}var D=E.samples;return E.samples=[],{samples:D}}}function l(E,s,c){var m=E.samples.length;if(!!m){for(var f=E.inputTimeScale,g=0;g<m;g++){var y=E.samples[g];y.pts=d(y.pts-c,s*f)/f}E.samples.sort(function(D,P){return D.pts-P.pts});var R=E.samples;return E.samples=[],{samples:R}}}var o=function(s,c,m,f){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=c,this.size=m,this.cts=f,this.flags=new h(s)},h=function(s){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=s?2:1,this.isNonSync=s?0:1}},"./src/remux/passthrough-remuxer.ts":function(r,t,e){"use strict";e.r(t);var n=e("./src/polyfills/number.ts"),a=e("./src/remux/mp4-remuxer.ts"),u=e("./src/utils/mp4-tools.ts"),M=e("./src/loader/fragment.ts"),C=e("./src/utils/logger.ts"),O=function(){function A(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var x=A.prototype;return x.destroy=function(){},x.resetTimeStamp=function(_){this.initPTS=_,this.lastEndTime=null},x.resetNextTimestamp=function(){this.lastEndTime=null},x.resetInitSegment=function(_,b,S){this.audioCodec=b,this.videoCodec=S,this.generateInitSegment(_),this.emitInitSegment=!0},x.generateInitSegment=function(_){var b=this.audioCodec,S=this.videoCodec;if(!_||!_.byteLength){this.initTracks=void 0,this.initData=void 0;return}var v=this.initData=Object(u.parseInitSegment)(_);b||(b=L(v.audio,M.ElementaryStreamTypes.AUDIO)),S||(S=L(v.video,M.ElementaryStreamTypes.VIDEO));var i={};v.audio&&v.video?i.audiovideo={container:"video/mp4",codec:b+","+S,initSegment:_,id:"main"}:v.audio?i.audio={container:"audio/mp4",codec:b,initSegment:_,id:"audio"}:v.video?i.video={container:"video/mp4",codec:S,initSegment:_,id:"main"}:C.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=i},x.remux=function(_,b,S,v,i){var d,p=this.initPTS,T=this.lastEndTime,l={audio:void 0,video:void 0,text:v,id3:S,initSegment:void 0};Object(n.isFiniteNumber)(T)||(T=this.lastEndTime=i||0);var o=b.samples;if(!o||!o.length)return l;var h={initPTS:void 0,timescale:1},E=this.initData;if((!E||!E.length)&&(this.generateInitSegment(o),E=this.initData),!E||!E.length)return C.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),l;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);var s=Object(u.getStartDTS)(E,o);Object(n.isFiniteNumber)(p)||(this.initPTS=h.initPTS=p=s-i);var c=Object(u.getDuration)(o,E),m=_?s-p:T,f=m+c;Object(u.offsetStartDTS)(E,o,p),c>0?this.lastEndTime=f:(C.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var g=!!E.audio,y=!!E.video,R="";g&&(R+="audio"),y&&(R+="video");var D={data1:o,startPTS:m,startDTS:m,endPTS:f,endDTS:f,type:R,hasAudio:g,hasVideo:y,nb:1,dropped:0};l.audio=D.type==="audio"?D:void 0,l.video=D.type!=="audio"?D:void 0,l.initSegment=h;var P=(d=this.initPTS)!=null?d:0;return l.id3=Object(a.flushTextTrackMetadataCueSamples)(S,i,P,P),v.samples.length&&(l.text=Object(a.flushTextTrackUserdataCueSamples)(v,i,P)),l},A}();function L(A,x){var I=A==null?void 0:A.codec;return I&&I.length>4?I:I==="hvc1"||I==="hev1"?"hvc1.1.c.L120.90":I==="av01"?"av01.0.04M.08":I==="avc1"||x===M.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}t.default=O},"./src/task-loop.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return n});var n=function(){function a(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var u=a.prototype;return u.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},u.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},u.onHandlerDestroyed=function(){},u.hasInterval=function(){return!!this._tickInterval},u.hasNextTick=function(){return!!this._tickTimer},u.setInterval=function(C){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,C),!0)},u.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},u.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},u.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},u.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},u.doTick=function(){},a}()},"./src/types/cmcd.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"CMCDVersion",function(){return n}),e.d(t,"CMCDObjectType",function(){return a}),e.d(t,"CMCDStreamingFormat",function(){return u}),e.d(t,"CMCDStreamType",function(){return M});var n=1,a;(function(C){C.MANIFEST="m",C.AUDIO="a",C.VIDEO="v",C.MUXED="av",C.INIT="i",C.CAPTION="c",C.TIMED_TEXT="tt",C.KEY="k",C.OTHER="o"})(a||(a={}));var u;(function(C){C.DASH="d",C.HLS="h",C.SMOOTH="s",C.OTHER="o"})(u||(u={}));var M;(function(C){C.VOD="v",C.LIVE="l"})(M||(M={}))},"./src/types/demuxer.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"MetadataSchema",function(){return n});var n;(function(a){a.audioId3="org.id3",a.dateRange="com.apple.quicktime.HLS",a.emsg="https://aomedia.org/emsg/ID3"})(n||(n={}))},"./src/types/level.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"HlsSkip",function(){return u}),e.d(t,"getSkipValue",function(){return M}),e.d(t,"HlsUrlParameters",function(){return C}),e.d(t,"Level",function(){return O});function n(L,A){for(var x=0;x<A.length;x++){var I=A[x];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(L,I.key,I)}}function a(L,A,x){return A&&n(L.prototype,A),x&&n(L,x),Object.defineProperty(L,"prototype",{writable:!1}),L}var u;(function(L){L.No="",L.Yes="YES",L.v2="v2"})(u||(u={}));function M(L,A){var x=L.canSkipUntil,I=L.canSkipDateRanges,_=L.endSN,b=A!==void 0?A-_:0;return x&&b<x?I?u.v2:u.Yes:u.No}var C=function(){function L(x,I,_){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=x,this.part=I,this.skip=_}var A=L.prototype;return A.addDirectives=function(I){var _=new self.URL(I);return this.msn!==void 0&&_.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&_.searchParams.set("_HLS_part",this.part.toString()),this.skip&&_.searchParams.set("_HLS_skip",this.skip),_.toString()},L}(),O=function(){function L(A){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[A.url],this.attrs=A.attrs,this.bitrate=A.bitrate,A.details&&(this.details=A.details),this.id=A.id||0,this.name=A.name,this.width=A.width||0,this.height=A.height||0,this.audioCodec=A.audioCodec,this.videoCodec=A.videoCodec,this.unknownCodecs=A.unknownCodecs,this.codecSet=[A.videoCodec,A.audioCodec].filter(function(x){return x}).join(",").replace(/\.[^.,]+/g,"")}return a(L,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(x){var I=x%this.url.length;this._urlId!==I&&(this.details=void 0,this._urlId=I)}}]),L}()},"./src/types/loader.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"PlaylistContextType",function(){return n}),e.d(t,"PlaylistLevelType",function(){return a});var n;(function(u){u.MANIFEST="manifest",u.LEVEL="level",u.AUDIO_TRACK="audioTrack",u.SUBTITLE_TRACK="subtitleTrack"})(n||(n={}));var a;(function(u){u.MAIN="main",u.AUDIO="audio",u.SUBTITLE="subtitle"})(a||(a={}))},"./src/types/transmuxer.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"ChunkMetadata",function(){return n});var n=function(M,C,O,L,A,x){L===void 0&&(L=0),A===void 0&&(A=-1),x===void 0&&(x=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=a(),this.buffering={audio:a(),video:a(),audiovideo:a()},this.level=M,this.sn=C,this.id=O,this.size=L,this.part=A,this.partial=x};function a(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"AttrList",function(){return u});var n=/^(\d+)x(\d+)$/,a=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,u=function(){function M(O){typeof O=="string"&&(O=M.parseAttrList(O));for(var L in O)O.hasOwnProperty(L)&&(this[L]=O[L])}var C=M.prototype;return C.decimalInteger=function(L){var A=parseInt(this[L],10);return A>Number.MAX_SAFE_INTEGER?1/0:A},C.hexadecimalInteger=function(L){if(this[L]){var A=(this[L]||"0x").slice(2);A=(A.length&1?"0":"")+A;for(var x=new Uint8Array(A.length/2),I=0;I<A.length/2;I++)x[I]=parseInt(A.slice(I*2,I*2+2),16);return x}else return null},C.hexadecimalIntegerAsNumber=function(L){var A=parseInt(this[L],16);return A>Number.MAX_SAFE_INTEGER?1/0:A},C.decimalFloatingPoint=function(L){return parseFloat(this[L])},C.optionalFloat=function(L,A){var x=this[L];return x?parseFloat(x):A},C.enumeratedString=function(L){return this[L]},C.bool=function(L){return this[L]==="YES"},C.decimalResolution=function(L){var A=n.exec(this[L]);if(A!==null)return{width:parseInt(A[1],10),height:parseInt(A[2],10)}},M.parseAttrList=function(L){var A,x={},I='"';for(a.lastIndex=0;(A=a.exec(L))!==null;){var _=A[2];_.indexOf(I)===0&&_.lastIndexOf(I)===_.length-1&&(_=_.slice(1,-1)),x[A[1]]=_}return x},M}()},"./src/utils/binary-search.ts":function(r,t,e){"use strict";e.r(t);var n={search:function(u,M){for(var C=0,O=u.length-1,L=null,A=null;C<=O;){L=(C+O)/2|0,A=u[L];var x=M(A);if(x>0)C=L+1;else if(x<0)O=L-1;else return A}return null}};t.default=n},"./src/utils/buffer-helper.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"BufferHelper",function(){return u});var n=e("./src/utils/logger.ts"),a={length:0,start:function(){return 0},end:function(){return 0}},u=function(){function M(){}return M.isBuffered=function(O,L){try{if(O){for(var A=M.getBuffered(O),x=0;x<A.length;x++)if(L>=A.start(x)&&L<=A.end(x))return!0}}catch{}return!1},M.bufferInfo=function(O,L,A){try{if(O){var x=M.getBuffered(O),I=[],_;for(_=0;_<x.length;_++)I.push({start:x.start(_),end:x.end(_)});return this.bufferedInfo(I,L,A)}}catch{}return{len:0,start:L,end:L,nextStart:void 0}},M.bufferedInfo=function(O,L,A){L=Math.max(0,L),O.sort(function(o,h){var E=o.start-h.start;return E||h.end-o.end});var x=[];if(A)for(var I=0;I<O.length;I++){var _=x.length;if(_){var b=x[_-1].end;O[I].start-b<A?O[I].end>b&&(x[_-1].end=O[I].end):x.push(O[I])}else x.push(O[I])}else x=O;for(var S=0,v,i=L,d=L,p=0;p<x.length;p++){var T=x[p].start,l=x[p].end;if(L+A>=T&&L<l)i=T,d=l,S=d-L;else if(L+A<T){v=T;break}}return{len:S,start:i||0,end:d||0,nextStart:v}},M.getBuffered=function(O){try{return O.buffered}catch(L){return n.logger.log("failed to get media.buffered",L),a}},M}()},"./src/utils/cea-608-parser.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"Row",function(){return d}),e.d(t,"CaptionScreen",function(){return p});var n=e("./src/utils/logger.ts"),a={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},u=function(c){var m=c;return a.hasOwnProperty(c)&&(m=a[c]),String.fromCharCode(m)},M=15,C=100,O={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},L={17:2,18:4,21:6,22:8,23:10,19:13,20:15},A={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},x={25:2,26:4,29:6,30:8,31:10,27:13,28:15},I=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],_;(function(s){s[s.ERROR=0]="ERROR",s[s.TEXT=1]="TEXT",s[s.WARNING=2]="WARNING",s[s.INFO=2]="INFO",s[s.DEBUG=3]="DEBUG",s[s.DATA=3]="DATA"})(_||(_={}));var b=function(){function s(){this.time=null,this.verboseLevel=_.ERROR}var c=s.prototype;return c.log=function(f,g){this.verboseLevel>=f&&n.logger.log(this.time+" ["+f+"] "+g)},s}(),S=function(c){for(var m=[],f=0;f<c.length;f++)m.push(c[f].toString(16));return m},v=function(){function s(m,f,g,y,R){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=m||"white",this.underline=f||!1,this.italics=g||!1,this.background=y||"black",this.flash=R||!1}var c=s.prototype;return c.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},c.setStyles=function(f){for(var g=["foreground","underline","italics","background","flash"],y=0;y<g.length;y++){var R=g[y];f.hasOwnProperty(R)&&(this[R]=f[R])}},c.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},c.equals=function(f){return this.foreground===f.foreground&&this.underline===f.underline&&this.italics===f.italics&&this.background===f.background&&this.flash===f.flash},c.copy=function(f){this.foreground=f.foreground,this.underline=f.underline,this.italics=f.italics,this.background=f.background,this.flash=f.flash},c.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},s}(),i=function(){function s(m,f,g,y,R,D){this.uchar=void 0,this.penState=void 0,this.uchar=m||" ",this.penState=new v(f,g,y,R,D)}var c=s.prototype;return c.reset=function(){this.uchar=" ",this.penState.reset()},c.setChar=function(f,g){this.uchar=f,this.penState.copy(g)},c.setPenState=function(f){this.penState.copy(f)},c.equals=function(f){return this.uchar===f.uchar&&this.penState.equals(f.penState)},c.copy=function(f){this.uchar=f.uchar,this.penState.copy(f.penState)},c.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},s}(),d=function(){function s(m){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var f=0;f<C;f++)this.chars.push(new i);this.logger=m,this.pos=0,this.currPenState=new v}var c=s.prototype;return c.equals=function(f){for(var g=!0,y=0;y<C;y++)if(!this.chars[y].equals(f.chars[y])){g=!1;break}return g},c.copy=function(f){for(var g=0;g<C;g++)this.chars[g].copy(f.chars[g])},c.isEmpty=function(){for(var f=!0,g=0;g<C;g++)if(!this.chars[g].isEmpty()){f=!1;break}return f},c.setCursor=function(f){this.pos!==f&&(this.pos=f),this.pos<0?(this.logger.log(_.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>C&&(this.logger.log(_.DEBUG,"Too large cursor position "+this.pos),this.pos=C)},c.moveCursor=function(f){var g=this.pos+f;if(f>1)for(var y=this.pos+1;y<g+1;y++)this.chars[y].setPenState(this.currPenState);this.setCursor(g)},c.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},c.insertChar=function(f){f>=144&&this.backSpace();var g=u(f);if(this.pos>=C){this.logger.log(_.ERROR,"Cannot insert "+f.toString(16)+" ("+g+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(g,this.currPenState),this.moveCursor(1)},c.clearFromPos=function(f){var g;for(g=f;g<C;g++)this.chars[g].reset()},c.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},c.clearToEndOfRow=function(){this.clearFromPos(this.pos)},c.getTextString=function(){for(var f=[],g=!0,y=0;y<C;y++){var R=this.chars[y].uchar;R!==" "&&(g=!1),f.push(R)}return g?"":f.join("")},c.setPenStyles=function(f){this.currPenState.setStyles(f);var g=this.chars[this.pos];g.setPenState(this.currPenState)},s}(),p=function(){function s(m){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var f=0;f<M;f++)this.rows.push(new d(m));this.logger=m,this.currRow=M-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var c=s.prototype;return c.reset=function(){for(var f=0;f<M;f++)this.rows[f].clear();this.currRow=M-1},c.equals=function(f){for(var g=!0,y=0;y<M;y++)if(!this.rows[y].equals(f.rows[y])){g=!1;break}return g},c.copy=function(f){for(var g=0;g<M;g++)this.rows[g].copy(f.rows[g])},c.isEmpty=function(){for(var f=!0,g=0;g<M;g++)if(!this.rows[g].isEmpty()){f=!1;break}return f},c.backSpace=function(){var f=this.rows[this.currRow];f.backSpace()},c.clearToEndOfRow=function(){var f=this.rows[this.currRow];f.clearToEndOfRow()},c.insertChar=function(f){var g=this.rows[this.currRow];g.insertChar(f)},c.setPen=function(f){var g=this.rows[this.currRow];g.setPenStyles(f)},c.moveCursor=function(f){var g=this.rows[this.currRow];g.moveCursor(f)},c.setCursor=function(f){this.logger.log(_.INFO,"setCursor: "+f);var g=this.rows[this.currRow];g.setCursor(f)},c.setPAC=function(f){this.logger.log(_.INFO,"pacData = "+JSON.stringify(f));var g=f.row-1;if(this.nrRollUpRows&&g<this.nrRollUpRows-1&&(g=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==g){for(var y=0;y<M;y++)this.rows[y].clear();var R=this.currRow+1-this.nrRollUpRows,D=this.lastOutputScreen;if(D){var P=D.rows[R].cueStartTime,N=this.logger.time;if(P&&N!==null&&P<N)for(var B=0;B<this.nrRollUpRows;B++)this.rows[g-this.nrRollUpRows+B+1].copy(D.rows[R+B])}}this.currRow=g;var F=this.rows[this.currRow];if(f.indent!==null){var H=f.indent,j=Math.max(H-1,0);F.setCursor(f.indent),f.color=F.chars[j].penState.foreground}var X={foreground:f.color,underline:f.underline,italics:f.italics,background:"black",flash:!1};this.setPen(X)},c.setBkgData=function(f){this.logger.log(_.INFO,"bkgData = "+JSON.stringify(f)),this.backSpace(),this.setPen(f),this.insertChar(32)},c.setRollUpRows=function(f){this.nrRollUpRows=f},c.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(_.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(_.TEXT,this.getDisplayText());var f=this.currRow+1-this.nrRollUpRows,g=this.rows.splice(f,1)[0];g.clear(),this.rows.splice(this.currRow,0,g),this.logger.log(_.INFO,"Rolling up")},c.getDisplayText=function(f){f=f||!1;for(var g=[],y="",R=-1,D=0;D<M;D++){var P=this.rows[D].getTextString();P&&(R=D+1,f?g.push("Row "+R+": '"+P+"'"):g.push(P.trim()))}return g.length>0&&(f?y="["+g.join(" | ")+"]":y=g.join(`
`)),y},c.getTextAndFormat=function(){return this.rows},s}(),T=function(){function s(m,f,g){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=m,this.outputFilter=f,this.mode=null,this.verbose=0,this.displayedMemory=new p(g),this.nonDisplayedMemory=new p(g),this.lastOutputScreen=new p(g),this.currRollUpRow=this.displayedMemory.rows[M-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=g}var c=s.prototype;return c.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[M-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},c.getHandler=function(){return this.outputFilter},c.setHandler=function(f){this.outputFilter=f},c.setPAC=function(f){this.writeScreen.setPAC(f)},c.setBkgData=function(f){this.writeScreen.setBkgData(f)},c.setMode=function(f){f!==this.mode&&(this.mode=f,this.logger.log(_.INFO,"MODE="+f),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=f)},c.insertChars=function(f){for(var g=0;g<f.length;g++)this.writeScreen.insertChar(f[g]);var y=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(_.INFO,y+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(_.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},c.ccRCL=function(){this.logger.log(_.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},c.ccBS=function(){this.logger.log(_.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},c.ccAOF=function(){},c.ccAON=function(){},c.ccDER=function(){this.logger.log(_.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},c.ccRU=function(f){this.logger.log(_.INFO,"RU("+f+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(f)},c.ccFON=function(){this.logger.log(_.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},c.ccRDC=function(){this.logger.log(_.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},c.ccTR=function(){this.logger.log(_.INFO,"TR"),this.setMode("MODE_TEXT")},c.ccRTD=function(){this.logger.log(_.INFO,"RTD"),this.setMode("MODE_TEXT")},c.ccEDM=function(){this.logger.log(_.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},c.ccCR=function(){this.logger.log(_.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},c.ccENM=function(){this.logger.log(_.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},c.ccEOC=function(){if(this.logger.log(_.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var f=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=f,this.writeScreen=this.nonDisplayedMemory,this.logger.log(_.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},c.ccTO=function(f){this.logger.log(_.INFO,"TO("+f+") - Tab Offset"),this.writeScreen.moveCursor(f)},c.ccMIDROW=function(f){var g={flash:!1};if(g.underline=f%2===1,g.italics=f>=46,g.italics)g.foreground="white";else{var y=Math.floor(f/2)-16,R=["white","green","blue","cyan","red","yellow","magenta"];g.foreground=R[y]}this.logger.log(_.INFO,"MIDROW: "+JSON.stringify(g)),this.writeScreen.setPen(g)},c.outputDataUpdate=function(f){f===void 0&&(f=!1);var g=this.logger.time;g!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=g:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,g,this.lastOutputScreen),f&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:g),this.lastOutputScreen.copy(this.displayedMemory))},c.cueSplitAtTime=function(f){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,f,this.displayedMemory),this.cueStartTime=f))},s}(),l=function(){function s(m,f,g){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var y=new b;this.channels=[null,new T(m,f,y),new T(m+1,g,y)],this.cmdHistory=E(),this.logger=y}var c=s.prototype;return c.getHandler=function(f){return this.channels[f].getHandler()},c.setHandler=function(f,g){this.channels[f].setHandler(g)},c.addData=function(f,g){var y,R,D,P=!1;this.logger.time=f;for(var N=0;N<g.length;N+=2)if(R=g[N]&127,D=g[N+1]&127,!(R===0&&D===0)){if(this.logger.log(_.DATA,"["+S([g[N],g[N+1]])+"] -> ("+S([R,D])+")"),y=this.parseCmd(R,D),y||(y=this.parseMidrow(R,D)),y||(y=this.parsePAC(R,D)),y||(y=this.parseBackgroundAttributes(R,D)),!y&&(P=this.parseChars(R,D),P)){var B=this.currentChannel;if(B&&B>0){var F=this.channels[B];F.insertChars(P)}else this.logger.log(_.WARNING,"No channel found yet. TEXT-MODE?")}!y&&!P&&this.logger.log(_.WARNING,"Couldn't parse cleaned data "+S([R,D])+" orig: "+S([g[N],g[N+1]]))}},c.parseCmd=function(f,g){var y=this.cmdHistory,R=(f===20||f===28||f===21||f===29)&&g>=32&&g<=47,D=(f===23||f===31)&&g>=33&&g<=35;if(!(R||D))return!1;if(h(f,g,y))return o(null,null,y),this.logger.log(_.DEBUG,"Repeated command ("+S([f,g])+") is dropped"),!0;var P=f===20||f===21||f===23?1:2,N=this.channels[P];return f===20||f===21||f===28||f===29?g===32?N.ccRCL():g===33?N.ccBS():g===34?N.ccAOF():g===35?N.ccAON():g===36?N.ccDER():g===37?N.ccRU(2):g===38?N.ccRU(3):g===39?N.ccRU(4):g===40?N.ccFON():g===41?N.ccRDC():g===42?N.ccTR():g===43?N.ccRTD():g===44?N.ccEDM():g===45?N.ccCR():g===46?N.ccENM():g===47&&N.ccEOC():N.ccTO(g-32),o(f,g,y),this.currentChannel=P,!0},c.parseMidrow=function(f,g){var y=0;if((f===17||f===25)&&g>=32&&g<=47){if(f===17?y=1:y=2,y!==this.currentChannel)return this.logger.log(_.ERROR,"Mismatch channel in midrow parsing"),!1;var R=this.channels[y];return R?(R.ccMIDROW(g),this.logger.log(_.DEBUG,"MIDROW ("+S([f,g])+")"),!0):!1}return!1},c.parsePAC=function(f,g){var y,R=this.cmdHistory,D=(f>=17&&f<=23||f>=25&&f<=31)&&g>=64&&g<=127,P=(f===16||f===24)&&g>=64&&g<=95;if(!(D||P))return!1;if(h(f,g,R))return o(null,null,R),!0;var N=f<=23?1:2;g>=64&&g<=95?y=N===1?O[f]:A[f]:y=N===1?L[f]:x[f];var B=this.channels[N];return B?(B.setPAC(this.interpretPAC(y,g)),o(f,g,R),this.currentChannel=N,!0):!1},c.interpretPAC=function(f,g){var y,R={color:null,italics:!1,indent:null,underline:!1,row:f};return g>95?y=g-96:y=g-64,R.underline=(y&1)===1,y<=13?R.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(y/2)]:y<=15?(R.italics=!0,R.color="white"):R.indent=Math.floor((y-16)/2)*4,R},c.parseChars=function(f,g){var y,R=null,D=null;if(f>=25?(y=2,D=f-8):(y=1,D=f),D>=17&&D<=19){var P;D===17?P=g+80:D===18?P=g+112:P=g+144,this.logger.log(_.INFO,"Special char '"+u(P)+"' in channel "+y),R=[P]}else f>=32&&f<=127&&(R=g===0?[f]:[f,g]);if(R){var N=S(R);this.logger.log(_.DEBUG,"Char codes =  "+N.join(",")),o(f,g,this.cmdHistory)}return R},c.parseBackgroundAttributes=function(f,g){var y=(f===16||f===24)&&g>=32&&g<=47,R=(f===23||f===31)&&g>=45&&g<=47;if(!(y||R))return!1;var D,P={};f===16||f===24?(D=Math.floor((g-32)/2),P.background=I[D],g%2===1&&(P.background=P.background+"_semi")):g===45?P.background="transparent":(P.foreground="black",g===47&&(P.underline=!0));var N=f<=23?1:2,B=this.channels[N];return B.setBkgData(P),o(f,g,this.cmdHistory),!0},c.reset=function(){for(var f=0;f<Object.keys(this.channels).length;f++){var g=this.channels[f];g&&g.reset()}this.cmdHistory=E()},c.cueSplitAtTime=function(f){for(var g=0;g<this.channels.length;g++){var y=this.channels[g];y&&y.cueSplitAtTime(f)}},s}();function o(s,c,m){m.a=s,m.b=c}function h(s,c,m){return m.a===s&&m.b===c}function E(){return{a:null,b:null}}t.default=l},"./src/utils/codecs.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"isCodecType",function(){return a}),e.d(t,"isCodecSupportedInMp4",function(){return u});var n={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function a(M,C){var O=n[C];return!!O&&O[M.slice(0,4)]===!0}function u(M,C){return MediaSource.isTypeSupported((C||"video")+'/mp4;codecs="'+M+'"')}},"./src/utils/cues.ts":function(r,t,e){"use strict";e.r(t);var n=e("./src/utils/vttparser.ts"),a=e("./src/utils/webvtt-parser.ts"),u=e("./src/utils/texttrack-utils.ts"),M=/\s/,C={newCue:function(L,A,x,I){for(var _=[],b,S,v,i,d,p=self.VTTCue||self.TextTrackCue,T=0;T<I.rows.length;T++)if(b=I.rows[T],v=!0,i=0,d="",!b.isEmpty()){for(var l=0;l<b.chars.length;l++)M.test(b.chars[l].uchar)&&v?i++:(d+=b.chars[l].uchar,v=!1);b.cueStartTime=A,A===x&&(x+=1e-4),i>=16?i--:i++;var o=Object(n.fixLineBreaks)(d.trim()),h=Object(a.generateCueId)(A,x,o);(!L||!L.cues||!L.cues.getCueById(h))&&(S=new p(A,x,o),S.id=h,S.line=T+1,S.align="left",S.position=10+Math.min(80,Math.floor(i*8/32)*10),_.push(S))}return L&&_.length&&(_.sort(function(E,s){return E.line==="auto"||s.line==="auto"?0:E.line>8&&s.line>8?s.line-E.line:E.line-s.line}),_.forEach(function(E){return Object(u.addCueToTrack)(L,E)})),_}};t.default=C},"./src/utils/discontinuities.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"findFirstFragWithCC",function(){return M}),e.d(t,"shouldAlignOnDiscontinuities",function(){return C}),e.d(t,"findDiscontinuousReferenceFrag",function(){return O}),e.d(t,"adjustSlidingStart",function(){return A}),e.d(t,"alignStream",function(){return x}),e.d(t,"alignPDT",function(){return _}),e.d(t,"alignFragmentByPDTDelta",function(){return b}),e.d(t,"alignMediaPlaylistByPDT",function(){return S});var n=e("./src/polyfills/number.ts"),a=e("./src/utils/logger.ts"),u=e("./src/controller/level-helper.ts");function M(v,i){for(var d=null,p=0,T=v.length;p<T;p++){var l=v[p];if(l&&l.cc===i){d=l;break}}return d}function C(v,i,d){return!!(i.details&&(d.endCC>d.startCC||v&&v.cc<d.startCC))}function O(v,i){var d=v.fragments,p=i.fragments;if(!p.length||!d.length){a.logger.log("No fragments to align");return}var T=M(d,p[0].cc);if(!T||T&&!T.startPTS){a.logger.log("No frag in previous level to align on");return}return T}function L(v,i){if(v){var d=v.start+i;v.start=v.startPTS=d,v.endPTS=d+v.duration}}function A(v,i){for(var d=i.fragments,p=0,T=d.length;p<T;p++)L(d[p],v);i.fragmentHint&&L(i.fragmentHint,v),i.alignedSliding=!0}function x(v,i,d){!i||(I(v,d,i),!d.alignedSliding&&i.details&&_(d,i.details),!d.alignedSliding&&i.details&&!d.skippedSegments&&Object(u.adjustSliding)(i.details,d))}function I(v,i,d){if(C(v,d,i)){var p=O(d.details,i);p&&Object(n.isFiniteNumber)(p.start)&&(a.logger.log("Adjusting PTS using last level due to CC increase within current level "+i.url),A(p.start,i))}}function _(v,i){if(!(!i.fragments.length||!v.hasProgramDateTime||!i.hasProgramDateTime)){var d=i.fragments[0].programDateTime,p=v.fragments[0].programDateTime,T=(p-d)/1e3+i.fragments[0].start;T&&Object(n.isFiniteNumber)(T)&&(a.logger.log("Adjusting PTS using programDateTime delta "+(p-d)+"ms, sliding:"+T.toFixed(3)+" "+v.url+" "),A(T,v))}}function b(v,i){var d=v.programDateTime;if(!!d){var p=(d-i)/1e3;v.start=v.startPTS=p,v.endPTS=p+v.duration}}function S(v,i){if(!(!i.fragments.length||!v.hasProgramDateTime||!i.hasProgramDateTime)){var d=i.fragments[0].programDateTime,p=i.fragments[0].start,T=d-p*1e3;v.fragments.forEach(function(l){b(l,T)}),v.fragmentHint&&b(v.fragmentHint,T),v.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(r,t,e){"use strict";e.r(t);var n=e("./src/utils/ewma.ts"),a=function(){function u(C,O,L){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=L,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new n.default(C),this.fast_=new n.default(O)}var M=u.prototype;return M.update=function(O,L){var A=this.slow_,x=this.fast_;this.slow_.halfLife!==O&&(this.slow_=new n.default(O,A.getEstimate(),A.getTotalWeight())),this.fast_.halfLife!==L&&(this.fast_=new n.default(L,x.getEstimate(),x.getTotalWeight()))},M.sample=function(O,L){O=Math.max(O,this.minDelayMs_);var A=8*L,x=O/1e3,I=A/x;this.fast_.sample(x,I),this.slow_.sample(x,I)},M.canEstimate=function(){var O=this.fast_;return O&&O.getTotalWeight()>=this.minWeight_},M.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},M.destroy=function(){},u}();t.default=a},"./src/utils/ewma.ts":function(r,t,e){"use strict";e.r(t);var n=function(){function a(M,C,O){C===void 0&&(C=0),O===void 0&&(O=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=M,this.alpha_=M?Math.exp(Math.log(.5)/M):0,this.estimate_=C,this.totalWeight_=O}var u=a.prototype;return u.sample=function(C,O){var L=Math.pow(this.alpha_,C);this.estimate_=O*(1-L)+L*this.estimate_,this.totalWeight_+=C},u.getTotalWeight=function(){return this.totalWeight_},u.getEstimate=function(){if(this.alpha_){var C=1-Math.pow(this.alpha_,this.totalWeight_);if(C)return this.estimate_/C}return this.estimate_},a}();t.default=n},"./src/utils/fetch-loader.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"fetchSupported",function(){return b});var n=e("./src/polyfills/number.ts"),a=e("./src/loader/load-stats.ts"),u=e("./src/demux/chunk-cache.ts");function M(p,T){p.prototype=Object.create(T.prototype),p.prototype.constructor=p,x(p,T)}function C(p){var T=typeof Map=="function"?new Map:void 0;return C=function(o){if(o===null||!A(o))return o;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(typeof T!="undefined"){if(T.has(o))return T.get(o);T.set(o,h)}function h(){return O(o,arguments,I(this).constructor)}return h.prototype=Object.create(o.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),x(h,o)},C(p)}function O(p,T,l){return L()?O=Reflect.construct.bind():O=function(h,E,s){var c=[null];c.push.apply(c,E);var m=Function.bind.apply(h,c),f=new m;return s&&x(f,s.prototype),f},O.apply(null,arguments)}function L(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function A(p){return Function.toString.call(p).indexOf("[native code]")!==-1}function x(p,T){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,h){return o.__proto__=h,o},x(p,T)}function I(p){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},I(p)}function _(){return _=Object.assign?Object.assign.bind():function(p){for(var T=1;T<arguments.length;T++){var l=arguments[T];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(p[o]=l[o])}return p},_.apply(this,arguments)}function b(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var S=function(){function p(l){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=l.fetchSetup||i,this.controller=new self.AbortController,this.stats=new a.LoadStats}var T=p.prototype;return T.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},T.abortInternal=function(){var o=this.response;(!o||!o.ok)&&(this.stats.aborted=!0,this.controller.abort())},T.abort=function(){var o;this.abortInternal(),(o=this.callbacks)!==null&&o!==void 0&&o.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},T.load=function(o,h,E){var s=this,c=this.stats;if(c.loading.start)throw new Error("Loader can only be used once.");c.loading.start=self.performance.now();var m=v(o,this.controller.signal),f=E.onProgress,g=o.responseType==="arraybuffer",y=g?"byteLength":"length";this.context=o,this.config=h,this.callbacks=E,this.request=this.fetchSetup(o,m),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){s.abortInternal(),E.onTimeout(c,o,s.response)},h.timeout),self.fetch(this.request).then(function(R){if(s.response=s.loader=R,!R.ok){var D=R.status,P=R.statusText;throw new d(P||"fetch, bad network response",D,R)}return c.loading.first=Math.max(self.performance.now(),c.loading.start),c.total=parseInt(R.headers.get("Content-Length")||"0"),f&&Object(n.isFiniteNumber)(h.highWaterMark)?s.loadProgressively(R,c,o,h.highWaterMark,f):g?R.arrayBuffer():R.text()}).then(function(R){var D=s.response;self.clearTimeout(s.requestTimeout),c.loading.end=Math.max(self.performance.now(),c.loading.first),c.loaded=c.total=R[y];var P={url:D.url,data:R};f&&!Object(n.isFiniteNumber)(h.highWaterMark)&&f(c,o,R,D),E.onSuccess(P,c,o,D)}).catch(function(R){if(self.clearTimeout(s.requestTimeout),!c.aborted){var D=R&&R.code||0,P=R?R.message:null;E.onError({code:D,text:P},o,R?R.details:null)}})},T.getCacheAge=function(){var o=null;if(this.response){var h=this.response.headers.get("age");o=h?parseFloat(h):null}return o},T.loadProgressively=function(o,h,E,s,c){s===void 0&&(s=0);var m=new u.default,f=o.body.getReader(),g=function y(){return f.read().then(function(R){if(R.done)return m.dataLength&&c(h,E,m.flush(),o),Promise.resolve(new ArrayBuffer(0));var D=R.value,P=D.length;return h.loaded+=P,P<s||m.dataLength?(m.push(D),m.dataLength>=s&&c(h,E,m.flush(),o)):c(h,E,D,o),y()}).catch(function(){return Promise.reject()})};return g()},p}();function v(p,T){var l={method:"GET",mode:"cors",credentials:"same-origin",signal:T,headers:new self.Headers(_({},p.headers))};return p.rangeEnd&&l.headers.set("Range","bytes="+p.rangeStart+"-"+String(p.rangeEnd-1)),l}function i(p,T){return new self.Request(p.url,T)}var d=function(p){M(T,p);function T(l,o,h){var E;return E=p.call(this,l)||this,E.code=void 0,E.details=void 0,E.code=o,E.details=h,E}return T}(C(Error));t.default=S},"./src/utils/imsc1-ttml-parser.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"IMSC1_CODEC",function(){return A}),e.d(t,"parseIMSC1",function(){return b});var n=e("./src/utils/mp4-tools.ts"),a=e("./src/utils/vttparser.ts"),u=e("./src/utils/vttcue.ts"),M=e("./src/demux/id3.ts"),C=e("./src/utils/timescale-conversion.ts"),O=e("./src/utils/webvtt-parser.ts");function L(){return L=Object.assign?Object.assign.bind():function(s){for(var c=1;c<arguments.length;c++){var m=arguments[c];for(var f in m)Object.prototype.hasOwnProperty.call(m,f)&&(s[f]=m[f])}return s},L.apply(this,arguments)}var A="stpp.ttml.im1t",x=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,I=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,_={left:"start",center:"center",right:"end",start:"start",end:"end"};function b(s,c,m,f,g){var y=Object(n.findBox)(new Uint8Array(s),["mdat"]);if(y.length===0){g(new Error("Could not parse IMSC1 mdat"));return}var R=y.map(function(P){return Object(M.utf8ArrayToStr)(P)}),D=Object(C.toTimescaleFromScale)(c,1,m);try{R.forEach(function(P){return f(S(P,D))})}catch(P){g(P)}}function S(s,c){var m=new DOMParser,f=m.parseFromString(s,"text/xml"),g=f.getElementsByTagName("tt")[0];if(!g)throw new Error("Invalid ttml");var y={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},R=Object.keys(y).reduce(function(F,H){return F[H]=g.getAttribute("ttp:"+H)||y[H],F},{}),D=g.getAttribute("xml:space")!=="preserve",P=i(v(g,"styling","style")),N=i(v(g,"layout","region")),B=v(g,"body","[begin]");return[].map.call(B,function(F){var H=d(F,D);if(!H||!F.hasAttribute("begin"))return null;var j=o(F.getAttribute("begin"),R),X=o(F.getAttribute("dur"),R),$=o(F.getAttribute("end"),R);if(j===null)throw l(F);if($===null){if(X===null)throw l(F);$=j+X}var G=new u.default(j-c,$-c,H);G.id=Object(O.generateCueId)(G.startTime,G.endTime,G.text);var J=N[F.getAttribute("region")],ee=P[F.getAttribute("style")];G.position=10,G.size=80;var te=p(J,ee,P),oe=te.textAlign;if(oe){var ue=_[oe];ue&&(G.lineAlign=ue),G.align=oe}return L(G,te),G}).filter(function(F){return F!==null})}function v(s,c,m){var f=s.getElementsByTagName(c)[0];return f?[].slice.call(f.querySelectorAll(m)):[]}function i(s){return s.reduce(function(c,m){var f=m.getAttribute("xml:id");return f&&(c[f]=m),c},{})}function d(s,c){return[].slice.call(s.childNodes).reduce(function(m,f,g){var y;return f.nodeName==="br"&&g?m+`
`:(y=f.childNodes)!==null&&y!==void 0&&y.length?d(f,c):c?m+f.textContent.trim().replace(/\s+/g," "):m+f.textContent},"")}function p(s,c,m){var f="http://www.w3.org/ns/ttml#styling",g=null,y=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],R=s!=null&&s.hasAttribute("style")?s.getAttribute("style"):null;return R&&m.hasOwnProperty(R)&&(g=m[R]),y.reduce(function(D,P){var N=T(c,f,P)||T(s,f,P)||T(g,f,P);return N&&(D[P]=N),D},{})}function T(s,c,m){return s&&s.hasAttributeNS(c,m)?s.getAttributeNS(c,m):null}function l(s){return new Error("Could not parse ttml timestamp "+s)}function o(s,c){if(!s)return null;var m=Object(a.parseTimeStamp)(s);return m===null&&(x.test(s)?m=h(s,c):I.test(s)&&(m=E(s,c))),m}function h(s,c){var m=x.exec(s),f=(m[4]|0)+(m[5]|0)/c.subFrameRate;return(m[1]|0)*3600+(m[2]|0)*60+(m[3]|0)+f/c.frameRate}function E(s,c){var m=I.exec(s),f=Number(m[1]),g=m[2];switch(g){case"h":return f*3600;case"m":return f*60;case"ms":return f*1e3;case"f":return f/c.frameRate;case"t":return f/c.tickRate}return f}},"./src/utils/logger.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"enableLogs",function(){return O}),e.d(t,"logger",function(){return L});var n=function(){},a={trace:n,debug:n,log:n,warn:n,info:n,error:n},u=a;function M(A){var x=self.console[A];return x?x.bind(self.console,"["+A+"] >"):n}function C(A){for(var x=arguments.length,I=new Array(x>1?x-1:0),_=1;_<x;_++)I[_-1]=arguments[_];I.forEach(function(b){u[b]=A[b]?A[b].bind(A):M(b)})}function O(A){if(self.console&&A===!0||typeof A=="object"){C(A,"debug","log","info","warn","error");try{u.log()}catch{u=a}}else u=a}var L=u},"./src/utils/mediakeys-helper.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"KeySystems",function(){return n}),e.d(t,"requestMediaKeySystemAccess",function(){return a});var n;(function(u){u.WIDEVINE="com.widevine.alpha",u.PLAYREADY="com.microsoft.playready"})(n||(n={}));var a=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"getMediaSource",function(){return n});function n(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"RemuxerTrackIdConfig",function(){return O}),e.d(t,"bin2str",function(){return L}),e.d(t,"readUint16",function(){return A}),e.d(t,"readUint32",function(){return x}),e.d(t,"readSint32",function(){return I}),e.d(t,"writeUint32",function(){return _}),e.d(t,"findBox",function(){return b}),e.d(t,"parseSegmentIndex",function(){return S}),e.d(t,"parseInitSegment",function(){return v}),e.d(t,"getStartDTS",function(){return i}),e.d(t,"getDuration",function(){return d}),e.d(t,"computeRawDurationFromSamples",function(){return p}),e.d(t,"offsetStartDTS",function(){return T}),e.d(t,"segmentValidRange",function(){return l}),e.d(t,"appendUint8Array",function(){return o}),e.d(t,"parseSamples",function(){return h}),e.d(t,"parseSEIMessageFromNALu",function(){return c}),e.d(t,"parseEmsg",function(){return f});var n=e("./src/utils/typed-array.ts"),a=e("./src/loader/fragment.ts"),u=e("./src/demux/id3.ts"),M=Math.pow(2,32)-1,C=[].push,O={video:1,audio:2,id3:3,text:4};function L(g){return String.fromCharCode.apply(null,g)}function A(g,y){var R=g[y]<<8|g[y+1];return R<0?65536+R:R}function x(g,y){var R=I(g,y);return R<0?4294967296+R:R}function I(g,y){return g[y]<<24|g[y+1]<<16|g[y+2]<<8|g[y+3]}function _(g,y,R){g[y]=R>>24,g[y+1]=R>>16&255,g[y+2]=R>>8&255,g[y+3]=R&255}function b(g,y){var R=[];if(!y.length)return R;for(var D=g.byteLength,P=0;P<D;){var N=x(g,P),B=L(g.subarray(P+4,P+8)),F=N>1?P+N:D;if(B===y[0])if(y.length===1)R.push(g.subarray(P+8,F));else{var H=b(g.subarray(P+8,F),y.slice(1));H.length&&C.apply(R,H)}P=F}return R}function S(g){var y=[],R=g[0],D=8,P=x(g,D);D+=4;var N=0,B=0;R===0?D+=8:D+=16,D+=2;var F=g.length+B,H=A(g,D);D+=2;for(var j=0;j<H;j++){var X=D,$=x(g,X);X+=4;var G=$&2147483647,J=($&2147483648)>>>31;if(J===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var ee=x(g,X);X+=4,y.push({referenceSize:G,subsegmentDuration:ee,info:{duration:ee/P,start:F,end:F+G-1}}),F+=G,X+=4,D=X}return{earliestPresentationTime:N,timescale:P,version:R,referencesCount:H,references:y}}function v(g){for(var y=[],R=b(g,["moov","trak"]),D=0;D<R.length;D++){var P=R[D],N=b(P,["tkhd"])[0];if(N){var B=N[0],F=B===0?12:20,H=x(N,F),j=b(P,["mdia","mdhd"])[0];if(j){B=j[0],F=B===0?12:20;var X=x(j,F),$=b(P,["mdia","hdlr"])[0];if($){var G=L($.subarray(8,12)),J={soun:a.ElementaryStreamTypes.AUDIO,vide:a.ElementaryStreamTypes.VIDEO}[G];if(J){var ee=b(P,["mdia","minf","stbl","stsd"])[0],te=void 0;ee&&(te=L(ee.subarray(12,16))),y[H]={timescale:X,type:J},y[J]={timescale:X,id:H,codec:te}}}}}}var oe=b(g,["moov","mvex","trex"]);return oe.forEach(function(ue){var ne=x(ue,4),he=y[ne];he&&(he.default={duration:x(ue,12),flags:x(ue,20)})}),y}function i(g,y){return b(y,["moof","traf"]).reduce(function(R,D){var P=b(D,["tfdt"])[0],N=P[0],B=b(D,["tfhd"]).reduce(function(F,H){var j=x(H,4),X=g[j];if(X){var $=x(P,4);N===1&&($*=Math.pow(2,32),$+=x(P,8));var G=X.timescale||9e4,J=$/G;if(isFinite(J)&&(F===null||J<F))return J}return F},null);return B!==null&&isFinite(B)&&(R===null||B<R)?B:R},null)||0}function d(g,y){for(var R=0,D=0,P=0,N=b(g,["moof","traf"]),B=0;B<N.length;B++){var F=N[B],H=b(F,["tfhd"])[0],j=x(H,4),X=y[j];if(!!X){var $=X.default,G=x(H,0)|($==null?void 0:$.flags),J=$==null?void 0:$.duration;G&8&&(G&2?J=x(H,12):J=x(H,8));for(var ee=X.timescale||9e4,te=b(F,["trun"]),oe=0;oe<te.length;oe++){if(R=p(te[oe]),!R&&J){var ue=x(te[oe],4);R=J*ue}X.type===a.ElementaryStreamTypes.VIDEO?D+=R/ee:X.type===a.ElementaryStreamTypes.AUDIO&&(P+=R/ee)}}}if(D===0&&P===0){for(var ne=0,he=b(g,["sidx"]),me=0;me<he.length;me++){var ae=S(he[me]);ae!=null&&ae.references&&(ne+=ae.references.reduce(function(Me,Se){return Me+Se.info.duration||0},0))}return ne}return D||P}function p(g){var y=x(g,0),R=8;y&1&&(R+=4),y&4&&(R+=4);for(var D=0,P=x(g,4),N=0;N<P;N++){if(y&256){var B=x(g,R);D+=B,R+=4}y&512&&(R+=4),y&1024&&(R+=4),y&2048&&(R+=4)}return D}function T(g,y,R){b(y,["moof","traf"]).forEach(function(D){b(D,["tfhd"]).forEach(function(P){var N=x(P,4),B=g[N];if(!!B){var F=B.timescale||9e4;b(D,["tfdt"]).forEach(function(H){var j=H[0],X=x(H,4);if(j===0)X-=R*F,X=Math.max(X,0),_(H,4,X);else{X*=Math.pow(2,32),X+=x(H,8),X-=R*F,X=Math.max(X,0);var $=Math.floor(X/(M+1)),G=Math.floor(X%(M+1));_(H,4,$),_(H,8,G)}})}})})}function l(g){var y={valid:null,remainder:null},R=b(g,["moof"]);if(R){if(R.length<2)return y.remainder=g,y}else return y;var D=R[R.length-1];return y.valid=Object(n.sliceUint8)(g,0,D.byteOffset-8),y.remainder=Object(n.sliceUint8)(g,D.byteOffset-8),y}function o(g,y){var R=new Uint8Array(g.length+y.length);return R.set(g),R.set(y,g.length),R}function h(g,y){var R=[],D=y.samples,P=y.timescale,N=y.id,B=!1,F=b(D,["moof"]);return F.map(function(H){var j=H.byteOffset-8,X=b(H,["traf"]);X.map(function($){var G=b($,["tfdt"]).map(function(J){var ee=J[0],te=x(J,4);return ee===1&&(te*=Math.pow(2,32),te+=x(J,8)),te/P})[0];return G!==void 0&&(g=G),b($,["tfhd"]).map(function(J){var ee=x(J,4),te=x(J,0)&16777215,oe=(te&1)!==0,ue=(te&2)!==0,ne=(te&8)!==0,he=0,me=(te&16)!==0,ae=0,Me=(te&32)!==0,Se=8;ee===N&&(oe&&(Se+=8),ue&&(Se+=4),ne&&(he=x(J,Se),Se+=4),me&&(ae=x(J,Se),Se+=4),Me&&(Se+=4),y.type==="video"&&(B=E(y.codec)),b($,["trun"]).map(function(xe){var be=xe[0],Ue=x(xe,0)&16777215,Je=(Ue&1)!==0,Ge=0,rt=(Ue&4)!==0,Ke=(Ue&256)!==0,lt=0,ft=(Ue&512)!==0,ht=0,ut=(Ue&1024)!==0,Mt=(Ue&2048)!==0,it=0,Ct=x(xe,4),Ye=8;Je&&(Ge=x(xe,Ye),Ye+=4),rt&&(Ye+=4);for(var qe=Ge+j,bt=0;bt<Ct;bt++){if(Ke?(lt=x(xe,Ye),Ye+=4):lt=he,ft?(ht=x(xe,Ye),Ye+=4):ht=ae,ut&&(Ye+=4),Mt&&(be===0?it=x(xe,Ye):it=I(xe,Ye),Ye+=4),y.type===a.ElementaryStreamTypes.VIDEO)for(var et=0;et<ht;){var je=x(D,qe);qe+=4;var wt=D[qe]&31;if(s(B,wt)){var vt=D.subarray(qe,qe+je);c(vt,g+it/P,R)}qe+=je,et+=je+4}g+=lt/P}}))})})}),R}function E(g){if(!g)return!1;var y=g.indexOf("."),R=y<0?g:g.substring(0,y);return R==="hvc1"||R==="hev1"||R==="dvh1"||R==="dvhe"}function s(g,y){return g?y===39||y===40:y===6}function c(g,y,R){var D=m(g),P=0;P++;for(var N=0,B=0,F=!1,H=0;P<D.length;){N=0;do{if(P>=D.length)break;H=D[P++],N+=H}while(H===255);B=0;do{if(P>=D.length)break;H=D[P++],B+=H}while(H===255);var j=D.length-P;if(!F&&N===4&&P<D.length){F=!0;var X=D[P++];if(X===181){var $=A(D,P);if(P+=2,$===49){var G=x(D,P);if(P+=4,G===1195456820){var J=D[P++];if(J===3){var ee=D[P++],te=31&ee,oe=64&ee,ue=oe?2+te*3:0,ne=new Uint8Array(ue);if(oe){ne[0]=ee;for(var he=1;he<ue;he++)ne[he]=D[P++]}R.push({type:J,payloadType:N,pts:y,bytes:ne})}}}}}else if(N===5&&B<j){if(F=!0,B>16){for(var me=[],ae=0;ae<16;ae++){var Me=D[P++].toString(16);me.push(Me.length==1?"0"+Me:Me),(ae===3||ae===5||ae===7||ae===9)&&me.push("-")}for(var Se=B-16,xe=new Uint8Array(Se),be=0;be<Se;be++)xe[be]=D[P++];R.push({payloadType:N,pts:y,uuid:me.join(""),userData:Object(u.utf8ArrayToStr)(xe),userDataBytes:xe})}}else if(B<j)P+=B;else if(B>j)break}}function m(g){for(var y=g.byteLength,R=[],D=1;D<y-2;)g[D]===0&&g[D+1]===0&&g[D+2]===3?(R.push(D+2),D+=2):D++;if(R.length===0)return g;var P=y-R.length,N=new Uint8Array(P),B=0;for(D=0;D<P;B++,D++)B===R[0]&&(B++,R.shift()),N[D]=g[B];return N}function f(g){var y=g[0],R="",D="",P=0,N=0,B=0,F=0,H=0,j=0;if(y===0){for(;L(g.subarray(j,j+1))!=="\0";)R+=L(g.subarray(j,j+1)),j+=1;for(R+=L(g.subarray(j,j+1)),j+=1;L(g.subarray(j,j+1))!=="\0";)D+=L(g.subarray(j,j+1)),j+=1;D+=L(g.subarray(j,j+1)),j+=1,P=x(g,12),N=x(g,16),F=x(g,20),H=x(g,24),j=28}else if(y===1){j+=4,P=x(g,j),j+=4;var X=x(g,j);j+=4;var $=x(g,j);for(j+=4,B=Math.pow(2,32)*X+$,Number.isSafeInteger(B)||(B=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),F=x(g,j),j+=4,H=x(g,j),j+=4;L(g.subarray(j,j+1))!=="\0";)R+=L(g.subarray(j,j+1)),j+=1;for(R+=L(g.subarray(j,j+1)),j+=1;L(g.subarray(j,j+1))!=="\0";)D+=L(g.subarray(j,j+1)),j+=1;D+=L(g.subarray(j,j+1)),j+=1}var G=g.subarray(j,g.byteLength);return{schemeIdUri:R,value:D,timeScale:P,presentationTime:B,presentationTimeDelta:N,eventDuration:F,id:H,payload:G}}},"./src/utils/output-filter.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"default",function(){return n});var n=function(){function a(M,C){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=M,this.trackName=C}var u=a.prototype;return u.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},u.newCue=function(C,O,L){(this.startTime===null||this.startTime>C)&&(this.startTime=C),this.endTime=O,this.screen=L,this.timelineController.createCaptionsTrack(this.trackName)},u.reset=function(){this.cueRanges=[],this.startTime=null},a}()},"./src/utils/texttrack-utils.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"sendAddTrackEvent",function(){return a}),e.d(t,"addCueToTrack",function(){return u}),e.d(t,"clearCurrentCues",function(){return M}),e.d(t,"removeCuesInRange",function(){return C}),e.d(t,"getCuesInRange",function(){return L});var n=e("./src/utils/logger.ts");function a(A,x){var I;try{I=new Event("addtrack")}catch{I=document.createEvent("Event"),I.initEvent("addtrack",!1,!1)}I.track=A,x.dispatchEvent(I)}function u(A,x){var I=A.mode;if(I==="disabled"&&(A.mode="hidden"),A.cues&&!A.cues.getCueById(x.id))try{if(A.addCue(x),!A.cues.getCueById(x.id))throw new Error("addCue is failed for: "+x)}catch(b){n.logger.debug("[texttrack-utils]: "+b);var _=new self.TextTrackCue(x.startTime,x.endTime,x.text);_.id=x.id,A.addCue(_)}I==="disabled"&&(A.mode=I)}function M(A){var x=A.mode;if(x==="disabled"&&(A.mode="hidden"),A.cues)for(var I=A.cues.length;I--;)A.removeCue(A.cues[I]);x==="disabled"&&(A.mode=x)}function C(A,x,I,_){var b=A.mode;if(b==="disabled"&&(A.mode="hidden"),A.cues&&A.cues.length>0)for(var S=L(A.cues,x,I),v=0;v<S.length;v++)(!_||_(S[v]))&&A.removeCue(S[v]);b==="disabled"&&(A.mode=b)}function O(A,x){if(x<A[0].startTime)return 0;var I=A.length-1;if(x>A[I].endTime)return-1;for(var _=0,b=I;_<=b;){var S=Math.floor((b+_)/2);if(x<A[S].startTime)b=S-1;else if(x>A[S].startTime&&_<I)_=S+1;else return S}return A[_].startTime-x<x-A[b].startTime?_:b}function L(A,x,I){var _=[],b=O(A,x);if(b>-1)for(var S=b,v=A.length;S<v;S++){var i=A[S];if(i.startTime>=x&&i.endTime<=I)_.push(i);else if(i.startTime>I)return _}return _}},"./src/utils/time-ranges.ts":function(r,t,e){"use strict";e.r(t);var n={toString:function(u){for(var M="",C=u.length,O=0;O<C;O++)M+="["+u.start(O).toFixed(3)+","+u.end(O).toFixed(3)+"]";return M}};t.default=n},"./src/utils/timescale-conversion.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"toTimescaleFromBase",function(){return a}),e.d(t,"toTimescaleFromScale",function(){return u}),e.d(t,"toMsFromMpegTsClock",function(){return M}),e.d(t,"toMpegTsClockFromTimescale",function(){return C});var n=9e4;function a(O,L,A,x){A===void 0&&(A=1),x===void 0&&(x=!1);var I=O*L*A;return x?Math.round(I):I}function u(O,L,A,x){return A===void 0&&(A=1),x===void 0&&(x=!1),a(O,L,1/A,x)}function M(O,L){return L===void 0&&(L=!1),a(O,1e3,1/n,L)}function C(O,L){return L===void 0&&(L=1),a(O,n,1/L)}},"./src/utils/typed-array.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"sliceUint8",function(){return n});function n(a,u,M){return Uint8Array.prototype.slice?a.slice(u,M):new Uint8Array(Array.prototype.slice.call(a,u,M))}},"./src/utils/vttcue.ts":function(r,t,e){"use strict";e.r(t),t.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var n=["","lr","rl"],a=["start","middle","end","left","right"];function u(A,x){if(typeof x!="string"||!Array.isArray(A))return!1;var I=x.toLowerCase();return~A.indexOf(I)?I:!1}function M(A){return u(n,A)}function C(A){return u(a,A)}function O(A){for(var x=arguments.length,I=new Array(x>1?x-1:0),_=1;_<x;_++)I[_-1]=arguments[_];for(var b=1;b<arguments.length;b++){var S=arguments[b];for(var v in S)A[v]=S[v]}return A}function L(A,x,I){var _=this,b={enumerable:!0};_.hasBeenReset=!1;var S="",v=!1,i=A,d=x,p=I,T=null,l="",o=!0,h="auto",E="start",s=50,c="middle",m=50,f="middle";Object.defineProperty(_,"id",O({},b,{get:function(){return S},set:function(y){S=""+y}})),Object.defineProperty(_,"pauseOnExit",O({},b,{get:function(){return v},set:function(y){v=!!y}})),Object.defineProperty(_,"startTime",O({},b,{get:function(){return i},set:function(y){if(typeof y!="number")throw new TypeError("Start time must be set to a number.");i=y,this.hasBeenReset=!0}})),Object.defineProperty(_,"endTime",O({},b,{get:function(){return d},set:function(y){if(typeof y!="number")throw new TypeError("End time must be set to a number.");d=y,this.hasBeenReset=!0}})),Object.defineProperty(_,"text",O({},b,{get:function(){return p},set:function(y){p=""+y,this.hasBeenReset=!0}})),Object.defineProperty(_,"region",O({},b,{get:function(){return T},set:function(y){T=y,this.hasBeenReset=!0}})),Object.defineProperty(_,"vertical",O({},b,{get:function(){return l},set:function(y){var R=M(y);if(R===!1)throw new SyntaxError("An invalid or illegal string was specified.");l=R,this.hasBeenReset=!0}})),Object.defineProperty(_,"snapToLines",O({},b,{get:function(){return o},set:function(y){o=!!y,this.hasBeenReset=!0}})),Object.defineProperty(_,"line",O({},b,{get:function(){return h},set:function(y){if(typeof y!="number"&&y!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");h=y,this.hasBeenReset=!0}})),Object.defineProperty(_,"lineAlign",O({},b,{get:function(){return E},set:function(y){var R=C(y);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");E=R,this.hasBeenReset=!0}})),Object.defineProperty(_,"position",O({},b,{get:function(){return s},set:function(y){if(y<0||y>100)throw new Error("Position must be between 0 and 100.");s=y,this.hasBeenReset=!0}})),Object.defineProperty(_,"positionAlign",O({},b,{get:function(){return c},set:function(y){var R=C(y);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");c=R,this.hasBeenReset=!0}})),Object.defineProperty(_,"size",O({},b,{get:function(){return m},set:function(y){if(y<0||y>100)throw new Error("Size must be between 0 and 100.");m=y,this.hasBeenReset=!0}})),Object.defineProperty(_,"align",O({},b,{get:function(){return f},set:function(y){var R=C(y);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");f=R,this.hasBeenReset=!0}})),_.displayState=void 0}return L.prototype.getCueAsHTML=function(){var A=self.WebVTT;return A.convertCueToDOMTree(self,this.text)},L}()},"./src/utils/vttparser.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"parseTimeStamp",function(){return u}),e.d(t,"fixLineBreaks",function(){return x}),e.d(t,"VTTParser",function(){return I});var n=e("./src/utils/vttcue.ts"),a=function(){function _(){}var b=_.prototype;return b.decode=function(v,i){if(!v)return"";if(typeof v!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(v))},_}();function u(_){function b(v,i,d,p){return(v|0)*3600+(i|0)*60+(d|0)+parseFloat(p||0)}var S=_.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return S?parseFloat(S[2])>59?b(S[2],S[3],0,S[4]):b(S[1],S[2],S[3],S[4]):null}var M=function(){function _(){this.values=Object.create(null)}var b=_.prototype;return b.set=function(v,i){!this.get(v)&&i!==""&&(this.values[v]=i)},b.get=function(v,i,d){return d?this.has(v)?this.values[v]:i[d]:this.has(v)?this.values[v]:i},b.has=function(v){return v in this.values},b.alt=function(v,i,d){for(var p=0;p<d.length;++p)if(i===d[p]){this.set(v,i);break}},b.integer=function(v,i){/^-?\d+$/.test(i)&&this.set(v,parseInt(i,10))},b.percent=function(v,i){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(i)){var d=parseFloat(i);if(d>=0&&d<=100)return this.set(v,d),!0}return!1},_}();function C(_,b,S,v){var i=v?_.split(v):[_];for(var d in i)if(typeof i[d]=="string"){var p=i[d].split(S);if(p.length===2){var T=p[0],l=p[1];b(T,l)}}}var O=new n.default(0,0,""),L=O.align==="middle"?"middle":"center";function A(_,b,S){var v=_;function i(){var T=u(_);if(T===null)throw new Error("Malformed timestamp: "+v);return _=_.replace(/^[^\sa-zA-Z-]+/,""),T}function d(T,l){var o=new M;C(T,function(s,c){var m;switch(s){case"region":for(var f=S.length-1;f>=0;f--)if(S[f].id===c){o.set(s,S[f].region);break}break;case"vertical":o.alt(s,c,["rl","lr"]);break;case"line":m=c.split(","),o.integer(s,m[0]),o.percent(s,m[0])&&o.set("snapToLines",!1),o.alt(s,m[0],["auto"]),m.length===2&&o.alt("lineAlign",m[1],["start",L,"end"]);break;case"position":m=c.split(","),o.percent(s,m[0]),m.length===2&&o.alt("positionAlign",m[1],["start",L,"end","line-left","line-right","auto"]);break;case"size":o.percent(s,c);break;case"align":o.alt(s,c,["start",L,"end","left","right"]);break}},/:/,/\s/),l.region=o.get("region",null),l.vertical=o.get("vertical","");var h=o.get("line","auto");h==="auto"&&O.line===-1&&(h=-1),l.line=h,l.lineAlign=o.get("lineAlign","start"),l.snapToLines=o.get("snapToLines",!0),l.size=o.get("size",100),l.align=o.get("align",L);var E=o.get("position","auto");E==="auto"&&O.position===50&&(E=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=E}function p(){_=_.replace(/^\s+/,"")}if(p(),b.startTime=i(),p(),_.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+v);_=_.slice(3),p(),b.endTime=i(),p(),d(_,b)}function x(_){return _.replace(/<br(?: \/)?>/gi,`
`)}var I=function(){function _(){this.state="INITIAL",this.buffer="",this.decoder=new a,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var b=_.prototype;return b.parse=function(v){var i=this;v&&(i.buffer+=i.decoder.decode(v,{stream:!0}));function d(){var E=i.buffer,s=0;for(E=x(E);s<E.length&&E[s]!=="\r"&&E[s]!==`
`;)++s;var c=E.slice(0,s);return E[s]==="\r"&&++s,E[s]===`
`&&++s,i.buffer=E.slice(s),c}function p(E){C(E,function(s,c){},/:/)}try{var T="";if(i.state==="INITIAL"){if(!/\r\n|\n/.test(i.buffer))return this;T=d();var l=T.match(/^()?WEBVTT([ \t].*)?$/);if(!l||!l[0])throw new Error("Malformed WebVTT signature.");i.state="HEADER"}for(var o=!1;i.buffer;){if(!/\r\n|\n/.test(i.buffer))return this;switch(o?o=!1:T=d(),i.state){case"HEADER":/:/.test(T)?p(T):T||(i.state="ID");continue;case"NOTE":T||(i.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(T)){i.state="NOTE";break}if(!T)continue;if(i.cue=new n.default(0,0,""),i.state="CUE",T.indexOf("-->")===-1){i.cue.id=T;continue}case"CUE":if(!i.cue){i.state="BADCUE";continue}try{A(T,i.cue,i.regionList)}catch{i.cue=null,i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":{var h=T.indexOf("-->")!==-1;if(!T||h&&(o=!0)){i.oncue&&i.cue&&i.oncue(i.cue),i.cue=null,i.state="ID";continue}if(i.cue===null)continue;i.cue.text&&(i.cue.text+=`
`),i.cue.text+=T}continue;case"BADCUE":T||(i.state="ID")}}}catch{i.state==="CUETEXT"&&i.cue&&i.oncue&&i.oncue(i.cue),i.cue=null,i.state=i.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},b.flush=function(){var v=this;try{if((v.cue||v.state==="HEADER")&&(v.buffer+=`

`,v.parse()),v.state==="INITIAL"||v.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(i){v.onparsingerror&&v.onparsingerror(i)}return v.onflush&&v.onflush(),this},_}()},"./src/utils/webvtt-parser.ts":function(r,t,e){"use strict";e.r(t),e.d(t,"generateCueId",function(){return I}),e.d(t,"parseWebVTT",function(){return b});var n=e("./src/polyfills/number.ts"),a=e("./src/utils/vttparser.ts"),u=e("./src/demux/id3.ts"),M=e("./src/utils/timescale-conversion.ts"),C=e("./src/remux/mp4-remuxer.ts"),O=/\r\n|\n\r|\n|\r/g,L=function(v,i,d){return d===void 0&&(d=0),v.slice(d,d+i.length)===i},A=function(v){var i=parseInt(v.slice(-3)),d=parseInt(v.slice(-6,-4)),p=parseInt(v.slice(-9,-7)),T=v.length>9?parseInt(v.substring(0,v.indexOf(":"))):0;if(!Object(n.isFiniteNumber)(i)||!Object(n.isFiniteNumber)(d)||!Object(n.isFiniteNumber)(p)||!Object(n.isFiniteNumber)(T))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+v);return i+=1e3*d,i+=60*1e3*p,i+=60*60*1e3*T,i},x=function(v){for(var i=5381,d=v.length;d;)i=i*33^v.charCodeAt(--d);return(i>>>0).toString()};function I(S,v,i){return x(S.toString())+x(v.toString())+x(i)}var _=function(v,i,d){var p=v[i],T=v[p.prevCC];if(!T||!T.new&&p.new){v.ccOffset=v.presentationOffset=p.start,p.new=!1;return}for(;(l=T)!==null&&l!==void 0&&l.new;){var l;v.ccOffset+=p.start-T.start,p.new=!1,p=T,T=v[p.prevCC]}v.presentationOffset=d};function b(S,v,i,d,p,T,l,o){var h=new a.VTTParser,E=Object(u.utf8ArrayToStr)(new Uint8Array(S)).trim().replace(O,`
`).split(`
`),s=[],c=Object(M.toMpegTsClockFromTimescale)(v,i),m="00:00.000",f=0,g=0,y,R=!0;h.oncue=function(D){var P=d[p],N=d.ccOffset,B=(f-c)/9e4;P!=null&&P.new&&(g!==void 0?N=d.ccOffset=P.start:_(d,p,B)),B&&(N=B-d.presentationOffset);var F=D.endTime-D.startTime,H=Object(C.normalizePts)((D.startTime+N-g)*9e4,T*9e4)/9e4;D.startTime=Math.max(H,0),D.endTime=Math.max(H+F,0);var j=D.text.trim();D.text=decodeURIComponent(encodeURIComponent(j)),D.id||(D.id=I(D.startTime,D.endTime,j)),D.endTime>0&&s.push(D)},h.onparsingerror=function(D){y=D},h.onflush=function(){if(y){o(y);return}l(s)},E.forEach(function(D){if(R)if(L(D,"X-TIMESTAMP-MAP=")){R=!1,D.slice(16).split(",").forEach(function(P){L(P,"LOCAL:")?m=P.slice(6):L(P,"MPEGTS:")&&(f=parseInt(P.slice(7)))});try{g=A(m)/1e3}catch(P){y=P}return}else D===""&&(R=!1);h.parse(D+`
`)}),h.flush()}},"./src/utils/xhr-loader.ts":function(r,t,e){"use strict";e.r(t);var n=e("./src/utils/logger.ts"),a=e("./src/loader/load-stats.ts"),u=/^age:\s*[\d.]+\s*$/m,M=function(){function C(L){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=L?L.xhrSetup:null,this.stats=new a.LoadStats,this.retryDelay=0}var O=C.prototype;return O.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},O.abortInternal=function(){var A=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),A&&(A.onreadystatechange=null,A.onprogress=null,A.readyState!==4&&(this.stats.aborted=!0,A.abort()))},O.abort=function(){var A;this.abortInternal(),(A=this.callbacks)!==null&&A!==void 0&&A.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},O.load=function(A,x,I){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=A,this.config=x,this.callbacks=I,this.retryDelay=x.retryDelay,this.loadInternal()},O.loadInternal=function(){var A=this.config,x=this.context;if(!!A){var I=this.loader=new self.XMLHttpRequest,_=this.stats;_.loading.first=0,_.loaded=0;var b=this.xhrSetup;try{if(b)try{b(I,x.url)}catch{I.open("GET",x.url,!0),b(I,x.url)}I.readyState||I.open("GET",x.url,!0);var S=this.context.headers;if(S)for(var v in S)I.setRequestHeader(v,S[v])}catch(i){this.callbacks.onError({code:I.status,text:i.message},x,I);return}x.rangeEnd&&I.setRequestHeader("Range","bytes="+x.rangeStart+"-"+(x.rangeEnd-1)),I.onreadystatechange=this.readystatechange.bind(this),I.onprogress=this.loadprogress.bind(this),I.responseType=x.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),A.timeout),I.send()}},O.readystatechange=function(){var A=this.context,x=this.loader,I=this.stats;if(!(!A||!x)){var _=x.readyState,b=this.config;if(!I.aborted&&_>=2)if(self.clearTimeout(this.requestTimeout),I.loading.first===0&&(I.loading.first=Math.max(self.performance.now(),I.loading.start)),_===4){x.onreadystatechange=null,x.onprogress=null;var S=x.status;if(S>=200&&S<300){I.loading.end=Math.max(self.performance.now(),I.loading.first);var v,i;if(A.responseType==="arraybuffer"?(v=x.response,i=v.byteLength):(v=x.responseText,i=v.length),I.loaded=I.total=i,!this.callbacks)return;var d=this.callbacks.onProgress;if(d&&d(I,A,v,x),!this.callbacks)return;var p={url:x.responseURL,data:v};this.callbacks.onSuccess(p,I,A,x)}else I.retry>=b.maxRetry||S>=400&&S<499?(n.logger.error(S+" while loading "+A.url),this.callbacks.onError({code:S,text:x.statusText},A,x)):(n.logger.warn(S+" while loading "+A.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,b.maxRetryDelay),I.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),b.timeout)}},O.loadtimeout=function(){n.logger.warn("timeout while loading "+this.context.url);var A=this.callbacks;A&&(this.abortInternal(),A.onTimeout(this.stats,this.context,this.loader))},O.loadprogress=function(A){var x=this.stats;x.loaded=A.loaded,A.lengthComputable&&(x.total=A.total)},O.getCacheAge=function(){var A=null;if(this.loader&&u.test(this.loader.getAllResponseHeaders())){var x=this.loader.getResponseHeader("age");A=x?parseFloat(x):null}return A},C}();t.default=M}}).default})});var Wr=class{addEventListener(){}removeEventListener(){}dispatchEvent(t){return!0}};if(typeof DocumentFragment=="undefined"){class r extends Wr{}globalThis.DocumentFragment=r}var pi=class extends Wr{},Ca=class extends Wr{},Od={get(r){},define(r,t,e){},upgrade(r){},whenDefined(r){return Promise.resolve(pi)}},Ei,Oa=class{constructor(t,e={}){Fe(this,Ei,void 0);pt(this,Ei,e==null?void 0:e.detail)}get detail(){return _e(this,Ei)}initCustomEvent(){}};Ei=new WeakMap;function Pd(r,t){return new pi}var go={document:{createElement:Pd},DocumentFragment,customElements:Od,CustomEvent:Oa,EventTarget:Wr,HTMLElement:pi,HTMLVideoElement:Ca},po=typeof window=="undefined"||typeof globalThis.customElements=="undefined",Qe=po?go:globalThis,Et=po?go.document:globalThis.document;var fe={MEDIA_PLAY_REQUEST:"mediaplayrequest",MEDIA_PAUSE_REQUEST:"mediapauserequest",MEDIA_MUTE_REQUEST:"mediamuterequest",MEDIA_UNMUTE_REQUEST:"mediaunmuterequest",MEDIA_VOLUME_REQUEST:"mediavolumerequest",MEDIA_SEEK_REQUEST:"mediaseekrequest",MEDIA_AIRPLAY_REQUEST:"mediaairplayrequest",MEDIA_ENTER_FULLSCREEN_REQUEST:"mediaenterfullscreenrequest",MEDIA_EXIT_FULLSCREEN_REQUEST:"mediaexitfullscreenrequest",MEDIA_PREVIEW_REQUEST:"mediapreviewrequest",MEDIA_ENTER_PIP_REQUEST:"mediaenterpiprequest",MEDIA_EXIT_PIP_REQUEST:"mediaexitpiprequest",MEDIA_ENTER_CAST_REQUEST:"mediaentercastrequest",MEDIA_EXIT_CAST_REQUEST:"mediaexitcastrequest",MEDIA_SHOW_TEXT_TRACKS_REQUEST:"mediashowtexttracksrequest",MEDIA_HIDE_TEXT_TRACKS_REQUEST:"mediahidetexttracksrequest",MEDIA_SHOW_CAPTIONS_REQUEST:"mediashowcaptionsrequest",MEDIA_SHOW_SUBTITLES_REQUEST:"mediashowsubtitlesrequest",MEDIA_DISABLE_CAPTIONS_REQUEST:"mediadisablecaptionsrequest",MEDIA_DISABLE_SUBTITLES_REQUEST:"mediadisablesubtitlesrequest",MEDIA_PLAYBACK_RATE_REQUEST:"mediaplaybackraterequest",REGISTER_MEDIA_STATE_RECEIVER:"registermediastatereceiver",UNREGISTER_MEDIA_STATE_RECEIVER:"unregistermediastatereceiver"},yi={MEDIA_AIRPLAY_UNAVAILABLE:"mediaairplayunavailablechange",MEDIA_PIP_UNAVAILABLE:"mediapipunavailablechange",MEDIA_PAUSED:"mediapausedchange",MEDIA_HAS_PLAYED:"mediahasplayedchange",MEDIA_MUTED:"mediamutedchange",MEDIA_VOLUME_LEVEL:"mediavolumelevelchange",MEDIA_VOLUME:"mediavolumechange",MEDIA_VOLUME_UNAVAILABLE:"mediavolumeunavailablechange",MEDIA_IS_PIP:"mediaispipchange",MEDIA_IS_CASTING:"mediaiscastingchange",MEDIA_CAPTIONS_LIST:"mediacaptionslistchange",MEDIA_SUBTITLES_LIST:"mediasubtitleslistchange",MEDIA_CAPTIONS_SHOWING:"mediacaptionsshowingchange",MEDIA_SUBTITLES_SHOWING:"mediasubtitlesshowingchange",MEDIA_IS_FULLSCREEN:"mediaisfullscreenchange",MEDIA_PLAYBACK_RATE:"mediaplaybackratechange",MEDIA_CURRENT_TIME:"mediacurrenttimechange",MEDIA_DURATION:"mediadurationchange",MEDIA_SEEKABLE:"mediaseekablechange",MEDIA_PREVIEW_IMAGE:"mediapreviewimagechange",MEDIA_PREVIEW_COORDS:"mediapreviewcoordschange",MEDIA_LOADING:"medialoadingchange",USER_INACTIVE:"userinactivechange"},Le={MEDIA_CHROME_ATTRIBUTES:"media-chrome-attributes",MEDIA_CONTROLLER:"media-controller"},V={MEDIA_AIRPLAY_UNAVAILABLE:"media-airplay-unavailable",MEDIA_FULLSCREEN_UNAVAILABLE:"media-fullscreen-unavailable",MEDIA_PIP_UNAVAILABLE:"media-pip-unavailable",MEDIA_CAST_UNAVAILABLE:"media-cast-unavailable",MEDIA_PAUSED:"media-paused",MEDIA_HAS_PLAYED:"media-has-played",MEDIA_MUTED:"media-muted",MEDIA_VOLUME_LEVEL:"media-volume-level",MEDIA_VOLUME:"media-volume",MEDIA_VOLUME_UNAVAILABLE:"media-volume-unavailable",MEDIA_IS_PIP:"media-is-pip",MEDIA_IS_CASTING:"media-is-casting",MEDIA_CAPTIONS_LIST:"media-captions-list",MEDIA_SUBTITLES_LIST:"media-subtitles-list",MEDIA_CAPTIONS_SHOWING:"media-captions-showing",MEDIA_SUBTITLES_SHOWING:"media-subtitles-showing",MEDIA_IS_FULLSCREEN:"media-is-fullscreen",MEDIA_PLAYBACK_RATE:"media-playback-rate",MEDIA_CURRENT_TIME:"media-current-time",MEDIA_DURATION:"media-duration",MEDIA_SEEKABLE:"media-seekable",MEDIA_PREVIEW_TIME:"media-preview-time",MEDIA_PREVIEW_IMAGE:"media-preview-image",MEDIA_PREVIEW_COORDS:"media-preview-coords",MEDIA_LOADING:"media-loading",MEDIA_BUFFERED:"media-buffered",MEDIA_STREAM_TYPE:"media-stream-type"},yh=Object.entries(yi).reduce((r,[t,e])=>{let n=V[t];return n&&(r[e]=n),r},{userinactivechange:"user-inactive"}),Eo=Object.entries(V).reduce((r,[t,e])=>{let n=yi[t];return n&&(r[e]=n),r},{"user-inactive":"userinactivechange"}),Hr={SUBTITLES:"subtitles",CAPTIONS:"captions",DESCRIPTIONS:"descriptions",CHAPTERS:"chapters",METADATA:"metadata"},Sr={DISABLED:"disabled",HIDDEN:"hidden",SHOWING:"showing"};var Pa={MOUSE:"mouse",PEN:"pen",TOUCH:"touch"},Ft={UNAVAILABLE:"unavailable",UNSUPPORTED:"unsupported"},sn={LIVE:"live",ON_DEMAND:"on-demand"};var dt={AUDIO_PLAYER:()=>"audio player",VIDEO_PLAYER:()=>"video player",VOLUME:()=>"volume",SEEK:()=>"seek",CLOSED_CAPTIONS:()=>"closed captions",PLAYBACK_RATE:({playbackRate:r=1}={})=>`current playback rate ${r}`,PLAYBACK_TIME:()=>"playback time",MEDIA_LOADING:()=>"media loading"},Xe={PLAY:()=>"play",PAUSE:()=>"pause",MUTE:()=>"mute",UNMUTE:()=>"unmute",AIRPLAY:()=>"air play",ENTER_CAST:()=>"start casting",EXIT_CAST:()=>"stop casting",ENTER_FULLSCREEN:()=>"enter fullscreen mode",EXIT_FULLSCREEN:()=>"exit fullscreen mode",ENTER_PIP:()=>"enter picture in picture mode",EXIT_PIP:()=>"exit picture in picture mode",SEEK_FORWARD_N_SECS:({seekOffset:r=30}={})=>`seek forward ${r} seconds`,SEEK_BACK_N_SECS:({seekOffset:r=30}={})=>`seek back ${r} seconds`},wd={...dt,...Xe};function on(r,t=!1){return r.split("_").map(function(e,n){return(n||t?e[0].toUpperCase():e[0].toLowerCase())+e.slice(1).toLowerCase()}).join("")}function ka(r){return r.replace(/[-_]([a-z])/g,(t,e)=>e.toUpperCase())}function yo(r){return typeof r=="number"&&!Number.isNaN(r)&&Number.isFinite(r)}function To(r){return typeof r!="string"?!1:!isNaN(r)&&!isNaN(parseFloat(r))}var bo=[{singular:"hour",plural:"hours"},{singular:"minute",plural:"minutes"},{singular:"second",plural:"seconds"}],Ud=(r,t)=>{let e=r===1?bo[t].singular:bo[t].plural;return`${r} ${e}`},xr=r=>{if(!yo(r))return"";let t=Math.abs(r),e=t!==r,n=new Date(0,0,0,0,0,t,0);return`${[n.getHours(),n.getMinutes(),n.getSeconds()].map((C,O)=>C&&Ud(C,O)).filter(C=>C).join(", ")}${e?" remaining":""}`};function Xt(r,t){let e=!1;r<0&&(e=!0,r=0-r),r=r<0?0:r;let n=Math.floor(r%60),a=Math.floor(r/60%60),u=Math.floor(r/3600),M=Math.floor(t/60%60),C=Math.floor(t/3600);return(isNaN(r)||r===1/0)&&(u=a=n="-"),u=u>0||C>0?u+":":"",a=((u||M>=10)&&a<10?"0"+a:a)+":",n=n<10?"0"+n:n,(e?"-":"")+u+a+n}var ln=class{addEventListener(){}removeEventListener(){}dispatchEvent(){return!0}},Ao={HTMLElement:class extends ln{},DocumentFragment:class extends ln{},customElements:{get:function(){},define:function(){},whenDefined:function(){}},CustomEvent:function(){}},Bd={createElement:function(){return new Ao.HTMLElement}},_o=typeof window=="undefined"||typeof window.customElements=="undefined",ie=_o?Ao:window,re=_o?Bd:window.document;function ce(r,t){ie.customElements.get(r)||(ie.customElements.define(r,t),ie[t.name]=t)}var Fd=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)},Lr=(r,t,e)=>(Fd(r,t,"read from private field"),e?e.call(r):t.get(r)),wa=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},un,Gr,Ua,So=re.createElement("template");So.innerHTML=`
<style>
  :host {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    vertical-align: middle;
    box-sizing: border-box;
    background: var(--media-control-background, rgba(20,20,30, 0.7));

    padding: var(--media-control-padding, 10px);

    
    font-size: 14px;
    line-height: var(--media-text-content-height, var(--media-control-height, 24px));
    font-weight: bold;
    color: #fff;

    transition: background 0.15s linear;

    pointer-events: auto;
    cursor: pointer;
    font-family: Arial, sans-serif;
  }

  
  :host(:focus-visible) {
    box-shadow: inset 0 0 0 2px rgba(27, 127, 204, 0.9);
    outline: 0;
  }
  
  :host(:where(:focus)) {
    box-shadow: none;
    outline: 0;
  }

  :host(:hover) {
    background: var(--media-control-hover-background, rgba(50,50,70, 0.7));
  }

  svg, img, ::slotted(svg), ::slotted(img) {
    width: var(--media-button-icon-width);
    height: var(--media-button-icon-height, var(--media-control-height, 24px));
    transform: var(--media-button-icon-transform);
    transition: var(--media-button-icon-transition);
    fill: var(--media-icon-color, #eee);
    vertical-align: middle;
    max-width: 100%;
    max-height: 100%;
    min-width: 100%;
  }
</style>
`;var dn=class extends ie.HTMLElement{constructor(t={}){super(),wa(this,un,u=>{this.handleClick(u)}),wa(this,Gr,u=>{let{key:M}=u;if(!this.keysUsed.includes(M)){this.removeEventListener("keyup",Lr(this,Gr));return}this.handleClick(u)}),wa(this,Ua,u=>{let{metaKey:M,altKey:C,key:O}=u;if(M||C||!this.keysUsed.includes(O)){this.removeEventListener("keyup",Lr(this,Gr));return}this.addEventListener("keyup",Lr(this,Gr),{once:!0})});let e=this.attachShadow({mode:"open"}),n=So.content.cloneNode(!0);this.nativeEl=n;let a=t.slotTemplate;a||(a=re.createElement("template"),a.innerHTML=`<slot>${t.defaultContent||""}</slot>`),this.nativeEl.appendChild(a.content.cloneNode(!0)),e.appendChild(n)}static get observedAttributes(){return["disabled",Le.MEDIA_CONTROLLER]}enable(){this.addEventListener("click",Lr(this,un)),this.addEventListener("keydown",Lr(this,Ua)),this.setAttribute("tabindex","0")}disable(){this.removeEventListener("click",Lr(this,un)),this.removeEventListener("keyup",Lr(this,Gr)),this.removeAttribute("tabindex")}attributeChangedCallback(t,e,n){var a,u;if(t===Le.MEDIA_CONTROLLER){if(e){let M=re.getElementById(e);(a=M==null?void 0:M.unassociateElement)==null||a.call(M,this)}if(n){let M=re.getElementById(n);(u=M==null?void 0:M.associateElement)==null||u.call(M,this)}}else t==="disabled"&&n!==e&&(n==null?this.enable():this.disable())}connectedCallback(){var t;this.hasAttribute("disabled")||this.enable(),this.setAttribute("role","button");let e=this.getAttribute(Le.MEDIA_CONTROLLER);if(e){let n=re.getElementById(e);(t=n==null?void 0:n.associateElement)==null||t.call(n,this)}}disconnectedCallback(){var t;this.disable();let e=this.getAttribute(Le.MEDIA_CONTROLLER);if(e){let n=re.getElementById(e);(t=n==null?void 0:n.unassociateElement)==null||t.call(n,this)}}get keysUsed(){return["Enter"," "]}handleClick(t){}};un=new WeakMap;Gr=new WeakMap;Ua=new WeakMap;ce("media-chrome-button",dn);var Ze=dn;var Kd=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M22.13 3H3.87a.87.87 0 0 0-.87.87v13.26a.87.87 0 0 0 .87.87h3.4L9 16H5V5h16v11h-4l1.72 2h3.4a.87.87 0 0 0 .87-.87V3.87a.87.87 0 0 0-.86-.87Zm-8.75 11.44a.5.5 0 0 0-.76 0l-4.91 5.73a.5.5 0 0 0 .38.83h9.82a.501.501 0 0 0 .38-.83l-4.91-5.73Z"/>
</svg>
`,xo=re.createElement("template");xo.innerHTML=`
  <slot name="airplay">${Kd}</slot>
`;var Na=class extends Ze{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_AIRPLAY_UNAVAILABLE]}constructor(t={}){super({slotTemplate:xo,...t})}connectedCallback(){this.setAttribute("aria-label",Xe.AIRPLAY()),super.connectedCallback()}handleClick(){let t=new ie.CustomEvent(fe.MEDIA_AIRPLAY_REQUEST,{composed:!0,bubbles:!0});this.dispatchEvent(t)}};ce("media-airplay-button",Na);var Wd='<svg aria-hidden="true" viewBox="0 0 24 24"><g><path class="cast_caf_icon_arch0" d="M1,18 L1,21 L4,21 C4,19.3 2.66,18 1,18 L1,18 Z"/><path class="cast_caf_icon_arch1" d="M1,14 L1,16 C3.76,16 6,18.2 6,21 L8,21 C8,17.13 4.87,14 1,14 L1,14 Z"/><path class="cast_caf_icon_arch2" d="M1,10 L1,12 C5.97,12 10,16.0 10,21 L12,21 C12,14.92 7.07,10 1,10 L1,10 Z"/><path class="cast_caf_icon_box" d="M21,3 L3,3 C1.9,3 1,3.9 1,5 L1,8 L3,8 L3,5 L21,5 L21,19 L14,19 L14,21 L21,21 C22.1,21 23,20.1 23,19 L23,5 C23,3.9 22.1,3 21,3 L21,3 Z"/></g></svg>',Hd='<svg aria-hidden="true" viewBox="0 0 24 24"><g><path class="cast_caf_icon_arch0" d="M1,18 L1,21 L4,21 C4,19.3 2.66,18 1,18 L1,18 Z"/><path class="cast_caf_icon_arch1" d="M1,14 L1,16 C3.76,16 6,18.2 6,21 L8,21 C8,17.13 4.87,14 1,14 L1,14 Z"/><path class="cast_caf_icon_arch2" d="M1,10 L1,12 C5.97,12 10,16.0 10,21 L12,21 C12,14.92 7.07,10 1,10 L1,10 Z"/><path class="cast_caf_icon_box" d="M21,3 L3,3 C1.9,3 1,3.9 1,5 L1,8 L3,8 L3,5 L21,5 L21,19 L14,19 L14,21 L21,21 C22.1,21 23,20.1 23,19 L23,5 C23,3.9 22.1,3 21,3 L21,3 Z"/><path class="cast_caf_icon_boxfill" d="M5,7 L5,8.63 C8,8.6 13.37,14 13.37,17 L19,17 L19,7 Z"/></g></svg>',Do=re.createElement("template");Do.innerHTML=`
  <style>
  :host([${V.MEDIA_IS_CASTING}]) slot:not([name=exit]) > *,
  :host([${V.MEDIA_IS_CASTING}]) ::slotted(:not([slot=exit])) {
    display: none !important;
  }

  
  :host(:not([${V.MEDIA_IS_CASTING}])) slot:not([name=enter]) > *,
  :host(:not([${V.MEDIA_IS_CASTING}])) ::slotted(:not([slot=enter])) {
    display: none !important;
  }
  </style>

  <slot name="enter">${Wd}</slot>
  <slot name="exit">${Hd}</slot>
`;var Lo=r=>{let e=r.getAttribute(V.MEDIA_IS_CASTING)!=null?Xe.EXIT_CAST():Xe.ENTER_CAST();r.setAttribute("aria-label",e)},Ba=class extends Ze{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_IS_CASTING,V.MEDIA_CAST_UNAVAILABLE]}constructor(t={}){super({slotTemplate:Do,...t})}connectedCallback(){Lo(this),super.connectedCallback()}attributeChangedCallback(t,e,n){t===V.MEDIA_IS_CASTING&&Lo(this),super.attributeChangedCallback(t,e,n)}handleClick(){let t=this.getAttribute(V.MEDIA_IS_CASTING)!=null?fe.MEDIA_EXIT_CAST_REQUEST:fe.MEDIA_ENTER_CAST_REQUEST;this.dispatchEvent(new ie.CustomEvent(t,{composed:!0,bubbles:!0}))}};ce("media-cast-button",Ba);var cn=(r,t,e=".value")=>{let n=r.querySelector(e);!n||(n.textContent=t)},Gd=(r,t)=>{let e=`slot[name="${t}"]`,n=r.shadowRoot.querySelector(e);return n?n.children:[]},fn=(r,t)=>Gd(r,t)[0],Ti=(r,t)=>!r||!t?!1:r.contains(t)?!0:Ti(r,t.getRootNode().host),bi=(r,t)=>{if(!r)return null;let e=r.closest(t);return e||bi(r.getRootNode().host,t)};function qt(r,t){var e;let n;for(n of r.querySelectorAll("style")){let a;try{a=(e=n.sheet)==null?void 0:e.cssRules}catch{continue}for(let u of a!=null?a:[])if(u.selectorText===t)return u}return n!=null&&n.sheet?(n.sheet.insertRule(`${t}{}`,n.sheet.cssRules.length),n.sheet.cssRules[n.sheet.cssRules.length-1]):{style:{setProperty:()=>{}}}}var Ro=re.createElement("template");Ro.innerHTML=`
<style>
  :host {
    display: inline-block;
    box-sizing: border-box;
  }
</style>
`;var Fa=class extends ie.HTMLElement{static get observedAttributes(){return[Le.MEDIA_CONTROLLER,V.MEDIA_PAUSED]}constructor(t={}){super();let e=this.attachShadow({mode:"open"}),n=Ro.content.cloneNode(!0);this.nativeEl=n;let a=t.slotTemplate;a||(a=re.createElement("template"),a.innerHTML=`<slot>${t.defaultContent||""}</slot>`),this.nativeEl.appendChild(a.content.cloneNode(!0)),e.appendChild(n)}attributeChangedCallback(t,e,n){var a,u;if(t===Le.MEDIA_CONTROLLER){if(e){let M=re.getElementById(e);(a=M==null?void 0:M.unassociateElement)==null||a.call(M,this)}if(n){let M=re.getElementById(n);(u=M==null?void 0:M.associateElement)==null||u.call(M,this)}}}connectedCallback(){var t;this.setAttribute("tabindex",-1),this.setAttribute("aria-hidden",!0);let e=Io(this);this.getAttribute(Le.MEDIA_CONTROLLER)&&((t=e==null?void 0:e.associateElement)==null||t.call(e,this)),e==null||e.addEventListener("pointerdown",this),e==null||e.addEventListener("click",this)}disconnectedCallback(){var t;let e=Io(this);this.getAttribute(Le.MEDIA_CONTROLLER)&&((t=e==null?void 0:e.unassociateElement)==null||t.call(e,this)),e==null||e.removeEventListener("pointerdown",this),e==null||e.removeEventListener("click",this)}handleEvent(t){var e;let n=(e=t.composedPath())==null?void 0:e[0];if(!!["video","media-controller"].includes(n==null?void 0:n.localName)){if(t.type==="pointerdown")this._pointerType=t.pointerType;else if(t.type==="click"){let{clientX:u,clientY:M}=t,{left:C,top:O,width:L,height:A}=this.getBoundingClientRect(),x=u-C,I=M-O;if(x<0||I<0||x>L||I>A||L===0&&A===0)return;let{pointerType:_=this._pointerType}=t;if(this._pointerType=void 0,_===Pa.TOUCH){this.handleTap(t);return}else if(_===Pa.MOUSE){this.handleMouseClick(t);return}}}}handleTap(t){}handleMouseClick(t){let e=this.getAttribute(V.MEDIA_PAUSED)!=null?fe.MEDIA_PLAY_REQUEST:fe.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new ie.CustomEvent(e,{composed:!0,bubbles:!0}))}};function Io(r){let t=r.getAttribute(Le.MEDIA_CONTROLLER);return t?re.getElementById(t):bi(r,"media-controller")}ce("media-gesture-receiver",Fa);var Mo=re.createElement("template");Mo.innerHTML=`
  <style>
    
    :host([media-is-fullscreen])  ::slotted([slot=media]) {
      outline: none;
    }

    :host {
      box-sizing: border-box;
      position: relative;
      display: inline-block;
      line-height: 0;
      background-color: var(--media-background-color, #000);
    }

    :host(:not([audio])) [part~=layer]:not([part~=media-layer]) {
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      display: flex;
      flex-flow: column nowrap;
      align-items: start;
      pointer-events: none;
      background: none;
    }

    
    :host([audio]) [part~=layer][part~=gesture-layer] {
      height: 0;
      display: block;
    }

    
    :host(:not([audio])[gestures-disabled]) ::slotted([slot=gestures-chrome]),
    :host(:not([audio])[gestures-disabled]) media-gesture-receiver[slot=gestures-chrome] {
      display: none;
    }

    
    ::slotted(:not([slot=media]):not([slot=poster]):not(media-loading-indicator)) {
      pointer-events: auto;
    }

    :host(:not([audio])) *[part~=layer][part~=centered-layer] {
      align-items: center;
      justify-content: center;
    }

    :host(:not([audio])) ::slotted(media-gesture-receiver[slot=gestures-chrome]),
    :host(:not([audio])) media-gesture-receiver[slot=gestures-chrome] {
      align-self: stretch;
      flex-grow: 1;
    }

    slot[name=middle-chrome] {
      display: inline;
      flex-grow: 1;
      pointer-events: none;
      background: none;
    }

    
    ::slotted([slot=media]),
    ::slotted([slot=poster]) {
      width: 100%;
      height: 100%;
    }

    
    :host(:not([audio])) .spacer {
      flex-grow: 1;
    }

    
    :host(:-webkit-full-screen) {
      
      width: 100% !important;
      height: 100% !important;
    }

    
    ::slotted(:not([slot=media]):not([no-auto-hide])) {
      opacity: 1;
      transition: opacity 0.25s;
    }

    
    :host([user-inactive]:not([${V.MEDIA_PAUSED}]):not([${V.MEDIA_IS_CASTING}]):not([audio])) ::slotted(:not([slot=media]):not([no-auto-hide])) {
      opacity: 0;
      transition: opacity 1s;
    }

    ::slotted(media-control-bar)  {
      align-self: stretch;
    }
  </style>

  <slot name="media" part="layer media-layer"></slot>
  <slot name="poster" part="layer poster-layer"></slot>
  <slot name="gestures-chrome" part="layer gesture-layer">
    <media-gesture-receiver slot="gestures-chrome"></media-gesture-receiver>
  </slot>
  <span part="layer vertical-layer">
    <slot name="top-chrome" part="top chrome"></slot>
    <slot name="middle-chrome" part="middle chrome"></slot>
    <slot name="centered-chrome" part="layer centered-layer center centered chrome"></slot>
    
    <slot part="bottom chrome"></slot>
  </span>
`;var jd=Object.values(V),hn=class extends ie.HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Mo.content.cloneNode(!0));let t=u=>{let M=this.media;for(let C of u)C.type==="childList"&&(C.removedNodes.forEach(O=>{if(O.slot=="media"&&C.target==this){let L=C.previousSibling&&C.previousSibling.previousElementSibling;if(!L||!M)this.mediaUnsetCallback(O);else{let A=L.slot!=="media";for(;(L=L.previousSibling)!==null;)L.slot=="media"&&(A=!1);A&&this.mediaUnsetCallback(O)}}}),M&&C.addedNodes.forEach(O=>{O==M&&this.handleMediaUpdated(M).then(L=>this.mediaSetCallback(L))}))};new MutationObserver(t).observe(this,{childList:!0,subtree:!0});let n=this.media,a=this.querySelector(":scope > slot[slot=media]");a&&a.addEventListener("slotchange",()=>{if(!a.assignedElements({flatten:!0}).length){this.mediaUnsetCallback(n);return}this.media&&(n=this.media,this.handleMediaUpdated(this.media).then(M=>this.mediaSetCallback(M)))})}static get observedAttributes(){return["autohide","gestures-disabled"].concat(jd)}attributeChangedCallback(t,e,n){t.toLowerCase()=="autohide"&&(this.autohide=n)}get media(){let t=this.querySelector(":scope > [slot=media]");return(t==null?void 0:t.nodeName)=="SLOT"&&(t=t.assignedElements({flatten:!0})[0]),t}mediaSetCallback(t){this._mediaClickPlayToggle=()=>{let e=t.paused?fe.MEDIA_PLAY_REQUEST:fe.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new ie.CustomEvent(e,{composed:!0,bubbles:!0}))}}handleMediaUpdated(t){let e=u=>Promise.resolve(u),n=u=>(console.error('<media-chrome>: Media element set with slot="media" does not appear to be compatible.',u),Promise.reject(u));if(!t)return n(t);let a=t.nodeName.toLowerCase();return a.includes("-")?ie.customElements.whenDefined(a).then(()=>e(t)):e(t)}mediaUnsetCallback(t){}connectedCallback(){let e=this.getAttribute("audio")!=null?dt.AUDIO_PLAYER():dt.VIDEO_PLAYER();this.setAttribute("role","region"),this.setAttribute("aria-label",e),this.media&&this.handleMediaUpdated(this.media).then(M=>this.mediaSetCallback(M)),this.setAttribute("user-inactive","user-inactive");let n=()=>{if(this.autohide<0)return;this.setAttribute("user-inactive","user-inactive");let M=new ie.CustomEvent(yi.USER_INACTIVE,{composed:!0,bubbles:!0,detail:!0});this.dispatchEvent(M)},a=()=>{this.removeAttribute("user-inactive");let M=new ie.CustomEvent(yi.USER_INACTIVE,{composed:!0,bubbles:!0,detail:!1});this.dispatchEvent(M)},u=()=>{a(),ie.clearTimeout(this._inactiveTimeout),!(this.autohide<0)&&(this._inactiveTimeout=ie.setTimeout(()=>{n()},this.autohide*1e3))};this.addEventListener("keyup",()=>{u()}),this.addEventListener("pointerup",M=>{M.pointerType==="touch"?[this,this.media].includes(M.target)&&!this.hasAttribute("user-inactive")?n():u():M.composedPath().some(C=>{var O;return["media-play-button","media-fullscreen-button"].includes((O=C==null?void 0:C.nodeName)==null?void 0:O.toLowerCase())})&&u()}),this.addEventListener("pointermove",M=>{M.pointerType==="mouse"&&M.target!==this&&(a(),ie.clearTimeout(this._inactiveTimeout),[this,this.media].includes(M.target)&&u())}),this.addEventListener("mouseleave",()=>{n()}),this.addEventListener("keyup",()=>{this.setAttribute("media-keyboard-control","")}),this.addEventListener("mouseup",()=>{this.removeAttribute("media-keyboard-control")})}set autohide(t){t=Number(t),this._autohide=isNaN(t)?0:t}get autohide(){return this._autohide===void 0?2:this._autohide}};ce("media-container-temp",hn);var Co=hn;var Oo=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)},ot=(r,t,e)=>(Oo(r,t,"read from private field"),e?e.call(r):t.get(r)),Ka=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},Wa=(r,t,e,n)=>(Oo(r,t,"write to private field"),n?n.call(r,e):t.set(r,e),e),jr,Vr,_t,vn=class{constructor(t,e){Ka(this,jr,void 0),Ka(this,Vr,void 0),Ka(this,_t,[]),Wa(this,jr,t),Wa(this,Vr,e)}[Symbol.iterator](){return ot(this,_t).values()}get length(){return ot(this,_t).length}get value(){var t;return(t=ot(this,_t).join(" "))!=null?t:""}set value(t){var e;t!==this.value&&(Wa(this,_t,[]),this.add(...(e=t==null?void 0:t.split(" "))!=null?e:[]))}toString(){return this.value}item(t){return ot(this,_t)[t]}values(){return ot(this,_t).values()}keys(){return ot(this,_t).keys()}forEach(t){ot(this,_t).forEach(t)}add(...t){var e,n;t.forEach(a=>{this.contains(a)||ot(this,_t).push(a)}),!(this.value===""&&!((e=ot(this,jr))!=null&&e.hasAttribute(`${ot(this,Vr)}`)))&&((n=ot(this,jr))==null||n.setAttribute(`${ot(this,Vr)}`,`${this.value}`))}remove(...t){var e;t.forEach(n=>{ot(this,_t).splice(ot(this,_t).indexOf(n),1)}),(e=ot(this,jr))==null||e.setAttribute(`${ot(this,Vr)}`,`${this.value}`)}contains(t){return ot(this,_t).includes(t)}toggle(t,e){return typeof e!="undefined"?e?(this.add(t),!0):(this.remove(t),!1):this.contains(t)?(this.remove(t),!1):(this.add(t),!0)}replace(t,e){this.remove(t),this.add(e)}};jr=new WeakMap;Vr=new WeakMap;_t=new WeakMap;var nt={enter:"requestFullscreen",exit:"exitFullscreen",event:"fullscreenchange",element:"fullscreenElement",error:"fullscreenerror",enabled:"fullscreenEnabled"};re.fullscreenElement===void 0&&(nt.enter="webkitRequestFullScreen",nt.exit=re.webkitExitFullscreen!=null?"webkitExitFullscreen":"webkitCancelFullScreen",nt.event="webkitfullscreenchange",nt.element="webkitFullscreenElement",nt.error="webkitfullscreenerror",nt.enabled="webkitFullscreenEnabled");var Ha=(r="")=>r.split(/\s+/),Po=(r="")=>{let[t,e]=r.split(":"),n=e?decodeURIComponent(e):void 0;return{language:t,label:n}},Vd=(r="",t={})=>Ha(r).map(e=>{let n=Po(e);return{...t,...n}}),$d=r=>Array.isArray(r)?r.map(t=>typeof t=="string"?Po(t):t):typeof r=="string"?Vd(r):[r],Yd=({label:r,language:t}={})=>r?`${t}:${encodeURIComponent(r)}`:t,Kt=(r=[])=>Array.prototype.map.call(r,Yd).join(" "),zd=(r,t)=>e=>e[r]===t,ko=r=>{let t=Object.entries(r).map(([e,n])=>zd(e,n));return e=>t.every(n=>n(e))},Ai=(r,t=[],e=[])=>{let n=$d(e).map(ko),a=u=>n.some(M=>M(u));Array.from(t).filter(a).forEach(u=>{u.mode=r})},$r=(r,t=()=>!0)=>{if(!(r!=null&&r.textTracks))return[];let e=typeof t=="function"?t:ko(t);return Array.from(r.textTracks).filter(e)},Ga=r=>{let t=!!r.getAttribute(V.MEDIA_CAPTIONS_SHOWING),e=!r.hasAttribute("no-subtitles-fallback")&&!!r.getAttribute(V.MEDIA_SUBTITLES_SHOWING);return t||e},mn=r=>{var t,e,n,a;if(Ga(r)){let M=r.getAttribute(V.MEDIA_CAPTIONS_SHOWING);if(M){let O=new window.CustomEvent(fe.MEDIA_DISABLE_CAPTIONS_REQUEST,{composed:!0,bubbles:!0,detail:M});r.dispatchEvent(O)}let C=r.getAttribute(V.MEDIA_SUBTITLES_SHOWING);if(C&&!r.hasAttribute("no-subtitles-fallback")){let O=new window.CustomEvent(fe.MEDIA_DISABLE_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:C});r.dispatchEvent(O)}}else{let[M]=(e=Ha((t=r.getAttribute(V.MEDIA_CAPTIONS_LIST))!=null?t:""))!=null?e:[];if(M){let C=new window.CustomEvent(fe.MEDIA_SHOW_CAPTIONS_REQUEST,{composed:!0,bubbles:!0,detail:M});r.dispatchEvent(C)}else if(r.hasAttribute("no-subtitles-fallback"))console.error("Attempting to enable closed captions but none are available! Please verify your media content if this is unexpected.");else{let[C]=(a=Ha((n=r.getAttribute(V.MEDIA_SUBTITLES_LIST))!=null?n:""))!=null?a:[];if(C){let O=new window.CustomEvent(fe.MEDIA_SHOW_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:C});r.dispatchEvent(O)}}}};var Bo=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)},Yr=(r,t,e)=>(Bo(r,t,"read from private field"),e?e.call(r):t.get(r)),ja=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},zr=(r,t,e)=>(Bo(r,t,"access private method"),e),lr,Xr,Li,En,Va,Xd=Object.values(sn),Fo=["ArrowLeft","ArrowRight","Enter"," ","f","m","k","c"],Qd=10,wo=0,Tn=class extends Co{constructor(){super(),ja(this,Xr),ja(this,En),ja(this,lr,new vn(this,"hotkeys")),ac||(this._airplayUnavailable=Ft.UNSUPPORTED),No||(this._fullscreenUnavailable=Ft.UNAVAILABLE),sc||(this._castUnavailable=Ft.UNSUPPORTED),ic||(this._pipUnavailable=Ft.UNSUPPORTED),xi!==void 0?xi||(this._volumeUnavailable=Ft.UNSUPPORTED):nc.then(()=>{xi||(this._volumeUnavailable=Ft.UNSUPPORTED,this.propagateMediaState(V.MEDIA_VOLUME_UNAVAILABLE,this._volumeUnavailable))}),this.mediaStateReceivers=[],this.associatedElementSubscriptions=new Map,this.associatedElements=[],this.associateElement(this);let t={MEDIA_PLAY_REQUEST:()=>this.media.play(),MEDIA_PAUSE_REQUEST:()=>this.media.pause(),MEDIA_MUTE_REQUEST:()=>this.media.muted=!0,MEDIA_UNMUTE_REQUEST:()=>{let e=this.media;e.muted=!1,e.volume===0&&(e.volume=.25)},MEDIA_VOLUME_REQUEST:e=>{let n=this.media,a=e.detail;n.volume=a,a>0&&n.muted&&(n.muted=!1);try{ie.localStorage.setItem("media-chrome-pref-volume",a.toString())}catch{}},MEDIA_ENTER_FULLSCREEN_REQUEST:()=>{if(!No){console.warn("Fullscreen support is unavailable; not entering fullscreen");return}let e=this.media;re.pictureInPictureElement&&re.exitPictureInPicture(),super[nt.enter]?super[nt.enter]():e.webkitEnterFullscreen?e.webkitEnterFullscreen():e.requestFullscreen?e.requestFullscreen():console.warn("MediaChrome: Fullscreen not supported")},MEDIA_EXIT_FULLSCREEN_REQUEST:()=>{re[nt.exit]()},MEDIA_ENTER_PIP_REQUEST:()=>{let e=this.media;if(!re.pictureInPictureEnabled){console.warn("MediaChrome: Picture-in-picture is not enabled");return}if(!e.requestPictureInPicture){console.warn("MediaChrome: The current media does not support picture-in-picture");return}re[nt.element]&&re[nt.exit]();let n=()=>{console.warn("MediaChrome: The media is not ready for picture-in-picture. It must have a readyState > 0.")};e.requestPictureInPicture().catch(a=>{if(a.code===11)if(e.readyState===0&&e.preload==="none"){let u=()=>{e.removeEventListener("loadedmetadata",M),e.preload="none"},M=()=>{e.requestPictureInPicture().catch(n),u()};e.addEventListener("loadedmetadata",M),e.preload="metadata",setTimeout(()=>{e.readyState===0&&n(),u()},1e3)}else throw a;else throw a})},MEDIA_EXIT_PIP_REQUEST:()=>{re.pictureInPictureElement&&re.exitPictureInPicture()},MEDIA_ENTER_CAST_REQUEST:()=>{var e;let n=this.media;!((e=globalThis.CastableVideoElement)!=null&&e.castEnabled)||(re[nt.element]&&re[nt.exit](),n.requestCast())},MEDIA_EXIT_CAST_REQUEST:async()=>{var e;(e=globalThis.CastableVideoElement)!=null&&e.castElement&&globalThis.CastableVideoElement.exitCast()},MEDIA_SEEK_REQUEST:e=>{let n=this.media,a=e.detail;(n.readyState>0||n.readyState===void 0)&&(n.currentTime=a)},MEDIA_PLAYBACK_RATE_REQUEST:e=>{this.media.playbackRate=e.detail},MEDIA_PREVIEW_REQUEST:e=>{var n;let a=this.media;if(!a)return;let u=e.detail;u===null&&this.propagateMediaState(V.MEDIA_PREVIEW_TIME,void 0),this.propagateMediaState(V.MEDIA_PREVIEW_TIME,u);let[M]=$r(a,{kind:Hr.METADATA,label:"thumbnails"});if(!(M&&M.cues))return;if(u===null){this.propagateMediaState(V.MEDIA_PREVIEW_IMAGE,void 0),this.propagateMediaState(V.MEDIA_PREVIEW_COORDS,void 0);return}let C=Array.prototype.find.call(M.cues,x=>x.startTime>=u);if(!C)return;let O=/'^(?:[a-z]+:)?\/\//i.test(C.text)||(n=a.querySelector('track[label="thumbnails"]'))==null?void 0:n.src,L=new URL(C.text,O),A=new URLSearchParams(L.hash).get("#xywh");this.propagateMediaState(V.MEDIA_PREVIEW_IMAGE,L.href),this.propagateMediaState(V.MEDIA_PREVIEW_COORDS,A.split(",").join(" "))},MEDIA_SHOW_CAPTIONS_REQUEST:e=>{let n=yn(this),{detail:a=[]}=e;Ai(Sr.SHOWING,n,a)},MEDIA_DISABLE_CAPTIONS_REQUEST:e=>{let n=yn(this),{detail:a=[]}=e;Ai(Sr.DISABLED,n,a)},MEDIA_SHOW_SUBTITLES_REQUEST:e=>{let n=Si(this),{detail:a=[]}=e;Ai(Sr.SHOWING,n,a)},MEDIA_DISABLE_SUBTITLES_REQUEST:e=>{let n=Si(this),{detail:a=[]}=e;Ai(Sr.DISABLED,n,a)},MEDIA_AIRPLAY_REQUEST:()=>{let{media:e}=this;if(!!e){if(!(e.webkitShowPlaybackTargetPicker&&ie.WebKitPlaybackTargetAvailabilityEvent)){console.warn("received a request to select AirPlay but AirPlay is not supported in this environment");return}e.webkitShowPlaybackTargetPicker()}}};if(Object.keys(t).forEach(e=>{let n=`_handle${on(e,!0)}`;this[n]=a=>{if(a.stopPropagation(),!this.media){console.warn("MediaController: No media available.");return}t[e](a,this.media)},this.addEventListener(fe[e],this[n])}),this._mediaStatePropagators={"play,pause,emptied":()=>{this.propagateMediaState(V.MEDIA_PAUSED,Ko(this))},"playing,emptied":()=>{var e;this.propagateMediaState(V.MEDIA_HAS_PLAYED,!((e=this.media)!=null&&e.paused))},volumechange:()=>{this.propagateMediaState(V.MEDIA_MUTED,Wo(this)),this.propagateMediaState(V.MEDIA_VOLUME,Ho(this)),this.propagateMediaState(V.MEDIA_VOLUME_LEVEL,Go(this))},[nt.event]:e=>{let a=!!re[nt.element]&&(e==null?void 0:e.target),u=Ti(this,a);this.propagateMediaState(V.MEDIA_IS_FULLSCREEN,u)},"enterpictureinpicture,leavepictureinpicture":e=>{var n;let a;if(e)a=e.type=="enterpictureinpicture";else{let u=(n=this.getRootNode().pictureInPictureElement)!=null?n:re.pictureInPictureElement;a=this.media&&Ti(this.media,u)}this.propagateMediaState(V.MEDIA_IS_PIP,a)},"entercast,leavecast,castchange":e=>{var n;let a=(n=globalThis.CastableVideoElement)==null?void 0:n.castElement,u=this.media&&Ti(this.media,a);(e==null?void 0:e.type)==="castchange"&&(e==null?void 0:e.detail)==="CONNECTING"&&(u="connecting"),this.propagateMediaState(V.MEDIA_IS_CASTING,u)},"timeupdate,loadedmetadata":()=>{this.propagateMediaState(V.MEDIA_CURRENT_TIME,jo(this))},"durationchange,loadedmetadata,emptied":()=>{this.propagateMediaState(V.MEDIA_DURATION,Vo(this)),this.propagateMediaState(V.MEDIA_STREAM_TYPE)},"loadedmetadata,emptied,progress":()=>{var e;this.propagateMediaState(V.MEDIA_SEEKABLE,(e=$o(this))==null?void 0:e.join(":"))},"progress,emptied":()=>{var e;this.propagateMediaState(V.MEDIA_BUFFERED,uc((e=this.media)==null?void 0:e.buffered))},"ratechange,loadstart":()=>{this.propagateMediaState(V.MEDIA_PLAYBACK_RATE,Yo(this))},"waiting,playing,emptied":()=>{var e;let n=((e=this.media)==null?void 0:e.readyState)<3;this.propagateMediaState(V.MEDIA_LOADING,n)}},this._airplayUnavailable!==Ft.UNSUPPORTED){let e=n=>{(n==null?void 0:n.availability)==="available"?this._airplayUnavailable=void 0:(n==null?void 0:n.availability)==="not-available"&&(this._airplayUnavailable=Ft.UNAVAILABLE),this.propagateMediaState(V.MEDIA_AIRPLAY_UNAVAILABLE,this._airplayUnavailable)};this._mediaStatePropagators.webkitplaybacktargetavailabilitychanged=e}if(this._castUnavailable!==Ft.UNSUPPORTED){let e=()=>{var n;let a=(n=globalThis.CastableVideoElement)==null?void 0:n.castState;a!=null&&a.includes("CONNECT")?this._castUnavailable=void 0:this._castUnavailable=Ft.UNAVAILABLE,this.propagateMediaState(V.MEDIA_CAST_UNAVAILABLE,this._castUnavailable)};this._mediaStatePropagators.castchange=e}this._textTrackMediaStatePropagators={"addtrack,removetrack,loadstart":()=>{this.propagateMediaState(V.MEDIA_CAPTIONS_LIST,Kt(yn(this))||void 0),this.propagateMediaState(V.MEDIA_SUBTITLES_LIST,Kt(Si(this))||void 0),this.propagateMediaState(V.MEDIA_CAPTIONS_SHOWING,Kt($a(this))||void 0),this.propagateMediaState(V.MEDIA_SUBTITLES_SHOWING,Kt(Uo(this))||void 0)},change:()=>{this.propagateMediaState(V.MEDIA_CAPTIONS_SHOWING,Kt($a(this))||void 0),this.propagateMediaState(V.MEDIA_SUBTITLES_SHOWING,Kt(Uo(this))||void 0)}},this.enableHotkeys()}static get observedAttributes(){return super.observedAttributes.concat("nohotkeys","hotkeys","default-stream-type")}attributeChangedCallback(t,e,n){t==="nohotkeys"?n!==e&&n===""?(this.hasAttribute("hotkeys")&&console.warn("Both `hotkeys` and `nohotkeys` have been set. All hotkeys will be disabled."),this.disableHotkeys()):n!==e&&n===null&&this.enableHotkeys():t==="hotkeys"?Yr(this,lr).value=n:t==="default-stream-type"&&this.propagateMediaState(V.MEDIA_STREAM_TYPE),super.attributeChangedCallback(t,e,n)}mediaSetCallback(t){super.mediaSetCallback(t),t.hasAttribute("tabindex")||t.setAttribute("tabindex",-1),Object.keys(this._mediaStatePropagators).forEach(e=>{let n=e.split(","),a=this._mediaStatePropagators[e];n.forEach(u=>{(u==nt.event?this.getRootNode():t).addEventListener(u,a)}),a()}),Object.entries(this._textTrackMediaStatePropagators).forEach(([e,n])=>{e.split(",").forEach(u=>{t.textTracks&&t.textTracks.addEventListener(u,n)}),n()});try{let e=ie.localStorage.getItem("media-chrome-pref-volume");e!==null&&(t.volume=e)}catch(e){console.debug("Error getting volume pref",e)}}mediaUnsetCallback(t){super.mediaUnsetCallback(t),Object.keys(this._mediaStatePropagators).forEach(e=>{let n=e.split(","),a=this._mediaStatePropagators[e];n.forEach(u=>{(u==nt.event?this.getRootNode():t).removeEventListener(u,a)})}),Object.entries(this._textTrackMediaStatePropagators).forEach(([e,n])=>{e.split(",").forEach(u=>{t.textTracks&&t.textTracks.removeEventListener(u,n)}),n()}),this.propagateMediaState(V.MEDIA_PAUSED,!0)}propagateMediaState(t,e){arguments.length===1&&(e=gn[t](this)),Dr(this.mediaStateReceivers,t,e);let n=new ie.CustomEvent(Eo[t],{composed:!0,bubbles:!0,detail:e});this.dispatchEvent(n)}associateElement(t){if(!t)return;let{associatedElementSubscriptions:e}=this;if(e.has(t))return;let n=this.registerMediaStateReceiver.bind(this),a=this.unregisterMediaStateReceiver.bind(this),u=ec(t,n,a);Object.keys(fe).forEach(M=>{t.addEventListener(fe[M],this[`_handle${on(M,!0)}`])}),e.set(t,u)}unassociateElement(t){if(!t)return;let{associatedElementSubscriptions:e}=this;if(!e.has(t))return;e.get(t)(),e.delete(t),Object.keys(fe).forEach(a=>{t.removeEventListener(fe[a],this[`_handle${on(a,!0)}`])})}registerMediaStateReceiver(t){if(!t)return;let e=this.mediaStateReceivers;e.indexOf(t)>-1||(e.push(t),Dr([t],V.MEDIA_VOLUME_UNAVAILABLE,this._volumeUnavailable),Dr([t],V.MEDIA_AIRPLAY_UNAVAILABLE,this._airplayUnavailable),Dr([t],V.MEDIA_FULLSCREEN_UNAVAILABLE,this._fullscreenUnavailable),Dr([t],V.MEDIA_CAST_UNAVAILABLE,this._castUnavailable),Dr([t],V.MEDIA_PIP_UNAVAILABLE,this._pipUnavailable),this.media&&Object.keys(V).forEach(a=>{a.includes("UNAVAILABLE")||Dr([t],V[a],gn[V[a]]?gn[V[a]](this):gn.default(this,V[a]))}))}unregisterMediaStateReceiver(t){let e=this.mediaStateReceivers,n=e.indexOf(t);n<0||e.splice(n,1)}enableHotkeys(){this.addEventListener("keydown",zr(this,En,Va))}disableHotkeys(){this.removeEventListener("keydown",zr(this,En,Va)),this.removeEventListener("keyup",zr(this,Xr,Li))}get hotkeys(){return Yr(this,lr)}keyboardShortcutHandler(t){var e,n,a,u;if(((u=(a=(e=t.target.getAttribute("keysused"))==null?void 0:e.split(" "))!=null?a:(n=t.target)==null?void 0:n.keysUsed)!=null?u:[]).map(_=>_==="Space"?" ":_).filter(Boolean).includes(t.key))return;let C,O,L,A,x,I=Qd;if(!Yr(this,lr).contains(`no${t.key.toLowerCase()}`)&&!(t.key===" "&&Yr(this,lr).contains("nospace")))switch(t.key){case" ":case"k":C=this.getAttribute(V.MEDIA_PAUSED)!=null?fe.MEDIA_PLAY_REQUEST:fe.MEDIA_PAUSE_REQUEST,this.dispatchEvent(new ie.CustomEvent(C,{composed:!0,bubbles:!0}));break;case"m":C=this.getAttribute(V.MEDIA_VOLUME_LEVEL)==="off"?fe.MEDIA_UNMUTE_REQUEST:fe.MEDIA_MUTE_REQUEST,this.dispatchEvent(new ie.CustomEvent(C,{composed:!0,bubbles:!0}));break;case"f":C=this.getAttribute(V.MEDIA_IS_FULLSCREEN)!=null?fe.MEDIA_EXIT_FULLSCREEN_REQUEST:fe.MEDIA_ENTER_FULLSCREEN_REQUEST,this.dispatchEvent(new ie.CustomEvent(C,{composed:!0,bubbles:!0}));break;case"c":mn(this);break;case"ArrowLeft":O=this.getAttribute(V.MEDIA_CURRENT_TIME),L=O&&!Number.isNaN(+O)?+O:wo,A=Math.max(L-I,0),x=new ie.CustomEvent(fe.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:A}),this.dispatchEvent(x);break;case"ArrowRight":O=this.getAttribute(V.MEDIA_CURRENT_TIME),L=O&&!Number.isNaN(+O)?+O:wo,A=Math.max(L+I,0),x=new ie.CustomEvent(fe.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:A}),this.dispatchEvent(x);break;default:break}}};lr=new WeakMap;Xr=new WeakSet;Li=function(r){let{key:t}=r;if(!Fo.includes(t)){this.removeEventListener("keyup",zr(this,Xr,Li));return}this.keyboardShortcutHandler(r)};En=new WeakSet;Va=function(r){let{metaKey:t,altKey:e,key:n}=r;if(t||e||!Fo.includes(n)){this.removeEventListener("keyup",zr(this,Xr,Li));return}[" ","ArrowLeft","ArrowRight"].includes(n)&&!(Yr(this,lr).contains(`no${n.toLowerCase()}`)||n===" "&&Yr(this,lr).contains("nospace"))&&r.preventDefault(),this.addEventListener("keyup",zr(this,Xr,Li),{once:!0})};var gn={default(r,t){return r.getAttribute(t)},[V.MEDIA_CAPTIONS_LIST](r){return Kt(yn(r))||void 0},[V.MEDIA_SUBTITLES_LIST](r){return Kt(Si(r))||void 0},[V.MEDIA_SUBTITLES_LIST](r){return Kt(Si(r))||void 0},[V.MEDIA_CAPTIONS_SHOWING](r){return Kt($a(r))||void 0},[V.MEDIA_PAUSED](r){return Ko(r)},[V.MEDIA_MUTED](r){return Wo(r)},[V.MEDIA_VOLUME](r){return Ho(r)},[V.MEDIA_VOLUME_LEVEL](r){return Go(r)},[V.MEDIA_CURRENT_TIME](r){return jo(r)},[V.MEDIA_DURATION](r){return Vo(r)},[V.MEDIA_SEEKABLE](r){var t;return(t=$o(r))==null?void 0:t.join(":")},[V.MEDIA_PLAYBACK_RATE](r){return Yo(r)},[V.MEDIA_STREAM_TYPE](r){let t=r.media;if(!t)return;let e=t.duration;if(e===1/0)return sn.LIVE;if(Number.isFinite(e))return sn.ON_DEMAND;{let n=r.getAttribute("default-stream-type");if(Xd.includes(n))return n}return null}},Ko=r=>r.media?r.media.paused:!0,Wo=r=>!!(r.media&&r.media.muted),Ho=r=>{let t=r.media;return t?t.volume:1},Go=r=>{let t="high";if(!r.media)return t;let{muted:e,volume:n}=r.media;return n===0||e?t="off":n<.5?t="low":n<.75&&(t="medium"),t},jo=r=>{let t=r.media;return t?t.currentTime:0},Vo=r=>{let t=r==null?void 0:r.media;return Number.isFinite(t==null?void 0:t.duration)?t.duration:NaN},$o=r=>{var t;let e=r==null?void 0:r.media;if(!((t=e==null?void 0:e.seekable)!=null&&t.length))return;let n=e.seekable.start(0),a=e.seekable.end(e.seekable.length-1);if(!(!n&&!a))return[Number(n.toFixed(3)),Number(a.toFixed(3))]},Yo=r=>{let t=r.media;return t?t.playbackRate:1},Si=r=>$r(r.media,{kind:Hr.SUBTITLES}),yn=r=>$r(r.media,{kind:Hr.CAPTIONS}),Uo=r=>$r(r.media,{kind:Hr.SUBTITLES,mode:Sr.SHOWING}),$a=r=>$r(r.media,{kind:Hr.CAPTIONS,mode:Sr.SHOWING}),Zd=Object.values(V),zo=r=>{var t,e,n,a;let{observedAttributes:u}=r.constructor;!u&&((t=r.nodeName)==null?void 0:t.includes("-"))&&(ie.customElements.upgrade(r),{observedAttributes:u}=r.constructor);let M=(a=(n=(e=r==null?void 0:r.getAttribute)==null?void 0:e.call(r,Le.MEDIA_CHROME_ATTRIBUTES))==null?void 0:n.split)==null?void 0:a.call(n,/\s+/);return Array.isArray(u||M)?(u||M).filter(C=>Zd.includes(C)):[]},Ya=r=>!!zo(r).length,Jd=async(r,t,e)=>(r.isConnected||await Xo(0),e==null?r.removeAttribute(t):typeof e=="boolean"?e?r.setAttribute(t,""):r.removeAttribute(t):Number.isNaN(e)?r.removeAttribute(t):r.setAttribute(t,e)),qd=r=>{var t;return!!((t=r.closest)!=null&&t.call(r,'*[slot="media"]'))},_i=(r,t)=>{if(qd(r))return;let e=(a,u)=>{var M,C;Ya(a)&&u(a);let{children:O=[]}=a!=null?a:{},L=(C=(M=a==null?void 0:a.shadowRoot)==null?void 0:M.children)!=null?C:[];[...O,...L].forEach(x=>_i(x,u))},n=r==null?void 0:r.nodeName.toLowerCase();if(n.includes("-")&&!Ya(r)){ie.customElements.whenDefined(n).then(()=>{e(r,t)});return}e(r,t)},Dr=(r,t,e)=>{r.forEach(n=>{!zo(n).includes(t)||Jd(n,t,e)})},ec=(r,t,e)=>{_i(r,t);let n=O=>{var L;let A=(L=O==null?void 0:O.composedPath()[0])!=null?L:O.target;t(A)},a=O=>{var L;let A=(L=O==null?void 0:O.composedPath()[0])!=null?L:O.target;e(A)};r.addEventListener(fe.REGISTER_MEDIA_STATE_RECEIVER,n),r.addEventListener(fe.UNREGISTER_MEDIA_STATE_RECEIVER,a);let u=O=>{O.forEach(L=>{let{addedNodes:A=[],removedNodes:x=[],type:I,target:_,attributeName:b}=L;I==="childList"?(Array.prototype.forEach.call(A,S=>_i(S,t)),Array.prototype.forEach.call(x,S=>_i(S,e))):I==="attributes"&&b===Le.MEDIA_CHROME_ATTRIBUTES&&(Ya(_)?t(_):e(_))})},M=new MutationObserver(u);return M.observe(r,{childList:!0,attributes:!0,subtree:!0}),()=>{_i(r,e),M.disconnect(),r.removeEventListener(fe.REGISTER_MEDIA_STATE_RECEIVER,n),r.removeEventListener(fe.UNREGISTER_MEDIA_STATE_RECEIVER,a)}},pn,za=()=>{var r,t;return pn||(pn=(t=(r=re)==null?void 0:r.createElement)==null?void 0:t.call(r,"video"),pn)},tc=async(r=za())=>{if(!r)return!1;let t=r.volume;return r.volume=t/2+.1,await Xo(0),r.volume!==t},Xo=r=>new Promise(t=>setTimeout(t,r)),rc=(r=za())=>typeof(r==null?void 0:r.requestPictureInPicture)=="function",ic=rc(),xi,nc=tc().then(r=>(xi=r,xi)),ac=!!ie.WebKitPlaybackTargetAvailabilityEvent,sc=!!ie.chrome,oc=(r=za())=>{let t=re[nt.enabled];return!t&&r&&(t="webkitSupportsFullscreen"in r),t},No=oc(),lc=Object.freeze({length:0,start(r){let t=r>>>0;if(t>=this.length)throw new DOMException(`Failed to execute 'start' on 'TimeRanges': The index provided (${t}) is greater than or equal to the maximum bound (${this.length}).`);return 0},end(r){let t=r>>>0;if(t>=this.length)throw new DOMException(`Failed to execute 'end' on 'TimeRanges': The index provided (${t}) is greater than or equal to the maximum bound (${this.length}).`);return 0}});function uc(r=lc){return Array.from(r).map((t,e)=>[Number(r.start(e).toFixed(3)),Number(r.end(e).toFixed(3))].join(":")).join(" ")}ce("media-controller",Tn);var Di=Tn;var Zo=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)},dc=(r,t,e)=>(Zo(r,t,"read from private field"),e?e.call(r):t.get(r)),cc=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},fc=(r,t,e,n)=>(Zo(r,t,"write to private field"),n?n.call(r,e):t.set(r,e),e),bn,Jo=re.createElement("template"),Qo=`
  height: var(--thumb-height);
  width: var(--media-range-thumb-width, 10px);
  border: var(--media-range-thumb-border, none);
  border-radius: var(--media-range-thumb-border-radius, 10px);
  background: var(--media-range-thumb-background, #fff);
  box-shadow: var(--media-range-thumb-box-shadow, 1px 1px 1px transparent);
  cursor: pointer;
  transition: var(--media-range-thumb-transition, none);
  transform: var(--media-range-thumb-transform, none);
  opacity: var(--media-range-thumb-opacity, 1);
`,Xa=`
  width: var(--media-range-track-width, 100%);
  min-width: 40px;
  height: var(--track-height);
  border: var(--media-range-track-border, none);
  outline: var(--media-range-track-outline);
  outline-offset: var(--media-range-track-outline-offset);
  border-radius: var(--media-range-track-border-radius, 0);
  background: var(--media-range-track-progress-internal, var(--media-range-track-background, #eee));
  box-shadow: var(--media-range-track-box-shadow, none);
  transition: var(--media-range-track-transition, none);
  transform: translate(var(--media-range-track-translate-x, 0), var(--media-range-track-translate-y, 0));
  cursor: pointer;
`;Jo.innerHTML=`
  <style>
    :host {
      --thumb-height: var(--media-range-thumb-height, 10px);
      --track-height: var(--media-range-track-height, 4px);
      --media-range-padding: var(--media-control-padding, 10px);
      --_media-range-padding: var(--media-range-padding, 10px);

      vertical-align: middle;
      box-sizing: border-box;
      display: inline-block;
      position: relative;
      background: var(--media-control-background, rgba(20,20,30, 0.7));
      transition: background 0.15s linear;
      width: 100px;
      height: calc(var(--media-control-height, 24px) + 2 * var(--_media-range-padding));
      padding-left: var(--media-range-padding-left, var(--_media-range-padding));
      padding-right: var(--media-range-padding-right, var(--_media-range-padding));
      pointer-events: auto;
      
      font-size: 0;
    }

    :host(:hover) {
      background: var(--media-control-hover-background, rgba(50,50,60, 0.7));
    }

    #container {
      position: relative;
      height: 100%;
    }

    input[type=range] {
      
      -webkit-appearance: none; 
      background: transparent; 

      
      min-height: 100%;
      width: var(--media-range-track-width, 100%); 

      box-sizing: border-box;
      padding: 0;
      margin: 0;
    }

    
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      ${Qo}
      
      margin-top: calc(calc(0px - var(--thumb-height) + var(--track-height)) / 2);
    }

    
    input[type=range]::-moz-range-thumb {
      ${Qo}
      translate: var(--media-range-track-translate-x, 0) var(--media-range-track-translate-y, 0);
    }

    input[type=range]::-webkit-slider-runnable-track { ${Xa} }
    input[type=range]::-moz-range-track { ${Xa} }
    input[type=range]::-ms-track {
      
      width: 100%;
      cursor: pointer;
      
      background: transparent;
      border-color: transparent;
      color: transparent;

      ${Xa}
    }

    #background,
    #pointer {
      min-width: 40px;
      width: var(--media-range-track-width, 100%);
      height: var(--track-height);
      border-radius: var(--media-range-track-border-radius, 0);
      position: absolute;
      top: 50%;
      transform: translate(var(--media-range-track-translate-x, 0px), calc(var(--media-range-track-translate-y, 0px) - 50%));
      background: var(--media-range-track-background, #333);
    }

    #pointer {
      min-width: auto;
      background: var(--media-range-track-pointer-background);
      border-right: var(--media-range-track-pointer-border-right);
      transition: visibility .25s, opacity .25s;
      visibility: hidden;
      opacity: 0;
    }

    :host(:hover) #pointer {
      transition: visibility .5s, opacity .5s;
      visibility: visible;
      opacity: 1;
    }

    #hoverzone {
      
      z-index: 1;
      display: var(--media-time-range-hover-display, none);
      position: absolute;
      width: 100%;
      bottom: var(--media-time-range-hover-bottom, -5px);
      height: var(--media-time-range-hover-height, max(calc(100% + 5px), 20px));
    }

    #range {
      z-index: 2;
      position: relative;
      height: var(--media-range-track-height, 4px);
    }

    
    :host-context([media-keyboard-control]):host(:focus),
    :host-context([media-keyboard-control]):host(:focus-within) {
      box-shadow: inset 0 0 0 2px rgba(27, 127, 204, 0.9);
    }
    :host-context([media-keyboard-control]) input[type=range]:focus-visible {
      box-shadow: none;
    }
    input[type=range]:focus-visible {
      box-shadow: inset 0 0 0 2px rgba(27, 127, 204, 0.9);
    }
    input[type=range]:focus {
      outline: 0;
    }
    input[type=range]:focus::-webkit-slider-runnable-track {
      outline: 0;
    }

    input[type=range]:disabled::-webkit-slider-thumb {
      background-color: #777;
    }

    input[type=range]:disabled::-webkit-slider-runnable-track {
      background-color: #777;
    }
  </style>
  <div id="container">
    <div id="background"></div>
    <div id="pointer"></div>
    <div id="hoverzone"></div>
    <input id="range" type="range" min="0" max="1000" step="any" value="0">
  </div>
`;var An=class extends ie.HTMLElement{constructor(){super(),cc(this,bn,void 0),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Jo.content.cloneNode(!0)),this.container=this.shadowRoot.querySelector("#container"),this.range=this.shadowRoot.querySelector("#range"),this.range.addEventListener("input",this.updateBar.bind(this)),fc(this,bn,parseInt(getComputedStyle(this).getPropertyValue("--media-range-thumb-width")||"10",10))}static get observedAttributes(){return["disabled","aria-disabled",Le.MEDIA_CONTROLLER]}attributeChangedCallback(t,e,n){var a,u;if(t===Le.MEDIA_CONTROLLER){if(e){let M=re.getElementById(e);(a=M==null?void 0:M.unassociateElement)==null||a.call(M,this)}if(n){let M=re.getElementById(n);(u=M==null?void 0:M.associateElement)==null||u.call(M,this)}}else(t==="disabled"||t==="aria-disabled"&&e!==n)&&(n==null?this.range.removeAttribute(t):this.range.setAttribute(t,n))}connectedCallback(){var t;let e=this.getAttribute(Le.MEDIA_CONTROLLER);if(e){let n=re.getElementById(e);(t=n==null?void 0:n.associateElement)==null||t.call(n,this)}this.updateBar()}disconnectedCallback(){var t;let e=this.getAttribute(Le.MEDIA_CONTROLLER);if(e){let n=re.getElementById(e);(t=n==null?void 0:n.unassociateElement)==null||t.call(n,this)}}updatePointerBar(t){let e=this.range.getBoundingClientRect(),n=(t.clientX-e.left)/e.width;n=Math.max(0,Math.min(1,n));let{style:a}=qt(this.shadowRoot,"#pointer");a.setProperty("width",`${n*e.width}px`)}updateBar(){let t=this.getBarColors(),e="linear-gradient(to right, ",n=0;t.forEach(u=>{u[1]<n||(e=e+`${u[0]} ${n}%, ${u[0]} ${u[1]}%,`,n=u[1])}),e=e.slice(0,e.length-1)+")";let{style:a}=qt(this.shadowRoot,"#range");a.setProperty("--media-range-track-progress-internal",e)}getBarColors(){let t=this.range,e=t.value-t.min,n=t.max-t.min,a=e/n*100,u=0;return t.value>t.min&&t.value<t.max&&(u=dc(this,bn)*(.5-a/100)/t.offsetWidth*100),[["var(--media-range-bar-color, #fff)",a+u],["transparent",100]]}get keysUsed(){return["ArrowUp","ArrowRight","ArrowDown","ArrowLeft"]}};bn=new WeakMap;ce("media-chrome-range",An);var Ii=An;var qo=re.createElement("template");qo.innerHTML=`
  <style>
    :host {
      
      box-sizing: border-box;
      display: inline-flex;
      color: var(--media-icon-color, #eee);
      --media-loading-icon-width: 44px;
    }

    media-time-range,
    ::slotted(media-time-range),
    ::slotted(media-progress-range),
    ::slotted(media-clip-selector) {
      flex-grow: 1;
    }
  </style>

  <slot></slot>
`;var Qa=class extends ie.HTMLElement{static get observedAttributes(){return[Le.MEDIA_CONTROLLER]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(qo.content.cloneNode(!0))}attributeChangedCallback(t,e,n){var a,u;if(t===Le.MEDIA_CONTROLLER){if(e){let M=re.getElementById(e);(a=M==null?void 0:M.unassociateElement)==null||a.call(M,this)}if(n){let M=re.getElementById(n);(u=M==null?void 0:M.associateElement)==null||u.call(M,this)}}}connectedCallback(){var t;let e=this.getAttribute(Le.MEDIA_CONTROLLER);if(e){let n=re.getElementById(e);(t=n==null?void 0:n.associateElement)==null||t.call(n,this)}}disconnectedCallback(){var t;let e=this.getAttribute(Le.MEDIA_CONTROLLER);if(e){let n=re.getElementById(e);(t=n==null?void 0:n.unassociateElement)==null||t.call(n,this)}}};ce("media-control-bar",Qa);var el=re.createElement("template");el.innerHTML=`
  <style>
    :host {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      vertical-align: middle;
      box-sizing: border-box;
      background: var(--media-control-background, rgba(20,20,30, 0.7));
  
      padding: var(--media-control-padding, 10px);

      font-size: 14px;
      line-height: var(--media-text-content-height, var(--media-control-height, 24px));
      font-family: Arial, sans-serif;
      text-align: center;
      color: #ffffff;
      pointer-events: auto;
    }

    
    :host(:focus-visible) {
      box-shadow: inset 0 0 0 2px rgba(27, 127, 204, 0.9);
      outline: 0;
    }

    
    :host(:where(:focus)) {
      box-shadow: none;
      outline: 0;
    }
  </style>
  <span id="container">
  <slot></slot>
  </span>
`;var _n=class extends ie.HTMLElement{static get observedAttributes(){return[Le.MEDIA_CONTROLLER]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(el.content.cloneNode(!0)),this.container=this.shadowRoot.querySelector("#container")}attributeChangedCallback(t,e,n){var a,u;if(t===Le.MEDIA_CONTROLLER){if(e){let M=re.getElementById(e);(a=M==null?void 0:M.unassociateElement)==null||a.call(M,this)}if(n){let M=re.getElementById(n);(u=M==null?void 0:M.associateElement)==null||u.call(M,this)}}}connectedCallback(){var t;let e=this.getAttribute(Le.MEDIA_CONTROLLER);if(e){let n=re.getElementById(e);(t=n==null?void 0:n.associateElement)==null||t.call(n,this)}}disconnectedCallback(){var t;let e=this.getAttribute(Le.MEDIA_CONTROLLER);if(e){let n=re.getElementById(e);(t=n==null?void 0:n.unassociateElement)==null||t.call(n,this)}}};ce("media-text-display",_n);var ur=_n;var Za=class extends ur{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_CURRENT_TIME]}attributeChangedCallback(t,e,n){t===V.MEDIA_CURRENT_TIME&&(this.container.innerHTML=Xt(n)),super.attributeChangedCallback(t,e,n)}};ce("media-current-time-display",Za);var Ja=class extends ur{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_DURATION]}attributeChangedCallback(t,e,n){t===V.MEDIA_DURATION&&(this.container.innerHTML=Xt(n)),super.attributeChangedCallback(t,e,n)}};ce("media-duration-display",Ja);var hc="&nbsp;/&nbsp;",vc=(r,{timesSep:t=hc}={})=>{var e,n,a;let u=r.getAttribute("remaining")!=null,M=r.getAttribute("show-duration")!=null,C=(e=r.mediaCurrentTime)!=null?e:0,O=(a=(n=r.mediaDuration)!=null?n:r.mediaSeekableEnd)!=null?a:0,L=u?Xt(0-(O-C)):Xt(C);return M?`${L}${t}${Xt(O)}`:L},mc="video not loaded, unknown time.",gc=r=>{let t=r.mediaCurrentTime,e=r.mediaDuration||r.mediaSeekableEnd;if(t==null||e==null){r.setAttribute("aria-valuetext",mc);return}let n=r.hasAttribute("remaining"),a=r.hasAttribute("show-duration"),u=n?xr(0-(e-t)):xr(t);if(!a){r.setAttribute("aria-valuetext",u);return}let M=xr(e),C=`${u} of ${M}`;r.setAttribute("aria-valuetext",C)},qa=class extends ur{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_CURRENT_TIME,V.MEDIA_DURATION,V.MEDIA_SEEKABLE,"remaining","show-duration","disabled"]}constructor(){super()}connectedCallback(){this.hasAttribute("disabled")||this.enable(),this.setAttribute("role","progressbar"),this.setAttribute("aria-label",dt.PLAYBACK_TIME()),super.connectedCallback()}disconnectedCallback(){this.disable()}attributeChangedCallback(t,e,n){if([V.MEDIA_CURRENT_TIME,V.MEDIA_DURATION,V.MEDIA_SEEKABLE,"remaining","show-duration"].includes(t)){let a=vc(this);gc(this),this.container.innerHTML=a}else t==="disabled"&&n!==e&&(n==null?this.enable():this.disable());super.attributeChangedCallback(t,e,n)}enable(){this.setAttribute("tabindex",0)}disable(){this.removeAttribute("tabindex")}get mediaDuration(){let t=this.getAttribute(V.MEDIA_DURATION);return t!=null?+t:void 0}get mediaCurrentTime(){let t=this.getAttribute(V.MEDIA_CURRENT_TIME);return t!=null?+t:void 0}get mediaSeekable(){let t=this.getAttribute(V.MEDIA_SEEKABLE);if(!!t)return t.split(":").map(e=>+e)}get mediaSeekableEnd(){var t;let[,e]=(t=this.mediaSeekable)!=null?t:[];return e}get mediaSeekableStart(){var t;let[e]=(t=this.mediaSeekable)!=null?t:[];return e}};ce("media-time-display",qa);var pc=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M22.83 5.68a2.58 2.58 0 0 0-2.3-2.5c-3.62-.24-11.44-.24-15.06 0a2.58 2.58 0 0 0-2.3 2.5c-.23 4.21-.23 8.43 0 12.64a2.58 2.58 0 0 0 2.3 2.5c3.62.24 11.44.24 15.06 0a2.58 2.58 0 0 0 2.3-2.5c.23-4.21.23-8.43 0-12.64Zm-11.39 9.45a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.92 3.92 0 0 1 .92-2.77 3.18 3.18 0 0 1 2.43-1 2.94 2.94 0 0 1 2.13.78c.364.359.62.813.74 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.17 1.61 1.61 0 0 0-1.29.58 2.79 2.79 0 0 0-.5 1.89 3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.48 1.48 0 0 0 1-.37 2.1 2.1 0 0 0 .59-1.14l1.4.44a3.23 3.23 0 0 1-1.07 1.69Zm7.22 0a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.88 3.88 0 0 1 .93-2.77 3.14 3.14 0 0 1 2.42-1 3 3 0 0 1 2.16.82 2.8 2.8 0 0 1 .73 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.21 1.61 1.61 0 0 0-1.29.58A2.79 2.79 0 0 0 15 12a3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.44 1.44 0 0 0 1-.37 2.1 2.1 0 0 0 .6-1.15l1.4.44a3.17 3.17 0 0 1-1.1 1.7Z"/>
</svg>`,Ec=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M17.73 14.09a1.4 1.4 0 0 1-1 .37 1.579 1.579 0 0 1-1.27-.58A3 3 0 0 1 15 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34A2.89 2.89 0 0 0 19 9.07a3 3 0 0 0-2.14-.78 3.14 3.14 0 0 0-2.42 1 3.91 3.91 0 0 0-.93 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.17 3.17 0 0 0 1.07-1.74l-1.4-.45c-.083.43-.3.822-.62 1.12Zm-7.22 0a1.43 1.43 0 0 1-1 .37 1.58 1.58 0 0 1-1.27-.58A3 3 0 0 1 7.76 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34a2.81 2.81 0 0 0-.74-1.32 2.94 2.94 0 0 0-2.13-.78 3.18 3.18 0 0 0-2.43 1 4 4 0 0 0-.92 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.23 3.23 0 0 0 1.07-1.74l-1.4-.45a2.06 2.06 0 0 1-.6 1.07Zm12.32-8.41a2.59 2.59 0 0 0-2.3-2.51C18.72 3.05 15.86 3 13 3c-2.86 0-5.72.05-7.53.17a2.59 2.59 0 0 0-2.3 2.51c-.23 4.207-.23 8.423 0 12.63a2.57 2.57 0 0 0 2.3 2.5c1.81.13 4.67.19 7.53.19 2.86 0 5.72-.06 7.53-.19a2.57 2.57 0 0 0 2.3-2.5c.23-4.207.23-8.423 0-12.63Zm-1.49 12.53a1.11 1.11 0 0 1-.91 1.11c-1.67.11-4.45.18-7.43.18-2.98 0-5.76-.07-7.43-.18a1.11 1.11 0 0 1-.91-1.11c-.21-4.14-.21-8.29 0-12.43a1.11 1.11 0 0 1 .91-1.11C7.24 4.56 10 4.49 13 4.49s5.76.07 7.43.18a1.11 1.11 0 0 1 .91 1.11c.21 4.14.21 8.29 0 12.43Z"/>
</svg>`,rl=re.createElement("template");rl.innerHTML=`
  <style>
  :host([aria-checked="true"]) slot:not([name=on]) > *,
  :host([aria-checked="true"]) ::slotted(:not([slot=on])) {
    display: none !important;
  }

  
  :host(:not([aria-checked="true"])) slot:not([name=off]) > *, 
  :host(:not([aria-checked="true"])) ::slotted(:not([slot=off])) {
    display: none !important;
  }
  </style>

  <slot name="on">${pc}</slot>
  <slot name="off">${Ec}</slot>
`;var tl=r=>{r.setAttribute("aria-checked",Ga(r))},es=class extends Ze{static get observedAttributes(){return[...super.observedAttributes,"no-subtitles-fallback","default-showing",V.MEDIA_CAPTIONS_LIST,V.MEDIA_CAPTIONS_SHOWING,V.MEDIA_SUBTITLES_LIST,V.MEDIA_SUBTITLES_SHOWING]}constructor(t={}){super({slotTemplate:rl,...t}),this._captionsReady=!1}connectedCallback(){super.connectedCallback(),this.setAttribute("role","switch"),this.setAttribute("aria-label",dt.CLOSED_CAPTIONS()),tl(this)}attributeChangedCallback(t,e,n){if([V.MEDIA_CAPTIONS_SHOWING,V.MEDIA_SUBTITLES_SHOWING].includes(t)&&tl(this),this.hasAttribute("default-showing")&&this.getAttribute("aria-checked")!=="true"){let a=!this.hasAttribute("no-subtitles-fallback");if((a?[V.MEDIA_CAPTIONS_LIST,V.MEDIA_SUBTITLES_LIST]:[V.MEDIA_CAPTIONS_LIST]).includes(t)){let M=!!this.getAttribute(V.MEDIA_CAPTIONS_LIST)||!!(a&&this.getAttribute(V.MEDIA_SUBTITLES_LIST));this._captionsReady!==M&&(this._captionsReady=M,this._captionsReady&&this.handleClick())}}super.attributeChangedCallback(t,e,n)}handleClick(){mn(this)}};ce("media-captions-button",es);var ts="30",yc=`<svg aria-hidden="true" viewBox="0 0 20 24"><defs><style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style></defs><text class="text value" transform="translate(8.9 19.87)">${ts}</text><path d="M10 6V3l5.61 4L10 10.94V8a5.54 5.54 0 0 0-1.9 10.48v2.12A7.5 7.5 0 0 1 10 6Z"/></svg>`,al=re.createElement("template");al.innerHTML=`  
  <slot name="forward">${yc}</slot>
`;var Tc=0,il=r=>{let t=Math.abs(+r.getAttribute("seek-offset")),e=Xe.SEEK_FORWARD_N_SECS({seekOffset:t});r.setAttribute("aria-label",e)},nl=r=>{let t=fn(r,"forward"),e=r.getAttribute("seek-offset");cn(t,e)},rs=class extends Ze{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_CURRENT_TIME,"seek-offset"]}constructor(t={}){super({slotTemplate:al,...t})}connectedCallback(){this.hasAttribute("seek-offset")||this.setAttribute("seek-offset",ts),il(this),nl(this),super.connectedCallback()}attributeChangedCallback(t,e,n){t==="seek-offset"&&(n==null&&this.setAttribute("seek-offset",ts),nl(this),il(this)),super.attributeChangedCallback(t,e,n)}handleClick(){let t=this.getAttribute(V.MEDIA_CURRENT_TIME),e=+this.getAttribute("seek-offset"),a=(t&&!Number.isNaN(+t)?+t:Tc)+e,u=new ie.CustomEvent(fe.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:a});this.dispatchEvent(u)}};ce("media-seek-forward-button",rs);var bc=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M16 3v2.5h3.5V9H22V3h-6ZM4 9h2.5V5.5H10V3H4v6Zm15.5 9.5H16V21h6v-6h-2.5v3.5ZM6.5 15H4v6h6v-2.5H6.5V15Z"/>
</svg>`,Ac=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M18.5 6.5V3H16v6h6V6.5h-3.5ZM16 21h2.5v-3.5H22V15h-6v6ZM4 17.5h3.5V21H10v-6H4v2.5Zm3.5-11H4V9h6V3H7.5v3.5Z"/>
</svg>`,ol=re.createElement("template");ol.innerHTML=`
  <style>
  :host([${V.MEDIA_IS_FULLSCREEN}]) slot:not([name=exit]) > *,
  :host([${V.MEDIA_IS_FULLSCREEN}]) ::slotted(:not([slot=exit])) {
    display: none !important;
  }

  
  :host(:not([${V.MEDIA_IS_FULLSCREEN}])) slot:not([name=enter]) > *,
  :host(:not([${V.MEDIA_IS_FULLSCREEN}])) ::slotted(:not([slot=enter])) {
    display: none !important;
  }
  </style>

  <slot name="enter">${bc}</slot>
  <slot name="exit">${Ac}</slot>
`;var sl=r=>{let e=r.getAttribute(V.MEDIA_IS_FULLSCREEN)!=null?Xe.EXIT_FULLSCREEN():Xe.ENTER_FULLSCREEN();r.setAttribute("aria-label",e)},is=class extends Ze{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_IS_FULLSCREEN,V.MEDIA_FULLSCREEN_UNAVAILABLE]}constructor(t={}){super({slotTemplate:ol,...t})}connectedCallback(){sl(this),super.connectedCallback()}attributeChangedCallback(t,e,n){t===V.MEDIA_IS_FULLSCREEN&&sl(this),super.attributeChangedCallback(t,e,n)}handleClick(){let t=this.getAttribute(V.MEDIA_IS_FULLSCREEN)!=null?fe.MEDIA_EXIT_FULLSCREEN_REQUEST:fe.MEDIA_ENTER_FULLSCREEN_REQUEST;this.dispatchEvent(new ie.CustomEvent(t,{composed:!0,bubbles:!0}))}};ce("media-fullscreen-button",is);var _c=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M16.5 12A4.5 4.5 0 0 0 14 8v2.18l2.45 2.45a4.22 4.22 0 0 0 .05-.63Zm2.5 0a6.84 6.84 0 0 1-.54 2.64L20 16.15A8.8 8.8 0 0 0 21 12a9 9 0 0 0-7-8.77v2.06A7 7 0 0 1 19 12ZM4.27 3 3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25A6.92 6.92 0 0 1 14 18.7v2.06A9 9 0 0 0 17.69 19l2 2.05L21 19.73l-9-9L4.27 3ZM12 4 9.91 6.09 12 8.18V4Z"/>
</svg>`,ll=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M3 9v6h4l5 5V4L7 9H3Zm13.5 3A4.5 4.5 0 0 0 14 8v8a4.47 4.47 0 0 0 2.5-4Z"/>
</svg>`,Sc=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M3 9v6h4l5 5V4L7 9H3Zm13.5 3A4.5 4.5 0 0 0 14 8v8a4.47 4.47 0 0 0 2.5-4ZM14 3.23v2.06a7 7 0 0 1 0 13.42v2.06a9 9 0 0 0 0-17.54Z"/>
</svg>`,dl=re.createElement("template");dl.innerHTML=`
  <style>
  
  :host(:not([${V.MEDIA_VOLUME_LEVEL}])) slot:not([name=high]) > *, 
  :host(:not([${V.MEDIA_VOLUME_LEVEL}])) ::slotted(:not([slot=high])),
  :host([${V.MEDIA_VOLUME_LEVEL}=high]) slot:not([name=high]) > *, 
  :host([${V.MEDIA_VOLUME_LEVEL}=high]) ::slotted(:not([slot=high])) {
    display: none !important;
  }

  :host([${V.MEDIA_VOLUME_LEVEL}=off]) slot:not([name=off]) > *, 
  :host([${V.MEDIA_VOLUME_LEVEL}=off]) ::slotted(:not([slot=off])) {
    display: none !important;
  }

  :host([${V.MEDIA_VOLUME_LEVEL}=low]) slot:not([name=low]) > *, 
  :host([${V.MEDIA_VOLUME_LEVEL}=low]) ::slotted(:not([slot=low])) {
    display: none !important;
  }

  :host([${V.MEDIA_VOLUME_LEVEL}=medium]) slot:not([name=medium]) > *, 
  :host([${V.MEDIA_VOLUME_LEVEL}=medium]) ::slotted(:not([slot=medium])) {
    display: none !important;
  }
  </style>

  <slot name="off">${_c}</slot>
  <slot name="low">${ll}</slot>
  <slot name="medium">${ll}</slot>
  <slot name="high">${Sc}</slot>
`;var ul=r=>{let e=r.getAttribute(V.MEDIA_VOLUME_LEVEL)==="off"?Xe.UNMUTE():Xe.MUTE();r.setAttribute("aria-label",e)},ns=class extends Ze{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_VOLUME_LEVEL]}constructor(t={}){super({slotTemplate:dl,...t})}connectedCallback(){ul(this),super.connectedCallback()}attributeChangedCallback(t,e,n){t===V.MEDIA_VOLUME_LEVEL&&ul(this),super.attributeChangedCallback(t,e,n)}handleClick(){let t=this.getAttribute(V.MEDIA_VOLUME_LEVEL)==="off"?fe.MEDIA_UNMUTE_REQUEST:fe.MEDIA_MUTE_REQUEST;this.dispatchEvent(new ie.CustomEvent(t,{composed:!0,bubbles:!0}))}};ce("media-mute-button",ns);var cl=`<svg aria-hidden="true" viewBox="0 0 28 24">
  <path d="M24 3H4a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h20a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1Zm-1 16H5V5h18v14Zm-3-8h-7v5h7v-5Z"/>
</svg>`,hl=re.createElement("template");hl.innerHTML=`
  <style>
  :host([${V.MEDIA_IS_PIP}]) slot:not([name=exit]) > *, 
  :host([${V.MEDIA_IS_PIP}]) ::slotted(:not([slot=exit])) {
    display: none !important;
  }

  
  :host(:not([${V.MEDIA_IS_PIP}])) slot:not([name=enter]) > *, 
  :host(:not([${V.MEDIA_IS_PIP}])) ::slotted(:not([slot=enter])) {
    display: none !important;
  }
  </style>

  <slot name="enter">${cl}</slot>
  <slot name="exit">${cl}</slot>
`;var fl=r=>{let e=r.getAttribute(V.MEDIA_IS_PIP)!=null?Xe.EXIT_PIP():Xe.ENTER_PIP();r.setAttribute("aria-label",e)},as=class extends Ze{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_IS_PIP,V.MEDIA_PIP_UNAVAILABLE]}constructor(t={}){super({slotTemplate:hl,...t})}connectedCallback(){fl(this),super.connectedCallback()}attributeChangedCallback(t,e,n){t===V.MEDIA_IS_PIP&&fl(this),super.attributeChangedCallback(t,e,n)}handleClick(){let t=this.getAttribute(V.MEDIA_IS_PIP)!=null?fe.MEDIA_EXIT_PIP_REQUEST:fe.MEDIA_ENTER_PIP_REQUEST;this.dispatchEvent(new ie.CustomEvent(t,{composed:!0,bubbles:!0}))}};ce("media-pip-button",as);var xc=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="m6 21 15-9L6 3v18Z"/>
</svg>`,Lc=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M6 20h4V4H6v16Zm8-16v16h4V4h-4Z"/>
</svg>`,ml=re.createElement("template");ml.innerHTML=`
  <style>
  :host([${V.MEDIA_PAUSED}]) slot[name=pause] > *, 
  :host([${V.MEDIA_PAUSED}]) ::slotted([slot=pause]) {
    display: none !important;
  }

  :host(:not([${V.MEDIA_PAUSED}])) slot[name=play] > *, 
  :host(:not([${V.MEDIA_PAUSED}])) ::slotted([slot=play]) {
    display: none !important;
  }
  </style>

  <slot name="play">${xc}</slot>
  <slot name="pause">${Lc}</slot>
`;var vl=r=>{let e=r.getAttribute(V.MEDIA_PAUSED)!=null?Xe.PLAY():Xe.PAUSE();r.setAttribute("aria-label",e)},ss=class extends Ze{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_PAUSED]}constructor(t={}){super({slotTemplate:ml,...t})}connectedCallback(){vl(this),super.connectedCallback()}attributeChangedCallback(t,e,n){t===V.MEDIA_PAUSED&&vl(this),super.attributeChangedCallback(t,e,n)}handleClick(){let t=this.getAttribute(V.MEDIA_PAUSED)!=null?fe.MEDIA_PLAY_REQUEST:fe.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new ie.CustomEvent(t,{composed:!0,bubbles:!0}))}};ce("media-play-button",ss);var gl=[1,1.25,1.5,1.75,2],Sn=1,pl=re.createElement("template");pl.innerHTML=`
  <span id="container"></span>
`;var os=class extends Ze{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_PLAYBACK_RATE,"rates"]}constructor(t={}){super({slotTemplate:pl,...t}),this._rates=gl,this.container=this.shadowRoot.querySelector("#container"),this.container.innerHTML=`${Sn}x`}attributeChangedCallback(t,e,n){if(t==="rates"){let a=(n!=null?n:"").trim().split(/\s*,?\s+/).map(u=>Number(u)).filter(u=>!Number.isNaN(u)).sort((u,M)=>u-M);this._rates=a.length?a:gl;return}if(t===V.MEDIA_PLAYBACK_RATE){let a=n?+n:Number.NaN,u=Number.isNaN(a)?Sn:a;this.container.innerHTML=`${u}x`,this.setAttribute("aria-label",dt.PLAYBACK_RATE({playbackRate:u}));return}super.attributeChangedCallback(t,e,n)}handleClick(){var t,e;let n=+this.getAttribute(V.MEDIA_PLAYBACK_RATE)||Sn,a=(e=(t=this._rates.find(M=>M>n))!=null?t:this._rates[0])!=null?e:Sn,u=new ie.CustomEvent(fe.MEDIA_PLAYBACK_RATE_REQUEST,{composed:!0,bubbles:!0,detail:a});this.dispatchEvent(u)}};ce("media-playback-rate-button",os);var El=re.createElement("template");El.innerHTML=`
  <style>
    :host {
      pointer-events: none;
      display: inline-block;
      box-sizing: border-box;
    }

    img {
      max-width: 100%;
      max-height: 100%;
      min-width: 100%;
      min-height: 100%;
      background-repeat: no-repeat;
      background-position: var(--media-background-position, var(--media-object-position, center));
      background-size: var(--media-background-size, var(--media-object-fit, contain));
      object-fit: var(--media-object-fit, contain);
      object-position: var(--media-object-position, center);
    }

    :host([${V.MEDIA_HAS_PLAYED}]) img {
      display: none;
    }
  </style>

  <img aria-hidden="true" id="image"/>
`;var Dc=r=>{r.style.removeProperty("background-image")},Ic=(r,t)=>{r.style["background-image"]=`url('${t}')`},ls=class extends ie.HTMLElement{static get observedAttributes(){return[V.MEDIA_HAS_PLAYED,"placeholder-src","src"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(El.content.cloneNode(!0)),this.image=this.shadowRoot.querySelector("#image")}attributeChangedCallback(t,e,n){t==="src"&&(n==null?this.image.removeAttribute("src"):this.image.setAttribute("src",n)),t==="placeholder-src"&&(n==null?Dc(this.image):Ic(this.image,n))}};ce("media-poster-image",ls);var vs=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)},st=(r,t,e)=>(vs(r,t,"read from private field"),e?e.call(r):t.get(r)),St=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},dr=(r,t,e,n)=>(vs(r,t,"write to private field"),n?n.call(r,e):t.set(r,e),e),Ri=(r,t,e)=>(vs(r,t,"access private method"),e),Mi,xn,Ci,Rn,Mn,Ln,ds,Dn,Qr,Oi,cs,Cn,Pn,In,fs,hs,yl,Rc="video not loaded, unknown time.",us=r=>{let t=r.range,e=xr(+t.value),n=xr(+t.max),a=e&&n?`${e} of ${n}`:Rc;t.setAttribute("aria-valuetext",a)},Tl=re.createElement("template");Tl.innerHTML=`
  <style>
    :host {
      --media-preview-background-color: rgba(20,20,30, .5);
      --media-preview-background: var(--media-control-background,
        var(--media-preview-background-color));
      --media-preview-border-radius: 3px;
      --media-box-padding-left: 10px;
      --media-box-padding-right: 10px;
      color: #fff;
    }

    #preview-rail,
    #current-rail {
      
      width: 1%;
      position: absolute;
      left: 0;
      bottom: 100%;
      pointer-events: none;
    }

    [part~="box"] {
      
      position: absolute;
      bottom: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      transform: translateX(-50%);
    }

    [part~="preview-box"] {
      transition: visibility .25s, opacity .25s;
      visibility: hidden;
      opacity: 0;
    }

    media-preview-thumbnail,
    ::slotted(media-preview-thumbnail) {
      visibility: hidden;
      transition: visibility 0s .25s;
      background: var(--media-preview-time-background, var(--media-preview-background));
      box-shadow: var(--media-preview-thumbnail-box-shadow, 0 0 4px rgba(0,0,0, .2));
      max-width: var(--media-preview-thumbnail-max-width, 180px);
      max-height: var(--media-preview-thumbnail-max-height, 160px);
      min-width: var(--media-preview-thumbnail-min-width, 120px);
      min-height: var(--media-preview-thumbnail-min-height, 80px);
      border: var(--media-preview-thumbnail-border);
      border-radius: var(--media-preview-thumbnail-border-radius,
        var(--media-preview-border-radius) var(--media-preview-border-radius) 0 0);
    }

    :host([${V.MEDIA_PREVIEW_IMAGE}]:hover) media-preview-thumbnail,
    :host([${V.MEDIA_PREVIEW_IMAGE}]:hover) ::slotted(media-preview-thumbnail) {
      transition-delay: 0s;
      visibility: visible;
    }

    media-preview-time-display,
    ::slotted(media-preview-time-display) {
      color: unset;
      min-width: 0;
      
      transition: min-width 0s .25s, border-radius 0s .25s;
      background: var(--media-preview-time-background, var(--media-preview-background));
      border-radius: var(--media-preview-time-border-radius,
        var(--media-preview-border-radius) var(--media-preview-border-radius)
        var(--media-preview-border-radius) var(--media-preview-border-radius));
      padding: var(--media-preview-time-padding, 1px 10px 0);
      margin: var(--media-preview-time-margin, 0 0 10px);
      text-shadow: var(--media-preview-time-text-shadow, 0 0 4px rgba(0,0,0, .75));
    }

    :host([${V.MEDIA_PREVIEW_IMAGE}]) media-preview-time-display,
    :host([${V.MEDIA_PREVIEW_IMAGE}]) ::slotted(media-preview-time-display) {
      transition-delay: 0s;
      min-width: 100%;
      border-radius: var(--media-preview-time-border-radius,
        0 0 var(--media-preview-border-radius) var(--media-preview-border-radius));
    }

    :host([${V.MEDIA_PREVIEW_IMAGE}]:hover) [part~="preview-box"],
    :host([${V.MEDIA_PREVIEW_TIME}]:hover) [part~="preview-box"] {
      transition: visibility .5s, opacity .5s;
      visibility: visible;
      opacity: 1;
    }

    :host([${V.MEDIA_PREVIEW_TIME}]:hover) {
      --media-time-range-hover-display: block;
    }
  </style>
  <div id="preview-rail">
    <slot name="preview" part="box preview-box">
      <media-preview-thumbnail></media-preview-thumbnail>
      <media-preview-time-display></media-preview-time-display>
    </slot>
  </div>
  <div id="current-rail">
    <slot name="current" part="box current-box">
      
    </slot>
  </div>
`;var On=class extends Ii{constructor(){super(),St(this,Ln),St(this,In),St(this,hs),St(this,Mi,void 0),St(this,xn,void 0),St(this,Ci,void 0),St(this,Rn,void 0),St(this,Mn,void 0),St(this,Dn,e=>{if([...st(this,Mi)].some(A=>e.composedPath().includes(A)))return;this.updatePointerBar(e);let n=+this.getAttribute(V.MEDIA_DURATION);if(!n)return;let a=this.range.getBoundingClientRect(),u=(e.clientX-a.left)/a.width;u=Math.max(0,Math.min(1,u));let M=Ri(this,Ln,ds).call(this,st(this,xn),u),{style:C}=qt(this.shadowRoot,"#preview-rail");C.transform=`translateX(${M})`;let O=u*n,L=new ie.CustomEvent(fe.MEDIA_PREVIEW_REQUEST,{composed:!0,bubbles:!0,detail:O});this.dispatchEvent(L)}),St(this,Qr,!1),St(this,Oi,e=>{(!e.composedPath().includes(this)||[...st(this,Mi)].some(n=>e.composedPath().includes(n)))&&(ie.removeEventListener("pointermove",st(this,Oi)),dr(this,Qr,!1),st(this,Cn).call(this))}),St(this,cs,()=>{ie.addEventListener("pointermove",st(this,Dn),!1)}),St(this,Cn,()=>{ie.removeEventListener("pointermove",st(this,Dn));let e=new ie.CustomEvent(fe.MEDIA_PREVIEW_REQUEST,{composed:!0,bubbles:!0,detail:null});this.dispatchEvent(e)}),St(this,Pn,()=>{let e=this.getAttribute(V.MEDIA_DURATION);!st(this,Qr)&&e&&(dr(this,Qr,!0),st(this,cs).call(this),ie.addEventListener("pointermove",st(this,Oi),!1))}),this.container.appendChild(Tl.content.cloneNode(!0)),this.range.addEventListener("input",()=>{cancelAnimationFrame(this._refreshId);let n=this.range.value,a=new ie.CustomEvent(fe.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:n});this.dispatchEvent(a)}),this._refreshBar=()=>{let e=(performance.now()-this._updateTimestamp)/1e3;this.range.value=this.mediaCurrentTime+e*this.mediaPlaybackRate,this.updateBar(),this.updateCurrentBox(),this._refreshId=requestAnimationFrame(this._refreshBar)},dr(this,Mi,this.shadowRoot.querySelectorAll('[part~="box"]')),dr(this,xn,this.shadowRoot.querySelector('[part~="preview-box"]')),dr(this,Ci,this.shadowRoot.querySelector('[part~="current-box"]'));let t=getComputedStyle(this);dr(this,Rn,parseInt(t.getPropertyValue("--media-box-padding-left"))),dr(this,Mn,parseInt(t.getPropertyValue("--media-box-padding-right"))),Ri(this,In,fs).call(this)}static get observedAttributes(){return[...super.observedAttributes,"thumbnails","disabled",V.MEDIA_PAUSED,V.MEDIA_DURATION,V.MEDIA_SEEKABLE,V.MEDIA_CURRENT_TIME,V.MEDIA_PREVIEW_IMAGE,V.MEDIA_PREVIEW_TIME,V.MEDIA_BUFFERED,V.MEDIA_PLAYBACK_RATE,V.MEDIA_LOADING]}connectedCallback(){this.range.setAttribute("aria-label",dt.SEEK()),super.connectedCallback()}disconnectedCallback(){cancelAnimationFrame(this._refreshId),super.disconnectedCallback()}attributeChangedCallback(t,e,n){var a,u,M,C,O;(t===V.MEDIA_CURRENT_TIME||t===V.MEDIA_PAUSED||t===V.MEDIA_LOADING)&&(this._updateTimestamp=performance.now(),this.range.value=this.mediaCurrentTime,us(this),this.updateBar(),this.updateCurrentBox(),cancelAnimationFrame(this._refreshId),!this.mediaPaused&&!this.mediaLoading&&(this._refreshId=requestAnimationFrame(this._refreshBar))),t===V.MEDIA_DURATION&&(this.range.max=Math.floor((u=(a=this.mediaSeekableEnd)!=null?a:this.mediaDuration)!=null?u:1e3),us(this),this.updateBar(),this.updateCurrentBox()),t===V.MEDIA_SEEKABLE&&(this.range.min=(M=this.mediaSeekableStart)!=null?M:0,this.range.max=Math.floor((O=(C=this.mediaSeekableEnd)!=null?C:this.mediaDuration)!=null?O:1e3),us(this),this.updateBar()),t===V.MEDIA_BUFFERED&&this.updateBar(),t==="disabled"&&(n==null?Ri(this,In,fs).call(this):Ri(this,hs,yl).call(this)),super.attributeChangedCallback(t,e,n)}get mediaPaused(){return this.hasAttribute(V.MEDIA_PAUSED)}get mediaLoading(){return this.hasAttribute(V.MEDIA_LOADING)}get mediaDuration(){let t=this.getAttribute(V.MEDIA_DURATION);return t!=null?+t:void 0}get mediaCurrentTime(){let t=this.getAttribute(V.MEDIA_CURRENT_TIME);return t!=null?+t:void 0}get mediaPlaybackRate(){let t=this.getAttribute(V.MEDIA_PLAYBACK_RATE);return t!=null?+t:1}get mediaBuffered(){let t=this.getAttribute(V.MEDIA_BUFFERED);return t?t.split(" ").map(e=>e.split(":").map(n=>+n)):[]}get mediaSeekable(){let t=this.getAttribute(V.MEDIA_SEEKABLE);if(!!t)return t.split(":").map(e=>+e)}get mediaSeekableEnd(){var t;let[,e]=(t=this.mediaSeekable)!=null?t:[];return e}get mediaSeekableStart(){var t;let[e]=(t=this.mediaSeekable)!=null?t:[];return e}getBarColors(){var t;let e=super.getBarColors(),{range:n}=this,a=n.max-n.min,u=this.mediaBuffered;if(!u.length||!Number.isFinite(a)||a<=0)return e;let M=this.mediaCurrentTime,[,C=n.min]=(t=u.find(([A,x])=>A<=M&&M<=x))!=null?t:[],L=(C-n.min)/a*100;return e.splice(1,0,["var(--media-time-buffered-color, rgba(255,255,255, .4))",L]),e}updateCurrentBox(){if(!st(this,Ci).assignedElements().length)return;let t=this.range.value/(this.range.max-this.range.min),e=Ri(this,Ln,ds).call(this,st(this,Ci),t),{style:n}=qt(this.shadowRoot,"#current-rail");n.transform=`translateX(${e})`}};Mi=new WeakMap;xn=new WeakMap;Ci=new WeakMap;Rn=new WeakMap;Mn=new WeakMap;Ln=new WeakSet;ds=function(r,t){var e;let n=`${t*100*100}%`,a=r.offsetWidth;if(!a)return n;let u=(e=this.getAttribute("bounds")?bi(this,`#${this.getAttribute("bounds")}`):this.parentElement)!=null?e:this,M=this.range.getBoundingClientRect(),C=u.getBoundingClientRect(),O=(st(this,Rn)-(M.left-C.left-a/2))/M.width*100,L=(C.right-M.left-a/2-st(this,Mn))/M.width*100;return Number.isNaN(O)||(n=`max(${O*100}%, ${n})`),Number.isNaN(L)||(n=`min(${n}, ${L*100}%)`),n};Dn=new WeakMap;Qr=new WeakMap;Oi=new WeakMap;cs=new WeakMap;Cn=new WeakMap;Pn=new WeakMap;In=new WeakSet;fs=function(){this.addEventListener("pointermove",st(this,Pn),!1)};hs=new WeakSet;yl=function(){ie.removeEventListener("pointermove",st(this,Oi)),this.removeEventListener("pointermove",st(this,Pn)),dr(this,Qr,!1),st(this,Cn).call(this)};ce("media-time-range",On);var ms=On;var gs=class extends ms{constructor(){super(),console.warn("MediaChrome: <media-progress-range> is deprecated. Use <media-time-range> instead.")}};ce("media-progress-range",gs);var ps="30",Mc=`<svg aria-hidden="true" viewBox="0 0 20 24"><defs><style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style></defs><text class="text value" transform="translate(2.18 19.87)">${ps}</text><path d="M10 6V3L4.37 7 10 10.94V8a5.54 5.54 0 0 1 1.9 10.48v2.12A7.5 7.5 0 0 0 10 6Z"/></svg>`,_l=re.createElement("template");_l.innerHTML=`  
  <slot name="backward">${Mc}</slot>
`;var Cc=0,bl=r=>{let t=Math.abs(+r.getAttribute("seek-offset")),e=Xe.SEEK_BACK_N_SECS({seekOffset:t});r.setAttribute("aria-label",e)},Al=r=>{let t=fn(r,"backward"),e=r.getAttribute("seek-offset");cn(t,e)},Es=class extends Ze{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_CURRENT_TIME]}constructor(t={}){super({slotTemplate:_l,...t})}connectedCallback(){this.hasAttribute("seek-offset")||this.setAttribute("seek-offset",ps),bl(this),Al(this),super.connectedCallback()}attributeChangedCallback(t,e,n){t==="seek-offset"&&(n==null&&this.setAttribute("seek-offset",ps),Al(this),bl(this)),super.attributeChangedCallback(t,e,n)}handleClick(){let t=this.getAttribute(V.MEDIA_CURRENT_TIME),e=+this.getAttribute("seek-offset"),n=t&&!Number.isNaN(+t)?+t:Cc,a=Math.max(n-e,0),u=new ie.CustomEvent(fe.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:a});this.dispatchEvent(u)}};ce("media-seek-backward-button",Es);var ys=class extends ur{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_PREVIEW_TIME]}attributeChangedCallback(t,e,n){t===V.MEDIA_PREVIEW_TIME&&n!=null&&(this.container.textContent=Xt(n)),super.attributeChangedCallback(t,e,n)}};ce("media-preview-time-display",ys);var Sl=re.createElement("template");Sl.innerHTML=`
  <style>
    :host {
      box-sizing: border-box;
      display: inline-block;
      overflow: hidden;
    }

    img {
      display: none;
      position: relative;
    }
  </style>
  <img crossorigin loading="eager" decoding="async" />
`;var Ts=class extends ie.HTMLElement{static get observedAttributes(){return[Le.MEDIA_CONTROLLER,"time",V.MEDIA_PREVIEW_IMAGE,V.MEDIA_PREVIEW_COORDS]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Sl.content.cloneNode(!0))}connectedCallback(){var t;let e=this.getAttribute(Le.MEDIA_CONTROLLER);if(e){let n=re.getElementById(e);(t=n==null?void 0:n.associateElement)==null||t.call(n,this)}}disconnectedCallback(){var t;let e=this.getAttribute(Le.MEDIA_CONTROLLER);if(e){let n=re.getElementById(e);(t=n==null?void 0:n.unassociateElement)==null||t.call(n,this)}}attributeChangedCallback(t,e,n){var a,u;if(["time",V.MEDIA_PREVIEW_IMAGE,V.MEDIA_PREVIEW_COORDS].includes(t)&&this.update(),t===Le.MEDIA_CONTROLLER){if(e){let M=re.getElementById(e);(a=M==null?void 0:M.unassociateElement)==null||a.call(M,this)}if(n){let M=re.getElementById(n);(u=M==null?void 0:M.associateElement)==null||u.call(M,this)}}}update(){let t=this.getAttribute(V.MEDIA_PREVIEW_COORDS),e=this.getAttribute(V.MEDIA_PREVIEW_IMAGE);if(!(t&&e))return;let[n,a,u,M]=t.split(/\s+/).map(o=>+o),C=e.split("#")[0],O=getComputedStyle(this),{maxWidth:L,maxHeight:A,minWidth:x,minHeight:I}=O,_=Math.min(parseInt(L)/u,parseInt(A)/M),b=Math.max(parseInt(x)/u,parseInt(I)/M),S=_<1,v=S?_:b>1?b:1,{style:i}=qt(this.shadowRoot,":host"),d=qt(this.shadowRoot,"img").style,p=this.shadowRoot.querySelector("img"),T=S?"min":"max";i.setProperty(`${T}-width`,"initial","important"),i.setProperty(`${T}-height`,"initial","important"),i.width=`${u*v}px`,i.height=`${M*v}px`;let l=()=>{d.width=`${this.imgWidth*v}px`,d.height=`${this.imgHeight*v}px`,d.display="block"};p.src!==C&&(p.onload=()=>{this.imgWidth=p.naturalWidth,this.imgHeight=p.naturalHeight,l()},p.src=C,l()),l(),d.transform=`translate(-${n*v}px, -${a*v}px)`}};ce("media-preview-thumbnail",Ts);var xl=re.createElement("template"),Oc=`
<svg aria-hidden="true" viewBox="0 0 100 100">
  <path d="M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50">
    <animateTransform
       attributeName="transform"
       attributeType="XML"
       type="rotate"
       dur="1s"
       from="0 50 50"
       to="360 50 50"
       repeatCount="indefinite" />
  </path>
</svg>
`;xl.innerHTML=`
<style>
:host {
  display: inline-block;
  vertical-align: middle;
  box-sizing: border-box;
}

#status {
  color: rgba(0,0,0,0);
  width: 0px;
  height: 0px;
}

:host slot[name=loading] > *,
:host ::slotted([slot=loading]) {
  opacity: 1;
  transition: opacity 0.15s;
}

:host(:not([is-loading])) slot[name=loading] > *, 
:host(:not([is-loading])) ::slotted([slot=loading]) {
  opacity: 0;
}

:host(:not([is-loading])) #status {
  display: none;
}

svg, img, ::slotted(svg), ::slotted(img) {
  width: var(--media-loading-icon-width, 100px);
  height: var(--media-loading-icon-height);
  fill: var(--media-icon-color, #fff);
  vertical-align: middle;
}
</style>

<slot name="loading">${Oc}</slot>
<div id="status" role="status" aria-live="polite">${dt.MEDIA_LOADING()}</div>
`;var Pc=500,bs=class extends ie.HTMLElement{static get observedAttributes(){return[Le.MEDIA_CONTROLLER,V.MEDIA_PAUSED,V.MEDIA_LOADING,"loading-delay"]}constructor(){super();let t=this.attachShadow({mode:"open"}),e=xl.content.cloneNode(!0);t.appendChild(e)}attributeChangedCallback(t,e,n){var a,u,M;if(t===V.MEDIA_LOADING||t===V.MEDIA_PAUSED){let C=this.getAttribute(V.MEDIA_PAUSED)!=null,O=this.getAttribute(V.MEDIA_LOADING)!=null,L=!C&&O;if(!L)this.loadingDelayHandle&&(clearTimeout(this.loadingDelayHandle),this.loadingDelayHandle=void 0),this.removeAttribute("is-loading");else if(!this.loadingDelayHandle&&L){let A=+((a=this.getAttribute("loading-delay"))!=null?a:Pc);this.loadingDelayHandle=setTimeout(()=>{this.setAttribute("is-loading",""),this.loadingDelayHandle=void 0},A)}}else if(t===Le.MEDIA_CONTROLLER){if(e){let C=re.getElementById(e);(u=C==null?void 0:C.unassociateElement)==null||u.call(C,this)}if(n){let C=re.getElementById(n);(M=C==null?void 0:C.associateElement)==null||M.call(C,this)}}}connectedCallback(){var t;let e=this.getAttribute(Le.MEDIA_CONTROLLER);if(e){let n=re.getElementById(e);(t=n==null?void 0:n.associateElement)==null||t.call(n,this)}}disconnectedCallback(){var t;this.loadingDelayHandle&&(clearTimeout(this.loadingDelayHandle),this.loadingDelayHandle=void 0);let e=this.getAttribute(Le.MEDIA_CONTROLLER);if(e){let n=re.getElementById(e);(t=n==null?void 0:n.unassociateElement)==null||t.call(n,this)}}};ce("media-loading-indicator",bs);var Ll=re.createElement("template");Ll.innerHTML=`
  <style>
    :host {
    }
  </style>
  <slot></slot>
`;var As=class extends ie.HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Ll.content.cloneNode(!0))}};ce("media-title-bar",As);var kc=100,wc=r=>{var t;if(r.getAttribute(V.MEDIA_MUTED)!=null)return 0;let n=+((t=r.getAttribute(V.MEDIA_VOLUME))!=null?t:1);return Math.round(n*r.range.max)},Uc=({value:r,max:t})=>`${Math.round(r/t*100)}%`,_s=class extends Ii{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_VOLUME,V.MEDIA_MUTED,V.MEDIA_VOLUME_UNAVAILABLE]}constructor(){super(),this.range.max=kc,this.range.addEventListener("input",()=>{let e=this.range.value/this.range.max,n=new ie.CustomEvent(fe.MEDIA_VOLUME_REQUEST,{composed:!0,bubbles:!0,detail:e});this.dispatchEvent(n)})}connectedCallback(){this.range.setAttribute("aria-label",dt.VOLUME()),super.connectedCallback()}attributeChangedCallback(t,e,n){if(t===V.MEDIA_VOLUME||t===V.MEDIA_MUTED){let a=wc(this);this.range.value=a,this.range.setAttribute("aria-valuetext",Uc(this.range)),this.updateBar()}super.attributeChangedCallback(t,e,n)}};ce("media-volume-range",_s);var Nc=Object.defineProperty,Bc=(r,t,e)=>t in r?Nc(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Fc=(r,t,e)=>(Bc(r,typeof t!="symbol"?t+"":t,e),e),kn=class extends ie.HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}render(){this.shadowRoot.textContent="";let t=re.createElement("template");t.innerHTML=this.constructor.template,this.shadowRoot.append(t.content.cloneNode(!0))}get mediaController(){return this.shadowRoot.querySelector("media-controller")}};Fc(kn,"template","");ce("media-theme-base",kn);var Ss=class extends Di{};ie.customElements.get("media-chrome")||ie.customElements.define("media-chrome",Ss);var xs=class extends Di{constructor(){super(),console.warn("MediaChrome: <media-container> is deprecated. Use <media-controller>.")}};ie.customElements.get("media-container")||ie.customElements.define("media-container",xs);var Nn=an(Dl(),1),Ir=an(Un(),1),Rs=an(Un(),1),Zr=an(Un(),1),ki=class extends Error{constructor(r,t=ki.MEDIA_ERR_CUSTOM,e){var n;super(r),this.name="MediaError",this.code=t,this.fatal=e!=null?e:t>=ki.MEDIA_ERR_NETWORK&&t<=ki.MEDIA_ERR_ENCRYPTED,this.message||(this.message=(n=ki.defaultMessages[this.code])!=null?n:"")}},$e=ki;$e.MEDIA_ERR_ABORTED=1,$e.MEDIA_ERR_NETWORK=2,$e.MEDIA_ERR_DECODE=3,$e.MEDIA_ERR_SRC_NOT_SUPPORTED=4,$e.MEDIA_ERR_ENCRYPTED=5,$e.MEDIA_ERR_CUSTOM=100,$e.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail.",3:"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.",4:"An unsupported error occurred. The server or network failed, or your browser does not support this format.",5:"The media is encrypted and there are no keys to decrypt it."};var Pl=(r,t)=>r in t,Ms={ANY:"any",MUTED:"muted"},we={VOD:"on-demand",ON_DEMAND:"on-demand",LIVE:"live",LL_LIVE:"ll-live",DVR:"live:dvr",LL_DVR:"ll-live:dvr"},kt={MSE:"mse",NATIVE:"native"},Cs={HEADER:"header",QUERY:"query",NONE:"none"},qr=Object.values(Cs),Jr={M3U8:"application/vnd.apple.mpegurl",MP4:"video/mp4"},Os={HLS:Jr.M3U8},Cp=Object.keys(Os),Op=[...Object.values(Jr),"hls","HLS"],wi=(r,t,e,n)=>{r.addEventListener(t,e,n),r.addEventListener("teardown",()=>{r.removeEventListener(t,e)},{once:!0})};function Kc(r,t,e){t&&e>t&&(e=t);for(let n=0;n<r.length;n++)if(r.start(n)<=e&&r.end(n)>=e)return!0;return!1}var Wc=r=>{let t=r.indexOf("?");if(t<0)return[r];let e=r.slice(0,t),n=r.slice(t);return[e,n]},kl=r=>{let t=r.type;if(t){let n=t.toUpperCase();return Pl(n,Os)?Os[n]:t}let{src:e}=r;return e?Hc(e):""},Hc=r=>{let t="";try{t=new URL(r).pathname}catch{console.error("invalid url")}let e=t.lastIndexOf(".");if(e<0)return"";let n=t.slice(e+1).toUpperCase();return Pl(n,Jr)?Jr[n]:""},Gc=Object.values(Ms),Il=r=>typeof r=="boolean"||typeof r=="string"&&Gc.includes(r),jc=({autoplay:r},t,e)=>{let n=!1,a=!1,u=Il(r)?r:!!r,M=()=>{n||wi(t,"playing",()=>{n=!0},{once:!0})};if(M(),wi(t,"loadstart",()=>{n=!1,M(),Is(t,u)},{once:!0}),wi(t,"loadstart",()=>{e||(a=!Number.isFinite(t.duration)),Is(t,u)},{once:!0}),e&&e.once(Rs.default.Events.LEVEL_LOADED,(C,O)=>{var L;a=(L=O.details.live)!=null?L:!1}),!u){let C=()=>{!a||(e!=null&&e.liveSyncPosition?t.currentTime=e.liveSyncPosition:Number.isFinite(t.seekable.end(0))&&(t.currentTime=t.seekable.end(0)))};e&&wi(t,"play",()=>{t.preload==="metadata"?e.once(Rs.default.Events.LEVEL_UPDATED,C):C()},{once:!0})}return C=>{n||(u=Il(C)?C:!!C,Is(t,u))}},Is=(r,t)=>{if(!t)return;let e=r.muted,n=()=>r.muted=e;switch(t){case Ms.ANY:r.play().catch(()=>{r.muted=!0,r.play().catch(n)});break;case Ms.MUTED:r.muted=!0,r.play().catch(n);break;default:r.play().catch(()=>{});break}},Vc=({preload:r,src:t},e,n)=>{let a=x=>{x!=null&&["","none","metadata","auto"].includes(x)?e.setAttribute("preload",x):e.removeAttribute("preload")};if(!n)return a(r),a;let u=!1,M=!1,C=n.config.maxBufferLength,O=n.config.maxBufferSize,L=x=>{a(x);let I=x!=null?x:e.preload;M||I==="none"||(I==="metadata"?(n.config.maxBufferLength=1,n.config.maxBufferSize=1):(n.config.maxBufferLength=C,n.config.maxBufferSize=O),A())},A=()=>{!u&&t&&(u=!0,n.loadSource(t))};return wi(e,"play",()=>{M=!0,n.config.maxBufferLength=C,n.config.maxBufferSize=O,A()},{once:!0}),L(r),L};function $c(r,t){t.on(Zr.default.Events.NON_NATIVE_TEXT_TRACKS_FOUND,(a,{tracks:u})=>{u.forEach(M=>{var C;let O=(C=M.subtitleTrack)!=null?C:M.closedCaptions,L=t.subtitleTracks.findIndex(({lang:A,name:x,type:I})=>A==(O==null?void 0:O.lang)&&x===M.label&&I.toLowerCase()===M.kind);ks(r,M.kind,M.label,O==null?void 0:O.lang,`${M.kind}${L}`)})});let e=()=>{var a;if(!t.subtitleTracks.length)return;let u=Array.from(r.textTracks).find(C=>C.id&&C.mode==="showing"&&["subtitles","captions"].includes(C.kind)),M=`${(a=t.subtitleTracks[t.subtitleTrack])==null?void 0:a.type.toLowerCase()}${t.subtitleTrack}`;if(u&&(t.subtitleTrack<0||(u==null?void 0:u.id)!==M)){let C=t.subtitleTracks.findIndex(({lang:O,name:L,type:A})=>O==u.language&&L===u.label&&A.toLowerCase()===u.kind);t.subtitleTrack=C}u&&(u==null?void 0:u.id)===M&&u.cues&&Array.from(u.cues).forEach(C=>{u.addCue(C)})};r.textTracks.addEventListener("change",e),t.on(Zr.default.Events.CUES_PARSED,(a,{track:u,cues:M})=>{let C=r.textTracks.getTrackById(u);if(!C)return;let O=C.mode==="disabled";O&&(C.mode="hidden"),M.forEach(L=>{var A;(A=C.cues)!=null&&A.getCueById(L.id)||C.addCue(L)}),O&&(C.mode="disabled")}),t.once(Zr.default.Events.DESTROYING,()=>{r.textTracks.removeEventListener("change",e),r.querySelectorAll("track[data-removeondestroy]").forEach(a=>{a.remove()})});let n=()=>{Array.from(r.textTracks).forEach(a=>{var u,M;if(!["subtitles","caption"].includes(a.kind)&&a.label==="thumbnails"){if(!((u=a.cues)!=null&&u.length)){let C=r.querySelector('track[label="thumbnails"]'),O=(M=C==null?void 0:C.getAttribute("src"))!=null?M:"";C==null||C.removeAttribute("src"),setTimeout(()=>{C==null||C.setAttribute("src",O)},0)}a.mode!=="hidden"&&(a.mode="hidden")}})};t.once(Zr.default.Events.MANIFEST_LOADED,n),t.once(Zr.default.Events.MEDIA_ATTACHED,n)}function ks(r,t,e,n,a){let u=document.createElement("track");return u.kind=t,u.label=e,n&&(u.srclang=n),a&&(u.id=a),u.track.mode="disabled",u.setAttribute("data-removeondestroy",""),r.append(u),u.track}function wl(r,t){let e=Array.prototype.find.call(r.querySelectorAll("track"),n=>n.track===t);e==null||e.remove()}var Rl,Ml,Yc=(Ml=(Rl=globalThis==null?void 0:globalThis.navigator)==null?void 0:Rl.userAgent)!=null?Ml:"",zc=Yc.toLowerCase().indexOf("android")!==-1,ei=new WeakMap,Ul="mux.com",Cl,Ol,Nl=(Ol=(Cl=Ir.default).isSupported)==null?void 0:Ol.call(Cl),Xc=zc,Bl=()=>Nn.default.utils.now(),Qc=Nn.default.utils.generateUUID,Fl=(r,{domain:t=Ul}={})=>{if(!r)return;let[e,n=""]=Wc(r);return`https://stream.${t}/${e}.m3u8${n}`},Zc=r=>{if(!r)return;let[t]=r.split("?");return t||void 0},Jc=r=>{if(!r||!r.startsWith("https://stream."))return;let[t]=new URL(r).pathname.slice(1).split(".m3u8");return t||void 0},qc=r=>{var t,e,n;return(t=r==null?void 0:r.metadata)!=null&&t.video_id?r.metadata.video_id:Gl(r)&&(n=(e=Zc(r.playbackId))!=null?e:Jc(r.src))!=null?n:r.src},Kl=r=>{var t;return(t=ei.get(r))==null?void 0:t.error},Wl=(r,t,e)=>{ws(t,e);let{metadata:n={}}=r,{view_session_id:a=Qc()}=n,u=qc(r);n.view_session_id=a,n.video_id=u,r.metadata=n,ei.set(t,{});let M=ef(r,t);rf(r,t,M),nf(r,t,M);let C=jc(r,t,M),O=Vc(r,t,M);return{engine:M,setAutoplay:C,setPreload:O}},ws=(r,t)=>{let e=t==null?void 0:t.engine;e&&(e.detachMedia(),e.destroy()),(r==null?void 0:r.mux)&&!r.mux.deleted&&(r.mux.destroy(),delete r.mux),r&&(r.removeAttribute("src"),r.load(),r.removeEventListener("error",Vl),r.removeEventListener("error",Ps),r.removeEventListener("durationchange",jl),ei.delete(r),r.dispatchEvent(new Event("teardown")))};function Hl(r,t){var e;let n=kl(r);if(n!==Jr.M3U8)return!0;let a=!n||((e=t.canPlayType(n))!=null?e:!0),{preferPlayback:u}=r,M=u===kt.MSE,C=u===kt.NATIVE;return a&&(C||!(Nl&&(M||Xc)))}var ef=(r,t)=>{let{debug:e,streamType:n,startTime:a=-1,metadata:u,preferCmcd:M}=r,C=kl(r)===Jr.M3U8,O=Hl(r,t);if(C&&!O&&Nl){let L={backBufferLength:30,renderTextTracksNatively:!1,liveDurationInfinity:!0},A=tf(n),x=M!==Cs.NONE?{useHeaders:M===Cs.HEADER,sessionId:u.view_session_id,contentId:u.video_id}:void 0;return new Ir.default({debug:e,startPosition:a,cmcd:x,...L,...A})}},tf=r=>[we.LIVE,we.DVR].includes(r)?{backBufferLength:8}:[we.LL_LIVE,we.LL_DVR].includes(r)?{backBufferLength:4,maxFragLookUpTolerance:.001}:{},Gl=({playbackId:r,src:t,customDomain:e})=>{if(r)return!0;if(typeof t!="string")return!1;let n=window==null?void 0:window.location.href,a=new URL(t,n).hostname.toLocaleLowerCase();return a.includes(Ul)||!!e&&a.includes(e.toLocaleLowerCase())},rf=(r,t,e)=>{var n;let{envKey:a}=r,u=Gl(r);if(a||u){let{playerInitTime:M,playerSoftwareName:C,playerSoftwareVersion:O,beaconCollectionDomain:L,debug:A,disableCookies:x}=r,I={...r.metadata,video_title:((n=r==null?void 0:r.metadata)==null?void 0:n.video_title)||void 0},_=b=>typeof b.player_error_code=="string"?!1:typeof r.errorTranslator=="function"?r.errorTranslator(b):b;Nn.default.monitor(t,{debug:A,beaconCollectionDomain:L,hlsjs:e,Hls:e?Ir.default:void 0,automaticErrorTracking:!1,errorTranslator:_,disableCookies:x,data:{...a?{env_key:a}:{},player_software_name:C,player_software:C,player_software_version:O,player_init_time:M,...I}})}},nf=(r,t,e)=>{var n;let a=Hl(r,t),{src:u}=r;t&&a?(typeof u=="string"?(t.setAttribute("src",u),r.startTime&&(((n=ei.get(t))!=null?n:{}).startTime=r.startTime,t.addEventListener("durationchange",jl,{once:!0}))):t.removeAttribute("src"),t.addEventListener("error",Vl),t.addEventListener("error",Ps)):e&&u?(e.on(Ir.default.Events.ERROR,(M,C)=>{let O={[Ir.default.ErrorTypes.NETWORK_ERROR]:$e.MEDIA_ERR_NETWORK,[Ir.default.ErrorTypes.MEDIA_ERROR]:$e.MEDIA_ERR_DECODE},L=new $e("",O[C.type]);L.fatal=C.fatal,L.data=C,t.dispatchEvent(new CustomEvent("error",{detail:L}))}),t.addEventListener("error",Ps),$c(t,e),e.attachMedia(t)):console.error("It looks like the video you're trying to play will not work on this system! If possible, try upgrading to the newest versions of your browser or software.")};function jl(r){var t;let e=r.target,n=(t=ei.get(e))==null?void 0:t.startTime;if(!!n&&Kc(e.seekable,e.duration,n)){let a=e.preload==="auto";a&&(e.preload="none"),e.currentTime=n,a&&(e.preload="auto")}}async function Vl(r){if(!r.isTrusted)return;r.stopImmediatePropagation();let t=r.target;if(!(t!=null&&t.error))return;let{message:e,code:n}=t.error,a=new $e(e,n);if(t.src&&(n!==$e.MEDIA_ERR_DECODE||n!==void 0))try{let{status:u}=await fetch(t.src);a.data={response:{code:u}}}catch{}t.dispatchEvent(new CustomEvent("error",{detail:a}))}function Ps(r){var t,e;if(!(r instanceof CustomEvent)||!(r.detail instanceof $e))return;let n=r.target,a=r.detail;!a||!a.fatal||(((t=ei.get(n))!=null?t:{}).error=a,(e=n.mux)==null||e.emit("error",{player_error_code:a.code,player_error_message:a.message}))}var af=Object.defineProperty,sf=(r,t,e)=>t in r?af(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Bn=(r,t,e)=>(sf(r,typeof t!="symbol"?t+"":t,e),e),Fs=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)},de=(r,t,e)=>(Fs(r,t,"read from private field"),e?e.call(r):t.get(r)),Ce=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},Ve=(r,t,e,n)=>(Fs(r,t,"write to private field"),n?n.call(r,e):t.set(r,e),e),tt=(r,t,e)=>(Fs(r,t,"access private method"),e),zn=class{addEventListener(){}removeEventListener(){}dispatchEvent(r){return!0}};if(typeof DocumentFragment=="undefined"){class r extends zn{}globalThis.DocumentFragment=r}var Ks=class extends zn{},of=class extends zn{},lf={get(r){},define(r,t,e){},upgrade(r){},whenDefined(r){return Promise.resolve(Ks)}},Fn,uf=class{constructor(r,t={}){Ce(this,Fn,void 0),Ve(this,Fn,t==null?void 0:t.detail)}get detail(){return de(this,Fn)}initCustomEvent(){}};Fn=new WeakMap;function df(r,t){return new Ks}var Yl={document:{createElement:df},DocumentFragment,customElements:lf,CustomEvent:uf,EventTarget:zn,HTMLElement:Ks,HTMLVideoElement:of},zl=typeof window=="undefined"||typeof globalThis.customElements=="undefined",cr=zl?Yl:globalThis,Xl=zl?Yl.document:globalThis.document,cf=()=>{try{return"0.12.0"}catch{}return"UNKNOWN"},ff=cf(),hf=()=>ff,vf=class extends Set{add(r){super.add(new WeakRef(r))}forEach(r){super.forEach(t=>{let e=t.deref();e&&r(e)})}},mf=r=>{var t,e,n,a,u,M,C,O,L,A,x,I,_,b,S,v,i,d,p,T,l,o,h,E,s,c,m,f,g,y,R,D,P,N,B,F,H,j,X,$;return t=class extends r{constructor(){super(),Ce(this,m),Ce(this,g),Ce(this,R),Ce(this,P),Ce(this,B),Ce(this,H),Ce(this,X),Bn(this,"castEnabled",!1),Ce(this,l,{paused:!1}),Ce(this,o,void 0),Ce(this,h,{}),Ce(this,E,void 0),Ce(this,s,void 0),Ce(this,c,void 0),t.instances.add(this),tt(this,B,F).call(this)}static get castElement(){return de(t,e)}static get castEnabled(){return de(t,n)}static get castState(){var G;return(G=de(t,L,A))==null?void 0:G.getCastState()}static async exitCast(){try{await de(t,L,A).endCurrentSession(!0)}catch(G){console.error(G);return}}get castPlayer(){if(t.castElement===this)return de(this,o)}attributeChangedCallback(G){if(this.castPlayer)switch(G){case"cast-stream-type":case"cast-src":this.load();break}}async requestCast(G={}){var J;tt(J=t,p,T).call(J,G),Ve(t,e,this),Object.entries(de(this,h)).forEach(([ee,te])=>{de(this,o).controller.addEventListener(ee,te)});try{await de(t,L,A).requestSession()}catch{Ve(t,e,void 0);return}de(this,l).paused=super.paused,super.pause(),this.muted=super.muted;try{await this.load()}catch(ee){console.error(ee)}}async load(){var G,J;if(!this.castPlayer)return super.load();let ee=new chrome.cast.media.MediaInfo(this.castSrc,this.castContentType),te=[...this.querySelectorAll("track")].filter(({kind:he,src:me})=>me&&(he==="subtitles"||he==="captions")),oe=[],ue=0;te.length&&(ee.tracks=te.map(he=>{let me=++ue;oe.length===0&&he.track.mode==="showing"&&oe.push(me);let ae=new chrome.cast.media.Track(me,chrome.cast.media.TrackType.TEXT);return ae.trackContentId=he.src,ae.trackContentType="text/vtt",ae.subtype=he.kind==="captions"?chrome.cast.media.TextTrackType.CAPTIONS:chrome.cast.media.TextTrackType.SUBTITLES,ae.name=he.label,ae.language=he.srclang,ae})),this.castStreamType==="live"?ee.streamType=chrome.cast.media.StreamType.LIVE:ee.streamType=chrome.cast.media.StreamType.BUFFERED,ee.metadata=new chrome.cast.media.GenericMediaMetadata,ee.metadata.title=this.title,ee.metadata.images=[{url:this.poster}];let ne=new chrome.cast.media.LoadRequest(ee);ne.currentTime=(G=super.currentTime)!=null?G:0,ne.autoplay=!de(this,l).paused,ne.activeTrackIds=oe,await((J=de(t,x,I))==null?void 0:J.loadMedia(ne)),this.dispatchEvent(new Event("volumechange"))}play(){var G;if(this.castPlayer){this.castPlayer.isPaused&&((G=this.castPlayer.controller)==null||G.playOrPause());return}return super.play()}pause(){var G;if(this.castPlayer){this.castPlayer.isPaused||(G=this.castPlayer.controller)==null||G.playOrPause();return}super.pause()}get castSrc(){var G,J,ee;return(ee=(J=this.getAttribute("cast-src"))!=null?J:(G=this.querySelector("source"))==null?void 0:G.src)!=null?ee:this.currentSrc}set castSrc(G){this.castSrc!=G&&this.setAttribute("cast-src",`${G}`)}get castContentType(){var G;return(G=this.getAttribute("cast-content-type"))!=null?G:void 0}set castContentType(G){this.setAttribute("cast-content-type",`${G}`)}get castStreamType(){var G;return(G=this.getAttribute("cast-stream-type"))!=null?G:void 0}set castStreamType(G){this.setAttribute("cast-stream-type",`${G}`)}get readyState(){if(this.castPlayer)switch(this.castPlayer.playerState){case chrome.cast.media.PlayerState.IDLE:return 0;case chrome.cast.media.PlayerState.BUFFERING:return 2;default:return 3}return super.readyState}get paused(){return this.castPlayer?this.castPlayer.isPaused:super.paused}get muted(){var G;return this.castPlayer?(G=this.castPlayer)==null?void 0:G.isMuted:super.muted}set muted(G){var J;if(this.castPlayer){(G&&!this.castPlayer.isMuted||!G&&this.castPlayer.isMuted)&&((J=this.castPlayer.controller)==null||J.muteOrUnmute());return}super.muted=G}get volume(){var G,J;return this.castPlayer?(J=(G=this.castPlayer)==null?void 0:G.volumeLevel)!=null?J:1:super.volume}set volume(G){var J;if(this.castPlayer){this.castPlayer.volumeLevel=G,(J=this.castPlayer.controller)==null||J.setVolumeLevel();return}super.volume=G}get duration(){var G,J;return this.castPlayer&&de(this,m,f)?(J=(G=this.castPlayer)==null?void 0:G.duration)!=null?J:NaN:super.duration}get currentTime(){var G,J;return this.castPlayer&&de(this,m,f)?(J=(G=this.castPlayer)==null?void 0:G.currentTime)!=null?J:0:super.currentTime}set currentTime(G){var J;if(this.castPlayer){this.castPlayer.currentTime=G,(J=this.castPlayer.controller)==null||J.seek();return}super.currentTime=G}get onentercast(){return de(this,E)}set onentercast(G){de(this,E)&&(this.removeEventListener("entercast",de(this,E)),Ve(this,E,null)),typeof G=="function"&&(Ve(this,E,G),this.addEventListener("entercast",G))}get onleavecast(){return de(this,s)}set onleavecast(G){de(this,s)&&(this.removeEventListener("leavecast",de(this,s)),Ve(this,s,null)),typeof G=="function"&&(Ve(this,s,G),this.addEventListener("leavecast",G))}get oncastchange(){return de(this,c)}set oncastchange(G){de(this,c)&&(this.removeEventListener("castchange",de(this,c)),Ve(this,c,null)),typeof G=="function"&&(Ve(this,c,G),this.addEventListener("castchange",G))}},e=new WeakMap,n=new WeakMap,a=new WeakMap,u=new WeakSet,M=function(){return typeof chrome!="undefined"&&chrome.cast&&chrome.cast.isAvailable},C=new WeakSet,O=function(){return typeof cast!="undefined"&&cast.framework},L=new WeakSet,A=function(){if(de(t,C,O))return cast.framework.CastContext.getInstance()},x=new WeakSet,I=function(){var G;return(G=de(t,L,A))==null?void 0:G.getCurrentSession()},_=new WeakSet,b=function(){var G;return(G=de(t,x,I))==null?void 0:G.getSessionObj().media[0]},S=new WeakSet,v=function(G){return new Promise((J,ee)=>{de(t,_,b).editTracksInfo(G,J,ee)})},i=new WeakSet,d=function(G){return new Promise((J,ee)=>{de(t,_,b).getStatus(G,J,ee)})},p=new WeakSet,T=function(G){return de(t,L,A).setOptions({receiverApplicationId:chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED,androidReceiverCompatible:!1,language:"en-US",resumeSavedSession:!0,...G})},l=new WeakMap,o=new WeakMap,h=new WeakMap,E=new WeakMap,s=new WeakMap,c=new WeakMap,m=new WeakSet,f=function(){var G;return(G=this.castPlayer)==null?void 0:G.isMediaLoaded},g=new WeakSet,y=function(){de(t,e)===this&&(Object.entries(de(this,h)).forEach(([G,J])=>{de(this,o).controller.removeEventListener(G,J)}),Ve(t,e,void 0),this.muted=de(this,o).isMuted,this.currentTime=de(this,o).savedPlayerState.currentTime,de(this,o).savedPlayerState.isPaused===!1&&this.play())},R=new WeakSet,D=function(){this.dispatchEvent(new CustomEvent("castchange",{detail:de(t,L,A).getCastState()}))},P=new WeakSet,N=async function(){var G,J;let{SESSION_RESUMED:ee}=cast.framework.SessionState;if(de(t,L,A).getSessionState()===ee&&this.castSrc===((G=de(t,_,b))==null?void 0:G.media.contentId)){Ve(t,e,this),Object.entries(de(this,h)).forEach(([te,oe])=>{de(this,o).controller.addEventListener(te,oe)});try{await tt(J=t,i,d).call(J,new chrome.cast.media.GetStatusRequest)}catch(te){console.error(te)}de(this,h)[cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED](),de(this,h)[cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED]()}},B=new WeakSet,F=function(){var G;!de(t,C,O)||this.castEnabled||(this.castEnabled=!0,tt(G=t,p,T).call(G),this.textTracks.addEventListener("change",tt(this,X,$).bind(this)),tt(this,R,D).call(this),Ve(this,o,new cast.framework.RemotePlayer),new cast.framework.RemotePlayerController(de(this,o)),Ve(this,h,{[cast.framework.RemotePlayerEventType.IS_CONNECTED_CHANGED]:({value:J})=>{J===!1&&tt(this,g,y).call(this),this.dispatchEvent(new Event(J?"entercast":"leavecast"))},[cast.framework.RemotePlayerEventType.DURATION_CHANGED]:()=>{this.dispatchEvent(new Event("durationchange"))},[cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED]:()=>{this.dispatchEvent(new Event("volumechange"))},[cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED]:()=>{this.dispatchEvent(new Event("volumechange"))},[cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED]:()=>{!de(this,m,f)||this.dispatchEvent(new Event("timeupdate"))},[cast.framework.RemotePlayerEventType.VIDEO_INFO_CHANGED]:()=>{this.dispatchEvent(new Event("resize"))},[cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED]:()=>{this.dispatchEvent(new Event(this.paused?"pause":"play"))},[cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED]:()=>{var J,ee;((J=this.castPlayer)==null?void 0:J.playerState)!==chrome.cast.media.PlayerState.PAUSED&&this.dispatchEvent(new Event({[chrome.cast.media.PlayerState.PLAYING]:"playing",[chrome.cast.media.PlayerState.BUFFERING]:"waiting",[chrome.cast.media.PlayerState.IDLE]:"emptied"}[(ee=this.castPlayer)==null?void 0:ee.playerState]))},[cast.framework.RemotePlayerEventType.IS_MEDIA_LOADED_CHANGED]:async()=>{!de(this,m,f)||(await Promise.resolve(),tt(this,H,j).call(this))}}))},H=new WeakSet,j=function(){tt(this,X,$).call(this)},X=new WeakSet,$=async function(){var G,J,ee,te,oe,ue;if(!this.castPlayer)return;let ne=((J=(G=de(this,o).mediaInfo)==null?void 0:G.tracks)!=null?J:[]).filter(({type:be})=>be===chrome.cast.media.TrackType.TEXT),he=[...this.textTracks].filter(({kind:be})=>be==="subtitles"||be==="captions"),me=ne.map(({language:be,name:Ue,trackId:Je})=>{var Ge;let{mode:rt}=(Ge=he.find(Ke=>Ke.language===be&&Ke.label===Ue))!=null?Ge:{};return rt?{mode:rt,trackId:Je}:!1}).filter(Boolean),ae=me.filter(({mode:be})=>be!=="showing").map(({trackId:be})=>be),Me=me.find(({mode:be})=>be==="showing"),Se=(oe=(te=(ee=de(t,x,I))==null?void 0:ee.getSessionObj().media[0])==null?void 0:te.activeTrackIds)!=null?oe:[],xe=Se;if(Se.length&&(xe=xe.filter(be=>!ae.includes(be))),Me!=null&&Me.trackId&&(xe=[...xe,Me.trackId]),xe=[...new Set(xe)],!((be,Ue)=>be.length===Ue.length&&be.every(Je=>Ue.includes(Je)))(Se,xe))try{let be=new chrome.cast.media.EditTracksInfoRequest(xe);await tt(ue=t,S,v).call(ue,be)}catch(be){console.error(be)}},Ce(t,u),Ce(t,C),Ce(t,L),Ce(t,x),Ce(t,_),Ce(t,S),Ce(t,i),Ce(t,p),Bn(t,"observedAttributes",["cast-src","cast-content-type","cast-stream-type"]),Bn(t,"instances",new vf),Ce(t,e,void 0),Ce(t,n,!1),Bn(t,"initCast",()=>{var G;de(t,u,M)?de(t,C,O)?de(G=t,a).call(G,chrome.cast.isAvailable):customElements.whenDefined("google-cast-button").then(()=>{var J;return de(J=t,a).call(J,chrome.cast.isAvailable)}):globalThis.__onGCastApiAvailable=()=>{customElements.whenDefined("google-cast-button").then(()=>{var J;return de(J=t,a).call(J,chrome.cast.isAvailable)})}}),Ce(t,a,G=>{if(G){Ve(t,n,!0);let{CAST_STATE_CHANGED:J}=cast.framework.CastContextEventType;de(t,L,A).addEventListener(J,te=>{t.instances.forEach(oe=>{var ue;return tt(ue=oe,R,D).call(ue,te)})});let{SESSION_STATE_CHANGED:ee}=cast.framework.CastContextEventType;de(t,L,A).addEventListener(ee,te=>{t.instances.forEach(oe=>{var ue;return tt(ue=oe,P,N).call(ue,te)})}),t.instances.forEach(te=>{var oe;return tt(oe=te,B,F).call(oe)})}}),t};if(globalThis.HTMLVideoElement&&globalThis.customElements){let r=mf(HTMLVideoElement);globalThis.customElements.get("castable-video")||(globalThis.customElements.define("castable-video",r,{extends:"video"}),globalThis.CastableVideoElement=r),r.initCast()}var Ws=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting","waitingforkey","resize","enterpictureinpicture","leavepictureinpicture","castchange","entercast","leavecast"],Ql=Xl.createElement("template");Ql.innerHTML=`
<style>
  :host {
    display: inline-block;
    line-height: 0;
    width: auto;
    height: auto;
  }

  video {
    max-width: 100%;
    max-height: 100%;
    min-width: 100%;
    min-height: 100%;
    object-fit: var(--media-object-fit, contain);
    object-position: var(--media-object-position, 50% 50%);
  }
</style>
<video is="castable-video" part="video" crossorigin></video>
<slot></slot>
`;var Kn,Ui,Wn,Yn,Us,ti=class extends cr.HTMLElement{constructor(){super(),Ce(this,Ui),Ce(this,Yn),Ce(this,Kn,void 0),this.attachShadow({mode:"open"}),this.isConnected&&tt(this,Ui,Wn).call(this)}static get observedAttributes(){let r=[],t=n=>n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();Object.getOwnPropertyNames(this.prototype).forEach(n=>{let a=!1;try{typeof this.prototype[n]=="function"&&(a=!0)}catch{}!a&&n!==n.toUpperCase()&&r.push(n.toLowerCase(),t(n))});let e=Object.getPrototypeOf(this).observedAttributes;return e&&(r=r.concat(e)),r}attributeChangedCallback(r,t,e){tt(this,Ui,Wn).call(this),tt(this,Yn,Us).call(this,r,t,e)}connectedCallback(){tt(this,Ui,Wn).call(this)}};Kn=new WeakMap,Ui=new WeakSet,Wn=function(){if(de(this,Kn))return;Ve(this,Kn,!0),this.shadowRoot.append(Ql.content.cloneNode(!0)),this.nativeEl=this.shadowRoot.querySelector("video"),Ws.forEach(t=>{this.nativeEl.addEventListener(t,e=>{this.dispatchEvent(new CustomEvent(e.type,{detail:e.detail}))})});let r=this.shadowRoot.querySelector("slot");r.addEventListener("slotchange",()=>{r.assignedElements().forEach(t=>{!["track","source"].includes(t.localName)||this.nativeEl.append(t)})}),Array.prototype.forEach.call(this.attributes,t=>{tt(this,Yn,Us).call(this,t.name,null,t.value)}),this.nativeEl.defaultMuted&&(this.nativeEl.muted=!0)},Yn=new WeakSet,Us=function(r,t,e){let n=Object.getOwnPropertyNames(Object.getPrototypeOf(this)),a=pf(n,r),u=Object.getPrototypeOf(this.constructor).toString().indexOf("function HTMLElement")===0;a&&!u?typeof this[a]=="boolean"?e===null?this[a]=!1:this[a]=!0:this[a]=e:e===null?this.nativeEl.removeAttribute(r):["id","class"].indexOf(r)===-1&&this.nativeEl.setAttribute(r,e)};var Zl=[],Jl=Xl.createElement("video",{is:"castable-video"}),gf=["webkitDisplayingFullscreen","webkitSupportsFullscreen"];for(let r=Object.getPrototypeOf(Jl);r&&r!==cr.HTMLElement.prototype;r=Object.getPrototypeOf(r))Object.getOwnPropertyNames(r).forEach(t=>{gf.indexOf(t)===-1&&Zl.push(t)});Zl.forEach(r=>{if(!(r in ti.prototype))if(typeof Jl[r]=="function")ti.prototype[r]=function(){return this.nativeEl[r].apply(this.nativeEl,arguments)};else{let t={get(){return this.nativeEl[r]}};r!==r.toUpperCase()&&(t.set=function(e){this.nativeEl[r]=e}),Object.defineProperty(ti.prototype,r,t)}});function pf(r,t){let e=null;return r.forEach(n=>{n.toLowerCase()==t.toLowerCase()&&(e=n)}),e}cr.customElements.get("custom-video")||(cr.customElements.define("custom-video",ti),cr.CustomVideoElement=ti);var $l=ti,le={ENV_KEY:"env-key",DEBUG:"debug",PLAYBACK_ID:"playback-id",METADATA_URL:"metadata-url",PREFER_PLAYBACK:"prefer-playback",PLAYER_SOFTWARE_VERSION:"player-software-version",PLAYER_SOFTWARE_NAME:"player-software-name",BEACON_COLLECTION_DOMAIN:"beacon-collection-domain",CUSTOM_DOMAIN:"custom-domain",DISABLE_COOKIES:"disable-cookies",TYPE:"type",STREAM_TYPE:"stream-type",START_TIME:"start-time",PREFER_CMCD:"prefer-cmcd"},Ef=Object.values(le),yf=hf(),Tf="mux-video",er,Ni,Hn,Bi,Gn,jn,Vn,$n,Ns,Bs=class extends $l{constructor(){super(),Ce(this,$n),Ce(this,er,void 0),Ce(this,Ni,void 0),Ce(this,Hn,void 0),Ce(this,Bi,{}),Ce(this,Gn,void 0),Ce(this,jn,void 0),Ce(this,Vn,void 0),Ve(this,Hn,Bl())}static get observedAttributes(){var r;return[...Ef,...(r=$l.observedAttributes)!=null?r:[]]}get preferCmcd(){var r;return(r=this.getAttribute(le.PREFER_CMCD))!=null?r:void 0}set preferCmcd(r){r!==this.preferCmcd&&(r?qr.includes(r)?this.setAttribute(le.PREFER_CMCD,r):console.warn(`Invalid value for preferCmcd. Must be one of ${qr.join()}`):this.removeAttribute(le.PREFER_CMCD))}get playerInitTime(){return de(this,Hn)}get playerSoftwareName(){var r;return(r=de(this,jn))!=null?r:Tf}set playerSoftwareName(r){Ve(this,jn,r)}get playerSoftwareVersion(){var r;return(r=de(this,Gn))!=null?r:yf}set playerSoftwareVersion(r){Ve(this,Gn,r)}get _hls(){var r;return(r=de(this,er))==null?void 0:r.engine}get mux(){return this.nativeEl.mux}get error(){var r;return(r=Kl(this.nativeEl))!=null?r:null}get errorTranslator(){return de(this,Vn)}set errorTranslator(r){Ve(this,Vn,r)}get src(){return this.getAttribute("src")}set src(r){r!==this.src&&(r==null?this.removeAttribute("src"):this.setAttribute("src",r))}get type(){var r;return(r=this.getAttribute(le.TYPE))!=null?r:void 0}set type(r){r!==this.type&&(r?this.setAttribute(le.TYPE,r):this.removeAttribute(le.TYPE))}get autoplay(){let r=this.getAttribute("autoplay");return r===null?!1:r===""?!0:r}set autoplay(r){let t=this.autoplay;r!==t&&(r?this.setAttribute("autoplay",typeof r=="string"?r:""):this.removeAttribute("autoplay"))}get preload(){let r=this.getAttribute("preload");return r===""?"auto":["none","metadata","auto"].includes(r)?r:super.preload}set preload(r){r!=this.getAttribute("preload")&&(["","none","metadata","auto"].includes(r)?this.setAttribute("preload",r):this.removeAttribute("preload"))}get debug(){return this.getAttribute(le.DEBUG)!=null}set debug(r){r!==this.debug&&(r?this.setAttribute(le.DEBUG,""):this.removeAttribute(le.DEBUG))}get disableCookies(){return this.hasAttribute(le.DISABLE_COOKIES)}set disableCookies(r){r!==this.disableCookies&&(r?this.setAttribute(le.DISABLE_COOKIES,""):this.removeAttribute(le.DISABLE_COOKIES))}get startTime(){let r=this.getAttribute(le.START_TIME);if(r==null)return;let t=+r;return Number.isNaN(t)?void 0:t}set startTime(r){r!==this.startTime&&(r==null?this.removeAttribute(le.START_TIME):this.setAttribute(le.START_TIME,`${r}`))}get playbackId(){var r;return(r=this.getAttribute(le.PLAYBACK_ID))!=null?r:void 0}set playbackId(r){r!==this.playbackId&&(r?this.setAttribute(le.PLAYBACK_ID,r):this.removeAttribute(le.PLAYBACK_ID))}get customDomain(){var r;return(r=this.getAttribute(le.CUSTOM_DOMAIN))!=null?r:void 0}set customDomain(r){r!==this.customDomain&&(r?this.setAttribute(le.CUSTOM_DOMAIN,r):this.removeAttribute(le.CUSTOM_DOMAIN))}get envKey(){var r;return(r=this.getAttribute(le.ENV_KEY))!=null?r:void 0}set envKey(r){r!==this.envKey&&(r?this.setAttribute(le.ENV_KEY,r):this.removeAttribute(le.ENV_KEY))}get beaconCollectionDomain(){var r;return(r=this.getAttribute(le.BEACON_COLLECTION_DOMAIN))!=null?r:void 0}set beaconCollectionDomain(r){r!==this.beaconCollectionDomain&&(r?this.setAttribute(le.BEACON_COLLECTION_DOMAIN,r):this.removeAttribute(le.BEACON_COLLECTION_DOMAIN))}get streamType(){var r;return(r=this.getAttribute(le.STREAM_TYPE))!=null?r:void 0}set streamType(r){r!==this.streamType&&(r?this.setAttribute(le.STREAM_TYPE,r):this.removeAttribute(le.STREAM_TYPE))}get preferPlayback(){let r=this.getAttribute(le.PREFER_PLAYBACK);if(r===kt.MSE||r===kt.NATIVE)return r}set preferPlayback(r){r!==this.preferPlayback&&(r===kt.MSE||r===kt.NATIVE?this.setAttribute(le.PREFER_PLAYBACK,r):this.removeAttribute(le.PREFER_PLAYBACK))}get metadata(){return{...this.getAttributeNames().filter(r=>r.startsWith("metadata-")&&![le.METADATA_URL].includes(r)).reduce((r,t)=>{let e=this.getAttribute(t);return e!=null&&(r[t.replace(/^metadata-/,"").replace(/-/g,"_")]=e),r},{}),...de(this,Bi)}}set metadata(r){Ve(this,Bi,r!=null?r:{}),this.mux&&this.mux.emit("hb",de(this,Bi))}load(){Ve(this,er,Wl(this,this.nativeEl,de(this,er)))}unload(){ws(this.nativeEl,de(this,er)),Ve(this,er,void 0)}attributeChangedCallback(r,t,e){var n,a;switch(super.attributeChangedCallback(r,t,e),r){case le.PLAYER_SOFTWARE_NAME:this.playerSoftwareName=e!=null?e:void 0;break;case le.PLAYER_SOFTWARE_VERSION:this.playerSoftwareVersion=e!=null?e:void 0;break;case"src":{let u=!!t,M=!!e;!u&&M?tt(this,$n,Ns).call(this):u&&!M?this.unload():u&&M&&(this.unload(),tt(this,$n,Ns).call(this));break}case"autoplay":if(e===t)break;(n=de(this,er))==null||n.setAutoplay(this.autoplay);break;case"preload":if(e===t)break;(a=de(this,er))==null||a.setPreload(e);break;case le.PLAYBACK_ID:this.src=Fl(e!=null?e:void 0,{domain:this.customDomain});break;case le.DEBUG:{let u=this.debug;this.mux&&console.info("Cannot toggle debug mode of mux data after initialization. Make sure you set all metadata to override before setting the src."),this._hls&&(this._hls.config.debug=u);break}case le.METADATA_URL:e&&fetch(e).then(u=>u.json()).then(u=>this.metadata=u).catch(u=>console.error(`Unable to load or parse metadata JSON from metadata-url ${e}!`));break;default:break}}disconnectedCallback(){this.unload()}};er=new WeakMap,Ni=new WeakMap,Hn=new WeakMap,Bi=new WeakMap,Gn=new WeakMap,jn=new WeakMap,Vn=new WeakMap,$n=new WeakSet,Ns=async function(){de(this,Ni)||(await Ve(this,Ni,Promise.resolve()),Ve(this,Ni,null),this.load())};cr.customElements.get("mux-video")||(cr.customElements.define("mux-video",Bs),cr.MuxVideoElement=Bs);var ql=Bs;var bf="en",Rr={code:bf};var eu="en";function Oe(r,t=!0){var a,u;let e=t&&(u=(a=Rr)==null?void 0:a[r])!=null?u:r,n=t?Rr.code:eu;return new Hs(e,n)}var Hs=class{constructor(t,e=(n=>(n=Rr.code)!=null?n:eu)()){this.message=t,this.locale=e}format(t){return this.message.replace(/\{(\w+)\}/g,(e,n)=>{var a;return(a=t[n])!=null?a:""})}toString(){return this.message}};function tu(r){let t="";return Object.entries(r).forEach(([e,n])=>{n!=null&&(t+=`${Af(e)}: ${n}; `)}),t?t.trim():void 0}function Af(r){return r.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function ru(r){return r.replace(/[-_]([a-z])/g,(t,e)=>e.toUpperCase())}function tr(r){if(r==null)return;let t=+r;return Number.isNaN(t)?void 0:t}function Xn(r){let t=_f(r).toString();return t?"?"+t:""}function _f(r){let t={};for(let e in r)r[e]!=null&&(t[e]=r[e]);return new URLSearchParams(t)}function fr(r){let t=(r!=null?r:"").split(".")[1];if(!t)return{};let e=t.replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(e).split("").map(function(a){return"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}var Gs=(r,t)=>!r||!t?!1:r.contains(t)?!0:Gs(r,t.getRootNode().host);var js="mux.com",Sf=()=>{try{return"1.5.1"}catch{}return"UNKNOWN"},xf=Sf(),Zn=()=>xf,Vs=(r,{token:t,domain:e=js}={})=>`https://stream.${e}/${r}.m3u8${Xn(!!t?{token:t}:{redundant_streams:!0})}`,au=(r,{token:t,thumbnailTime:e,domain:n=js}={})=>{let a=t==null?e:void 0,{aud:u}=fr(t);if(!(t&&u!=="t"))return`https://image.${n}/${r}/thumbnail.webp${Xn({token:t,time:a})}`},su=(r,{token:t,domain:e=js}={})=>{let{aud:n}=fr(t);if(!(t&&n!=="s"))return`https://image.${e}/${r}/storyboard.vtt${Xn({token:t,format:"webp"})}`};var Lf={crossorigin:"crossOrigin",playsinline:"playsInline"};function ou(r){var t;return(t=Lf[r])!=null?t:ru(r)}var lu=r=>{var e,n;let{media:t}=r;return(n=(e=t==null?void 0:t._hls)==null?void 0:e.liveSyncPosition)!=null?n:t!=null&&t.seekable.length?t==null?void 0:t.seekable.end(t.seekable.length-1):void 0},$s=r=>{let t=lu(r);if(t==null){console.warn("attempting to seek to live but cannot determine live edge time!");return}r.currentTime=t},Df=1,If=5,iu=3,nu=.5,uu=r=>{var u;let{streamType:t}=r,e=lu(r),n=(u=r.media)==null?void 0:u.currentTime;if(e==null||n==null)return!1;let a=e-n;return t===we.LL_LIVE||t===we.LL_DVR?a<=Df*(iu+nu):t===we.LIVE||t===we.DVR?a<=If*(iu+nu):!1},Mr,Cr,yt,Qn=class{constructor(t,e){Fe(this,Mr,void 0);Fe(this,Cr,void 0);Fe(this,yt,[]);pt(this,Mr,t),pt(this,Cr,e)}[Symbol.iterator](){return _e(this,yt).values()}get length(){return _e(this,yt).length}get value(){var t;return(t=_e(this,yt).join(" "))!=null?t:""}set value(t){var e;t!==this.value&&(pt(this,yt,[]),this.add(...(e=t==null?void 0:t.split(" "))!=null?e:[]))}toString(){return this.value}item(t){return _e(this,yt)[t]}values(){return _e(this,yt).values()}keys(){return _e(this,yt).keys()}forEach(t){_e(this,yt).forEach(t)}add(...t){var e,n;t.forEach(a=>{this.contains(a)||_e(this,yt).push(a)}),!(this.value===""&&!((e=_e(this,Mr))!=null&&e.hasAttribute(`${_e(this,Cr)}`)))&&((n=_e(this,Mr))==null||n.setAttribute(`${_e(this,Cr)}`,`${this.value}`))}remove(...t){var e;t.forEach(n=>{_e(this,yt).splice(_e(this,yt).indexOf(n),1)}),(e=_e(this,Mr))==null||e.setAttribute(`${_e(this,Cr)}`,`${this.value}`)}contains(t){return _e(this,yt).includes(t)}toggle(t,e){return typeof e!="undefined"?e?(this.add(t),!0):(this.remove(t),!1):this.contains(t)?(this.remove(t),!1):(this.add(t),!0)}replace(t,e){this.remove(t),this.add(e)}};Mr=new WeakMap,Cr=new WeakMap,yt=new WeakMap;var du=`[mux-player ${Zn()}]`;function hr(...r){console.warn(du,...r)}function Qt(...r){console.error(du,...r)}function Jn(r){var e;let t=(e=r.message)!=null?e:"";if(r.file){let n="https://github.com/muxinc/elements/blob/main/errors/";t+=` ${Oe("Read more: ")}
${n}${r.file}`}hr(t)}var ct={AUTOPLAY:"autoplay",CROSSORIGIN:"crossorigin",LOOP:"loop",MUTED:"muted",PLAYSINLINE:"playsinline",PRELOAD:"preload"},Or={VOLUME:"volume",PLAYBACKRATE:"playbackrate",MUTED:"muted"},fu=Object.freeze({length:0,start(r){let t=r>>>0;if(t>=this.length)throw new DOMException(`Failed to execute 'start' on 'TimeRanges': The index provided (${t}) is greater than or equal to the maximum bound (${this.length}).`);return 0},end(r){let t=r>>>0;if(t>=this.length)throw new DOMException(`Failed to execute 'end' on 'TimeRanges': The index provided (${t}) is greater than or equal to the maximum bound (${this.length}).`);return 0}}),Rf=Ws.filter(r=>r!=="error"),Mf=Object.values(ct).filter(r=>![ct.PLAYSINLINE].includes(r)),Cf=Object.values(Or);function hu(r){r.querySelectorAll(":scope > track").forEach(t=>{var e;(e=r.media)==null||e.append(t.cloneNode())}),Rf.forEach(t=>{var e;(e=r.media)==null||e.addEventListener(t,n=>{r.dispatchEvent(new Event(n.type))})})}var Ys=class extends Qe.HTMLElement{static get observedAttributes(){return[...Mf,...Cf]}constructor(){super(),this.querySelectorAll(":scope > track").forEach(n=>{var a;(a=this.media)==null||a.append(n.cloneNode())});let t=n=>{for(let a of n)a.type==="childList"&&(a.removedNodes.forEach(u=>{var C,O;let M=(C=this.media)==null?void 0:C.querySelector(`track[src="${u.src}"]`);M&&((O=this.media)==null||O.removeChild(M))}),a.addedNodes.forEach(u=>{var M;(M=this.media)==null||M.append(u.cloneNode())}))};new MutationObserver(t).observe(this,{childList:!0,subtree:!0})}attributeChangedCallback(t,e,n){var a,u;switch(t){case Or.MUTED:{this.media&&(this.media.muted=n!=null,this.media.defaultMuted=n!=null);return}case Or.VOLUME:{let M=(a=tr(n))!=null?a:1;this.media&&(this.media.volume=M);return}case Or.PLAYBACKRATE:{let M=(u=tr(n))!=null?u:1;this.media&&(this.media.playbackRate=M,this.media.defaultPlaybackRate=M);return}}}play(){var t,e;return(e=(t=this.media)==null?void 0:t.play())!=null?e:Promise.reject()}pause(){var t;(t=this.media)==null||t.pause()}requestCast(t){var e;return(e=this.media)==null?void 0:e.requestCast(t)}get media(){var t;return(t=this.shadowRoot)==null?void 0:t.querySelector("mux-video")}get paused(){var t,e;return(e=(t=this.media)==null?void 0:t.paused)!=null?e:!0}get duration(){var t,e;return(e=(t=this.media)==null?void 0:t.duration)!=null?e:NaN}get ended(){var t,e;return(e=(t=this.media)==null?void 0:t.ended)!=null?e:!1}get buffered(){var t,e;return(e=(t=this.media)==null?void 0:t.buffered)!=null?e:fu}get seekable(){var t,e;return(e=(t=this.media)==null?void 0:t.seekable)!=null?e:fu}get readyState(){var t,e;return(e=(t=this.media)==null?void 0:t.readyState)!=null?e:0}get videoWidth(){var t,e;return(e=(t=this.media)==null?void 0:t.videoWidth)!=null?e:0}get videoHeight(){var t,e;return(e=(t=this.media)==null?void 0:t.videoHeight)!=null?e:0}get currentTime(){var t,e;return(e=(t=this.media)==null?void 0:t.currentTime)!=null?e:0}set currentTime(t){this.media&&(this.media.currentTime=Number(t))}get volume(){var t,e;return(e=(t=this.media)==null?void 0:t.volume)!=null?e:1}set volume(t){this.media&&(this.media.volume=Number(t))}get playbackRate(){var t,e;return(e=(t=this.media)==null?void 0:t.playbackRate)!=null?e:1}set playbackRate(t){this.media&&(this.media.playbackRate=Number(t))}get defaultPlaybackRate(){var t;return(t=tr(this.getAttribute(Or.PLAYBACKRATE)))!=null?t:1}set defaultPlaybackRate(t){t!=null?this.setAttribute(Or.PLAYBACKRATE,`${t}`):this.removeAttribute(Or.PLAYBACKRATE)}get crossOrigin(){return Fi(this,ct.CROSSORIGIN)}set crossOrigin(t){this.setAttribute(ct.CROSSORIGIN,`${t}`)}get autoplay(){return Fi(this,ct.AUTOPLAY)!=null}set autoplay(t){t?this.setAttribute(ct.AUTOPLAY,typeof t=="string"?t:""):this.removeAttribute(ct.AUTOPLAY)}get loop(){return Fi(this,ct.LOOP)!=null}set loop(t){t?this.setAttribute(ct.LOOP,""):this.removeAttribute(ct.LOOP)}get muted(){var t,e;return(e=(t=this.media)==null?void 0:t.muted)!=null?e:!1}set muted(t){this.media&&(this.media.muted=Boolean(t))}get defaultMuted(){return Fi(this,ct.MUTED)!=null}set defaultMuted(t){t?this.setAttribute(ct.MUTED,""):this.removeAttribute(ct.MUTED)}get playsInline(){return Fi(this,ct.PLAYSINLINE)!=null}set playsInline(t){Qt("playsInline is set to true by default and is not currently supported as a setter.")}get preload(){return this.media?this.media.preload:this.getAttribute("preload")}set preload(t){["","none","metadata","auto"].includes(t)?this.setAttribute(ct.PRELOAD,t):this.removeAttribute(ct.PRELOAD)}};function Fi(r,t){return r.media?r.media.getAttribute(t):r.getAttribute(t)}var zs=Ys;var Of=Object.defineProperty,Pf=(r,t,e)=>t in r?Of(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,kf=(r,t,e)=>(Pf(r,typeof t!="symbol"?t+"":t,e),e),Eu=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)},De=(r,t,e)=>(Eu(r,t,"read from private field"),e?e.call(r):t.get(r)),Zt=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},rr=(r,t,e,n)=>(Eu(r,t,"write to private field"),n?n.call(r,e):t.set(r,e),e),ri,qn,Pr,Ki,vr,mr,gr,kr,ii,ea,Wt,vu=1,mu=0,wf=1,Uf={processCallback(r,t,e){if(!!e){for(let[n,a]of t)if(n in e){let u=e[n];typeof u=="boolean"&&a instanceof Tt&&typeof a.element[a.attributeName]=="boolean"?a.booleanValue=u:typeof u=="function"&&a instanceof Tt?a.element[a.attributeName]=u:a.value=u}}}},ir=class extends ie.DocumentFragment{constructor(t,e,n=Uf){var a;super(),Zt(this,ri,void 0),Zt(this,qn,void 0),this.append(t.content.cloneNode(!0)),rr(this,ri,yu(this)),rr(this,qn,n),(a=n.createCallback)==null||a.call(n,this,De(this,ri),e),n.processCallback(this,De(this,ri),e)}update(t){De(this,qn).processCallback(this,De(this,ri),t)}};ri=new WeakMap;qn=new WeakMap;var yu=(r,t=[])=>{let e,n;for(let a of r.attributes||[])if(a.value.includes("{{")){let u=new Xs;for([e,n]of pu(a.value))if(!e)u.append(n);else{let M=new Tt(r,a.name,a.namespaceURI);u.append(M),t.push([n,M])}a.value=u.toString()}for(let a of r.childNodes)if(a.nodeType===vu&&!(a instanceof HTMLTemplateElement))yu(a,t);else if(a.nodeType===vu||a.data.includes("{{")){let u=[];if(a.data)for([e,n]of pu(a.data))if(!e)u.push(new Text(n));else{let M=new nr(r);u.push(M),t.push([n,M])}else if(a instanceof HTMLTemplateElement){let M=new Wi(r,a);u.push(M),t.push([M.expression,M])}a.replaceWith(...u.flatMap(M=>M.replacementNodes||[M]))}return t},gu={},pu=r=>{let t="",e=0,n=gu[r],a=0,u;if(n)return n;for(n=[];u=r[a];a++)u==="{"&&r[a+1]==="{"&&r[a-1]!=="\\"&&r[a+2]&&++e==1?(t&&n.push([mu,t]),t="",a++):u==="}"&&r[a+1]==="}"&&r[a-1]!=="\\"&&!--e?(n.push([wf,t.trim()]),t="",a++):t+=u||"";return t&&n.push([mu,(e>0?"{{":"")+t]),gu[r]=n},Nf=11,ta=class{get value(){return""}set value(t){}toString(){return this.value}},Tu=new WeakMap,Xs=class{constructor(){Zt(this,Pr,[])}[Symbol.iterator](){return De(this,Pr).values()}get length(){return De(this,Pr).length}item(t){return De(this,Pr)[t]}append(...t){for(let e of t)e instanceof Tt&&Tu.set(e,this),De(this,Pr).push(e)}toString(){return De(this,Pr).join("")}};Pr=new WeakMap;var Tt=class extends ta{constructor(t,e,n){super(),Zt(this,kr),Zt(this,Ki,""),Zt(this,vr,void 0),Zt(this,mr,void 0),Zt(this,gr,void 0),rr(this,vr,t),rr(this,mr,e),rr(this,gr,n)}get attributeName(){return De(this,mr)}get attributeNamespace(){return De(this,gr)}get element(){return De(this,vr)}get value(){return De(this,Ki)}set value(t){De(this,Ki)!==t&&(rr(this,Ki,t),!De(this,kr,ii)||De(this,kr,ii).length===1?t==null?De(this,vr).removeAttributeNS(De(this,gr),De(this,mr)):De(this,vr).setAttributeNS(De(this,gr),De(this,mr),t):De(this,vr).setAttributeNS(De(this,gr),De(this,mr),De(this,kr,ii)))}get booleanValue(){return De(this,vr).hasAttributeNS(De(this,gr),De(this,mr))}set booleanValue(t){if(!De(this,kr,ii)||De(this,kr,ii).length===1)this.value=t?"":null;else throw new DOMException("Value is not fully templatized")}};Ki=new WeakMap;vr=new WeakMap;mr=new WeakMap;gr=new WeakMap;kr=new WeakSet;ii=function(){return Tu.get(this)};var nr=class extends ta{constructor(t,e){super(),Zt(this,ea,void 0),Zt(this,Wt,void 0),rr(this,ea,t),rr(this,Wt,e?[...e]:[new Text])}get replacementNodes(){return De(this,Wt)}get parentNode(){return De(this,ea)}get nextSibling(){return De(this,Wt)[De(this,Wt).length-1].nextSibling}get previousSibling(){return De(this,Wt)[0].previousSibling}get value(){return De(this,Wt).map(t=>t.textContent).join("")}set value(t){this.replace(t)}replace(...t){let e=t.flat().flatMap(n=>n==null?[new Text]:n.forEach?[...n]:n.nodeType===Nf?[...n.childNodes]:n.nodeType?[n]:[new Text(n)]);e.length||e.push(new Text("")),De(this,Wt)[0].before(...e);for(let n of De(this,Wt))e.includes(n)||n.remove();rr(this,Wt,e)}};ea=new WeakMap;Wt=new WeakMap;var Wi=class extends nr{constructor(t,e){let n=e.getAttribute("directive")||e.getAttribute("type"),a=e.getAttribute("expression")||e.getAttribute(n)||"";a.startsWith("{{")&&(a=a.trim().slice(2,-2).trim()),super(t),kf(this,"directive"),this.expression=a,this.template=e,this.directive=n}};var Bf=/([>&])?\s*(\w+)\s*(.*)/,Ff=/^(\?\?|\|)?\s*(['"\w]*)/,Kf={"|":{string:r=>String(r)},"??":(r,t)=>r!=null?r:t},ra=class{constructor(t){this.template=t}},Zs={partial:(r,t)=>{t[r.expression]=new ra(r.template)},if:(r,t)=>{Gf(r.expression,t)?r.replace(new ir(r.template,t,ia)):r.replace("")}},Wf=Object.keys(Zs),ia={processCallback(r,t,e){var n,a,u;if(!!e)for(let[M,C]of t){if(C instanceof Wi){if(!C.directive){let S=Wf.find(v=>C.template.hasAttribute(v));S&&(C.directive=S,C.expression=C.template.getAttribute(S))}(n=Zs[C.directive])==null||n.call(Zs,C,e);continue}let[,O,L,A]=(a=M.match(Bf))!=null?a:[],x=e[L],[,I,_]=(u=A.match(Ff))!=null?u:[],b=Kf[I];if(typeof b=="function")x=b(x,Hi(_,e));else if(b&&x!=null){let S=b[_];S&&(x=S(x))}if(x){if(x instanceof ra){if(O!==">")continue;let S={...e},v=M.matchAll(/(\w+)\s*=\s*(['"\w]*)/g);for(let[,i,d]of v)S[i]=Hi(d,e);x=new ir(x.template,S,ia)}C instanceof Tt&&C.attributeName.startsWith("aria-")&&(x=String(x)),C instanceof Tt?typeof x=="boolean"?C.booleanValue=x:typeof x=="function"?C.element[C.attributeName]=x:C.value=x:C.value=x}else C instanceof Tt&&(C.booleanValue=!1)}}},Hf={"==":(r,t)=>r==t,"!=":(r,t)=>r!=t};function Gf(r,t){var e;let n=jf(r,{boolean:/true|false/,number:/-?\d+\.?\d*/,string:/(["'])((?:\\.|[^\\])*?)\1/,operator:/[!=]=/,ws:/\s+/,param:/[$a-z_][$\w]*/i});if(n.length===0||n.some(({type:u})=>!u))return console.warn(`Warning: invalid expression \`${r}\``),!1;if(n.length===1)return Qs(n[0])?Hi(n[0].token,t):(console.warn(`Warning: invalid expression \`${r}\``),!1);let a=n.filter(({type:u})=>u!=="ws");if(a.length===3){let u=Hf[(e=a[1])==null?void 0:e.token];return!u||!Qs(a[0])||!Qs(a[2])?(console.warn(`Warning: invalid expression \`${r}\``),!1):u(Hi(a[0].token,t),Hi(a[2].token,t))}}function Qs({type:r}){return["number","boolean","string","param"].includes(r)}function Hi(r,t){let e=r[0],n=r.slice(-1);return r==="true"||r==="false"?r==="true":e===n&&["'",'"'].includes(e)?r.slice(1,-1):To(r)?parseFloat(r):t[r]}function jf(r,t){let e,n,a,u=[];for(;r;){a=null,e=r.length;for(let M in t)n=t[M].exec(r),n&&n.index<e&&(a={token:n[0],type:M,matches:n.slice(1)},e=n.index);e&&u.push({token:r.substr(0,e),type:void 0}),a&&u.push(a),r=r.substr(e+(a?a.token.length:0))}return u}var Vf=Object.defineProperty,$f=(r,t,e)=>t in r?Vf(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Gi=(r,t,e)=>($f(r,typeof t!="symbol"?t+"":t,e),e),Su=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)},bu=(r,t,e)=>(Su(r,t,"read from private field"),e?e.call(r):t.get(r)),Au=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},_u=(r,t,e,n)=>(Su(r,t,"write to private field"),n?n.call(r,e):t.set(r,e),e),na,aa,ni=class extends ie.HTMLElement{constructor(){super(),Gi(this,"renderRoot"),Gi(this,"renderer"),Au(this,na,void 0),Au(this,aa,void 0),this.renderRoot=this.attachShadow({mode:"open"}),new MutationObserver(()=>this.render()).observe(this,{attributes:!0}),this.createRenderer()}get mediaController(){return this.renderRoot.querySelector("media-controller")}get template(){var t,e;let n=this.getAttribute("template");if(n){let a=(t=this.getRootNode())==null?void 0:t.getElementById(n);if(a)return a}return(e=bu(this,na))!=null?e:this.constructor.template}set template(t){_u(this,na,t),this.createRenderer()}get props(){let t={};for(let e of this.attributes)e.value!=null?t[ka(e.name)]=e.value===""?!0:e.value:t[ka(e.name)]=!1;return t}attributeChangedCallback(t,e,n){t==="template"&&e!=n&&this.createRenderer()}createRenderer(){this.template&&this.template!==bu(this,aa)&&(_u(this,aa,this.template),this.renderer=new ir(this.template,this.props,this.constructor.processor),this.renderRoot.textContent="",this.renderRoot.append(this.renderer))}render(){var t;(t=this.renderer)==null||t.update(this.props)}};na=new WeakMap;aa=new WeakMap;Gi(ni,"template");Gi(ni,"observedAttributes",["template"]);Gi(ni,"processor",ia);ce("media-theme",ni);var Lu=`
  :host {
    cursor: pointer;
  }
  media-time-display {
    color: inherit;
  }
`,Du=Et.createElement("template");Du.innerHTML=`
  <style>
    ${Lu}
  </style>
  <media-time-display show-duration></media-time-display>
`;var xu=["Enter"," "],ji,si,sa,ai=class extends Qe.HTMLElement{constructor(){var e,n;super();Fe(this,si);Fe(this,ji,void 0);this.attachShadow({mode:"open"}),(e=this.shadowRoot)==null||e.appendChild(this.constructor.template.content.cloneNode(!0)),this.timeDisplayEl=(n=this.shadowRoot)==null?void 0:n.querySelector("media-time-display")}static get observedAttributes(){return["hide-duration","remaining","disabled","aria-disabled"]}toggleTimeDisplay(){var e,n,a;(e=this.timeDisplayEl)!=null&&e.hasAttribute("remaining")?(n=this.timeDisplayEl)==null||n.removeAttribute("remaining"):(a=this.timeDisplayEl)==null||a.setAttribute("remaining","")}connectedCallback(){let e=n=>{let{key:a}=n;if(!xu.includes(a)){this.removeEventListener("keyup",e);return}this.toggleTimeDisplay()};this.addEventListener("keydown",n=>{let{metaKey:a,altKey:u,key:M}=n;if(a||u||!xu.includes(M)){this.removeEventListener("keyup",e);return}this.addEventListener("keyup",e)}),this.addEventListener("click",this.toggleTimeDisplay),pt(this,ji,setInterval(He(this,si,sa).bind(this),200)),requestAnimationFrame(()=>He(this,si,sa).call(this))}disconnectedCallback(){clearInterval(_e(this,ji))}attributeChangedCallback(e,n,a){var u,M;e==="hide-duration"&&He(this,si,sa).call(this),["remaining","disabled","aria-disabled"].includes(e)&&n!==a&&(a==null?(u=this.timeDisplayEl)==null||u.removeAttribute(e):(M=this.timeDisplayEl)==null||M.setAttribute(e,a))}};ji=new WeakMap,si=new WeakSet,sa=function(){var n,a,u,M;getComputedStyle(this).getPropertyValue("--media-duration-display").trim()==="none"||this.getAttribute("hide-duration")!=null?(n=this.timeDisplayEl)!=null&&n.hasAttribute("show-duration")&&((a=this.timeDisplayEl)==null||a.removeAttribute("show-duration")):(u=this.timeDisplayEl)!=null&&u.hasAttribute("show-duration")||(M=this.timeDisplayEl)==null||M.setAttribute("show-duration","")},ai.styles=Lu,ai.template=Du;Qe.customElements.get("mxp-time-display")||(Qe.customElements.define("mxp-time-display",ai),Qe.MxpTimeDisplay=ai);var Iu=`:host {
  display: inline-block;
  width: 100%;
}

/* Hide custom elements that are not defined yet */
:not(:defined) {
  display: none;
}

a {
  color: #fff;
  font-size: 0.9em;
  text-decoration: underline;
}

[audio] [part~='seek-live'] {
  margin: 0;
  height: 42px;
  border-radius: 0;
  background-color: var(--media-control-background, rgba(20, 20, 30, 0.7));
}

[part~='seek-live'] {
  margin-left: 10px;
  margin-right: 5px;
  align-self: center;
  position: relative;
  box-sizing: border-box;
  padding: 4px 6px;
  border-radius: 12px;
  background-color: rgba(20, 20, 30, 0.7);
  font-size: 0.75rem;
  line-height: 1;
  color: #fff;
  border: none;
  cursor: pointer;
}

[part~='seek-live'] svg {
  width: 8px;
  fill: rgb(118, 118, 118);
}
[part~='seek-live'][in-live-window] svg {
  fill: #fb3c4d;
}

[part~='seek-live'][disabled] {
  opacity: 60%;
  cursor: not-allowed;
}
[part~='seek-live'][in-live-window] {
  opacity: 100%;
  cursor: unset;
}

::part(top),
[part~='top'] {
  --media-controls: var(--controls, var(--top-controls));
  --media-play-button: var(--play-button, var(--top-play-button));
  --media-seek-live-button: var(--seek-live-button, var(--top-seek-live-button));
  --media-seek-backward-button: var(--seek-backward-button, var(--top-seek-backward-button));
  --media-seek-forward-button: var(--seek-forward-button, var(--top-seek-forward-button));
  --media-mute-button: var(--mute-button, var(--top-mute-button));
  --media-captions-button: var(--captions-button, var(--top-captions-button));
  --media-airplay-button: var(--airplay-button, var(--top-airplay-button));
  --media-pip-button: var(--pip-button, var(--top-pip-button));
  --media-fullscreen-button: var(--fullscreen-button, var(--top-fullscreen-button));
  --media-cast-button: var(--cast-button, var(--top-cast-button));
  --media-playback-rate-button: var(--playback-rate-button, var(--top-playback-rate-button));
  --media-volume-range: var(--volume-range, var(--top-volume-range));
  --media-time-range: var(--time-range, var(--top-time-range));
  --media-time-display: var(--time-display, var(--top-time-display));
  --media-duration-display: var(--duration-display, var(--top-duration-display));
  --media-title-display: var(--title-display, var(--top-title-display));
}

::part(center),
[part~='center'] {
  --media-controls: var(--controls, var(--center-controls));
  --media-play-button: var(--play-button, var(--center-play-button));
  --media-seek-live-button: var(--seek-live-button, var(--center-seek-live-button));
  --media-seek-backward-button: var(--seek-backward-button, var(--center-seek-backward-button));
  --media-seek-forward-button: var(--seek-forward-button, var(--center-seek-forward-button));
  --media-mute-button: var(--mute-button, var(--center-mute-button));
  --media-captions-button: var(--captions-button, var(--center-captions-button));
  --media-airplay-button: var(--airplay-button, var(--center-airplay-button));
  --media-pip-button: var(--pip-button, var(--center-pip-button));
  --media-fullscreen-button: var(--fullscreen-button, var(--center-fullscreen-button));
  --media-cast-button: var(--cast-button, var(--center-cast-button));
  --media-playback-rate-button: var(--playback-rate-button, var(--center-playback-rate-button));
  --media-volume-range: var(--volume-range, var(--center-volume-range));
  --media-time-range: var(--time-range, var(--center-time-range));
  --media-time-display: var(--time-display, var(--center-time-display));
  --media-duration-display: var(--duration-display, var(--center-duration-display));
}

::part(bottom),
[part~='bottom'] {
  --media-controls: var(--controls, var(--bottom-controls));
  --media-play-button: var(--play-button, var(--bottom-play-button));
  --media-seek-live-button: var(--seek-live-button, var(--bottom-seek-live-button));
  --media-seek-backward-button: var(--seek-backward-button, var(--bottom-seek-backward-button));
  --media-seek-forward-button: var(--seek-forward-button, var(--bottom-seek-forward-button));
  --media-mute-button: var(--mute-button, var(--bottom-mute-button));
  --media-captions-button: var(--captions-button, var(--bottom-captions-button));
  --media-airplay-button: var(--airplay-button, var(--bottom-airplay-button));
  --media-pip-button: var(--pip-button, var(--bottom-pip-button));
  --media-fullscreen-button: var(--fullscreen-button, var(--bottom-fullscreen-button));
  --media-cast-button: var(--cast-button, var(--bottom-cast-button));
  --media-playback-rate-button: var(--playback-rate-button, var(--bottom-playback-rate-button));
  --media-volume-range: var(--volume-range, var(--bottom-volume-range));
  --media-time-range: var(--time-range, var(--bottom-time-range));
  --media-time-display: var(--time-display, var(--bottom-time-display));
  --media-duration-display: var(--duration-display, var(--bottom-duration-display));
  --media-title-display: var(--title-display, var(--bottom-title-display));
}

[part*='seek-live button'] {
  display: var(--media-controls, var(--media-seek-live-button));
}

/** Once we implement these CSS vars in Media Chrome below selectors can be deleted! */

::part(play button) {
  display: var(--media-controls, var(--media-play-button));
}
::part(seek-backward button) {
  display: var(--media-controls, var(--media-seek-backward-button));
}
::part(seek-forward button) {
  display: var(--media-controls, var(--media-seek-forward-button));
}
::part(mute button) {
  display: var(--media-controls, var(--media-mute-button));
}
::part(captions button) {
  display: var(--media-controls, var(--media-captions-button));
}
::part(airplay button) {
  display: var(--media-controls, var(--media-airplay-button));
}
::part(pip button) {
  display: var(--media-controls, var(--media-pip-button));
}
::part(fullscreen button) {
  display: var(--media-controls, var(--media-fullscreen-button));
}
::part(cast button) {
  display: var(--media-controls, var(--media-cast-button));
}
::part(playback-rate button) {
  display: var(--media-controls, var(--media-playback-rate-button));
}
::part(volume range) {
  display: var(--media-controls, var(--media-volume-range));
}
::part(time range) {
  display: var(--media-controls, var(--media-time-range));
}
::part(time display) {
  display: var(--media-controls, var(--media-time-display));
}
::part(title display) {
  display: var(--media-controls, var(--media-title-display));
}
`;var Ru=`<template id="media-theme-mux">
  <style>
    :host(:not([audio])) {
      --secondary-color: transparent;
    }

    :host {
      --_primary-color: var(--primary-color, #fff);

      --media-icon-color: var(--_primary-color);
      --media-range-thumb-background: var(--_primary-color);
      --media-range-bar-color: var(--_primary-color);
      --media-control-background: var(--secondary-color);
      --media-control-hover-background: var(--secondary-color);
      --media-time-buffered-color: rgba(255, 255, 255, 0.4);
      --media-range-track-background: rgba(255, 255, 255, 0.5);
      --media-range-track-border-radius: 3px;
      --media-preview-thumbnail-border: 1px solid #fff;
      --media-preview-thumbnail-border-radius: 2px;
      --media-preview-time-margin: 5px 0 2px;
      color: var(--_primary-color);
      display: inline-block;
      width: 100%;
      height: 100%;
    }

    :host(.two-tone:not([audio])) {
      --mux-time-range-padding: 0px; /* px is needed in calc() */
      --media-preview-thumbnail-border: 0;
      --media-preview-thumbnail-border-radius: 2px 2px 0 0;
      --media-preview-time-border-radius: 0 0 2px 2px;
      --media-preview-time-margin: 0 0 8px;
      --media-preview-time-text-shadow: none;
    }

    :host([audio]) {
      --media-preview-time-border-radius: 3px;
      --media-preview-time-margin: 0 0 5px;
      --media-preview-time-text-shadow: none;
    }

    :host(.two-tone:not([audio])) media-time-range {
      --media-range-track-border-radius: 0;
    }

    :host([audio]) ::slotted([slot='media']) {
      height: 0px;
    }

    :host([audio]) :is(media-poster-image, media-loading-indicator) {
      display: none;
    }

    :host([audio]) media-controller {
      background: transparent;
    }

    :host([audio]) media-controller::part(vertical-layer) {
      background: transparent;
    }

    :host([audio]) media-control-bar {
      width: 100%;
    }

    [disabled],
    [aria-disabled='true'] {
      opacity: 60%;
      cursor: not-allowed;
    }

    media-captions-button:not(:is([media-captions-list], [media-subtitles-list])) {
      --captions-button: none;
    }

    media-volume-range[media-volume-unavailable] {
      --volume-range: none;
    }

    media-airplay-button[media-airplay-unavailable] {
      --airplay-button: none;
    }

    media-fullscreen-button[media-fullscreen-unavailable] {
      --fullscreen-button: none;
    }

    media-cast-button[media-cast-unavailable] {
      --cast-button: none;
    }

    media-pip-button[media-pip-unavailable] {
      --pip-button: none;
    }

    media-controller {
      width: 100%;
      height: 100%;
    }

    :host media-time-range {
      color: var(--_primary-color);
      --media-range-thumb-opacity: 0;
    }

    :host(:not([audio])) media-time-range {
      --media-range-padding-left: var(--mux-time-range-padding, 10px);
      --media-range-padding-right: var(--mux-time-range-padding, 10px);
      --media-range-padding: 0;
      z-index: 10;
      height: 10px;
      bottom: -3px;
      background: linear-gradient(
        180deg,
        transparent,
        transparent 3px,
        var(--media-control-background, rgba(20, 20, 30, 0.7)) 3px,
        var(--media-control-background, rgba(20, 20, 30, 0.7)) 7px,
        transparent 7px,
        transparent
      );
      width: 100%;
    }

    media-control-bar {
      --media-control-padding: 9px 7px;
    }

    .size-small media-control-bar {
      --media-control-padding: 9px 5px;
    }

    .size-extra-small media-control-bar {
      --media-control-padding: 4px 3px;
    }

    media-control-bar :is([role='button'], [role='switch'], button) {
      line-height: 0;
    }

    media-control-bar :is(media-text-display, mxp-time-display):first-child {
      --media-control-padding: 9px 5px 9px 10px;
    }

    .spacer {
      flex-grow: 1;
      background-color: var(--media-control-background, rgba(20, 20, 30, 0.7));
    }

    /* Add a small space on the right to have the play button and
     * fullscreen button aligned in relation to the progress bar. */
    media-control-bar:not([slot])::after {
      content: '';
      width: 2px;
      height: 100%;
      background-color: var(--media-control-background, rgba(20, 20, 30, 0.7));
    }

    media-control-bar[slot='top-chrome'] {
      min-height: 42px;
      pointer-events: none;
    }

    :host([title]) media-control-bar[slot='top-chrome']::before {
      content: '';
      position: absolute;
      width: 100%;
      padding-bottom: min(160px, 25%);
      background: linear-gradient(rgb(0 0 0 / 0.4), transparent);
    }

    media-control-bar[slot='top-chrome'] > * {
      --media-control-background: transparent;
      --media-control-hover-background: transparent;
      position: relative;
    }

    media-controller::part(vertical-layer) {
      transition: background-color 1s;
    }

    media-controller:is([media-paused], :not([user-inactive]))::part(vertical-layer) {
      background-color: var(--controls-backdrop-color, var(--controls, transparent));
      transition: background-color 0.25s;
    }

    .center-controls {
      --media-button-icon-width: 100%;
      --media-button-icon-height: auto;
      pointer-events: none;
      width: 100%;
      display: flex;
      flex-flow: row;
      align-items: center;
      justify-content: center;
      filter: drop-shadow(0 0 2px rgb(0 0 0 / 0.25)) drop-shadow(0 0 6px rgb(0 0 0 / 0.25));
      paint-order: stroke;
      stroke: rgba(102, 102, 102, 1);
      stroke-width: 0.3px;
      text-shadow: 0 0 2px rgb(0 0 0 / 0.25), 0 0 6px rgb(0 0 0 / 0.25);
    }

    .center-controls media-play-button {
      --media-control-background: transparent;
      --media-control-hover-background: transparent;
      padding: 0;
      width: max(43px, min(10%, 55px));
    }

    .center-controls media-seek-backward-button,
    .center-controls media-seek-forward-button {
      --media-control-background: transparent;
      --media-control-hover-background: transparent;
      padding: 0;
      margin: 0 2%;
      width: max(33px, min(8%, 40px));
    }

    media-control-bar:not([slot]) media-seek-backward-button {
      padding-right: 5px;
    }

    media-control-bar:not([slot]) media-seek-forward-button {
      padding-left: 5px;
    }

    media-loading-indicator {
      --media-loading-icon-width: 100%;
      --media-button-icon-height: auto;
      pointer-events: none;
      position: absolute;
      width: min(15%, 150px);
      display: flex;
      flex-flow: row;
      align-items: center;
      justify-content: center;
    }

    /* Intentionally don't target the div for transition but the children
     of the div. Prevents messing with media-chrome's autohide feature. */
    media-loading-indicator + div * {
      transition: opacity 0.15s;
      opacity: 1;
    }

    media-loading-indicator[media-loading]:not([media-paused]) ~ div > * {
      opacity: 0;
      transition-delay: 400ms;
    }

    media-volume-range {
      width: min(100%, 100px);
    }

    media-time-display {
      white-space: nowrap;
    }

    :is(media-time-display, media-text-display, media-playback-rate-button[role='button']) {
      color: inherit;
      line-height: 24px;
    }

    .title-display {
      font-size: 16px;
      text-shadow: 0 0 2px rgb(0 0 0 / 0.6);
    }

    :host([audio]) .title-display {
      flex-grow: 1;
      font-size: 21px;
    }
  </style>
  <media-controller
    gestures-disabled="{{disabled}}"
    hotkeys="{{hotkeys}}"
    nohotkeys="{{nohotkeys}}"
    audio="{{audio}}"
    class="size-{{playerSize}}"
    exportparts="layer, media-layer, poster-layer, vertical-layer, centered-layer, gesture-layer"
  >
    <slot name="media" slot="media"></slot>
    <media-poster-image
      slot="poster"
      part="poster"
      src="{{poster}}"
      placeholder-src="{{placeholder}}"
    ></media-poster-image>
    <media-loading-indicator slot="centered-chrome" no-auto-hide></media-loading-indicator>

    <template partial="TitleDisplay">
      <template if="title">
        <media-text-display part="top title display" class="title-display"> {{title}} </media-text-display>
      </template>
    </template>

    <template partial="PlayButton">
      <media-play-button
        part="{{section ?? 'bottom'}} play button"
        disabled="{{disabled}}"
        aria-disabled="{{disabled}}"
      >
        <svg aria-hidden="true" viewBox="0 0 24 24" slot="play">
          <path d="m6.73 20.93 14.05-8.54a.46.46 0 0 0 0-.78L6.73 3.07a.48.48 0 0 0-.73.39v17.07a.48.48 0 0 0 .73.4Z" />
        </svg>
        <svg aria-hidden="true" viewBox="0 0 24 24" slot="pause">
          <path
            d="M6 19.5a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-15a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v15ZM14.5 4a.5.5 0 0 0-.5.5v15a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-15a.5.5 0 0 0-.5-.5h-3Z"
          />
        </svg>
      </media-play-button>
    </template>

    <template partial="SeekBackwardButton">
      <media-seek-backward-button
        seek-offset="{{backwardSeekOffset}}"
        part="{{section ?? 'bottom'}} seek-backward button"
        disabled="{{disabled}}"
        aria-disabled="{{disabled}}"
      >
        <svg aria-hidden="true" viewBox="0 0 22 24" slot="backward">
          <path d="M11 6V3L5.37 7 11 10.94V8a5.54 5.54 0 0 1 1.9 10.48v2.12A7.5 7.5 0 0 0 11 6Z" />
          <text class="value" transform="translate(2.5 21)" style="font-size: 8px; font-family: 'ArialMT', 'Arial'">
            {{backwardSeekOffset}}
          </text>
        </svg>
      </media-seek-backward-button>
    </template>

    <template partial="SeekForwardButton">
      <media-seek-forward-button
        seek-offset="{{forwardSeekOffset}}"
        part="{{section ?? 'bottom'}} seek-forward button"
        disabled="{{disabled}}"
        aria-disabled="{{disabled}}"
      >
        <svg aria-hidden="true" viewBox="0 0 22 24" slot="forward">
          <path d="M11 6V3l5.61 4L11 10.94V8a5.54 5.54 0 0 0-1.9 10.48v2.12A7.5 7.5 0 0 1 11 6Z" />
          <text class="value" transform="translate(10 21)" style="font-size: 8px; font-family: 'ArialMT', 'Arial'">
            {{forwardSeekOffset}}
          </text>
        </svg>
      </media-seek-forward-button>
    </template>

    <template partial="MuteButton">
      <media-mute-button part="bottom mute button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
        <svg aria-hidden="true" viewBox="0 0 24 24" slot="high">
          <path
            d="m11.14 4.86-4 4a.49.49 0 0 1-.35.14H3.25a.25.25 0 0 0-.25.25v5.5a.25.25 0 0 0 .25.25h3.54a.49.49 0 0 1 .36.15l4 4a.5.5 0 0 0 .85-.36V5.21a.5.5 0 0 0-.86-.35Zm2.74-1.56v1.52A7.52 7.52 0 0 1 19.47 12a7.52 7.52 0 0 1-5.59 7.18v1.52A9 9 0 0 0 21 12a9 9 0 0 0-7.12-8.7Zm3.56 8.7a5.49 5.49 0 0 0-3.56-5.1v1.66a3.93 3.93 0 0 1 0 6.88v1.66a5.49 5.49 0 0 0 3.56-5.1Z"
          />
        </svg>
        <svg aria-hidden="true" viewBox="0 0 24 24" slot="low">
          <path
            d="m11.14 4.853-4 4a.49.49 0 0 1-.35.14H3.25a.25.25 0 0 0-.25.25v5.5a.25.25 0 0 0 .25.25h3.54a.49.49 0 0 1 .36.15l4 4a.5.5 0 0 0 .85-.36V5.203a.5.5 0 0 0-.86-.35Zm6.3 7.14a5.49 5.49 0 0 0-3.56-5.1v1.66a3.93 3.93 0 0 1 0 6.88v1.66a5.49 5.49 0 0 0 3.56-5.1Z"
          />
        </svg>
        <svg aria-hidden="true" viewBox="0 0 24 24" slot="medium">
          <path
            d="m11.14 4.853-4 4a.49.49 0 0 1-.35.14H3.25a.25.25 0 0 0-.25.25v5.5a.25.25 0 0 0 .25.25h3.54a.49.49 0 0 1 .36.15l4 4a.5.5 0 0 0 .85-.36V5.203a.5.5 0 0 0-.86-.35Zm6.3 7.14a5.49 5.49 0 0 0-3.56-5.1v1.66a3.93 3.93 0 0 1 0 6.88v1.66a5.49 5.49 0 0 0 3.56-5.1Z"
          />
        </svg>
        <svg aria-hidden="true" viewBox="0 0 24 24" slot="off">
          <path
            d="m3 4.05 4.48 4.47-.33.33a.49.49 0 0 1-.36.15H3.25a.25.25 0 0 0-.25.25v5.5a.25.25 0 0 0 .25.25h3.54a.49.49 0 0 1 .36.15l4 4a.48.48 0 0 0 .36.15.5.5 0 0 0 .5-.5v-5.75l4.67 4.66a7.71 7.71 0 0 1-2.79 1.47v1.52a9.32 9.32 0 0 0 3.87-1.91L20 21l1-1L4.06 3 3 4.05Zm5.36 5.36 2.39 2.39V17L8 14.26a1.74 1.74 0 0 0-1.24-.51H4.25v-3.5h2.54A1.74 1.74 0 0 0 8 9.74l.36-.33ZM19.47 12a7.19 7.19 0 0 1-.89 3.47l1.11 1.1A8.64 8.64 0 0 0 21 12a9 9 0 0 0-7.12-8.7v1.52A7.52 7.52 0 0 1 19.47 12ZM12 8.88V5.21a.5.5 0 0 0-.5-.5.48.48 0 0 0-.36.15L9.56 6.44 12 8.88ZM15.91 12a4.284 4.284 0 0 1-.07.72l1.22 1.22a5.2 5.2 0 0 0 .38-1.94 5.49 5.49 0 0 0-3.56-5.1v1.66A4 4 0 0 1 15.91 12Z"
          />
        </svg>
      </media-mute-button>
    </template>

    <template partial="PipButton">
      <media-pip-button part="bottom pip button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
        <svg aria-hidden="true" viewBox="0 0 26 24" slot="enter">
          <path
            d="M22 3H4a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h6.75v-1.25h-6.5V4.25h17.5v6.5H23V4a1 1 0 0 0-1-1Zm0 10h-8a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1Zm-.5 6.5h-7v-5h7v5Z"
          />
        </svg>
        <svg aria-hidden="true" viewBox="0 0 26 24" slot="exit">
          <path
            d="M22 3H4a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h6.75v-1.25h-6.5V4.25h17.5v6.5H23V4a1 1 0 0 0-1-1Zm0 10h-8a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1Zm-.5 6.5h-7v-5h7v5Z"
          />
        </svg>
      </media-pip-button>
    </template>

    <template partial="CaptionsButton">
      <media-captions-button
        default-showing="{{defaultShowingCaptions}}"
        part="bottom captions button"
        disabled="{{disabled}}"
        aria-disabled="{{disabled}}"
      >
        <svg aria-hidden="true" viewBox="0 0 26 24" slot="on">
          <path
            d="M22.832 5.68a2.58 2.58 0 0 0-2.3-2.5c-3.62-.24-11.44-.24-15.06 0a2.58 2.58 0 0 0-2.3 2.5c-.23 4.21-.23 8.43 0 12.64a2.58 2.58 0 0 0 2.3 2.5c3.62.24 11.44.24 15.06 0a2.58 2.58 0 0 0 2.3-2.5c.23-4.21.23-8.43 0-12.64Zm-11.41 10.1a3.63 3.63 0 0 1-1.51.32 4.76 4.76 0 0 1-1.63-.27 4 4 0 0 1-1.28-.83 3.67 3.67 0 0 1-.84-1.26 4.23 4.23 0 0 1-.3-1.63 4.28 4.28 0 0 1 .3-1.64 3.53 3.53 0 0 1 .84-1.21 3.89 3.89 0 0 1 1.29-.8 4.76 4.76 0 0 1 1.63-.27 4.06 4.06 0 0 1 1.35.24c.225.091.44.205.64.34a2.7 2.7 0 0 1 .55.52l-1.27 1a1.79 1.79 0 0 0-.6-.46 2 2 0 0 0-.83-.16 2 2 0 0 0-1.56.69 2.35 2.35 0 0 0-.46.77 2.78 2.78 0 0 0-.16 1c-.009.34.046.68.16 1 .104.283.26.545.46.77.188.21.415.38.67.5a2 2 0 0 0 .84.18 1.87 1.87 0 0 0 .9-.21 1.78 1.78 0 0 0 .65-.6l1.38 1a2.88 2.88 0 0 1-1.22 1.01Zm7.52 0a3.63 3.63 0 0 1-1.51.32 4.76 4.76 0 0 1-1.63-.27 3.89 3.89 0 0 1-1.28-.83 3.55 3.55 0 0 1-.85-1.26 4.23 4.23 0 0 1-.3-1.63 4.28 4.28 0 0 1 .3-1.64 3.43 3.43 0 0 1 .85-1.25 3.75 3.75 0 0 1 1.28-.8 4.76 4.76 0 0 1 1.63-.27 4 4 0 0 1 1.35.24c.225.091.44.205.64.34.21.144.395.32.55.52l-1.27 1a1.79 1.79 0 0 0-.6-.46 2 2 0 0 0-.83-.16 2 2 0 0 0-1.56.69 2.352 2.352 0 0 0-.46.77 3.01 3.01 0 0 0-.16 1c-.003.34.05.678.16 1 .108.282.263.542.46.77.188.21.416.38.67.5a2 2 0 0 0 .84.18 1.87 1.87 0 0 0 .9-.21 1.78 1.78 0 0 0 .65-.6l1.38 1a2.82 2.82 0 0 1-1.21 1.05Z"
          />
        </svg>
        <svg aria-hidden="true" viewBox="0 0 26 24" slot="off">
          <path
            d="M22.832 5.68a2.58 2.58 0 0 0-2.3-2.5c-1.81-.12-4.67-.18-7.53-.18-2.86 0-5.72.06-7.53.18a2.58 2.58 0 0 0-2.3 2.5c-.23 4.21-.23 8.43 0 12.64a2.58 2.58 0 0 0 2.3 2.5c1.81.12 4.67.18 7.53.18 2.86 0 5.72-.06 7.53-.18a2.58 2.58 0 0 0 2.3-2.5c.23-4.21.23-8.43 0-12.64Zm-1.49 12.53a1.11 1.11 0 0 1-.91 1.11c-1.67.11-4.45.18-7.43.18-2.98 0-5.76-.07-7.43-.18a1.11 1.11 0 0 1-.91-1.11c-.21-4.137-.21-8.283 0-12.42a1.11 1.11 0 0 1 .91-1.11c1.67-.11 4.43-.18 7.43-.18s5.76.07 7.43.18a1.11 1.11 0 0 1 .91 1.11c.21 4.137.21 8.283 0 12.42ZM10.843 14a1.55 1.55 0 0 1-.76.18 1.57 1.57 0 0 1-.71-.18 1.69 1.69 0 0 1-.57-.42 2.099 2.099 0 0 1-.38-.58 2.47 2.47 0 0 1 0-1.64 2 2 0 0 1 .39-.66 1.73 1.73 0 0 1 .58-.42c.23-.103.479-.158.73-.16.241-.004.48.044.7.14.199.088.373.222.51.39l1.08-.89a2.179 2.179 0 0 0-.47-.44 2.81 2.81 0 0 0-.54-.32 2.91 2.91 0 0 0-.58-.15 2.71 2.71 0 0 0-.56 0 4.08 4.08 0 0 0-1.38.15 3.27 3.27 0 0 0-1.09.67 3.14 3.14 0 0 0-.71 1.06 3.62 3.62 0 0 0-.26 1.39 3.57 3.57 0 0 0 .26 1.38 3 3 0 0 0 .71 1.06c.316.293.687.52 1.09.67.443.16.91.238 1.38.23a3.2 3.2 0 0 0 1.28-.27c.401-.183.747-.47 1-.83l-1.17-.88a1.42 1.42 0 0 1-.53.52Zm6.62 0a1.58 1.58 0 0 1-.76.18 1.54 1.54 0 0 1-.7-.18 1.69 1.69 0 0 1-.57-.42 2.12 2.12 0 0 1-.43-.58 2.29 2.29 0 0 1 .39-2.3 1.84 1.84 0 0 1 1.32-.58c.241-.003.48.045.7.14.199.088.373.222.51.39l1.08-.92a2.43 2.43 0 0 0-.47-.44 3.22 3.22 0 0 0-.53-.29 2.999 2.999 0 0 0-.57-.15 2.87 2.87 0 0 0-.57 0 4.06 4.06 0 0 0-1.36.15 3.17 3.17 0 0 0-1.09.67 3 3 0 0 0-.72 1.06 3.62 3.62 0 0 0-.25 1.39 3.57 3.57 0 0 0 .25 1.38c.16.402.405.764.72 1.06a3.17 3.17 0 0 0 1.09.67c.44.16.904.237 1.37.23.441 0 .877-.092 1.28-.27a2.45 2.45 0 0 0 1-.83l-1.15-.85a1.49 1.49 0 0 1-.54.49Z"
          />
        </svg>
      </media-captions-button>
    </template>

    <template partial="AirplayButton">
      <media-airplay-button part="bottom airplay button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
        <svg aria-hidden="true" viewBox="0 0 26 24" slot="airplay">
          <path
            d="M13.19 14.22a.25.25 0 0 0-.38 0l-5.46 6.37a.25.25 0 0 0 .19.41h10.92a.25.25 0 0 0 .19-.41l-5.46-6.37Z"
          />
          <path
            d="M22 3H4a1 1 0 0 0-1 1v13a1 1 0 0 0 1 1h2.94L8 16.75H4.25V4.25h17.5v12.5H18L19.06 18H22a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1Z"
          />
        </svg>
      </media-airplay-button>
    </template>

    <template partial="FullscreenButton">
      <media-fullscreen-button part="bottom fullscreen button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
        <svg aria-hidden="true" viewBox="0 0 24 24" slot="enter">
          <path
            d="M20.25 14.5a.76.76 0 0 0-.75.75v4.25h-4.25a.75.75 0 1 0 0 1.5h5a.76.76 0 0 0 .75-.75v-5a.76.76 0 0 0-.75-.75Zm0-11.5h-5a.76.76 0 0 0-.75.75.76.76 0 0 0 .75.75h4.25v4.25a.75.75 0 1 0 1.5 0v-5a.76.76 0 0 0-.75-.75ZM8.75 19.5H4.5v-4.25a.76.76 0 0 0-.75-.75.76.76 0 0 0-.75.75v5a.76.76 0 0 0 .75.75h5a.75.75 0 1 0 0-1.5Zm0-16.5h-5a.76.76 0 0 0-.75.75v5a.76.76 0 0 0 .75.75.76.76 0 0 0 .75-.75V4.5h4.25a.76.76 0 0 0 .75-.75.76.76 0 0 0-.75-.75Z"
          />
        </svg>
        <svg aria-hidden="true" viewBox="0 0 24 24" slot="exit">
          <path
            d="M20.25 14.5h-5a.76.76 0 0 0-.75.75v5a.75.75 0 1 0 1.5 0V16h4.25a.75.75 0 1 0 0-1.5Zm-5-5h5a.75.75 0 1 0 0-1.5H16V3.75a.75.75 0 1 0-1.5 0v5a.76.76 0 0 0 .75.75Zm-6.5 5h-5a.75.75 0 1 0 0 1.5H8v4.25a.75.75 0 1 0 1.5 0v-5a.76.76 0 0 0-.75-.75Zm0-11.5a.76.76 0 0 0-.75.75V8H3.75a.75.75 0 0 0 0 1.5h5a.76.76 0 0 0 .75-.75v-5A.76.76 0 0 0 8.75 3Z"
          />
        </svg>
      </media-fullscreen-button>
    </template>

    <template partial="CastButton">
      <media-cast-button part="bottom cast button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
        <svg aria-hidden="true" viewBox="0 0 26 24" slot="enter">
          <path d="M3 15.5V17c2.206 0 4 1.794 4 4h1.5A5.5 5.5 0 0 0 3 15.5Zm0 3V21h2.5A2.5 2.5 0 0 0 3 18.5Z" />
          <path d="M3 12.5V14c3.86 0 7 3.14 7 7h1.5A8.5 8.5 0 0 0 3 12.5Z" />
          <path
            d="M22 3H4a1 1 0 0 0-1 1v6.984c.424 0 .84.035 1.25.086V4.25h17.5v15.5h-8.82c.051.41.086.826.086 1.25H22a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1Z"
          />
        </svg>
        <svg aria-hidden="true" viewBox="0 0 26 24" slot="exit">
          <path d="M3 15.5V17c2.206 0 4 1.794 4 4h1.5A5.5 5.5 0 0 0 3 15.5Zm0 3V21h2.5A2.5 2.5 0 0 0 3 18.5Z" />
          <path d="M3 12.5V14c3.86 0 7 3.14 7 7h1.5A8.5 8.5 0 0 0 3 12.5Z" />
          <path
            d="M22 3H4a1 1 0 0 0-1 1v6.984c.424 0 .84.035 1.25.086V4.25h17.5v15.5h-8.82c.051.41.086.826.086 1.25H22a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1Z"
          />
          <path d="M20.5 5.5h-15v5.811c3.52.906 6.283 3.67 7.189 7.19H20.5V5.5Z" />
        </svg>
      </media-cast-button>
    </template>

    <template partial="PlaybackRateButton">
      <media-playback-rate-button
        rates="{{playbackRates}}"
        part="bottom playback-rate button"
        disabled="{{disabled}}"
        aria-disabled="{{disabled}}"
      ></media-playback-rate-button>
    </template>

    <template partial="VolumeRange">
      <media-volume-range
        part="bottom volume range"
        disabled="{{disabled}}"
        aria-disabled="{{disabled}}"
      ></media-volume-range>
    </template>

    <template partial="TimeDisplay">
      <mxp-time-display
        remaining="{{defaultShowRemainingTime}}"
        part="bottom time display"
        disabled="{{disabled}}"
        aria-disabled="{{disabled}}"
      ></mxp-time-display>
    </template>

    <template partial="TimeRange">
      <media-time-range
        part="bottom time range"
        disabled="{{disabled}}"
        aria-disabled="{{disabled}}"
      ></media-time-range>
    </template>

    <template if="layout == 'audio on-demand'">
      <template if="title">
        <media-control-bar>{{>TitleDisplay}}</media-control-bar>
      </template>
      <media-control-bar>
        {{>PlayButton}} {{>SeekBackwardButton}} {{>SeekForwardButton}} {{>TimeDisplay}} {{>TimeRange}} {{>MuteButton}}
        {{>VolumeRange}} {{>PlaybackRateButton}} {{>AirplayButton}} {{>CastButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'audio dvr'">
      <template if="title">
        <media-control-bar>{{>TitleDisplay}}</media-control-bar>
      </template>
      <media-control-bar>
        {{>PlayButton}}
        <slot name="seek-live"></slot>
        {{>SeekBackwardButton}} {{>SeekForwardButton}} {{>TimeDisplay}} {{>TimeRange}} {{>MuteButton}} {{>VolumeRange}}
        {{>PlaybackRateButton}} {{>AirplayButton}} {{>CastButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'audio live'">
      <template if="title">
        <media-control-bar>{{>TitleDisplay}}</media-control-bar>
      </template>
      <media-control-bar>
        {{>PlayButton}}
        <slot name="seek-live"></slot>
        {{>MuteButton}} {{>VolumeRange}}
        <div class="spacer"></div>
        {{>AirplayButton}} {{>CastButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'on-demand extra-small'">
      {{>TimeRange}}
      <media-control-bar>
        {{>PlayButton}} {{>MuteButton}}
        <div class="spacer"></div>
        {{>CaptionsButton}} {{>FullscreenButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'on-demand small'">
      <media-control-bar slot="top-chrome"> {{>TitleDisplay}} </media-control-bar>
      <div slot="centered-chrome" class="center-controls">
        {{>SeekBackwardButton section="center"}} {{>PlayButton section="center"}} {{>SeekForwardButton
        section="center"}}
      </div>
      {{>TimeRange}}
      <media-control-bar>
        {{>TimeDisplay}} {{>MuteButton}} {{>VolumeRange}}
        <div class="spacer"></div>
        {{>PlaybackRateButton}} {{>CaptionsButton}} {{>AirplayButton}} {{>CastButton}} {{>PipButton}}
        {{>FullscreenButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'on-demand large'">
      <media-control-bar slot="top-chrome"> {{>TitleDisplay}} </media-control-bar>
      <div slot="centered-chrome" class="center-controls">{{>PlayButton section="center"}}</div>
      {{>TimeRange}}
      <media-control-bar>
        {{>PlayButton}} {{>SeekBackwardButton}} {{>SeekForwardButton}} {{>TimeDisplay}} {{>MuteButton}} {{>VolumeRange}}
        <div class="spacer"></div>
        {{>PlaybackRateButton}} {{>CaptionsButton}} {{>AirplayButton}} {{>CastButton}} {{>PipButton}}
        {{>FullscreenButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'live extra-small'">
      <media-control-bar slot="top-chrome">
        <slot name="seek-live"></slot>
      </media-control-bar>
      <media-control-bar>
        {{>PlayButton}} {{>MuteButton}}
        <div class="spacer"></div>
        {{>CaptionsButton}} {{>FullscreenButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'live small'">
      <media-control-bar slot="top-chrome">
        <slot name="seek-live"></slot>
        {{>TitleDisplay}}
      </media-control-bar>
      <div slot="centered-chrome" class="center-controls">{{>PlayButton section="center"}}</div>
      <media-control-bar>
        {{>MuteButton}} {{>VolumeRange}}
        <div class="spacer"></div>
        {{>CaptionsButton}} {{>AirplayButton}} {{>CastButton}} {{>PipButton}} {{>FullscreenButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'live large'">
      <media-control-bar slot="top-chrome">
        <slot name="seek-live"></slot>
        {{>TitleDisplay}}
      </media-control-bar>
      <div slot="centered-chrome" class="center-controls">{{>PlayButton section="center"}}</div>
      <media-control-bar>
        {{>PlayButton}} {{>MuteButton}} {{>VolumeRange}}
        <div class="spacer"></div>
        {{>CaptionsButton}} {{>AirplayButton}} {{>CastButton}} {{>PipButton}} {{>FullscreenButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'dvr extra-small'">
      <media-control-bar slot="top-chrome">
        <slot name="seek-live"></slot>
      </media-control-bar>
      {{>TimeRange}}
      <media-control-bar>
        {{>PlayButton}} {{>MuteButton}}
        <div class="spacer"></div>
        {{>CaptionsButton}} {{>FullscreenButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'dvr small'">
      <media-control-bar slot="top-chrome">
        <slot name="seek-live"></slot>
        {{>TitleDisplay}}
      </media-control-bar>
      <div slot="centered-chrome" class="center-controls">
        {{>SeekBackwardButton section="center"}} {{>PlayButton section="center"}} {{>SeekForwardButton
        section="center"}}
      </div>
      {{>TimeRange}}
      <media-control-bar>
        {{>MuteButton}} {{>VolumeRange}}
        <div class="spacer"></div>
        {{>CaptionsButton}} {{>AirplayButton}} {{>CastButton}} {{>PipButton}} {{>FullscreenButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'dvr large'">
      <media-control-bar slot="top-chrome">
        <slot name="seek-live"></slot>
        {{>TitleDisplay}}
      </media-control-bar>
      <div slot="centered-chrome" class="center-controls">{{>PlayButton section="center"}}</div>
      {{>TimeRange}}
      <media-control-bar>
        {{>PlayButton}} {{>SeekBackwardButton}} {{>SeekForwardButton}} {{>MuteButton}} {{>VolumeRange}}
        <div class="spacer"></div>
        {{>CaptionsButton}} {{>AirplayButton}} {{>CastButton}} {{>PipButton}} {{>FullscreenButton}}
      </media-control-bar>
    </template>

    <slot></slot>
  </media-controller>
</template>
`;var Cu=`
  :host {
    z-index: 100;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    box-sizing: border-box;
    color: #fff;
    line-height: 18px;
    font-family: Arial, sans-serif;
    padding: var(--media-dialog-backdrop-padding, 0);
    background: var(--media-dialog-backdrop-background,
      linear-gradient(to bottom, rgba(20, 20, 30, 0.7) 50%, rgba(20, 20, 30, 0.9))
    );
    /* Needs to use !important to prevent overwrite of media-chrome */
    transition: var(--media-dialog-transition-open, visibility .2s, opacity .2s) !important;
    transform: var(--media-dialog-transform-open, none) !important;
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: auto !important;
  }

  :host(:not([open])) {
    /* Needs to use !important to prevent overwrite of media-chrome */
    transition: var(--media-dialog-transition-close, visibility .1s, opacity .1s) !important;
    transform: var(--media-dialog-transform-close, none) !important;
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
  }

  :focus-visible {
    box-shadow: 0 0 0 2px rgba(27, 127, 204, 0.9);
  }

  .dialog {
    position: relative;
    box-sizing: border-box;
    background: var(--media-dialog-background, none);
    padding: var(--media-dialog-padding, 10px);
    width: min(320px, 100%);
    word-wrap: break-word;
    max-height: 100%;
    overflow: auto;
    text-align: center;
    line-height: 1.4;
  }
`,Ou=Et.createElement("template");Ou.innerHTML=`
  <style>
    ${Cu}
  </style>

  <div class="dialog">
    <slot></slot>
  </div>
`;var pr=class extends Qe.HTMLElement{constructor(){var e;super();this.attachShadow({mode:"open"}),(e=this.shadowRoot)==null||e.appendChild(this.constructor.template.content.cloneNode(!0))}show(){this.setAttribute("open",""),this.dispatchEvent(new CustomEvent("open",{composed:!0,bubbles:!0})),Mu(this)}close(){!this.hasAttribute("open")||(this.removeAttribute("open"),this.dispatchEvent(new CustomEvent("close",{composed:!0,bubbles:!0})),Xf(this))}attributeChangedCallback(e,n,a){e==="open"&&n!==a&&(a!=null?this.show():this.close())}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","dialog"),this.hasAttribute("open")&&Mu(this)}};pr.styles=Cu,pr.template=Ou,pr.observedAttributes=["open"];function Mu(r){let t=new CustomEvent("initfocus",{composed:!0,bubbles:!0,cancelable:!0});if(r.dispatchEvent(t),t.defaultPrevented)return;let e=r.querySelector("[autofocus]:not([disabled])");!e&&r.tabIndex>=0&&(e=r),e||(e=Pu(r.shadowRoot)),r._previouslyFocusedElement=Et.activeElement,Et.activeElement instanceof HTMLElement&&Et.activeElement.blur(),r.addEventListener("transitionend",()=>{e instanceof HTMLElement&&e.focus({preventScroll:!0})},{once:!0})}function Pu(r){let e=["button","input","keygen","select","textarea"].map(function(a){return a+":not([disabled])"});e.push('[tabindex]:not([disabled]):not([tabindex=""])');let n=r==null?void 0:r.querySelector(e.join(", "));if(!n&&"attachShadow"in Element.prototype){let a=(r==null?void 0:r.querySelectorAll("*"))||[];for(let u=0;u<a.length&&!(a[u].tagName&&a[u].shadowRoot&&(n=Pu(a[u].shadowRoot),n));u++);}return n}function Xf(r){r._previouslyFocusedElement instanceof HTMLElement&&r._previouslyFocusedElement.focus()}Qe.customElements.get("media-dialog")||(Qe.customElements.define("media-dialog",pr),Qe.MediaDialog=pr);var Js=pr;var ku=Et.createElement("template");ku.innerHTML=`
  <style>
    ${Js.styles}

    .close {
      background: none;
      color: inherit;
      border: none;
      padding: 0;
      font: inherit;
      cursor: pointer;
      outline: inherit;
      width: 28px;
      height: 28px;
      position: absolute;
      top: 1rem;
      right: 1rem;
    }
  </style>

  <div class="dialog">
    <slot></slot>
  </div>

  <slot name="close">
    <button class="close" tabindex="0">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </slot>
`;var Vi=class extends Js{constructor(){var t,e;super(),(e=(t=this.shadowRoot)==null?void 0:t.querySelector(".close"))==null||e.addEventListener("click",()=>{this.close()})}};Vi.template=ku;Qe.customElements.get("mxp-dialog")||(Qe.customElements.define("mxp-dialog",Vi),Qe.MxpDialog=Vi);var $i=new WeakMap,Yi=class{constructor(t,e){this.element=t;this.type=e;this.element.addEventListener(this.type,this);let n=$i.get(this.element);n&&n.set(this.type,this)}set(t){if(typeof t=="function")this.handleEvent=t.bind(this.element);else if(typeof t=="object"&&typeof t.handleEvent=="function")this.handleEvent=t.handleEvent.bind(t);else{this.element.removeEventListener(this.type,this);let e=$i.get(this.element);e&&e.delete(this.type)}}static for(t){$i.has(t.element)||$i.set(t.element,new Map);let e=t.attributeName.slice(2),n=$i.get(t.element);return n&&n.has(e)?n.get(e):new Yi(t.element,e)}};function Qf(r,t){return r instanceof Tt&&r.attributeName.startsWith("on")?(Yi.for(r).set(t),r.element.removeAttributeNS(r.attributeNamespace,r.attributeName),!0):!1}function Zf(r,t){return t instanceof oa&&r instanceof nr?(t.renderInto(r),!0):!1}function Jf(r,t){return t instanceof DocumentFragment&&r instanceof nr?(t.childNodes.length&&r.replace(...t.childNodes),!0):!1}function qf(r,t){if(r instanceof Tt){let e=r.attributeNamespace,n=r.element.getAttributeNS(e,r.attributeName);return String(t)!==n&&(r.value=String(t)),!0}return r.value=String(t),!0}function eh(r,t){if(r instanceof Tt&&t instanceof Element){let e=r.element;return e[r.attributeName]!==t&&(r.element.removeAttributeNS(r.attributeNamespace,r.attributeName),e[r.attributeName]=t),!0}return!1}function th(r,t){if(typeof t=="boolean"&&r instanceof Tt){let e=r.attributeNamespace,n=r.element.hasAttributeNS(e,r.attributeName);return t!==n&&(r.booleanValue=t),!0}return!1}function rh(r,t){return t===!1&&r instanceof nr?(r.replace(""),!0):!1}function ih(r,t){eh(r,t)||th(r,t)||Qf(r,t)||rh(r,t)||Zf(r,t)||Jf(r,t)||qf(r,t)}var qs=new Map,wu=new WeakMap,Uu=new WeakMap,oa=class{constructor(t,e,n){this.strings=t;this.values=e;this.processor=n;this.stringsKey=this.strings.join("")}get template(){if(qs.has(this.stringsKey))return qs.get(this.stringsKey);{let t=Et.createElement("template"),e=this.strings.length-1;return t.innerHTML=this.strings.reduce((n,a,u)=>n+a+(u<e?`{{ ${u} }}`:""),""),qs.set(this.stringsKey,t),t}}renderInto(t){let e=this.template;if(wu.get(t)!==e){wu.set(t,e);let a=new ir(e,this.values,this.processor);Uu.set(t,a),t instanceof nr?t.replace(...a.children):t.appendChild(a);return}let n=Uu.get(t);n&&n.update(this.values)}},nh={processCallback(r,t,e){var n;if(!!e){for(let[a,u]of t)if(a in e){let M=(n=e[a])!=null?n:"";ih(u,M)}}}};function Ht(r,...t){return new oa(r,t,nh)}function Nu(r,t){r.renderInto(t)}var eo=Et.createElement("template");"innerHTML"in eo&&(eo.innerHTML=Ru);var Bu=r=>Ht`
  <style>
    ${Iu}
  </style>
  ${oh(r)}
`,to=r=>[we.LIVE,we.LL_LIVE].includes(r.streamType),ro=r=>[we.LIVE,we.LL_LIVE,we.DVR,we.LL_DVR].includes(r.streamType),ah=r=>{let t="";return r.audio&&(t+="audio "),to(r)?t+="live":ro(r)?t+="dvr":t+=r.streamType||"on-demand",!r.audio&&r.playerSize&&(t+=` ${r.playerSize}`),t},sh=r=>{let t=r.hotKeys?`${r.hotKeys}`:"";return ro(r)&&(t+=" noarrowleft noarrowright"),t},oh=r=>{var t,e,n,a,u,M,C,O,L,A,x,I,_,b,S,v,i,d,p,T,l,o,h,E,s,c,m,f,g,y,R,D;return Ht`
  <media-theme
    template="${(t=r.theme)!=null?t:eo.content.children[0]}"
    class="size-${r.playerSize}${r.secondaryColor?" two-tone":""}"
    player-size="${(e=r.playerSize)!=null?e:!1}"
    layout="${ah(r)}"
    hotkeys="${sh(r)||!1}"
    nohotkeys="${r.noHotKeys||!r.hasSrc||r.isDialogOpen||!1}"
    disabled="${!r.hasSrc||r.isDialogOpen}"
    audio="${(n=r.audio)!=null?n:!1}"
    style="${(a=tu({"--primary-color":r.primaryColor,"--secondary-color":r.secondaryColor}))!=null?a:!1}"
    default-showing-captions="${!r.defaultHiddenCaptions}"
    forward-seek-offset="${(u=r.forwardSeekOffset)!=null?u:!1}"
    backward-seek-offset="${(M=r.backwardSeekOffset)!=null?M:!1}"
    playback-rates="${(C=r.playbackRates)!=null?C:!1}"
    default-show-remaining-time="${(O=r.defaultShowRemainingTime)!=null?O:!1}"
    title="${(L=r.title)!=null?L:!1}"
    poster="${r.poster===""?!1:(A=r.poster)!=null?A:!1}"
    placeholder="${(x=r.placeholder)!=null?x:!1}"
    exportparts="top, center, bottom, layer, media-layer, poster-layer, vertical-layer, centered-layer, gesture-layer, poster, seek-live, play, button, seek-backward, seek-forward, mute, captions, airplay, pip, fullscreen, cast, playback-rate, volume, range, time, display"
  >
    <mux-video
      slot="media"
      crossorigin="${(I=r.crossOrigin)!=null?I:""}"
      playsinline
      autoplay="${(_=r.autoplay)!=null?_:!1}"
      muted="${(b=r.muted)!=null?b:!1}"
      loop="${(S=r.loop)!=null?S:!1}"
      preload="${(v=r.preload)!=null?v:!1}"
      debug="${(i=r.debug)!=null?i:!1}"
      prefer-cmcd="${(d=r.preferCmcd)!=null?d:!1}"
      disable-cookies="${(p=r.disableCookies)!=null?p:!1}"
      prefer-playback="${(T=r.preferPlayback)!=null?T:!1}"
      start-time="${r.startTime!=null?r.startTime:!1}"
      beacon-collection-domain="${(l=r.beaconCollectionDomain)!=null?l:!1}"
      player-software-name="${(o=r.playerSoftwareName)!=null?o:!1}"
      player-software-version="${(h=r.playerSoftwareVersion)!=null?h:!1}"
      env-key="${(E=r.envKey)!=null?E:!1}"
      stream-type="${(s=r.streamType)!=null?s:!1}"
      custom-domain="${(c=r.customDomain)!=null?c:!1}"
      src="${r.src?r.src:r.playbackId?Vs(r.playbackId,{domain:r.customDomain,token:r.tokens.playback}):!1}"
      cast-src="${r.src?r.src:r.playbackId?Vs(r.playbackId,{domain:r.customDomain,token:r.tokens.playback}):!1}"
      cast-stream-type="${to(r)?"live":!1}"
      exportparts="video"
    >
      ${r.storyboard?Ht`<track label="thumbnails" default kind="metadata" src="${r.storyboard}" />`:Ht``}
    </mux-video>
    ${ro(r)?Ht`<button
          slot="seek-live"
          part="${to(r)?"top":"bottom"} seek-live button"
          disabled="${r.inLiveWindow||!r.hasSrc||r.isDialogOpen}"
          aria-disabled="${(r.inLiveWindow||!r.hasSrc||r.isDialogOpen)&&"true"}"
          in-live-window="${r.inLiveWindow}"
          onclick="${function(P){var N;if((N=r.onSeekToLive)==null||N.call(r,P),r.paused){let B=new CustomEvent("mediaplayrequest",{composed:!0,bubbles:!0});this.dispatchEvent(B)}}}"
        >
          <svg viewBox="0 0 8 8"><circle cx="4" cy="4" r="4"></circle></svg>
          Live
        </button>`:Ht``}
    <mxp-dialog
      no-auto-hide
      open="${(m=r.isDialogOpen)!=null?m:!1}"
      onclose="${r.onCloseErrorDialog}"
      oninitfocus="${r.onInitFocusDialog}"
    >
      ${(f=r.dialog)!=null&&f.title?Ht`<h3>${r.dialog.title}</h3>`:Ht``}
      <p>
        ${(g=r.dialog)==null?void 0:g.message}
        ${(y=r.dialog)!=null&&y.linkUrl?Ht`<a
              href="${r.dialog.linkUrl}"
              target="_blank"
              rel="external noopener"
              aria-label="${(R=r.dialog.linkText)!=null?R:""} ${Oe("(opens in a new window)")}"
              >${(D=r.dialog.linkText)!=null?D:r.dialog.linkUrl}</a
            >`:Ht``}
      </p>
    </mxp-dialog>
  </media-theme>
`};function la(r,t,e,n,a){var C,O,L;let u={},M={};switch(r.code){case $e.MEDIA_ERR_NETWORK:{switch(u.title=Oe("Network Error",a),u.message=r.message,(C=r.data)==null?void 0:C.response.code){case 412:{u.title=Oe("Video is not currently available",a),u.message=Oe("The live stream or video file are not yet ready.",a),M.message=Oe("This playback-id may belong to a live stream that is not currently active or an asset that is not ready.",a),M.file="412-not-playable.md";break}case 404:{u.title=Oe("Video does not exist",a),u.message="",M.message=Oe("This playback-id does not exist. You may have used an Asset ID or an ID from a different resource.",a),M.file="404-not-found.md";break}case 403:{if(u.title=Oe("Invalid playback URL",a),u.message=Oe("The video URL or playback-token are formatted with incorrect or incomplete information.",a),M.message=Oe("403 error trying to access this playback URL. If this is a signed URL, you might need to provide a playback-token.",a),M.file="missing-signed-tokens.md",!n)break;let{exp:A,aud:x,sub:I}=fr(n),_=Date.now()>A*1e3,b=I!==e,S=x!=="v",v={timeStyle:"medium",dateStyle:"medium"};if(_){u.title=Oe("Video URL has expired",a),u.message=Oe("The video\u2019s secured playback-token has expired.",a),M.message=Oe("This playback is using signed URLs and the playback-token has expired. Expired at: {expiredDate}. Current time: {currentDate}.",a).format({expiredDate:new Intl.DateTimeFormat(Rr.code,v).format(A*1e3),currentDate:new Intl.DateTimeFormat(Rr.code,v).format(Date.now())}),M.file="403-expired-token.md";break}if(b){u.title=Oe("Video URL is formatted incorrectly",a),u.message=Oe("The video\u2019s playback ID does not match the one encoded in the playback-token.",a),M.message=Oe("The specified playback ID {playbackId} and the playback ID encoded in the playback-token {tokenPlaybackId} do not match.",a).format({playbackId:e,tokenPlaybackId:I}),M.file="403-playback-id-mismatch.md";break}if(S){u.title=Oe("Video URL is formatted incorrectly",a),u.message=Oe("The playback-token is formatted with incorrect information.",a),M.message=Oe("The playback-token has an incorrect aud value: {tokenType}. aud value should be v.",a).format({tokenType:x}),M.file="403-incorrect-aud-value.md";break}M.message=Oe("403 error trying to access this playback URL. If this is a signed playback ID, the token might not have been generated correctly.",a),M.file="403-malformatted-token.md";break}}break}case $e.MEDIA_ERR_DECODE:{let{message:A}=r;u={title:Oe("Media Error",a),message:A},M.file="media-decode-error.md";break}case $e.MEDIA_ERR_SRC_NOT_SUPPORTED:{let A=(L=(O=r.data)==null?void 0:O.response)==null?void 0:L.code;if(A>=400&&A<500){r.code=$e.MEDIA_ERR_NETWORK,r.data={response:{code:A}},{dialog:u,devlog:M}=la(r,t,e,n);break}u={title:Oe("Source Not Supported",a),message:r.message},M.file="media-src-not-supported.md";break}default:u={title:Oe("Error",a),message:r.message};break}return t&&(u={title:Oe("Your device appears to be offline",a),message:Oe("Check your internet connection and try reloading this video.",a)}),{dialog:u,devlog:M}}var lh=Object.values(we),uh=700,dh=300,io={LG:"large",SM:"small",XS:"extra-small"};function ua(r){let t=r.getBoundingClientRect();return t.width<dh?io.XS:t.width<uh?io.SM:io.LG}var ar={SRC:"src",POSTER:"poster"},pe={STYLE:"style",DEFAULT_HIDDEN_CAPTIONS:"default-hidden-captions",PRIMARY_COLOR:"primary-color",SECONDARY_COLOR:"secondary-color",FORWARD_SEEK_OFFSET:"forward-seek-offset",BACKWARD_SEEK_OFFSET:"backward-seek-offset",PLAYBACK_TOKEN:"playback-token",THUMBNAIL_TOKEN:"thumbnail-token",STORYBOARD_TOKEN:"storyboard-token",THUMBNAIL_TIME:"thumbnail-time",AUDIO:"audio",NOHOTKEYS:"nohotkeys",HOTKEYS:"hotkeys",PLAYBACK_RATES:"playbackrates",DEFAULT_SHOW_REMAINING_TIME:"default-show-remaining-time",TITLE:"title",PLACEHOLDER:"placeholder"};function ch(r,t){var n,a;return{src:!r.playbackId&&r.src,playbackId:r.playbackId,hasSrc:!!r.playbackId||!!r.src,poster:r.poster,storyboard:r.storyboard,placeholder:r.getAttribute("placeholder"),theme:r.getAttribute("theme"),thumbnailTime:!r.tokens.thumbnail&&r.thumbnailTime,autoplay:r.autoplay,crossOrigin:r.crossOrigin,loop:r.loop,noHotKeys:r.hasAttribute(pe.NOHOTKEYS),hotKeys:r.getAttribute(pe.HOTKEYS),muted:r.muted,paused:r.paused,preload:r.preload,envKey:r.envKey,preferCmcd:r.preferCmcd,debug:r.debug,disableCookies:r.disableCookies,tokens:r.tokens,beaconCollectionDomain:r.beaconCollectionDomain,metadata:r.metadata,playerSoftwareName:r.playerSoftwareName,playerSoftwareVersion:r.playerSoftwareVersion,startTime:r.startTime,preferPlayback:r.preferPlayback,audio:r.audio,streamType:r.streamType,primaryColor:r.primaryColor,secondaryColor:r.secondaryColor,forwardSeekOffset:r.forwardSeekOffset,backwardSeekOffset:r.backwardSeekOffset,defaultHiddenCaptions:r.defaultHiddenCaptions,defaultShowRemainingTime:r.defaultShowRemainingTime,playbackRates:r.getAttribute(pe.PLAYBACK_RATES),customDomain:(n=r.getAttribute(le.CUSTOM_DOMAIN))!=null?n:void 0,playerSize:ua((a=r.mediaController)!=null?a:r),title:r.getAttribute(pe.TITLE),...t}}var fh=Object.values(le),hh=Object.values(ar),vh=Object.values(pe),mh=Zn(),gh="mux-player",Fu={dialog:void 0,isDialogOpen:!1,inLiveWindow:!1},Ur,Xi,sr,Qi,li,Jt,ui,da,fa,Ku,Er,oi,di,ca,Zi,no,ha,Wu,va,Hu,ma,Gu,ga,ju,pa,Vu,Ea,$u,zi=class extends zs{constructor(){super();Fe(this,ui);Fe(this,fa);Fe(this,Er);Fe(this,di);Fe(this,Zi);Fe(this,ha);Fe(this,va);Fe(this,ma);Fe(this,ga);Fe(this,pa);Fe(this,Ea);Fe(this,Ur,!1);Fe(this,Xi,{});Fe(this,sr,!0);Fe(this,Qi,new Qn(this,"hotkeys"));Fe(this,li,void 0);Fe(this,Jt,{...Fu,onCloseErrorDialog:()=>He(this,Er,oi).call(this,{dialog:void 0,isDialogOpen:!1}),onInitFocusDialog:e=>{Gs(this,Et.activeElement)||e.preventDefault()},onSeekToLive:()=>$s(this)});this.attachShadow({mode:"open"}),He(this,fa,Ku).call(this),this.isConnected&&He(this,ui,da).call(this)}static get observedAttributes(){var e;return[...(e=zs.observedAttributes)!=null?e:[],...hh,...fh,...vh]}get theme(){var e;return(e=this.shadowRoot)==null?void 0:e.querySelector("media-theme")}get mediaController(){var e,n;return(n=(e=this.theme)==null?void 0:e.shadowRoot)==null?void 0:n.querySelector("media-controller")}get metadataFromAttrs(){return this.getAttributeNames().filter(e=>e.startsWith("metadata-")).reduce((e,n)=>{let a=this.getAttribute(n);return a!==null&&(e[n.replace(/^metadata-/,"").replace(/-/g,"_")]=a),e},{})}connectedCallback(){var n;He(this,Zi,no).call(this);let e=(n=this.shadowRoot)==null?void 0:n.querySelector("mux-video");e&&(e.metadata=this.metadataFromAttrs),He(this,ha,Wu).call(this)}disconnectedCallback(){He(this,va,Hu).call(this)}attributeChangedCallback(e,n,a){switch(_e(this,Ur)||He(this,ui,da).call(this),super.attributeChangedCallback(e,n,a),e){case pe.HOTKEYS:_e(this,Qi).value=a;break;case pe.THUMBNAIL_TIME:{a!=null&&this.tokens.thumbnail&&hr(Oe("Use of thumbnail-time with thumbnail-token is currently unsupported. Ignore thumbnail-time.").format({}));break}case pe.THUMBNAIL_TOKEN:{let{aud:M}=fr(a);a&&M!=="t"&&hr(Oe("The provided thumbnail-token should have audience value 't' instead of '{aud}'.").format({aud:M}));break}case pe.STORYBOARD_TOKEN:{let{aud:M}=fr(a);a&&M!=="s"&&hr(Oe("The provided storyboard-token should have audience value 's' instead of '{aud}'.").format({aud:M}));break}case le.PLAYBACK_ID:{a!=null&&a.includes("?token")&&Qt(Oe("The specificed playback ID {playbackId} contains a token which must be provided via the playback-token attribute.").format({playbackId:a})),this.streamType?this.streamType!=null&&!lh.includes(this.streamType)&&Jn({file:"invalid-stream-type.md",message:Oe("Invalid stream-type value supplied: `{streamType}`. Please provide stream-type as either: `on-demand`, `live`, `ll-live`, `live:dvr`, or `ll-live:dvr`").format({streamType:this.streamType})}):Jn({file:"invalid-stream-type.md",message:String(Oe("No stream-type value supplied. Defaulting to `on-demand`. Please provide stream-type as either: `on-demand`, `live`, `ll-live`, `live:dvr`, or `ll-live:dvr`"))});break}}[le.PLAYBACK_ID,ar.SRC,pe.PLAYBACK_TOKEN].includes(e)&&n!==a&&pt(this,Jt,{..._e(this,Jt),...Fu}),He(this,di,ca).call(this,{[ou(e)]:a})}get preferCmcd(){var e;return(e=this.getAttribute(le.PREFER_CMCD))!=null?e:void 0}set preferCmcd(e){e!==this.preferCmcd&&(e?qr.includes(e)?this.setAttribute(le.PREFER_CMCD,e):hr(`Invalid value for preferCmcd. Must be one of ${qr.join()}`):this.removeAttribute(le.PREFER_CMCD))}get hasPlayed(){var e,n;return(n=(e=this.mediaController)==null?void 0:e.hasAttribute("media-has-played"))!=null?n:!1}get inLiveWindow(){return _e(this,Jt).inLiveWindow}get _hls(){var e;return(e=this.media)==null?void 0:e._hls}get mux(){var e;return(e=this.media)==null?void 0:e.mux}get playbackId(){var e;return(e=this.getAttribute(le.PLAYBACK_ID))!=null?e:void 0}set playbackId(e){e?this.setAttribute(le.PLAYBACK_ID,e):this.removeAttribute(le.PLAYBACK_ID)}get src(){var e,n;return this.playbackId?(e=wr(this,ar.SRC))!=null?e:void 0:(n=this.getAttribute(ar.SRC))!=null?n:void 0}set src(e){e?this.setAttribute(ar.SRC,e):this.removeAttribute(ar.SRC)}get poster(){var n;let e=this.getAttribute(ar.POSTER);if(e!=null)return e;if(this.playbackId&&!this.audio)return au(this.playbackId,{domain:this.customDomain,thumbnailTime:(n=this.thumbnailTime)!=null?n:this.startTime,token:this.tokens.thumbnail})}set poster(e){e||e===""?this.setAttribute(ar.POSTER,e):this.removeAttribute(ar.POSTER)}get storyboard(){if(this.playbackId&&!this.audio&&(!this.streamType||![we.LIVE,we.LL_LIVE,we.DVR,we.LL_DVR].includes(this.streamType)))return su(this.playbackId,{domain:this.customDomain,token:this.tokens.storyboard})}get audio(){return this.hasAttribute(pe.AUDIO)}set audio(e){if(!e){this.removeAttribute(pe.AUDIO);return}this.setAttribute(pe.AUDIO,"")}get hotkeys(){return _e(this,Qi)}get nohotkeys(){return this.hasAttribute(pe.NOHOTKEYS)}set nohotkeys(e){if(!e){this.removeAttribute(pe.NOHOTKEYS);return}this.setAttribute(pe.NOHOTKEYS,"")}get thumbnailTime(){return tr(this.getAttribute(pe.THUMBNAIL_TIME))}set thumbnailTime(e){this.setAttribute(pe.THUMBNAIL_TIME,`${e}`)}get title(){var e;return(e=this.getAttribute(pe.TITLE))!=null?e:""}set title(e){e!==this.title&&(e?this.setAttribute(pe.TITLE,e):this.removeAttribute("title"),super.title=e)}get placeholder(){var e;return(e=wr(this,pe.PLACEHOLDER))!=null?e:""}set placeholder(e){this.setAttribute(pe.PLACEHOLDER,`${e}`)}get primaryColor(){var e;return(e=this.getAttribute(pe.PRIMARY_COLOR))!=null?e:void 0}set primaryColor(e){this.setAttribute(pe.PRIMARY_COLOR,`${e}`)}get secondaryColor(){var e;return(e=this.getAttribute(pe.SECONDARY_COLOR))!=null?e:"rgb(0 0 0 / .65)"}set secondaryColor(e){this.setAttribute(pe.SECONDARY_COLOR,`${e}`)}get defaultShowRemainingTime(){return this.hasAttribute(pe.DEFAULT_SHOW_REMAINING_TIME)}set defaultShowRemainingTime(e){e?this.setAttribute(pe.DEFAULT_SHOW_REMAINING_TIME,""):this.removeAttribute(pe.DEFAULT_SHOW_REMAINING_TIME)}get playbackRates(){if(!!this.hasAttribute(pe.PLAYBACK_RATES))return this.getAttribute(pe.PLAYBACK_RATES).trim().split(/\s*,?\s+/).map(e=>Number(e)).filter(e=>!Number.isNaN(e)).sort((e,n)=>e-n)}set playbackRates(e){if(!e){this.removeAttribute(pe.PLAYBACK_RATES);return}this.setAttribute(pe.PLAYBACK_RATES,e.join(" "))}get forwardSeekOffset(){var e;return(e=tr(this.getAttribute(pe.FORWARD_SEEK_OFFSET)))!=null?e:10}set forwardSeekOffset(e){this.setAttribute(pe.FORWARD_SEEK_OFFSET,`${e}`)}get backwardSeekOffset(){var e;return(e=tr(this.getAttribute(pe.BACKWARD_SEEK_OFFSET)))!=null?e:10}set backwardSeekOffset(e){this.setAttribute(pe.BACKWARD_SEEK_OFFSET,`${e}`)}get defaultHiddenCaptions(){return this.hasAttribute(pe.DEFAULT_HIDDEN_CAPTIONS)}set defaultHiddenCaptions(e){e?this.setAttribute(pe.DEFAULT_HIDDEN_CAPTIONS,""):this.removeAttribute(pe.DEFAULT_HIDDEN_CAPTIONS)}get playerSoftwareName(){var e;return(e=this.getAttribute(le.PLAYER_SOFTWARE_NAME))!=null?e:gh}get playerSoftwareVersion(){var e;return(e=this.getAttribute(le.PLAYER_SOFTWARE_VERSION))!=null?e:mh}get beaconCollectionDomain(){var e;return(e=this.getAttribute(le.BEACON_COLLECTION_DOMAIN))!=null?e:void 0}set beaconCollectionDomain(e){e!==this.beaconCollectionDomain&&(e?this.setAttribute(le.BEACON_COLLECTION_DOMAIN,e):this.removeAttribute(le.BEACON_COLLECTION_DOMAIN))}get customDomain(){var e;return(e=this.getAttribute(le.CUSTOM_DOMAIN))!=null?e:void 0}set customDomain(e){e!==this.customDomain&&(e?this.setAttribute(le.CUSTOM_DOMAIN,e):this.removeAttribute(le.CUSTOM_DOMAIN))}get envKey(){var e;return(e=wr(this,le.ENV_KEY))!=null?e:void 0}set envKey(e){this.setAttribute(le.ENV_KEY,`${e}`)}get debug(){return wr(this,le.DEBUG)!=null}set debug(e){e?this.setAttribute(le.DEBUG,""):this.removeAttribute(le.DEBUG)}get disableCookies(){return wr(this,le.DISABLE_COOKIES)!=null}set disableCookies(e){e?this.setAttribute(le.DISABLE_COOKIES,""):this.removeAttribute(le.DISABLE_COOKIES)}get streamType(){return wr(this,le.STREAM_TYPE)}set streamType(e){this.setAttribute(le.STREAM_TYPE,`${e}`)}get startTime(){return tr(wr(this,le.START_TIME))}set startTime(e){this.setAttribute(le.START_TIME,`${e}`)}get preferPlayback(){let e=this.getAttribute(le.PREFER_PLAYBACK);if(e===kt.MSE||e===kt.NATIVE)return e}set preferPlayback(e){e!==this.preferPlayback&&(e===kt.MSE||e===kt.NATIVE?this.setAttribute(le.PREFER_PLAYBACK,e):this.removeAttribute(le.PREFER_PLAYBACK))}get metadata(){var e;return(e=this.media)==null?void 0:e.metadata}set metadata(e){if(_e(this,Ur)||He(this,ui,da).call(this),!this.media){Qt("underlying media element missing when trying to set metadata. metadata will not be set.");return}this.media.metadata={...this.metadataFromAttrs,...e}}get tokens(){let e=this.getAttribute(pe.PLAYBACK_TOKEN),n=this.getAttribute(pe.THUMBNAIL_TOKEN),a=this.getAttribute(pe.STORYBOARD_TOKEN);return{..._e(this,Xi),...e!=null?{playback:e}:{},...n!=null?{thumbnail:n}:{},...a!=null?{storyboard:a}:{}}}set tokens(e){pt(this,Xi,e!=null?e:{})}get playbackToken(){var e;return(e=this.getAttribute(pe.PLAYBACK_TOKEN))!=null?e:void 0}set playbackToken(e){this.setAttribute(pe.PLAYBACK_TOKEN,`${e}`)}get thumbnailToken(){var e;return(e=this.getAttribute(pe.THUMBNAIL_TOKEN))!=null?e:void 0}set thumbnailToken(e){this.setAttribute(pe.THUMBNAIL_TOKEN,`${e}`)}get storyboardToken(){var e;return(e=this.getAttribute(pe.STORYBOARD_TOKEN))!=null?e:void 0}set storyboardToken(e){this.setAttribute(pe.STORYBOARD_TOKEN,`${e}`)}addTextTrack(e,n,a,u){var C;let M=(C=this.media)==null?void 0:C.nativeEl;if(!!M)return ks(M,e,n,a,u)}removeTextTrack(e){var a;let n=(a=this.media)==null?void 0:a.nativeEl;if(!!n)return wl(n,e)}get textTracks(){var e;return(e=this.media)==null?void 0:e.textTracks}};Ur=new WeakMap,Xi=new WeakMap,sr=new WeakMap,Qi=new WeakMap,li=new WeakMap,Jt=new WeakMap,ui=new WeakSet,da=function(){var e,n;if(!_e(this,Ur)){pt(this,Ur,!0),He(this,Er,oi).call(this,{playerSize:ua(this)});try{if(customElements.upgrade(this.theme),!(this.theme instanceof Qe.HTMLElement))throw""}catch{Qt("<media-theme> failed to upgrade!")}try{if(customElements.upgrade(this.media),!(this.media instanceof ql))throw""}catch{Qt("<mux-video> failed to upgrade!")}try{if(customElements.upgrade(this.mediaController),!(this.mediaController instanceof Di))throw""}catch{Qt("<media-controller> failed to upgrade!")}hu(this),He(this,ga,ju).call(this),He(this,pa,Vu).call(this),He(this,ma,Gu).call(this),pt(this,sr,(n=(e=this.mediaController)==null?void 0:e.hasAttribute("user-inactive"))!=null?n:!0),He(this,Ea,$u).call(this)}},fa=new WeakSet,Ku=function(){var e,n;try{(e=window==null?void 0:window.CSS)==null||e.registerProperty({name:"--primary-color",syntax:"<color>",inherits:!0,initialValue:"white"}),(n=window==null?void 0:window.CSS)==null||n.registerProperty({name:"--secondary-color",syntax:"<color>",inherits:!0,initialValue:"transparent"})}catch{}},Er=new WeakSet,oi=function(e){Object.assign(_e(this,Jt),e),He(this,di,ca).call(this)},di=new WeakSet,ca=function(e={}){Nu(Bu(ch(this,{..._e(this,Jt),...e})),this.shadowRoot)},Zi=new WeakSet,no=function(){var e,n;_e(this,Jt).playerSize!=ua((e=this.mediaController)!=null?e:this)&&He(this,Er,oi).call(this,{playerSize:ua((n=this.mediaController)!=null?n:this)})},ha=new WeakSet,Wu=function(){var e;pt(this,li,new ResizeObserver(()=>He(this,Zi,no).call(this))),_e(this,li).observe((e=this.mediaController)!=null?e:this)},va=new WeakSet,Hu=function(){var e;(e=_e(this,li))==null||e.disconnect()},ma=new WeakSet,Gu=function(){var n,a,u,M,C;(n=this.mediaController)==null||n.addEventListener("mediaplayrequest",O=>{var L;((L=O.target)==null?void 0:L.localName)==="media-play-button"&&this.streamType&&[we.LIVE,we.LL_LIVE,we.DVR,we.LL_DVR].includes(this.streamType)&&this.hasPlayed&&$s(this)});let e=()=>{let O=uu(this),L=_e(this,Jt).inLiveWindow;O!==L&&(He(this,Er,oi).call(this,{inLiveWindow:O}),this.dispatchEvent(new CustomEvent("inlivewindowchange",{composed:!0,bubbles:!0,detail:this.inLiveWindow})))};(a=this.media)==null||a.addEventListener("progress",e),(u=this.media)==null||u.addEventListener("waiting",e),(M=this.media)==null||M.addEventListener("timeupdate",e),(C=this.media)==null||C.addEventListener("emptied",e)},ga=new WeakSet,ju=function(){var n;let e=a=>{let{detail:u}=a;if(u instanceof $e||(u=new $e(u.message,u.code,u.fatal)),!(u!=null&&u.fatal)){hr(u),u.data&&hr(`${u.name} data:`,u.data);return}let{dialog:M,devlog:C}=la(u,!window.navigator.onLine,this.playbackId,this.playbackToken);C.message&&Jn(C),Qt(u),u.data&&Qt(`${u.name} data:`,u.data),He(this,Er,oi).call(this,{isDialogOpen:!0,dialog:M})};this.addEventListener("error",e),this.media&&(this.media.errorTranslator=(a={})=>{var M,C,O;if(!((M=this.media)!=null&&M.error))return a;let{devlog:u}=la((C=this.media)==null?void 0:C.error,!window.navigator.onLine,this.playbackId,this.playbackToken,!1);return{player_error_code:(O=this.media)==null?void 0:O.error.code,player_error_message:u.message?String(u.message):a.player_error_message}}),(n=this.media)==null||n.addEventListener("error",a=>{var M,C;let{detail:u}=a;if(!u){let{message:O,code:L}=(C=(M=this.media)==null?void 0:M.error)!=null?C:{};u=new $e(O,L)}!(u!=null&&u.fatal)||this.dispatchEvent(new CustomEvent("error",{detail:u}))})},pa=new WeakSet,Vu=function(){var n,a,u,M;let e=()=>He(this,di,ca).call(this);(a=(n=this.media)==null?void 0:n.textTracks)==null||a.addEventListener("addtrack",e),(M=(u=this.media)==null?void 0:u.textTracks)==null||M.addEventListener("removetrack",e)},Ea=new WeakSet,$u=function(){var A,x,I;let e=this.mediaController,n=/.*Version\/.*Safari\/.*/.test(navigator.userAgent);if(n)return;let a,u=new WeakMap,M=()=>this.streamType&&[we.LIVE,we.LL_LIVE].includes(this.streamType)&&!this.secondaryColor&&this.offsetWidth>=800,C=(_,b,S=!1)=>{if(M())return;Array.from(_&&_.activeCues||[]).forEach(i=>{if(!(!i.snapToLines||i.line<-5||i.line>=0&&i.line<10))if(!b||this.paused){let d=i.text.split(`
`).length,p=n?-2:-3;this.streamType&&[we.LIVE,we.LL_LIVE].includes(this.streamType)&&(p=n?-1:-2);let T=p-d;if(i.line===T&&!S)return;u.has(i)||u.set(i,i.line),i.line=T-1,i.line=T}else setTimeout(()=>{i.line=u.get(i)||"auto"},500)})},O=()=>{var _;C(a,(_=e==null?void 0:e.hasAttribute("user-inactive"))!=null?_:!1)},L=()=>{var S;let b=Array.from(((S=e==null?void 0:e.media)==null?void 0:S.textTracks)||[]).filter(v=>["subtitles","captions"].includes(v.kind)&&v.mode==="showing")[0];b!==a&&(a==null||a.removeEventListener("cuechange",O)),a=b,a==null||a.addEventListener("cuechange",O),C(a,_e(this,sr))};if(L(),(A=e==null?void 0:e.media)==null||A.textTracks.addEventListener("change",L),(x=e==null?void 0:e.media)==null||x.textTracks.addEventListener("addtrack",L),navigator.userAgent.includes("Chrome/")){let _=()=>{C(a,_e(this,sr),!0),this.paused||window.requestAnimationFrame(_)};(I=e==null?void 0:e.media)==null||I.addEventListener("playing",()=>{_()})}e==null||e.addEventListener("userinactivechange",()=>{let _=e==null?void 0:e.hasAttribute("user-inactive");_e(this,sr)!==_&&(pt(this,sr,_),C(a,_e(this,sr)))})};function wr(r,t){return r.media?r.media.getAttribute(t):r.getAttribute(t)}Qe.customElements.get("mux-player")||(Qe.customElements.define("mux-player",zi),Qe.MuxPlayerElement=zi);var iE=zi;export{$e as MediaError,iE as default,wr as getVideoAttribute};
/*!
 * JavaScript Cookie v2.1.3
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */
/*!
 * mux-embed
 * @version 4.14.0
 * @copyright 2022 Mux, Inc
 */
