var dd=Object.create;var hn=Object.defineProperty;var cd=Object.getOwnPropertyDescriptor;var fd=Object.getOwnPropertyNames;var hd=Object.getPrototypeOf,vd=Object.prototype.hasOwnProperty;var ro=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),md=(t,e)=>{for(var r in e)hn(t,r,{get:e[r],enumerable:!0})},gd=(t,e,r,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of fd(e))!vd.call(t,o)&&o!==r&&hn(t,o,{get:()=>e[o],enumerable:!(a=cd(e,o))||a.enumerable});return t};var Yi=(t,e,r)=>(r=t!=null?dd(hd(t)):{},gd(e||!t||!t.__esModule?hn(r,"default",{value:t,enumerable:!0}):r,t));var hl=ro((_a,os)=>{(function(){var t,e;t=this,e=function(){return function(){var r={80:function(c,O,C){c.exports=C(728).default},728:function(c,O,C){"use strict";C.d(O,{default:function(){return ud}});var M=C(48),D=C.n(M),A=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(U){var k=16*Math.random()|0;return(U==="x"?k:3&k|8).toString(16)})},_=function(){return("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6)},I=function(U){return U&&U.nodeName!==void 0?(U.muxId||(U.muxId=U.id||_()),U.muxId):U},S=function(U){var k;U&&U.nodeName!==void 0?U=I(k=U):k=document.querySelector(U);var w=k&&k.nodeName?k.nodeName.toLowerCase():"";return[k,U,w]},T=C(640),x=C.n(T),v=x().methodFactory;x().methodFactory=function(U,k,w){var K=v(U,k,w);return function(){for(var W=["[mux]"],z=0;z<arguments.length;z++)W.push(arguments[z]);K.apply(void 0,W)}},x().setLevel(x().getLevel());var i=x();function u(){return(D().doNotTrack||D().navigator&&D().navigator.doNotTrack)==="1"}var p={now:function(){var U=D().performance,k=U&&U.timing,w=U&&U.timeOrigin||k&&k.navigationStart;return typeof w=="number"&&typeof U.now=="function"?w+U.now():Date.now()}},b=C(678),l=C.n(b),s=function(U){return h(U)[0]},h=function(U){if(typeof U!="string"||U==="")return["localhost"];var k,w=(U.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/)||[])[4];return w&&(k=(w.match(/[^\.]+\.[^\.]+$/)||[])[0]),[w,k]},E={exists:function(){var U=D().performance;return(U&&U.timing)!==void 0},domContentLoadedEventEnd:function(){var U=D().performance,k=U&&U.timing;return k&&k.domContentLoadedEventEnd},navigationStart:function(){var U=D().performance,k=U&&U.timing;return k&&k.navigationStart}};function n(U,k,w){w=w===void 0?1:w,U[k]=U[k]||0,U[k]+=w}var d=["x-cdn","content-type","x-request-id"];function m(U){var k={};return(U=U||"").trim().split(/[\r\n]+/).forEach(function(w){if(w){var K=w.split(": "),W=K.shift();W&&(d.indexOf(W.toLowerCase())>=0||W.toLowerCase().indexOf("x-litix-")===0)&&(k[W]=K.join(": "))}}),k}var f=function(U){var k={};for(var w in U){var K=U[w];K["DATA-ID"].search("io.litix.data.")!==-1&&(k[K["DATA-ID"].replace("io.litix.data.","")]=K.VALUE)}return k};function g(U,k){var w=Object.keys(U);if(Object.getOwnPropertySymbols){var K=Object.getOwnPropertySymbols(U);k&&(K=K.filter(function(W){return Object.getOwnPropertyDescriptor(U,W).enumerable})),w.push.apply(w,K)}return w}function y(U){for(var k=1;k<arguments.length;k++){var w=arguments[k]!=null?arguments[k]:{};k%2?g(Object(w),!0).forEach(function(K){R(U,K,w[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(U,Object.getOwnPropertyDescriptors(w)):g(Object(w)).forEach(function(K){Object.defineProperty(U,K,Object.getOwnPropertyDescriptor(w,K))})}return U}function R(U,k,w){return k in U?Object.defineProperty(U,k,{value:w,enumerable:!0,configurable:!0,writable:!0}):U[k]=w,U}var L=function(U){if(!U)return{};var k=E.navigationStart(),w=U.loading,K=w?w.start:U.trequest,W=w?w.first:U.tfirst,z=w?w.end:U.tload;return{bytesLoaded:U.total,requestStart:Math.round(k+K),responseStart:Math.round(k+W),responseEnd:Math.round(k+z)}},P=function(U){if(U&&typeof U.getAllResponseHeaders=="function")return m(U.getAllResponseHeaders())},N=function(U,k){if(!U||typeof U.getRequests!="function")return{};var w=U.getRequests({state:"executed"});if(w.length===0)return{};var K,W=w[w.length-1],z=s(W.url),Y=W.bytesLoaded,Z=new Date(W.requestStartDate).getTime(),q=new Date(W.firstByteDate).getTime(),Q=new Date(W.requestEndDate).getTime(),se=isNaN(W.duration)?0:W.duration,Te=typeof k.getMetricsFor=="function"?k.getMetricsFor(W.mediaType).HttpList:k.getDashMetrics().getHttpRequests(W.mediaType);return Te.length>0&&(K=m(Te[Te.length-1]._responseHeaders||"")),{requestStart:Z,requestResponseStart:q,requestResponseEnd:Q,requestBytesLoaded:Y,requestResponseHeaders:K,requestMediaDuration:se,requestHostname:z}},B=function(U,k){var w=k.getQualityFor(U),K=k.getCurrentTrackFor(U).bitrateList;return K?{currentLevel:w,renditionWidth:K[w].width||null,renditionHeight:K[w].height||null,renditionBitrate:K[w].bandwidth}:{}};function F(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}var H=0,j=function(){function U(){(function(W,z){if(!(W instanceof z))throw new TypeError("Cannot call a class as a function")})(this,U)}var k,w,K;return k=U,w=[{key:"on",value:function(W,z,Y){return z._eventEmitterGuid=z._eventEmitterGuid||++H,this._listeners=this._listeners||{},this._listeners[W]=this._listeners[W]||[],Y&&(z=z.bind(Y)),this._listeners[W].push(z),z}},{key:"off",value:function(W,z){var Y=this._listeners&&this._listeners[W];Y&&Y.forEach(function(Z,q){Z._eventEmitterGuid===z._eventEmitterGuid&&Y.splice(q,1)})}},{key:"one",value:function(W,z,Y){var Z=this;z._eventEmitterGuid=z._eventEmitterGuid||++H;var q=function Q(){Z.off(W,Q),z.apply(Y||this,arguments)};q._eventEmitterGuid=z._eventEmitterGuid,this.on(W,q)}},{key:"emit",value:function(W,z){var Y=this;if(this._listeners){z=z||{};var Z=this._listeners["before*"]||[],q=this._listeners[W]||[],Q=this._listeners["after"+W]||[],se=function(Te,Pe){(Te=Te.slice()).forEach(function(Le){Le.call(Y,{type:W},Pe)})};se(Z,z),se(q,z),se(Q,z)}}}],w&&F(k.prototype,w),K&&F(k,K),Object.defineProperty(k,"prototype",{writable:!1}),U}(),X=j;function $(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}var G=function(){function U(W){var z=this;(function(Y,Z){if(!(Y instanceof Z))throw new TypeError("Cannot call a class as a function")})(this,U),this.pm=W,this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,W.on("playing",function(){z._playheadShouldBeProgressing=!0}),W.on("play",this._startPlaybackHeartbeatInterval.bind(this)),W.on("playing",this._startPlaybackHeartbeatInterval.bind(this)),W.on("adbreakstart",this._startPlaybackHeartbeatInterval.bind(this)),W.on("adplay",this._startPlaybackHeartbeatInterval.bind(this)),W.on("adplaying",this._startPlaybackHeartbeatInterval.bind(this)),W.on("seeking",this._startPlaybackHeartbeatInterval.bind(this)),W.on("devicewake",this._startPlaybackHeartbeatInterval.bind(this)),W.on("viewstart",this._startPlaybackHeartbeatInterval.bind(this)),W.on("rebufferstart",this._startPlaybackHeartbeatInterval.bind(this)),W.on("pause",this._stopPlaybackHeartbeatInterval.bind(this)),W.on("ended",this._stopPlaybackHeartbeatInterval.bind(this)),W.on("viewend",this._stopPlaybackHeartbeatInterval.bind(this)),W.on("error",this._stopPlaybackHeartbeatInterval.bind(this)),W.on("aderror",this._stopPlaybackHeartbeatInterval.bind(this)),W.on("adpause",this._stopPlaybackHeartbeatInterval.bind(this)),W.on("adended",this._stopPlaybackHeartbeatInterval.bind(this)),W.on("adbreakend",this._stopPlaybackHeartbeatInterval.bind(this)),W.on("seeked",function(){W.data.player_is_paused?z._stopPlaybackHeartbeatInterval():z._startPlaybackHeartbeatInterval()}),W.on("timeupdate",function(){z._playbackHeartbeatInterval!==null&&W.emit("playbackheartbeat")}),W.on("devicesleep",function(Y,Z){z._playbackHeartbeatInterval!==null&&(D().clearInterval(z._playbackHeartbeatInterval),W.emit("playbackheartbeatend",{viewer_time:Z.viewer_time}),z._playbackHeartbeatInterval=null)})}var k,w,K;return k=U,(w=[{key:"_startPlaybackHeartbeatInterval",value:function(){var W=this;this._playbackHeartbeatInterval===null&&(this.pm.emit("playbackheartbeat"),this._playbackHeartbeatInterval=D().setInterval(function(){W.pm.emit("playbackheartbeat")},this.pm.playbackHeartbeatTime))}},{key:"_stopPlaybackHeartbeatInterval",value:function(){this._playheadShouldBeProgressing=!1,this._playbackHeartbeatInterval!==null&&(D().clearInterval(this._playbackHeartbeatInterval),this.pm.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)}}])&&$(k.prototype,w),K&&$(k,K),Object.defineProperty(k,"prototype",{writable:!1}),U}();function J(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}function ee(U,k,w){return k&&J(U.prototype,k),w&&J(U,w),Object.defineProperty(U,"prototype",{writable:!1}),U}var te=ee(function U(k){var w=this;(function(K,W){if(!(K instanceof W))throw new TypeError("Cannot call a class as a function")})(this,U),k.on("viewinit",function(){w.viewErrored=!1}),k.on("error",function(){try{var K=k.errorTranslator({player_error_code:k.data.player_error_code,player_error_message:k.data.player_error_message});K?(k.data.player_error_code=K.player_error_code,k.data.player_error_message=K.player_error_message,w.viewErrored=!0):(delete k.data.player_error_code,delete k.data.player_error_message)}catch(W){k.mux.log.warn("Exception in error translator callback.",W),w.viewErrored=!0}})});function oe(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}var ue=function(){function U(W){(function(z,Y){if(!(z instanceof Y))throw new TypeError("Cannot call a class as a function")})(this,U),this.pm=W,this._watchTimeTrackerLastCheckedTime=null,W.on("playbackheartbeat",this._updateWatchTime.bind(this)),W.on("playbackheartbeatend",this._clearWatchTimeState.bind(this))}var k,w,K;return k=U,(w=[{key:"_updateWatchTime",value:function(W,z){var Y=z.viewer_time;this._watchTimeTrackerLastCheckedTime===null&&(this._watchTimeTrackerLastCheckedTime=Y),n(this.pm.data,"view_watch_time",Y-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=Y}},{key:"_clearWatchTimeState",value:function(W,z){this._updateWatchTime(W,z),this._watchTimeTrackerLastCheckedTime=null}}])&&oe(k.prototype,w),K&&oe(k,K),Object.defineProperty(k,"prototype",{writable:!1}),U}();function ae(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}var he=function(){function U(W){(function(z,Y){if(!(z instanceof Y))throw new TypeError("Cannot call a class as a function")})(this,U),this.pm=W,this._playbackTimeTrackerLastPlayheadPosition=-1,W.on("playbackheartbeat",this._updatePlaybackTime.bind(this)),W.on("playbackheartbeatend",this._clearPlaybackTimeState.bind(this)),W.on("seeking",this._clearPlaybackTimeState.bind(this))}var k,w,K;return k=U,(w=[{key:"_updatePlaybackTime",value:function(){var W=this.pm.data.player_playhead_time;if(this._playbackTimeTrackerLastPlayheadPosition>=0&&W>this._playbackTimeTrackerLastPlayheadPosition){var z=W-this._playbackTimeTrackerLastPlayheadPosition;z<=1e3&&n(this.pm.data,"view_content_playback_time",z)}this._playbackTimeTrackerLastPlayheadPosition=W}},{key:"_clearPlaybackTimeState",value:function(){this._updatePlaybackTime(),this._playbackTimeTrackerLastPlayheadPosition=-1}}])&&ae(k.prototype,w),K&&ae(k,K),Object.defineProperty(k,"prototype",{writable:!1}),U}();function me(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}var ne=function(){function U(W){(function(Y,Z){if(!(Y instanceof Z))throw new TypeError("Cannot call a class as a function")})(this,U),this.pm=W;var z=this._updatePlayheadTime.bind(this);W.on("playbackheartbeat",z),W.on("playbackheartbeatend",z),W.on("timeupdate",z),W.on("destroy",function(){W.off("timeupdate",z)})}var k,w,K;return k=U,(w=[{key:"_updateMaxPlayheadPosition",value:function(){this.pm.data.view_max_playhead_position=this.pm.data.view_max_playhead_position===void 0?this.pm.data.player_playhead_time:Math.max(this.pm.data.view_max_playhead_position,this.pm.data.player_playhead_time)}},{key:"_updatePlayheadTime",value:function(W,z){var Y=this,Z=function(){Y.pm.currentFragmentPDT&&Y.pm.currentFragmentStart&&(Y.pm.data.player_program_time=Y.pm.currentFragmentPDT+Y.pm.data.player_playhead_time-Y.pm.currentFragmentStart)};if(z&&z.player_playhead_time)this.pm.data.player_playhead_time=z.player_playhead_time,Z(),this._updateMaxPlayheadPosition();else if(this.pm.getPlayheadTime){var q=this.pm.getPlayheadTime();q!==void 0&&(this.pm.data.player_playhead_time=q,Z(),this._updateMaxPlayheadPosition())}}}])&&me(k.prototype,w),K&&me(k,K),Object.defineProperty(k,"prototype",{writable:!1}),U}();function Me(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}function _e(U,k,w){return k&&Me(U.prototype,k),w&&Me(U,w),Object.defineProperty(U,"prototype",{writable:!1}),U}var Se=_e(function U(k){if(function(W,z){if(!(W instanceof z))throw new TypeError("Cannot call a class as a function")}(this,U),!k.disableRebufferTracking){var w,K=function(){if(w){var W=k.data.viewer_time-w;n(k.data,"view_rebuffer_duration",W),w=k.data.viewer_time}k.data.view_watch_time>=0&&k.data.view_rebuffer_count>0&&(k.data.view_rebuffer_frequency=k.data.view_rebuffer_count/k.data.view_watch_time,k.data.view_rebuffer_percentage=k.data.view_rebuffer_duration/k.data.view_watch_time)};k.on("playbackheartbeat",function(){return K()}),k.on("rebufferstart",function(){w||(n(k.data,"view_rebuffer_count",1),w=k.data.viewer_time,k.one("rebufferend",function(){K(),w=void 0}))})}});function be(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}var Ue=function(){function U(W){var z=this;(function(Y,Z){if(!(Y instanceof Z))throw new TypeError("Cannot call a class as a function")})(this,U),this.pm=W,W.disableRebufferTracking||W.disablePlayheadRebufferTracking||(this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,W.on("playbackheartbeat",this._checkIfRebuffering.bind(this)),W.on("playbackheartbeatend",this._cleanupRebufferTracker.bind(this)),W.on("seeking",function(){z._cleanupRebufferTracker(null,{viewer_time:p.now()})}))}var k,w,K;return k=U,w=[{key:"_checkIfRebuffering",value:function(W,z){if(this.pm.seekingTracker.isSeeking||this.pm.adTracker.isAdBreak||!this.pm.playbackHeartbeat._playheadShouldBeProgressing)this._cleanupRebufferTracker(W,z);else if(this._lastCheckedTime!==null)if(this._lastPlayheadTime===this.pm.data.player_playhead_time){var Y=z.viewer_time-this._lastPlayheadTimeUpdatedTime;typeof this.pm.sustainedRebufferThreshold=="number"&&Y>=this.pm.sustainedRebufferThreshold&&(this._rebuffering||(this._rebuffering=!0,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}))),this._lastCheckedTime=z.viewer_time}else this._cleanupRebufferTracker(W,z,!0);else this._prepareRebufferTrackerState(z.viewer_time)}},{key:"_clearRebufferTrackerState",value:function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null}},{key:"_prepareRebufferTrackerState",value:function(W){this._lastCheckedTime=W,this._lastPlayheadTime=this.pm.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=W}},{key:"_cleanupRebufferTracker",value:function(W,z){var Y=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(this._rebuffering)this._rebuffering=!1,this.pm.emit("rebufferend",{viewer_time:z.viewer_time});else{if(this._lastCheckedTime===null)return;var Z=this.pm.data.player_playhead_time-this._lastPlayheadTime,q=z.viewer_time-this._lastPlayheadTimeUpdatedTime;typeof this.pm.minimumRebufferDuration=="number"&&Z>0&&q-Z>this.pm.minimumRebufferDuration&&(this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.pm.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+q-Z}))}Y?this._prepareRebufferTrackerState(z.viewer_time):this._clearRebufferTrackerState()}}],w&&be(k.prototype,w),K&&be(k,K),Object.defineProperty(k,"prototype",{writable:!1}),U}(),Ze=Ue;function We(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}var tt=function(){function U(W){var z=this;(function(Y,Z){if(!(Y instanceof Z))throw new TypeError("Cannot call a class as a function")})(this,U),this.pm=W,W.on("viewinit",function(){var Y=W.data,Z=Y.view_id;if(!Y.view_program_changed){var q=function(Q,se){var Te=se.viewer_time;Q.type==="playing"&&W.data.view_time_to_first_frame===void 0?z.calculateTimeToFirstFrame(Te||p.now(),Z):Q.type!=="adplaying"||W.data.view_time_to_first_frame!==void 0&&!z._inPrerollPosition()||z.calculateTimeToFirstFrame(Te||p.now(),Z)};W.one("playing",q),W.one("adplaying",q),W.one("viewend",function(){W.off("playing",q),W.off("adplaying",q)})}})}var k,w,K;return k=U,(w=[{key:"_inPrerollPosition",value:function(){return this.pm.data.view_content_playback_time===void 0||this.pm.data.view_content_playback_time<=1e3}},{key:"calculateTimeToFirstFrame",value:function(W,z){z===this.pm.data.view_id&&(this.pm.watchTimeTracker._updateWatchTime(null,{viewer_time:W}),this.pm.data.view_time_to_first_frame=this.pm.data.view_watch_time,(this.pm.data.player_autoplay_on||this.pm.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.pm.data.view_aggregate_startup_time=this.pm.data.view_start+this.pm.data.view_watch_time-this.NAVIGATION_START))}}])&&We(k.prototype,w),K&&We(k,K),Object.defineProperty(k,"prototype",{writable:!1}),U}();function Fe(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}function ot(U,k,w){return k&&Fe(U.prototype,k),w&&Fe(U,w),Object.defineProperty(U,"prototype",{writable:!1}),U}var ft=ot(function U(k){var w=this;(function(K,W){if(!(K instanceof W))throw new TypeError("Cannot call a class as a function")})(this,U),k.on("viewinit",function(){w._lastPlayheadPosition=-1}),["pause","rebufferstart","seeking","error","adbreakstart","hb"].forEach(function(K){k.on(K,function(){if(w._lastPlayheadPosition>=0&&k.data.player_playhead_time>=0&&w._lastPlayerWidth>=0&&w._lastSourceWidth>0&&w._lastPlayerHeight>=0&&w._lastSourceHeight>0){var W=k.data.player_playhead_time-w._lastPlayheadPosition;if(W<0)return void(w._lastPlayheadPosition=-1);var z=Math.min(w._lastPlayerWidth/w._lastSourceWidth,w._lastPlayerHeight/w._lastSourceHeight),Y=Math.max(0,z-1),Z=Math.max(0,1-z);k.data.view_max_upscale_percentage=Math.max(k.data.view_max_upscale_percentage||0,Y),k.data.view_max_downscale_percentage=Math.max(k.data.view_max_downscale_percentage||0,Z),n(k.data,"view_total_content_playback_time",W),n(k.data,"view_total_upscaling",Y*W),n(k.data,"view_total_downscaling",Z*W)}w._lastPlayheadPosition=-1})}),["playing","hb"].forEach(function(K){k.on(K,function(){w._lastPlayheadPosition=k.data.player_playhead_time,w._lastPlayerWidth=k.data.player_width,w._lastPlayerHeight=k.data.player_height,w._lastSourceWidth=k.data.video_source_width,w._lastSourceHeight=k.data.video_source_height})})});function ht(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}function lt(U,k,w){return k&&ht(U.prototype,k),w&&ht(U,w),Object.defineProperty(U,"prototype",{writable:!1}),U}var It=lt(function U(k){var w=this;(function(K,W){if(!(K instanceof W))throw new TypeError("Cannot call a class as a function")})(this,U),this.isSeeking=!1,k.on("seeking",function(K,W){l()(k.data,W),w._lastSeekingTime=p.now(),w.isSeeking===!1&&(w.isSeeking=!0,k.send("seeking"))}),k.on("seeked",function(){w.isSeeking=!1;var K=w._lastSeekingTime||p.now(),W=p.now()-K;n(k.data,"view_seek_count",1),n(k.data,"view_seek_duration",W);var z=k.data.view_max_seek_time||0;k.data.view_max_seek_time=Math.max(z,W)}),k.on("viewend",function(){w.isSeeking=!1})});function rt(U,k){return function(w){if(Array.isArray(w))return w}(U)||function(w,K){var W=w==null?null:typeof Symbol!="undefined"&&w[Symbol.iterator]||w["@@iterator"];if(W!=null){var z,Y,Z=[],q=!0,Q=!1;try{for(W=W.call(w);!(q=(z=W.next()).done)&&(Z.push(z.value),!K||Z.length!==K);q=!0);}catch(se){Q=!0,Y=se}finally{try{q||W.return==null||W.return()}finally{if(Q)throw Y}}return Z}}(U,k)||function(w,K){if(w){if(typeof w=="string")return Rt(w,K);var W=Object.prototype.toString.call(w).slice(8,-1);return W==="Object"&&w.constructor&&(W=w.constructor.name),W==="Map"||W==="Set"?Array.from(w):W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W)?Rt(w,K):void 0}}(U,k)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Rt(U,k){(k==null||k>U.length)&&(k=U.length);for(var w=0,K=new Array(k);w<k;w++)K[w]=U[w];return K}function Ye(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}var Je=function(U,k){U.push(k),U.sort(function(w,K){return w.viewer_time-K.viewer_time})},Et=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror"],qe=function(){function U(W){var z=this;(function(Z,q){if(!(Z instanceof q))throw new TypeError("Cannot call a class as a function")})(this,U),this.pm=W,W.on("viewinit",function(){z.isAdBreak=!1,z._currentAdRequestNumber=0,z._currentAdResponseNumber=0,z._adRequests=[],z._adResponses=[],z._adHasPlayed=!1,z._wouldBeNewAdPlay=!0,z._prerollPlayTime=void 0}),Et.forEach(function(Z){return W.on(Z,z._updateAdData.bind(z))});var Y=function(){z.isAdBreak=!1};W.on("adbreakstart",function(){z.isAdBreak=!0}),W.on("play",Y),W.on("playing",Y),W.on("viewend",Y),W.on("adrequest",function(Z,q){q=l()({ad_request_id:"generatedAdRequestId"+z._currentAdRequestNumber++},q),Je(z._adRequests,q),n(W.data,"view_ad_request_count"),z.inPrerollPosition()&&(W.data.view_preroll_requested=!0,z._adHasPlayed||n(W.data,"view_preroll_request_count"))}),W.on("adresponse",function(Z,q){q=l()({ad_request_id:"generatedAdRequestId"+z._currentAdResponseNumber++},q),Je(z._adResponses,q);var Q=z.findAdRequest(q.ad_request_id);Q&&n(W.data,"view_ad_request_time",Math.max(0,q.viewer_time-Q.viewer_time))}),W.on("adplay",function(Z,q){z._adHasPlayed=!0,z._wouldBeNewAdPlay&&(z._wouldBeNewAdPlay=!1,n(W.data,"view_ad_played_count")),z.inPrerollPosition()&&!W.data.view_preroll_played&&(W.data.view_preroll_played=!0,z._adRequests.length>0&&(W.data.view_preroll_request_time=Math.max(0,q.viewer_time-z._adRequests[0].viewer_time)),W.data.view_start&&(W.data.view_startup_preroll_request_time=Math.max(0,q.viewer_time-W.data.view_start)),z._prerollPlayTime=q.viewer_time)}),W.on("adplaying",function(Z,q){z.inPrerollPosition()&&W.data.view_preroll_load_time===void 0&&z._prerollPlayTime!==void 0&&(W.data.view_preroll_load_time=q.viewer_time-z._prerollPlayTime,W.data.view_startup_preroll_load_time=q.viewer_time-z._prerollPlayTime)}),W.on("adended",function(){z._wouldBeNewAdPlay=!0}),W.on("aderror",function(){z._wouldBeNewAdPlay=!0})}var k,w,K;return k=U,(w=[{key:"inPrerollPosition",value:function(){return this.pm.data.view_content_playback_time===void 0||this.pm.data.view_content_playback_time<=1e3}},{key:"findAdRequest",value:function(W){for(var z=0;z<this._adRequests.length;z++)if(this._adRequests[z].ad_request_id===W)return this._adRequests[z]}},{key:"_updateAdData",value:function(W,z){if(this.inPrerollPosition()){if(!this.pm.data.view_preroll_ad_tag_hostname&&z.ad_tag_url){var Y=rt(h(z.ad_tag_url),2),Z=Y[0],q=Y[1];this.pm.data.view_preroll_ad_tag_domain=q,this.pm.data.view_preroll_ad_tag_hostname=Z}if(!this.pm.data.view_preroll_ad_asset_hostname&&z.ad_asset_url){var Q=rt(h(z.ad_asset_url),2),se=Q[0],Te=Q[1];this.pm.data.view_preroll_ad_asset_domain=Te,this.pm.data.view_preroll_ad_asset_hostname=se}}}}])&&Ye(k.prototype,w),K&&Ye(k,K),Object.defineProperty(k,"prototype",{writable:!1}),U}();function He(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}function Pt(U,k,w){return k&&He(U.prototype,k),w&&He(U,w),Object.defineProperty(U,"prototype",{writable:!1}),U}var vt=Pt(function U(k){var w,K;(function(Z,q){if(!(Z instanceof q))throw new TypeError("Cannot call a class as a function")})(this,U);var W=function(){k.disableRebufferTracking||w&&(n(k.data,"view_waiting_rebuffer_duration",p.now()-w),w=!1,D().clearInterval(K))},z=!1,Y=function(){z=!1,W()};k.on("waiting",function(){z&&(k.disableRebufferTracking||(n(k.data,"view_waiting_rebuffer_count",1),w=p.now(),K=D().setInterval(function(){if(w){var Z=p.now();n(k.data,"view_waiting_rebuffer_duration",Z-w),w=Z}},250)))}),k.on("playing",function(){W(),z=!0}),k.on("pause",Y),k.on("seeking",Y)});function Wt(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}function mr(U,k,w){return k&&Wt(U.prototype,k),w&&Wt(U,w),Object.defineProperty(U,"prototype",{writable:!1}),U}var _t=mr(function U(k){var w=this;(function(z,Y){if(!(z instanceof Y))throw new TypeError("Cannot call a class as a function")})(this,U);var K=function(){w.lastWallClockTime=p.now(),k.on("before*",W)},W=function(z){var Y=p.now(),Z=w.lastWallClockTime;w.lastWallClockTime=Y,Y-Z>3e4&&(k.emit("devicesleep",{viewer_time:Z}),l()(k.data,{viewer_time:Z}),k.send("devicesleep"),k.emit("devicewake",{viewer_time:Y}),l()(k.data,{viewer_time:Y}),k.send("devicewake"))};k.one("playbackheartbeat",K),k.on("playbackheartbeatend",function(){k.off("before*",W),k.one("playbackheartbeat",K)})}),Cr=C(375),gr=C(655),kt=C.n(gr),Ht="muxData",wt=function(){var U;try{U=Cr.parse(kt().get(Ht)||"")}catch{U={}}return U},pr=function(U){try{kt().set(Ht,Cr.stringify(U),{expires:7300})}catch{}},ar=function(){var U=wt();return U.mux_viewer_id=U.mux_viewer_id||A(),U.msn=U.msn||Math.random(),pr(U),{mux_viewer_id:U.mux_viewer_id,mux_sample_number:U.msn}};function tn(U,k){var w=k.beaconCollectionDomain,K=k.beaconDomain;if(w)return"https://"+w;var W=K||"litix.io";return(U=U||"inferred").match(/^[a-z0-9]+$/)?"https://"+U+"."+W:"https://img.litix.io/a.gif"}var ii=function(){var U;switch(Or()){case"cellular":U="cellular";break;case"ethernet":U="wired";break;case"wifi":U="wifi";break;case void 0:break;default:U="other"}return U},Or=function(){var U=D().navigator,k=U&&(U.connection||U.mozConnection||U.webkitConnection);return k&&k.type};ii.getConnectionFromAPI=Or;var St=ii,Wi=Hi({a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",i:"internal",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"}),ai=Hi({ad:"ad",ag:"aggregate",ap:"api",al:"application",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",br:"break",bw:"browser",by:"bytes",ca:"cached",cb:"cancel",cd:"code",cg:"category",ch:"changed",cn:"config",co:"count",ce:"counter",cp:"complete",cr:"creative",ct:"content",cu:"current",cx:"connection",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",du:"duration",dv:"device",ec:"encoding",ed:"edge",en:"end",eg:"engine",em:"embed",er:"error",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",ep:"experiments",fi:"first",fm:"family",ft:"format",fp:"fps",fq:"frequency",fr:"frame",fs:"fullscreen",hb:"holdback",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mf:"manifest",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",ne:"newest",nm:"name",no:"number",on:"on",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pr:"preload",ps:"position",pt:"part",py:"property",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",se:"session",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",st:"start",su:"startup",sv:"server",sw:"software",ta:"tag",tc:"tech",te:"text",tg:"target",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"});function Hi(U){var k={};for(var w in U)U.hasOwnProperty(w)&&(k[U[w]]=w);return k}function ni(U){var k={},w={};return Object.keys(U).forEach(function(K){var W=!1;if(U.hasOwnProperty(K)&&U[K]!==void 0){var z=K.split("_"),Y=z[0],Z=Wi[Y];Z||(i.info("Data key word `"+z[0]+"` not expected in "+K),Z=Y+"_"),z.splice(1).forEach(function(q){q==="url"&&(W=!0),ai[q]?Z+=ai[q]:Number(q)&&Math.floor(Number(q))===Number(q)?Z+=q:(i.info("Data key word `"+q+"` not expected in "+K),Z+="_"+q+"_")}),W?w[Z]=U[K]:k[Z]=U[K]}}),l()(k,w)}var rn={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:1e4,maxPayloadKBSize:500},an=["hb","requestcompleted","requestfailed","requestcanceled"],Ut=function(U,k){this._beaconUrl=U||"https://img.litix.io",this._eventQueue=[],this._postInFlight=!1,this._failureCount=0,this._sendTimeout=!1,this._options=l()({},rn,k)};Ut.prototype.queueEvent=function(U,k){var w=l()({},k);return(this._eventQueue.length<=this._options.maxQueueLength||U==="eventrateexceeded")&&(this._eventQueue.push(w),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength)},Ut.prototype.flushEvents=function(){this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending()},Ut.prototype.destroy=function(){var U=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.destroyed=!0,U?this._clearBeaconQueue():this.flushEvents(),D().clearTimeout(this._sendTimeout)},Ut.prototype._clearBeaconQueue=function(){var U=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,k=this._eventQueue.slice(U);U>0&&l()(k[k.length-1],ni({mux_view_message:"event queue truncated"}));var w=this._createPayload(k);Pr(this._beaconUrl,w,!0,function(){})},Ut.prototype._sendBeaconQueue=function(){var U=this;if(!this._postInFlight){var k=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0;var w=this._createPayload(k),K=p.now();Pr(this._beaconUrl,w,!1,function(W,z){z?(U._eventQueue=k.concat(U._eventQueue),U._failureCount+=1,i.info("Error sending beacon: "+z)):U._failureCount=0,U._roundTripTime=p.now()-K,U._postInFlight=!1})}},Ut.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var U=Math.pow(2,this._failureCount-1);return(1+(U*=Math.random()))*this._options.baseTimeBetweenBeacons},Ut.prototype._startBeaconSending=function(){var U=this;D().clearTimeout(this._sendTimeout),this.destroyed||(this._sendTimeout=D().setTimeout(function(){U._eventQueue.length&&U._sendBeaconQueue(),U._startBeaconSending()},this._getNextBeaconTime()))},Ut.prototype._createPayload=function(U){var k,w,K,W=this,z={transmission_timestamp:Math.round(p.now())};this._roundTripTime&&(z.rtt_ms=Math.round(this._roundTripTime));var Y=function(){k=JSON.stringify({metadata:z,events:w||U}),K=k.length/1024},Z=function(){return K<=W._options.maxPayloadKBSize};return Y(),Z()||(i.info("Payload size is too big ("+K+" kb). Removing unnecessary events."),w=U.filter(function(q){return an.indexOf(q.e)===-1}),Y()),Z()||(i.info("Payload size still too big ("+K+" kb). Cropping fields.."),w.forEach(function(q){for(var Q in q){var se=q[Q];typeof se=="string"&&se.length>51200&&(q[Q]=se.substring(0,51200))}}),Y()),k};var Pr=function(U,k,w,K){if(w&&navigator&&navigator.sendBeacon&&navigator.sendBeacon(U,k))K();else if(D().fetch)D().fetch(U,{method:"POST",body:k,headers:{"Content-Type":"text/plain"},keepalive:!0}).then(function(z){return K(null,z.ok?null:"Error")}).catch(function(z){return K(null,z)});else{if(D().XMLHttpRequest){var W=new(D()).XMLHttpRequest;return W.onreadystatechange=function(){if(W.readyState===4)return K(null,W.status!==200?"error":void 0)},W.open("POST",U),W.setRequestHeader("Content-Type","text/plain"),void W.send(k)}K()}},Gi=Ut;function Er(U){return Er=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},Er(U)}var nn=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id"],Cu=["viewstart","error","ended","viewend"],ji=function(U,k){var w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.mux=U,this.envKey=k,this.eventQueue=new Gi(tn(k,w)),this.previousBeaconData=null,this.lastEventTime=null,this.sampleRate=w.sampleRate,this.disableCookies=w.disableCookies,this.respectDoNotTrack=w.respectDoNotTrack;var K=w.platform||{};this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:K.name,viewer_application_version:K.version,viewer_application_engine:K.layout,viewer_device_name:K.product,viewer_device_category:"",viewer_device_manufacturer:K.manufacturer,viewer_os_family:K.os&&K.os.family,viewer_os_architecture:K.os&&K.os.architecture,viewer_os_version:K.os&&K.os.version};var W=St();W&&(this.pageLevelData=l()(this.pageLevelData,{viewer_connection_type:W})),D()!==void 0&&D().location&&D().location.href&&(this.pageLevelData.page_url=D().location.href),this.viewerData=this.disableCookies?{}:ar()};ji.prototype.send=function(U,k){if(U){if(this.respectDoNotTrack&&u())return i.info("Not sending `"+U+"` because Do Not Track is enabled");if(!k||Er(k)!=="object")return i.error("A data object was expected in send() but was not provided");var w,K,W=this.disableCookies?{}:(w=wt(),K=p.now(),w.session_start&&(w.sst=w.session_start,delete w.session_start),w.session_id&&(w.sid=w.session_id,delete w.session_id),w.session_expires&&(w.sex=w.session_expires,delete w.session_expires),(!w.sex||w.sex<K)&&(w.sid=A(),w.sst=K),w.sex=K+15e5,pr(w),{session_id:w.sid,session_start:w.sst,session_expires:w.sex}),z={};l()(z,this.pageLevelData),l()(z,k),l()(z,W),l()(z,this.viewerData),z.event=U,z.env_key=this.envKey,z.user_id&&(z.viewer_user_id=z.user_id,delete z.user_id);var Y=z.mux_sample_number>=this.sampleRate,Z=ni(this._deduplicateBeaconData(U,z));if(this.lastEventTime=this.mux.utils.now(),Y)return i.info("Not sending event due to sample rate restriction",U,z,Z);if(this.envKey||i.info("Missing environment key (envKey) - beacons will be dropped if the video source is not a valid mux video URL",U,z,Z),!this.rateLimited){if(i.info("Sending event",U,z,Z),this.rateLimited=!this.eventQueue.queueEvent(U,Z),this.mux.WINDOW_UNLOADING&&U==="viewend")this.eventQueue.destroy(!0);else if((Cu.indexOf(U)>=0||this.mux.WINDOW_HIDDEN&&U==="hb")&&this.eventQueue.flushEvents(),this.rateLimited)return z.event="eventrateexceeded",Z=ni(z),this.eventQueue.queueEvent(z.event,Z),i.error("Beaconing disabled due to rate limit.")}}},ji.prototype.destroy=function(){this.eventQueue.destroy(!1)},ji.prototype._deduplicateBeaconData=function(U,k){var w=this,K={},W=k.view_id;if(!W||U==="viewstart"||U==="viewend"||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=6e5)K=l()({},k),W&&(this.previousBeaconData=K),W&&U==="viewend"&&(this.previousBeaconData=null);else{var z=U.indexOf("request")===0;Object.keys(k).forEach(function(Y){var Z=k[Y];(Z!==w.previousBeaconData[Y]||nn.indexOf(Y)>-1||function(q,Q,se,Te){return!(!q||Q.indexOf("request_")!==0||Q!=="request_response_headers"&&Er(se)==="object"&&Er(Te)==="object"&&Object.keys(se||{}).length===Object.keys(Te||{}).length)}(z,Y,Z,w.previousBeaconData[Y])||function(q,Q){return q==="renditionchange"&&Q.indexOf("video_source_")===0}(U,Y))&&(K[Y]=Z,w.previousBeaconData[Y]=Z)})}return K};var Ou=ji;function zs(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}function Pu(U,k,w){return k&&zs(U.prototype,k),w&&zs(U,w),Object.defineProperty(U,"prototype",{writable:!1}),U}var ku=Pu(function U(k){(function(Q,se){if(!(Q instanceof se))throw new TypeError("Cannot call a class as a function")})(this,U);var w=0,K=0,W=0,z=0,Y=0,Z=0,q=0;k.on("requestcompleted",function(Q,se){var Te,Pe,Le=se.request_start,ve=se.request_response_start,Ee=se.request_response_end,Ne=se.request_bytes_loaded;if(z++,ve?(Te=ve-Le,Pe=Ee-ve):Pe=Ee-Le,Pe>0&&Ne>0){var yt=Ne/Pe*8e3;Y++,K+=Ne,W+=Pe,k.data.view_min_request_throughput=Math.min(k.data.view_min_request_throughput||1/0,yt),k.data.view_average_request_throughput=K/W*8e3,k.data.view_request_count=z,Te>0&&(w+=Te,k.data.view_max_request_latency=Math.max(k.data.view_max_request_latency||0,Te),k.data.view_average_request_latency=w/Y)}}),k.on("requestfailed",function(Q,se){z++,Z++,k.data.view_request_count=z,k.data.view_request_failed_count=Z}),k.on("requestcanceled",function(Q,se){z++,q++,k.data.view_request_count=z,k.data.view_request_canceled_count=q})});function Xs(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}function wu(U,k,w){return k&&Xs(U.prototype,k),w&&Xs(U,w),Object.defineProperty(U,"prototype",{writable:!1}),U}var Uu=wu(function U(k){var w=this;(function(K,W){if(!(K instanceof W))throw new TypeError("Cannot call a class as a function")})(this,U),k.on("before*",function(K,W){var z=W.viewer_time,Y=p.now(),Z=w._lastEventTime;if(w._lastEventTime=Y,Z&&Y-Z>36e5){var q=Object.keys(k.data).reduce(function(Q,se){return se.indexOf("video_")===0?l()(Q,function(Te,Pe,Le){return Pe in Te?Object.defineProperty(Te,Pe,{value:Le,enumerable:!0,configurable:!0,writable:!0}):Te[Pe]=Le,Te}({},se,k.data[se])):Q},{});k.mux.log.info("Received event after at least an hour inactivity, creating a new view"),k.emit("viewinit",l()({viewer_time:z},q)),k.playbackHeartbeat._playheadShouldBeProgressing&&K.type!=="play"&&K.type!=="adbreakstart"&&(k.emit("play",{viewer_time:z}),K.type!=="playing"&&k.emit("playing",{viewer_time:z}))}})});function sn(U){return sn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},sn(U)}function Nu(U,k){return function(w){if(Array.isArray(w))return w}(U)||function(w,K){var W=w==null?null:typeof Symbol!="undefined"&&w[Symbol.iterator]||w["@@iterator"];if(W!=null){var z,Y,Z=[],q=!0,Q=!1;try{for(W=W.call(w);!(q=(z=W.next()).done)&&(Z.push(z.value),!K||Z.length!==K);q=!0);}catch(se){Q=!0,Y=se}finally{try{q||W.return==null||W.return()}finally{if(Q)throw Y}}return Z}}(U,k)||function(w,K){if(w){if(typeof w=="string")return Qs(w,K);var W=Object.prototype.toString.call(w).slice(8,-1);return W==="Object"&&w.constructor&&(W=w.constructor.name),W==="Map"||W==="Set"?Array.from(w):W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W)?Qs(w,K):void 0}}(U,k)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Qs(U,k){(k==null||k>U.length)&&(k=U.length);for(var w=0,K=new Array(k);w<k;w++)K[w]=U[w];return K}function Zs(U,k){for(var w=0;w<k.length;w++){var K=k[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(U,K.key,K)}}function on(U,k){return on=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(w,K){return w.__proto__=K,w},on(U,k)}function Bu(U){var k=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var w,K=Vi(U);if(k){var W=Vi(this).constructor;w=Reflect.construct(K,arguments,W)}else w=K.apply(this,arguments);return Fu(this,w)}}function Fu(U,k){if(k&&(sn(k)==="object"||typeof k=="function"))return k;if(k!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return at(U)}function at(U){if(U===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return U}function Vi(U){return Vi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(k){return k.__proto__||Object.getPrototypeOf(k)},Vi(U)}var Ku=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],Wu=function(U){(function(Y,Z){if(typeof Z!="function"&&Z!==null)throw new TypeError("Super expression must either be null or a function");Y.prototype=Object.create(Z&&Z.prototype,{constructor:{value:Y,writable:!0,configurable:!0}}),Object.defineProperty(Y,"prototype",{writable:!1}),Z&&on(Y,Z)})(z,U);var k,w,K,W=Bu(z);function z(Y,Z,q){var Q;(function(ve,Ee){if(!(ve instanceof Ee))throw new TypeError("Cannot call a class as a function")})(this,z),(Q=W.call(this)).DOM_CONTENT_LOADED_EVENT_END=E.domContentLoadedEventEnd(),Q.NAVIGATION_START=E.navigationStart(),Q.mux=Y,Q.id=Z,(q=l()({debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,disablePlayheadRebufferTracking:!1,errorTranslator:function(ve){return ve}},q)).data=q.data||{},q.data.property_key&&(q.data.env_key=q.data.property_key,delete q.data.property_key),i.setLevel(q.debug?"debug":"warn"),Q.getPlayheadTime=q.getPlayheadTime,Q.getStateData=q.getStateData||function(){return{}},Q.getAdData=q.getAdData||function(){},Q.minimumRebufferDuration=q.minimumRebufferDuration,Q.sustainedRebufferThreshold=q.sustainedRebufferThreshold,Q.playbackHeartbeatTime=q.playbackHeartbeatTime,Q.disableRebufferTracking=q.disableRebufferTracking,Q.disableRebufferTracking&&Q.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),Q.disablePlayheadRebufferTracking=q.disablePlayheadRebufferTracking,Q.errorTranslator=q.errorTranslator,Q.playbackEventDispatcher=new Ou(Y,q.data.env_key,q),Q.data={player_instance_id:A(),mux_sample_rate:q.sampleRate,beacon_domain:q.beaconCollectionDomain?q.beaconCollectionDomain:q.beaconDomain},Q.data.view_sequence_number=1,Q.data.player_sequence_number=1,Q.oldEmit=Q.emit,Q.emit=function(ve,Ee){Ee=l()({viewer_time:this.mux.utils.now()},Ee),this.oldEmit(ve,Ee)};var se=function(){this.data.view_start===void 0&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}.bind(at(Q));Q.on("viewinit",function(ve,Ee){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),l()(this.data,Ee),this._initializeViewData(),this.one("play",se),this.one("adbreakstart",se)});var Te=function(ve){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",ve)}.bind(at(Q));if(Q.on("videochange",function(ve,Ee){Te(Ee)}),Q.on("programchange",function(ve,Ee){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),Te(l()(Ee,{view_program_changed:!0})),se(),this.emit("play"),this.emit("playing")}),Q.on("fragmentchange",function(ve,Ee){this.currentFragmentPDT=Ee.currentFragmentPDT,this.currentFragmentStart=Ee.currentFragmentStart}),Q.on("destroy",Q.destroy),typeof window!="undefined"&&typeof window.addEventListener=="function"&&typeof window.removeEventListener=="function"){var Pe=function(){var ve=Q.data.view_start!==void 0;Q.mux.WINDOW_HIDDEN=document.visibilityState==="hidden",ve&&Q.mux.WINDOW_HIDDEN&&(Q.data.player_is_paused||Q.emit("hb"))};window.addEventListener("visibilitychange",Pe,!1);var Le=function(ve){ve.persisted||Q.destroy()};window.addEventListener("pagehide",Le,!1),Q.on("destroy",function(){window.removeEventListener("visibilitychange",Pe),window.removeEventListener("pagehide",Le)})}return Q.on("playerready",function(ve,Ee){l()(this.data,Ee)}),Ku.forEach(function(ve){Q.on(ve,function(Ee,Ne){ve.indexOf("ad")!==0&&this._updateStateData(),l()(this.data,Ne),this._sanitizeData()}),Q.on("after"+ve,function(){(ve!=="error"||this.errorTracker.viewErrored)&&this.send(ve)})}),Q.on("viewend",function(ve,Ee){l()(Q.data,Ee)}),Q.one("playerready",function(ve){var Ee=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=Ee-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time}),Q.longResumeTracker=new Uu(at(Q)),Q.errorTracker=new te(at(Q)),new _t(at(Q)),Q.seekingTracker=new It(at(Q)),Q.playheadTime=new ne(at(Q)),Q.playbackHeartbeat=new G(at(Q)),new ft(at(Q)),Q.watchTimeTracker=new ue(at(Q)),new he(at(Q)),Q.adTracker=new qe(at(Q)),new Ze(at(Q)),new Se(at(Q)),new tt(at(Q)),new vt(at(Q)),new ku(at(Q)),q.hlsjs&&Q.addHLSJS(q),q.dashjs&&Q.addDashJS(q),Q.emit("viewinit",q.data),Q}return k=z,w=[{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,this.data.view_start!==void 0&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),window.clearTimeout(this._heartBeatTimeout))}},{key:"send",value:function(Y){var Z=l()({},this.data);if(Z.video_source_is_live===void 0&&(Z.player_source_duration===1/0||Z.video_source_duration===1/0?Z.video_source_is_live=!0:(Z.player_source_duration>0||Z.video_source_duration>0)&&(Z.video_source_is_live=!1)),Z.video_source_is_live||["player_program_time","player_manifest_newest_program_time","player_live_edge_program_time","player_program_time","video_holdback","video_part_holdback","video_target_duration","video_part_target_duration"].forEach(function(Te){Z[Te]=void 0}),Z.video_source_url=Z.video_source_url||Z.player_source_url,Z.video_source_url){var q=Nu(h(Z.video_source_url),2),Q=q[0],se=q[1];Z.video_source_domain=se,Z.video_source_hostname=Q}delete Z.ad_request_id,this.playbackEventDispatcher.send(Y,Z),this.data.view_sequence_number++,this.data.player_sequence_number++,this._restartHeartBeat()}},{key:"_updateStateData",value:function(){l()(this.data,this.getStateData()),this.playheadTime._updatePlayheadTime(),this._sanitizeData()}},{key:"_sanitizeData",value:function(){var Y=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach(function(Z){var q=parseInt(Y.data[Z],10);Y.data[Z]=isNaN(q)?void 0:q}),["player_source_url","video_source_url"].forEach(function(Z){if(Y.data[Z]){var q=Y.data[Z].toLowerCase();q.indexOf("data:")!==0&&q.indexOf("blob:")!==0||(Y.data[Z]="MSE style URL")}})}},{key:"_resetVideoData",value:function(Y,Z){var q=this;Object.keys(this.data).forEach(function(Q){Q.indexOf("video_")===0&&delete q.data[Q]})}},{key:"_resetViewData",value:function(){var Y=this;Object.keys(this.data).forEach(function(Z){Z.indexOf("view_")===0&&delete Y.data[Z]}),this.data.view_sequence_number=1}},{key:"_resetErrorData",value:function(Y,Z){delete this.data.player_error_code,delete this.data.player_error_message}},{key:"_initializeViewData",value:function(){var Y=this,Z=this.data.view_id=A(),q=function(){Z===Y.data.view_id&&n(Y.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",q):q()}},{key:"_restartHeartBeat",value:function(){var Y=this;window.clearTimeout(this._heartBeatTimeout),this.errorTracker.viewErrored||(this._heartBeatTimeout=window.setTimeout(function(){Y.data.player_is_paused||Y.emit("hb")},1e4))}},{key:"addHLSJS",value:function(Y){Y.hlsjs?this.hlsjs?this.mux.log.warn("An instance of HLS.js is already being monitored for this player."):(this.hlsjs=Y.hlsjs,function(Z,q,Q){var se=arguments.length>4?arguments[4]:void 0,Te=Z.log,Pe=Z.utils.secondsToMs,Le=function(Oe){var ge,Ae=parseInt(se.version);return Ae===1&&Oe.programDateTime!==null&&(ge=Oe.programDateTime),Ae===0&&Oe.pdt!==null&&(ge=Oe.pdt),ge};if(E.exists()){var ve=function(Oe,ge){return Z.emit(q,Oe,ge)},Ee=function(Oe,ge){var Ae=ge.levels,ye=ge.audioTracks,Ie=ge.url,ze=ge.stats,Ke=ge.networkDetails,Ct=ge.sessionData,Lt={},Gt={};Ae.forEach(function($t,li){Lt[li]={width:$t.width,height:$t.height,bitrate:$t.bitrate,attrs:$t.attrs}}),ye.forEach(function($t,li){Gt[li]={name:$t.name,language:$t.lang,bitrate:$t.bitrate}});var jt=L(ze),Vt=jt.bytesLoaded,gt=jt.requestStart,cn=jt.responseStart,fn=jt.responseEnd;ve("requestcompleted",y(y({},f(Ct)),{},{request_event_type:Oe,request_bytes_loaded:Vt,request_start:gt,request_response_start:cn,request_response_end:fn,request_type:"manifest",request_hostname:s(Ie),request_response_headers:P(Ke),request_rendition_lists:{media:Lt,audio:Gt,video:{}}}))};Q.on(se.Events.MANIFEST_LOADED,Ee);var Ne=function(Oe,ge){var Ae=ge.details,ye=ge.level,Ie=ge.networkDetails,ze=ge.stats,Ke=L(ze),Ct=Ke.bytesLoaded,Lt=Ke.requestStart,Gt=Ke.responseStart,jt=Ke.responseEnd,Vt=Ae.fragments[Ae.fragments.length-1],gt=Le(Vt)+Pe(Vt.duration);ve("requestcompleted",{request_event_type:Oe,request_bytes_loaded:Ct,request_start:Lt,request_response_start:Gt,request_response_end:jt,request_current_level:ye,request_type:"manifest",request_hostname:s(Ae.url),request_response_headers:P(Ie),video_holdback:Ae.holdBack&&Pe(Ae.holdBack),video_part_holdback:Ae.partHoldBack&&Pe(Ae.partHoldBack),video_part_target_duration:Ae.partTarget&&Pe(Ae.partTarget),video_target_duration:Ae.targetduration&&Pe(Ae.targetduration),video_source_is_live:Ae.live,player_manifest_newest_program_time:isNaN(gt)?void 0:gt})};Q.on(se.Events.LEVEL_LOADED,Ne);var yt=function(Oe,ge){var Ae=ge.details,ye=ge.networkDetails,Ie=ge.stats,ze=L(Ie),Ke=ze.bytesLoaded,Ct=ze.requestStart,Lt=ze.responseStart,Gt=ze.responseEnd;ve("requestcompleted",{request_event_type:Oe,request_bytes_loaded:Ke,request_start:Ct,request_response_start:Lt,request_response_end:Gt,request_type:"manifest",request_hostname:s(Ae.url),request_response_headers:P(ye)})};Q.on(se.Events.AUDIO_TRACK_LOADED,yt);var xt=function(Oe,ge){var Ae=ge.stats,ye=ge.networkDetails,Ie=ge.frag;Ae=Ae||Ie.stats;var ze=L(Ae),Ke={request_event_type:Oe,request_bytes_loaded:ze.bytesLoaded,request_start:ze.requestStart,request_response_start:ze.responseStart,request_response_end:ze.responseEnd,request_hostname:ye?s(ye.responseURL):void 0,request_response_headers:P(ye),request_media_duration:Ie.duration};Ie.type==="main"?(Ke.request_type="media",Ke.request_current_level=Ie.level,Ke.request_video_width=(Q.levels[Ie.level]||{}).width,Ke.request_video_height=(Q.levels[Ie.level]||{}).height):Ke.request_type=Ie.type,ve("requestcompleted",Ke)};Q.on(se.Events.FRAG_LOADED,xt);var yr=function(Oe,ge){var Ae=ge.frag,ye=Ae.start,Ie={currentFragmentPDT:Le(Ae),currentFragmentStart:Pe(ye)};ve("fragmentchange",Ie)};Q.on(se.Events.FRAG_CHANGED,yr);var Be=function(Oe,ge){var Ae=ge.type,ye=ge.details,Ie=ge.response,ze=ge.fatal,Ke=ge.context,Ct=ge.frag;if(ye===se.ErrorDetails.MANIFEST_LOAD_ERROR||ye===se.ErrorDetails.MANIFEST_LOAD_TIMEOUT||ye===se.ErrorDetails.FRAG_LOAD_ERROR||ye===se.ErrorDetails.FRAG_LOAD_TIMEOUT||ye===se.ErrorDetails.LEVEL_LOAD_ERROR||ye===se.ErrorDetails.LEVEL_LOAD_TIMEOUT){var Lt=Ct&&Ct.url||Ke&&Ke.url||"";ve("requestfailed",{request_error:ye,request_url:Lt,request_hostname:s(Lt),request_type:ye===se.ErrorDetails.FRAG_LOAD_ERROR||ye===se.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":"manifest",request_error_code:Ie&&Ie.code,request_error_text:Ie&&Ie.text})}ze&&ve("error",{player_error_code:Ae,player_error_message:ye})};Q.on(se.Events.ERROR,Be);var Dt=function(Oe,ge){var Ae=ge.frag,ye=Ae&&Ae._url||"";ve("requestcanceled",{request_event_type:Oe,request_url:ye,request_type:"media",request_hostname:s(ye)})};Q.on(se.Events.FRAG_LOAD_EMERGENCY_ABORTED,Dt);var mt=function(Oe,ge){var Ae=ge.level,ye=Q.levels[Ae];if(ye&&ye.attrs&&ye.attrs.BANDWIDTH){var Ie,ze=ye.attrs.BANDWIDTH,Ke=parseFloat(ye.attrs["FRAME-RATE"]);isNaN(Ke)||(Ie=Ke),ze?ve("renditionchange",{video_source_fps:Ie,video_source_bitrate:ze,video_source_width:ye.width,video_source_height:ye.height}):Te.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};Q.on(se.Events.LEVEL_SWITCHED,mt),Q._stopMuxMonitor=function(){Q.off(se.Events.MANIFEST_LOADED,Ee),Q.off(se.Events.LEVEL_LOADED,Ne),Q.off(se.Events.AUDIO_TRACK_LOADED,yt),Q.off(se.Events.FRAG_LOADED,xt),Q.off(se.Events.FRAG_CHANGED,yr),Q.off(se.Events.ERROR,Be),Q.off(se.Events.FRAG_LOAD_EMERGENCY_ABORTED,Dt),Q.off(se.Events.LEVEL_SWITCHED,mt),Q.off(se.Events.DESTROYING,Q._stopMuxMonitor),delete Q._stopMuxMonitor},Q.on(se.Events.DESTROYING,Q._stopMuxMonitor)}else Te.warn("performance timing not supported. Not tracking HLS.js.")}(this.mux,this.id,Y.hlsjs,{},Y.Hls||window.Hls)):this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.")}},{key:"removeHLSJS",value:function(){var Y;this.hlsjs&&((Y=this.hlsjs)&&typeof Y._stopMuxMonitor=="function"&&Y._stopMuxMonitor(),this.hlsjs=void 0)}},{key:"addDashJS",value:function(Y){Y.dashjs?this.dashjs?this.mux.log.warn("An instance of Dash.js is already being monitored for this player."):(this.dashjs=Y.dashjs,function(Z,q,Q){var se=Z.log;if(Q&&Q.on){var Te=function(Be,Dt){return Z.emit(q,Be,Dt)},Pe=function(Be){var Dt=Be.type,mt=(Be.data||{}).url;Te("requestcompleted",{request_event_type:Dt,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:s(mt)})};Q.on("manifestLoaded",Pe);var Le={},ve=function(Be){var Dt=Be.type,mt=Be.fragmentModel,Oe=(Be.chunk||{}).mediaInfo||{},ge=Oe.type,Ae=Oe.bitrateList,ye={};(Ae=Ae||[]).forEach(function(Vt,gt){ye[gt]={},ye[gt].width=Vt.width,ye[gt].height=Vt.height,ye[gt].bitrate=Vt.bandwidth,ye[gt].attrs={}}),ge==="video"?Le.video=ye:ge==="audio"?Le.audio=ye:Le.media=ye;var Ie=N(mt,Q),ze=Ie.requestStart,Ke=Ie.requestResponseStart,Ct=Ie.requestResponseEnd,Lt=Ie.requestResponseHeaders,Gt=Ie.requestMediaDuration,jt=Ie.requestHostname;Te("requestcompleted",{request_event_type:Dt,request_start:ze,request_response_start:Ke,request_response_end:Ct,request_bytes_loaded:-1,request_type:ge+"_init",request_response_headers:Lt,request_hostname:jt,request_media_duration:Gt,request_rendition_lists:Le})};Q.on("initFragmentLoaded",ve);var Ee=function(Be){var Dt=Be.type,mt=Be.fragmentModel,Oe=Be.chunk||{},ge=Oe.mediaInfo,Ae=Oe.start,ye=(ge||{}).type,Ie=N(mt,Q),ze=Ie.requestStart,Ke=Ie.requestResponseStart,Ct=Ie.requestResponseEnd,Lt=Ie.requestBytesLoaded,Gt=Ie.requestResponseHeaders,jt=Ie.requestMediaDuration,Vt=Ie.requestHostname,gt=B(ye,Q),cn=gt.currentLevel,fn=gt.renditionWidth,$t=gt.renditionHeight,li=gt.renditionBitrate;Te("requestcompleted",{request_event_type:Dt,request_start:ze,request_response_start:Ke,request_response_end:Ct,request_bytes_loaded:Lt,request_type:ye,request_response_headers:Gt,request_hostname:Vt,request_media_start_time:Ae,request_media_duration:jt,request_current_level:cn,request_labeled_bitrate:li,request_video_width:fn,request_video_height:$t})};Q.on("mediaFragmentLoaded",Ee);var Ne={video:void 0,audio:void 0,totalBitrate:void 0},yt=function(){if(Ne.video&&typeof Ne.video.bitrate=="number"){if(Ne.video.width&&Ne.video.height){var Be=Ne.video.bitrate;return Ne.audio&&typeof Ne.audio.bitrate=="number"&&(Be+=Ne.audio.bitrate),Be!==Ne.totalBitrate?(Ne.totalBitrate=Be,{video_source_bitrate:Be,video_source_height:Ne.video.height,video_source_width:Ne.video.width}):void 0}se.warn("have bitrate info for video but missing width/height")}},xt=function(Be,Dt,mt){if(typeof Be.newQuality=="number"){var Oe=Be.mediaType;if(Oe==="audio"||Oe==="video"){var ge=Q.getBitrateInfoListFor(Oe).find(function(ye){return ye.qualityIndex===Be.newQuality});if(ge&&typeof ge.bitrate=="number"){Ne[Oe]=ge;var Ae=yt();Ae&&Te("renditionchange",Ae)}else se.warn("missing bitrate info for ".concat(Oe))}}else se.warn("missing evt.newQuality in qualityChangeRendered event",Be)};Q.on("qualityChangeRendered",xt);var yr=function(Be){var Dt=Be.error,mt=Be.event,Oe=(mt=mt||{}).request||{},ge=D().event&&D().event.currentTarget||{};Te("requestfailed",{request_error:Dt+"_"+mt.id+"_"+Oe.type,request_url:mt.url,request_hostname:s(mt.url),request_type:Oe.mediaType,request_error_code:ge.status,request_error_type:ge.statusText})};Q.on("error",yr),Q._stopMuxMonitor=function(){Q.off("manifestLoaded",Pe),Q.off("initFragmentLoaded",ve),Q.off("mediaFragmentLoaded",Ee),Q.off("qualityChangeRendered",xt),Q.off("error",yr),delete Q._stopMuxMonitor}}else se.warn("Invalid dash.js player reference. Monitoring blocked.")}(this.mux,this.id,Y.dashjs)):this.mux.log.warn("You must pass a valid dashjs instance in order to track it.")}},{key:"removeDashJS",value:function(){var Y;this.dashjs&&((Y=this.dashjs)&&typeof Y._stopMuxMonitor=="function"&&Y._stopMuxMonitor(),this.dashjs=void 0)}}],w&&Zs(k.prototype,w),K&&Zs(k,K),Object.defineProperty(k,"prototype",{writable:!1}),z}(X),Hu=Wu,Gu=C(153),si=C.n(Gu);function ln(U){return ln=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},ln(U)}function Js(U,k){return function(w){if(Array.isArray(w))return w}(U)||function(w,K){var W=w==null?null:typeof Symbol!="undefined"&&w[Symbol.iterator]||w["@@iterator"];if(W!=null){var z,Y,Z=[],q=!0,Q=!1;try{for(W=W.call(w);!(q=(z=W.next()).done)&&(Z.push(z.value),!K||Z.length!==K);q=!0);}catch(se){Q=!0,Y=se}finally{try{q||W.return==null||W.return()}finally{if(Q)throw Y}}return Z}}(U,k)||function(w,K){if(w){if(typeof w=="string")return qs(w,K);var W=Object.prototype.toString.call(w).slice(8,-1);return W==="Object"&&w.constructor&&(W=w.constructor.name),W==="Map"||W==="Set"?Array.from(w):W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W)?qs(w,K):void 0}}(U,k)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function qs(U,k){(k==null||k>U.length)&&(k=U.length);for(var w=0,K=new Array(k);w<k;w++)K[w]=U[w];return K}var kr,ju=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],Vu={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"};D()&&D().WeakMap&&(kr=new WeakMap);var $u="#EXT-X-TARGETDURATION",Yu="#EXT-X-PART-INF",zu="#EXT-X-SERVER-CONTROL",Xu="#EXTINF",Qu="#EXT-X-PROGRAM-DATE-TIME",Zu="#EXT-X-VERSION",Ju="#EXT-X-SESSION-DATA",$i=function(U){return this.buffer="",this.manifest={segments:[],serverControl:{},sessionData:{}},this.currentUri={},this.process(U),this.manifest};$i.prototype.process=function(U){var k;for(this.buffer+=U,k=this.buffer.indexOf(`
`);k>-1;k=this.buffer.indexOf(`
`))this.processLine(this.buffer.substring(0,k)),this.buffer=this.buffer.substring(k+1)},$i.prototype.processLine=function(U){var k=U.indexOf(":"),w=rd(U,k),K=w[0],W=w.length===2?dn(w[1]):void 0;if(K[0]!=="#")this.currentUri.uri=K,this.manifest.segments.push(this.currentUri),this.manifest.targetDuration&&!("duration"in this.currentUri)&&(this.currentUri.duration=this.manifest.targetDuration),this.currentUri={};else switch(K){case $u:if(!isFinite(W)||W<0)return;this.manifest.targetDuration=W,this.setHoldBack();break;case Yu:un(this.manifest,w),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),this.setHoldBack();break;case zu:un(this.manifest,w),this.setHoldBack();break;case Xu:W===0?this.currentUri.duration=.01:W>0&&(this.currentUri.duration=W);break;case Qu:var z=W,Y=new Date(z);this.manifest.dateTimeString||(this.manifest.dateTimeString=z,this.manifest.dateTimeObject=Y),this.currentUri.dateTimeString=z,this.currentUri.dateTimeObject=Y;break;case Zu:un(this.manifest,w);break;case Ju:var Z=id(w[1]),q=f(Z);l()(this.manifest.sessionData,q)}},$i.prototype.setHoldBack=function(){var U=this.manifest,k=U.serverControl,w=U.targetDuration,K=U.partTargetDuration;if(k){var W="holdBack",z="partHoldBack",Y=w&&3*w,Z=K&&2*K;w&&!k.hasOwnProperty(W)&&(k[W]=Y),Y&&k[W]<Y&&(k[W]=Y),K&&!k.hasOwnProperty(z)&&(k[z]=3*K),K&&k[z]<Z&&(k[z]=Z)}};var un=function(U,k){var w,K=eo(k[0].replace("#EXT-X-",""));td(k[1])?(w={},w=l()(ed(k[1]),w)):w=dn(k[1]),U[K]=w},eo=function(U){return U.toLowerCase().replace(/-(\w)/g,function(k){return k[1].toUpperCase()})},dn=function(U){if(U.toLowerCase()==="yes"||U.toLowerCase()==="no")return U.toLowerCase()==="yes";var k=U.indexOf(":")!==-1?U:parseFloat(U);return isNaN(k)?U:k},qu=function(U){var k={},w=U.split("=");return w.length>1&&(k[eo(w[0])]=dn(w[1])),k},ed=function(U){for(var k=U.split(","),w={},K=0;k.length>K;K++){var W=k[K],z=qu(W);w=l()(z,w)}return w},td=function(U){return U.indexOf("=")>-1},rd=function(U,k){return k===-1?[U]:[U.substring(0,k),U.substring(k+1)]},id=function(U){var k={};if(U){var w=U.search(",");return[U.slice(0,w),U.slice(w+1)].forEach(function(K,W){for(var z=K.replace(/['"]+/g,"").split("="),Y=0;Y<z.length;Y++)z[Y]==="DATA-ID"&&(k["DATA-ID"]=z[1-Y]),z[Y]==="VALUE"&&(k.VALUE=z[1-Y])}),{data:k}}},ad=$i,nd={safeCall:function(U,k,w,K){var W=K;if(U&&typeof U[k]=="function")try{W=U[k].apply(U,w)}catch(z){i.info("safeCall error",z)}return W},safeIncrement:n,getComputedStyle:function(U,k){var w;if(U&&k&&D()&&typeof D().getComputedStyle=="function")return kr&&kr.has(U)&&(w=kr.get(U)),w||(w=D().getComputedStyle(U,null),kr&&kr.set(U,w)),w.getPropertyValue(k)},secondsToMs:function(U){return Math.floor(1e3*U)},assign:l(),headersStringToObject:m,extractHostnameAndDomain:h,extractHostname:s,manifestParser:ad,generateShortID:_,generateUUID:A,now:p.now},sd={PLAYER_READY:"playerready",VIEW_INIT:"viewinit",VIDEO_CHANGE:"videochange",PLAY:"play",PAUSE:"pause",PLAYING:"playing",TIME_UPDATE:"timeupdate",SEEKING:"seeking",SEEKED:"seeked",REBUFFER_START:"rebufferstart",REBUFFER_END:"rebufferend",ERROR:"error",ENDED:"ended",RENDITION_CHANGE:"renditionchange",ORIENTATION_CHANGE:"orientationchange",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_BREAK_START:"adbreakstart",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_FIRST_QUARTILE:"adfirstquartile",AD_MID_POINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile",AD_ENDED:"adended",AD_BREAK_END:"adbreakend",AD_ERROR:"aderror",REQUEST_COMPLETED:"requestcompleted",REQUEST_FAILED:"requestfailed",REQUEST_CANCELLED:"requestcanceled"};function od(U,k){return function(w){if(Array.isArray(w))return w}(U)||function(w,K){var W=w==null?null:typeof Symbol!="undefined"&&w[Symbol.iterator]||w["@@iterator"];if(W!=null){var z,Y,Z=[],q=!0,Q=!1;try{for(W=W.call(w);!(q=(z=W.next()).done)&&(Z.push(z.value),!K||Z.length!==K);q=!0);}catch(se){Q=!0,Y=se}finally{try{q||W.return==null||W.return()}finally{if(Q)throw Y}}return Z}}(U,k)||function(w,K){if(w){if(typeof w=="string")return to(w,K);var W=Object.prototype.toString.call(w).slice(8,-1);return W==="Object"&&w.constructor&&(W=w.constructor.name),W==="Map"||W==="Set"?Array.from(w):W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W)?to(w,K):void 0}}(U,k)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function to(U,k){(k==null||k>U.length)&&(k=U.length);for(var w=0,K=new Array(k);w<k;w++)K[w]=U[w];return K}var Mt={},oi=function U(k){var w=arguments;typeof k=="string"?U.hasOwnProperty(k)?D().setTimeout(function(){w=Array.prototype.splice.call(w,1),U[k].apply(null,w)},0):i.warn("`"+k+"` is an unknown task"):typeof k=="function"?D().setTimeout(function(){k(U)},0):i.warn("`"+k+"` is invalid.")},ld={loaded:p.now(),NAME:"mux-embed",VERSION:"4.14.0",API_VERSION:"2.1",PLAYER_TRACKED:!1,monitor:function(U,k){return function(w,K,W){var z=Js(S(K),3),Y=z[0],Z=z[1],q=z[2],Q=w.log,se=w.utils.getComputedStyle,Te=w.utils.secondsToMs;if(!Y)return Q.error("No element was found with the `"+Z+"` query selector.");if(q!=="video"&&q!=="audio")return Q.error("The element of `"+Z+"` was not a media element.");Y.mux&&(Y.mux.destroy(),delete Y.mux,Q.warn("Already monitoring this video element, replacing existing event listeners")),(W=l()({automaticErrorTracking:!0},W)).data=l()({player_software:"HTML5 Video Element",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:w.VERSION},W.data),W.getPlayheadTime=function(){return Te(Y.currentTime)},W.getStateData=function(){var Le=this.hlsjs&&this.hlsjs.url,ve=this.dashjs&&ln(this.dashjs.getSource==="function")&&this.dashjs.getSource(),Ee={player_is_paused:Y.paused,player_playhead_time:Te(Y.currentTime),player_width:parseInt(se(Y,"width")),player_height:parseInt(se(Y,"height")),player_autoplay_on:Y.autoplay,player_preload_on:Y.preload,player_language_code:Y.lang,player_is_fullscreen:si()&&!!(si().fullscreenElement||si().webkitFullscreenElement||si().mozFullScreenElement||si().msFullscreenElement),video_poster_url:Y.poster,video_source_url:Le||ve||Y.currentSrc,video_source_duration:Te(Y.duration),video_source_height:Y.videoHeight,video_source_width:Y.videoWidth},Ne=W.getPlayheadTime();if(Y.getStartDate&&Ne>0){var yt=Y.getStartDate();if(yt&&typeof yt.getTime=="function"&&yt.getTime()){var xt=yt.getTime();if(Ee.player_program_time=xt+Ne,Y.seekable.length>0){var yr=xt+Y.seekable.end(Y.seekable.length-1);Ee.player_live_edge_program_time=yr}}}return Ee},Y.mux=Y.mux||{},Y.mux.deleted=!1,Y.mux.emit=function(Le,ve){w.emit(Z,Le,ve)};var Pe=function(){Q.error("The monitor for this video element has already been destroyed.")};Y.mux.destroy=function(){Object.keys(Y.mux.listeners).forEach(function(Le){Y.removeEventListener(Le,Y.mux.listeners[Le],!1)}),delete Y.mux.listeners,Y.mux.destroy=Pe,Y.mux.swapElement=Pe,Y.mux.emit=Pe,Y.mux.addHLSJS=Pe,Y.mux.addDashJS=Pe,Y.mux.removeHLSJS=Pe,Y.mux.removeDashJS=Pe,Y.mux.deleted=!0,w.emit(Z,"destroy")},Y.mux.swapElement=function(Le){var ve=Js(S(Le),3),Ee=ve[0],Ne=ve[1],yt=ve[2];return Ee?yt!=="video"&&yt!=="audio"?w.log.error("The element of `"+Ne+"` was not a media element."):(Ee.muxId=Y.muxId,delete Y.muxId,Ee.mux=Ee.mux||{},Ee.mux.listeners=l()({},Y.mux.listeners),delete Y.mux.listeners,Object.keys(Ee.mux.listeners).forEach(function(xt){Y.removeEventListener(xt,Ee.mux.listeners[xt],!1),Ee.addEventListener(xt,Ee.mux.listeners[xt],!1)}),Ee.mux.swapElement=Y.mux.swapElement,Ee.mux.destroy=Y.mux.destroy,delete Y.mux,void(Y=Ee)):w.log.error("No element was found with the `"+Ne+"` query selector.")},Y.mux.addHLSJS=function(Le){w.addHLSJS(Z,Le)},Y.mux.addDashJS=function(Le){w.addDashJS(Z,Le)},Y.mux.removeHLSJS=function(){w.removeHLSJS(Z)},Y.mux.removeDashJS=function(){w.removeDashJS(Z)},w.init(Z,W),w.emit(Z,"playerready"),Y.paused||(w.emit(Z,"play"),Y.readyState>2&&w.emit(Z,"playing")),Y.mux.listeners={},ju.forEach(function(Le){(Le!=="error"||W.automaticErrorTracking)&&(Y.mux.listeners[Le]=function(){var ve={};if(Le==="error"){if(!Y.error||Y.error.code===1)return;ve.player_error_code=Y.error.code,ve.player_error_message=Vu[Y.error.code]||Y.error.message}w.emit(Z,Le,ve)},Y.addEventListener(Le,Y.mux.listeners[Le],!1))})}(oi,U,k)},destroyMonitor:function(U){var k=od(S(U),1)[0];k&&k.mux&&typeof k.mux.destroy=="function"?k.mux.destroy():i.error("A video element monitor for `"+U+"` has not been initialized via `mux.monitor`.")},addHLSJS:function(U,k){var w=I(U);Mt[w]?Mt[w].addHLSJS(k):i.error("A monitor for `"+w+"` has not been initialized.")},addDashJS:function(U,k){var w=I(U);Mt[w]?Mt[w].addDashJS(k):i.error("A monitor for `"+w+"` has not been initialized.")},removeHLSJS:function(U){var k=I(U);Mt[k]?Mt[k].removeHLSJS():i.error("A monitor for `"+k+"` has not been initialized.")},removeDashJS:function(U){var k=I(U);Mt[k]?Mt[k].removeDashJS():i.error("A monitor for `"+k+"` has not been initialized.")},init:function(U,k){u()&&k&&k.respectDoNotTrack&&i.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var w=I(U);Mt[w]=new Hu(oi,w,k)},emit:function(U,k,w){var K=I(U);Mt[K]?(Mt[K].emit(k,w),k==="destroy"&&delete Mt[K]):i.error("A monitor for `"+K+"` has not been initialized.")},checkDoNotTrack:u,log:i,utils:nd,events:sd,WINDOW_HIDDEN:!1,WINDOW_UNLOADING:!1};Object.assign(oi,ld),D()!==void 0&&typeof D().addEventListener=="function"&&D().addEventListener("pagehide",function(U){U.persisted||(oi.WINDOW_UNLOADING=!0)},!1);var ud=oi},655:function(c,O,C){var M,D;function A(_){return A=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},A(_);}(function(_){var I=!1;if((D=typeof(M=_)=="function"?M.call(O,C,O,c):M)===void 0||(c.exports=D),I=!0,A(O)==="object"&&(c.exports=_(),I=!0),!I){var S=window.Cookies,T=window.Cookies=_();T.noConflict=function(){return window.Cookies=S,T}}})(function(){var _=function(){for(var I=0,S={};I<arguments.length;I++){var T=arguments[I];for(var x in T)S[x]=T[x]}return S};return function I(S){function T(x,v,i){var u;if(typeof document!="undefined"){if(arguments.length>1){if(typeof(i=_({path:"/"},T.defaults,i)).expires=="number"){var p=new Date;p.setMilliseconds(p.getMilliseconds()+864e5*i.expires),i.expires=p}try{u=JSON.stringify(v),/^[\{\[]/.test(u)&&(v=u)}catch{}return v=S.write?S.write(v,x):encodeURIComponent(String(v)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),x=(x=(x=encodeURIComponent(String(x))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[x,"=",v,i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}x||(u={});for(var b=document.cookie?document.cookie.split("; "):[],l=/(%[0-9A-Z]{2})+/g,s=0;s<b.length;s++){var h=b[s].split("="),E=h.slice(1).join("=");E.charAt(0)==='"'&&(E=E.slice(1,-1));try{var n=h[0].replace(l,decodeURIComponent);if(E=S.read?S.read(E,n):S(E,n)||E.replace(l,decodeURIComponent),this.json)try{E=JSON.parse(E)}catch{}if(x===n){u=E;break}x||(u[n]=E)}catch{}}return u}}return T.set=T,T.get=function(x){return T.call(T,x)},T.getJSON=function(){return T.apply({json:!0},[].slice.call(arguments))},T.defaults={},T.remove=function(x,v){T(x,"",_(v,{expires:-1}))},T.withConverter=I,T}(function(){})})},153:function(c,O,C){var M,D=C.g!==void 0?C.g:typeof window!="undefined"?window:{},A=C(558);typeof document!="undefined"?M=document:(M=D["__GLOBAL_DOCUMENT_CACHE@4"])||(M=D["__GLOBAL_DOCUMENT_CACHE@4"]=A),c.exports=M},48:function(c,O,C){var M;M=typeof window!="undefined"?window:C.g!==void 0?C.g:typeof self!="undefined"?self:{},c.exports=M},678:function(c){var O=9007199254740991,C="[object Arguments]",M="[object Function]",D="[object GeneratorFunction]",A=/^(?:0|[1-9]\d*)$/;function _(R,L,P){switch(P.length){case 0:return R.call(L);case 1:return R.call(L,P[0]);case 2:return R.call(L,P[0],P[1]);case 3:return R.call(L,P[0],P[1],P[2])}return R.apply(L,P)}var I,S,T=Object.prototype,x=T.hasOwnProperty,v=T.toString,i=T.propertyIsEnumerable,u=(I=Object.keys,S=Object,function(R){return I(S(R))}),p=Math.max,b=!i.call({valueOf:1},"valueOf");function l(R,L){var P=d(R)||function(H){return function(j){return function(X){return!!X&&typeof X=="object"}(j)&&m(j)}(H)&&x.call(H,"callee")&&(!i.call(H,"callee")||v.call(H)==C)}(R)?function(H,j){for(var X=-1,$=Array(H);++X<H;)$[X]=j(X);return $}(R.length,String):[],N=P.length,B=!!N;for(var F in R)!L&&!x.call(R,F)||B&&(F=="length"||h(F,N))||P.push(F);return P}function s(R,L,P){var N=R[L];x.call(R,L)&&n(N,P)&&(P!==void 0||L in R)||(R[L]=P)}function h(R,L){return!!(L=L==null?O:L)&&(typeof R=="number"||A.test(R))&&R>-1&&R%1==0&&R<L}function E(R){var L=R&&R.constructor;return R===(typeof L=="function"&&L.prototype||T)}function n(R,L){return R===L||R!=R&&L!=L}var d=Array.isArray;function m(R){return R!=null&&function(L){return typeof L=="number"&&L>-1&&L%1==0&&L<=O}(R.length)&&!function(L){var P=f(L)?v.call(L):"";return P==M||P==D}(R)}function f(R){var L=typeof R;return!!R&&(L=="object"||L=="function")}var g,y=(g=function(R,L){if(b||E(L)||m(L))(function(N,B,F,H){F||(F={});for(var j=-1,X=B.length;++j<X;){var $=B[j],G=H?H(F[$],N[$],$,F,N):void 0;s(F,$,G===void 0?N[$]:G)}})(L,function(N){return m(N)?l(N):function(B){if(!E(B))return u(B);var F=[];for(var H in Object(B))x.call(B,H)&&H!="constructor"&&F.push(H);return F}(N)}(L),R);else for(var P in L)x.call(L,P)&&s(R,P,L[P])},function(R,L){return L=p(L===void 0?R.length-1:L,0),function(){for(var P=arguments,N=-1,B=p(P.length-L,0),F=Array(B);++N<B;)F[N]=P[L+N];N=-1;for(var H=Array(L+1);++N<L;)H[N]=P[N];return H[L]=F,_(R,this,H)}}(function(R,L){var P=-1,N=L.length,B=N>1?L[N-1]:void 0,F=N>2?L[2]:void 0;for(B=g.length>3&&typeof B=="function"?(N--,B):void 0,F&&function(j,X,$){if(!f($))return!1;var G=typeof X;return!!(G=="number"?m($)&&h(X,$.length):G=="string"&&X in $)&&n($[X],j)}(L[0],L[1],F)&&(B=N<3?void 0:B,N=1),R=Object(R);++P<N;){var H=L[P];H&&g(R,H,P,B)}return R}));c.exports=y},640:function(c,O,C){var M,D;(function(A,_){"use strict";M=function(){var I=function(){},S="undefined",T=typeof window!==S&&typeof window.navigator!==S&&/Trident\/|MSIE /.test(window.navigator.userAgent),x=["trace","debug","info","warn","error"];function v(d,m){var f=d[m];if(typeof f.bind=="function")return f.bind(d);try{return Function.prototype.bind.call(f,d)}catch{return function(){return Function.prototype.apply.apply(f,[d,arguments])}}}function i(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function u(d){return d==="debug"&&(d="log"),typeof console!==S&&(d==="trace"&&T?i:console[d]!==void 0?v(console,d):console.log!==void 0?v(console,"log"):I)}function p(d,m){for(var f=0;f<x.length;f++){var g=x[f];this[g]=f<d?I:this.methodFactory(g,d,m)}this.log=this.debug}function b(d,m,f){return function(){typeof console!==S&&(p.call(this,m,f),this[d].apply(this,arguments))}}function l(d,m,f){return u(d)||b.apply(this,arguments)}function s(d,m,f){var g,y=this;m=m==null?"WARN":m;var R="loglevel";function L(F){var H=(x[F]||"silent").toUpperCase();if(typeof window!==S&&R){try{return void(window.localStorage[R]=H)}catch{}try{window.document.cookie=encodeURIComponent(R)+"="+H+";"}catch{}}}function P(){var F;if(typeof window!==S&&R){try{F=window.localStorage[R]}catch{}if(typeof F===S)try{var H=window.document.cookie,j=H.indexOf(encodeURIComponent(R)+"=");j!==-1&&(F=/^([^;]+)/.exec(H.slice(j))[1])}catch{}return y.levels[F]===void 0&&(F=void 0),F}}function N(){if(typeof window!==S&&R){try{return void window.localStorage.removeItem(R)}catch{}try{window.document.cookie=encodeURIComponent(R)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}typeof d=="string"?R+=":"+d:typeof d=="symbol"&&(R=void 0),y.name=d,y.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},y.methodFactory=f||l,y.getLevel=function(){return g},y.setLevel=function(F,H){if(typeof F=="string"&&y.levels[F.toUpperCase()]!==void 0&&(F=y.levels[F.toUpperCase()]),!(typeof F=="number"&&F>=0&&F<=y.levels.SILENT))throw"log.setLevel() called with invalid level: "+F;if(g=F,H!==!1&&L(F),p.call(y,F,d),typeof console===S&&F<y.levels.SILENT)return"No console available for logging"},y.setDefaultLevel=function(F){m=F,P()||y.setLevel(F,!1)},y.resetLevel=function(){y.setLevel(m,!1),N()},y.enableAll=function(F){y.setLevel(y.levels.TRACE,F)},y.disableAll=function(F){y.setLevel(y.levels.SILENT,F)};var B=P();B==null&&(B=m),y.setLevel(B,!1)}var h=new s,E={};h.getLogger=function(d){if(typeof d!="symbol"&&typeof d!="string"||d==="")throw new TypeError("You must supply a name when creating a logger.");var m=E[d];return m||(m=E[d]=new s(d,h.getLevel(),h.methodFactory)),m};var n=typeof window!==S?window.log:void 0;return h.noConflict=function(){return typeof window!==S&&window.log===h&&(window.log=n),h},h.getLoggers=function(){return E},h.default=h,h},(D=typeof M=="function"?M.call(O,C,O,c):M)===void 0||(c.exports=D)})()},375:function(c,O){"use strict";var C=Object.prototype.hasOwnProperty;function M(A){try{return decodeURIComponent(A.replace(/\+/g," "))}catch{return null}}function D(A){try{return encodeURIComponent(A)}catch{return null}}O.stringify=function(A,_){_=_||"";var I,S,T=[];for(S in typeof _!="string"&&(_="?"),A)if(C.call(A,S)){if((I=A[S])||I!=null&&!isNaN(I)||(I=""),S=D(S),I=D(I),S===null||I===null)continue;T.push(S+"="+I)}return T.length?_+T.join("&"):""},O.parse=function(A){for(var _,I=/([^=?#&]+)=?([^&]*)/g,S={};_=I.exec(A);){var T=M(_[1]),x=M(_[2]);T===null||x===null||T in S||(S[T]=x)}return S}},558:function(){}},a={};function o(c){var O=a[c];if(O!==void 0)return O.exports;var C=a[c]={exports:{}};return r[c].call(C.exports,C,C.exports,o),C.exports}return o.n=function(c){var O=c&&c.__esModule?function(){return c.default}:function(){return c};return o.d(O,{a:O}),O},o.d=function(c,O){for(var C in O)o.o(O,C)&&!o.o(c,C)&&Object.defineProperty(c,C,{enumerable:!0,get:O[C]})},o.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),o.o=function(c,O){return Object.prototype.hasOwnProperty.call(c,O)},o(80)}()},typeof _a=="object"&&typeof os=="object"?os.exports=e():typeof _a=="object"?_a.mux=e():t.mux=e()})()});var Sa=ro((_i,ls)=>{typeof window!="undefined"&&function(e,r){typeof _i=="object"&&typeof ls=="object"?ls.exports=r():typeof define=="function"&&define.amd?define([],r):typeof _i=="object"?_i.Hls=r():e.Hls=r()}(_i,function(){return function(t){var e={};function r(a){if(e[a])return e[a].exports;var o=e[a]={i:a,l:!1,exports:{}};return t[a].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(a,o,c){r.o(a,o)||Object.defineProperty(a,o,{enumerable:!0,get:c})},r.r=function(a){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},r.t=function(a,o){if(o&1&&(a=r(a)),o&8||o&4&&typeof a=="object"&&a&&a.__esModule)return a;var c=Object.create(null);if(r.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:a}),o&2&&typeof a!="string")for(var O in a)r.d(c,O,function(C){return a[C]}.bind(null,O));return c},r.n=function(a){var o=a&&a.__esModule?function(){return a.default}:function(){return a};return r.d(o,"a",o),o},r.o=function(a,o){return Object.prototype.hasOwnProperty.call(a,o)},r.p="/dist/",r(r.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(t,e,r){"use strict";var a=Object.prototype.hasOwnProperty,o="~";function c(){}Object.create&&(c.prototype=Object.create(null),new c().__proto__||(o=!1));function O(A,_,I){this.fn=A,this.context=_,this.once=I||!1}function C(A,_,I,S,T){if(typeof I!="function")throw new TypeError("The listener must be a function");var x=new O(I,S||A,T),v=o?o+_:_;return A._events[v]?A._events[v].fn?A._events[v]=[A._events[v],x]:A._events[v].push(x):(A._events[v]=x,A._eventsCount++),A}function M(A,_){--A._eventsCount===0?A._events=new c:delete A._events[_]}function D(){this._events=new c,this._eventsCount=0}D.prototype.eventNames=function(){var _=[],I,S;if(this._eventsCount===0)return _;for(S in I=this._events)a.call(I,S)&&_.push(o?S.slice(1):S);return Object.getOwnPropertySymbols?_.concat(Object.getOwnPropertySymbols(I)):_},D.prototype.listeners=function(_){var I=o?o+_:_,S=this._events[I];if(!S)return[];if(S.fn)return[S.fn];for(var T=0,x=S.length,v=new Array(x);T<x;T++)v[T]=S[T].fn;return v},D.prototype.listenerCount=function(_){var I=o?o+_:_,S=this._events[I];return S?S.fn?1:S.length:0},D.prototype.emit=function(_,I,S,T,x,v){var i=o?o+_:_;if(!this._events[i])return!1;var u=this._events[i],p=arguments.length,b,l;if(u.fn){switch(u.once&&this.removeListener(_,u.fn,void 0,!0),p){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,I),!0;case 3:return u.fn.call(u.context,I,S),!0;case 4:return u.fn.call(u.context,I,S,T),!0;case 5:return u.fn.call(u.context,I,S,T,x),!0;case 6:return u.fn.call(u.context,I,S,T,x,v),!0}for(l=1,b=new Array(p-1);l<p;l++)b[l-1]=arguments[l];u.fn.apply(u.context,b)}else{var s=u.length,h;for(l=0;l<s;l++)switch(u[l].once&&this.removeListener(_,u[l].fn,void 0,!0),p){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,I);break;case 3:u[l].fn.call(u[l].context,I,S);break;case 4:u[l].fn.call(u[l].context,I,S,T);break;default:if(!b)for(h=1,b=new Array(p-1);h<p;h++)b[h-1]=arguments[h];u[l].fn.apply(u[l].context,b)}}return!0},D.prototype.on=function(_,I,S){return C(this,_,I,S,!1)},D.prototype.once=function(_,I,S){return C(this,_,I,S,!0)},D.prototype.removeListener=function(_,I,S,T){var x=o?o+_:_;if(!this._events[x])return this;if(!I)return M(this,x),this;var v=this._events[x];if(v.fn)v.fn===I&&(!T||v.once)&&(!S||v.context===S)&&M(this,x);else{for(var i=0,u=[],p=v.length;i<p;i++)(v[i].fn!==I||T&&!v[i].once||S&&v[i].context!==S)&&u.push(v[i]);u.length?this._events[x]=u.length===1?u[0]:u:M(this,x)}return this},D.prototype.removeAllListeners=function(_){var I;return _?(I=o?o+_:_,this._events[I]&&M(this,I)):(this._events=new c,this._eventsCount=0),this},D.prototype.off=D.prototype.removeListener,D.prototype.addListener=D.prototype.on,D.prefixed=o,D.EventEmitter=D,t.exports=D},"./node_modules/url-toolkit/src/url-toolkit.js":function(t,e,r){(function(a){var o=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,c=/^(?=([^\/?#]*))\1([^]*)$/,O=/(?:\/|^)\.(?=\/)/g,C=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,M={buildAbsoluteURL:function(D,A,_){if(_=_||{},D=D.trim(),A=A.trim(),!A){if(!_.alwaysNormalize)return D;var I=M.parseURL(D);if(!I)throw new Error("Error trying to parse base URL.");return I.path=M.normalizePath(I.path),M.buildURLFromParts(I)}var S=M.parseURL(A);if(!S)throw new Error("Error trying to parse relative URL.");if(S.scheme)return _.alwaysNormalize?(S.path=M.normalizePath(S.path),M.buildURLFromParts(S)):A;var T=M.parseURL(D);if(!T)throw new Error("Error trying to parse base URL.");if(!T.netLoc&&T.path&&T.path[0]!=="/"){var x=c.exec(T.path);T.netLoc=x[1],T.path=x[2]}T.netLoc&&!T.path&&(T.path="/");var v={scheme:T.scheme,netLoc:S.netLoc,path:null,params:S.params,query:S.query,fragment:S.fragment};if(!S.netLoc&&(v.netLoc=T.netLoc,S.path[0]!=="/"))if(!S.path)v.path=T.path,S.params||(v.params=T.params,S.query||(v.query=T.query));else{var i=T.path,u=i.substring(0,i.lastIndexOf("/")+1)+S.path;v.path=M.normalizePath(u)}return v.path===null&&(v.path=_.alwaysNormalize?M.normalizePath(S.path):S.path),M.buildURLFromParts(v)},parseURL:function(D){var A=o.exec(D);return A?{scheme:A[1]||"",netLoc:A[2]||"",path:A[3]||"",params:A[4]||"",query:A[5]||"",fragment:A[6]||""}:null},normalizePath:function(D){for(D=D.split("").reverse().join("").replace(O,"");D.length!==(D=D.replace(C,"")).length;);return D.split("").reverse().join("")},buildURLFromParts:function(D){return D.scheme+D.netLoc+D.path+D.params+D.query+D.fragment}};t.exports=M})(this)},"./node_modules/webworkify-webpack/index.js":function(t,e,r){function a(_){var I={};function S(x){if(I[x])return I[x].exports;var v=I[x]={i:x,l:!1,exports:{}};return _[x].call(v.exports,v,v.exports,S),v.l=!0,v.exports}S.m=_,S.c=I,S.i=function(x){return x},S.d=function(x,v,i){S.o(x,v)||Object.defineProperty(x,v,{configurable:!1,enumerable:!0,get:i})},S.r=function(x){Object.defineProperty(x,"__esModule",{value:!0})},S.n=function(x){var v=x&&x.__esModule?function(){return x.default}:function(){return x};return S.d(v,"a",v),v},S.o=function(x,v){return Object.prototype.hasOwnProperty.call(x,v)},S.p="/",S.oe=function(x){throw console.error(x),x};var T=S(S.s=ENTRY_MODULE);return T.default||T}var o="[\\.|\\-|\\+|\\w|/|@]+",c="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+o+").*?\\)";function O(_){return(_+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function C(_){return!isNaN(1*_)}function M(_,I,S){var T={};T[S]=[];var x=I.toString(),v=x.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!v)return T;for(var i=v[1],u=new RegExp("(\\\\n|\\W)"+O(i)+c,"g"),p;p=u.exec(x);)p[3]!=="dll-reference"&&T[S].push(p[3]);for(u=new RegExp("\\("+O(i)+'\\("(dll-reference\\s('+o+'))"\\)\\)'+c,"g");p=u.exec(x);)_[p[2]]||(T[S].push(p[1]),_[p[2]]=r(p[1]).m),T[p[2]]=T[p[2]]||[],T[p[2]].push(p[4]);for(var b=Object.keys(T),l=0;l<b.length;l++)for(var s=0;s<T[b[l]].length;s++)C(T[b[l]][s])&&(T[b[l]][s]=1*T[b[l]][s]);return T}function D(_){var I=Object.keys(_);return I.reduce(function(S,T){return S||_[T].length>0},!1)}function A(_,I){for(var S={main:[I]},T={main:[]},x={main:{}};D(S);)for(var v=Object.keys(S),i=0;i<v.length;i++){var u=v[i],p=S[u],b=p.pop();if(x[u]=x[u]||{},!(x[u][b]||!_[u][b])){x[u][b]=!0,T[u]=T[u]||[],T[u].push(b);for(var l=M(_,_[u][b],u),s=Object.keys(l),h=0;h<s.length;h++)S[s[h]]=S[s[h]]||[],S[s[h]]=S[s[h]].concat(l[s[h]])}}return T}t.exports=function(_,I){I=I||{};var S={main:r.m},T=I.all?{main:Object.keys(S.main)}:A(S,_),x="";Object.keys(T).filter(function(b){return b!=="main"}).forEach(function(b){for(var l=0;T[b][l];)l++;T[b].push(l),S[b][l]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",x=x+"var "+b+" = ("+a.toString().replace("ENTRY_MODULE",JSON.stringify(l))+")({"+T[b].map(function(s){return""+JSON.stringify(s)+": "+S[b][s].toString()}).join(",")+`});
`}),x=x+"new (("+a.toString().replace("ENTRY_MODULE",JSON.stringify(_))+")({"+T.main.map(function(b){return""+JSON.stringify(b)+": "+S.main[b].toString()}).join(",")+"}))(self);";var v=new window.Blob([x],{type:"text/javascript"});if(I.bare)return v;var i=window.URL||window.webkitURL||window.mozURL||window.msURL,u=i.createObjectURL(v),p=new window.Worker(u);return p.objectURL=u,p}},"./src/config.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"hlsDefaultConfig",function(){return h}),r.d(e,"mergeConfig",function(){return n}),r.d(e,"enableStreamingMode",function(){return d});var a=r("./src/controller/abr-controller.ts"),o=r("./src/controller/audio-stream-controller.ts"),c=r("./src/controller/audio-track-controller.ts"),O=r("./src/controller/subtitle-stream-controller.ts"),C=r("./src/controller/subtitle-track-controller.ts"),M=r("./src/controller/buffer-controller.ts"),D=r("./src/controller/timeline-controller.ts"),A=r("./src/controller/cap-level-controller.ts"),_=r("./src/controller/fps-controller.ts"),I=r("./src/controller/eme-controller.ts"),S=r("./src/controller/cmcd-controller.ts"),T=r("./src/utils/xhr-loader.ts"),x=r("./src/utils/fetch-loader.ts"),v=r("./src/utils/cues.ts"),i=r("./src/utils/mediakeys-helper.ts"),u=r("./src/utils/logger.ts");function p(){return p=Object.assign?Object.assign.bind():function(m){for(var f=1;f<arguments.length;f++){var g=arguments[f];for(var y in g)Object.prototype.hasOwnProperty.call(g,y)&&(m[y]=g[y])}return m},p.apply(this,arguments)}function b(m,f){var g=Object.keys(m);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(m);f&&(y=y.filter(function(R){return Object.getOwnPropertyDescriptor(m,R).enumerable})),g.push.apply(g,y)}return g}function l(m){for(var f=1;f<arguments.length;f++){var g=arguments[f]!=null?arguments[f]:{};f%2?b(Object(g),!0).forEach(function(y){s(m,y,g[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(g)):b(Object(g)).forEach(function(y){Object.defineProperty(m,y,Object.getOwnPropertyDescriptor(g,y))})}return m}function s(m,f,g){return f in m?Object.defineProperty(m,f,{value:g,enumerable:!0,configurable:!0,writable:!0}):m[f]=g,m}var h=l(l({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:T.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:a.default,bufferController:M.default,capLevelController:A.default,fpsController:_.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:i.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},E()),{},{subtitleStreamController:O.SubtitleStreamController,subtitleTrackController:C.default,timelineController:D.TimelineController,audioStreamController:o.default,audioTrackController:c.default,emeController:I.default,cmcdController:S.default});function E(){return{cueHandler:v.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function n(m,f){if((f.liveSyncDurationCount||f.liveMaxLatencyDurationCount)&&(f.liveSyncDuration||f.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(f.liveMaxLatencyDurationCount!==void 0&&(f.liveSyncDurationCount===void 0||f.liveMaxLatencyDurationCount<=f.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(f.liveMaxLatencyDuration!==void 0&&(f.liveSyncDuration===void 0||f.liveMaxLatencyDuration<=f.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return p({},m,f)}function d(m){var f=m.loader;if(f!==x.default&&f!==T.default)u.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),m.progressive=!1;else{var g=Object(x.fetchSupported)();g&&(m.loader=x.default,m.progressive=!0,m.enableSoftwareAES=!0,u.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(t,e,r){"use strict";r.r(e);var a=r("./src/polyfills/number.ts"),o=r("./src/utils/ewma-bandwidth-estimator.ts"),c=r("./src/events.ts"),O=r("./src/utils/buffer-helper.ts"),C=r("./src/errors.ts"),M=r("./src/types/loader.ts"),D=r("./src/utils/logger.ts");function A(S,T){for(var x=0;x<T.length;x++){var v=T[x];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(S,v.key,v)}}function _(S,T,x){return T&&A(S.prototype,T),x&&A(S,x),Object.defineProperty(S,"prototype",{writable:!1}),S}var I=function(){function S(x){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=x;var v=x.config;this.bwEstimator=new o.default(v.abrEwmaSlowVoD,v.abrEwmaFastVoD,v.abrEwmaDefaultEstimate),this.registerListeners()}var T=S.prototype;return T.registerListeners=function(){var v=this.hls;v.on(c.Events.FRAG_LOADING,this.onFragLoading,this),v.on(c.Events.FRAG_LOADED,this.onFragLoaded,this),v.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),v.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.on(c.Events.ERROR,this.onError,this)},T.unregisterListeners=function(){var v=this.hls;v.off(c.Events.FRAG_LOADING,this.onFragLoading,this),v.off(c.Events.FRAG_LOADED,this.onFragLoaded,this),v.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),v.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.off(c.Events.ERROR,this.onError,this)},T.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},T.onFragLoading=function(v,i){var u=i.frag;if(u.type===M.PlaylistLevelType.MAIN&&!this.timer){var p;this.fragCurrent=u,this.partCurrent=(p=i.part)!=null?p:null,this.timer=self.setInterval(this.onCheck,100)}},T.onLevelLoaded=function(v,i){var u=this.hls.config;i.details.live?this.bwEstimator.update(u.abrEwmaSlowLive,u.abrEwmaFastLive):this.bwEstimator.update(u.abrEwmaSlowVoD,u.abrEwmaFastVoD)},T._abandonRulesCheck=function(){var v=this.fragCurrent,i=this.partCurrent,u=this.hls,p=u.autoLevelEnabled,b=u.config,l=u.media;if(!(!v||!l)){var s=i?i.stats:v.stats,h=i?i.duration:v.duration;if(s.aborted){D.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!p||l.paused||!l.playbackRate||!l.readyState)){var E=performance.now()-s.loading.start,n=Math.abs(l.playbackRate);if(!(E<=500*h/n)){var d=u.levels,m=u.minAutoLevel,f=d[v.level],g=s.total||Math.max(s.loaded,Math.round(h*f.maxBitrate/8)),y=Math.max(1,s.bwEstimate?s.bwEstimate/8:s.loaded*1e3/E),R=(g-s.loaded)/y,L=l.currentTime,P=(O.BufferHelper.bufferInfo(l,L,b.maxBufferHole).end-L)/n;if(!(P>=2*h/n||R<=P)){var N=Number.POSITIVE_INFINITY,B;for(B=v.level-1;B>m;B--){var F=d[B].maxBitrate;if(N=h*F/(8*.8*y),N<P)break}if(!(N>=R)){var H=this.bwEstimator.getEstimate();D.logger.warn("Fragment "+v.sn+(i?" part "+i.index:"")+" of level "+v.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+B+`
      Current BW estimate: `+(Object(a.isFiniteNumber)(H)?(H/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+R.toFixed(3)+` s
      Estimated load time for the next fragment: `+N.toFixed(3)+` s
      Time to underbuffer: `+P.toFixed(3)+" s"),u.nextLoadLevel=B,this.bwEstimator.sample(E,s.loaded),this.clearTimer(),v.loader&&(this.fragCurrent=this.partCurrent=null,v.loader.abort()),u.trigger(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:v,part:i,stats:s})}}}}}},T.onFragLoaded=function(v,i){var u=i.frag,p=i.part;if(u.type===M.PlaylistLevelType.MAIN&&Object(a.isFiniteNumber)(u.sn)){var b=p?p.stats:u.stats,l=p?p.duration:u.duration;if(this.clearTimer(),this.lastLoadedFragLevel=u.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var s=this.hls.levels[u.level],h=(s.loaded?s.loaded.bytes:0)+b.loaded,E=(s.loaded?s.loaded.duration:0)+l;s.loaded={bytes:h,duration:E},s.realBitrate=Math.round(8*h/E)}if(u.bitrateTest){var n={stats:b,frag:u,part:p,id:u.type};this.onFragBuffered(c.Events.FRAG_BUFFERED,n)}}},T.onFragBuffered=function(v,i){var u=i.frag,p=i.part,b=p?p.stats:u.stats;if(!b.aborted&&!(u.type!==M.PlaylistLevelType.MAIN||u.sn==="initSegment")){var l=b.parsing.end-b.loading.start;this.bwEstimator.sample(l,b.loaded),b.bwEstimate=this.bwEstimator.getEstimate(),u.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}},T.onError=function(v,i){switch(i.details){case C.ErrorDetails.FRAG_LOAD_ERROR:case C.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}},T.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},T.getNextABRAutoLevel=function(){var v=this.fragCurrent,i=this.partCurrent,u=this.hls,p=u.maxAutoLevel,b=u.config,l=u.minAutoLevel,s=u.media,h=i?i.duration:v?v.duration:0,E=s?s.currentTime:0,n=s&&s.playbackRate!==0?Math.abs(s.playbackRate):1,d=this.bwEstimator?this.bwEstimator.getEstimate():b.abrEwmaDefaultEstimate,m=(O.BufferHelper.bufferInfo(s,E,b.maxBufferHole).end-E)/n,f=this.findBestLevel(d,l,p,m,b.abrBandWidthFactor,b.abrBandWidthUpFactor);if(f>=0)return f;D.logger.trace((m?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var g=h?Math.min(h,b.maxStarvationDelay):b.maxStarvationDelay,y=b.abrBandWidthFactor,R=b.abrBandWidthUpFactor;if(!m){var L=this.bitrateTestDelay;if(L){var P=h?Math.min(h,b.maxLoadingDelay):b.maxLoadingDelay;g=P-L,D.logger.trace("bitrate test took "+Math.round(1e3*L)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*g)+" ms"),y=R=1}}return f=this.findBestLevel(d,l,p,m+g,y,R),Math.max(f,0)},T.findBestLevel=function(v,i,u,p,b,l){for(var s,h=this.fragCurrent,E=this.partCurrent,n=this.lastLoadedFragLevel,d=this.hls.levels,m=d[n],f=!!(m!=null&&(s=m.details)!==null&&s!==void 0&&s.live),g=m==null?void 0:m.codecSet,y=E?E.duration:h?h.duration:0,R=u;R>=i;R--){var L=d[R];if(!(!L||g&&L.codecSet!==g)){var P=L.details,N=(E?P==null?void 0:P.partTarget:P==null?void 0:P.averagetargetduration)||y,B=void 0;R<=n?B=b*v:B=l*v;var F=d[R].maxBitrate,H=F*N/B;if(D.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+R+"/"+Math.round(B)+"/"+F+"/"+N+"/"+p+"/"+H),B>F&&(!H||f&&!this.bitrateTestDelay||H<p))return R}}return-1},_(S,[{key:"nextAutoLevel",get:function(){var v=this._nextAutoLevel,i=this.bwEstimator;if(v!==-1&&!i.canEstimate())return v;var u=this.getNextABRAutoLevel();return v!==-1&&this.hls.levels[u].loadError?v:(v!==-1&&(u=Math.min(v,u)),u)},set:function(v){this._nextAutoLevel=v}}]),S}();e.default=I},"./src/controller/audio-stream-controller.ts":function(t,e,r){"use strict";r.r(e);var a=r("./src/polyfills/number.ts"),o=r("./src/controller/base-stream-controller.ts"),c=r("./src/events.ts"),O=r("./src/utils/buffer-helper.ts"),C=r("./src/controller/fragment-tracker.ts"),M=r("./src/types/level.ts"),D=r("./src/types/loader.ts"),A=r("./src/loader/fragment.ts"),_=r("./src/demux/chunk-cache.ts"),I=r("./src/demux/transmuxer-interface.ts"),S=r("./src/types/transmuxer.ts"),T=r("./src/controller/fragment-finders.ts"),x=r("./src/utils/discontinuities.ts"),v=r("./src/errors.ts");function i(){return i=Object.assign?Object.assign.bind():function(s){for(var h=1;h<arguments.length;h++){var E=arguments[h];for(var n in E)Object.prototype.hasOwnProperty.call(E,n)&&(s[n]=E[n])}return s},i.apply(this,arguments)}function u(s,h){s.prototype=Object.create(h.prototype),s.prototype.constructor=s,p(s,h)}function p(s,h){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,d){return n.__proto__=d,n},p(s,h)}var b=100,l=function(s){u(h,s);function h(n,d){var m;return m=s.call(this,n,d,"[audio-stream-controller]")||this,m.videoBuffer=null,m.videoTrackCC=-1,m.waitingVideoCC=-1,m.audioSwitch=!1,m.trackId=-1,m.waitingData=null,m.mainDetails=null,m.bufferFlushed=!1,m.cachedTrackLoadedData=null,m._registerListeners(),m}var E=h.prototype;return E.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},E._registerListeners=function(){var d=this.hls;d.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),d.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),d.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.on(c.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),d.on(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),d.on(c.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),d.on(c.Events.ERROR,this.onError,this),d.on(c.Events.BUFFER_RESET,this.onBufferReset,this),d.on(c.Events.BUFFER_CREATED,this.onBufferCreated,this),d.on(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),d.on(c.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),d.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},E._unregisterListeners=function(){var d=this.hls;d.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),d.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),d.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.off(c.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),d.off(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),d.off(c.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),d.off(c.Events.ERROR,this.onError,this),d.off(c.Events.BUFFER_RESET,this.onBufferReset,this),d.off(c.Events.BUFFER_CREATED,this.onBufferCreated,this),d.off(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),d.off(c.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),d.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},E.onInitPtsFound=function(d,m){var f=m.frag,g=m.id,y=m.initPTS;if(g==="main"){var R=f.cc;this.initPTS[f.cc]=y,this.log("InitPTS for cc: "+R+" found from main: "+y),this.videoTrackCC=R,this.state===o.State.WAITING_INIT_PTS&&this.tick()}},E.startLoad=function(d){if(!this.levels){this.startPosition=d,this.state=o.State.STOPPED;return}var m=this.lastCurrentTime;this.stopLoad(),this.setInterval(b),this.fragLoadError=0,m>0&&d===-1?(this.log("Override startPosition with lastCurrentTime @"+m.toFixed(3)),d=m,this.state=o.State.IDLE):(this.loadedmetadata=!1,this.state=o.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=d,this.tick()},E.doTick=function(){switch(this.state){case o.State.IDLE:this.doTickIdle();break;case o.State.WAITING_TRACK:{var d,m=this.levels,f=this.trackId,g=m==null||(d=m[f])===null||d===void 0?void 0:d.details;if(g){if(this.waitForCdnTuneIn(g))break;this.state=o.State.WAITING_INIT_PTS}break}case o.State.FRAG_LOADING_WAITING_RETRY:{var y,R=performance.now(),L=this.retryDate;(!L||R>=L||(y=this.media)!==null&&y!==void 0&&y.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=o.State.IDLE);break}case o.State.WAITING_INIT_PTS:{var P=this.waitingData;if(P){var N=P.frag,B=P.part,F=P.cache,H=P.complete;if(this.initPTS[N.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=o.State.FRAG_LOADING;var j=F.flush(),X={frag:N,part:B,payload:j,networkDetails:null};this._handleFragmentLoadProgress(X),H&&s.prototype._handleFragmentLoadComplete.call(this,X)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+N.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var $=this.getLoadPosition(),G=O.BufferHelper.bufferInfo(this.mediaBuffer,$,this.config.maxBufferHole),J=Object(T.fragmentWithinToleranceTest)(G.end,this.config.maxFragLookUpTolerance,N);J<0&&(this.log("Waiting fragment cc ("+N.cc+") @ "+N.start+" cancelled because another fragment at "+G.end+" is needed"),this.clearWaitingFragment())}}else this.state=o.State.IDLE}}this.onTickEnd()},E.clearWaitingFragment=function(){var d=this.waitingData;d&&(this.fragmentTracker.removeFragment(d.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=o.State.IDLE)},E.resetLoadingState=function(){this.clearWaitingFragment(),s.prototype.resetLoadingState.call(this)},E.onTickEnd=function(){var d=this.media;if(!(!d||!d.readyState)){var m=this.mediaBuffer?this.mediaBuffer:d,f=m.buffered;!this.loadedmetadata&&f.length&&(this.loadedmetadata=!0),this.lastCurrentTime=d.currentTime}},E.doTickIdle=function(){var d,m,f=this.hls,g=this.levels,y=this.media,R=this.trackId,L=f.config;if(!(!g||!g[R])&&!(!y&&(this.startFragRequested||!L.startFragPrefetch))){var P=g[R],N=P.details;if(!N||N.live&&this.levelLastLoaded!==R||this.waitForCdnTuneIn(N)){this.state=o.State.WAITING_TRACK;return}var B=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&B&&(this.bufferFlushed=!1,this.afterBufferFlushed(B,A.ElementaryStreamTypes.AUDIO,D.PlaylistLevelType.AUDIO));var F=this.getFwdBufferInfo(B,D.PlaylistLevelType.AUDIO);if(F!==null){var H=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,D.PlaylistLevelType.MAIN),j=F.len,X=this.getMaxBufferLength(H==null?void 0:H.len),$=this.audioSwitch;if(!(j>=X&&!$)){if(!$&&this._streamEnded(F,N)){f.trigger(c.Events.BUFFER_EOS,{type:"audio"}),this.state=o.State.ENDED;return}var G=N.fragments,J=G[0].start,ee=F.end;if($&&y){var te=this.getLoadPosition();ee=te,N.PTSKnown&&te<J&&(F.end>J||F.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),y.currentTime=J+.05)}if(!(H&&ee>H.end+N.targetduration)&&!((!H||!H.len)&&F.len)){var oe=this.getNextFragment(ee,N);if(!oe){this.bufferFlushed=!0;return}((d=oe.decryptdata)===null||d===void 0?void 0:d.keyFormat)==="identity"&&!((m=oe.decryptdata)!==null&&m!==void 0&&m.key)?this.loadKey(oe,N):this.loadFragment(oe,N,ee)}}}}},E.getMaxBufferLength=function(d){var m=s.prototype.getMaxBufferLength.call(this);return d?Math.max(m,d):m},E.onMediaDetaching=function(){this.videoBuffer=null,s.prototype.onMediaDetaching.call(this)},E.onAudioTracksUpdated=function(d,m){var f=m.audioTracks;this.resetTransmuxer(),this.levels=f.map(function(g){return new M.Level(g)})},E.onAudioTrackSwitching=function(d,m){var f=!!m.url;this.trackId=m.id;var g=this.fragCurrent;g!=null&&g.loader&&g.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),f?this.setInterval(b):this.resetTransmuxer(),f?(this.audioSwitch=!0,this.state=o.State.IDLE):this.state=o.State.STOPPED,this.tick()},E.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},E.onLevelLoaded=function(d,m){this.mainDetails=m.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(c.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},E.onAudioTrackLoaded=function(d,m){var f;if(this.mainDetails==null){this.cachedTrackLoadedData=m;return}var g=this.levels,y=m.details,R=m.id;if(!g){this.warn("Audio tracks were reset while loading level "+R);return}this.log("Track "+R+" loaded ["+y.startSN+","+y.endSN+"],duration:"+y.totalduration);var L=g[R],P=0;if(y.live||(f=L.details)!==null&&f!==void 0&&f.live){var N=this.mainDetails;if(y.fragments[0]||(y.deltaUpdateFailed=!0),y.deltaUpdateFailed||!N)return;!L.details&&y.hasProgramDateTime&&N.hasProgramDateTime?(Object(x.alignMediaPlaylistByPDT)(y,N),P=y.fragments[0].start):P=this.alignPlaylists(y,L.details)}L.details=y,this.levelLastLoaded=R,!this.startFragRequested&&(this.mainDetails||!y.live)&&this.setStartPosition(L.details,P),this.state===o.State.WAITING_TRACK&&!this.waitForCdnTuneIn(y)&&(this.state=o.State.IDLE),this.tick()},E._handleFragmentLoadProgress=function(d){var m,f=d.frag,g=d.part,y=d.payload,R=this.config,L=this.trackId,P=this.levels;if(!P){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+f.sn+" of level "+f.level+" will not be buffered");return}var N=P[L];console.assert(N,"Audio track is defined on fragment load progress");var B=N.details;console.assert(B,"Audio track details are defined on fragment load progress");var F=R.defaultAudioCodec||N.audioCodec||"mp4a.40.2",H=this.transmuxer;H||(H=this.transmuxer=new I.default(this.hls,D.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var j=this.initPTS[f.cc],X=(m=f.initSegment)===null||m===void 0?void 0:m.data;if(j!==void 0){var $=!1,G=g?g.index:-1,J=G!==-1,ee=new S.ChunkMetadata(f.level,f.sn,f.stats.chunkCount,y.byteLength,G,J);H.push(y,X,F,"",f,g,B.totalduration,$,ee,j)}else{this.log("Unknown video PTS for cc "+f.cc+", waiting for video PTS before demuxing audio frag "+f.sn+" of ["+B.startSN+" ,"+B.endSN+"],track "+L);var te=this.waitingData=this.waitingData||{frag:f,part:g,cache:new _.default,complete:!1},oe=te.cache;oe.push(new Uint8Array(y)),this.waitingVideoCC=this.videoTrackCC,this.state=o.State.WAITING_INIT_PTS}},E._handleFragmentLoadComplete=function(d){if(this.waitingData){this.waitingData.complete=!0;return}s.prototype._handleFragmentLoadComplete.call(this,d)},E.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},E.onBufferCreated=function(d,m){var f=m.tracks.audio;f&&(this.mediaBuffer=f.buffer||null),m.tracks.video&&(this.videoBuffer=m.tracks.video.buffer||null)},E.onFragBuffered=function(d,m){var f=m.frag,g=m.part;if(f.type===D.PlaylistLevelType.AUDIO){if(this.fragContextChanged(f)){this.warn("Fragment "+f.sn+(g?" p: "+g.index:"")+" of level "+f.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}f.sn!=="initSegment"&&(this.fragPrevious=f,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(c.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(f,g)}},E.onError=function(d,m){switch(m.details){case v.ErrorDetails.FRAG_LOAD_ERROR:case v.ErrorDetails.FRAG_LOAD_TIMEOUT:case v.ErrorDetails.KEY_LOAD_ERROR:case v.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(D.PlaylistLevelType.AUDIO,m);break;case v.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case v.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==o.State.ERROR&&this.state!==o.State.STOPPED&&(this.state=m.fatal?o.State.ERROR:o.State.IDLE,this.warn(m.details+" while loading frag, switching to "+this.state+" state"));break;case v.ErrorDetails.BUFFER_FULL_ERROR:if(m.parent==="audio"&&(this.state===o.State.PARSING||this.state===o.State.PARSED)){var f=!0,g=this.getFwdBufferInfo(this.mediaBuffer,D.PlaylistLevelType.AUDIO);g&&g.len>.5&&(f=!this.reduceMaxBufferLength(g.len)),f&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,s.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break;default:break}},E.onBufferFlushed=function(d,m){var f=m.type;f===A.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},E._handleTransmuxComplete=function(d){var m,f="audio",g=this.hls,y=d.remuxResult,R=d.chunkMeta,L=this.getCurrentContext(R);if(!L){this.warn("The loading context changed while buffering fragment "+R.sn+" of level "+R.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(R.level);return}var P=L.frag,N=L.part,B=L.level.details,F=y.audio,H=y.text,j=y.id3,X=y.initSegment;if(!(this.fragContextChanged(P)||!B)){if(this.state=o.State.PARSING,this.audioSwitch&&F&&this.completeAudioSwitch(),X!=null&&X.tracks&&(this._bufferInitSegment(X.tracks,P,R),g.trigger(c.Events.FRAG_PARSING_INIT_SEGMENT,{frag:P,id:f,tracks:X.tracks})),F){var $=F.startPTS,G=F.endPTS,J=F.startDTS,ee=F.endDTS;N&&(N.elementaryStreams[A.ElementaryStreamTypes.AUDIO]={startPTS:$,endPTS:G,startDTS:J,endDTS:ee}),P.setElementaryStreamInfo(A.ElementaryStreamTypes.AUDIO,$,G,J,ee),this.bufferFragmentData(F,P,N,R)}if(j!=null&&(m=j.samples)!==null&&m!==void 0&&m.length){var te=i({id:f,frag:P,details:B},j);g.trigger(c.Events.FRAG_PARSING_METADATA,te)}if(H){var oe=i({id:f,frag:P,details:B},H);g.trigger(c.Events.FRAG_PARSING_USERDATA,oe)}}},E._bufferInitSegment=function(d,m,f){if(this.state===o.State.PARSING){d.video&&delete d.video;var g=d.audio;if(!!g){g.levelCodec=g.codec,g.id="audio",this.log("Init audio buffer, container:"+g.container+", codecs[parsed]=["+g.codec+"]"),this.hls.trigger(c.Events.BUFFER_CODECS,d);var y=g.initSegment;if(y!=null&&y.byteLength){var R={type:"audio",frag:m,part:null,chunkMeta:f,parent:m.type,data:y};this.hls.trigger(c.Events.BUFFER_APPENDING,R)}this.tick()}}},E.loadFragment=function(d,m,f){var g=this.fragmentTracker.getState(d);this.fragCurrent=d,(this.audioSwitch||g===C.FragmentState.NOT_LOADED||g===C.FragmentState.PARTIAL)&&(d.sn==="initSegment"?this._loadInitSegment(d):m.live&&!Object(a.isFiniteNumber)(this.initPTS[d.cc])?(this.log("Waiting for video PTS in continuity counter "+d.cc+" of live stream before loading audio fragment "+d.sn+" of level "+this.trackId),this.state=o.State.WAITING_INIT_PTS):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,d,m,f)))},E.completeAudioSwitch=function(){var d=this.hls,m=this.media,f=this.trackId;m&&(this.log("Switching audio track : flushing all audio"),s.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,d.trigger(c.Events.AUDIO_TRACK_SWITCHED,{id:f})},h}(o.default);e.default=l},"./src/controller/audio-track-controller.ts":function(t,e,r){"use strict";r.r(e);var a=r("./src/events.ts"),o=r("./src/errors.ts"),c=r("./src/controller/base-playlist-controller.ts"),O=r("./src/types/loader.ts");function C(I,S){for(var T=0;T<S.length;T++){var x=S[T];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(I,x.key,x)}}function M(I,S,T){return S&&C(I.prototype,S),T&&C(I,T),Object.defineProperty(I,"prototype",{writable:!1}),I}function D(I,S){I.prototype=Object.create(S.prototype),I.prototype.constructor=I,A(I,S)}function A(I,S){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(x,v){return x.__proto__=v,x},A(I,S)}var _=function(I){D(S,I);function S(x){var v;return v=I.call(this,x,"[audio-track-controller]")||this,v.tracks=[],v.groupId=null,v.tracksInGroup=[],v.trackId=-1,v.trackName="",v.selectDefaultTrack=!0,v.registerListeners(),v}var T=S.prototype;return T.registerListeners=function(){var v=this.hls;v.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),v.on(a.Events.LEVEL_LOADING,this.onLevelLoading,this),v.on(a.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),v.on(a.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),v.on(a.Events.ERROR,this.onError,this)},T.unregisterListeners=function(){var v=this.hls;v.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.off(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),v.off(a.Events.LEVEL_LOADING,this.onLevelLoading,this),v.off(a.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),v.off(a.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),v.off(a.Events.ERROR,this.onError,this)},T.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,I.prototype.destroy.call(this)},T.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},T.onManifestParsed=function(v,i){this.tracks=i.audioTracks||[]},T.onAudioTrackLoaded=function(v,i){var u=i.id,p=i.details,b=this.tracksInGroup[u];if(!b){this.warn("Invalid audio track id "+u);return}var l=b.details;b.details=i.details,this.log("audioTrack "+u+" loaded ["+p.startSN+"-"+p.endSN+"]"),u===this.trackId&&(this.retryCount=0,this.playlistLoaded(u,i,l))},T.onLevelLoading=function(v,i){this.switchLevel(i.level)},T.onLevelSwitching=function(v,i){this.switchLevel(i.level)},T.switchLevel=function(v){var i=this.hls.levels[v];if(!!(i!=null&&i.audioGroupIds)){var u=i.audioGroupIds[i.urlId];if(this.groupId!==u){this.groupId=u;var p=this.tracks.filter(function(l){return!u||l.groupId===u});this.selectDefaultTrack&&!p.some(function(l){return l.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=p;var b={audioTracks:p};this.log("Updating audio tracks, "+p.length+' track(s) found in "'+u+'" group-id'),this.hls.trigger(a.Events.AUDIO_TRACKS_UPDATED,b),this.selectInitialTrack()}}},T.onError=function(v,i){I.prototype.onError.call(this,v,i),!(i.fatal||!i.context)&&i.context.type===O.PlaylistContextType.AUDIO_TRACK&&i.context.id===this.trackId&&i.context.groupId===this.groupId&&this.retryLoadingOrFail(i)},T.setAudioTrack=function(v){var i=this.tracksInGroup;if(v<0||v>=i.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var u=i[this.trackId];this.log("Now switching to audio-track index "+v);var p=i[v],b=p.id,l=p.groupId,s=l===void 0?"":l,h=p.name,E=p.type,n=p.url;if(this.trackId=v,this.trackName=h,this.selectDefaultTrack=!1,this.hls.trigger(a.Events.AUDIO_TRACK_SWITCHING,{id:b,groupId:s,name:h,type:E,url:n}),!(p.details&&!p.details.live)){var d=this.switchParams(p.url,u==null?void 0:u.details);this.loadPlaylist(d)}},T.selectInitialTrack=function(){var v=this.tracksInGroup;console.assert(v.length,"Initial audio track should be selected when tracks are known");var i=this.trackName,u=this.findTrackId(i)||this.findTrackId();u!==-1?this.setAudioTrack(u):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(a.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},T.findTrackId=function(v){for(var i=this.tracksInGroup,u=0;u<i.length;u++){var p=i[u];if((!this.selectDefaultTrack||p.default)&&(!v||v===p.name))return p.id}return-1},T.loadPlaylist=function(v){var i=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(i)){var u=i.id,p=i.groupId,b=i.url;if(v)try{b=v.addDirectives(b)}catch(l){this.warn("Could not construct new URL with HLS Delivery Directives: "+l)}this.log("loading audio-track playlist for id: "+u),this.clearTimer(),this.hls.trigger(a.Events.AUDIO_TRACK_LOADING,{url:b,id:u,groupId:p,deliveryDirectives:v||null})}},M(S,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(v){this.selectDefaultTrack=!1,this.setAudioTrack(v)}}]),S}(c.default);e.default=_},"./src/controller/base-playlist-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return M});var a=r("./src/polyfills/number.ts"),o=r("./src/types/level.ts"),c=r("./src/controller/level-helper.ts"),O=r("./src/utils/logger.ts"),C=r("./src/errors.ts"),M=function(){function D(_,I){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=O.logger.log.bind(O.logger,I+":"),this.warn=O.logger.warn.bind(O.logger,I+":"),this.hls=_}var A=D.prototype;return A.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},A.onError=function(I,S){S.fatal&&S.type===C.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},A.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},A.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},A.stopLoad=function(){this.canLoad=!1,this.clearTimer()},A.switchParams=function(I,S){var T=S==null?void 0:S.renditionReports;if(T)for(var x=0;x<T.length;x++){var v=T[x],i=""+v.URI;if(i===I.slice(-i.length)){var u=parseInt(v["LAST-MSN"]),p=parseInt(v["LAST-PART"]);if(S&&this.hls.config.lowLatencyMode){var b=Math.min(S.age-S.partTarget,S.targetduration);p!==void 0&&b>S.partTarget&&(p+=1)}if(Object(a.isFiniteNumber)(u))return new o.HlsUrlParameters(u,Object(a.isFiniteNumber)(p)?p:void 0,o.HlsSkip.No)}}},A.loadPlaylist=function(I){},A.shouldLoadTrack=function(I){return this.canLoad&&I&&!!I.url&&(!I.details||I.details.live)},A.playlistLoaded=function(I,S,T){var x=this,v=S.details,i=S.stats,u=i.loading.end?Math.max(0,self.performance.now()-i.loading.end):0;if(v.advancedDateTime=Date.now()-u,v.live||T!=null&&T.live){if(v.reloaded(T),T&&this.log("live playlist "+I+" "+(v.advanced?"REFRESHED "+v.lastPartSn+"-"+v.lastPartIndex:"MISSED")),T&&v.fragments.length>0&&Object(c.mergeDetails)(T,v),!this.canLoad||!v.live)return;var p,b=void 0,l=void 0;if(v.canBlockReload&&v.endSN&&v.advanced){var s=this.hls.config.lowLatencyMode,h=v.lastPartSn,E=v.endSN,n=v.lastPartIndex,d=n!==-1,m=h===E,f=s?0:n;d?(b=m?E+1:h,l=m?f:n+1):b=E+1;var g=v.age,y=g+v.ageHeader,R=Math.min(y-v.partTarget,v.targetduration*1.5);if(R>0){if(T&&R>T.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+T.tuneInGoal+" to: "+R+" with playlist age: "+v.age),R=0;else{var L=Math.floor(R/v.targetduration);if(b+=L,l!==void 0){var P=Math.round(R%v.targetduration/v.partTarget);l+=P}this.log("CDN Tune-in age: "+v.ageHeader+"s last advanced "+g.toFixed(2)+"s goal: "+R+" skip sn "+L+" to part "+l)}v.tuneInGoal=R}if(p=this.getDeliveryDirectives(v,S.deliveryDirectives,b,l),s||!m){this.loadPlaylist(p);return}}else p=this.getDeliveryDirectives(v,S.deliveryDirectives,b,l);var N=Object(c.computeReloadInterval)(v,i);b!==void 0&&v.canBlockReload&&(N-=v.partTarget||1),this.log("reload live playlist "+I+" in "+Math.round(N)+" ms"),this.timer=self.setTimeout(function(){return x.loadPlaylist(p)},N)}else this.clearTimer()},A.getDeliveryDirectives=function(I,S,T,x){var v=Object(o.getSkipValue)(I,T);return S!=null&&S.skip&&I.deltaUpdateFailed&&(T=S.msn,x=S.part,v=o.HlsSkip.No),new o.HlsUrlParameters(T,x,v)},A.retryLoadingOrFail=function(I){var S=this,T=this.hls.config,x=this.retryCount<T.levelLoadingMaxRetry;if(x){var v;if(this.retryCount++,I.details.indexOf("LoadTimeOut")>-1&&(v=I.context)!==null&&v!==void 0&&v.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+I.details+'"'),this.loadPlaylist();else{var i=Math.min(Math.pow(2,this.retryCount)*T.levelLoadingRetryDelay,T.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return S.loadPlaylist()},i),this.warn("retry playlist loading #"+this.retryCount+" in "+i+' ms after "'+I.details+'"')}}else this.warn('cannot recover from error "'+I.details+'"'),this.clearTimer(),I.fatal=!0;return x},D}()},"./src/controller/base-stream-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"State",function(){return E}),r.d(e,"default",function(){return n});var a=r("./src/polyfills/number.ts"),o=r("./src/task-loop.ts"),c=r("./src/controller/fragment-tracker.ts"),O=r("./src/utils/buffer-helper.ts"),C=r("./src/utils/logger.ts"),M=r("./src/events.ts"),D=r("./src/errors.ts"),A=r("./src/types/transmuxer.ts"),_=r("./src/utils/mp4-tools.ts"),I=r("./src/utils/discontinuities.ts"),S=r("./src/controller/fragment-finders.ts"),T=r("./src/controller/level-helper.ts"),x=r("./src/loader/fragment-loader.ts"),v=r("./src/crypt/decrypter.ts"),i=r("./src/utils/time-ranges.ts"),u=r("./src/types/loader.ts");function p(d,m){for(var f=0;f<m.length;f++){var g=m[f];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(d,g.key,g)}}function b(d,m,f){return m&&p(d.prototype,m),f&&p(d,f),Object.defineProperty(d,"prototype",{writable:!1}),d}function l(d){if(d===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d}function s(d,m){d.prototype=Object.create(m.prototype),d.prototype.constructor=d,h(d,m)}function h(d,m){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,y){return g.__proto__=y,g},h(d,m)}var E={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},n=function(d){s(m,d);function m(g,y,R){var L;return L=d.call(this)||this,L.hls=void 0,L.fragPrevious=null,L.fragCurrent=null,L.fragmentTracker=void 0,L.transmuxer=null,L._state=E.STOPPED,L.media=null,L.mediaBuffer=null,L.config=void 0,L.bitrateTest=!1,L.lastCurrentTime=0,L.nextLoadPosition=0,L.startPosition=0,L.loadedmetadata=!1,L.fragLoadError=0,L.retryDate=0,L.levels=null,L.fragmentLoader=void 0,L.levelLastLoaded=null,L.startFragRequested=!1,L.decrypter=void 0,L.initPTS=[],L.onvseeking=null,L.onvended=null,L.logPrefix="",L.log=void 0,L.warn=void 0,L.logPrefix=R,L.log=C.logger.log.bind(C.logger,R+":"),L.warn=C.logger.warn.bind(C.logger,R+":"),L.hls=g,L.fragmentLoader=new x.default(g.config),L.fragmentTracker=y,L.config=g.config,L.decrypter=new v.default(g,g.config),g.on(M.Events.KEY_LOADED,L.onKeyLoaded,l(L)),g.on(M.Events.LEVEL_SWITCHING,L.onLevelSwitching,l(L)),L}var f=m.prototype;return f.doTick=function(){this.onTickEnd()},f.onTickEnd=function(){},f.startLoad=function(y){},f.stopLoad=function(){this.fragmentLoader.abort();var y=this.fragCurrent;y&&this.fragmentTracker.removeFragment(y),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=E.STOPPED},f._streamEnded=function(y,R){var L=this.fragCurrent,P=this.fragmentTracker;if(!R.live&&L&&this.media&&L.sn>=R.endSN&&!y.nextStart){var N=R.partList;if(N!=null&&N.length){var B=N[N.length-1],F=O.BufferHelper.isBuffered(this.media,B.start+B.duration/2);return F}var H=P.getState(L);return H===c.FragmentState.PARTIAL||H===c.FragmentState.OK}return!1},f.onMediaAttached=function(y,R){var L=this.media=this.mediaBuffer=R.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),L.addEventListener("seeking",this.onvseeking),L.addEventListener("ended",this.onvended);var P=this.config;this.levels&&P.autoStartLoad&&this.state===E.STOPPED&&this.startLoad(P.startPosition)},f.onMediaDetaching=function(){var y=this.media;y!=null&&y.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),y&&this.onvseeking&&this.onvended&&(y.removeEventListener("seeking",this.onvseeking),y.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},f.onMediaSeeking=function(){var y=this.config,R=this.fragCurrent,L=this.media,P=this.mediaBuffer,N=this.state,B=L?L.currentTime:0,F=O.BufferHelper.bufferInfo(P||L,B,y.maxBufferHole);if(this.log("media seeking to "+(Object(a.isFiniteNumber)(B)?B.toFixed(3):B)+", state: "+N),N===E.ENDED)this.resetLoadingState();else if(R&&!F.len){var H=y.maxFragLookUpTolerance,j=R.start-H,X=R.start+R.duration+H,$=B>X;(B<j||$)&&($&&R.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),R.loader.abort()),this.resetLoadingState())}L&&(this.lastCurrentTime=B),!this.loadedmetadata&&!F.len&&(this.nextLoadPosition=this.startPosition=B),this.tickImmediate()},f.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},f.onKeyLoaded=function(y,R){if(!(this.state!==E.KEY_LOADING||R.frag!==this.fragCurrent||!this.levels)){this.state=E.IDLE;var L=this.levels[R.frag.level].details;L&&this.loadFragment(R.frag,L,R.frag.start)}},f.onLevelSwitching=function(y,R){this.fragLoadError=0},f.onHandlerDestroying=function(){this.stopLoad(),d.prototype.onHandlerDestroying.call(this)},f.onHandlerDestroyed=function(){this.state=E.STOPPED,this.hls.off(M.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,d.prototype.onHandlerDestroyed.call(this)},f.loadKey=function(y,R){this.log("Loading key for "+y.sn+" of ["+R.startSN+"-"+R.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+y.level),this.state=E.KEY_LOADING,this.fragCurrent=y,this.hls.trigger(M.Events.KEY_LOADING,{frag:y})},f.loadFragment=function(y,R,L){this._loadFragForPlayback(y,R,L)},f._loadFragForPlayback=function(y,R,L){var P=this,N=function(F){if(P.fragContextChanged(y)){P.warn("Fragment "+y.sn+(F.part?" p: "+F.part.index:"")+" of level "+y.level+" was dropped during download."),P.fragmentTracker.removeFragment(y);return}y.stats.chunkCount++,P._handleFragmentLoadProgress(F)};this._doFragLoad(y,R,L,N).then(function(B){if(!!B){P.fragLoadError=0;var F=P.state;if(P.fragContextChanged(y)){(F===E.FRAG_LOADING||!P.fragCurrent&&F===E.PARSING)&&(P.fragmentTracker.removeFragment(y),P.state=E.IDLE);return}"payload"in B&&(P.log("Loaded fragment "+y.sn+" of level "+y.level),P.hls.trigger(M.Events.FRAG_LOADED,B)),P._handleFragmentLoadComplete(B)}}).catch(function(B){P.state===E.STOPPED||P.state===E.ERROR||(P.warn(B),P.resetFragmentLoading(y))})},f.flushMainBuffer=function(y,R,L){if(L===void 0&&(L=null),!!(y-R)){var P={startOffset:y,endOffset:R,type:L};this.fragLoadError=0,this.hls.trigger(M.Events.BUFFER_FLUSHING,P)}},f._loadInitSegment=function(y){var R=this;this._doFragLoad(y).then(function(L){if(!L||R.fragContextChanged(y)||!R.levels)throw new Error("init load aborted");return L}).then(function(L){var P=R.hls,N=L.payload,B=y.decryptdata;if(N&&N.byteLength>0&&B&&B.key&&B.iv&&B.method==="AES-128"){var F=self.performance.now();return R.decrypter.webCryptoDecrypt(new Uint8Array(N),B.key.buffer,B.iv.buffer).then(function(H){var j=self.performance.now();return P.trigger(M.Events.FRAG_DECRYPTED,{frag:y,payload:H,stats:{tstart:F,tdecrypt:j}}),L.payload=H,L})}return L}).then(function(L){var P=R.fragCurrent,N=R.hls,B=R.levels;if(!B)throw new Error("init load aborted, missing levels");var F=B[y.level].details;console.assert(F,"Level details are defined when init segment is loaded");var H=y.stats;R.state=E.IDLE,R.fragLoadError=0,y.data=new Uint8Array(L.payload),H.parsing.start=H.buffering.start=self.performance.now(),H.parsing.end=H.buffering.end=self.performance.now(),L.frag===P&&N.trigger(M.Events.FRAG_BUFFERED,{stats:H,frag:P,part:null,id:y.type}),R.tick()}).catch(function(L){R.state===E.STOPPED||R.state===E.ERROR||(R.warn(L),R.resetFragmentLoading(y))})},f.fragContextChanged=function(y){var R=this.fragCurrent;return!y||!R||y.level!==R.level||y.sn!==R.sn||y.urlId!==R.urlId},f.fragBufferedComplete=function(y,R){var L=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+y.type+" sn: "+y.sn+(R?" part: "+R.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+y.level+" "+(L?i.default.toString(O.BufferHelper.getBuffered(L)):"(detached)")),this.state=E.IDLE,L&&(!this.loadedmetadata&&L.buffered.length&&this.fragCurrent===this.fragPrevious&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},f.seekToStartPos=function(){},f._handleFragmentLoadComplete=function(y){var R=this.transmuxer;if(!!R){var L=y.frag,P=y.part,N=y.partsLoaded,B=!N||N.length===0||N.some(function(H){return!H}),F=new A.ChunkMetadata(L.level,L.sn,L.stats.chunkCount+1,0,P?P.index:-1,!B);R.flush(F)}},f._handleFragmentLoadProgress=function(y){},f._doFragLoad=function(y,R,L,P){var N=this;if(L===void 0&&(L=null),!this.levels)throw new Error("frag load aborted, missing levels");if(L=Math.max(y.start,L||0),this.config.lowLatencyMode&&R){var B=R.partList;if(B&&P){L>y.end&&R.fragmentHint&&(y=R.fragmentHint);var F=this.getNextPart(B,y,L);if(F>-1){var H=B[F];return this.log("Loading part sn: "+y.sn+" p: "+H.index+" cc: "+y.cc+" of playlist ["+R.startSN+"-"+R.endSN+"] parts [0-"+F+"-"+(B.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+y.level+", target: "+parseFloat(L.toFixed(3))),this.nextLoadPosition=H.start+H.duration,this.state=E.FRAG_LOADING,this.hls.trigger(M.Events.FRAG_LOADING,{frag:y,part:B[F],targetBufferTime:L}),this.doFragPartsLoad(y,B,F,P).catch(function(j){return N.handleFragLoadError(j)})}else if(!y.url||this.loadedEndOfParts(B,L))return Promise.resolve(null)}}return this.log("Loading fragment "+y.sn+" cc: "+y.cc+" "+(R?"of ["+R.startSN+"-"+R.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+y.level+", target: "+parseFloat(L.toFixed(3))),Object(a.isFiniteNumber)(y.sn)&&!this.bitrateTest&&(this.nextLoadPosition=y.start+y.duration),this.state=E.FRAG_LOADING,this.hls.trigger(M.Events.FRAG_LOADING,{frag:y,targetBufferTime:L}),this.fragmentLoader.load(y,P).catch(function(j){return N.handleFragLoadError(j)})},f.doFragPartsLoad=function(y,R,L,P){var N=this;return new Promise(function(B,F){var H=[],j=function X($){var G=R[$];N.fragmentLoader.loadPart(y,G,P).then(function(J){H[G.index]=J;var ee=J.part;N.hls.trigger(M.Events.FRAG_LOADED,J);var te=R[$+1];if(te&&te.fragment===y)X($+1);else return B({frag:y,part:ee,partsLoaded:H})}).catch(F)};j(L)})},f.handleFragLoadError=function(y){var R=y.data;return R&&R.details===D.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(R.frag,R.part):this.hls.trigger(M.Events.ERROR,R),null},f._handleTransmuxerFlush=function(y){var R=this.getCurrentContext(y);if(!R||this.state!==E.PARSING){this.fragCurrent||(this.state=E.IDLE);return}var L=R.frag,P=R.part,N=R.level,B=self.performance.now();L.stats.parsing.end=B,P&&(P.stats.parsing.end=B),this.updateLevelTiming(L,P,N,y.partial)},f.getCurrentContext=function(y){var R=this.levels,L=y.level,P=y.sn,N=y.part;if(!R||!R[L])return this.warn("Levels object was unset while buffering fragment "+P+" of level "+L+". The current chunk will not be buffered."),null;var B=R[L],F=N>-1?Object(T.getPartWith)(B,P,N):null,H=F?F.fragment:Object(T.getFragmentWithSN)(B,P,this.fragCurrent);return H?{frag:H,part:F,level:B}:null},f.bufferFragmentData=function(y,R,L,P){if(!(!y||this.state!==E.PARSING)){var N=y.data1,B=y.data2,F=N;if(N&&B&&(F=Object(_.appendUint8Array)(N,B)),!(!F||!F.length)){var H={type:y.type,frag:R,part:L,chunkMeta:P,parent:R.type,data:F};this.hls.trigger(M.Events.BUFFER_APPENDING,H),y.dropped&&y.independent&&!L&&this.flushBufferGap(R)}}},f.flushBufferGap=function(y){var R=this.media;if(!!R){if(!O.BufferHelper.isBuffered(R,R.currentTime)){this.flushMainBuffer(0,y.start);return}var L=R.currentTime,P=O.BufferHelper.bufferInfo(R,L,0),N=y.duration,B=Math.min(this.config.maxFragLookUpTolerance*2,N*.25),F=Math.max(Math.min(y.start-B,P.end-B),L+B);y.start-F>B&&this.flushMainBuffer(F,y.start)}},f.getFwdBufferInfo=function(y,R){var L=this.config,P=this.getLoadPosition();if(!Object(a.isFiniteNumber)(P))return null;var N=O.BufferHelper.bufferInfo(y,P,L.maxBufferHole);if(N.len===0&&N.nextStart!==void 0){var B=this.fragmentTracker.getBufferedFrag(P,R);if(B&&N.nextStart<B.end)return O.BufferHelper.bufferInfo(y,P,Math.max(N.nextStart,L.maxBufferHole))}return N},f.getMaxBufferLength=function(y){var R=this.config,L;return y?L=Math.max(8*R.maxBufferSize/y,R.maxBufferLength):L=R.maxBufferLength,Math.min(L,R.maxMaxBufferLength)},f.reduceMaxBufferLength=function(y){var R=this.config,L=y||R.maxBufferLength;return R.maxMaxBufferLength>=L?(R.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+R.maxMaxBufferLength+"s"),!0):!1},f.getNextFragment=function(y,R){var L=R.fragments,P=L.length;if(!P)return null;var N=this.config,B=L[0].start,F;if(R.live){var H=N.initialLiveManifestSize;if(P<H)return this.warn("Not enough fragments to start playback (have: "+P+", need: "+H+")"),null;!R.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(F=this.getInitialLiveFragment(R,L),this.startPosition=F?this.hls.liveSyncPosition||F.start:y)}else y<=B&&(F=L[0]);if(!F){var j=N.lowLatencyMode?R.partEnd:R.fragmentEnd;F=this.getFragmentAtPosition(y,j,R)}return this.mapToInitFragWhenRequired(F)},f.mapToInitFragWhenRequired=function(y){return y!=null&&y.initSegment&&!(y!=null&&y.initSegment.data)&&!this.bitrateTest?y.initSegment:y},f.getNextPart=function(y,R,L){for(var P=-1,N=!1,B=!0,F=0,H=y.length;F<H;F++){var j=y[F];if(B=B&&!j.independent,P>-1&&L<j.start)break;var X=j.loaded;!X&&(N||j.independent||B)&&j.fragment===R&&(P=F),N=X}return P},f.loadedEndOfParts=function(y,R){var L=y[y.length-1];return L&&R>L.start&&L.loaded},f.getInitialLiveFragment=function(y,R){var L=this.fragPrevious,P=null;if(L){if(y.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+L.programDateTime),P=Object(S.findFragmentByPDT)(R,L.endProgramDateTime,this.config.maxFragLookUpTolerance)),!P){var N=L.sn+1;if(N>=y.startSN&&N<=y.endSN){var B=R[N-y.startSN];L.cc===B.cc&&(P=B,this.log("Live playlist, switching playlist, load frag with next SN: "+P.sn))}P||(P=Object(S.findFragWithCC)(R,L.cc),P&&this.log("Live playlist, switching playlist, load frag with same CC: "+P.sn))}}else{var F=this.hls.liveSyncPosition;F!==null&&(P=this.getFragmentAtPosition(F,this.bitrateTest?y.fragmentEnd:y.edge,y))}return P},f.getFragmentAtPosition=function(y,R,L){var P=this.config,N=this.fragPrevious,B=L.fragments,F=L.endSN,H=L.fragmentHint,j=P.maxFragLookUpTolerance,X=!!(P.lowLatencyMode&&L.partList&&H);X&&H&&!this.bitrateTest&&(B=B.concat(H),F=H.sn);var $;if(y<R){var G=y>R-j?0:j;$=Object(S.findFragmentByPTS)(N,B,y,G)}else $=B[B.length-1];if($){var J=$.sn-L.startSN;if(N&&$.sn===N.sn&&!X){var ee=N&&$.level===N.level;if(ee){var te=B[J+1];$.sn<F&&this.fragmentTracker.getState(te)!==c.FragmentState.OK?(this.log("SN "+$.sn+" just loaded, load next one: "+te.sn),$=te):$=null}}}return $},f.synchronizeToLiveEdge=function(y){var R=this.config,L=this.media;if(!!L){var P=this.hls.liveSyncPosition,N=L.currentTime,B=y.fragments[0].start,F=y.edge,H=N>=B-R.maxFragLookUpTolerance&&N<=F;if(P!==null&&L.duration>P&&(N<P||!H)){var j=R.liveMaxLatencyDuration!==void 0?R.liveMaxLatencyDuration:R.liveMaxLatencyDurationCount*y.targetduration;(!H&&L.readyState<4||N<F-j)&&(this.loadedmetadata||(this.nextLoadPosition=P),L.readyState&&(this.warn("Playback: "+N.toFixed(3)+" is located too far from the end of live sliding playlist: "+F+", reset currentTime to : "+P.toFixed(3)),L.currentTime=P))}}},f.alignPlaylists=function(y,R){var L=this.levels,P=this.levelLastLoaded,N=this.fragPrevious,B=P!==null?L[P]:null,F=y.fragments.length;if(!F)return this.warn("No fragments in live playlist"),0;var H=y.fragments[0].start,j=!R,X=y.alignedSliding&&Object(a.isFiniteNumber)(H);if(j||!X&&!H){Object(I.alignStream)(N,B,y);var $=y.fragments[0].start;return this.log("Live playlist sliding: "+$.toFixed(2)+" start-sn: "+(R?R.startSN:"na")+"->"+y.startSN+" prev-sn: "+(N?N.sn:"na")+" fragments: "+F),$}return H},f.waitForCdnTuneIn=function(y){var R=3;return y.live&&y.canBlockReload&&y.partTarget&&y.tuneInGoal>Math.max(y.partHoldBack,y.partTarget*R)},f.setStartPosition=function(y,R){var L=this.startPosition;if(L<R&&(L=-1),L===-1||this.lastCurrentTime===-1){var P=y.startTimeOffset;Object(a.isFiniteNumber)(P)?(L=R+P,P<0&&(L+=y.totalduration),L=Math.min(Math.max(R,L),R+y.totalduration),this.log("Start time offset "+P+" found in playlist, adjust startPosition to "+L),this.startPosition=L):y.live?L=this.hls.liveSyncPosition||R:this.startPosition=L=0,this.lastCurrentTime=L}this.nextLoadPosition=L},f.getLoadPosition=function(){var y=this.media,R=0;return this.loadedmetadata&&y?R=y.currentTime:this.nextLoadPosition&&(R=this.nextLoadPosition),R},f.handleFragLoadAborted=function(y,R){this.transmuxer&&y.sn!=="initSegment"&&y.stats.aborted&&(this.warn("Fragment "+y.sn+(R?" part"+R.index:"")+" of level "+y.level+" was aborted"),this.resetFragmentLoading(y))},f.resetFragmentLoading=function(y){(!this.fragCurrent||!this.fragContextChanged(y)&&this.state!==E.FRAG_LOADING_WAITING_RETRY)&&(this.state=E.IDLE)},f.onFragmentOrKeyLoadError=function(y,R){if(!R.fatal){var L=R.frag;if(!(!L||L.type!==y)){var P=this.fragCurrent;console.assert(P&&L.sn===P.sn&&L.level===P.level&&L.urlId===P.urlId,"Frag load error must match current frag to retry");var N=this.config;if(this.fragLoadError+1<=N.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var B=Math.min(Math.pow(2,this.fragLoadError)*N.fragLoadingRetryDelay,N.fragLoadingMaxRetryTimeout);this.warn("Fragment "+L.sn+" of "+y+" "+L.level+" failed to load, retrying in "+B+"ms"),this.retryDate=self.performance.now()+B,this.fragLoadError++,this.state=E.FRAG_LOADING_WAITING_RETRY}else R.levelRetry?(y===u.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=E.IDLE):(C.logger.error(R.details+" reaches max retry, redispatch as fatal ..."),R.fatal=!0,this.hls.stopLoad(),this.state=E.ERROR)}}},f.afterBufferFlushed=function(y,R,L){if(!!y){var P=O.BufferHelper.getBuffered(y);this.fragmentTracker.detectEvictedFragments(R,P,L),this.state===E.ENDED&&this.resetLoadingState()}},f.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=E.IDLE},f.resetStartWhenNotLoaded=function(y){if(!this.loadedmetadata){this.startFragRequested=!1;var R=this.levels?this.levels[y].details:null;R!=null&&R.live?(this.startPosition=-1,this.setStartPosition(R,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},f.updateLevelTiming=function(y,R,L,P){var N=this,B=L.details;console.assert(!!B,"level.details must be defined");var F=Object.keys(y.elementaryStreams).reduce(function(H,j){var X=y.elementaryStreams[j];if(X){var $=X.endPTS-X.startPTS;if($<=0)return N.warn("Could not parse fragment "+y.sn+" "+j+" duration reliably ("+$+")"),H||!1;var G=P?0:Object(T.updateFragPTSDTS)(B,y,X.startPTS,X.endPTS,X.startDTS,X.endDTS);return N.hls.trigger(M.Events.LEVEL_PTS_UPDATED,{details:B,level:L,drift:G,type:j,frag:y,start:X.startPTS,end:X.endPTS}),!0}return H},!1);F||(this.warn("Found no media in fragment "+y.sn+" of level "+L.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=E.PARSED,this.hls.trigger(M.Events.FRAG_PARSED,{frag:y,part:R})},f.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},b(m,[{key:"state",get:function(){return this._state},set:function(y){var R=this._state;R!==y&&(this._state=y,this.log(R+"->"+y))}}]),m}(o.default)},"./src/controller/buffer-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return S});var a=r("./src/polyfills/number.ts"),o=r("./src/events.ts"),c=r("./src/utils/logger.ts"),O=r("./src/errors.ts"),C=r("./src/utils/buffer-helper.ts"),M=r("./src/utils/mediasource-helper.ts"),D=r("./src/loader/fragment.ts"),A=r("./src/controller/buffer-operation-queue.ts"),_=Object(M.getMediaSource)(),I=/([ha]vc.)(?:\.[^.,]+)+/,S=function(){function T(v){var i=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var u=i.hls,p=i.media,b=i.mediaSource;c.logger.log("[buffer-controller]: Media source opened"),p&&(i.updateMediaElementDuration(),u.trigger(o.Events.MEDIA_ATTACHED,{media:p})),b&&b.removeEventListener("sourceopen",i._onMediaSourceOpen),i.checkPendingTracks()},this._onMediaSourceClose=function(){c.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){c.logger.log("[buffer-controller]: Media source ended")},this.hls=v,this._initSourceBuffer(),this.registerListeners()}var x=T.prototype;return x.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},x.destroy=function(){this.unregisterListeners(),this.details=null},x.registerListeners=function(){var i=this.hls;i.on(o.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(o.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(o.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(o.Events.BUFFER_RESET,this.onBufferReset,this),i.on(o.Events.BUFFER_APPENDING,this.onBufferAppending,this),i.on(o.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.on(o.Events.BUFFER_EOS,this.onBufferEos,this),i.on(o.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.on(o.Events.LEVEL_UPDATED,this.onLevelUpdated,this),i.on(o.Events.FRAG_PARSED,this.onFragParsed,this),i.on(o.Events.FRAG_CHANGED,this.onFragChanged,this)},x.unregisterListeners=function(){var i=this.hls;i.off(o.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(o.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(o.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(o.Events.BUFFER_RESET,this.onBufferReset,this),i.off(o.Events.BUFFER_APPENDING,this.onBufferAppending,this),i.off(o.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.off(o.Events.BUFFER_EOS,this.onBufferEos,this),i.off(o.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.off(o.Events.LEVEL_UPDATED,this.onLevelUpdated,this),i.off(o.Events.FRAG_PARSED,this.onFragParsed,this),i.off(o.Events.FRAG_CHANGED,this.onFragChanged,this)},x._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new A.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},x.onManifestParsed=function(i,u){var p=2;(u.audio&&!u.video||!u.altAudio)&&(p=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=p,this.details=null,c.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},x.onMediaAttaching=function(i,u){var p=this.media=u.media;if(p&&_){var b=this.mediaSource=new _;b.addEventListener("sourceopen",this._onMediaSourceOpen),b.addEventListener("sourceended",this._onMediaSourceEnded),b.addEventListener("sourceclose",this._onMediaSourceClose),p.src=self.URL.createObjectURL(b),this._objectUrl=p.src}},x.onMediaDetaching=function(){var i=this.media,u=this.mediaSource,p=this._objectUrl;if(u){if(c.logger.log("[buffer-controller]: media source detaching"),u.readyState==="open")try{u.endOfStream()}catch(b){c.logger.warn("[buffer-controller]: onMediaDetaching: "+b.message+" while calling endOfStream")}this.onBufferReset(),u.removeEventListener("sourceopen",this._onMediaSourceOpen),u.removeEventListener("sourceended",this._onMediaSourceEnded),u.removeEventListener("sourceclose",this._onMediaSourceClose),i&&(p&&self.URL.revokeObjectURL(p),i.src===p?(i.removeAttribute("src"),i.load()):c.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(o.Events.MEDIA_DETACHED,void 0)},x.onBufferReset=function(){var i=this;this.getSourceBufferTypes().forEach(function(u){var p=i.sourceBuffer[u];try{p&&(i.removeBufferListeners(u),i.mediaSource&&i.mediaSource.removeSourceBuffer(p),i.sourceBuffer[u]=void 0)}catch(b){c.logger.warn("[buffer-controller]: Failed to reset the "+u+" buffer",b)}}),this._initSourceBuffer()},x.onBufferCodecs=function(i,u){var p=this,b=this.getSourceBufferTypes().length;Object.keys(u).forEach(function(l){if(b){var s=p.tracks[l];if(s&&typeof s.buffer.changeType=="function"){var h=u[l],E=h.id,n=h.codec,d=h.levelCodec,m=h.container,f=h.metadata,g=(s.levelCodec||s.codec).replace(I,"$1"),y=(d||n).replace(I,"$1");if(g!==y){var R=m+";codecs="+(d||n);p.appendChangeType(l,R),c.logger.log("[buffer-controller]: switching codec "+g+" to "+y),p.tracks[l]={buffer:s.buffer,codec:n,container:m,levelCodec:d,metadata:f,id:E}}}}else p.pendingTracks[l]=u[l]}),!b&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},x.appendChangeType=function(i,u){var p=this,b=this.operationQueue,l={execute:function(){var h=p.sourceBuffer[i];h&&(c.logger.log("[buffer-controller]: changing "+i+" sourceBuffer type to "+u),h.changeType(u)),b.shiftAndExecuteNext(i)},onStart:function(){},onComplete:function(){},onError:function(h){c.logger.warn("[buffer-controller]: Failed to change "+i+" SourceBuffer type",h)}};b.append(l,i)},x.onBufferAppending=function(i,u){var p=this,b=this.hls,l=this.operationQueue,s=this.tracks,h=u.data,E=u.type,n=u.frag,d=u.part,m=u.chunkMeta,f=m.buffering[E],g=self.performance.now();f.start=g;var y=n.stats.buffering,R=d?d.stats.buffering:null;y.start===0&&(y.start=g),R&&R.start===0&&(R.start=g);var L=s.audio,P=E==="audio"&&m.id===1&&(L==null?void 0:L.container)==="audio/mpeg",N={execute:function(){if(f.executeStart=self.performance.now(),P){var F=p.sourceBuffer[E];if(F){var H=n.start-F.timestampOffset;Math.abs(H)>=.1&&(c.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+n.start+" (delta: "+H+") sn: "+n.sn+")"),F.timestampOffset=n.start)}}p.appendExecutor(h,E)},onStart:function(){},onComplete:function(){var F=self.performance.now();f.executeEnd=f.end=F,y.first===0&&(y.first=F),R&&R.first===0&&(R.first=F);var H=p.sourceBuffer,j={};for(var X in H)j[X]=C.BufferHelper.getBuffered(H[X]);p.appendError=0,p.hls.trigger(o.Events.BUFFER_APPENDED,{type:E,frag:n,part:d,chunkMeta:m,parent:n.type,timeRanges:j})},onError:function(F){c.logger.error("[buffer-controller]: Error encountered while trying to append to the "+E+" SourceBuffer",F);var H={type:O.ErrorTypes.MEDIA_ERROR,parent:n.type,details:O.ErrorDetails.BUFFER_APPEND_ERROR,err:F,fatal:!1};F.code===DOMException.QUOTA_EXCEEDED_ERR?H.details=O.ErrorDetails.BUFFER_FULL_ERROR:(p.appendError++,H.details=O.ErrorDetails.BUFFER_APPEND_ERROR,p.appendError>b.config.appendErrorMaxRetry&&(c.logger.error("[buffer-controller]: Failed "+b.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),H.fatal=!0,b.stopLoad())),b.trigger(o.Events.ERROR,H)}};l.append(N,E)},x.onBufferFlushing=function(i,u){var p=this,b=this.operationQueue,l=function(h){return{execute:p.removeExecutor.bind(p,h,u.startOffset,u.endOffset),onStart:function(){},onComplete:function(){p.hls.trigger(o.Events.BUFFER_FLUSHED,{type:h})},onError:function(n){c.logger.warn("[buffer-controller]: Failed to remove from "+h+" SourceBuffer",n)}}};u.type?b.append(l(u.type),u.type):this.getSourceBufferTypes().forEach(function(s){b.append(l(s),s)})},x.onFragParsed=function(i,u){var p=this,b=u.frag,l=u.part,s=[],h=l?l.elementaryStreams:b.elementaryStreams;h[D.ElementaryStreamTypes.AUDIOVIDEO]?s.push("audiovideo"):(h[D.ElementaryStreamTypes.AUDIO]&&s.push("audio"),h[D.ElementaryStreamTypes.VIDEO]&&s.push("video"));var E=function(){var d=self.performance.now();b.stats.buffering.end=d,l&&(l.stats.buffering.end=d);var m=l?l.stats:b.stats;p.hls.trigger(o.Events.FRAG_BUFFERED,{frag:b,part:l,stats:m,id:b.type})};s.length===0&&c.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+b.type+" level: "+b.level+" sn: "+b.sn),this.blockBuffers(E,s)},x.onFragChanged=function(i,u){this.flushBackBuffer()},x.onBufferEos=function(i,u){var p=this,b=this.getSourceBufferTypes().reduce(function(l,s){var h=p.sourceBuffer[s];return(!u.type||u.type===s)&&h&&!h.ended&&(h.ended=!0,c.logger.log("[buffer-controller]: "+s+" sourceBuffer now EOS")),l&&!!(!h||h.ended)},!0);b&&this.blockBuffers(function(){var l=p.mediaSource;!l||l.readyState!=="open"||l.endOfStream()})},x.onLevelUpdated=function(i,u){var p=u.details;!p.fragments.length||(this.details=p,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},x.flushBackBuffer=function(){var i=this.hls,u=this.details,p=this.media,b=this.sourceBuffer;if(!(!p||u===null)){var l=this.getSourceBufferTypes();if(!!l.length){var s=u.live&&i.config.liveBackBufferLength!==null?i.config.liveBackBufferLength:i.config.backBufferLength;if(!(!Object(a.isFiniteNumber)(s)||s<0)){var h=p.currentTime,E=u.levelTargetDuration,n=Math.max(s,E),d=Math.floor(h/E)*E-n;l.forEach(function(m){var f=b[m];if(f){var g=C.BufferHelper.getBuffered(f);g.length>0&&d>g.start(0)&&(i.trigger(o.Events.BACK_BUFFER_REACHED,{bufferEnd:d}),u.live&&i.trigger(o.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:d}),i.trigger(o.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:d,type:m}))}})}}}},x.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var i=this.details,u=this.hls,p=this.media,b=this.mediaSource,l=i.fragments[0].start+i.totalduration,s=p.duration,h=Object(a.isFiniteNumber)(b.duration)?b.duration:0;i.live&&u.config.liveDurationInfinity?(c.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),b.duration=1/0,this.updateSeekableRange(i)):(l>h&&l>s||!Object(a.isFiniteNumber)(s))&&(c.logger.log("[buffer-controller]: Updating Media Source duration to "+l.toFixed(3)),b.duration=l)}},x.updateSeekableRange=function(i){var u=this.mediaSource,p=i.fragments,b=p.length;if(b&&i.live&&u!==null&&u!==void 0&&u.setLiveSeekableRange){var l=Math.max(0,p[0].start),s=Math.max(l,l+i.totalduration);u.setLiveSeekableRange(l,s)}},x.checkPendingTracks=function(){var i=this.bufferCodecEventsExpected,u=this.operationQueue,p=this.pendingTracks,b=Object.keys(p).length;if(b&&!i||b===2){this.createSourceBuffers(p),this.pendingTracks={};var l=this.getSourceBufferTypes();if(l.length===0){this.hls.trigger(o.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}l.forEach(function(s){u.executeNext(s)})}},x.createSourceBuffers=function(i){var u=this.sourceBuffer,p=this.mediaSource;if(!p)throw Error("createSourceBuffers called when mediaSource was null");var b=0;for(var l in i)if(!u[l]){var s=i[l];if(!s)throw Error("source buffer exists for track "+l+", however track does not");var h=s.levelCodec||s.codec,E=s.container+";codecs="+h;c.logger.log("[buffer-controller]: creating sourceBuffer("+E+")");try{var n=u[l]=p.addSourceBuffer(E),d=l;this.addBufferListener(d,"updatestart",this._onSBUpdateStart),this.addBufferListener(d,"updateend",this._onSBUpdateEnd),this.addBufferListener(d,"error",this._onSBUpdateError),this.tracks[l]={buffer:n,codec:h,container:s.container,levelCodec:s.levelCodec,metadata:s.metadata,id:s.id},b++}catch(m){c.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+m.message),this.hls.trigger(o.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:m,mimeType:E})}}b&&this.hls.trigger(o.Events.BUFFER_CREATED,{tracks:this.tracks})},x._onSBUpdateStart=function(i){var u=this.operationQueue,p=u.current(i);p.onStart()},x._onSBUpdateEnd=function(i){var u=this.operationQueue,p=u.current(i);p.onComplete(),u.shiftAndExecuteNext(i)},x._onSBUpdateError=function(i,u){c.logger.error("[buffer-controller]: "+i+" SourceBuffer error",u),this.hls.trigger(o.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var p=this.operationQueue.current(i);p&&p.onError(u)},x.removeExecutor=function(i,u,p){var b=this.media,l=this.mediaSource,s=this.operationQueue,h=this.sourceBuffer,E=h[i];if(!b||!l||!E){c.logger.warn("[buffer-controller]: Attempting to remove from the "+i+" SourceBuffer, but it does not exist"),s.shiftAndExecuteNext(i);return}var n=Object(a.isFiniteNumber)(b.duration)?b.duration:1/0,d=Object(a.isFiniteNumber)(l.duration)?l.duration:1/0,m=Math.max(0,u),f=Math.min(p,n,d);f>m?(c.logger.log("[buffer-controller]: Removing ["+m+","+f+"] from the "+i+" SourceBuffer"),console.assert(!E.updating,i+" sourceBuffer must not be updating"),E.remove(m,f)):s.shiftAndExecuteNext(i)},x.appendExecutor=function(i,u){var p=this.operationQueue,b=this.sourceBuffer,l=b[u];if(!l){c.logger.warn("[buffer-controller]: Attempting to append to the "+u+" SourceBuffer, but it does not exist"),p.shiftAndExecuteNext(u);return}l.ended=!1,console.assert(!l.updating,u+" sourceBuffer must not be updating"),l.appendBuffer(i)},x.blockBuffers=function(i,u){var p=this;if(u===void 0&&(u=this.getSourceBufferTypes()),!u.length){c.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(i);return}var b=this.operationQueue,l=u.map(function(s){return b.appendBlocker(s)});Promise.all(l).then(function(){i(),u.forEach(function(s){var h=p.sourceBuffer[s];(!h||!h.updating)&&b.shiftAndExecuteNext(s)})})},x.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},x.addBufferListener=function(i,u,p){var b=this.sourceBuffer[i];if(!!b){var l=p.bind(this,i);this.listeners[i].push({event:u,listener:l}),b.addEventListener(u,l)}},x.removeBufferListeners=function(i){var u=this.sourceBuffer[i];!u||this.listeners[i].forEach(function(p){u.removeEventListener(p.event,p.listener)})},T}()},"./src/controller/buffer-operation-queue.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return o});var a=r("./src/utils/logger.ts"),o=function(){function c(C){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=C}var O=c.prototype;return O.append=function(M,D){var A=this.queues[D];A.push(M),A.length===1&&this.buffers[D]&&this.executeNext(D)},O.insertAbort=function(M,D){var A=this.queues[D];A.unshift(M),this.executeNext(D)},O.appendBlocker=function(M){var D,A=new Promise(function(I){D=I}),_={execute:D,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(_,M),A},O.executeNext=function(M){var D=this.buffers,A=this.queues,_=D[M],I=A[M];if(I.length){var S=I[0];try{S.execute()}catch(T){a.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),S.onError(T),(!_||!_.updating)&&(I.shift(),this.executeNext(M))}}},O.shiftAndExecuteNext=function(M){this.queues[M].shift(),this.executeNext(M)},O.current=function(M){return this.queues[M][0]},c}()},"./src/controller/cap-level-controller.ts":function(t,e,r){"use strict";r.r(e);var a=r("./src/events.ts");function o(C,M){for(var D=0;D<M.length;D++){var A=M[D];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(C,A.key,A)}}function c(C,M,D){return M&&o(C.prototype,M),D&&o(C,D),Object.defineProperty(C,"prototype",{writable:!1}),C}var O=function(){function C(D){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=D,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var M=C.prototype;return M.setStreamController=function(A){this.streamController=A},M.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},M.registerListeners=function(){var A=this.hls;A.on(a.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),A.on(a.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),A.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),A.on(a.Events.BUFFER_CODECS,this.onBufferCodecs,this),A.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},M.unregisterListener=function(){var A=this.hls;A.off(a.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),A.off(a.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),A.off(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),A.off(a.Events.BUFFER_CODECS,this.onBufferCodecs,this),A.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},M.onFpsDropLevelCapping=function(A,_){C.isLevelAllowed(_.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(_.droppedLevel)},M.onMediaAttaching=function(A,_){this.media=_.media instanceof HTMLVideoElement?_.media:null},M.onManifestParsed=function(A,_){var I=this.hls;this.restrictedLevels=[],this.firstLevel=_.firstLevel,I.config.capLevelToPlayerSize&&_.video&&this.startCapping()},M.onBufferCodecs=function(A,_){var I=this.hls;I.config.capLevelToPlayerSize&&_.video&&this.startCapping()},M.onMediaDetaching=function(){this.stopCapping()},M.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var A=this.hls.levels;if(A.length){var _=this.hls;_.autoLevelCapping=this.getMaxLevel(A.length-1),_.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=_.autoLevelCapping}}},M.getMaxLevel=function(A){var _=this,I=this.hls.levels;if(!I.length)return-1;var S=I.filter(function(T,x){return C.isLevelAllowed(x,_.restrictedLevels)&&x<=A});return this.clientRect=null,C.getMaxLevelByMediaSize(S,this.mediaWidth,this.mediaHeight)},M.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},M.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},M.getDimensions=function(){if(this.clientRect)return this.clientRect;var A=this.media,_={width:0,height:0};if(A){var I=A.getBoundingClientRect();_.width=I.width,_.height=I.height,!_.width&&!_.height&&(_.width=I.right-I.left||A.width||0,_.height=I.bottom-I.top||A.height||0)}return this.clientRect=_,_},C.isLevelAllowed=function(A,_){return _===void 0&&(_=[]),_.indexOf(A)===-1},C.getMaxLevelByMediaSize=function(A,_,I){if(!A||!A.length)return-1;for(var S=function(u,p){return p?u.width!==p.width||u.height!==p.height:!0},T=A.length-1,x=0;x<A.length;x+=1){var v=A[x];if((v.width>=_||v.height>=I)&&S(v,A[x+1])){T=x;break}}return T},c(C,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var A=1;if(!this.hls.config.ignoreDevicePixelRatio)try{A=self.devicePixelRatio}catch{}return A}}]),C}();e.default=O},"./src/controller/cmcd-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return S});var a=r("./src/events.ts"),o=r("./src/types/cmcd.ts"),c=r("./src/utils/buffer-helper.ts"),O=r("./src/utils/logger.ts");function C(T,x){for(var v=0;v<x.length;v++){var i=x[v];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(T,i.key,i)}}function M(T,x,v){return x&&C(T.prototype,x),v&&C(T,v),Object.defineProperty(T,"prototype",{writable:!1}),T}function D(T,x){var v=typeof Symbol!="undefined"&&T[Symbol.iterator]||T["@@iterator"];if(v)return(v=v.call(T)).next.bind(v);if(Array.isArray(T)||(v=A(T))||x&&T&&typeof T.length=="number"){v&&(T=v);var i=0;return function(){return i>=T.length?{done:!0}:{done:!1,value:T[i++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function A(T,x){if(!!T){if(typeof T=="string")return _(T,x);var v=Object.prototype.toString.call(T).slice(8,-1);if(v==="Object"&&T.constructor&&(v=T.constructor.name),v==="Map"||v==="Set")return Array.from(T);if(v==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(v))return _(T,x)}}function _(T,x){(x==null||x>T.length)&&(x=T.length);for(var v=0,i=new Array(x);v<x;v++)i[v]=T[v];return i}function I(){return I=Object.assign?Object.assign.bind():function(T){for(var x=1;x<arguments.length;x++){var v=arguments[x];for(var i in v)Object.prototype.hasOwnProperty.call(v,i)&&(T[i]=v[i])}return T},I.apply(this,arguments)}var S=function(){function T(v){var i=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){i.initialized&&(i.starved=!0),i.buffering=!0},this.onPlaying=function(){i.initialized||(i.initialized=!0),i.buffering=!1},this.applyPlaylistData=function(b){try{i.apply(b,{ot:o.CMCDObjectType.MANIFEST,su:!i.initialized})}catch(l){O.logger.warn("Could not generate manifest CMCD data.",l)}},this.applyFragmentData=function(b){try{var l=b.frag,s=i.hls.levels[l.level],h=i.getObjectType(l),E={d:l.duration*1e3,ot:h};(h===o.CMCDObjectType.VIDEO||h===o.CMCDObjectType.AUDIO||h==o.CMCDObjectType.MUXED)&&(E.br=s.bitrate/1e3,E.tb=i.getTopBandwidth(h)/1e3,E.bl=i.getBufferLength(h)),i.apply(b,E)}catch(n){O.logger.warn("Could not generate segment CMCD data.",n)}},this.hls=v;var u=this.config=v.config,p=u.cmcd;p!=null&&(u.pLoader=this.createPlaylistLoader(),u.fLoader=this.createFragmentLoader(),this.sid=p.sessionId||T.uuid(),this.cid=p.contentId,this.useHeaders=p.useHeaders===!0,this.registerListeners())}var x=T.prototype;return x.registerListeners=function(){var i=this.hls;i.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(a.Events.MEDIA_DETACHED,this.onMediaDetached,this),i.on(a.Events.BUFFER_CREATED,this.onBufferCreated,this)},x.unregisterListeners=function(){var i=this.hls;i.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(a.Events.MEDIA_DETACHED,this.onMediaDetached,this),i.off(a.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},x.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},x.onMediaAttached=function(i,u){this.media=u.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},x.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},x.onBufferCreated=function(i,u){var p,b;this.audioBuffer=(p=u.tracks.audio)===null||p===void 0?void 0:p.buffer,this.videoBuffer=(b=u.tracks.video)===null||b===void 0?void 0:b.buffer},x.createData=function(){var i;return{v:o.CMCDVersion,sf:o.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(i=this.media)===null||i===void 0?void 0:i.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},x.apply=function(i,u){u===void 0&&(u={}),I(u,this.createData());var p=u.ot===o.CMCDObjectType.INIT||u.ot===o.CMCDObjectType.VIDEO||u.ot===o.CMCDObjectType.MUXED;if(this.starved&&p&&(u.bs=!0,u.su=!0,this.starved=!1),u.su==null&&(u.su=this.buffering),this.useHeaders){var b=T.toHeaders(u);if(!Object.keys(b).length)return;i.headers||(i.headers={}),I(i.headers,b)}else{var l=T.toQuery(u);if(!l)return;i.url=T.appendQueryToUri(i.url,l)}},x.getObjectType=function(i){var u=i.type;if(u==="subtitle")return o.CMCDObjectType.TIMED_TEXT;if(i.sn==="initSegment")return o.CMCDObjectType.INIT;if(u==="audio")return o.CMCDObjectType.AUDIO;if(u==="main")return this.hls.audioTracks.length?o.CMCDObjectType.VIDEO:o.CMCDObjectType.MUXED},x.getTopBandwidth=function(i){var u=0,p,b=this.hls;if(i===o.CMCDObjectType.AUDIO)p=b.audioTracks;else{var l=b.maxAutoLevel,s=l>-1?l+1:b.levels.length;p=b.levels.slice(0,s)}for(var h=D(p),E;!(E=h()).done;){var n=E.value;n.bitrate>u&&(u=n.bitrate)}return u>0?u:NaN},x.getBufferLength=function(i){var u=this.hls.media,p=i===o.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!p||!u)return NaN;var b=c.BufferHelper.bufferInfo(p,u.currentTime,this.config.maxBufferHole);return b.len*1e3},x.createPlaylistLoader=function(){var i=this.config.pLoader,u=this.applyPlaylistData,p=i||this.config.loader;return function(){function b(s){this.loader=void 0,this.loader=new p(s)}var l=b.prototype;return l.destroy=function(){this.loader.destroy()},l.abort=function(){this.loader.abort()},l.load=function(h,E,n){u(h),this.loader.load(h,E,n)},M(b,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),b}()},x.createFragmentLoader=function(){var i=this.config.fLoader,u=this.applyFragmentData,p=i||this.config.loader;return function(){function b(s){this.loader=void 0,this.loader=new p(s)}var l=b.prototype;return l.destroy=function(){this.loader.destroy()},l.abort=function(){this.loader.abort()},l.load=function(h,E,n){u(h),this.loader.load(h,E,n)},M(b,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),b}()},T.uuid=function(){var i=URL.createObjectURL(new Blob),u=i.toString();return URL.revokeObjectURL(i),u.slice(u.lastIndexOf("/")+1)},T.serialize=function(i){for(var u=[],p=function(P){return!Number.isNaN(P)&&P!=null&&P!==""&&P!==!1},b=function(P){return Math.round(P)},l=function(P){return b(P/100)*100},s=function(P){return encodeURIComponent(P)},h={br:b,d:b,bl:l,dl:l,mtp:l,nor:s,rtp:l,tb:b},E=Object.keys(i||{}).sort(),n=D(E),d;!(d=n()).done;){var m=d.value,f=i[m];if(!!p(f)&&!(m==="v"&&f===1)&&!(m=="pr"&&f===1)){var g=h[m];g&&(f=g(f));var y=typeof f,R=void 0;m==="ot"||m==="sf"||m==="st"?R=m+"="+f:y==="boolean"?R=m:y==="number"?R=m+"="+f:R=m+"="+JSON.stringify(f),u.push(R)}}return u.join(",")},T.toHeaders=function(i){for(var u=Object.keys(i),p={},b=["Object","Request","Session","Status"],l=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},h=0,E=u;h<E.length;h++){var n=E[h],d=s[n]!=null?s[n]:1;l[d][n]=i[n]}for(var m=0;m<l.length;m++){var f=T.serialize(l[m]);f&&(p["CMCD-"+b[m]]=f)}return p},T.toQuery=function(i){return"CMCD="+encodeURIComponent(T.serialize(i))},T.appendQueryToUri=function(i,u){if(!u)return i;var p=i.includes("?")?"&":"?";return""+i+p+u},T}()},"./src/controller/eme-controller.ts":function(t,e,r){"use strict";r.r(e);var a=r("./src/events.ts"),o=r("./src/errors.ts"),c=r("./src/utils/logger.ts"),O=r("./src/utils/mediakeys-helper.ts");function C(S,T){for(var x=0;x<T.length;x++){var v=T[x];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(S,v.key,v)}}function M(S,T,x){return T&&C(S.prototype,T),x&&C(S,x),Object.defineProperty(S,"prototype",{writable:!1}),S}var D=3,A=function(T,x,v){var i={audioCapabilities:[],videoCapabilities:[]};return T.forEach(function(u){i.audioCapabilities.push({contentType:'audio/mp4; codecs="'+u+'"',robustness:v.audioRobustness||""})}),x.forEach(function(u){i.videoCapabilities.push({contentType:'video/mp4; codecs="'+u+'"',robustness:v.videoRobustness||""})}),[i]},_=function(T,x,v,i){switch(T){case O.KeySystems.WIDEVINE:return A(x,v,i);default:throw new Error("Unknown key-system: "+T)}},I=function(){function S(x){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=x,this._config=x.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var T=S.prototype;return T.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},T._registerListeners=function(){this.hls.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(a.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this)},T._unregisterListeners=function(){this.hls.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(a.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(a.Events.MANIFEST_PARSED,this.onManifestParsed,this)},T.getLicenseServerUrl=function(v){switch(v){case O.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+v+'"')},T._attemptKeySystemAccess=function(v,i,u){var p=this,b=_(v,i,u,this._drmSystemOptions);c.logger.log("Requesting encrypted media key-system access");var l=this.requestMediaKeySystemAccess(v,b);this.mediaKeysPromise=l.then(function(s){return p._onMediaKeySystemAccessObtained(v,s)}),l.catch(function(s){c.logger.error('Failed to obtain key-system "'+v+'" access:',s)})},T._onMediaKeySystemAccessObtained=function(v,i){var u=this;c.logger.log('Access for key-system "'+v+'" obtained');var p={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:i,mediaKeySystemDomain:v};this._mediaKeysList.push(p);var b=Promise.resolve().then(function(){return i.createMediaKeys()}).then(function(l){return p.mediaKeys=l,c.logger.log('Media-keys created for key-system "'+v+'"'),u._onMediaKeysCreated(),l});return b.catch(function(l){c.logger.error("Failed to create media-keys:",l)}),b},T._onMediaKeysCreated=function(){var v=this;this._mediaKeysList.forEach(function(i){i.mediaKeysSession||(i.mediaKeysSession=i.mediaKeys.createSession(),v._onNewMediaKeySession(i.mediaKeysSession))})},T._onNewMediaKeySession=function(v){var i=this;c.logger.log("New key-system session "+v.sessionId),v.addEventListener("message",function(u){i._onKeySessionMessage(v,u.message)},!1)},T._onKeySessionMessage=function(v,i){c.logger.log("Got EME message event, creating license request"),this._requestLicense(i,function(u){c.logger.log("Received license data (length: "+(u&&u.byteLength)+"), updating key-session"),v.update(u).catch(function(p){c.logger.warn("Updating key-session failed: "+p)})})},T.onMediaEncrypted=function(v){var i=this;if(c.logger.log('Media is encrypted using "'+v.initDataType+'" init data type'),!this.mediaKeysPromise){c.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(a.Events.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var u=function(b){!i._media||(i._attemptSetMediaKeys(b),i._generateRequestWithPreferredKeySession(v.initDataType,v.initData))};this.mediaKeysPromise.then(u).catch(u)},T._attemptSetMediaKeys=function(v){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var i=this._mediaKeysList[0];if(!i||!i.mediaKeys){c.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(a.Events.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}c.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(i.mediaKeys),this._hasSetMediaKeys=!0}},T._generateRequestWithPreferredKeySession=function(v,i){var u=this,p=this._mediaKeysList[0];if(!p){c.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(a.Events.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(p.mediaKeysSessionInitialized){c.logger.warn("Key-Session already initialized but requested again");return}var b=p.mediaKeysSession;if(!b){c.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(a.Events.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!i){c.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(a.Events.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}c.logger.log('Generating key-session request for "'+v+'" init data type'),p.mediaKeysSessionInitialized=!0,b.generateRequest(v,i).then(function(){c.logger.debug("Key-session generation succeeded")}).catch(function(l){c.logger.error("Error generating key-session request:",l),u.hls.trigger(a.Events.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},T._createLicenseXhr=function(v,i,u){var p=new XMLHttpRequest;p.responseType="arraybuffer",p.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,p,v,i,u);var b=this._licenseXhrSetup;if(b)try{b.call(this.hls,p,v),b=void 0}catch(l){c.logger.error(l)}try{p.readyState||p.open("POST",v,!0),b&&b.call(this.hls,p,v)}catch(l){throw new Error("issue setting up KeySystem license XHR "+l)}return p},T._onLicenseRequestReadyStageChange=function(v,i,u,p){switch(v.readyState){case 4:if(v.status===200){this._requestLicenseFailureCount=0,c.logger.log("License request succeeded");var b=v.response,l=this._licenseResponseCallback;if(l)try{b=l.call(this.hls,v,i)}catch(h){c.logger.error(h)}p(b)}else{if(c.logger.error("License Request XHR failed ("+i+"). Status: "+v.status+" ("+v.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>D){this.hls.trigger(a.Events.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var s=D-this._requestLicenseFailureCount+1;c.logger.warn("Retrying license request, "+s+" attempts left"),this._requestLicense(u,p)}break}},T._generateLicenseRequestChallenge=function(v,i){switch(v.mediaKeySystemDomain){case O.KeySystems.WIDEVINE:return i}throw new Error("unsupported key-system: "+v.mediaKeySystemDomain)},T._requestLicense=function(v,i){c.logger.log("Requesting content license for key-system");var u=this._mediaKeysList[0];if(!u){c.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(a.Events.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var p=this.getLicenseServerUrl(u.mediaKeySystemDomain),b=this._createLicenseXhr(p,v,i);c.logger.log("Sending license request to URL: "+p);var l=this._generateLicenseRequestChallenge(u,v);b.send(l)}catch(s){c.logger.error("Failure requesting DRM license: "+s),this.hls.trigger(a.Events.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},T.onMediaAttached=function(v,i){if(!!this._emeEnabled){var u=i.media;this._media=u,u.addEventListener("encrypted",this._onMediaEncrypted)}},T.onMediaDetached=function(){var v=this._media,i=this._mediaKeysList;!v||(v.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(i.map(function(u){if(u.mediaKeysSession)return u.mediaKeysSession.close().catch(function(){})})).then(function(){return v.setMediaKeys(null)}).catch(function(){}))},T.onManifestParsed=function(v,i){if(!!this._emeEnabled){var u=i.levels.map(function(b){return b.audioCodec}).filter(function(b){return!!b}),p=i.levels.map(function(b){return b.videoCodec}).filter(function(b){return!!b});this._attemptKeySystemAccess(O.KeySystems.WIDEVINE,u,p)}},M(S,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),S}();e.default=I},"./src/controller/fps-controller.ts":function(t,e,r){"use strict";r.r(e);var a=r("./src/events.ts"),o=r("./src/utils/logger.ts"),c=function(){function O(M){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=M,this.registerListeners()}var C=O.prototype;return C.setStreamController=function(D){this.streamController=D},C.registerListeners=function(){this.hls.on(a.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},C.unregisterListeners=function(){this.hls.off(a.Events.MEDIA_ATTACHING,this.onMediaAttaching)},C.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},C.onMediaAttaching=function(D,A){var _=this.hls.config;if(_.capLevelOnFPSDrop){var I=A.media instanceof self.HTMLVideoElement?A.media:null;this.media=I,I&&typeof I.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),_.fpsDroppedMonitoringPeriod)}},C.checkFPS=function(D,A,_){var I=performance.now();if(A){if(this.lastTime){var S=I-this.lastTime,T=_-this.lastDroppedFrames,x=A-this.lastDecodedFrames,v=1e3*T/S,i=this.hls;if(i.trigger(a.Events.FPS_DROP,{currentDropped:T,currentDecoded:x,totalDroppedFrames:_}),v>0&&T>i.config.fpsDroppedMonitoringThreshold*x){var u=i.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(i.autoLevelCapping===-1||i.autoLevelCapping>=u)&&(u=u-1,i.trigger(a.Events.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:i.currentLevel}),i.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=I,this.lastDroppedFrames=_,this.lastDecodedFrames=A}},C.checkFPSInterval=function(){var D=this.media;if(D)if(this.isVideoPlaybackQualityAvailable){var A=D.getVideoPlaybackQuality();this.checkFPS(D,A.totalVideoFrames,A.droppedVideoFrames)}else this.checkFPS(D,D.webkitDecodedFrameCount,D.webkitDroppedFrameCount)},O}();e.default=c},"./src/controller/fragment-finders.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"findFragmentByPDT",function(){return c}),r.d(e,"findFragmentByPTS",function(){return O}),r.d(e,"fragmentWithinToleranceTest",function(){return C}),r.d(e,"pdtWithinToleranceTest",function(){return M}),r.d(e,"findFragWithCC",function(){return D});var a=r("./src/polyfills/number.ts"),o=r("./src/utils/binary-search.ts");function c(A,_,I){if(_===null||!Array.isArray(A)||!A.length||!Object(a.isFiniteNumber)(_))return null;var S=A[0].programDateTime;if(_<(S||0))return null;var T=A[A.length-1].endProgramDateTime;if(_>=(T||0))return null;I=I||0;for(var x=0;x<A.length;++x){var v=A[x];if(M(_,I,v))return v}return null}function O(A,_,I,S){I===void 0&&(I=0),S===void 0&&(S=0);var T=null;if(A?T=_[A.sn-_[0].sn+1]||null:I===0&&_[0].start===0&&(T=_[0]),T&&C(I,S,T)===0)return T;var x=o.default.search(_,C.bind(null,I,S));return x||T}function C(A,_,I){A===void 0&&(A=0),_===void 0&&(_=0);var S=Math.min(_,I.duration+(I.deltaPTS?I.deltaPTS:0));return I.start+I.duration-S<=A?1:I.start-S>A&&I.start?-1:0}function M(A,_,I){var S=Math.min(_,I.duration+(I.deltaPTS?I.deltaPTS:0))*1e3,T=I.endProgramDateTime||0;return T-S>A}function D(A,_){return o.default.search(A,function(I){return I.cc<_?1:I.cc>_?-1:0})}},"./src/controller/fragment-tracker.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"FragmentState",function(){return c}),r.d(e,"FragmentTracker",function(){return O});var a=r("./src/events.ts"),o=r("./src/types/loader.ts"),c;(function(D){D.NOT_LOADED="NOT_LOADED",D.APPENDING="APPENDING",D.PARTIAL="PARTIAL",D.OK="OK"})(c||(c={}));var O=function(){function D(_){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=_,this._registerListeners()}var A=D.prototype;return A._registerListeners=function(){var I=this.hls;I.on(a.Events.BUFFER_APPENDED,this.onBufferAppended,this),I.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),I.on(a.Events.FRAG_LOADED,this.onFragLoaded,this)},A._unregisterListeners=function(){var I=this.hls;I.off(a.Events.BUFFER_APPENDED,this.onBufferAppended,this),I.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),I.off(a.Events.FRAG_LOADED,this.onFragLoaded,this)},A.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},A.getAppendedFrag=function(I,S){if(S===o.PlaylistLevelType.MAIN){var T=this.activeFragment,x=this.activeParts;if(!T)return null;if(x)for(var v=x.length;v--;){var i=x[v],u=i?i.end:T.appendedPTS;if(i.start<=I&&u!==void 0&&I<=u)return v>9&&(this.activeParts=x.slice(v-9)),i}else if(T.start<=I&&T.appendedPTS!==void 0&&I<=T.appendedPTS)return T}return this.getBufferedFrag(I,S)},A.getBufferedFrag=function(I,S){for(var T=this.fragments,x=Object.keys(T),v=x.length;v--;){var i=T[x[v]];if((i==null?void 0:i.body.type)===S&&i.buffered){var u=i.body;if(u.start<=I&&I<=u.end)return u}}return null},A.detectEvictedFragments=function(I,S,T){var x=this;Object.keys(this.fragments).forEach(function(v){var i=x.fragments[v];if(!!i){if(!i.buffered){i.body.type===T&&x.removeFragment(i.body);return}var u=i.range[I];!u||u.time.some(function(p){var b=!x.isTimeBuffered(p.startPTS,p.endPTS,S);return b&&x.removeFragment(i.body),b})}})},A.detectPartialFragments=function(I){var S=this,T=this.timeRanges,x=I.frag,v=I.part;if(!(!T||x.sn==="initSegment")){var i=M(x),u=this.fragments[i];!u||(Object.keys(T).forEach(function(p){var b=x.elementaryStreams[p];if(!!b){var l=T[p],s=v!==null||b.partial===!0;u.range[p]=S.getBufferedTimes(x,v,s,l)}}),u.loaded=null,Object.keys(u.range).length?u.buffered=!0:this.removeFragment(u.body))}},A.fragBuffered=function(I){var S=M(I),T=this.fragments[S];T&&(T.loaded=null,T.buffered=!0)},A.getBufferedTimes=function(I,S,T,x){for(var v={time:[],partial:T},i=S?S.start:I.start,u=S?S.end:I.end,p=I.minEndPTS||u,b=I.maxStartPTS||i,l=0;l<x.length;l++){var s=x.start(l)-this.bufferPadding,h=x.end(l)+this.bufferPadding;if(b>=s&&p<=h){v.time.push({startPTS:Math.max(i,x.start(l)),endPTS:Math.min(u,x.end(l))});break}else if(i<h&&u>s)v.partial=!0,v.time.push({startPTS:Math.max(i,x.start(l)),endPTS:Math.min(u,x.end(l))});else if(u<=s)break}return v},A.getPartialFragment=function(I){var S=null,T,x,v,i=0,u=this.bufferPadding,p=this.fragments;return Object.keys(p).forEach(function(b){var l=p[b];!l||C(l)&&(x=l.body.start-u,v=l.body.end+u,I>=x&&I<=v&&(T=Math.min(I-x,v-I),i<=T&&(S=l.body,i=T)))}),S},A.getState=function(I){var S=M(I),T=this.fragments[S];return T?T.buffered?C(T)?c.PARTIAL:c.OK:c.APPENDING:c.NOT_LOADED},A.isTimeBuffered=function(I,S,T){for(var x,v,i=0;i<T.length;i++){if(x=T.start(i)-this.bufferPadding,v=T.end(i)+this.bufferPadding,I>=x&&S<=v)return!0;if(S<=x)return!1}return!1},A.onFragLoaded=function(I,S){var T=S.frag,x=S.part;if(!(T.sn==="initSegment"||T.bitrateTest||x)){var v=M(T);this.fragments[v]={body:T,loaded:S,buffered:!1,range:Object.create(null)}}},A.onBufferAppended=function(I,S){var T=this,x=S.frag,v=S.part,i=S.timeRanges;if(x.type===o.PlaylistLevelType.MAIN)if(this.activeFragment=x,v){var u=this.activeParts;u||(this.activeParts=u=[]),u.push(v)}else this.activeParts=null;this.timeRanges=i,Object.keys(i).forEach(function(p){var b=i[p];if(T.detectEvictedFragments(p,b),!v)for(var l=0;l<b.length;l++)x.appendedPTS=Math.max(b.end(l),x.appendedPTS||0)})},A.onFragBuffered=function(I,S){this.detectPartialFragments(S)},A.hasFragment=function(I){var S=M(I);return!!this.fragments[S]},A.removeFragmentsInRange=function(I,S,T){var x=this;Object.keys(this.fragments).forEach(function(v){var i=x.fragments[v];if(!!i&&i.buffered){var u=i.body;u.type===T&&u.start<S&&u.end>I&&x.removeFragment(u)}})},A.removeFragment=function(I){var S=M(I);I.stats.loaded=0,I.clearElementaryStreamInfo(),delete this.fragments[S]},A.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},D}();function C(D){var A,_;return D.buffered&&(((A=D.range.video)===null||A===void 0?void 0:A.partial)||((_=D.range.audio)===null||_===void 0?void 0:_.partial))}function M(D){return D.type+"_"+D.level+"_"+D.urlId+"_"+D.sn}},"./src/controller/gap-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"STALL_MINIMUM_DURATION_MS",function(){return C}),r.d(e,"MAX_START_GAP_JUMP",function(){return M}),r.d(e,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return D}),r.d(e,"SKIP_BUFFER_RANGE_START",function(){return A}),r.d(e,"default",function(){return _});var a=r("./src/utils/buffer-helper.ts"),o=r("./src/errors.ts"),c=r("./src/events.ts"),O=r("./src/utils/logger.ts"),C=250,M=2,D=.1,A=.05,_=function(){function I(T,x,v,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=T,this.media=x,this.fragmentTracker=v,this.hls=i}var S=I.prototype;return S.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},S.poll=function(x,v){var i=this.config,u=this.media,p=this.stalled;if(u!==null){var b=u.currentTime,l=u.seeking,s=this.seeking&&!l,h=!this.seeking&&l;if(this.seeking=l,b!==x){if(this.moved=!0,p!==null){if(this.stallReported){var E=self.performance.now()-p;O.logger.warn("playback not stuck anymore @"+b+", after "+Math.round(E)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((h||s)&&(this.stalled=null),!(u.paused&&!l||u.ended||u.playbackRate===0||!a.BufferHelper.getBuffered(u).length)){var n=a.BufferHelper.bufferInfo(u,b,0),d=n.len>0,m=n.nextStart||0;if(!(!d&&!m)){if(l){var f=n.len>M,g=!m||v&&v.start<=b||m-b>M&&!this.fragmentTracker.getPartialFragment(b);if(f||g)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var y,R=Math.max(m,n.start||0)-b,L=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,P=L==null||(y=L.details)===null||y===void 0?void 0:y.live,N=P?L.details.targetduration*2:M;if(R>0&&R<=N){this._trySkipBufferHole(null);return}}var B=self.performance.now();if(p===null){this.stalled=B;return}var F=B-p;if(!(!l&&F>=C&&(this._reportStall(n),!this.media))){var H=a.BufferHelper.bufferInfo(u,b,i.maxBufferHole);this._tryFixBufferStall(H,F)}}}}},S._tryFixBufferStall=function(x,v){var i=this.config,u=this.fragmentTracker,p=this.media;if(p!==null){var b=p.currentTime,l=u.getPartialFragment(b);if(l){var s=this._trySkipBufferHole(l);if(s||!this.media)return}x.len>i.maxBufferHole&&v>i.highBufferWatchdogPeriod*1e3&&(O.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},S._reportStall=function(x){var v=this.hls,i=this.media,u=this.stallReported;!u&&i&&(this.stallReported=!0,O.logger.warn("Playback stalling at @"+i.currentTime+" due to low buffer ("+JSON.stringify(x)+")"),v.trigger(c.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:x.len}))},S._trySkipBufferHole=function(x){var v=this.config,i=this.hls,u=this.media;if(u===null)return 0;for(var p=u.currentTime,b=0,l=a.BufferHelper.getBuffered(u),s=0;s<l.length;s++){var h=l.start(s);if(p+v.maxBufferHole>=b&&p<h){var E=Math.max(h+A,u.currentTime+D);return O.logger.warn("skipping hole, adjusting currentTime from "+p+" to "+E),this.moved=!0,this.stalled=null,u.currentTime=E,x&&i.trigger(c.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+p+" to "+E,frag:x}),E}b=l.end(s)}return 0},S._tryNudgeBuffer=function(){var x=this.config,v=this.hls,i=this.media,u=this.nudgeRetry;if(i!==null){var p=i.currentTime;if(this.nudgeRetry++,u<x.nudgeMaxRetry){var b=p+(u+1)*x.nudgeOffset;O.logger.warn("Nudging 'currentTime' from "+p+" to "+b),i.currentTime=b,v.trigger(c.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else O.logger.error("Playhead still not moving while enough data buffered @"+p+" after "+x.nudgeMaxRetry+" nudges"),v.trigger(c.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},I}()},"./src/controller/id3-track-controller.ts":function(t,e,r){"use strict";r.r(e);var a=r("./src/polyfills/number.ts"),o=r("./src/events.ts"),c=r("./src/utils/texttrack-utils.ts"),O=r("./src/demux/id3.ts"),C=r("./src/loader/date-range.ts"),M=r("./src/types/demuxer.ts"),D=.25;function A(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function _(T,x){return T.getTime()/1e3-x}function I(T){return Uint8Array.from(T.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var S=function(){function T(v){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=v,this._registerListeners()}var x=T.prototype;return x.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},x._registerListeners=function(){var i=this.hls;i.on(o.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(o.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(o.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(o.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),i.on(o.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.on(o.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},x._unregisterListeners=function(){var i=this.hls;i.off(o.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(o.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(o.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(o.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),i.off(o.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.off(o.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},x.onMediaAttached=function(i,u){this.media=u.media},x.onMediaDetaching=function(){!this.id3Track||(Object(c.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},x.onManifestLoading=function(){this.dateRangeCuesAppended={}},x.createTrack=function(i){var u=this.getID3Track(i.textTracks);return u.mode="hidden",u},x.getID3Track=function(i){if(!!this.media){for(var u=0;u<i.length;u++){var p=i[u];if(p.kind==="metadata"&&p.label==="id3")return Object(c.sendAddTrackEvent)(p,this.media),p}return this.media.addTextTrack("metadata","id3")}},x.onFragParsingMetadata=function(i,u){if(!!this.media){var p=this.hls.config,b=p.enableEmsgMetadataCues,l=p.enableID3MetadataCues;if(!(!b&&!l)){var s=u.frag,h=u.samples,E=u.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var n=E.edge||s.end,d=A(),m=!1,f={},g=0;g<h.length;g++){var y=h[g].type;if(!(y===M.MetadataSchema.emsg&&!b||!l)){var R=O.getID3Frames(h[g].data);if(R){var L=h[g].pts,P=n,N=P-L;N<=0&&(P=L+D);for(var B=0;B<R.length;B++){var F=R[B];if(!O.isTimeStampFrame(F)){var H=new d(L,P,"");H.value=F,y&&(H.type=y),this.id3Track.addCue(H),f[F.key]=null,m=!0}}}}}m&&this.updateId3CueEnds(f)}}},x.updateId3CueEnds=function(i){var u,p=(u=this.id3Track)===null||u===void 0?void 0:u.cues;if(p)for(var b=p.length;b--;){var l,s=p[b],h=(l=s.value)===null||l===void 0?void 0:l.key;if(h&&h in i){var E=i[h];E&&s.endTime!==E&&(s.endTime=E),i[h]=s.startTime}}},x.onBufferFlushing=function(i,u){var p=u.startOffset,b=u.endOffset,l=u.type,s=this.id3Track,h=this.hls;if(!!h){var E=h.config,n=E.enableEmsgMetadataCues,d=E.enableID3MetadataCues;if(s&&(n||d)){var m;l==="audio"?m=function(g){return g.type===M.MetadataSchema.audioId3&&d}:l==="video"?m=function(g){return g.type===M.MetadataSchema.emsg&&n}:m=function(g){return g.type===M.MetadataSchema.audioId3&&d||g.type===M.MetadataSchema.emsg&&n},Object(c.removeCuesInRange)(s,p,b,m)}}},x.onLevelUpdated=function(i,u){var p=this,b=u.details;if(!(!this.media||!b.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var l=this.dateRangeCuesAppended,s=this.id3Track,h=b.dateRanges,E=Object.keys(h);if(s)for(var n=Object.keys(l).filter(function(N){return!E.includes(N)}),d=function(B){var F=n[B];Object.keys(l[F].cues).forEach(function(H){s.removeCue(l[F].cues[H])}),delete l[F]},m=n.length;m--;)d(m);var f=b.fragments[b.fragments.length-1];if(!(E.length===0||!Object(a.isFiniteNumber)(f==null?void 0:f.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var g=f.programDateTime/1e3-f.start,y=b.edge||f.end,R=A(),L=function(B){var F=E[B],H=h[F],j=l[F],X=(j==null?void 0:j.cues)||{},$=(j==null?void 0:j.durationKnown)||!1,G=_(H.startDate,g),J=y,ee=H.endDate;if(ee)J=_(ee,g),$=!0;else if(H.endOnNext&&!$){var te=E.reduce(function(ne,Me){var _e=h[Me];return _e.class===H.class&&_e.id!==Me&&_e.startDate>H.startDate&&ne.push(_e),ne},[]).sort(function(ne,Me){return ne.startDate.getTime()-Me.startDate.getTime()})[0];te&&(J=_(te.startDate,g),$=!0)}for(var oe=Object.keys(H.attr),ue=0;ue<oe.length;ue++){var ae=oe[ue];if(!(ae===C.DateRangeAttribute.ID||ae===C.DateRangeAttribute.CLASS||ae===C.DateRangeAttribute.START_DATE||ae===C.DateRangeAttribute.DURATION||ae===C.DateRangeAttribute.END_DATE||ae===C.DateRangeAttribute.END_ON_NEXT)){var he=X[ae];if(he)$&&!j.durationKnown&&(he.endTime=J);else{var me=H.attr[ae];he=new R(G,J,""),(ae===C.DateRangeAttribute.SCTE35_OUT||ae===C.DateRangeAttribute.SCTE35_IN)&&(me=I(me)),he.value={key:ae,data:me},he.type=M.MetadataSchema.dateRange,p.id3Track.addCue(he),X[ae]=he}}}l[F]={cues:X,dateRange:H,durationKnown:$}},P=0;P<E.length;P++)L(P)}}},T}();e.default=S},"./src/controller/latency-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return M});var a=r("./src/errors.ts"),o=r("./src/events.ts"),c=r("./src/utils/logger.ts");function O(D,A){for(var _=0;_<A.length;_++){var I=A[_];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(D,I.key,I)}}function C(D,A,_){return A&&O(D.prototype,A),_&&O(D,_),Object.defineProperty(D,"prototype",{writable:!1}),D}var M=function(){function D(_){var I=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return I.timeupdate()},this.hls=_,this.config=_.config,this.registerListeners()}var A=D.prototype;return A.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},A.registerListeners=function(){this.hls.on(o.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(o.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(o.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(o.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(o.Events.ERROR,this.onError,this)},A.unregisterListeners=function(){this.hls.off(o.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(o.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(o.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(o.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(o.Events.ERROR,this.onError)},A.onMediaAttached=function(I,S){this.media=S.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},A.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},A.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},A.onLevelUpdated=function(I,S){var T=S.details;this.levelDetails=T,T.advanced&&this.timeupdate(),!T.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},A.onError=function(I,S){S.details===a.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,c.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},A.timeupdate=function(){var I=this.media,S=this.levelDetails;if(!(!I||!S)){this.currentTime=I.currentTime;var T=this.computeLatency();if(T!==null){this._latency=T;var x=this.config,v=x.lowLatencyMode,i=x.maxLiveSyncPlaybackRate;if(!(!v||i===1)){var u=this.targetLatency;if(u!==null){var p=T-u,b=Math.min(this.maxLatency,u+S.targetduration),l=p<b;if(S.live&&l&&p>.05&&this.forwardBufferLength>1){var s=Math.min(2,Math.max(1,i)),h=Math.round(2/(1+Math.exp(-.75*p-this.edgeStalled))*20)/20;I.playbackRate=Math.min(s,Math.max(1,h))}else I.playbackRate!==1&&I.playbackRate!==0&&(I.playbackRate=1)}}}}},A.estimateLiveEdge=function(){var I=this.levelDetails;return I===null?null:I.edge+I.age},A.computeLatency=function(){var I=this.estimateLiveEdge();return I===null?null:I-this.currentTime},C(D,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var I=this.config,S=this.levelDetails;return I.liveMaxLatencyDuration!==void 0?I.liveMaxLatencyDuration:S?I.liveMaxLatencyDurationCount*S.targetduration:0}},{key:"targetLatency",get:function(){var I=this.levelDetails;if(I===null)return null;var S=I.holdBack,T=I.partHoldBack,x=I.targetduration,v=this.config,i=v.liveSyncDuration,u=v.liveSyncDurationCount,p=v.lowLatencyMode,b=this.hls.userConfig,l=p&&T||S;(b.liveSyncDuration||b.liveSyncDurationCount||l===0)&&(l=i!==void 0?i:u*x);var s=x,h=1;return l+Math.min(this.stallCount*h,s)}},{key:"liveSyncPosition",get:function(){var I=this.estimateLiveEdge(),S=this.targetLatency,T=this.levelDetails;if(I===null||S===null||T===null)return null;var x=T.edge,v=I-S-this.edgeStalled,i=x-T.totalduration,u=x-(this.config.lowLatencyMode&&T.partTarget||T.targetduration);return Math.min(Math.max(i,v),u)}},{key:"drift",get:function(){var I=this.levelDetails;return I===null?1:I.drift}},{key:"edgeStalled",get:function(){var I=this.levelDetails;if(I===null)return 0;var S=(this.config.lowLatencyMode&&I.partTarget||I.targetduration)*3;return Math.max(I.age-S,0)}},{key:"forwardBufferLength",get:function(){var I=this.media,S=this.levelDetails;if(!I||!S)return 0;var T=I.buffered.length;return(T?I.buffered.end(T-1):S.edge)-this.currentTime}}]),D}()},"./src/controller/level-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return v});var a=r("./src/types/level.ts"),o=r("./src/events.ts"),c=r("./src/errors.ts"),O=r("./src/utils/codecs.ts"),C=r("./src/controller/level-helper.ts"),M=r("./src/controller/base-playlist-controller.ts"),D=r("./src/types/loader.ts");function A(){return A=Object.assign?Object.assign.bind():function(i){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var b in p)Object.prototype.hasOwnProperty.call(p,b)&&(i[b]=p[b])}return i},A.apply(this,arguments)}function _(i,u){for(var p=0;p<u.length;p++){var b=u[p];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(i,b.key,b)}}function I(i,u,p){return u&&_(i.prototype,u),p&&_(i,p),Object.defineProperty(i,"prototype",{writable:!1}),i}function S(i,u){i.prototype=Object.create(u.prototype),i.prototype.constructor=i,T(i,u)}function T(i,u){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(b,l){return b.__proto__=l,b},T(i,u)}var x=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),v=function(i){S(u,i);function u(b){var l;return l=i.call(this,b,"[level-controller]")||this,l._levels=[],l._firstLevel=-1,l._startLevel=void 0,l.currentLevelIndex=-1,l.manualLevelIndex=-1,l.onParsedComplete=void 0,l._registerListeners(),l}var p=u.prototype;return p._registerListeners=function(){var l=this.hls;l.on(o.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.on(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.on(o.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),l.on(o.Events.FRAG_LOADED,this.onFragLoaded,this),l.on(o.Events.ERROR,this.onError,this)},p._unregisterListeners=function(){var l=this.hls;l.off(o.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.off(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.off(o.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),l.off(o.Events.FRAG_LOADED,this.onFragLoaded,this),l.off(o.Events.ERROR,this.onError,this)},p.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,i.prototype.destroy.call(this)},p.startLoad=function(){var l=this._levels;l.forEach(function(s){s.loadError=0}),i.prototype.startLoad.call(this)},p.onManifestLoaded=function(l,s){var h=[],E=[],n=[],d,m={},f,g=!1,y=!1,R=!1;if(s.levels.forEach(function(B){var F=B.attrs;g=g||!!(B.width&&B.height),y=y||!!B.videoCodec,R=R||!!B.audioCodec,x&&B.audioCodec&&B.audioCodec.indexOf("mp4a.40.34")!==-1&&(B.audioCodec=void 0);var H=B.bitrate+"-"+B.attrs.RESOLUTION+"-"+B.attrs.CODECS;f=m[H],f?f.url.push(B.url):(f=new a.Level(B),m[H]=f,h.push(f)),F&&(F.AUDIO&&Object(C.addGroupId)(f,"audio",F.AUDIO),F.SUBTITLES&&Object(C.addGroupId)(f,"text",F.SUBTITLES))}),(g||y)&&R&&(h=h.filter(function(B){var F=B.videoCodec,H=B.width,j=B.height;return!!F||!!(H&&j)})),h=h.filter(function(B){var F=B.audioCodec,H=B.videoCodec;return(!F||Object(O.isCodecSupportedInMp4)(F,"audio"))&&(!H||Object(O.isCodecSupportedInMp4)(H,"video"))}),s.audioTracks&&(E=s.audioTracks.filter(function(B){return!B.audioCodec||Object(O.isCodecSupportedInMp4)(B.audioCodec,"audio")}),Object(C.assignTrackIdsByGroup)(E)),s.subtitles&&(n=s.subtitles,Object(C.assignTrackIdsByGroup)(n)),h.length>0){d=h[0].bitrate,h.sort(function(B,F){return B.bitrate-F.bitrate}),this._levels=h;for(var L=0;L<h.length;L++)if(h[L].bitrate===d){this._firstLevel=L,this.log("manifest loaded, "+h.length+" level(s) found, first bitrate: "+d);break}var P=R&&!y,N={levels:h,audioTracks:E,subtitleTracks:n,firstLevel:this._firstLevel,stats:s.stats,audio:R,video:y,altAudio:!P&&E.some(function(B){return!!B.url})};this.hls.trigger(o.Events.MANIFEST_PARSED,N),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(o.Events.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:s.url,reason:"no level with compatible codecs found in manifest"})},p.onError=function(l,s){var h;if(i.prototype.onError.call(this,l,s),!s.fatal){var E=s.context,n=this._levels[this.currentLevelIndex];if(E&&(E.type===D.PlaylistContextType.AUDIO_TRACK&&n.audioGroupIds&&E.groupId===n.audioGroupIds[n.urlId]||E.type===D.PlaylistContextType.SUBTITLE_TRACK&&n.textGroupIds&&E.groupId===n.textGroupIds[n.urlId])){this.redundantFailover(this.currentLevelIndex);return}var d=!1,m=!0,f;switch(s.details){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:case c.ErrorDetails.KEY_LOAD_ERROR:case c.ErrorDetails.KEY_LOAD_TIMEOUT:if(s.frag){var g=s.frag.type===D.PlaylistLevelType.MAIN?s.frag.level:this.currentLevelIndex,y=this._levels[g];y?(y.fragmentError++,y.fragmentError>this.hls.config.fragLoadingMaxRetry&&(f=g)):f=g}break;case c.ErrorDetails.LEVEL_LOAD_ERROR:case c.ErrorDetails.LEVEL_LOAD_TIMEOUT:E&&(E.deliveryDirectives&&(m=!1),f=E.level),d=!0;break;case c.ErrorDetails.REMUX_ALLOC_ERROR:f=(h=s.level)!=null?h:this.currentLevelIndex,d=!0;break}f!==void 0&&this.recoverLevel(s,f,d,m)}},p.recoverLevel=function(l,s,h,E){var n=l.details,d=this._levels[s];if(d.loadError++,h){var m=this.retryLoadingOrFail(l);if(m)l.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(E){var f=d.url.length;if(f>1&&d.loadError<f)l.levelRetry=!0,this.redundantFailover(s);else if(this.manualLevelIndex===-1){for(var g=-1,y=this._levels,R=y.length;R--;){var L=(R+this.currentLevelIndex)%y.length;if(L!==this.currentLevelIndex&&y[L].loadError===0){g=L;break}}g>-1&&this.currentLevelIndex!==g&&(this.warn(n+": switch to "+g),l.levelRetry=!0,this.hls.nextAutoLevel=g)}}},p.redundantFailover=function(l){var s=this._levels[l],h=s.url.length;if(h>1){var E=(s.urlId+1)%h;this.warn("Switching to redundant URL-id "+E),this._levels.forEach(function(n){n.urlId=E}),this.level=l}},p.onFragLoaded=function(l,s){var h=s.frag;if(h!==void 0&&h.type===D.PlaylistLevelType.MAIN){var E=this._levels[h.level];E!==void 0&&(E.fragmentError=0,E.loadError=0)}},p.onLevelLoaded=function(l,s){var h,E=s.level,n=s.details,d=this._levels[E];if(!d){var m;this.warn("Invalid level index "+E),(m=s.deliveryDirectives)!==null&&m!==void 0&&m.skip&&(n.deltaUpdateFailed=!0);return}E===this.currentLevelIndex?(d.fragmentError===0&&(d.loadError=0,this.retryCount=0),this.playlistLoaded(E,s,d.details)):(h=s.deliveryDirectives)!==null&&h!==void 0&&h.skip&&(n.deltaUpdateFailed=!0)},p.onAudioTrackSwitched=function(l,s){var h=this.hls.levels[this.currentLevelIndex];if(!!h&&h.audioGroupIds){for(var E=-1,n=this.hls.audioTracks[s.id].groupId,d=0;d<h.audioGroupIds.length;d++)if(h.audioGroupIds[d]===n){E=d;break}E!==h.urlId&&(h.urlId=E,this.startLoad())}},p.loadPlaylist=function(l){var s=this.currentLevelIndex,h=this._levels[s];if(this.canLoad&&h&&h.url.length>0){var E=h.urlId,n=h.url[E];if(l)try{n=l.addDirectives(n)}catch(d){this.warn("Could not construct new URL with HLS Delivery Directives: "+d)}this.log("Attempt loading level index "+s+(l?" at sn "+l.msn+" part "+l.part:"")+" with URL-id "+E+" "+n),this.clearTimer(),this.hls.trigger(o.Events.LEVEL_LOADING,{url:n,level:s,id:E,deliveryDirectives:l||null})}},p.removeLevel=function(l,s){var h=function(d,m){return m!==s},E=this._levels.filter(function(n,d){return d!==l?!0:n.url.length>1&&s!==void 0?(n.url=n.url.filter(h),n.audioGroupIds&&(n.audioGroupIds=n.audioGroupIds.filter(h)),n.textGroupIds&&(n.textGroupIds=n.textGroupIds.filter(h)),n.urlId=0,!0):!1}).map(function(n,d){var m=n.details;return m!=null&&m.fragments&&m.fragments.forEach(function(f){f.level=d}),n});this._levels=E,this.hls.trigger(o.Events.LEVELS_UPDATED,{levels:E})},I(u,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(l){var s,h=this._levels;if(h.length!==0&&!(this.currentLevelIndex===l&&(s=h[l])!==null&&s!==void 0&&s.details)){if(l<0||l>=h.length){var E=l<0;if(this.hls.trigger(o.Events.ERROR,{type:c.ErrorTypes.OTHER_ERROR,details:c.ErrorDetails.LEVEL_SWITCH_ERROR,level:l,fatal:E,reason:"invalid level idx"}),E)return;l=Math.min(l,h.length-1)}this.clearTimer();var n=this.currentLevelIndex,d=h[n],m=h[l];this.log("switching to level "+l+" from "+n),this.currentLevelIndex=l;var f=A({},m,{level:l,maxBitrate:m.maxBitrate,uri:m.uri,urlId:m.urlId});delete f._urlId,this.hls.trigger(o.Events.LEVEL_SWITCHING,f);var g=m.details;if(!g||g.live){var y=this.switchParams(m.uri,d==null?void 0:d.details);this.loadPlaylist(y)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(l){this.manualLevelIndex=l,this._startLevel===void 0&&(this._startLevel=l),l!==-1&&(this.level=l)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(l){this._firstLevel=l}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var l=this.hls.config.startLevel;return l!==void 0?l:this._firstLevel}else return this._startLevel},set:function(l){this._startLevel=l}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(l){this.level=l,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=l)}}]),u}(M.default)},"./src/controller/level-helper.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"addGroupId",function(){return C}),r.d(e,"assignTrackIdsByGroup",function(){return M}),r.d(e,"updatePTS",function(){return D}),r.d(e,"updateFragPTSDTS",function(){return _}),r.d(e,"mergeDetails",function(){return I}),r.d(e,"mapPartIntersection",function(){return T}),r.d(e,"mapFragmentIntersection",function(){return x}),r.d(e,"adjustSliding",function(){return v}),r.d(e,"addSliding",function(){return i}),r.d(e,"computeReloadInterval",function(){return u}),r.d(e,"getFragmentWithSN",function(){return p}),r.d(e,"getPartWith",function(){return b});var a=r("./src/polyfills/number.ts"),o=r("./src/utils/logger.ts"),c=r("./src/loader/date-range.ts");function O(){return O=Object.assign?Object.assign.bind():function(l){for(var s=1;s<arguments.length;s++){var h=arguments[s];for(var E in h)Object.prototype.hasOwnProperty.call(h,E)&&(l[E]=h[E])}return l},O.apply(this,arguments)}function C(l,s,h){switch(s){case"audio":l.audioGroupIds||(l.audioGroupIds=[]),l.audioGroupIds.push(h);break;case"text":l.textGroupIds||(l.textGroupIds=[]),l.textGroupIds.push(h);break}}function M(l){var s={};l.forEach(function(h){var E=h.groupId||"";h.id=s[E]=s[E]||0,s[E]++})}function D(l,s,h){var E=l[s],n=l[h];A(E,n)}function A(l,s){var h=s.startPTS;if(Object(a.isFiniteNumber)(h)){var E=0,n;s.sn>l.sn?(E=h-l.start,n=l):(E=l.start-h,n=s),n.duration!==E&&(n.duration=E)}else if(s.sn>l.sn){var d=l.cc===s.cc;d&&l.minEndPTS?s.start=l.start+(l.minEndPTS-l.start):s.start=l.start+l.duration}else s.start=Math.max(l.start-s.duration,0)}function _(l,s,h,E,n,d){var m=E-h;m<=0&&(o.logger.warn("Fragment should have a positive duration",s),E=h+s.duration,d=n+s.duration);var f=h,g=E,y=s.startPTS,R=s.endPTS;if(Object(a.isFiniteNumber)(y)){var L=Math.abs(y-h);Object(a.isFiniteNumber)(s.deltaPTS)?s.deltaPTS=Math.max(L,s.deltaPTS):s.deltaPTS=L,f=Math.max(h,y),h=Math.min(h,y),n=Math.min(n,s.startDTS),g=Math.min(E,R),E=Math.max(E,R),d=Math.max(d,s.endDTS)}s.duration=E-h;var P=h-s.start;s.appendedPTS=E,s.start=s.startPTS=h,s.maxStartPTS=f,s.startDTS=n,s.endPTS=E,s.minEndPTS=g,s.endDTS=d;var N=s.sn;if(!l||N<l.startSN||N>l.endSN)return 0;var B,F=N-l.startSN,H=l.fragments;for(H[F]=s,B=F;B>0;B--)A(H[B],H[B-1]);for(B=F;B<H.length-1;B++)A(H[B],H[B+1]);return l.fragmentHint&&A(H[H.length-1],l.fragmentHint),l.PTSKnown=l.alignedSliding=!0,P}function I(l,s){for(var h=null,E=l.fragments,n=E.length-1;n>=0;n--){var d=E[n].initSegment;if(d){h=d;break}}l.fragmentHint&&delete l.fragmentHint.endPTS;var m=0,f;if(x(l,s,function(B,F){B.relurl&&(m=B.cc-F.cc),Object(a.isFiniteNumber)(B.startPTS)&&Object(a.isFiniteNumber)(B.endPTS)&&(F.start=F.startPTS=B.startPTS,F.startDTS=B.startDTS,F.appendedPTS=B.appendedPTS,F.maxStartPTS=B.maxStartPTS,F.endPTS=B.endPTS,F.endDTS=B.endDTS,F.minEndPTS=B.minEndPTS,F.duration=B.endPTS-B.startPTS,F.duration&&(f=F),s.PTSKnown=s.alignedSliding=!0),F.elementaryStreams=B.elementaryStreams,F.loader=B.loader,F.stats=B.stats,F.urlId=B.urlId,B.initSegment&&(F.initSegment=B.initSegment,h=B.initSegment)}),h){var g=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments;g.forEach(function(B){var F;(!B.initSegment||B.initSegment.relurl===((F=h)===null||F===void 0?void 0:F.relurl))&&(B.initSegment=h)})}if(s.skippedSegments)if(s.deltaUpdateFailed=s.fragments.some(function(B){return!B}),s.deltaUpdateFailed){o.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var y=s.skippedSegments;y--;)s.fragments.shift();s.startSN=s.fragments[0].sn,s.startCC=s.fragments[0].cc}else s.canSkipDateRanges&&(s.dateRanges=S(l.dateRanges,s.dateRanges,s.recentlyRemovedDateranges));var R=s.fragments;if(m){o.logger.warn("discontinuity sliding from playlist, take drift into account");for(var L=0;L<R.length;L++)R[L].cc+=m}s.skippedSegments&&(s.startCC=s.fragments[0].cc),T(l.partList,s.partList,function(B,F){F.elementaryStreams=B.elementaryStreams,F.stats=B.stats}),f?_(s,f,f.startPTS,f.endPTS,f.startDTS,f.endDTS):v(l,s),R.length&&(s.totalduration=s.edge-R[0].start),s.driftStartTime=l.driftStartTime,s.driftStart=l.driftStart;var P=s.advancedDateTime;if(s.advanced&&P){var N=s.edge;s.driftStart||(s.driftStartTime=P,s.driftStart=N),s.driftEndTime=P,s.driftEnd=N}else s.driftEndTime=l.driftEndTime,s.driftEnd=l.driftEnd,s.advancedDateTime=l.advancedDateTime}function S(l,s,h){var E=O({},l);return h&&h.forEach(function(n){delete E[n]}),Object.keys(s).forEach(function(n){var d=new c.DateRange(s[n].attr,E[n]);d.isValid?E[n]=d:o.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(s[n].attr)+'"')}),E}function T(l,s,h){if(l&&s)for(var E=0,n=0,d=l.length;n<=d;n++){var m=l[n],f=s[n+E];m&&f&&m.index===f.index&&m.fragment.sn===f.fragment.sn?h(m,f):E--}}function x(l,s,h){for(var E=s.skippedSegments,n=Math.max(l.startSN,s.startSN)-s.startSN,d=(l.fragmentHint?1:0)+(E?s.endSN:Math.min(l.endSN,s.endSN))-s.startSN,m=s.startSN-l.startSN,f=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments,g=l.fragmentHint?l.fragments.concat(l.fragmentHint):l.fragments,y=n;y<=d;y++){var R=g[m+y],L=f[y];E&&!L&&y<E&&(L=s.fragments[y]=R),R&&L&&h(R,L)}}function v(l,s){var h=s.startSN+s.skippedSegments-l.startSN,E=l.fragments;h<0||h>=E.length||i(s,E[h].start)}function i(l,s){if(s){for(var h=l.fragments,E=l.skippedSegments;E<h.length;E++)h[E].start+=s;l.fragmentHint&&(l.fragmentHint.start+=s)}}function u(l,s){var h=1e3*l.levelTargetDuration,E=h/2,n=l.age,d=n>0&&n<h*3,m=s.loading.end-s.loading.start,f,g=l.availabilityDelay;if(l.updated===!1)if(d){var y=333*l.misses;f=Math.max(Math.min(E,m*2),y),l.availabilityDelay=(l.availabilityDelay||0)+f}else f=E;else d?(g=Math.min(g||h/2,n),l.availabilityDelay=g,f=g+h-n):f=h-m;return Math.round(f)}function p(l,s,h){if(!l||!l.details)return null;var E=l.details,n=E.fragments[s-E.startSN];return n||(n=E.fragmentHint,n&&n.sn===s)?n:s<E.startSN&&h&&h.sn===s?h:null}function b(l,s,h){if(!l||!l.details)return null;var E=l.details.partList;if(E)for(var n=E.length;n--;){var d=E[n];if(d.index===h&&d.fragment.sn===s)return d}return null}},"./src/controller/stream-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return b});var a=r("./src/polyfills/number.ts"),o=r("./src/controller/base-stream-controller.ts"),c=r("./src/is-supported.ts"),O=r("./src/events.ts"),C=r("./src/utils/buffer-helper.ts"),M=r("./src/controller/fragment-tracker.ts"),D=r("./src/types/loader.ts"),A=r("./src/loader/fragment.ts"),_=r("./src/demux/transmuxer-interface.ts"),I=r("./src/types/transmuxer.ts"),S=r("./src/controller/gap-controller.ts"),T=r("./src/errors.ts");function x(l,s){for(var h=0;h<s.length;h++){var E=s[h];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(l,E.key,E)}}function v(l,s,h){return s&&x(l.prototype,s),h&&x(l,h),Object.defineProperty(l,"prototype",{writable:!1}),l}function i(l,s){l.prototype=Object.create(s.prototype),l.prototype.constructor=l,u(l,s)}function u(l,s){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(E,n){return E.__proto__=n,E},u(l,s)}var p=100,b=function(l){i(s,l);function s(E,n){var d;return d=l.call(this,E,n,"[stream-controller]")||this,d.audioCodecSwap=!1,d.gapController=null,d.level=-1,d._forceStartLoad=!1,d.altAudio=!1,d.audioOnly=!1,d.fragPlaying=null,d.onvplaying=null,d.onvseeked=null,d.fragLastKbps=0,d.couldBacktrack=!1,d.backtrackFragment=null,d.audioCodecSwitch=!1,d.videoBuffer=null,d._registerListeners(),d}var h=s.prototype;return h._registerListeners=function(){var n=this.hls;n.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(O.Events.LEVEL_LOADING,this.onLevelLoading,this),n.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(O.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),n.on(O.Events.ERROR,this.onError,this),n.on(O.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.on(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),n.on(O.Events.BUFFER_CREATED,this.onBufferCreated,this),n.on(O.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.on(O.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),n.on(O.Events.FRAG_BUFFERED,this.onFragBuffered,this)},h._unregisterListeners=function(){var n=this.hls;n.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(O.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),n.off(O.Events.ERROR,this.onError,this),n.off(O.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.off(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),n.off(O.Events.BUFFER_CREATED,this.onBufferCreated,this),n.off(O.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.off(O.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),n.off(O.Events.FRAG_BUFFERED,this.onFragBuffered,this)},h.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},h.startLoad=function(n){if(this.levels){var d=this.lastCurrentTime,m=this.hls;if(this.stopLoad(),this.setInterval(p),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var f=m.startLevel;f===-1&&(m.config.testBandwidth&&this.levels.length>1?(f=0,this.bitrateTest=!0):f=m.nextAutoLevel),this.level=m.nextLoadLevel=f,this.loadedmetadata=!1}d>0&&n===-1&&(this.log("Override startPosition with lastCurrentTime @"+d.toFixed(3)),n=d),this.state=o.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=n,this.tick()}else this._forceStartLoad=!0,this.state=o.State.STOPPED},h.stopLoad=function(){this._forceStartLoad=!1,l.prototype.stopLoad.call(this)},h.doTick=function(){switch(this.state){case o.State.IDLE:this.doTickIdle();break;case o.State.WAITING_LEVEL:{var n,d=this.levels,m=this.level,f=d==null||(n=d[m])===null||n===void 0?void 0:n.details;if(f&&(!f.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(f))break;this.state=o.State.IDLE;break}break}case o.State.FRAG_LOADING_WAITING_RETRY:{var g,y=self.performance.now(),R=this.retryDate;(!R||y>=R||(g=this.media)!==null&&g!==void 0&&g.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=o.State.IDLE)}break;default:break}this.onTickEnd()},h.onTickEnd=function(){l.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},h.doTickIdle=function(){var n,d,m=this.hls,f=this.levelLastLoaded,g=this.levels,y=this.media,R=m.config,L=m.nextLoadLevel;if(!(f===null||!y&&(this.startFragRequested||!R.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!g||!g[L])){var P=g[L];this.level=m.nextLoadLevel=L;var N=P.details;if(!N||this.state===o.State.WAITING_LEVEL||N.live&&this.levelLastLoaded!==L){this.state=o.State.WAITING_LEVEL;return}var B=this.getMainFwdBufferInfo();if(B!==null){var F=B.len,H=this.getMaxBufferLength(P.maxBitrate);if(!(F>=H)){if(this._streamEnded(B,N)){var j={};this.altAudio&&(j.type="video"),this.hls.trigger(O.Events.BUFFER_EOS,j),this.state=o.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>B.end&&(this.backtrackFragment=null);var X=this.backtrackFragment?this.backtrackFragment.start:B.end,$=this.getNextFragment(X,N);if(this.couldBacktrack&&!this.fragPrevious&&$&&$.sn!=="initSegment"&&this.fragmentTracker.getState($)!==M.FragmentState.OK){var G,J=((G=this.backtrackFragment)!=null?G:$).sn,ee=J-N.startSN,te=N.fragments[ee-1];te&&$.cc===te.cc&&($=te,this.fragmentTracker.removeFragment(te))}else this.backtrackFragment&&B.len&&(this.backtrackFragment=null);if($&&this.fragmentTracker.getState($)===M.FragmentState.OK&&this.nextLoadPosition>X){var oe=this.audioOnly&&!this.altAudio?A.ElementaryStreamTypes.AUDIO:A.ElementaryStreamTypes.VIDEO;y&&this.afterBufferFlushed(y,oe,D.PlaylistLevelType.MAIN),$=this.getNextFragment(this.nextLoadPosition,N)}!$||($.initSegment&&!$.initSegment.data&&!this.bitrateTest&&($=$.initSegment),((n=$.decryptdata)===null||n===void 0?void 0:n.keyFormat)==="identity"&&!((d=$.decryptdata)!==null&&d!==void 0&&d.key)?this.loadKey($,N):this.loadFragment($,N,X))}}}},h.loadFragment=function(n,d,m){var f,g=this.fragmentTracker.getState(n);this.fragCurrent=n,g===M.FragmentState.NOT_LOADED?n.sn==="initSegment"?this._loadInitSegment(n):this.bitrateTest?(this.log("Fragment "+n.sn+" of level "+n.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(n)):(this.startFragRequested=!0,l.prototype.loadFragment.call(this,n,d,m)):g===M.FragmentState.APPENDING?this.reduceMaxBufferLength(n.duration)&&this.fragmentTracker.removeFragment(n):((f=this.media)===null||f===void 0?void 0:f.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},h.getAppendedFrag=function(n){var d=this.fragmentTracker.getAppendedFrag(n,D.PlaylistLevelType.MAIN);return d&&"fragment"in d?d.fragment:d},h.getBufferedFrag=function(n){return this.fragmentTracker.getBufferedFrag(n,D.PlaylistLevelType.MAIN)},h.followingBufferedFrag=function(n){return n?this.getBufferedFrag(n.end+.5):null},h.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},h.nextLevelSwitch=function(){var n=this.levels,d=this.media;if(d!=null&&d.readyState){var m,f=this.getAppendedFrag(d.currentTime);if(f&&f.start>1&&this.flushMainBuffer(0,f.start-1),!d.paused&&n){var g=this.hls.nextLoadLevel,y=n[g],R=this.fragLastKbps;R&&this.fragCurrent?m=this.fragCurrent.duration*y.maxBitrate/(1e3*R)+1:m=0}else m=0;var L=this.getBufferedFrag(d.currentTime+m);if(L){var P=this.followingBufferedFrag(L);if(P){this.abortCurrentFrag();var N=P.maxStartPTS?P.maxStartPTS:P.start,B=P.duration,F=Math.max(L.end,N+Math.min(Math.max(B-this.config.maxFragLookUpTolerance,B*.5),B*.75));this.flushMainBuffer(F,Number.POSITIVE_INFINITY)}}}},h.abortCurrentFrag=function(){var n=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,n!=null&&n.loader&&n.loader.abort(),this.state){case o.State.KEY_LOADING:case o.State.FRAG_LOADING:case o.State.FRAG_LOADING_WAITING_RETRY:case o.State.PARSING:case o.State.PARSED:this.state=o.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},h.flushMainBuffer=function(n,d){l.prototype.flushMainBuffer.call(this,n,d,this.altAudio?"video":null)},h.onMediaAttached=function(n,d){l.prototype.onMediaAttached.call(this,n,d);var m=d.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),m.addEventListener("playing",this.onvplaying),m.addEventListener("seeked",this.onvseeked),this.gapController=new S.default(this.config,m,this.fragmentTracker,this.hls)},h.onMediaDetaching=function(){var n=this.media;n&&this.onvplaying&&this.onvseeked&&(n.removeEventListener("playing",this.onvplaying),n.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),l.prototype.onMediaDetaching.call(this)},h.onMediaPlaying=function(){this.tick()},h.onMediaSeeked=function(){var n=this.media,d=n?n.currentTime:null;Object(a.isFiniteNumber)(d)&&this.log("Media seeked to "+d.toFixed(3)),this.tick()},h.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(O.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},h.onManifestParsed=function(n,d){var m=!1,f=!1,g;d.levels.forEach(function(y){g=y.audioCodec,g&&(g.indexOf("mp4a.40.2")!==-1&&(m=!0),g.indexOf("mp4a.40.5")!==-1&&(f=!0))}),this.audioCodecSwitch=m&&f&&!Object(c.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=d.levels,this.startFragRequested=!1},h.onLevelLoading=function(n,d){var m=this.levels;if(!(!m||this.state!==o.State.IDLE)){var f=m[d.level];(!f.details||f.details.live&&this.levelLastLoaded!==d.level||this.waitForCdnTuneIn(f.details))&&(this.state=o.State.WAITING_LEVEL)}},h.onLevelLoaded=function(n,d){var m,f=this.levels,g=d.level,y=d.details,R=y.totalduration;if(!f){this.warn("Levels were reset while loading level "+g);return}this.log("Level "+g+" loaded ["+y.startSN+","+y.endSN+"], cc ["+y.startCC+", "+y.endCC+"] duration:"+R);var L=this.fragCurrent;L&&(this.state===o.State.FRAG_LOADING||this.state===o.State.FRAG_LOADING_WAITING_RETRY)&&L.level!==d.level&&L.loader&&(this.state=o.State.IDLE,this.backtrackFragment=null,L.loader.abort());var P=f[g],N=0;if(y.live||(m=P.details)!==null&&m!==void 0&&m.live){if(y.fragments[0]||(y.deltaUpdateFailed=!0),y.deltaUpdateFailed)return;N=this.alignPlaylists(y,P.details)}if(P.details=y,this.levelLastLoaded=g,this.hls.trigger(O.Events.LEVEL_UPDATED,{details:y,level:g}),this.state===o.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(y))return;this.state=o.State.IDLE}this.startFragRequested?y.live&&this.synchronizeToLiveEdge(y):this.setStartPosition(y,N),this.tick()},h._handleFragmentLoadProgress=function(n){var d,m=n.frag,f=n.part,g=n.payload,y=this.levels;if(!y){this.warn("Levels were reset while fragment load was in progress. Fragment "+m.sn+" of level "+m.level+" will not be buffered");return}var R=y[m.level],L=R.details;if(!L){this.warn("Dropping fragment "+m.sn+" of level "+m.level+" after level details were reset");return}var P=R.videoCodec,N=L.PTSKnown||!L.live,B=(d=m.initSegment)===null||d===void 0?void 0:d.data,F=this._getAudioCodec(R),H=this.transmuxer=this.transmuxer||new _.default(this.hls,D.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),j=f?f.index:-1,X=j!==-1,$=new I.ChunkMetadata(m.level,m.sn,m.stats.chunkCount,g.byteLength,j,X),G=this.initPTS[m.cc];H.push(g,B,F,P,m,f,L.totalduration,N,$,G)},h.onAudioTrackSwitching=function(n,d){var m=this.altAudio,f=!!d.url,g=d.id;if(!f){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var y=this.fragCurrent;y!=null&&y.loader&&(this.log("Switching to main audio track, cancel main fragment load"),y.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var R=this.hls;m&&R.trigger(O.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),R.trigger(O.Events.AUDIO_TRACK_SWITCHED,{id:g})}},h.onAudioTrackSwitched=function(n,d){var m=d.id,f=!!this.hls.audioTracks[m].url;if(f){var g=this.videoBuffer;g&&this.mediaBuffer!==g&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=g)}this.altAudio=f,this.tick()},h.onBufferCreated=function(n,d){var m=d.tracks,f,g,y=!1;for(var R in m){var L=m[R];if(L.id==="main"){if(g=R,f=L,R==="video"){var P=m[R];P&&(this.videoBuffer=P.buffer)}}else y=!0}y&&f?(this.log("Alternate track found, use "+g+".buffered to schedule main fragment loading"),this.mediaBuffer=f.buffer):this.mediaBuffer=this.media},h.onFragBuffered=function(n,d){var m=d.frag,f=d.part;if(!(m&&m.type!==D.PlaylistLevelType.MAIN)){if(this.fragContextChanged(m)){this.warn("Fragment "+m.sn+(f?" p: "+f.index:"")+" of level "+m.level+" finished buffering, but was aborted. state: "+this.state),this.state===o.State.PARSED&&(this.state=o.State.IDLE);return}var g=f?f.stats:m.stats;this.fragLastKbps=Math.round(8*g.total/(g.buffering.end-g.loading.first)),m.sn!=="initSegment"&&(this.fragPrevious=m),this.fragBufferedComplete(m,f)}},h.onError=function(n,d){switch(d.details){case T.ErrorDetails.FRAG_LOAD_ERROR:case T.ErrorDetails.FRAG_LOAD_TIMEOUT:case T.ErrorDetails.KEY_LOAD_ERROR:case T.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(D.PlaylistLevelType.MAIN,d);break;case T.ErrorDetails.LEVEL_LOAD_ERROR:case T.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==o.State.ERROR&&(d.fatal?(this.warn(""+d.details),this.state=o.State.ERROR):!d.levelRetry&&this.state===o.State.WAITING_LEVEL&&(this.state=o.State.IDLE));break;case T.ErrorDetails.BUFFER_FULL_ERROR:if(d.parent==="main"&&(this.state===o.State.PARSING||this.state===o.State.PARSED)){var m=!0,f=this.getFwdBufferInfo(this.media,D.PlaylistLevelType.MAIN);f&&f.len>.5&&(m=!this.reduceMaxBufferLength(f.len)),m&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break;default:break}},h.checkBuffer=function(){var n=this.media,d=this.gapController;if(!(!n||!d||!n.readyState)){if(this.loadedmetadata||!C.BufferHelper.getBuffered(n).length){var m=this.state!==o.State.IDLE?this.fragCurrent:null;d.poll(this.lastCurrentTime,m)}this.lastCurrentTime=n.currentTime}},h.onFragLoadEmergencyAborted=function(){this.state=o.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},h.onBufferFlushed=function(n,d){var m=d.type;if(m!==A.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var f=(m===A.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(f,m,D.PlaylistLevelType.MAIN)}},h.onLevelsUpdated=function(n,d){this.levels=d.levels},h.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},h.seekToStartPos=function(){var n=this.media;if(!!n){var d=n.currentTime,m=this.startPosition;if(m>=0&&d<m){if(n.seeking){this.log("could not seek to "+m+", already seeking at "+d);return}var f=C.BufferHelper.getBuffered(n),g=f.length?f.start(0):0,y=g-m;y>0&&(y<this.config.maxBufferHole||y<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+y+" to match buffer start"),m+=y,this.startPosition=m),this.log("seek to target start position "+m+" from current time "+d),n.currentTime=m}}},h._getAudioCodec=function(n){var d=this.config.defaultAudioCodec||n.audioCodec;return this.audioCodecSwap&&d&&(this.log("Swapping audio codec"),d.indexOf("mp4a.40.5")!==-1?d="mp4a.40.2":d="mp4a.40.5"),d},h._loadBitrateTestFrag=function(n){var d=this;n.bitrateTest=!0,this._doFragLoad(n).then(function(m){var f=d.hls;if(!(!m||f.nextLoadLevel||d.fragContextChanged(n))){d.fragLoadError=0,d.state=o.State.IDLE,d.startFragRequested=!1,d.bitrateTest=!1;var g=n.stats;g.parsing.start=g.parsing.end=g.buffering.start=g.buffering.end=self.performance.now(),f.trigger(O.Events.FRAG_LOADED,m),n.bitrateTest=!1}})},h._handleTransmuxComplete=function(n){var d,m="main",f=this.hls,g=n.remuxResult,y=n.chunkMeta,R=this.getCurrentContext(y);if(!R){this.warn("The loading context changed while buffering fragment "+y.sn+" of level "+y.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(y.level);return}var L=R.frag,P=R.part,N=R.level,B=g.video,F=g.text,H=g.id3,j=g.initSegment,X=N.details,$=this.altAudio?void 0:g.audio;if(!this.fragContextChanged(L)){if(this.state=o.State.PARSING,j){j.tracks&&(this._bufferInitSegment(N,j.tracks,L,y),f.trigger(O.Events.FRAG_PARSING_INIT_SEGMENT,{frag:L,id:m,tracks:j.tracks}));var G=j.initPTS,J=j.timescale;Object(a.isFiniteNumber)(G)&&(this.initPTS[L.cc]=G,f.trigger(O.Events.INIT_PTS_FOUND,{frag:L,id:m,initPTS:G,timescale:J}))}if(B&&g.independent!==!1){if(X){var ee=B.startPTS,te=B.endPTS,oe=B.startDTS,ue=B.endDTS;if(P)P.elementaryStreams[B.type]={startPTS:ee,endPTS:te,startDTS:oe,endDTS:ue};else if(B.firstKeyFrame&&B.independent&&(this.couldBacktrack=!0),B.dropped&&B.independent){var ae=this.getMainFwdBufferInfo(),he=(ae?ae.end:this.getLoadPosition())+this.config.maxBufferHole,me=B.firstKeyFramePTS?B.firstKeyFramePTS:ee;if(he<me-this.config.maxBufferHole){this.backtrack(L);return}L.setElementaryStreamInfo(B.type,L.start,te,L.start,ue,!0)}L.setElementaryStreamInfo(B.type,ee,te,oe,ue),this.backtrackFragment&&(this.backtrackFragment=L),this.bufferFragmentData(B,L,P,y)}}else if(g.independent===!1){this.backtrack(L);return}if($){var ne=$.startPTS,Me=$.endPTS,_e=$.startDTS,Se=$.endDTS;P&&(P.elementaryStreams[A.ElementaryStreamTypes.AUDIO]={startPTS:ne,endPTS:Me,startDTS:_e,endDTS:Se}),L.setElementaryStreamInfo(A.ElementaryStreamTypes.AUDIO,ne,Me,_e,Se),this.bufferFragmentData($,L,P,y)}if(X&&H!==null&&H!==void 0&&(d=H.samples)!==null&&d!==void 0&&d.length){var be={id:m,frag:L,details:X,samples:H.samples};f.trigger(O.Events.FRAG_PARSING_METADATA,be)}if(X&&F){var Ue={id:m,frag:L,details:X,samples:F.samples};f.trigger(O.Events.FRAG_PARSING_USERDATA,Ue)}}},h._bufferInitSegment=function(n,d,m,f){var g=this;if(this.state===o.State.PARSING){this.audioOnly=!!d.audio&&!d.video,this.altAudio&&!this.audioOnly&&delete d.audio;var y=d.audio,R=d.video,L=d.audiovideo;if(y){var P=n.audioCodec,N=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(P&&(P.indexOf("mp4a.40.5")!==-1?P="mp4a.40.2":P="mp4a.40.5"),y.metadata.channelCount!==1&&N.indexOf("firefox")===-1&&(P="mp4a.40.5")),N.indexOf("android")!==-1&&y.container!=="audio/mpeg"&&(P="mp4a.40.2",this.log("Android: force audio codec to "+P)),n.audioCodec&&n.audioCodec!==P&&this.log('Swapping manifest audio codec "'+n.audioCodec+'" for "'+P+'"'),y.levelCodec=P,y.id="main",this.log("Init audio buffer, container:"+y.container+", codecs[selected/level/parsed]=["+(P||"")+"/"+(n.audioCodec||"")+"/"+y.codec+"]")}R&&(R.levelCodec=n.videoCodec,R.id="main",this.log("Init video buffer, container:"+R.container+", codecs[level/parsed]=["+(n.videoCodec||"")+"/"+R.codec+"]")),L&&this.log("Init audiovideo buffer, container:"+L.container+", codecs[level/parsed]=["+(n.attrs.CODECS||"")+"/"+L.codec+"]"),this.hls.trigger(O.Events.BUFFER_CODECS,d),Object.keys(d).forEach(function(B){var F=d[B],H=F.initSegment;H!=null&&H.byteLength&&g.hls.trigger(O.Events.BUFFER_APPENDING,{type:B,data:H,frag:m,part:null,chunkMeta:f,parent:m.type})}),this.tick()}},h.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,D.PlaylistLevelType.MAIN)},h.backtrack=function(n){this.couldBacktrack=!0,this.backtrackFragment=n,this.resetTransmuxer(),this.flushBufferGap(n),this.fragmentTracker.removeFragment(n),this.fragPrevious=null,this.nextLoadPosition=n.start,this.state=o.State.IDLE},h.checkFragmentChanged=function(){var n=this.media,d=null;if(n&&n.readyState>1&&n.seeking===!1){var m=n.currentTime;if(C.BufferHelper.isBuffered(n,m)?d=this.getAppendedFrag(m):C.BufferHelper.isBuffered(n,m+.1)&&(d=this.getAppendedFrag(m+.1)),d){this.backtrackFragment=null;var f=this.fragPlaying,g=d.level;(!f||d.sn!==f.sn||f.level!==g||d.urlId!==f.urlId)&&(this.hls.trigger(O.Events.FRAG_CHANGED,{frag:d}),(!f||f.level!==g)&&this.hls.trigger(O.Events.LEVEL_SWITCHED,{level:g}),this.fragPlaying=d)}}},v(s,[{key:"nextLevel",get:function(){var n=this.nextBufferedFrag;return n?n.level:-1}},{key:"currentFrag",get:function(){var n=this.media;return n?this.fragPlaying||this.getAppendedFrag(n.currentTime):null}},{key:"currentProgramDateTime",get:function(){var n=this.media;if(n){var d=n.currentTime,m=this.currentFrag;if(m&&Object(a.isFiniteNumber)(d)&&Object(a.isFiniteNumber)(m.programDateTime)){var f=m.programDateTime+(d-m.start)*1e3;return new Date(f)}}return null}},{key:"currentLevel",get:function(){var n=this.currentFrag;return n?n.level:-1}},{key:"nextBufferedFrag",get:function(){var n=this.currentFrag;return n?this.followingBufferedFrag(n):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),s}(o.default)},"./src/controller/subtitle-stream-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"SubtitleStreamController",function(){return i});var a=r("./src/events.ts"),o=r("./src/utils/buffer-helper.ts"),c=r("./src/controller/fragment-finders.ts"),O=r("./src/utils/discontinuities.ts"),C=r("./src/controller/level-helper.ts"),M=r("./src/controller/fragment-tracker.ts"),D=r("./src/controller/base-stream-controller.ts"),A=r("./src/types/loader.ts"),_=r("./src/types/level.ts");function I(p,b){for(var l=0;l<b.length;l++){var s=b[l];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(p,s.key,s)}}function S(p,b,l){return b&&I(p.prototype,b),l&&I(p,l),Object.defineProperty(p,"prototype",{writable:!1}),p}function T(p,b){p.prototype=Object.create(b.prototype),p.prototype.constructor=p,x(p,b)}function x(p,b){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s},x(p,b)}var v=500,i=function(p){T(b,p);function b(s,h){var E;return E=p.call(this,s,h,"[subtitle-stream-controller]")||this,E.levels=[],E.currentTrackId=-1,E.tracksBuffered=[],E.mainDetails=null,E._registerListeners(),E}var l=b.prototype;return l.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},l._registerListeners=function(){var h=this.hls;h.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),h.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.on(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),h.on(a.Events.ERROR,this.onError,this),h.on(a.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),h.on(a.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),h.on(a.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),h.on(a.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),h.on(a.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},l._unregisterListeners=function(){var h=this.hls;h.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),h.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.off(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),h.off(a.Events.ERROR,this.onError,this),h.off(a.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),h.off(a.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),h.off(a.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),h.off(a.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),h.off(a.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},l.startLoad=function(){this.stopLoad(),this.state=D.State.IDLE,this.setInterval(v),this.tick()},l.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},l.onLevelLoaded=function(h,E){this.mainDetails=E.details},l.onSubtitleFragProcessed=function(h,E){var n=E.frag,d=E.success;if(this.fragPrevious=n,this.state=D.State.IDLE,!!d){var m=this.tracksBuffered[this.currentTrackId];if(!!m){for(var f,g=n.start,y=0;y<m.length;y++)if(g>=m[y].start&&g<=m[y].end){f=m[y];break}var R=n.start+n.duration;f?f.end=R:(f={start:g,end:R},m.push(f)),this.fragmentTracker.fragBuffered(n)}}},l.onBufferFlushing=function(h,E){var n=E.startOffset,d=E.endOffset;if(n===0&&d!==Number.POSITIVE_INFINITY){var m=this.currentTrackId,f=this.levels;if(!f.length||!f[m]||!f[m].details)return;var g=f[m].details,y=g.targetduration,R=d-y;if(R<=0)return;E.endOffsetSubtitles=Math.max(0,R),this.tracksBuffered.forEach(function(L){for(var P=0;P<L.length;){if(L[P].end<=R){L.shift();continue}else if(L[P].start<R)L[P].start=R;else break;P++}}),this.fragmentTracker.removeFragmentsInRange(n,R,A.PlaylistLevelType.SUBTITLE)}},l.onError=function(h,E){var n,d=E.frag;!d||d.type!==A.PlaylistLevelType.SUBTITLE||((n=this.fragCurrent)!==null&&n!==void 0&&n.loader&&this.fragCurrent.loader.abort(),this.state=D.State.IDLE)},l.onSubtitleTracksUpdated=function(h,E){var n=this,d=E.subtitleTracks;this.tracksBuffered=[],this.levels=d.map(function(m){return new _.Level(m)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(m){n.tracksBuffered[m.id]=[]}),this.mediaBuffer=null},l.onSubtitleTrackSwitch=function(h,E){if(this.currentTrackId=E.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.setInterval(v)},l.onSubtitleTrackLoaded=function(h,E){var n,d=E.details,m=E.id,f=this.currentTrackId,g=this.levels;if(!!g.length){var y=g[f];if(!(m>=g.length||m!==f||!y)){if(this.mediaBuffer=this.mediaBufferTimeRanges,d.live||(n=y.details)!==null&&n!==void 0&&n.live){var R=this.mainDetails;if(d.deltaUpdateFailed||!R)return;var L=R.fragments[0];if(!y.details)d.hasProgramDateTime&&R.hasProgramDateTime?Object(O.alignMediaPlaylistByPDT)(d,R):L&&Object(C.addSliding)(d,L.start);else{var P=this.alignPlaylists(d,y.details);P===0&&L&&Object(C.addSliding)(d,L.start)}}if(y.details=d,this.levelLastLoaded=m,this.tick(),d.live&&!this.fragCurrent&&this.media&&this.state===D.State.IDLE){var N=Object(c.findFragmentByPTS)(null,d.fragments,this.media.currentTime,0);N||(this.warn("Subtitle playlist not aligned with playback"),y.details=void 0)}}}},l._handleFragmentLoadComplete=function(h){var E=h.frag,n=h.payload,d=E.decryptdata,m=this.hls;if(!this.fragContextChanged(E)&&n&&n.byteLength>0&&d&&d.key&&d.iv&&d.method==="AES-128"){var f=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(n),d.key.buffer,d.iv.buffer).then(function(g){var y=performance.now();m.trigger(a.Events.FRAG_DECRYPTED,{frag:E,payload:g,stats:{tstart:f,tdecrypt:y}})})}},l.doTick=function(){if(!this.media){this.state=D.State.IDLE;return}if(this.state===D.State.IDLE){var h=this.currentTrackId,E=this.levels;if(!E.length||!E[h]||!E[h].details)return;var n=E[h].details,d=n.targetduration,m=this.config,f=this.media,g=o.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],f.currentTime-d,m.maxBufferHole),y=g.end,R=g.len,L=this.getMaxBufferLength()+d;if(R>L)return;console.assert(n,"Subtitle track details are defined on idle subtitle stream controller tick");var P=n.fragments,N=P.length,B=n.edge,F,H=this.fragPrevious;if(y<B){var j=m.maxFragLookUpTolerance;F=Object(c.findFragmentByPTS)(H,P,Math.max(P[0].start,y),j),!F&&H&&H.start<P[0].start&&(F=P[0])}else F=P[N-1];if(F=this.mapToInitFragWhenRequired(F),!F||this.fragmentTracker.getState(F)!==M.FragmentState.NOT_LOADED)return;F.encrypted?this.loadKey(F,n):this.loadFragment(F,n,y)}},l.loadFragment=function(h,E,n){this.fragCurrent=h,h.sn==="initSegment"?this._loadInitSegment(h):p.prototype.loadFragment.call(this,h,E,n)},S(b,[{key:"mediaBufferTimeRanges",get:function(){return new u(this.tracksBuffered[this.currentTrackId]||[])}}]),b}(D.default),u=function(b){this.buffered=void 0;var l=function(h,E,n){if(E=E>>>0,E>n-1)throw new DOMException("Failed to execute '"+h+"' on 'TimeRanges': The index provided ("+E+") is greater than the maximum bound ("+n+")");return b[E][h]};this.buffered={get length(){return b.length},end:function(h){return l("end",h,b.length)},start:function(h){return l("start",h,b.length)}}}},"./src/controller/subtitle-track-controller.ts":function(t,e,r){"use strict";r.r(e);var a=r("./src/events.ts"),o=r("./src/utils/texttrack-utils.ts"),c=r("./src/controller/base-playlist-controller.ts"),O=r("./src/types/loader.ts");function C(S,T){for(var x=0;x<T.length;x++){var v=T[x];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(S,v.key,v)}}function M(S,T,x){return T&&C(S.prototype,T),x&&C(S,x),Object.defineProperty(S,"prototype",{writable:!1}),S}function D(S,T){S.prototype=Object.create(T.prototype),S.prototype.constructor=S,A(S,T)}function A(S,T){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,i){return v.__proto__=i,v},A(S,T)}var _=function(S){D(T,S);function T(v){var i;return i=S.call(this,v,"[subtitle-track-controller]")||this,i.media=null,i.tracks=[],i.groupId=null,i.tracksInGroup=[],i.trackId=-1,i.selectDefaultTrack=!0,i.queuedDefaultTrack=-1,i.trackChangeListener=function(){return i.onTextTracksChanged()},i.asyncPollTrackChange=function(){return i.pollTrackChange(0)},i.useTextTrackPolling=!1,i.subtitlePollingInterval=-1,i._subtitleDisplay=!0,i.registerListeners(),i}var x=T.prototype;return x.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,S.prototype.destroy.call(this)},x.registerListeners=function(){var i=this.hls;i.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(a.Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(a.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(a.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.on(a.Events.ERROR,this.onError,this)},x.unregisterListeners=function(){var i=this.hls;i.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(a.Events.LEVEL_LOADING,this.onLevelLoading,this),i.off(a.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(a.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.off(a.Events.ERROR,this.onError,this)},x.onMediaAttached=function(i,u){this.media=u.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},x.pollTrackChange=function(i){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,i)},x.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var i=I(this.media.textTracks);i.forEach(function(u){Object(o.clearCurrentCues)(u)}),this.subtitleTrack=-1,this.media=null}},x.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},x.onManifestParsed=function(i,u){this.tracks=u.subtitleTracks},x.onSubtitleTrackLoaded=function(i,u){var p=u.id,b=u.details,l=this.trackId,s=this.tracksInGroup[l];if(!s){this.warn("Invalid subtitle track id "+p);return}var h=s.details;s.details=u.details,this.log("subtitle track "+p+" loaded ["+b.startSN+"-"+b.endSN+"]"),p===this.trackId&&(this.retryCount=0,this.playlistLoaded(p,u,h))},x.onLevelLoading=function(i,u){this.switchLevel(u.level)},x.onLevelSwitching=function(i,u){this.switchLevel(u.level)},x.switchLevel=function(i){var u=this.hls.levels[i];if(!!(u!=null&&u.textGroupIds)){var p=u.textGroupIds[u.urlId];if(this.groupId!==p){var b=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,l=this.tracks.filter(function(E){return!p||E.groupId===p});this.tracksInGroup=l;var s=this.findTrackId(b==null?void 0:b.name)||this.findTrackId();this.groupId=p;var h={subtitleTracks:l};this.log("Updating subtitle tracks, "+l.length+' track(s) found in "'+p+'" group-id'),this.hls.trigger(a.Events.SUBTITLE_TRACKS_UPDATED,h),s!==-1&&this.setSubtitleTrack(s,b)}}},x.findTrackId=function(i){for(var u=this.tracksInGroup,p=0;p<u.length;p++){var b=u[p];if((!this.selectDefaultTrack||b.default)&&(!i||i===b.name))return b.id}return-1},x.onError=function(i,u){S.prototype.onError.call(this,i,u),!(u.fatal||!u.context)&&u.context.type===O.PlaylistContextType.SUBTITLE_TRACK&&u.context.id===this.trackId&&u.context.groupId===this.groupId&&this.retryLoadingOrFail(u)},x.loadPlaylist=function(i){var u=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(u)){var p=u.id,b=u.groupId,l=u.url;if(i)try{l=i.addDirectives(l)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("Loading subtitle playlist for id "+p),this.hls.trigger(a.Events.SUBTITLE_TRACK_LOADING,{url:l,id:p,groupId:b,deliveryDirectives:i||null})}},x.toggleTrackModes=function(i){var u=this,p=this.media,b=this.trackId;if(!!p){var l=I(p.textTracks),s=l.filter(function(n){return n.groupId===u.groupId});if(i===-1)[].slice.call(l).forEach(function(n){n.mode="disabled"});else{var h=s[b];h&&(h.mode="disabled")}var E=s[i];E&&(E.mode=this.subtitleDisplay?"showing":"hidden")}},x.setSubtitleTrack=function(i,u){var p,b=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=i;return}if(this.trackId!==i&&this.toggleTrackModes(i),!(this.trackId===i&&(i===-1||(p=b[i])!==null&&p!==void 0&&p.details)||i<-1||i>=b.length)){this.clearTimer();var l=b[i];if(this.log("Switching to subtitle track "+i),this.trackId=i,l){var s=l.id,h=l.groupId,E=h===void 0?"":h,n=l.name,d=l.type,m=l.url;this.hls.trigger(a.Events.SUBTITLE_TRACK_SWITCH,{id:s,groupId:E,name:n,type:d,url:m});var f=this.switchParams(l.url,u==null?void 0:u.details);this.loadPlaylist(f)}else this.hls.trigger(a.Events.SUBTITLE_TRACK_SWITCH,{id:i})}},x.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var i=-1,u=I(this.media.textTracks),p=0;p<u.length;p++)if(u[p].mode==="hidden")i=p;else if(u[p].mode==="showing"){i=p;break}this.subtitleTrack!==i&&(this.subtitleTrack=i)}},M(T,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(i){this._subtitleDisplay=i,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(i){this.selectDefaultTrack=!1;var u=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(i,u)}}]),T}(c.default);function I(S){for(var T=[],x=0;x<S.length;x++){var v=S[x];v.kind==="subtitles"&&v.label&&T.push(S[x])}return T}e.default=_},"./src/controller/timeline-controller.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"TimelineController",function(){return S});var a=r("./src/polyfills/number.ts"),o=r("./src/events.ts"),c=r("./src/utils/cea-608-parser.ts"),O=r("./src/utils/output-filter.ts"),C=r("./src/utils/webvtt-parser.ts"),M=r("./src/utils/texttrack-utils.ts"),D=r("./src/utils/imsc1-ttml-parser.ts"),A=r("./src/utils/mp4-tools.ts"),_=r("./src/types/loader.ts"),I=r("./src/utils/logger.ts"),S=function(){function i(p){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=v(),this.captionsProperties=void 0,this.hls=p,this.config=p.config,this.Cues=p.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var b=new O.default(this,"textTrack1"),l=new O.default(this,"textTrack2"),s=new O.default(this,"textTrack3"),h=new O.default(this,"textTrack4");this.cea608Parser1=new c.default(1,b,l),this.cea608Parser2=new c.default(3,s,h)}p.on(o.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),p.on(o.Events.MEDIA_DETACHING,this.onMediaDetaching,this),p.on(o.Events.MANIFEST_LOADING,this.onManifestLoading,this),p.on(o.Events.MANIFEST_LOADED,this.onManifestLoaded,this),p.on(o.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),p.on(o.Events.FRAG_LOADING,this.onFragLoading,this),p.on(o.Events.FRAG_LOADED,this.onFragLoaded,this),p.on(o.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),p.on(o.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),p.on(o.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),p.on(o.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),p.on(o.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var u=i.prototype;return u.destroy=function(){var b=this.hls;b.off(o.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),b.off(o.Events.MEDIA_DETACHING,this.onMediaDetaching,this),b.off(o.Events.MANIFEST_LOADING,this.onManifestLoading,this),b.off(o.Events.MANIFEST_LOADED,this.onManifestLoaded,this),b.off(o.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),b.off(o.Events.FRAG_LOADING,this.onFragLoading,this),b.off(o.Events.FRAG_LOADED,this.onFragLoaded,this),b.off(o.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),b.off(o.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),b.off(o.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),b.off(o.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),b.off(o.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},u.addCues=function(b,l,s,h,E){for(var n=!1,d=E.length;d--;){var m=E[d],f=x(m[0],m[1],l,s);if(f>=0&&(m[0]=Math.min(m[0],l),m[1]=Math.max(m[1],s),n=!0,f/(s-l)>.5))return}if(n||E.push([l,s]),this.config.renderTextTracksNatively){var g=this.captionsTracks[b];this.Cues.newCue(g,l,s,h)}else{var y=this.Cues.newCue(null,l,s,h);this.hls.trigger(o.Events.CUES_PARSED,{type:"captions",cues:y,track:b})}},u.onInitPtsFound=function(b,l){var s=this,h=l.frag,E=l.id,n=l.initPTS,d=l.timescale,m=this.unparsedVttFrags;E==="main"&&(this.initPTS[h.cc]=n,this.timescale[h.cc]=d),m.length&&(this.unparsedVttFrags=[],m.forEach(function(f){s.onFragLoaded(o.Events.FRAG_LOADED,f)}))},u.getExistingTrack=function(b){var l=this.media;if(l)for(var s=0;s<l.textTracks.length;s++){var h=l.textTracks[s];if(h[b])return h}return null},u.createCaptionsTrack=function(b){this.config.renderTextTracksNatively?this.createNativeTrack(b):this.createNonNativeTrack(b)},u.createNativeTrack=function(b){if(!this.captionsTracks[b]){var l=this.captionsProperties,s=this.captionsTracks,h=this.media,E=l[b],n=E.label,d=E.languageCode,m=this.getExistingTrack(b);if(m)s[b]=m,Object(M.clearCurrentCues)(s[b]),Object(M.sendAddTrackEvent)(s[b],h);else{var f=this.createTextTrack("captions",n,d);f&&(f[b]=!0,s[b]=f)}}},u.createNonNativeTrack=function(b){if(!this.nonNativeCaptionsTracks[b]){var l=this.captionsProperties[b];if(!!l){var s=l.label,h={_id:b,label:s,kind:"captions",default:l.media?!!l.media.default:!1,closedCaptions:l.media};this.nonNativeCaptionsTracks[b]=h,this.hls.trigger(o.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[h]})}}},u.createTextTrack=function(b,l,s){var h=this.media;if(!!h)return h.addTextTrack(b,l,s)},u.onMediaAttaching=function(b,l){this.media=l.media,this._cleanTracks()},u.onMediaDetaching=function(){var b=this.captionsTracks;Object.keys(b).forEach(function(l){Object(M.clearCurrentCues)(b[l]),delete b[l]}),this.nonNativeCaptionsTracks={}},u.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=v(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},u._cleanTracks=function(){var b=this.media;if(!!b){var l=b.textTracks;if(l)for(var s=0;s<l.length;s++)Object(M.clearCurrentCues)(l[s])}},u.onSubtitleTracksUpdated=function(b,l){var s=this;this.textTracks=[];var h=l.subtitleTracks||[],E=h.some(function(f){return f.textCodec===D.IMSC1_CODEC});if(this.config.enableWebVTT||E&&this.config.enableIMSC1){var n=this.tracks&&h&&this.tracks.length===h.length;if(this.tracks=h||[],this.config.renderTextTracksNatively){var d=this.media?this.media.textTracks:[];this.tracks.forEach(function(f,g){var y;if(g<d.length){for(var R=null,L=0;L<d.length;L++)if(T(d[L],f)){R=d[L];break}R&&(y=R)}if(y)Object(M.clearCurrentCues)(y);else{var P=s._captionsOrSubtitlesFromCharacteristics(f);y=s.createTextTrack(P,f.name,f.lang),y&&(y.mode="disabled")}y&&(y.groupId=f.groupId,s.textTracks.push(y))})}else if(!n&&this.tracks&&this.tracks.length){var m=this.tracks.map(function(f){return{label:f.name,kind:f.type.toLowerCase(),default:f.default,subtitleTrack:f}});this.hls.trigger(o.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:m})}}},u._captionsOrSubtitlesFromCharacteristics=function(b){var l;if((l=b.attrs)!==null&&l!==void 0&&l.CHARACTERISTICS){var s=/transcribes-spoken-dialog/gi.test(b.attrs.CHARACTERISTICS),h=/describes-music-and-sound/gi.test(b.attrs.CHARACTERISTICS);if(s&&h)return"captions"}return"subtitles"},u.onManifestLoaded=function(b,l){var s=this;this.config.enableCEA708Captions&&l.captions&&l.captions.forEach(function(h){var E=/(?:CC|SERVICE)([1-4])/.exec(h.instreamId);if(!!E){var n="textTrack"+E[1],d=s.captionsProperties[n];!d||(d.label=h.name,h.lang&&(d.languageCode=h.lang),d.media=h)}})},u.onFragLoading=function(b,l){var s=this.cea608Parser1,h=this.cea608Parser2,E=this.lastSn,n=this.lastPartIndex;if(!(!this.enabled||!(s&&h))&&l.frag.type===_.PlaylistLevelType.MAIN){var d,m,f=l.frag.sn,g=(d=l==null||(m=l.part)===null||m===void 0?void 0:m.index)!=null?d:-1;f===E+1||f===E&&g===n+1||(s.reset(),h.reset()),this.lastSn=f,this.lastPartIndex=g}},u.onFragLoaded=function(b,l){var s=l.frag,h=l.payload,E=this.initPTS,n=this.unparsedVttFrags;if(s.type===_.PlaylistLevelType.SUBTITLE)if(h.byteLength){if(!Object(a.isFiniteNumber)(E[s.cc])){n.push(l),E.length&&this.hls.trigger(o.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Missing initial subtitle PTS")});return}var d=s.decryptdata,m="stats"in l;if(d==null||d.key==null||d.method!=="AES-128"||m){var f=this.tracks[s.level],g=this.vttCCs;g[s.cc]||(g[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),f&&f.textCodec===D.IMSC1_CODEC?this._parseIMSC1(s,h):this._parseVTTs(s,h,g)}}else this.hls.trigger(o.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})},u._parseIMSC1=function(b,l){var s=this,h=this.hls;Object(D.parseIMSC1)(l,this.initPTS[b.cc],this.timescale[b.cc],function(E){s._appendCues(E,b.level),h.trigger(o.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:b})},function(E){I.logger.log("Failed to parse IMSC1: "+E),h.trigger(o.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:b,error:E})})},u._parseVTTs=function(b,l,s){var h,E=this,n=this.hls,d=(h=b.initSegment)!==null&&h!==void 0&&h.data?Object(A.appendUint8Array)(b.initSegment.data,new Uint8Array(l)):l;Object(C.parseWebVTT)(d,this.initPTS[b.cc],this.timescale[b.cc],s,b.cc,b.start,function(m){E._appendCues(m,b.level),n.trigger(o.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:b})},function(m){E._fallbackToIMSC1(b,l),I.logger.log("Failed to parse VTT cue: "+m),n.trigger(o.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:b,error:m})})},u._fallbackToIMSC1=function(b,l){var s=this,h=this.tracks[b.level];h.textCodec||Object(D.parseIMSC1)(l,this.initPTS[b.cc],this.timescale[b.cc],function(){h.textCodec=D.IMSC1_CODEC,s._parseIMSC1(b,l)},function(){h.textCodec="wvtt"})},u._appendCues=function(b,l){var s=this.hls;if(this.config.renderTextTracksNatively){var h=this.textTracks[l];if(!h||h.mode==="disabled")return;b.forEach(function(d){return Object(M.addCueToTrack)(h,d)})}else{var E=this.tracks[l];if(!E)return;var n=E.default?"default":"subtitles"+l;s.trigger(o.Events.CUES_PARSED,{type:"subtitles",cues:b,track:n})}},u.onFragDecrypted=function(b,l){var s=l.frag;if(s.type===_.PlaylistLevelType.SUBTITLE){if(!Object(a.isFiniteNumber)(this.initPTS[s.cc])){this.unparsedVttFrags.push(l);return}this.onFragLoaded(o.Events.FRAG_LOADED,l)}},u.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},u.onFragParsingUserdata=function(b,l){var s=this.cea608Parser1,h=this.cea608Parser2;if(!(!this.enabled||!(s&&h)))for(var E=0;E<l.samples.length;E++){var n=l.samples[E].bytes;if(n){var d=this.extractCea608Data(n);s.addData(l.samples[E].pts,d[0]),h.addData(l.samples[E].pts,d[1])}}},u.onBufferFlushing=function(b,l){var s=l.startOffset,h=l.endOffset,E=l.endOffsetSubtitles,n=l.type,d=this.media;if(!(!d||d.currentTime<h)){if(!n||n==="video"){var m=this.captionsTracks;Object.keys(m).forEach(function(g){return Object(M.removeCuesInRange)(m[g],s,h)})}if(this.config.renderTextTracksNatively&&s===0&&E!==void 0){var f=this.textTracks;Object.keys(f).forEach(function(g){return Object(M.removeCuesInRange)(f[g],s,E)})}}},u.extractCea608Data=function(b){for(var l=[[],[]],s=b[0]&31,h=2,E=0;E<s;E++){var n=b[h++],d=127&b[h++],m=127&b[h++];if(!(d===0&&m===0)){var f=(4&n)!==0;if(f){var g=3&n;(g===0||g===1)&&(l[g].push(d),l[g].push(m))}}}return l},i}();function T(i,u){return i&&i.label===u.name&&!(i.textTrack1||i.textTrack2)}function x(i,u,p,b){return Math.min(u,b)-Math.max(i,p)}function v(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return a});var a=function(){function o(O,C){this.subtle=void 0,this.aesIV=void 0,this.subtle=O,this.aesIV=C}var c=o.prototype;return c.decrypt=function(C,M){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},M,C)},o}()},"./src/crypt/aes-decryptor.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"removePadding",function(){return o}),r.d(e,"default",function(){return c});var a=r("./src/utils/typed-array.ts");function o(O){var C=O.byteLength,M=C&&new DataView(O.buffer).getUint8(C-1);return M?Object(a.sliceUint8)(O,0,C-M):O}var c=function(){function O(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var C=O.prototype;return C.uint8ArrayToUint32Array_=function(D){for(var A=new DataView(D),_=new Uint32Array(4),I=0;I<4;I++)_[I]=A.getUint32(I*4);return _},C.initTable=function(){var D=this.sBox,A=this.invSBox,_=this.subMix,I=_[0],S=_[1],T=_[2],x=_[3],v=this.invSubMix,i=v[0],u=v[1],p=v[2],b=v[3],l=new Uint32Array(256),s=0,h=0,E=0;for(E=0;E<256;E++)E<128?l[E]=E<<1:l[E]=E<<1^283;for(E=0;E<256;E++){var n=h^h<<1^h<<2^h<<3^h<<4;n=n>>>8^n&255^99,D[s]=n,A[n]=s;var d=l[s],m=l[d],f=l[m],g=l[n]*257^n*16843008;I[s]=g<<24|g>>>8,S[s]=g<<16|g>>>16,T[s]=g<<8|g>>>24,x[s]=g,g=f*16843009^m*65537^d*257^s*16843008,i[n]=g<<24|g>>>8,u[n]=g<<16|g>>>16,p[n]=g<<8|g>>>24,b[n]=g,s?(s=d^l[l[l[f^d]]],h^=l[l[h]]):s=h=1}},C.expandKey=function(D){for(var A=this.uint8ArrayToUint32Array_(D),_=!0,I=0;I<A.length&&_;)_=A[I]===this.key[I],I++;if(!_){this.key=A;var S=this.keySize=A.length;if(S!==4&&S!==6&&S!==8)throw new Error("Invalid aes key size="+S);var T=this.ksRows=(S+6+1)*4,x,v,i=this.keySchedule=new Uint32Array(T),u=this.invKeySchedule=new Uint32Array(T),p=this.sBox,b=this.rcon,l=this.invSubMix,s=l[0],h=l[1],E=l[2],n=l[3],d,m;for(x=0;x<T;x++){if(x<S){d=i[x]=A[x];continue}m=d,x%S===0?(m=m<<8|m>>>24,m=p[m>>>24]<<24|p[m>>>16&255]<<16|p[m>>>8&255]<<8|p[m&255],m^=b[x/S|0]<<24):S>6&&x%S===4&&(m=p[m>>>24]<<24|p[m>>>16&255]<<16|p[m>>>8&255]<<8|p[m&255]),i[x]=d=(i[x-S]^m)>>>0}for(v=0;v<T;v++)x=T-v,v&3?m=i[x]:m=i[x-4],v<4||x<=4?u[v]=m:u[v]=s[p[m>>>24]]^h[p[m>>>16&255]]^E[p[m>>>8&255]]^n[p[m&255]],u[v]=u[v]>>>0}},C.networkToHostOrderSwap=function(D){return D<<24|(D&65280)<<8|(D&16711680)>>8|D>>>24},C.decrypt=function(D,A,_){for(var I=this.keySize+6,S=this.invKeySchedule,T=this.invSBox,x=this.invSubMix,v=x[0],i=x[1],u=x[2],p=x[3],b=this.uint8ArrayToUint32Array_(_),l=b[0],s=b[1],h=b[2],E=b[3],n=new Int32Array(D),d=new Int32Array(n.length),m,f,g,y,R,L,P,N,B,F,H,j,X,$,G=this.networkToHostOrderSwap;A<n.length;){for(B=G(n[A]),F=G(n[A+1]),H=G(n[A+2]),j=G(n[A+3]),R=B^S[0],L=j^S[1],P=H^S[2],N=F^S[3],X=4,$=1;$<I;$++)m=v[R>>>24]^i[L>>16&255]^u[P>>8&255]^p[N&255]^S[X],f=v[L>>>24]^i[P>>16&255]^u[N>>8&255]^p[R&255]^S[X+1],g=v[P>>>24]^i[N>>16&255]^u[R>>8&255]^p[L&255]^S[X+2],y=v[N>>>24]^i[R>>16&255]^u[L>>8&255]^p[P&255]^S[X+3],R=m,L=f,P=g,N=y,X=X+4;m=T[R>>>24]<<24^T[L>>16&255]<<16^T[P>>8&255]<<8^T[N&255]^S[X],f=T[L>>>24]<<24^T[P>>16&255]<<16^T[N>>8&255]<<8^T[R&255]^S[X+1],g=T[P>>>24]<<24^T[N>>16&255]<<16^T[R>>8&255]<<8^T[L&255]^S[X+2],y=T[N>>>24]<<24^T[R>>16&255]<<16^T[L>>8&255]<<8^T[P&255]^S[X+3],d[A]=G(m^l),d[A+1]=G(y^s),d[A+2]=G(g^h),d[A+3]=G(f^E),l=B,s=F,h=H,E=j,A=A+4}return d.buffer},O}()},"./src/crypt/decrypter.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return A});var a=r("./src/crypt/aes-crypto.ts"),o=r("./src/crypt/fast-aes-key.ts"),c=r("./src/crypt/aes-decryptor.ts"),O=r("./src/utils/logger.ts"),C=r("./src/utils/mp4-tools.ts"),M=r("./src/utils/typed-array.ts"),D=16,A=function(){function _(S,T,x){var v=x===void 0?{}:x,i=v.removePKCS7Padding,u=i===void 0?!0:i;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=S,this.config=T,this.removePKCS7Padding=u,u)try{var p=self.crypto;p&&(this.subtle=p.subtle||p.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var I=_.prototype;return I.destroy=function(){this.observer=null},I.isSync=function(){return this.config.enableSoftwareAES},I.flush=function(){var T=this.currentResult;if(!T){this.reset();return}var x=new Uint8Array(T);return this.reset(),this.removePKCS7Padding?Object(c.removePadding)(x):x},I.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},I.decrypt=function(T,x,v,i){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(T),x,v);var u=this.flush();u&&i(u.buffer)}else this.webCryptoDecrypt(new Uint8Array(T),x,v).then(i)},I.softwareDecrypt=function(T,x,v){var i=this.currentIV,u=this.currentResult,p=this.remainderData;this.logOnce("JS AES decrypt"),p&&(T=Object(C.appendUint8Array)(p,T),this.remainderData=null);var b=this.getValidChunk(T);if(!b.length)return null;i&&(v=i);var l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new c.default),l.expandKey(x);var s=u;return this.currentResult=l.decrypt(b.buffer,0,v),this.currentIV=Object(M.sliceUint8)(b,-16).buffer,s||null},I.webCryptoDecrypt=function(T,x,v){var i=this,u=this.subtle;return(this.key!==x||!this.fastAesKey)&&(this.key=x,this.fastAesKey=new o.default(u,x)),this.fastAesKey.expandKey().then(function(p){if(!u)return Promise.reject(new Error("web crypto not initialized"));var b=new a.default(u,v);return b.decrypt(T.buffer,p)}).catch(function(p){return i.onWebCryptoError(p,T,x,v)})},I.onWebCryptoError=function(T,x,v,i){return O.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",T),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(x,v,i)},I.getValidChunk=function(T){var x=T,v=T.length-T.length%D;return v!==T.length&&(x=Object(M.sliceUint8)(T,0,v),this.remainderData=Object(M.sliceUint8)(T,v)),x},I.logOnce=function(T){!this.logEnabled||(O.logger.log("[decrypter.ts]: "+T),this.logEnabled=!1)},_}()},"./src/crypt/fast-aes-key.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return a});var a=function(){function o(O,C){this.subtle=void 0,this.key=void 0,this.subtle=O,this.key=C}var c=o.prototype;return c.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},o}()},"./src/demux/aacdemuxer.ts":function(t,e,r){"use strict";r.r(e);var a=r("./src/demux/base-audio-demuxer.ts"),o=r("./src/demux/adts.ts"),c=r("./src/utils/logger.ts"),O=r("./src/demux/id3.ts");function C(A,_){A.prototype=Object.create(_.prototype),A.prototype.constructor=A,M(A,_)}function M(A,_){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(S,T){return S.__proto__=T,S},M(A,_)}var D=function(A){C(_,A);function _(S,T){var x;return x=A.call(this)||this,x.observer=void 0,x.config=void 0,x.observer=S,x.config=T,x}var I=_.prototype;return I.resetInitSegment=function(T,x,v,i){A.prototype.resetInitSegment.call(this,T,x,v,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:x,duration:i,inputTimeScale:9e4,dropped:0}},_.probe=function(T){if(!T)return!1;for(var x=O.getID3Data(T,0)||[],v=x.length,i=T.length;v<i;v++)if(o.probe(T,v))return c.logger.log("ADTS sync word found !"),!0;return!1},I.canParse=function(T,x){return o.canParse(T,x)},I.appendFrame=function(T,x,v){o.initTrackConfig(T,this.observer,x,v,T.manifestCodec);var i=o.appendFrame(T,x,v,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i},_}(a.default);e.default=D},"./src/demux/adts.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"getAudioConfig",function(){return O}),r.d(e,"isHeaderPattern",function(){return C}),r.d(e,"getHeaderLength",function(){return M}),r.d(e,"getFullFrameLength",function(){return D}),r.d(e,"canGetFrameLength",function(){return A}),r.d(e,"isHeader",function(){return _}),r.d(e,"canParse",function(){return I}),r.d(e,"probe",function(){return S}),r.d(e,"initTrackConfig",function(){return T}),r.d(e,"getFrameDuration",function(){return x}),r.d(e,"parseFrameHeader",function(){return v}),r.d(e,"appendFrame",function(){return i});var a=r("./src/utils/logger.ts"),o=r("./src/errors.ts"),c=r("./src/events.ts");function O(u,p,b,l){var s,h,E,n,d=navigator.userAgent.toLowerCase(),m=l,f=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];s=((p[b+2]&192)>>>6)+1;var g=(p[b+2]&60)>>>2;if(g>f.length-1){u.trigger(c.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+g});return}return E=(p[b+2]&1)<<2,E|=(p[b+3]&192)>>>6,a.logger.log("manifest codec:"+l+", ADTS type:"+s+", samplingIndex:"+g),/firefox/i.test(d)?g>=6?(s=5,n=new Array(4),h=g-3):(s=2,n=new Array(2),h=g):d.indexOf("android")!==-1?(s=2,n=new Array(2),h=g):(s=5,n=new Array(4),l&&(l.indexOf("mp4a.40.29")!==-1||l.indexOf("mp4a.40.5")!==-1)||!l&&g>=6?h=g-3:((l&&l.indexOf("mp4a.40.2")!==-1&&(g>=6&&E===1||/vivaldi/i.test(d))||!l&&E===1)&&(s=2,n=new Array(2)),h=g)),n[0]=s<<3,n[0]|=(g&14)>>1,n[1]|=(g&1)<<7,n[1]|=E<<3,s===5&&(n[1]|=(h&14)>>1,n[2]=(h&1)<<7,n[2]|=2<<2,n[3]=0),{config:n,samplerate:f[g],channelCount:E,codec:"mp4a.40."+s,manifestCodec:m}}function C(u,p){return u[p]===255&&(u[p+1]&246)===240}function M(u,p){return u[p+1]&1?7:9}function D(u,p){return(u[p+3]&3)<<11|u[p+4]<<3|(u[p+5]&224)>>>5}function A(u,p){return p+5<u.length}function _(u,p){return p+1<u.length&&C(u,p)}function I(u,p){return A(u,p)&&C(u,p)&&D(u,p)<=u.length-p}function S(u,p){if(_(u,p)){var b=M(u,p);if(p+b>=u.length)return!1;var l=D(u,p);if(l<=b)return!1;var s=p+l;return s===u.length||_(u,s)}return!1}function T(u,p,b,l,s){if(!u.samplerate){var h=O(p,b,l,s);if(!h)return;u.config=h.config,u.samplerate=h.samplerate,u.channelCount=h.channelCount,u.codec=h.codec,u.manifestCodec=h.manifestCodec,a.logger.log("parsed codec:"+u.codec+", rate:"+h.samplerate+", channels:"+h.channelCount)}}function x(u){return 1024*9e4/u}function v(u,p){var b=M(u,p);if(p+b<=u.length){var l=D(u,p)-b;if(l>0)return{headerLength:b,frameLength:l}}}function i(u,p,b,l,s){var h=x(u.samplerate),E=l+s*h,n=v(p,b),d;if(n){var m=n.frameLength,f=n.headerLength,g=f+m,y=Math.max(0,b+g-p.length);y?(d=new Uint8Array(g-f),d.set(p.subarray(b+f,p.length),0)):d=p.subarray(b+f,b+g);var R={unit:d,pts:E};return y||u.samples.push(R),{sample:R,length:g,missing:y}}var L=p.length-b;d=new Uint8Array(L),d.set(p.subarray(b,p.length),0);var P={unit:d,pts:E};return{sample:P,length:L,missing:-1}}},"./src/demux/base-audio-demuxer.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"initPTSFn",function(){return A});var a=r("./src/polyfills/number.ts"),o=r("./src/demux/id3.ts"),c=r("./src/types/demuxer.ts"),O=r("./src/demux/dummy-demuxed-track.ts"),C=r("./src/utils/mp4-tools.ts"),M=r("./src/utils/typed-array.ts"),D=function(){function _(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null}var I=_.prototype;return I.resetInitSegment=function(T,x,v,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},I.resetTimeStamp=function(T){this.initPTS=T,this.resetContiguity()},I.resetContiguity=function(){this.basePTS=null,this.frameIndex=0},I.canParse=function(T,x){return!1},I.appendFrame=function(T,x,v){},I.demux=function(T,x){this.cachedData&&(T=Object(C.appendUint8Array)(this.cachedData,T),this.cachedData=null);var v=o.getID3Data(T,0),i=v?v.length:0,u,p,b=this._audioTrack,l=this._id3Track,s=v?o.getTimeStamp(v):void 0,h=T.length;for((this.basePTS===null||this.frameIndex===0&&Object(a.isFiniteNumber)(s))&&(this.basePTS=A(s,x,this.initPTS)),v&&v.length>0&&l.samples.push({pts:this.basePTS,dts:this.basePTS,data:v,type:c.MetadataSchema.audioId3}),p=this.basePTS;i<h;){if(this.canParse(T,i)){var E=this.appendFrame(b,T,i);E?(this.frameIndex++,p=E.sample.pts,i+=E.length,u=i):i=h}else o.canParse(T,i)?(v=o.getID3Data(T,i),l.samples.push({pts:p,dts:p,data:v,type:c.MetadataSchema.audioId3}),i+=v.length,u=i):i++;if(i===h&&u!==h){var n=Object(M.sliceUint8)(T,u);this.cachedData?this.cachedData=Object(C.appendUint8Array)(this.cachedData,n):this.cachedData=n}}return{audioTrack:b,videoTrack:Object(O.dummyTrack)(),id3Track:l,textTrack:Object(O.dummyTrack)()}},I.demuxSampleAes=function(T,x,v){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},I.flush=function(T){var x=this.cachedData;return x&&(this.cachedData=null,this.demux(x,0)),{audioTrack:this._audioTrack,videoTrack:Object(O.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(O.dummyTrack)()}},I.destroy=function(){},_}(),A=function(I,S,T){return Object(a.isFiniteNumber)(I)?I*90:S*9e4+(T||0)};e.default=D},"./src/demux/chunk-cache.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return a});var a=function(){function c(){this.chunks=[],this.dataLength=0}var O=c.prototype;return O.push=function(M){this.chunks.push(M),this.dataLength+=M.length},O.flush=function(){var M=this.chunks,D=this.dataLength,A;if(M.length)M.length===1?A=M[0]:A=o(M,D);else return new Uint8Array(0);return this.reset(),A},O.reset=function(){this.chunks.length=0,this.dataLength=0},c}();function o(c,O){for(var C=new Uint8Array(O),M=0,D=0;D<c.length;D++){var A=c[D];C.set(A,M),M+=A.length}return C}},"./src/demux/dummy-demuxed-track.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"dummyTrack",function(){return a});function a(o,c){return o===void 0&&(o=""),c===void 0&&(c=9e4),{type:o,id:-1,pid:-1,inputTimeScale:c,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(t,e,r){"use strict";r.r(e);var a=r("./src/utils/logger.ts"),o=function(){function c(C){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=C,this.bytesAvailable=C.byteLength,this.word=0,this.bitsAvailable=0}var O=c.prototype;return O.loadWord=function(){var M=this.data,D=this.bytesAvailable,A=M.byteLength-D,_=new Uint8Array(4),I=Math.min(4,D);if(I===0)throw new Error("no bytes available");_.set(M.subarray(A,A+I)),this.word=new DataView(_.buffer).getUint32(0),this.bitsAvailable=I*8,this.bytesAvailable-=I},O.skipBits=function(M){var D;this.bitsAvailable>M?(this.word<<=M,this.bitsAvailable-=M):(M-=this.bitsAvailable,D=M>>3,M-=D>>3,this.bytesAvailable-=D,this.loadWord(),this.word<<=M,this.bitsAvailable-=M)},O.readBits=function(M){var D=Math.min(this.bitsAvailable,M),A=this.word>>>32-D;return M>32&&a.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=D,this.bitsAvailable>0?this.word<<=D:this.bytesAvailable>0&&this.loadWord(),D=M-D,D>0&&this.bitsAvailable?A<<D|this.readBits(D):A},O.skipLZ=function(){var M;for(M=0;M<this.bitsAvailable;++M)if((this.word&2147483648>>>M)!==0)return this.word<<=M,this.bitsAvailable-=M,M;return this.loadWord(),M+this.skipLZ()},O.skipUEG=function(){this.skipBits(1+this.skipLZ())},O.skipEG=function(){this.skipBits(1+this.skipLZ())},O.readUEG=function(){var M=this.skipLZ();return this.readBits(M+1)-1},O.readEG=function(){var M=this.readUEG();return 1&M?1+M>>>1:-1*(M>>>1)},O.readBoolean=function(){return this.readBits(1)===1},O.readUByte=function(){return this.readBits(8)},O.readUShort=function(){return this.readBits(16)},O.readUInt=function(){return this.readBits(32)},O.skipScalingList=function(M){for(var D=8,A=8,_,I=0;I<M;I++)A!==0&&(_=this.readEG(),A=(D+_+256)%256),D=A===0?D:A},O.readSPS=function(){var M=0,D=0,A=0,_=0,I,S,T,x=this.readUByte.bind(this),v=this.readBits.bind(this),i=this.readUEG.bind(this),u=this.readBoolean.bind(this),p=this.skipBits.bind(this),b=this.skipEG.bind(this),l=this.skipUEG.bind(this),s=this.skipScalingList.bind(this);x();var h=x();if(v(5),p(3),x(),l(),h===100||h===110||h===122||h===244||h===44||h===83||h===86||h===118||h===128){var E=i();if(E===3&&p(1),l(),l(),p(1),u())for(S=E!==3?8:12,T=0;T<S;T++)u()&&(T<6?s(16):s(64))}l();var n=i();if(n===0)i();else if(n===1)for(p(1),b(),b(),I=i(),T=0;T<I;T++)b();l(),p(1);var d=i(),m=i(),f=v(1);f===0&&p(1),p(1),u()&&(M=i(),D=i(),A=i(),_=i());var g=[1,1];if(u()&&u()){var y=x();switch(y){case 1:g=[1,1];break;case 2:g=[12,11];break;case 3:g=[10,11];break;case 4:g=[16,11];break;case 5:g=[40,33];break;case 6:g=[24,11];break;case 7:g=[20,11];break;case 8:g=[32,11];break;case 9:g=[80,33];break;case 10:g=[18,11];break;case 11:g=[15,11];break;case 12:g=[64,33];break;case 13:g=[160,99];break;case 14:g=[4,3];break;case 15:g=[3,2];break;case 16:g=[2,1];break;case 255:{g=[x()<<8|x(),x()<<8|x()];break}}}return{width:Math.ceil((d+1)*16-M*2-D*2),height:(2-f)*(m+1)*16-(f?2:4)*(A+_),pixelRatio:g}},O.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},c}();e.default=o},"./src/demux/id3.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"isHeader",function(){return a}),r.d(e,"isFooter",function(){return o}),r.d(e,"getID3Data",function(){return c}),r.d(e,"canParse",function(){return C}),r.d(e,"getTimeStamp",function(){return M}),r.d(e,"isTimeStampFrame",function(){return D}),r.d(e,"getID3Frames",function(){return _}),r.d(e,"decodeFrame",function(){return I}),r.d(e,"utf8ArrayToStr",function(){return i}),r.d(e,"testables",function(){return u});var a=function(s,h){return h+10<=s.length&&s[h]===73&&s[h+1]===68&&s[h+2]===51&&s[h+3]<255&&s[h+4]<255&&s[h+6]<128&&s[h+7]<128&&s[h+8]<128&&s[h+9]<128},o=function(s,h){return h+10<=s.length&&s[h]===51&&s[h+1]===68&&s[h+2]===73&&s[h+3]<255&&s[h+4]<255&&s[h+6]<128&&s[h+7]<128&&s[h+8]<128&&s[h+9]<128},c=function(s,h){for(var E=h,n=0;a(s,h);){n+=10;var d=O(s,h+6);n+=d,o(s,h+10)&&(n+=10),h+=n}if(n>0)return s.subarray(E,E+n)},O=function(s,h){var E=0;return E=(s[h]&127)<<21,E|=(s[h+1]&127)<<14,E|=(s[h+2]&127)<<7,E|=s[h+3]&127,E},C=function(s,h){return a(s,h)&&O(s,h+6)+10<=s.length-h},M=function(s){for(var h=_(s),E=0;E<h.length;E++){var n=h[E];if(D(n))return v(n)}},D=function(s){return s&&s.key==="PRIV"&&s.info==="com.apple.streaming.transportStreamTimestamp"},A=function(s){var h=String.fromCharCode(s[0],s[1],s[2],s[3]),E=O(s,4),n=10;return{type:h,size:E,data:s.subarray(n,n+E)}},_=function(s){for(var h=0,E=[];a(s,h);){var n=O(s,h+6);h+=10;for(var d=h+n;h+8<d;){var m=A(s.subarray(h)),f=I(m);f&&E.push(f),h+=m.size+10}o(s,h)&&(h+=10)}return E},I=function(s){return s.type==="PRIV"?S(s):s.type[0]==="W"?x(s):T(s)},S=function(s){if(!(s.size<2)){var h=i(s.data,!0),E=new Uint8Array(s.data.subarray(h.length+1));return{key:s.type,info:h,data:E.buffer}}},T=function(s){if(!(s.size<2)){if(s.type==="TXXX"){var h=1,E=i(s.data.subarray(h),!0);h+=E.length+1;var n=i(s.data.subarray(h));return{key:s.type,info:E,data:n}}var d=i(s.data.subarray(1));return{key:s.type,data:d}}},x=function(s){if(s.type==="WXXX"){if(s.size<2)return;var h=1,E=i(s.data.subarray(h),!0);h+=E.length+1;var n=i(s.data.subarray(h));return{key:s.type,info:E,data:n}}var d=i(s.data);return{key:s.type,data:d}},v=function(s){if(s.data.byteLength===8){var h=new Uint8Array(s.data),E=h[3]&1,n=(h[4]<<23)+(h[5]<<15)+(h[6]<<7)+h[7];return n/=45,E&&(n+=4772185884e-2),Math.round(n)}},i=function(s,h){h===void 0&&(h=!1);var E=b();if(E){var n=E.decode(s);if(h){var d=n.indexOf("\0");return d!==-1?n.substring(0,d):n}return n.replace(/\0/g,"")}for(var m=s.length,f,g,y,R="",L=0;L<m;){if(f=s[L++],f===0&&h)return R;if(f===0||f===3)continue;switch(f>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:R+=String.fromCharCode(f);break;case 12:case 13:g=s[L++],R+=String.fromCharCode((f&31)<<6|g&63);break;case 14:g=s[L++],y=s[L++],R+=String.fromCharCode((f&15)<<12|(g&63)<<6|(y&63)<<0);break;default:}}return R},u={decodeTextFrame:T},p;function b(){return!p&&typeof self.TextDecoder!="undefined"&&(p=new self.TextDecoder("utf-8")),p}},"./src/demux/mp3demuxer.ts":function(t,e,r){"use strict";r.r(e);var a=r("./src/demux/base-audio-demuxer.ts"),o=r("./src/demux/id3.ts"),c=r("./src/utils/logger.ts"),O=r("./src/demux/mpegaudio.ts");function C(A,_){A.prototype=Object.create(_.prototype),A.prototype.constructor=A,M(A,_)}function M(A,_){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(S,T){return S.__proto__=T,S},M(A,_)}var D=function(A){C(_,A);function _(){return A.apply(this,arguments)||this}var I=_.prototype;return I.resetInitSegment=function(T,x,v,i){A.prototype.resetInitSegment.call(this,T,x,v,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:x,duration:i,inputTimeScale:9e4,dropped:0}},_.probe=function(T){if(!T)return!1;for(var x=o.getID3Data(T,0)||[],v=x.length,i=T.length;v<i;v++)if(O.probe(T,v))return c.logger.log("MPEG Audio sync word found !"),!0;return!1},I.canParse=function(T,x){return O.canParse(T,x)},I.appendFrame=function(T,x,v){if(this.basePTS!==null)return O.appendFrame(T,x,v,this.basePTS,this.frameIndex)},_}(a.default);e.default=D},"./src/demux/mp4demuxer.ts":function(t,e,r){"use strict";r.r(e);var a=r("./src/polyfills/number.ts"),o=r("./src/types/demuxer.ts"),c=r("./src/utils/mp4-tools.ts"),O=r("./src/demux/dummy-demuxed-track.ts"),C=/\/emsg[-/]ID3/i,M=function(){function D(_,I){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=I}var A=D.prototype;return A.resetTimeStamp=function(){},A.resetInitSegment=function(I,S,T,x){var v=Object(c.parseInitSegment)(I),i=this.videoTrack=Object(O.dummyTrack)("video",1),u=this.audioTrack=Object(O.dummyTrack)("audio",1),p=this.txtTrack=Object(O.dummyTrack)("text",1);if(this.id3Track=Object(O.dummyTrack)("id3",1),this.timeOffset=0,v.video){var b=v.video,l=b.id,s=b.timescale,h=b.codec;i.id=l,i.timescale=p.timescale=s,i.codec=h}if(v.audio){var E=v.audio,n=E.id,d=E.timescale,m=E.codec;u.id=n,u.timescale=d,u.codec=m}p.id=c.RemuxerTrackIdConfig.text,i.sampleDuration=0,i.duration=u.duration=x},A.resetContiguity=function(){},D.probe=function(I){return I=I.length>16384?I.subarray(0,16384):I,Object(c.findBox)(I,["moof"]).length>0},A.demux=function(I,S){this.timeOffset=S;var T=I,x=this.videoTrack,v=this.txtTrack;if(this.config.progressive){this.remainderData&&(T=Object(c.appendUint8Array)(this.remainderData,I));var i=Object(c.segmentValidRange)(T);this.remainderData=i.remainder,x.samples=i.valid||new Uint8Array}else x.samples=T;var u=this.extractID3Track(x,S);return v.samples=Object(c.parseSamples)(S,x),{videoTrack:x,audioTrack:this.audioTrack,id3Track:u,textTrack:this.txtTrack}},A.flush=function(){var I=this.timeOffset,S=this.videoTrack,T=this.txtTrack;S.samples=this.remainderData||new Uint8Array,this.remainderData=null;var x=this.extractID3Track(S,this.timeOffset);return T.samples=Object(c.parseSamples)(I,S),{videoTrack:S,audioTrack:Object(O.dummyTrack)(),id3Track:x,textTrack:Object(O.dummyTrack)()}},A.extractID3Track=function(I,S){var T=this.id3Track;if(I.samples.length){var x=Object(c.findBox)(I.samples,["emsg"]);x&&x.forEach(function(v){var i=Object(c.parseEmsg)(v);if(C.test(i.schemeIdUri)){var u=Object(a.isFiniteNumber)(i.presentationTime)?i.presentationTime/i.timeScale:S+i.presentationTimeDelta/i.timeScale,p=i.payload;T.samples.push({data:p,len:p.byteLength,dts:u,pts:u,type:o.MetadataSchema.emsg})}})}return T},A.demuxSampleAes=function(I,S,T){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},A.destroy=function(){},D}();e.default=M},"./src/demux/mpegaudio.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"appendFrame",function(){return M}),r.d(e,"parseHeader",function(){return D}),r.d(e,"isHeaderPattern",function(){return A}),r.d(e,"isHeader",function(){return _}),r.d(e,"canParse",function(){return I}),r.d(e,"probe",function(){return S});var a=null,o=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],c=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],O=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],C=[0,1,1,4];function M(T,x,v,i,u){if(!(v+24>x.length)){var p=D(x,v);if(p&&v+p.frameLength<=x.length){var b=p.samplesPerFrame*9e4/p.sampleRate,l=i+u*b,s={unit:x.subarray(v,v+p.frameLength),pts:l,dts:l};return T.config=[],T.channelCount=p.channelCount,T.samplerate=p.sampleRate,T.samples.push(s),{sample:s,length:p.frameLength,missing:0}}}}function D(T,x){var v=T[x+1]>>3&3,i=T[x+1]>>1&3,u=T[x+2]>>4&15,p=T[x+2]>>2&3;if(v!==1&&u!==0&&u!==15&&p!==3){var b=T[x+2]>>1&1,l=T[x+3]>>6,s=v===3?3-i:i===3?3:4,h=o[s*14+u-1]*1e3,E=v===3?0:v===2?1:2,n=c[E*3+p],d=l===3?1:2,m=O[v][i],f=C[i],g=m*8*f,y=Math.floor(m*h/n+b)*f;if(a===null){var R=navigator.userAgent||"",L=R.match(/Chrome\/(\d+)/i);a=L?parseInt(L[1]):0}var P=!!a&&a<=87;return P&&i===2&&h>=224e3&&l===0&&(T[x+3]=T[x+3]|128),{sampleRate:n,channelCount:d,frameLength:y,samplesPerFrame:g}}}function A(T,x){return T[x]===255&&(T[x+1]&224)===224&&(T[x+1]&6)!==0}function _(T,x){return x+1<T.length&&A(T,x)}function I(T,x){var v=4;return A(T,x)&&v<=T.length-x}function S(T,x){if(x+1<T.length&&A(T,x)){var v=4,i=D(T,x),u=v;i!=null&&i.frameLength&&(u=i.frameLength);var p=x+u;return p===T.length||_(T,p)}return!1}},"./src/demux/sample-aes.ts":function(t,e,r){"use strict";r.r(e);var a=r("./src/crypt/decrypter.ts"),o=r("./src/demux/tsdemuxer.ts"),c=function(){function O(M,D,A){this.keyData=void 0,this.decrypter=void 0,this.keyData=A,this.decrypter=new a.default(M,D,{removePKCS7Padding:!1})}var C=O.prototype;return C.decryptBuffer=function(D,A){this.decrypter.decrypt(D,this.keyData.key.buffer,this.keyData.iv.buffer,A)},C.decryptAacSample=function(D,A,_,I){var S=D[A].unit;if(!(S.length<=16)){var T=S.subarray(16,S.length-S.length%16),x=T.buffer.slice(T.byteOffset,T.byteOffset+T.length),v=this;this.decryptBuffer(x,function(i){var u=new Uint8Array(i);S.set(u,16),I||v.decryptAacSamples(D,A+1,_)})}},C.decryptAacSamples=function(D,A,_){for(;;A++){if(A>=D.length){_();return}if(!(D[A].unit.length<32)){var I=this.decrypter.isSync();if(this.decryptAacSample(D,A,_,I),!I)return}}},C.getAvcEncryptedData=function(D){for(var A=Math.floor((D.length-48)/160)*16+16,_=new Int8Array(A),I=0,S=32;S<D.length-16;S+=160,I+=16)_.set(D.subarray(S,S+16),I);return _},C.getAvcDecryptedUnit=function(D,A){for(var _=new Uint8Array(A),I=0,S=32;S<D.length-16;S+=160,I+=16)D.set(_.subarray(I,I+16),S);return D},C.decryptAvcSample=function(D,A,_,I,S,T){var x=Object(o.discardEPB)(S.data),v=this.getAvcEncryptedData(x),i=this;this.decryptBuffer(v.buffer,function(u){S.data=i.getAvcDecryptedUnit(x,u),T||i.decryptAvcSamples(D,A,_+1,I)})},C.decryptAvcSamples=function(D,A,_,I){if(D instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;A++,_=0){if(A>=D.length){I();return}for(var S=D[A].units;!(_>=S.length);_++){var T=S[_];if(!(T.data.length<=48||T.type!==1&&T.type!==5)){var x=this.decrypter.isSync();if(this.decryptAvcSample(D,A,_,I,T,x),!x)return}}}},O}();e.default=c},"./src/demux/transmuxer-interface.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return S});var a=r("./node_modules/webworkify-webpack/index.js"),o=r.n(a),c=r("./src/events.ts"),O=r("./src/demux/transmuxer.ts"),C=r("./src/utils/logger.ts"),M=r("./src/errors.ts"),D=r("./src/utils/mediasource-helper.ts"),A=r("./node_modules/eventemitter3/index.js"),_=r.n(A),I=Object(D.getMediaSource)()||{isTypeSupported:function(){return!1}},S=function(){function T(v,i,u,p){var b=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=v,this.id=i,this.onTransmuxComplete=u,this.onFlush=p;var l=v.config,s=function(m,f){f=f||{},f.frag=b.frag,f.id=b.id,v.trigger(m,f)};this.observer=new A.EventEmitter,this.observer.on(c.Events.FRAG_DECRYPTED,s),this.observer.on(c.Events.ERROR,s);var h={mp4:I.isTypeSupported("video/mp4"),mpeg:I.isTypeSupported("audio/mpeg"),mp3:I.isTypeSupported('audio/mp4; codecs="mp3"')},E=navigator.vendor;if(l.enableWorker&&typeof Worker!="undefined"){C.logger.log("demuxing in webworker");var n;try{n=this.worker=a("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),n.addEventListener("message",this.onwmsg),n.onerror=function(d){v.trigger(c.Events.ERROR,{type:M.ErrorTypes.OTHER_ERROR,details:M.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(d.message+"  ("+d.filename+":"+d.lineno+")")})},n.postMessage({cmd:"init",typeSupported:h,vendor:E,id:i,config:JSON.stringify(l)})}catch(d){C.logger.warn("Error in worker:",d),C.logger.error("Error while initializing DemuxerWorker, fallback to inline"),n&&self.URL.revokeObjectURL(n.objectURL),this.transmuxer=new O.default(this.observer,h,l,E,i),this.worker=null}}else this.transmuxer=new O.default(this.observer,h,l,E,i)}var x=T.prototype;return x.destroy=function(){var i=this.worker;if(i)i.removeEventListener("message",this.onwmsg),i.terminate(),this.worker=null,this.onwmsg=void 0;else{var u=this.transmuxer;u&&(u.destroy(),this.transmuxer=null)}var p=this.observer;p&&p.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},x.push=function(i,u,p,b,l,s,h,E,n,d){var m,f,g=this;n.transmuxing.start=self.performance.now();var y=this.transmuxer,R=this.worker,L=s?s.start:l.start,P=l.decryptdata,N=this.frag,B=!(N&&l.cc===N.cc),F=!(N&&n.level===N.level),H=N?n.sn-N.sn:-1,j=this.part?n.part-this.part.index:-1,X=H===0&&n.id>1&&n.id===(N==null?void 0:N.stats.chunkCount),$=!F&&(H===1||H===0&&(j===1||X&&j<=0)),G=self.performance.now();(F||H||l.stats.parsing.start===0)&&(l.stats.parsing.start=G),s&&(j||!$)&&(s.stats.parsing.start=G);var J=!(N&&((m=l.initSegment)===null||m===void 0?void 0:m.url)===((f=N.initSegment)===null||f===void 0?void 0:f.url)),ee=new O.TransmuxState(B,$,E,F,L,J);if(!$||B||J){C.logger.log("[transmuxer-interface, "+l.type+"]: Starting new transmux session for sn: "+n.sn+" p: "+n.part+" level: "+n.level+" id: "+n.id+`
        discontinuity: `+B+`
        trackSwitch: `+F+`
        contiguous: `+$+`
        accurateTimeOffset: `+E+`
        timeOffset: `+L+`
        initSegmentChange: `+J);var te=new O.TransmuxConfig(p,b,u,h,d);this.configureTransmuxer(te)}if(this.frag=l,this.part=s,R)R.postMessage({cmd:"demux",data:i,decryptdata:P,chunkMeta:n,state:ee},i instanceof ArrayBuffer?[i]:[]);else if(y){var oe=y.push(i,P,n,ee);Object(O.isPromise)(oe)?oe.then(function(ue){g.handleTransmuxComplete(ue)}):this.handleTransmuxComplete(oe)}},x.flush=function(i){var u=this;i.transmuxing.start=self.performance.now();var p=this.transmuxer,b=this.worker;if(b)b.postMessage({cmd:"flush",chunkMeta:i});else if(p){var l=p.flush(i);Object(O.isPromise)(l)?l.then(function(s){u.handleFlushResult(s,i)}):this.handleFlushResult(l,i)}},x.handleFlushResult=function(i,u){var p=this;i.forEach(function(b){p.handleTransmuxComplete(b)}),this.onFlush(u)},x.onWorkerMessage=function(i){var u=i.data,p=this.hls;switch(u.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":C.logger[u.data.logType]&&C.logger[u.data.logType](u.data.message);break;default:{u.data=u.data||{},u.data.frag=this.frag,u.data.id=this.id,p.trigger(u.event,u.data);break}}},x.configureTransmuxer=function(i){var u=this.worker,p=this.transmuxer;u?u.postMessage({cmd:"configure",config:i}):p&&p.configure(i)},x.handleTransmuxComplete=function(i){i.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(i)},T}()},"./src/demux/transmuxer-worker.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return M});var a=r("./src/demux/transmuxer.ts"),o=r("./src/events.ts"),c=r("./src/utils/logger.ts"),O=r("./node_modules/eventemitter3/index.js"),C=r.n(O);function M(S){var T=new O.EventEmitter,x=function(u,p){S.postMessage({event:u,data:p})};T.on(o.Events.FRAG_DECRYPTED,x),T.on(o.Events.ERROR,x);var v=function(){var u=function(l){var s=function(E){x("workerLog",{logType:l,message:E})};c.logger[l]=s};for(var p in c.logger)u(p)};S.addEventListener("message",function(i){var u=i.data;switch(u.cmd){case"init":{var p=JSON.parse(u.config);S.transmuxer=new a.default(T,u.typeSupported,p,u.vendor,u.id),Object(c.enableLogs)(p.debug),v(),x("init",null);break}case"configure":{S.transmuxer.configure(u.config);break}case"demux":{var b=S.transmuxer.push(u.data,u.decryptdata,u.chunkMeta,u.state);Object(a.isPromise)(b)?b.then(function(h){D(S,h)}):D(S,b);break}case"flush":{var l=u.chunkMeta,s=S.transmuxer.flush(l);Object(a.isPromise)(s)?s.then(function(h){_(S,h,l)}):_(S,s,l);break}default:break}})}function D(S,T){if(I(T.remuxResult))return!1;var x=[],v=T.remuxResult,i=v.audio,u=v.video;return i&&A(x,i),u&&A(x,u),S.postMessage({event:"transmuxComplete",data:T},x),!0}function A(S,T){T.data1&&S.push(T.data1.buffer),T.data2&&S.push(T.data2.buffer)}function _(S,T,x){var v=T.reduce(function(i,u){return D(S,u)||i},!1);v||S.postMessage({event:"transmuxComplete",data:T[0]}),S.postMessage({event:"flush",data:x})}function I(S){return!S.audio&&!S.video&&!S.text&&!S.id3&&!S.initSegment}},"./src/demux/transmuxer.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return x}),r.d(e,"isPromise",function(){return u}),r.d(e,"TransmuxConfig",function(){return p}),r.d(e,"TransmuxState",function(){return b});var a=r("./src/events.ts"),o=r("./src/errors.ts"),c=r("./src/crypt/decrypter.ts"),O=r("./src/demux/aacdemuxer.ts"),C=r("./src/demux/mp4demuxer.ts"),M=r("./src/demux/tsdemuxer.ts"),D=r("./src/demux/mp3demuxer.ts"),A=r("./src/remux/mp4-remuxer.ts"),_=r("./src/remux/passthrough-remuxer.ts"),I=r("./src/utils/logger.ts"),S;try{S=self.performance.now.bind(self.performance)}catch{I.logger.debug("Unable to use Performance API on this environment"),S=self.Date.now}var T=[{demux:M.default,remux:A.default},{demux:C.default,remux:_.default},{demux:O.default,remux:A.default},{demux:D.default,remux:A.default}],x=function(){function l(h,E,n,d,m){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=h,this.typeSupported=E,this.config=n,this.vendor=d,this.id=m}var s=l.prototype;return s.configure=function(E){this.transmuxConfig=E,this.decrypter&&this.decrypter.reset()},s.push=function(E,n,d,m){var f=this,g=d.transmuxing;g.executeStart=S();var y=new Uint8Array(E),R=this.config,L=this.currentTransmuxState,P=this.transmuxConfig;m&&(this.currentTransmuxState=m);var N=m||L,B=N.contiguous,F=N.discontinuity,H=N.trackSwitch,j=N.accurateTimeOffset,X=N.timeOffset,$=N.initSegmentChange,G=P.audioCodec,J=P.videoCodec,ee=P.defaultInitPts,te=P.duration,oe=P.initSegmentData;(F||H||$)&&this.resetInitSegment(oe,G,J,te),(F||$)&&this.resetInitialTimestamp(ee),B||this.resetContiguity();var ue=v(y,n);if(ue&&ue.method==="AES-128"){var ae=this.getDecrypter();if(R.enableSoftwareAES){var he=ae.softwareDecrypt(y,ue.key.buffer,ue.iv.buffer);if(!he)return g.executeEnd=S(),i(d);y=new Uint8Array(he)}else return this.decryptionPromise=ae.webCryptoDecrypt(y,ue.key.buffer,ue.iv.buffer).then(function(Me){var _e=f.push(Me,null,d);return f.decryptionPromise=null,_e}),this.decryptionPromise}this.needsProbing(y,F,H)&&this.configureTransmuxer(y,P);var me=this.transmux(y,ue,X,j,d),ne=this.currentTransmuxState;return ne.contiguous=!0,ne.discontinuity=!1,ne.trackSwitch=!1,g.executeEnd=S(),me},s.flush=function(E){var n=this,d=E.transmuxing;d.executeStart=S();var m=this.decrypter,f=this.currentTransmuxState,g=this.decryptionPromise;if(g)return g.then(function(){return n.flush(E)});var y=[],R=f.timeOffset;if(m){var L=m.flush();L&&y.push(this.push(L,null,E))}var P=this.demuxer,N=this.remuxer;if(!P||!N)return this.observer.emit(a.Events.ERROR,a.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),d.executeEnd=S(),[i(E)];var B=P.flush(R);return u(B)?B.then(function(F){return n.flushRemux(y,F,E),y}):(this.flushRemux(y,B,E),y)},s.flushRemux=function(E,n,d){var m=n.audioTrack,f=n.videoTrack,g=n.id3Track,y=n.textTrack,R=this.currentTransmuxState,L=R.accurateTimeOffset,P=R.timeOffset;I.logger.log("[transmuxer.ts]: Flushed fragment "+d.sn+(d.part>-1?" p: "+d.part:"")+" of level "+d.level);var N=this.remuxer.remux(m,f,g,y,P,L,!0,this.id);E.push({remuxResult:N,chunkMeta:d}),d.transmuxing.executeEnd=S()},s.resetInitialTimestamp=function(E){var n=this.demuxer,d=this.remuxer;!n||!d||(n.resetTimeStamp(E),d.resetTimeStamp(E))},s.resetContiguity=function(){var E=this.demuxer,n=this.remuxer;!E||!n||(E.resetContiguity(),n.resetNextTimestamp())},s.resetInitSegment=function(E,n,d,m){var f=this.demuxer,g=this.remuxer;!f||!g||(f.resetInitSegment(E,n,d,m),g.resetInitSegment(E,n,d))},s.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},s.transmux=function(E,n,d,m,f){var g;return n&&n.method==="SAMPLE-AES"?g=this.transmuxSampleAes(E,n,d,m,f):g=this.transmuxUnencrypted(E,d,m,f),g},s.transmuxUnencrypted=function(E,n,d,m){var f=this.demuxer.demux(E,n,!1,!this.config.progressive),g=f.audioTrack,y=f.videoTrack,R=f.id3Track,L=f.textTrack,P=this.remuxer.remux(g,y,R,L,n,d,!1,this.id);return{remuxResult:P,chunkMeta:m}},s.transmuxSampleAes=function(E,n,d,m,f){var g=this;return this.demuxer.demuxSampleAes(E,n,d).then(function(y){var R=g.remuxer.remux(y.audioTrack,y.videoTrack,y.id3Track,y.textTrack,d,m,!1,g.id);return{remuxResult:R,chunkMeta:f}})},s.configureTransmuxer=function(E,n){for(var d=this.config,m=this.observer,f=this.typeSupported,g=this.vendor,y=n.audioCodec,R=n.defaultInitPts,L=n.duration,P=n.initSegmentData,N=n.videoCodec,B,F=0,H=T.length;F<H;F++)if(T[F].demux.probe(E)){B=T[F];break}B||(I.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),B={demux:C.default,remux:_.default});var j=this.demuxer,X=this.remuxer,$=B.remux,G=B.demux;(!X||!(X instanceof $))&&(this.remuxer=new $(m,d,f,g)),(!j||!(j instanceof G))&&(this.demuxer=new G(m,d,f),this.probe=G.probe),this.resetInitSegment(P,y,N,L),this.resetInitialTimestamp(R)},s.needsProbing=function(E,n,d){return!this.demuxer||!this.remuxer||n||d},s.getDecrypter=function(){var E=this.decrypter;return E||(E=this.decrypter=new c.default(this.observer,this.config)),E},l}();function v(l,s){var h=null;return l.byteLength>0&&s!=null&&s.key!=null&&s.iv!==null&&s.method!=null&&(h=s),h}var i=function(s){return{remuxResult:{},chunkMeta:s}};function u(l){return"then"in l&&l.then instanceof Function}var p=function(s,h,E,n,d){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=s,this.videoCodec=h,this.initSegmentData=E,this.duration=n,this.defaultInitPts=d},b=function(s,h,E,n,d,m){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=s,this.contiguous=h,this.accurateTimeOffset=E,this.trackSwitch=n,this.timeOffset=d,this.initSegmentChange=m}},"./src/demux/tsdemuxer.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"discardEPB",function(){return p});var a=r("./src/demux/adts.ts"),o=r("./src/demux/mpegaudio.ts"),c=r("./src/demux/exp-golomb.ts"),O=r("./src/demux/sample-aes.ts"),C=r("./src/events.ts"),M=r("./src/utils/mp4-tools.ts"),D=r("./src/utils/logger.ts"),A=r("./src/errors.ts"),_=r("./src/types/demuxer.ts");function I(){return I=Object.assign?Object.assign.bind():function(b){for(var l=1;l<arguments.length;l++){var s=arguments[l];for(var h in s)Object.prototype.hasOwnProperty.call(s,h)&&(b[h]=s[h])}return b},I.apply(this,arguments)}var S=function(){function b(s,h,E){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=s,this.config=h,this.typeSupported=E}b.probe=function(h){return h[0]===71&&h[188]===71},b.createTrack=function(h,E){return{container:h==="video"||h==="audio"?"video/mp2t":void 0,type:h,id:M.RemuxerTrackIdConfig[h],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:h==="audio"?E:void 0}};var l=b.prototype;return l.resetInitSegment=function(h,E,n,d){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=b.createTrack("video"),this._audioTrack=b.createTrack("audio",d),this._id3Track=b.createTrack("id3"),this._txtTrack=b.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=E,this.videoCodec=n,this._duration=d},l.resetTimeStamp=function(){},l.resetContiguity=function(){var h=this._audioTrack,E=this._avcTrack,n=this._id3Track;h&&(h.pesData=null),E&&(E.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null},l.demux=function(h,E,n,d){n===void 0&&(n=!1),d===void 0&&(d=!1),n||(this.sampleAes=null);var m,f=this._avcTrack,g=this._audioTrack,y=this._id3Track,R=this._txtTrack,L=f.pid,P=f.pesData,N=g.pid,B=y.pid,F=g.pesData,H=y.pesData,j=null,X=this.pmtParsed,$=this._pmtId,G=h.length;if(this.remainderData&&(h=Object(M.appendUint8Array)(this.remainderData,h),G=h.length,this.remainderData=null),G<188&&!d)return this.remainderData=h,{audioTrack:g,videoTrack:f,id3Track:y,textTrack:R};G-=G%188,G<h.byteLength&&!d&&(this.remainderData=new Uint8Array(h.buffer,G,h.buffer.byteLength-G));for(var J=0,ee=0;ee<G;ee+=188)if(h[ee]===71){var te=!!(h[ee+1]&64),oe=((h[ee+1]&31)<<8)+h[ee+2],ue=(h[ee+3]&48)>>4,ae=void 0;if(ue>1){if(ae=ee+5+h[ee+4],ae===ee+188)continue}else ae=ee+4;switch(oe){case L:te&&(P&&(m=i(P))&&this.parseAVCPES(f,R,m,!1),P={data:[],size:0}),P&&(P.data.push(h.subarray(ae,ee+188)),P.size+=ee+188-ae);break;case N:if(te){if(F&&(m=i(F)))switch(g.segmentCodec){case"aac":this.parseAACPES(g,m);break;case"mp3":this.parseMPEGPES(g,m);break}F={data:[],size:0}}F&&(F.data.push(h.subarray(ae,ee+188)),F.size+=ee+188-ae);break;case B:te&&(H&&(m=i(H))&&this.parseID3PES(y,m),H={data:[],size:0}),H&&(H.data.push(h.subarray(ae,ee+188)),H.size+=ee+188-ae);break;case 0:te&&(ae+=h[ae]+1),$=this._pmtId=x(h,ae);break;case $:{te&&(ae+=h[ae]+1);var he=v(h,ae,this.typeSupported,n);L=he.avc,L>0&&(f.pid=L),N=he.audio,N>0&&(g.pid=N,g.segmentCodec=he.segmentCodec),B=he.id3,B>0&&(y.pid=B),j!==null&&!X&&(D.logger.log("unknown PID '"+j+"' in TS found"),j=null),X=this.pmtParsed=!0;break}case 17:case 8191:break;default:j=oe;break}}else J++;J>0&&this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+J+" TS packet/s that do not start with 0x47"}),f.pesData=P,g.pesData=F,y.pesData=H;var me={audioTrack:g,videoTrack:f,id3Track:y,textTrack:R};return d&&this.extractRemainingSamples(me),me},l.flush=function(){var h=this.remainderData;this.remainderData=null;var E;return h?E=this.demux(h,-1,!1,!0):E={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(E),this.sampleAes?this.decrypt(E,this.sampleAes):E},l.extractRemainingSamples=function(h){var E=h.audioTrack,n=h.videoTrack,d=h.id3Track,m=h.textTrack,f=n.pesData,g=E.pesData,y=d.pesData,R;if(f&&(R=i(f))?(this.parseAVCPES(n,m,R,!0),n.pesData=null):n.pesData=f,g&&(R=i(g))){switch(E.segmentCodec){case"aac":this.parseAACPES(E,R);break;case"mp3":this.parseMPEGPES(E,R);break}E.pesData=null}else g!=null&&g.size&&D.logger.log("last AAC PES packet truncated,might overlap between fragments"),E.pesData=g;y&&(R=i(y))?(this.parseID3PES(d,R),d.pesData=null):d.pesData=y},l.demuxSampleAes=function(h,E,n){var d=this.demux(h,n,!0,!this.config.progressive),m=this.sampleAes=new O.default(this.observer,this.config,E);return this.decrypt(d,m)},l.decrypt=function(h,E){return new Promise(function(n){var d=h.audioTrack,m=h.videoTrack;d.samples&&d.segmentCodec==="aac"?E.decryptAacSamples(d.samples,0,function(){m.samples?E.decryptAvcSamples(m.samples,0,0,function(){n(h)}):n(h)}):m.samples&&E.decryptAvcSamples(m.samples,0,0,function(){n(h)})})},l.destroy=function(){this._duration=0},l.parseAVCPES=function(h,E,n,d){var m=this,f=this.parseAVCNALu(h,n.data),g=!1,y=this.avcSample,R,L=!1;n.data=null,y&&f.length&&!h.audFound&&(u(y,h),y=this.avcSample=T(!1,n.pts,n.dts,"")),f.forEach(function(P){switch(P.type){case 1:{R=!0,y||(y=m.avcSample=T(!0,n.pts,n.dts,"")),g&&(y.debug+="NDR "),y.frame=!0;var N=P.data;if(L&&N.length>4){var B=new c.default(N).readSliceType();(B===2||B===4||B===7||B===9)&&(y.key=!0)}break}case 5:R=!0,y||(y=m.avcSample=T(!0,n.pts,n.dts,"")),g&&(y.debug+="IDR "),y.key=!0,y.frame=!0;break;case 6:{R=!0,g&&y&&(y.debug+="SEI "),Object(M.parseSEIMessageFromNALu)(p(P.data),n.pts,E.samples);break}case 7:if(R=!0,L=!0,g&&y&&(y.debug+="SPS "),!h.sps){var F=new c.default(P.data),H=F.readSPS();h.width=H.width,h.height=H.height,h.pixelRatio=H.pixelRatio,h.sps=[P.data],h.duration=m._duration;for(var j=P.data.subarray(1,4),X="avc1.",$=0;$<3;$++){var G=j[$].toString(16);G.length<2&&(G="0"+G),X+=G}h.codec=X}break;case 8:R=!0,g&&y&&(y.debug+="PPS "),h.pps||(h.pps=[P.data]);break;case 9:R=!1,h.audFound=!0,y&&u(y,h),y=m.avcSample=T(!1,n.pts,n.dts,g?"AUD ":"");break;case 12:R=!0;break;default:R=!1,y&&(y.debug+="unknown NAL "+P.type+" ");break}if(y&&R){var J=y.units;J.push(P)}}),d&&y&&(u(y,h),this.avcSample=null)},l.getLastNalUnit=function(h){var E,n=this.avcSample,d;if((!n||n.units.length===0)&&(n=h[h.length-1]),(E=n)!==null&&E!==void 0&&E.units){var m=n.units;d=m[m.length-1]}return d},l.parseAVCNALu=function(h,E){var n=E.byteLength,d=h.naluState||0,m=d,f=[],g=0,y,R,L,P=-1,N=0;for(d===-1&&(P=0,N=E[0]&31,d=0,g=1);g<n;){if(y=E[g++],!d){d=y?0:1;continue}if(d===1){d=y?0:2;continue}if(!y)d=3;else if(y===1){if(P>=0){var B={data:E.subarray(P,g-d-1),type:N};f.push(B)}else{var F=this.getLastNalUnit(h.samples);if(F&&(m&&g<=4-m&&F.state&&(F.data=F.data.subarray(0,F.data.byteLength-m)),R=g-d-1,R>0)){var H=new Uint8Array(F.data.byteLength+R);H.set(F.data,0),H.set(E.subarray(0,R),F.data.byteLength),F.data=H,F.state=0}}g<n?(L=E[g]&31,P=g,N=L,d=0):d=-1}else d=0}if(P>=0&&d>=0){var j={data:E.subarray(P,n),type:N,state:d};f.push(j)}if(f.length===0){var X=this.getLastNalUnit(h.samples);if(X){var $=new Uint8Array(X.data.byteLength+E.byteLength);$.set(X.data,0),$.set(E,X.data.byteLength),X.data=$}}return h.naluState=d,f},l.parseAACPES=function(h,E){var n=0,d=this.aacOverFlow,m=E.data;if(d){this.aacOverFlow=null;var f=d.missing,g=d.sample.unit.byteLength;if(f===-1){var y=new Uint8Array(g+m.byteLength);y.set(d.sample.unit,0),y.set(m,g),m=y}else{var R=g-f;d.sample.unit.set(m.subarray(0,f),R),h.samples.push(d.sample),n=d.missing}}var L,P;for(L=n,P=m.length;L<P-1&&!a.isHeader(m,L);L++);if(L!==n){var N,B;if(L<P-1?(N="AAC PES did not start with ADTS header,offset:"+L,B=!1):(N="no ADTS header found in AAC PES",B=!0),D.logger.warn("parsing error:"+N),this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.FRAG_PARSING_ERROR,fatal:B,reason:N}),B)return}a.initTrackConfig(h,this.observer,m,L,this.audioCodec);var F;if(E.pts!==void 0)F=E.pts;else if(d){var H=a.getFrameDuration(h.samplerate);F=d.sample.pts+H}else{D.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var j=0,X;L<P;)if(X=a.appendFrame(h,m,L,F,j),L+=X.length,X.missing){this.aacOverFlow=X;break}else for(j++;L<P-1&&!a.isHeader(m,L);L++);},l.parseMPEGPES=function(h,E){var n=E.data,d=n.length,m=0,f=0,g=E.pts;if(g===void 0){D.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;f<d;)if(o.isHeader(n,f)){var y=o.appendFrame(h,n,f,g,m);if(y)f+=y.length,m++;else break}else f++},l.parseID3PES=function(h,E){if(E.pts===void 0){D.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var n=I({},E,{type:this._avcTrack?_.MetadataSchema.emsg:_.MetadataSchema.audioId3});h.samples.push(n)},b}();function T(b,l,s,h){return{key:b,frame:!1,pts:l,dts:s,units:[],debug:h,length:0}}function x(b,l){return(b[l+10]&31)<<8|b[l+11]}function v(b,l,s,h){var E={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},n=(b[l+1]&15)<<8|b[l+2],d=l+3+n-4,m=(b[l+10]&15)<<8|b[l+11];for(l+=12+m;l<d;){var f=(b[l+1]&31)<<8|b[l+2];switch(b[l]){case 207:if(!h){D.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:E.audio===-1&&(E.audio=f);break;case 21:E.id3===-1&&(E.id3=f);break;case 219:if(!h){D.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:E.avc===-1&&(E.avc=f);break;case 3:case 4:s.mpeg!==!0&&s.mp3!==!0?D.logger.log("MPEG audio found, not supported in this browser"):E.audio===-1&&(E.audio=f,E.segmentCodec="mp3");break;case 36:D.logger.warn("Unsupported HEVC stream type found");break;default:break}l+=((b[l+3]&15)<<8|b[l+4])+5}return E}function i(b){var l=0,s,h,E,n,d,m=b.data;if(!b||b.size===0)return null;for(;m[0].length<19&&m.length>1;){var f=new Uint8Array(m[0].length+m[1].length);f.set(m[0]),f.set(m[1],m[0].length),m[0]=f,m.splice(1,1)}s=m[0];var g=(s[0]<<16)+(s[1]<<8)+s[2];if(g===1){if(h=(s[4]<<8)+s[5],h&&h>b.size-6)return null;var y=s[7];y&192&&(n=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,y&64?(d=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,n-d>60*9e4&&(D.logger.warn(Math.round((n-d)/9e4)+"s delta between PTS and DTS, align them"),n=d)):d=n),E=s[8];var R=E+9;if(b.size<=R)return null;b.size-=R;for(var L=new Uint8Array(b.size),P=0,N=m.length;P<N;P++){s=m[P];var B=s.byteLength;if(R)if(R>B){R-=B;continue}else s=s.subarray(R),B-=R,R=0;L.set(s,l),l+=B}return h&&(h-=E+3),{data:L,pts:n,dts:d,len:h}}return null}function u(b,l){if(b.units.length&&b.frame){if(b.pts===void 0){var s=l.samples,h=s.length;if(h){var E=s[h-1];b.pts=E.pts,b.dts=E.dts}else{l.dropped++;return}}l.samples.push(b)}b.debug.length&&D.logger.log(b.pts+"/"+b.dts+":"+b.debug)}function p(b){for(var l=b.byteLength,s=[],h=1;h<l-2;)b[h]===0&&b[h+1]===0&&b[h+2]===3?(s.push(h+2),h+=2):h++;if(s.length===0)return b;var E=l-s.length,n=new Uint8Array(E),d=0;for(h=0;h<E;d++,h++)d===s[0]&&(d++,s.shift()),n[h]=b[d];return n}e.default=S},"./src/errors.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"ErrorTypes",function(){return a}),r.d(e,"ErrorDetails",function(){return o});var a;(function(c){c.NETWORK_ERROR="networkError",c.MEDIA_ERROR="mediaError",c.KEY_SYSTEM_ERROR="keySystemError",c.MUX_ERROR="muxError",c.OTHER_ERROR="otherError"})(a||(a={}));var o;(function(c){c.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",c.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",c.KEY_SYSTEM_NO_SESSION="keySystemNoSession",c.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",c.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",c.MANIFEST_LOAD_ERROR="manifestLoadError",c.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",c.MANIFEST_PARSING_ERROR="manifestParsingError",c.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",c.LEVEL_EMPTY_ERROR="levelEmptyError",c.LEVEL_LOAD_ERROR="levelLoadError",c.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",c.LEVEL_SWITCH_ERROR="levelSwitchError",c.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",c.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",c.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",c.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",c.FRAG_LOAD_ERROR="fragLoadError",c.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",c.FRAG_DECRYPT_ERROR="fragDecryptError",c.FRAG_PARSING_ERROR="fragParsingError",c.REMUX_ALLOC_ERROR="remuxAllocError",c.KEY_LOAD_ERROR="keyLoadError",c.KEY_LOAD_TIMEOUT="keyLoadTimeOut",c.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",c.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",c.BUFFER_APPEND_ERROR="bufferAppendError",c.BUFFER_APPENDING_ERROR="bufferAppendingError",c.BUFFER_STALLED_ERROR="bufferStalledError",c.BUFFER_FULL_ERROR="bufferFullError",c.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",c.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",c.INTERNAL_EXCEPTION="internalException",c.INTERNAL_ABORTED="aborted",c.UNKNOWN="unknown"})(o||(o={}))},"./src/events.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"Events",function(){return a});var a;(function(o){o.MEDIA_ATTACHING="hlsMediaAttaching",o.MEDIA_ATTACHED="hlsMediaAttached",o.MEDIA_DETACHING="hlsMediaDetaching",o.MEDIA_DETACHED="hlsMediaDetached",o.BUFFER_RESET="hlsBufferReset",o.BUFFER_CODECS="hlsBufferCodecs",o.BUFFER_CREATED="hlsBufferCreated",o.BUFFER_APPENDING="hlsBufferAppending",o.BUFFER_APPENDED="hlsBufferAppended",o.BUFFER_EOS="hlsBufferEos",o.BUFFER_FLUSHING="hlsBufferFlushing",o.BUFFER_FLUSHED="hlsBufferFlushed",o.MANIFEST_LOADING="hlsManifestLoading",o.MANIFEST_LOADED="hlsManifestLoaded",o.MANIFEST_PARSED="hlsManifestParsed",o.LEVEL_SWITCHING="hlsLevelSwitching",o.LEVEL_SWITCHED="hlsLevelSwitched",o.LEVEL_LOADING="hlsLevelLoading",o.LEVEL_LOADED="hlsLevelLoaded",o.LEVEL_UPDATED="hlsLevelUpdated",o.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",o.LEVELS_UPDATED="hlsLevelsUpdated",o.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",o.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",o.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",o.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",o.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",o.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",o.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",o.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",o.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",o.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",o.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",o.CUES_PARSED="hlsCuesParsed",o.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",o.INIT_PTS_FOUND="hlsInitPtsFound",o.FRAG_LOADING="hlsFragLoading",o.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",o.FRAG_LOADED="hlsFragLoaded",o.FRAG_DECRYPTED="hlsFragDecrypted",o.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",o.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",o.FRAG_PARSING_METADATA="hlsFragParsingMetadata",o.FRAG_PARSED="hlsFragParsed",o.FRAG_BUFFERED="hlsFragBuffered",o.FRAG_CHANGED="hlsFragChanged",o.FPS_DROP="hlsFpsDrop",o.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",o.ERROR="hlsError",o.DESTROYING="hlsDestroying",o.KEY_LOADING="hlsKeyLoading",o.KEY_LOADED="hlsKeyLoaded",o.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",o.BACK_BUFFER_REACHED="hlsBackBufferReached"})(a||(a={}))},"./src/hls.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return l});var a=r("./node_modules/url-toolkit/src/url-toolkit.js"),o=r.n(a),c=r("./src/loader/playlist-loader.ts"),O=r("./src/loader/key-loader.ts"),C=r("./src/controller/id3-track-controller.ts"),M=r("./src/controller/latency-controller.ts"),D=r("./src/controller/level-controller.ts"),A=r("./src/controller/fragment-tracker.ts"),_=r("./src/controller/stream-controller.ts"),I=r("./src/is-supported.ts"),S=r("./src/utils/logger.ts"),T=r("./src/config.ts"),x=r("./node_modules/eventemitter3/index.js"),v=r.n(x),i=r("./src/events.ts"),u=r("./src/errors.ts");function p(s,h){for(var E=0;E<h.length;E++){var n=h[E];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(s,n.key,n)}}function b(s,h,E){return h&&p(s.prototype,h),E&&p(s,E),Object.defineProperty(s,"prototype",{writable:!1}),s}var l=function(){s.isSupported=function(){return Object(I.isSupported)()};function s(E){E===void 0&&(E={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new x.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var n=this.config=Object(T.mergeConfig)(s.DefaultConfig,E);this.userConfig=E,Object(S.enableLogs)(n.debug),this._autoLevelCapping=-1,n.progressive&&Object(T.enableStreamingMode)(n);var d=n.abrController,m=n.bufferController,f=n.capLevelController,g=n.fpsController,y=this.abrController=new d(this),R=this.bufferController=new m(this),L=this.capLevelController=new f(this),P=new g(this),N=new c.default(this),B=new O.default(this),F=new C.default(this),H=this.levelController=new D.default(this),j=new A.FragmentTracker(this),X=this.streamController=new _.default(this,j);L.setStreamController(X),P.setStreamController(X);var $=[N,B,H,X];this.networkControllers=$;var G=[y,R,L,P,F,j];this.audioTrackController=this.createController(n.audioTrackController,null,$),this.createController(n.audioStreamController,j,$),this.subtitleTrackController=this.createController(n.subtitleTrackController,null,$),this.createController(n.subtitleStreamController,j,$),this.createController(n.timelineController,null,G),this.emeController=this.createController(n.emeController,null,G),this.cmcdController=this.createController(n.cmcdController,null,G),this.latencyController=this.createController(M.default,null,G),this.coreComponents=G}var h=s.prototype;return h.createController=function(n,d,m){if(n){var f=d?new n(this,d):new n(this);return m&&m.push(f),f}return null},h.on=function(n,d,m){m===void 0&&(m=this),this._emitter.on(n,d,m)},h.once=function(n,d,m){m===void 0&&(m=this),this._emitter.once(n,d,m)},h.removeAllListeners=function(n){this._emitter.removeAllListeners(n)},h.off=function(n,d,m,f){m===void 0&&(m=this),this._emitter.off(n,d,m,f)},h.listeners=function(n){return this._emitter.listeners(n)},h.emit=function(n,d,m){return this._emitter.emit(n,d,m)},h.trigger=function(n,d){if(this.config.debug)return this.emit(n,n,d);try{return this.emit(n,n,d)}catch(m){S.logger.error("An internal error happened while handling event "+n+'. Error message: "'+m.message+'". Here is a stacktrace:',m),this.trigger(i.Events.ERROR,{type:u.ErrorTypes.OTHER_ERROR,details:u.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:n,error:m})}return!1},h.listenerCount=function(n){return this._emitter.listenerCount(n)},h.destroy=function(){S.logger.log("destroy"),this.trigger(i.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(n){return n.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(n){return n.destroy()}),this.coreComponents.length=0},h.attachMedia=function(n){S.logger.log("attachMedia"),this._media=n,this.trigger(i.Events.MEDIA_ATTACHING,{media:n})},h.detachMedia=function(){S.logger.log("detachMedia"),this.trigger(i.Events.MEDIA_DETACHING,void 0),this._media=null},h.loadSource=function(n){this.stopLoad();var d=this.media,m=this.url,f=this.url=a.buildAbsoluteURL(self.location.href,n,{alwaysNormalize:!0});S.logger.log("loadSource:"+f),d&&m&&m!==f&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(d)),this.trigger(i.Events.MANIFEST_LOADING,{url:n})},h.startLoad=function(n){n===void 0&&(n=-1),S.logger.log("startLoad("+n+")"),this.networkControllers.forEach(function(d){d.startLoad(n)})},h.stopLoad=function(){S.logger.log("stopLoad"),this.networkControllers.forEach(function(n){n.stopLoad()})},h.swapAudioCodec=function(){S.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},h.recoverMediaError=function(){S.logger.log("recoverMediaError");var n=this._media;this.detachMedia(),n&&this.attachMedia(n)},h.removeLevel=function(n,d){d===void 0&&(d=0),this.levelController.removeLevel(n,d)},b(s,[{key:"levels",get:function(){var n=this.levelController.levels;return n||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(n){S.logger.log("set currentLevel:"+n),this.loadLevel=n,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(n){S.logger.log("set nextLevel:"+n),this.levelController.manualLevel=n,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(n){S.logger.log("set loadLevel:"+n),this.levelController.manualLevel=n}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(n){this.levelController.nextLoadLevel=n}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(n){S.logger.log("set firstLevel:"+n),this.levelController.firstLevel=n}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(n){S.logger.log("set startLevel:"+n),n!==-1&&(n=Math.max(n,this.minAutoLevel)),this.levelController.startLevel=n}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(n){var d=!!n;d!==this.config.capLevelToPlayerSize&&(d?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=d)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(n){this._autoLevelCapping!==n&&(S.logger.log("set autoLevelCapping:"+n),this._autoLevelCapping=n)}},{key:"bandwidthEstimate",get:function(){var n=this.abrController.bwEstimator;return n?n.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var n=this.levels,d=this.config.minAutoBitrate;if(!n)return 0;for(var m=n.length,f=0;f<m;f++)if(n[f].maxBitrate>=d)return f;return 0}},{key:"maxAutoLevel",get:function(){var n=this.levels,d=this.autoLevelCapping,m;return d===-1&&n&&n.length?m=n.length-1:m=d,m}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(n){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,n)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"audioTracks",get:function(){var n=this.audioTrackController;return n?n.audioTracks:[]}},{key:"audioTrack",get:function(){var n=this.audioTrackController;return n?n.audioTrack:-1},set:function(n){var d=this.audioTrackController;d&&(d.audioTrack=n)}},{key:"subtitleTracks",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTrack:-1},set:function(n){var d=this.subtitleTrackController;d&&(d.subtitleTrack=n)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var n=this.subtitleTrackController;return n?n.subtitleDisplay:!1},set:function(n){var d=this.subtitleTrackController;d&&(d.subtitleDisplay=n)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(n){this.config.lowLatencyMode=n}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.3"}},{key:"Events",get:function(){return i.Events}},{key:"ErrorTypes",get:function(){return u.ErrorTypes}},{key:"ErrorDetails",get:function(){return u.ErrorDetails}},{key:"DefaultConfig",get:function(){return s.defaultConfig?s.defaultConfig:T.hlsDefaultConfig},set:function(n){s.defaultConfig=n}}]),s}();l.defaultConfig=void 0},"./src/is-supported.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"isSupported",function(){return c}),r.d(e,"changeTypeSupported",function(){return O});var a=r("./src/utils/mediasource-helper.ts");function o(){return self.SourceBuffer||self.WebKitSourceBuffer}function c(){var C=Object(a.getMediaSource)();if(!C)return!1;var M=o(),D=C&&typeof C.isTypeSupported=="function"&&C.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),A=!M||M.prototype&&typeof M.prototype.appendBuffer=="function"&&typeof M.prototype.remove=="function";return!!D&&!!A}function O(){var C,M=o();return typeof(M==null||(C=M.prototype)===null||C===void 0?void 0:C.changeType)=="function"}},"./src/loader/date-range.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"DateRangeAttribute",function(){return D}),r.d(e,"DateRange",function(){return A});var a=r("./src/polyfills/number.ts"),o=r("./src/utils/attr-list.ts"),c=r("./src/utils/logger.ts");function O(){return O=Object.assign?Object.assign.bind():function(_){for(var I=1;I<arguments.length;I++){var S=arguments[I];for(var T in S)Object.prototype.hasOwnProperty.call(S,T)&&(_[T]=S[T])}return _},O.apply(this,arguments)}function C(_,I){for(var S=0;S<I.length;S++){var T=I[S];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(_,T.key,T)}}function M(_,I,S){return I&&C(_.prototype,I),S&&C(_,S),Object.defineProperty(_,"prototype",{writable:!1}),_}var D;(function(_){_.ID="ID",_.CLASS="CLASS",_.START_DATE="START-DATE",_.DURATION="DURATION",_.END_DATE="END-DATE",_.END_ON_NEXT="END-ON-NEXT",_.PLANNED_DURATION="PLANNED-DURATION",_.SCTE35_OUT="SCTE35-OUT",_.SCTE35_IN="SCTE35-IN"})(D||(D={}));var A=function(){function _(I,S){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,S){var T=S.attr;for(var x in T)if(Object.prototype.hasOwnProperty.call(I,x)&&I[x]!==T[x]){c.logger.warn('DATERANGE tag attribute: "'+x+'" does not match for tags with ID: "'+I.ID+'"'),this._badValueForSameId=x;break}I=O(new o.AttrList({}),T,I)}if(this.attr=I,this._startDate=new Date(I[D.START_DATE]),D.END_DATE in this.attr){var v=new Date(this.attr[D.END_DATE]);Object(a.isFiniteNumber)(v.getTime())&&(this._endDate=v)}}return M(_,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var S=this.duration;return S!==null?new Date(this._startDate.getTime()+S*1e3):null}},{key:"duration",get:function(){if(D.DURATION in this.attr){var S=this.attr.decimalFloatingPoint(D.DURATION);if(Object(a.isFiniteNumber)(S))return S}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return D.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(D.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(D.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(a.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),_}()},"./src/loader/fragment-loader.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return S}),r.d(e,"LoadError",function(){return x});var a=r("./src/polyfills/number.ts"),o=r("./src/errors.ts");function c(v,i){v.prototype=Object.create(i.prototype),v.prototype.constructor=v,A(v,i)}function O(v){var i=typeof Map=="function"?new Map:void 0;return O=function(p){if(p===null||!D(p))return p;if(typeof p!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(p))return i.get(p);i.set(p,b)}function b(){return C(p,arguments,_(this).constructor)}return b.prototype=Object.create(p.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),A(b,p)},O(v)}function C(v,i,u){return M()?C=Reflect.construct.bind():C=function(b,l,s){var h=[null];h.push.apply(h,l);var E=Function.bind.apply(b,h),n=new E;return s&&A(n,s.prototype),n},C.apply(null,arguments)}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function D(v){return Function.toString.call(v).indexOf("[native code]")!==-1}function A(v,i){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(p,b){return p.__proto__=b,p},A(v,i)}function _(v){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},_(v)}var I=Math.pow(2,17),S=function(){function v(u){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=u}var i=v.prototype;return i.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},i.abort=function(){this.loader&&this.loader.abort()},i.load=function(p,b){var l=this,s=p.url;if(!s)return Promise.reject(new x({type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:p,networkDetails:null},"Fragment does not have a "+(s?"part list":"url")));this.abort();var h=this.config,E=h.fLoader,n=h.loader;return new Promise(function(d,m){l.loader&&l.loader.destroy();var f=l.loader=p.loader=E?new E(h):new n(h),g=T(p),y={timeout:h.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:h.fragLoadingMaxRetryTimeout,highWaterMark:p.sn==="initSegment"?1/0:I};p.stats=f.stats,f.load(g,y,{onSuccess:function(L,P,N,B){l.resetLoader(p,f),d({frag:p,part:null,payload:L.data,networkDetails:B})},onError:function(L,P,N){l.resetLoader(p,f),m(new x({type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:p,response:L,networkDetails:N}))},onAbort:function(L,P,N){l.resetLoader(p,f),m(new x({type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:p,networkDetails:N}))},onTimeout:function(L,P,N){l.resetLoader(p,f),m(new x({type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:p,networkDetails:N}))},onProgress:function(L,P,N,B){b&&b({frag:p,part:null,payload:N,networkDetails:B})}})})},i.loadPart=function(p,b,l){var s=this;this.abort();var h=this.config,E=h.fLoader,n=h.loader;return new Promise(function(d,m){s.loader&&s.loader.destroy();var f=s.loader=p.loader=E?new E(h):new n(h),g=T(p,b),y={timeout:h.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:h.fragLoadingMaxRetryTimeout,highWaterMark:I};b.stats=f.stats,f.load(g,y,{onSuccess:function(L,P,N,B){s.resetLoader(p,f),s.updateStatsFromPart(p,b);var F={frag:p,part:b,payload:L.data,networkDetails:B};l(F),d(F)},onError:function(L,P,N){s.resetLoader(p,f),m(new x({type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:p,part:b,response:L,networkDetails:N}))},onAbort:function(L,P,N){p.stats.aborted=b.stats.aborted,s.resetLoader(p,f),m(new x({type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:p,part:b,networkDetails:N}))},onTimeout:function(L,P,N){s.resetLoader(p,f),m(new x({type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:p,part:b,networkDetails:N}))}})})},i.updateStatsFromPart=function(p,b){var l=p.stats,s=b.stats,h=s.total;if(l.loaded+=s.loaded,h){var E=Math.round(p.duration/b.duration),n=Math.min(Math.round(l.loaded/h),E),d=E-n,m=d*Math.round(l.loaded/n);l.total=l.loaded+m}else l.total=Math.max(l.loaded,l.total);var f=l.loading,g=s.loading;f.start?f.first+=g.first-g.start:(f.start=g.start,f.first=g.first),f.end=g.end},i.resetLoader=function(p,b){p.loader=null,this.loader===b&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),b.destroy()},v}();function T(v,i){i===void 0&&(i=null);var u=i||v,p={frag:v,part:i,responseType:"arraybuffer",url:u.url,headers:{},rangeStart:0,rangeEnd:0},b=u.byteRangeStartOffset,l=u.byteRangeEndOffset;return Object(a.isFiniteNumber)(b)&&Object(a.isFiniteNumber)(l)&&(p.rangeStart=b,p.rangeEnd=l),p}var x=function(v){c(i,v);function i(u){for(var p,b=arguments.length,l=new Array(b>1?b-1:0),s=1;s<b;s++)l[s-1]=arguments[s];return p=v.call.apply(v,[this].concat(l))||this,p.data=void 0,p.data=u,p}return i}(O(Error))},"./src/loader/fragment.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"ElementaryStreamTypes",function(){return S}),r.d(e,"BaseSegment",function(){return T}),r.d(e,"Fragment",function(){return x}),r.d(e,"Part",function(){return v});var a=r("./src/polyfills/number.ts"),o=r("./node_modules/url-toolkit/src/url-toolkit.js"),c=r.n(o),O=r("./src/utils/logger.ts"),C=r("./src/loader/level-key.ts"),M=r("./src/loader/load-stats.ts");function D(i,u){i.prototype=Object.create(u.prototype),i.prototype.constructor=i,A(i,u)}function A(i,u){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(b,l){return b.__proto__=l,b},A(i,u)}function _(i,u){for(var p=0;p<u.length;p++){var b=u[p];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(i,b.key,b)}}function I(i,u,p){return u&&_(i.prototype,u),p&&_(i,p),Object.defineProperty(i,"prototype",{writable:!1}),i}var S;(function(i){i.AUDIO="audio",i.VIDEO="video",i.AUDIOVIDEO="audiovideo"})(S||(S={}));var T=function(){function i(p){var b;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(b={},b[S.AUDIO]=null,b[S.VIDEO]=null,b[S.AUDIOVIDEO]=null,b),this.baseurl=p}var u=i.prototype;return u.setByteRange=function(b,l){var s=b.split("@",2),h=[];s.length===1?h[0]=l?l.byteRangeEndOffset:0:h[0]=parseInt(s[1]),h[1]=parseInt(s[0])+h[0],this._byteRange=h},I(i,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(o.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(b){this._url=b}}]),i}(),x=function(i){D(u,i);function u(b,l){var s;return s=i.call(this,l)||this,s._decryptdata=null,s.rawProgramDateTime=null,s.programDateTime=null,s.tagList=[],s.duration=0,s.sn=0,s.levelkey=void 0,s.type=void 0,s.loader=null,s.level=-1,s.cc=0,s.startPTS=void 0,s.endPTS=void 0,s.appendedPTS=void 0,s.startDTS=void 0,s.endDTS=void 0,s.start=0,s.deltaPTS=void 0,s.maxStartPTS=void 0,s.minEndPTS=void 0,s.stats=new M.LoadStats,s.urlId=0,s.data=void 0,s.bitrateTest=!1,s.title=null,s.initSegment=null,s.type=b,s}var p=u.prototype;return p.createInitializationVector=function(l){for(var s=new Uint8Array(16),h=12;h<16;h++)s[h]=l>>8*(15-h)&255;return s},p.setDecryptDataFromLevelKey=function(l,s){var h=l;return(l==null?void 0:l.method)==="AES-128"&&l.uri&&!l.iv&&(h=C.LevelKey.fromURI(l.uri),h.method=l.method,h.iv=this.createInitializationVector(s),h.keyFormat="identity"),h},p.setElementaryStreamInfo=function(l,s,h,E,n,d){d===void 0&&(d=!1);var m=this.elementaryStreams,f=m[l];if(!f){m[l]={startPTS:s,endPTS:h,startDTS:E,endDTS:n,partial:d};return}f.startPTS=Math.min(f.startPTS,s),f.endPTS=Math.max(f.endPTS,h),f.startDTS=Math.min(f.startDTS,E),f.endDTS=Math.max(f.endDTS,n)},p.clearElementaryStreamInfo=function(){var l=this.elementaryStreams;l[S.AUDIO]=null,l[S.VIDEO]=null,l[S.AUDIOVIDEO]=null},I(u,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var l=this.sn;typeof l!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&O.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),l=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,l)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(a.isFiniteNumber)(this.programDateTime))return null;var l=Object(a.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+l*1e3}},{key:"encrypted",get:function(){var l;return!!((l=this.decryptdata)!==null&&l!==void 0&&l.keyFormat&&this.decryptdata.uri)}}]),u}(T),v=function(i){D(u,i);function u(p,b,l,s,h){var E;E=i.call(this,l)||this,E.fragOffset=0,E.duration=0,E.gap=!1,E.independent=!1,E.relurl=void 0,E.fragment=void 0,E.index=void 0,E.stats=new M.LoadStats,E.duration=p.decimalFloatingPoint("DURATION"),E.gap=p.bool("GAP"),E.independent=p.bool("INDEPENDENT"),E.relurl=p.enumeratedString("URI"),E.fragment=b,E.index=s;var n=p.enumeratedString("BYTERANGE");return n&&E.setByteRange(n,h),h&&(E.fragOffset=h.fragOffset+h.duration),E}return I(u,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var b=this.elementaryStreams;return!!(b.audio||b.video||b.audiovideo)}}]),u}(T)},"./src/loader/key-loader.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return O});var a=r("./src/events.ts"),o=r("./src/errors.ts"),c=r("./src/utils/logger.ts"),O=function(){function C(D){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=D,this.registerListeners()}var M=C.prototype;return M.startLoad=function(A){},M.stopLoad=function(){this.destroyInternalLoaders()},M.registerListeners=function(){this.hls.on(a.Events.KEY_LOADING,this.onKeyLoading,this)},M.unregisterListeners=function(){this.hls.off(a.Events.KEY_LOADING,this.onKeyLoading)},M.destroyInternalLoaders=function(){for(var A in this.loaders){var _=this.loaders[A];_&&_.destroy()}this.loaders={}},M.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},M.onKeyLoading=function(A,_){var I=_.frag,S=I.type,T=this.loaders[S];if(!I.decryptdata){c.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var x=I.decryptdata.uri;if(x!==this.decrypturl||this.decryptkey===null){var v=this.hls.config;if(T&&(c.logger.warn("abort previous key loader for type:"+S),T.abort()),!x){c.logger.warn("key uri is falsy");return}var i=v.loader,u=I.loader=this.loaders[S]=new i(v);this.decrypturl=x,this.decryptkey=null;var p={url:x,frag:I,responseType:"arraybuffer"},b={timeout:v.fragLoadingTimeOut,maxRetry:0,retryDelay:v.fragLoadingRetryDelay,maxRetryDelay:v.fragLoadingMaxRetryTimeout,highWaterMark:0},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};u.load(p,b,l)}else this.decryptkey&&(I.decryptdata.key=this.decryptkey,this.hls.trigger(a.Events.KEY_LOADED,{frag:I}))},M.loadsuccess=function(A,_,I){var S=I.frag;if(!S.decryptdata){c.logger.error("after key load, decryptdata unset");return}this.decryptkey=S.decryptdata.key=new Uint8Array(A.data),S.loader=null,delete this.loaders[S.type],this.hls.trigger(a.Events.KEY_LOADED,{frag:S})},M.loaderror=function(A,_){var I=_.frag,S=I.loader;S&&S.abort(),delete this.loaders[I.type],this.hls.trigger(a.Events.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:I,response:A})},M.loadtimeout=function(A,_){var I=_.frag,S=I.loader;S&&S.abort(),delete this.loaders[I.type],this.hls.trigger(a.Events.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:I})},C}()},"./src/loader/level-details.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"LevelDetails",function(){return C});var a=r("./src/polyfills/number.ts");function o(M,D){for(var A=0;A<D.length;A++){var _=D[A];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(M,_.key,_)}}function c(M,D,A){return D&&o(M.prototype,D),A&&o(M,A),Object.defineProperty(M,"prototype",{writable:!1}),M}var O=10,C=function(){function M(A){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=A}var D=M.prototype;return D.reloaded=function(_){if(!_){this.advanced=!0,this.updated=!0;return}var I=this.lastPartSn-_.lastPartSn,S=this.lastPartIndex-_.lastPartIndex;this.updated=this.endSN!==_.endSN||!!S||!!I,this.advanced=this.endSN>_.endSN||I>0||I===0&&S>0,this.updated||this.advanced?this.misses=Math.floor(_.misses*.6):this.misses=_.misses+1,this.availabilityDelay=_.availabilityDelay},c(M,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(a.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||O}},{key:"drift",get:function(){var _=this.driftEndTime-this.driftStartTime;if(_>0){var I=this.driftEnd-this.driftStart;return I*1e3/_}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var _;return(_=this.partList)!==null&&_!==void 0&&_.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var _;return(_=this.fragments)!==null&&_!==void 0&&_.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var _;return(_=this.partList)!==null&&_!==void 0&&_.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var _;return(_=this.partList)!==null&&_!==void 0&&_.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),M}()},"./src/loader/level-key.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"LevelKey",function(){return C});var a=r("./node_modules/url-toolkit/src/url-toolkit.js"),o=r.n(a);function c(M,D){for(var A=0;A<D.length;A++){var _=D[A];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(M,_.key,_)}}function O(M,D,A){return D&&c(M.prototype,D),A&&c(M,A),Object.defineProperty(M,"prototype",{writable:!1}),M}var C=function(){M.fromURL=function(A,_){return new M(A,_)},M.fromURI=function(A){return new M(A)};function M(D,A){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,A?this._uri=Object(a.buildAbsoluteURL)(D,A,{alwaysNormalize:!0}):this._uri=D}return O(M,[{key:"uri",get:function(){return this._uri}}]),M}()},"./src/loader/load-stats.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"LoadStats",function(){return a});var a=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return p});var a=r("./src/polyfills/number.ts"),o=r("./node_modules/url-toolkit/src/url-toolkit.js"),c=r.n(o),O=r("./src/loader/date-range.ts"),C=r("./src/loader/fragment.ts"),M=r("./src/loader/level-details.ts"),D=r("./src/loader/level-key.ts"),A=r("./src/utils/attr-list.ts"),_=r("./src/utils/logger.ts"),I=r("./src/utils/codecs.ts"),S=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,T=/#EXT-X-MEDIA:(.*)/g,x=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),v=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),i=/\.(mp4|m4s|m4v|m4a)$/i;function u(n){var d,m;return i.test((d=(m=o.parseURL(n))===null||m===void 0?void 0:m.path)!=null?d:"")}var p=function(){function n(){}return n.findGroup=function(m,f){for(var g=0;g<m.length;g++){var y=m[g];if(y.id===f)return y}},n.convertAVC1ToAVCOTI=function(m){var f=m.split(".");if(f.length>2){var g=f.shift()+".";return g+=parseInt(f.shift()).toString(16),g+=("000"+parseInt(f.shift()).toString(16)).slice(-4),g}return m},n.resolve=function(m,f){return o.buildAbsoluteURL(f,m,{alwaysNormalize:!0})},n.parseMasterPlaylist=function(m,f){var g=[],y={},R=!1;S.lastIndex=0;for(var L;(L=S.exec(m))!=null;)if(L[1]){var P=new A.AttrList(L[1]),N={attrs:P,bitrate:P.decimalInteger("AVERAGE-BANDWIDTH")||P.decimalInteger("BANDWIDTH"),name:P.NAME,url:n.resolve(L[2],f)},B=P.decimalResolution("RESOLUTION");B&&(N.width=B.width,N.height=B.height),b((P.CODECS||"").split(/[ ,]+/).filter(function(H){return H}),N),N.videoCodec&&N.videoCodec.indexOf("avc1")!==-1&&(N.videoCodec=n.convertAVC1ToAVCOTI(N.videoCodec)),g.push(N)}else if(L[3]){var F=new A.AttrList(L[3]);F["DATA-ID"]&&(R=!0,y[F["DATA-ID"]]=F)}return{levels:g,sessionData:R?y:null}},n.parseMasterPlaylistMedia=function(m,f,g,y){y===void 0&&(y=[]);var R,L=[],P=0;for(T.lastIndex=0;(R=T.exec(m))!==null;){var N=new A.AttrList(R[1]);if(N.TYPE===g){var B={attrs:N,bitrate:0,id:P++,groupId:N["GROUP-ID"],instreamId:N["INSTREAM-ID"],name:N.NAME||N.LANGUAGE||"",type:g,default:N.bool("DEFAULT"),autoselect:N.bool("AUTOSELECT"),forced:N.bool("FORCED"),lang:N.LANGUAGE,url:N.URI?n.resolve(N.URI,f):""};if(y.length){var F=n.findGroup(y,B.groupId)||y[0];l(B,F,"audioCodec"),l(B,F,"textCodec")}L.push(B)}}return L},n.parseLevelPlaylist=function(m,f,g,y,R){var L=new M.LevelDetails(f),P=L.fragments,N=null,B=0,F=0,H=0,j=0,X=null,$=new C.Fragment(y,f),G,J,ee,te=-1,oe=!1;for(x.lastIndex=0,L.m3u8=m;(G=x.exec(m))!==null;){oe&&(oe=!1,$=new C.Fragment(y,f),$.start=H,$.sn=B,$.cc=j,$.level=g,N&&($.initSegment=N,$.rawProgramDateTime=N.rawProgramDateTime,N.rawProgramDateTime=null));var ue=G[1];if(ue){$.duration=parseFloat(ue);var ae=(" "+G[2]).slice(1);$.title=ae||null,$.tagList.push(ae?["INF",ue,ae]:["INF",ue])}else if(G[3])Object(a.isFiniteNumber)($.duration)&&($.start=H,ee&&($.levelkey=ee),$.sn=B,$.level=g,$.cc=j,$.urlId=R,P.push($),$.relurl=(" "+G[3]).slice(1),h($,X),X=$,H+=$.duration,B++,F=0,oe=!0);else if(G[4]){var he=(" "+G[4]).slice(1);X?$.setByteRange(he,X):$.setByteRange(he)}else if(G[5])$.rawProgramDateTime=(" "+G[5]).slice(1),$.tagList.push(["PROGRAM-DATE-TIME",$.rawProgramDateTime]),te===-1&&(te=P.length);else{if(G=G[0].match(v),!G){_.logger.warn("No matches on slow regex match for level playlist!");continue}for(J=1;J<G.length&&typeof G[J]=="undefined";J++);var me=(" "+G[J]).slice(1),ne=(" "+G[J+1]).slice(1),Me=G[J+2]?(" "+G[J+2]).slice(1):"";switch(me){case"PLAYLIST-TYPE":L.type=ne.toUpperCase();break;case"MEDIA-SEQUENCE":B=L.startSN=parseInt(ne);break;case"SKIP":{var _e=new A.AttrList(ne),Se=_e.decimalInteger("SKIPPED-SEGMENTS");if(Object(a.isFiniteNumber)(Se)){L.skippedSegments=Se;for(var be=Se;be--;)P.unshift(null);B+=Se}var Ue=_e.enumeratedString("RECENTLY-REMOVED-DATERANGES");Ue&&(L.recentlyRemovedDateranges=Ue.split("	"));break}case"TARGETDURATION":L.targetduration=parseFloat(ne);break;case"VERSION":L.version=parseInt(ne);break;case"EXTM3U":break;case"ENDLIST":L.live=!1;break;case"#":(ne||Me)&&$.tagList.push(Me?[ne,Me]:[ne]);break;case"DISCONTINUITY":j++,$.tagList.push(["DIS"]);break;case"GAP":$.tagList.push([me]);break;case"BITRATE":$.tagList.push([me,ne]);break;case"DATERANGE":{var Ze=new A.AttrList(ne),We=new O.DateRange(Ze,L.dateRanges[Ze.ID]);We.isValid||L.skippedSegments?L.dateRanges[We.id]=We:_.logger.warn('Ignoring invalid DATERANGE tag: "'+ne+'"'),$.tagList.push(["EXT-X-DATERANGE",ne]);break}case"DISCONTINUITY-SEQUENCE":j=parseInt(ne);break;case"KEY":{var tt,Fe=new A.AttrList(ne),ot=Fe.enumeratedString("METHOD"),ft=Fe.URI,ht=Fe.hexadecimalInteger("IV"),lt=Fe.enumeratedString("KEYFORMATVERSIONS"),It=Fe.enumeratedString("KEYID"),rt=(tt=Fe.enumeratedString("KEYFORMAT"))!=null?tt:"identity",Rt=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(Rt.indexOf(rt)>-1){_.logger.warn("Keyformat "+rt+" is not supported from the manifest");continue}else if(rt!=="identity")continue;ot&&(ee=D.LevelKey.fromURL(f,ft),ft&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(ot)>=0&&(ee.method=ot,ee.keyFormat=rt,It&&(ee.keyID=It),lt&&(ee.keyFormatVersions=lt),ee.iv=ht));break}case"START":{var Ye=new A.AttrList(ne),Je=Ye.decimalFloatingPoint("TIME-OFFSET");Object(a.isFiniteNumber)(Je)&&(L.startTimeOffset=Je);break}case"MAP":{var Et=new A.AttrList(ne);if($.duration){var qe=new C.Fragment(y,f);E(qe,Et,g,ee),N=qe,$.initSegment=N,N.rawProgramDateTime&&!$.rawProgramDateTime&&($.rawProgramDateTime=N.rawProgramDateTime)}else E($,Et,g,ee),N=$,oe=!0;break}case"SERVER-CONTROL":{var He=new A.AttrList(ne);L.canBlockReload=He.bool("CAN-BLOCK-RELOAD"),L.canSkipUntil=He.optionalFloat("CAN-SKIP-UNTIL",0),L.canSkipDateRanges=L.canSkipUntil>0&&He.bool("CAN-SKIP-DATERANGES"),L.partHoldBack=He.optionalFloat("PART-HOLD-BACK",0),L.holdBack=He.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Pt=new A.AttrList(ne);L.partTarget=Pt.decimalFloatingPoint("PART-TARGET");break}case"PART":{var vt=L.partList;vt||(vt=L.partList=[]);var Wt=F>0?vt[vt.length-1]:void 0,mr=F++,_t=new C.Part(new A.AttrList(ne),$,f,mr,Wt);vt.push(_t),$.duration+=_t.duration;break}case"PRELOAD-HINT":{var Cr=new A.AttrList(ne);L.preloadHint=Cr;break}case"RENDITION-REPORT":{var gr=new A.AttrList(ne);L.renditionReports=L.renditionReports||[],L.renditionReports.push(gr);break}default:_.logger.warn("line parsed but not handled: "+G);break}}}X&&!X.relurl?(P.pop(),H-=X.duration,L.partList&&(L.fragmentHint=X)):L.partList&&(h($,X),$.cc=j,L.fragmentHint=$);var kt=P.length,Ht=P[0],wt=P[kt-1];if(H+=L.skippedSegments*L.targetduration,H>0&&kt&&wt){L.averagetargetduration=H/kt;var pr=wt.sn;L.endSN=pr!=="initSegment"?pr:0,Ht&&(L.startCC=Ht.cc,Ht.initSegment||L.fragments.every(function(ar){return ar.relurl&&u(ar.relurl)})&&(_.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),$=new C.Fragment(y,f),$.relurl=wt.relurl,$.level=g,$.sn="initSegment",Ht.initSegment=$,L.needSidxRanges=!0))}else L.endSN=0,L.startCC=0;return L.fragmentHint&&(H+=L.fragmentHint.duration),L.totalduration=H,L.endCC=j,te>0&&s(P,te),L},n}();function b(n,d){["video","audio","text"].forEach(function(m){var f=n.filter(function(y){return Object(I.isCodecType)(y,m)});if(f.length){var g=f.filter(function(y){return y.lastIndexOf("avc1",0)===0||y.lastIndexOf("mp4a",0)===0});d[m+"Codec"]=g.length>0?g[0]:f[0],n=n.filter(function(y){return f.indexOf(y)===-1})}}),d.unknownCodecs=n}function l(n,d,m){var f=d[m];f&&(n[m]=f)}function s(n,d){for(var m=n[d],f=d;f--;){var g=n[f];if(!g)return;g.programDateTime=m.programDateTime-g.duration*1e3,m=g}}function h(n,d){n.rawProgramDateTime?n.programDateTime=Date.parse(n.rawProgramDateTime):d!=null&&d.programDateTime&&(n.programDateTime=d.endProgramDateTime),Object(a.isFiniteNumber)(n.programDateTime)||(n.programDateTime=null,n.rawProgramDateTime=null)}function E(n,d,m,f){n.relurl=d.URI,d.BYTERANGE&&n.setByteRange(d.BYTERANGE),n.level=m,n.sn="initSegment",f&&(n.levelkey=f),n.initSegment=null}},"./src/loader/playlist-loader.ts":function(t,e,r){"use strict";r.r(e);var a=r("./src/polyfills/number.ts"),o=r("./src/events.ts"),c=r("./src/errors.ts"),O=r("./src/utils/logger.ts"),C=r("./src/utils/mp4-tools.ts"),M=r("./src/loader/m3u8-parser.ts"),D=r("./src/types/loader.ts"),A=r("./src/utils/attr-list.ts");function _(T){var x=T.type;switch(x){case D.PlaylistContextType.AUDIO_TRACK:return D.PlaylistLevelType.AUDIO;case D.PlaylistContextType.SUBTITLE_TRACK:return D.PlaylistLevelType.SUBTITLE;default:return D.PlaylistLevelType.MAIN}}function I(T,x){var v=T.url;return(v===void 0||v.indexOf("data:")===0)&&(v=x.url),v}var S=function(){function T(v){this.hls=void 0,this.loaders=Object.create(null),this.hls=v,this.registerListeners()}var x=T.prototype;return x.startLoad=function(i){},x.stopLoad=function(){this.destroyInternalLoaders()},x.registerListeners=function(){var i=this.hls;i.on(o.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(o.Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(o.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),i.on(o.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},x.unregisterListeners=function(){var i=this.hls;i.off(o.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(o.Events.LEVEL_LOADING,this.onLevelLoading,this),i.off(o.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),i.off(o.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},x.createInternalLoader=function(i){var u=this.hls.config,p=u.pLoader,b=u.loader,l=p||b,s=new l(u);return i.loader=s,this.loaders[i.type]=s,s},x.getInternalLoader=function(i){return this.loaders[i.type]},x.resetInternalLoader=function(i){this.loaders[i]&&delete this.loaders[i]},x.destroyInternalLoaders=function(){for(var i in this.loaders){var u=this.loaders[i];u&&u.destroy(),this.resetInternalLoader(i)}},x.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},x.onManifestLoading=function(i,u){var p=u.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:D.PlaylistContextType.MANIFEST,url:p,deliveryDirectives:null})},x.onLevelLoading=function(i,u){var p=u.id,b=u.level,l=u.url,s=u.deliveryDirectives;this.load({id:p,groupId:null,level:b,responseType:"text",type:D.PlaylistContextType.LEVEL,url:l,deliveryDirectives:s})},x.onAudioTrackLoading=function(i,u){var p=u.id,b=u.groupId,l=u.url,s=u.deliveryDirectives;this.load({id:p,groupId:b,level:null,responseType:"text",type:D.PlaylistContextType.AUDIO_TRACK,url:l,deliveryDirectives:s})},x.onSubtitleTrackLoading=function(i,u){var p=u.id,b=u.groupId,l=u.url,s=u.deliveryDirectives;this.load({id:p,groupId:b,level:null,responseType:"text",type:D.PlaylistContextType.SUBTITLE_TRACK,url:l,deliveryDirectives:s})},x.load=function(i){var u,p=this.hls.config,b=this.getInternalLoader(i);if(b){var l=b.context;if(l&&l.url===i.url){O.logger.trace("[playlist-loader]: playlist request ongoing");return}O.logger.log("[playlist-loader]: aborting previous loader for type: "+i.type),b.abort()}var s,h,E,n;switch(i.type){case D.PlaylistContextType.MANIFEST:s=p.manifestLoadingMaxRetry,h=p.manifestLoadingTimeOut,E=p.manifestLoadingRetryDelay,n=p.manifestLoadingMaxRetryTimeout;break;case D.PlaylistContextType.LEVEL:case D.PlaylistContextType.AUDIO_TRACK:case D.PlaylistContextType.SUBTITLE_TRACK:s=0,h=p.levelLoadingTimeOut;break;default:s=p.levelLoadingMaxRetry,h=p.levelLoadingTimeOut,E=p.levelLoadingRetryDelay,n=p.levelLoadingMaxRetryTimeout;break}if(b=this.createInternalLoader(i),(u=i.deliveryDirectives)!==null&&u!==void 0&&u.part){var d;if(i.type===D.PlaylistContextType.LEVEL&&i.level!==null?d=this.hls.levels[i.level].details:i.type===D.PlaylistContextType.AUDIO_TRACK&&i.id!==null?d=this.hls.audioTracks[i.id].details:i.type===D.PlaylistContextType.SUBTITLE_TRACK&&i.id!==null&&(d=this.hls.subtitleTracks[i.id].details),d){var m=d.partTarget,f=d.targetduration;m&&f&&(h=Math.min(Math.max(m*3,f*.8)*1e3,h))}}var g={timeout:h,maxRetry:s,retryDelay:E,maxRetryDelay:n,highWaterMark:0},y={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};b.load(i,g,y)},x.loadsuccess=function(i,u,p,b){if(b===void 0&&(b=null),p.isSidxRequest){this.handleSidxRequest(i,p),this.handlePlaylistLoaded(i,u,p,b);return}this.resetInternalLoader(p.type);var l=i.data;if(l.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(i,p,"no EXTM3U delimiter",b);return}u.parsing.start=performance.now(),l.indexOf("#EXTINF:")>0||l.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(i,u,p,b):this.handleMasterPlaylist(i,u,p,b)},x.loaderror=function(i,u,p){p===void 0&&(p=null),this.handleNetworkError(u,p,!1,i)},x.loadtimeout=function(i,u,p){p===void 0&&(p=null),this.handleNetworkError(u,p,!0)},x.handleMasterPlaylist=function(i,u,p,b){var l=this.hls,s=i.data,h=I(i,p),E=M.default.parseMasterPlaylist(s,h),n=E.levels,d=E.sessionData;if(!n.length){this.handleManifestParsingError(i,p,"no level found in manifest",b);return}var m=n.map(function(P){return{id:P.attrs.AUDIO,audioCodec:P.audioCodec}}),f=n.map(function(P){return{id:P.attrs.SUBTITLES,textCodec:P.textCodec}}),g=M.default.parseMasterPlaylistMedia(s,h,"AUDIO",m),y=M.default.parseMasterPlaylistMedia(s,h,"SUBTITLES",f),R=M.default.parseMasterPlaylistMedia(s,h,"CLOSED-CAPTIONS");if(g.length){var L=g.some(function(P){return!P.url});!L&&n[0].audioCodec&&!n[0].attrs.AUDIO&&(O.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new A.AttrList({}),bitrate:0,url:""}))}l.trigger(o.Events.MANIFEST_LOADED,{levels:n,audioTracks:g,subtitles:y,captions:R,url:h,stats:u,networkDetails:b,sessionData:d})},x.handleTrackOrLevelPlaylist=function(i,u,p,b){var l=this.hls,s=p.id,h=p.level,E=p.type,n=I(i,p),d=Object(a.isFiniteNumber)(s)?s:0,m=Object(a.isFiniteNumber)(h)?h:d,f=_(p),g=M.default.parseLevelPlaylist(i.data,n,m,f,d);if(!g.fragments.length){l.trigger(o.Events.ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:n,reason:"no fragments found in level",level:typeof p.level=="number"?p.level:void 0});return}if(E===D.PlaylistContextType.MANIFEST){var y={attrs:new A.AttrList({}),bitrate:0,details:g,name:"",url:n};l.trigger(o.Events.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:n,stats:u,networkDetails:b,sessionData:null})}if(u.parsing.end=performance.now(),g.needSidxRanges){var R,L=(R=g.fragments[0].initSegment)===null||R===void 0?void 0:R.url;this.load({url:L,isSidxRequest:!0,type:E,level:h,levelDetails:g,id:s,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}p.levelDetails=g,this.handlePlaylistLoaded(i,u,p,b)},x.handleSidxRequest=function(i,u){var p=new Uint8Array(i.data),b=Object(C.findBox)(p,["sidx"])[0];if(!!b){var l=Object(C.parseSegmentIndex)(b);if(!!l){var s=l.references,h=u.levelDetails;s.forEach(function(E,n){var d=E.info,m=h.fragments[n];if(m.byteRange.length===0&&m.setByteRange(String(1+d.end-d.start)+"@"+String(d.start)),m.initSegment){var f=Object(C.findBox)(p,["moov"])[0],g=f?f.length:null;m.initSegment.setByteRange(String(g)+"@0")}})}}},x.handleManifestParsingError=function(i,u,p,b){this.hls.trigger(o.Events.ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:u.type===D.PlaylistContextType.MANIFEST,url:i.url,reason:p,response:i,context:u,networkDetails:b})},x.handleNetworkError=function(i,u,p,b){p===void 0&&(p=!1),O.logger.warn("[playlist-loader]: A network "+(p?"timeout":"error")+" occurred while loading "+i.type+" level: "+i.level+" id: "+i.id+' group-id: "'+i.groupId+'"');var l=c.ErrorDetails.UNKNOWN,s=!1,h=this.getInternalLoader(i);switch(i.type){case D.PlaylistContextType.MANIFEST:l=p?c.ErrorDetails.MANIFEST_LOAD_TIMEOUT:c.ErrorDetails.MANIFEST_LOAD_ERROR,s=!0;break;case D.PlaylistContextType.LEVEL:l=p?c.ErrorDetails.LEVEL_LOAD_TIMEOUT:c.ErrorDetails.LEVEL_LOAD_ERROR,s=!1;break;case D.PlaylistContextType.AUDIO_TRACK:l=p?c.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:c.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,s=!1;break;case D.PlaylistContextType.SUBTITLE_TRACK:l=p?c.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:c.ErrorDetails.SUBTITLE_LOAD_ERROR,s=!1;break}h&&this.resetInternalLoader(i.type);var E={type:c.ErrorTypes.NETWORK_ERROR,details:l,fatal:s,url:i.url,loader:h,context:i,networkDetails:u};b&&(E.response=b),this.hls.trigger(o.Events.ERROR,E)},x.handlePlaylistLoaded=function(i,u,p,b){var l=p.type,s=p.level,h=p.id,E=p.groupId,n=p.loader,d=p.levelDetails,m=p.deliveryDirectives;if(!(d!=null&&d.targetduration)){this.handleManifestParsingError(i,p,"invalid target duration",b);return}if(!!n)switch(d.live&&(n.getCacheAge&&(d.ageHeader=n.getCacheAge()||0),(!n.getCacheAge||isNaN(d.ageHeader))&&(d.ageHeader=0)),l){case D.PlaylistContextType.MANIFEST:case D.PlaylistContextType.LEVEL:this.hls.trigger(o.Events.LEVEL_LOADED,{details:d,level:s||0,id:h||0,stats:u,networkDetails:b,deliveryDirectives:m});break;case D.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(o.Events.AUDIO_TRACK_LOADED,{details:d,id:h||0,groupId:E||"",stats:u,networkDetails:b,deliveryDirectives:m});break;case D.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(o.Events.SUBTITLE_TRACK_LOADED,{details:d,id:h||0,groupId:E||"",stats:u,networkDetails:b,deliveryDirectives:m});break}},T}();e.default=S},"./src/polyfills/number.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"isFiniteNumber",function(){return a}),r.d(e,"MAX_SAFE_INTEGER",function(){return o});var a=Number.isFinite||function(c){return typeof c=="number"&&isFinite(c)},o=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(t,e,r){"use strict";r.r(e);var a=function(){function o(){}return o.getSilentFrame=function(O,C){switch(O){case"mp4a.40.2":if(C===1)return new Uint8Array([0,200,0,128,35,128]);if(C===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(C===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(C===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(C===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(C===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(C===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(C===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(C===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},o}();e.default=a},"./src/remux/mp4-generator.ts":function(t,e,r){"use strict";r.r(e);var a=Math.pow(2,32)-1,o=function(){function c(){}return c.init=function(){c.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var C;for(C in c.types)c.types.hasOwnProperty(C)&&(c.types[C]=[C.charCodeAt(0),C.charCodeAt(1),C.charCodeAt(2),C.charCodeAt(3)]);var M=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),D=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);c.HDLR_TYPES={video:M,audio:D};var A=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),_=new Uint8Array([0,0,0,0,0,0,0,0]);c.STTS=c.STSC=c.STCO=_,c.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),c.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),c.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),c.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var I=new Uint8Array([105,115,111,109]),S=new Uint8Array([97,118,99,49]),T=new Uint8Array([0,0,0,1]);c.FTYP=c.box(c.types.ftyp,I,T,I,S),c.DINF=c.box(c.types.dinf,c.box(c.types.dref,A))},c.box=function(C){for(var M=8,D=arguments.length,A=new Array(D>1?D-1:0),_=1;_<D;_++)A[_-1]=arguments[_];for(var I=A.length,S=I;I--;)M+=A[I].byteLength;var T=new Uint8Array(M);for(T[0]=M>>24&255,T[1]=M>>16&255,T[2]=M>>8&255,T[3]=M&255,T.set(C,4),I=0,M=8;I<S;I++)T.set(A[I],M),M+=A[I].byteLength;return T},c.hdlr=function(C){return c.box(c.types.hdlr,c.HDLR_TYPES[C])},c.mdat=function(C){return c.box(c.types.mdat,C)},c.mdhd=function(C,M){M*=C;var D=Math.floor(M/(a+1)),A=Math.floor(M%(a+1));return c.box(c.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,C>>24&255,C>>16&255,C>>8&255,C&255,D>>24,D>>16&255,D>>8&255,D&255,A>>24,A>>16&255,A>>8&255,A&255,85,196,0,0]))},c.mdia=function(C){return c.box(c.types.mdia,c.mdhd(C.timescale,C.duration),c.hdlr(C.type),c.minf(C))},c.mfhd=function(C){return c.box(c.types.mfhd,new Uint8Array([0,0,0,0,C>>24,C>>16&255,C>>8&255,C&255]))},c.minf=function(C){return C.type==="audio"?c.box(c.types.minf,c.box(c.types.smhd,c.SMHD),c.DINF,c.stbl(C)):c.box(c.types.minf,c.box(c.types.vmhd,c.VMHD),c.DINF,c.stbl(C))},c.moof=function(C,M,D){return c.box(c.types.moof,c.mfhd(C),c.traf(D,M))},c.moov=function(C){for(var M=C.length,D=[];M--;)D[M]=c.trak(C[M]);return c.box.apply(null,[c.types.moov,c.mvhd(C[0].timescale,C[0].duration)].concat(D).concat(c.mvex(C)))},c.mvex=function(C){for(var M=C.length,D=[];M--;)D[M]=c.trex(C[M]);return c.box.apply(null,[c.types.mvex].concat(D))},c.mvhd=function(C,M){M*=C;var D=Math.floor(M/(a+1)),A=Math.floor(M%(a+1)),_=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,C>>24&255,C>>16&255,C>>8&255,C&255,D>>24,D>>16&255,D>>8&255,D&255,A>>24,A>>16&255,A>>8&255,A&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return c.box(c.types.mvhd,_)},c.sdtp=function(C){var M=C.samples||[],D=new Uint8Array(4+M.length),A,_;for(A=0;A<M.length;A++)_=M[A].flags,D[A+4]=_.dependsOn<<4|_.isDependedOn<<2|_.hasRedundancy;return c.box(c.types.sdtp,D)},c.stbl=function(C){return c.box(c.types.stbl,c.stsd(C),c.box(c.types.stts,c.STTS),c.box(c.types.stsc,c.STSC),c.box(c.types.stsz,c.STSZ),c.box(c.types.stco,c.STCO))},c.avc1=function(C){var M=[],D=[],A,_,I;for(A=0;A<C.sps.length;A++)_=C.sps[A],I=_.byteLength,M.push(I>>>8&255),M.push(I&255),M=M.concat(Array.prototype.slice.call(_));for(A=0;A<C.pps.length;A++)_=C.pps[A],I=_.byteLength,D.push(I>>>8&255),D.push(I&255),D=D.concat(Array.prototype.slice.call(_));var S=c.box(c.types.avcC,new Uint8Array([1,M[3],M[4],M[5],255,224|C.sps.length].concat(M).concat([C.pps.length]).concat(D))),T=C.width,x=C.height,v=C.pixelRatio[0],i=C.pixelRatio[1];return c.box(c.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,T>>8&255,T&255,x>>8&255,x&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),S,c.box(c.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),c.box(c.types.pasp,new Uint8Array([v>>24,v>>16&255,v>>8&255,v&255,i>>24,i>>16&255,i>>8&255,i&255])))},c.esds=function(C){var M=C.config.length;return new Uint8Array([0,0,0,0,3,23+M,0,1,0,4,15+M,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([M]).concat(C.config).concat([6,1,2]))},c.mp4a=function(C){var M=C.samplerate;return c.box(c.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,C.channelCount,0,16,0,0,0,0,M>>8&255,M&255,0,0]),c.box(c.types.esds,c.esds(C)))},c.mp3=function(C){var M=C.samplerate;return c.box(c.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,C.channelCount,0,16,0,0,0,0,M>>8&255,M&255,0,0]))},c.stsd=function(C){return C.type==="audio"?C.segmentCodec==="mp3"&&C.codec==="mp3"?c.box(c.types.stsd,c.STSD,c.mp3(C)):c.box(c.types.stsd,c.STSD,c.mp4a(C)):c.box(c.types.stsd,c.STSD,c.avc1(C))},c.tkhd=function(C){var M=C.id,D=C.duration*C.timescale,A=C.width,_=C.height,I=Math.floor(D/(a+1)),S=Math.floor(D%(a+1));return c.box(c.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,M>>24&255,M>>16&255,M>>8&255,M&255,0,0,0,0,I>>24,I>>16&255,I>>8&255,I&255,S>>24,S>>16&255,S>>8&255,S&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,A>>8&255,A&255,0,0,_>>8&255,_&255,0,0]))},c.traf=function(C,M){var D=c.sdtp(C),A=C.id,_=Math.floor(M/(a+1)),I=Math.floor(M%(a+1));return c.box(c.types.traf,c.box(c.types.tfhd,new Uint8Array([0,0,0,0,A>>24,A>>16&255,A>>8&255,A&255])),c.box(c.types.tfdt,new Uint8Array([1,0,0,0,_>>24,_>>16&255,_>>8&255,_&255,I>>24,I>>16&255,I>>8&255,I&255])),c.trun(C,D.length+16+20+8+16+8+8),D)},c.trak=function(C){return C.duration=C.duration||4294967295,c.box(c.types.trak,c.tkhd(C),c.mdia(C))},c.trex=function(C){var M=C.id;return c.box(c.types.trex,new Uint8Array([0,0,0,0,M>>24,M>>16&255,M>>8&255,M&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},c.trun=function(C,M){var D=C.samples||[],A=D.length,_=12+16*A,I=new Uint8Array(_),S,T,x,v,i,u;for(M+=8+_,I.set([C.type==="video"?1:0,0,15,1,A>>>24&255,A>>>16&255,A>>>8&255,A&255,M>>>24&255,M>>>16&255,M>>>8&255,M&255],0),S=0;S<A;S++)T=D[S],x=T.duration,v=T.size,i=T.flags,u=T.cts,I.set([x>>>24&255,x>>>16&255,x>>>8&255,x&255,v>>>24&255,v>>>16&255,v>>>8&255,v&255,i.isLeading<<2|i.dependsOn,i.isDependedOn<<6|i.hasRedundancy<<4|i.paddingValue<<1|i.isNonSync,i.degradPrio&240<<8,i.degradPrio&15,u>>>24&255,u>>>16&255,u>>>8&255,u&255],12+16*S);return c.box(c.types.trun,I)},c.initSegment=function(C){c.types||c.init();var M=c.moov(C),D=new Uint8Array(c.FTYP.byteLength+M.byteLength);return D.set(c.FTYP),D.set(M,c.FTYP.byteLength),D},c}();o.types=void 0,o.HDLR_TYPES=void 0,o.STTS=void 0,o.STSC=void 0,o.STCO=void 0,o.STSZ=void 0,o.VMHD=void 0,o.SMHD=void 0,o.STSD=void 0,o.FTYP=void 0,o.DINF=void 0,e.default=o},"./src/remux/mp4-remuxer.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return i}),r.d(e,"normalizePts",function(){return u}),r.d(e,"flushTextTrackMetadataCueSamples",function(){return b}),r.d(e,"flushTextTrackUserdataCueSamples",function(){return l});var a=r("./src/polyfills/number.ts"),o=r("./src/remux/aac-helper.ts"),c=r("./src/remux/mp4-generator.ts"),O=r("./src/events.ts"),C=r("./src/errors.ts"),M=r("./src/utils/logger.ts"),D=r("./src/types/loader.ts"),A=r("./src/utils/timescale-conversion.ts");function _(){return _=Object.assign?Object.assign.bind():function(E){for(var n=1;n<arguments.length;n++){var d=arguments[n];for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(E[m]=d[m])}return E},_.apply(this,arguments)}var I=10*1e3,S=1024,T=1152,x=null,v=null,i=function(){function E(d,m,f,g){if(g===void 0&&(g=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=d,this.config=m,this.typeSupported=f,this.ISGenerated=!1,x===null){var y=navigator.userAgent||"",R=y.match(/Chrome\/(\d+)/i);x=R?parseInt(R[1]):0}if(v===null){var L=navigator.userAgent.match(/Safari\/(\d+)/i);v=L?parseInt(L[1]):0}}var n=E.prototype;return n.destroy=function(){},n.resetTimeStamp=function(m){M.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=m},n.resetNextTimestamp=function(){M.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},n.resetInitSegment=function(){M.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},n.getVideoStartPts=function(m){var f=!1,g=m.reduce(function(y,R){var L=R.pts-y;return L<-4294967296?(f=!0,u(y,R.pts)):L>0?y:R.pts},m[0].pts);return f&&M.logger.debug("PTS rollover detected"),g},n.remux=function(m,f,g,y,R,L,P,N){var B,F,H,j,X,$,G=R,J=R,ee=m.pid>-1,te=f.pid>-1,oe=f.samples.length,ue=m.samples.length>0,ae=P&&oe>0||oe>1,he=(!ee||ue)&&(!te||ae)||this.ISGenerated||P;if(he){this.ISGenerated||(H=this.generateIS(m,f,R));var me=this.isVideoContiguous,ne=-1,Me;if(ae&&(ne=p(f.samples),!me&&this.config.forceKeyFrameOnDiscontinuity))if($=!0,ne>0){M.logger.warn("[mp4-remuxer]: Dropped "+ne+" out of "+oe+" video samples due to a missing keyframe");var _e=this.getVideoStartPts(f.samples);f.samples=f.samples.slice(ne),f.dropped+=ne,J+=(f.samples[0].pts-_e)/f.inputTimeScale,Me=J}else ne===-1&&(M.logger.warn("[mp4-remuxer]: No keyframe found out of "+oe+" video samples"),$=!1);if(this.ISGenerated){if(ue&&ae){var Se=this.getVideoStartPts(f.samples),be=u(m.samples[0].pts,Se)-Se,Ue=be/f.inputTimeScale;G+=Math.max(0,Ue),J+=Math.max(0,-Ue)}if(ue){if(m.samplerate||(M.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),H=this.generateIS(m,f,R)),F=this.remuxAudio(m,G,this.isAudioContiguous,L,te||ae||N===D.PlaylistLevelType.AUDIO?J:void 0),ae){var Ze=F?F.endPTS-F.startPTS:0;f.inputTimeScale||(M.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),H=this.generateIS(m,f,R)),B=this.remuxVideo(f,J,me,Ze)}}else ae&&(B=this.remuxVideo(f,J,me,0));B&&(B.firstKeyFrame=ne,B.independent=ne!==-1,B.firstKeyFramePTS=Me)}}return this.ISGenerated&&(g.samples.length&&(X=b(g,R,this._initPTS,this._initDTS)),y.samples.length&&(j=l(y,R,this._initPTS))),{audio:F,video:B,initSegment:H,independent:$,text:j,id3:X}},n.generateIS=function(m,f,g){var y=m.samples,R=f.samples,L=this.typeSupported,P={},N=!Object(a.isFiniteNumber)(this._initPTS),B="audio/mp4",F,H,j;if(N&&(F=H=1/0),m.config&&y.length){switch(m.timescale=m.samplerate,m.segmentCodec){case"mp3":L.mpeg?(B="audio/mpeg",m.codec=""):L.mp3&&(m.codec="mp3");break}P.audio={id:"audio",container:B,codec:m.codec,initSegment:m.segmentCodec==="mp3"&&L.mpeg?new Uint8Array(0):c.default.initSegment([m]),metadata:{channelCount:m.channelCount}},N&&(j=m.inputTimeScale,F=H=y[0].pts-Math.round(j*g))}if(f.sps&&f.pps&&R.length&&(f.timescale=f.inputTimeScale,P.video={id:"main",container:"video/mp4",codec:f.codec,initSegment:c.default.initSegment([f]),metadata:{width:f.width,height:f.height}},N)){j=f.inputTimeScale;var X=this.getVideoStartPts(R),$=Math.round(j*g);H=Math.min(H,u(R[0].dts,X)-$),F=Math.min(F,X-$)}if(Object.keys(P).length)return this.ISGenerated=!0,N&&(this._initPTS=F,this._initDTS=H),{tracks:P,initPTS:F,timescale:j}},n.remuxVideo=function(m,f,g,y){var R=m.inputTimeScale,L=m.samples,P=[],N=L.length,B=this._initPTS,F=this.nextAvcDts,H=8,j=this.videoSampleDuration,X,$,G=Number.POSITIVE_INFINITY,J=Number.NEGATIVE_INFINITY,ee=!1;if(!g||F===null){var te=f*R,oe=L[0].pts-u(L[0].dts,L[0].pts);F=te-oe}for(var ue=0;ue<N;ue++){var ae=L[ue];ae.pts=u(ae.pts-B,F),ae.dts=u(ae.dts-B,F),ae.dts<L[ue>0?ue-1:ue].dts&&(ee=!0)}ee&&L.sort(function(Pr,Gi){var Er=Pr.dts-Gi.dts,nn=Pr.pts-Gi.pts;return Er||nn}),X=L[0].dts,$=L[L.length-1].dts;var he=$-X,me=he?Math.round(he/(N-1)):j||m.inputTimeScale/30;if(g){var ne=X-F,Me=ne>me,_e=ne<-1;if(Me||_e){Me?M.logger.warn("AVC: "+Object(A.toMsFromMpegTsClock)(ne,!0)+" ms ("+ne+"dts) hole between fragments detected, filling it"):M.logger.warn("AVC: "+Object(A.toMsFromMpegTsClock)(-ne,!0)+" ms ("+ne+"dts) overlapping between fragments detected"),X=F;var Se=L[0].pts-ne;L[0].dts=X,L[0].pts=Se,M.logger.log("Video: First PTS/DTS adjusted: "+Object(A.toMsFromMpegTsClock)(Se,!0)+"/"+Object(A.toMsFromMpegTsClock)(X,!0)+", delta: "+Object(A.toMsFromMpegTsClock)(ne,!0)+" ms")}}X=Math.max(0,X);for(var be=0,Ue=0,Ze=0;Ze<N;Ze++){for(var We=L[Ze],tt=We.units,Fe=tt.length,ot=0,ft=0;ft<Fe;ft++)ot+=tt[ft].data.length;Ue+=ot,be+=Fe,We.length=ot,We.dts=Math.max(We.dts,X),G=Math.min(We.pts,G),J=Math.max(We.pts,J)}$=L[N-1].dts;var ht=Ue+4*be+8,lt;try{lt=new Uint8Array(ht)}catch{this.observer.emit(O.Events.ERROR,O.Events.ERROR,{type:C.ErrorTypes.MUX_ERROR,details:C.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ht,reason:"fail allocating video mdat "+ht});return}var It=new DataView(lt.buffer);It.setUint32(0,ht),lt.set(c.default.types.mdat,4);for(var rt=!1,Rt=Number.POSITIVE_INFINITY,Ye=Number.POSITIVE_INFINITY,Je=Number.NEGATIVE_INFINITY,Et=Number.NEGATIVE_INFINITY,qe=0;qe<N;qe++){for(var He=L[qe],Pt=He.units,vt=0,Wt=0,mr=Pt.length;Wt<mr;Wt++){var _t=Pt[Wt],Cr=_t.data,gr=_t.data.byteLength;It.setUint32(H,gr),H+=4,lt.set(Cr,H),H+=gr,vt+=4+gr}var kt=void 0;if(qe<N-1)j=L[qe+1].dts-He.dts,kt=L[qe+1].pts-He.pts;else{var Ht=this.config,wt=qe>0?He.dts-L[qe-1].dts:me;if(kt=qe>0?He.pts-L[qe-1].pts:me,Ht.stretchShortVideoTrack&&this.nextAudioPts!==null){var pr=Math.floor(Ht.maxBufferHole*R),ar=(y?G+y*R:this.nextAudioPts)-He.pts;ar>pr?(j=ar-wt,j<0?j=wt:rt=!0,M.logger.log("[mp4-remuxer]: It is approximately "+ar/90+" ms to the next segment; using duration "+j/90+" ms for the last video frame.")):j=wt}else j=wt}var tn=Math.round(He.pts-He.dts);Rt=Math.min(Rt,j),Je=Math.max(Je,j),Ye=Math.min(Ye,kt),Et=Math.max(Et,kt),P.push(new s(He.key,j,vt,tn))}if(P.length){if(x){if(x<70){var ii=P[0].flags;ii.dependsOn=2,ii.isNonSync=0}}else if(v&&Et-Ye<Je-Rt&&me/Je<.025&&P[0].cts===0){M.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Or=X,St=0,Wi=P.length;St<Wi;St++){var ai=Or+P[St].duration,Hi=Or+P[St].cts;if(St<Wi-1){var ni=ai+P[St+1].cts;P[St].duration=ni-Hi}else P[St].duration=St?P[St-1].duration:me;P[St].cts=0,Or=ai}}}console.assert(j!==null,"mp4SampleDuration must be computed"),j=rt||!j?me:j,this.nextAvcDts=F=$+j,this.videoSampleDuration=j,this.isVideoContiguous=!0;var rn=c.default.moof(m.sequenceNumber++,X,_({},m,{samples:P})),an="video",Ut={data1:rn,data2:lt,startPTS:G/R,endPTS:(J+j)/R,startDTS:X/R,endDTS:F/R,type:an,hasAudio:!1,hasVideo:!0,nb:P.length,dropped:m.dropped};return m.samples=[],m.dropped=0,console.assert(lt.length,"MDAT length must not be zero"),Ut},n.remuxAudio=function(m,f,g,y,R){var L=m.inputTimeScale,P=m.samplerate?m.samplerate:L,N=L/P,B=m.segmentCodec==="aac"?S:T,F=B*N,H=this._initPTS,j=m.segmentCodec==="mp3"&&this.typeSupported.mpeg,X=[],$=R!==void 0,G=m.samples,J=j?0:8,ee=this.nextAudioPts||-1,te=f*L;if(this.isAudioContiguous=g=g||G.length&&ee>0&&(y&&Math.abs(te-ee)<9e3||Math.abs(u(G[0].pts-H,te)-ee)<20*F),G.forEach(function(_t){_t.pts=u(_t.pts-H,te)}),!g||ee<0){if(G=G.filter(function(_t){return _t.pts>=0}),!G.length)return;R===0?ee=0:y&&!$?ee=Math.max(0,te):ee=G[0].pts}if(m.segmentCodec==="aac")for(var oe=this.config.maxAudioFramesDrift,ue=0,ae=ee;ue<G.length;ue++){var he=G[ue],me=he.pts,ne=me-ae,Me=Math.abs(1e3*ne/L);if(ne<=-oe*F&&$)ue===0&&(M.logger.warn("Audio frame @ "+(me/L).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*ne/L)+" ms."),this.nextAudioPts=ee=ae=me);else if(ne>=oe*F&&Me<I&&$){var _e=Math.round(ne/F);ae=me-_e*F,ae<0&&(_e--,ae+=F),ue===0&&(this.nextAudioPts=ee=ae),M.logger.warn("[mp4-remuxer]: Injecting "+_e+" audio frame @ "+(ae/L).toFixed(3)+"s due to "+Math.round(1e3*ne/L)+" ms gap.");for(var Se=0;Se<_e;Se++){var be=Math.max(ae,0),Ue=o.default.getSilentFrame(m.manifestCodec||m.codec,m.channelCount);Ue||(M.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Ue=he.unit.subarray()),G.splice(ue,0,{unit:Ue,pts:be}),ae+=F,ue++}}he.pts=ae,ae+=F}for(var Ze=null,We=null,tt,Fe=0,ot=G.length;ot--;)Fe+=G[ot].unit.byteLength;for(var ft=0,ht=G.length;ft<ht;ft++){var lt=G[ft],It=lt.unit,rt=lt.pts;if(We!==null){var Rt=X[ft-1];Rt.duration=Math.round((rt-We)/N)}else if(g&&m.segmentCodec==="aac"&&(rt=ee),Ze=rt,Fe>0){Fe+=J;try{tt=new Uint8Array(Fe)}catch{this.observer.emit(O.Events.ERROR,O.Events.ERROR,{type:C.ErrorTypes.MUX_ERROR,details:C.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Fe,reason:"fail allocating audio mdat "+Fe});return}if(!j){var Ye=new DataView(tt.buffer);Ye.setUint32(0,Fe),tt.set(c.default.types.mdat,4)}}else return;tt.set(It,J);var Je=It.byteLength;J+=Je,X.push(new s(!0,B,Je,0)),We=rt}var Et=X.length;if(!!Et){var qe=X[X.length-1];this.nextAudioPts=ee=We+N*qe.duration;var He=j?new Uint8Array(0):c.default.moof(m.sequenceNumber++,Ze/N,_({},m,{samples:X}));m.samples=[];var Pt=Ze/L,vt=ee/L,Wt="audio",mr={data1:He,data2:tt,startPTS:Pt,endPTS:vt,startDTS:Pt,endDTS:vt,type:Wt,hasAudio:!0,hasVideo:!1,nb:Et};return this.isAudioContiguous=!0,console.assert(tt.length,"MDAT length must not be zero"),mr}},n.remuxEmptyAudio=function(m,f,g,y){var R=m.inputTimeScale,L=m.samplerate?m.samplerate:R,P=R/L,N=this.nextAudioPts,B=(N!==null?N:y.startDTS*R)+this._initDTS,F=y.endDTS*R+this._initDTS,H=P*S,j=Math.ceil((F-B)/H),X=o.default.getSilentFrame(m.manifestCodec||m.codec,m.channelCount);if(M.logger.warn("[mp4-remuxer]: remux empty Audio"),!X){M.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var $=[],G=0;G<j;G++){var J=B+G*H;$.push({unit:X,pts:J,dts:J})}return m.samples=$,this.remuxAudio(m,f,g,!1)},E}();function u(E,n){var d;if(n===null)return E;for(n<E?d=-8589934592:d=8589934592;Math.abs(E-n)>4294967296;)E+=d;return E}function p(E){for(var n=0;n<E.length;n++)if(E[n].key)return n;return-1}function b(E,n,d,m){var f=E.samples.length;if(!!f){for(var g=E.inputTimeScale,y=0;y<f;y++){var R=E.samples[y];R.pts=u(R.pts-d,n*g)/g,R.dts=u(R.dts-m,n*g)/g}var L=E.samples;return E.samples=[],{samples:L}}}function l(E,n,d){var m=E.samples.length;if(!!m){for(var f=E.inputTimeScale,g=0;g<m;g++){var y=E.samples[g];y.pts=u(y.pts-d,n*f)/f}E.samples.sort(function(L,P){return L.pts-P.pts});var R=E.samples;return E.samples=[],{samples:R}}}var s=function(n,d,m,f){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=d,this.size=m,this.cts=f,this.flags=new h(n)},h=function(n){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=n?2:1,this.isNonSync=n?0:1}},"./src/remux/passthrough-remuxer.ts":function(t,e,r){"use strict";r.r(e);var a=r("./src/polyfills/number.ts"),o=r("./src/remux/mp4-remuxer.ts"),c=r("./src/utils/mp4-tools.ts"),O=r("./src/loader/fragment.ts"),C=r("./src/utils/logger.ts"),M=function(){function A(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var _=A.prototype;return _.destroy=function(){},_.resetTimeStamp=function(S){this.initPTS=S,this.lastEndTime=null},_.resetNextTimestamp=function(){this.lastEndTime=null},_.resetInitSegment=function(S,T,x){this.audioCodec=T,this.videoCodec=x,this.generateInitSegment(S),this.emitInitSegment=!0},_.generateInitSegment=function(S){var T=this.audioCodec,x=this.videoCodec;if(!S||!S.byteLength){this.initTracks=void 0,this.initData=void 0;return}var v=this.initData=Object(c.parseInitSegment)(S);T||(T=D(v.audio,O.ElementaryStreamTypes.AUDIO)),x||(x=D(v.video,O.ElementaryStreamTypes.VIDEO));var i={};v.audio&&v.video?i.audiovideo={container:"video/mp4",codec:T+","+x,initSegment:S,id:"main"}:v.audio?i.audio={container:"audio/mp4",codec:T,initSegment:S,id:"audio"}:v.video?i.video={container:"video/mp4",codec:x,initSegment:S,id:"main"}:C.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=i},_.remux=function(S,T,x,v,i){var u,p=this.initPTS,b=this.lastEndTime,l={audio:void 0,video:void 0,text:v,id3:x,initSegment:void 0};Object(a.isFiniteNumber)(b)||(b=this.lastEndTime=i||0);var s=T.samples;if(!s||!s.length)return l;var h={initPTS:void 0,timescale:1},E=this.initData;if((!E||!E.length)&&(this.generateInitSegment(s),E=this.initData),!E||!E.length)return C.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),l;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);var n=Object(c.getStartDTS)(E,s);Object(a.isFiniteNumber)(p)||(this.initPTS=h.initPTS=p=n-i);var d=Object(c.getDuration)(s,E),m=S?n-p:b,f=m+d;Object(c.offsetStartDTS)(E,s,p),d>0?this.lastEndTime=f:(C.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var g=!!E.audio,y=!!E.video,R="";g&&(R+="audio"),y&&(R+="video");var L={data1:s,startPTS:m,startDTS:m,endPTS:f,endDTS:f,type:R,hasAudio:g,hasVideo:y,nb:1,dropped:0};l.audio=L.type==="audio"?L:void 0,l.video=L.type!=="audio"?L:void 0,l.initSegment=h;var P=(u=this.initPTS)!=null?u:0;return l.id3=Object(o.flushTextTrackMetadataCueSamples)(x,i,P,P),v.samples.length&&(l.text=Object(o.flushTextTrackUserdataCueSamples)(v,i,P)),l},A}();function D(A,_){var I=A==null?void 0:A.codec;return I&&I.length>4?I:I==="hvc1"||I==="hev1"?"hvc1.1.c.L120.90":I==="av01"?"av01.0.04M.08":I==="avc1"||_===O.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}e.default=M},"./src/task-loop.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return a});var a=function(){function o(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var c=o.prototype;return c.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},c.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},c.onHandlerDestroyed=function(){},c.hasInterval=function(){return!!this._tickInterval},c.hasNextTick=function(){return!!this._tickTimer},c.setInterval=function(C){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,C),!0)},c.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},c.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},c.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},c.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},c.doTick=function(){},o}()},"./src/types/cmcd.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"CMCDVersion",function(){return a}),r.d(e,"CMCDObjectType",function(){return o}),r.d(e,"CMCDStreamingFormat",function(){return c}),r.d(e,"CMCDStreamType",function(){return O});var a=1,o;(function(C){C.MANIFEST="m",C.AUDIO="a",C.VIDEO="v",C.MUXED="av",C.INIT="i",C.CAPTION="c",C.TIMED_TEXT="tt",C.KEY="k",C.OTHER="o"})(o||(o={}));var c;(function(C){C.DASH="d",C.HLS="h",C.SMOOTH="s",C.OTHER="o"})(c||(c={}));var O;(function(C){C.VOD="v",C.LIVE="l"})(O||(O={}))},"./src/types/demuxer.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"MetadataSchema",function(){return a});var a;(function(o){o.audioId3="org.id3",o.dateRange="com.apple.quicktime.HLS",o.emsg="https://aomedia.org/emsg/ID3"})(a||(a={}))},"./src/types/level.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"HlsSkip",function(){return c}),r.d(e,"getSkipValue",function(){return O}),r.d(e,"HlsUrlParameters",function(){return C}),r.d(e,"Level",function(){return M});function a(D,A){for(var _=0;_<A.length;_++){var I=A[_];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(D,I.key,I)}}function o(D,A,_){return A&&a(D.prototype,A),_&&a(D,_),Object.defineProperty(D,"prototype",{writable:!1}),D}var c;(function(D){D.No="",D.Yes="YES",D.v2="v2"})(c||(c={}));function O(D,A){var _=D.canSkipUntil,I=D.canSkipDateRanges,S=D.endSN,T=A!==void 0?A-S:0;return _&&T<_?I?c.v2:c.Yes:c.No}var C=function(){function D(_,I,S){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=_,this.part=I,this.skip=S}var A=D.prototype;return A.addDirectives=function(I){var S=new self.URL(I);return this.msn!==void 0&&S.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&S.searchParams.set("_HLS_part",this.part.toString()),this.skip&&S.searchParams.set("_HLS_skip",this.skip),S.toString()},D}(),M=function(){function D(A){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[A.url],this.attrs=A.attrs,this.bitrate=A.bitrate,A.details&&(this.details=A.details),this.id=A.id||0,this.name=A.name,this.width=A.width||0,this.height=A.height||0,this.audioCodec=A.audioCodec,this.videoCodec=A.videoCodec,this.unknownCodecs=A.unknownCodecs,this.codecSet=[A.videoCodec,A.audioCodec].filter(function(_){return _}).join(",").replace(/\.[^.,]+/g,"")}return o(D,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(_){var I=_%this.url.length;this._urlId!==I&&(this.details=void 0,this._urlId=I)}}]),D}()},"./src/types/loader.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"PlaylistContextType",function(){return a}),r.d(e,"PlaylistLevelType",function(){return o});var a;(function(c){c.MANIFEST="manifest",c.LEVEL="level",c.AUDIO_TRACK="audioTrack",c.SUBTITLE_TRACK="subtitleTrack"})(a||(a={}));var o;(function(c){c.MAIN="main",c.AUDIO="audio",c.SUBTITLE="subtitle"})(o||(o={}))},"./src/types/transmuxer.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"ChunkMetadata",function(){return a});var a=function(O,C,M,D,A,_){D===void 0&&(D=0),A===void 0&&(A=-1),_===void 0&&(_=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=o(),this.buffering={audio:o(),video:o(),audiovideo:o()},this.level=O,this.sn=C,this.id=M,this.size=D,this.part=A,this.partial=_};function o(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"AttrList",function(){return c});var a=/^(\d+)x(\d+)$/,o=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,c=function(){function O(M){typeof M=="string"&&(M=O.parseAttrList(M));for(var D in M)M.hasOwnProperty(D)&&(this[D]=M[D])}var C=O.prototype;return C.decimalInteger=function(D){var A=parseInt(this[D],10);return A>Number.MAX_SAFE_INTEGER?1/0:A},C.hexadecimalInteger=function(D){if(this[D]){var A=(this[D]||"0x").slice(2);A=(A.length&1?"0":"")+A;for(var _=new Uint8Array(A.length/2),I=0;I<A.length/2;I++)_[I]=parseInt(A.slice(I*2,I*2+2),16);return _}else return null},C.hexadecimalIntegerAsNumber=function(D){var A=parseInt(this[D],16);return A>Number.MAX_SAFE_INTEGER?1/0:A},C.decimalFloatingPoint=function(D){return parseFloat(this[D])},C.optionalFloat=function(D,A){var _=this[D];return _?parseFloat(_):A},C.enumeratedString=function(D){return this[D]},C.bool=function(D){return this[D]==="YES"},C.decimalResolution=function(D){var A=a.exec(this[D]);if(A!==null)return{width:parseInt(A[1],10),height:parseInt(A[2],10)}},O.parseAttrList=function(D){var A,_={},I='"';for(o.lastIndex=0;(A=o.exec(D))!==null;){var S=A[2];S.indexOf(I)===0&&S.lastIndexOf(I)===S.length-1&&(S=S.slice(1,-1)),_[A[1]]=S}return _},O}()},"./src/utils/binary-search.ts":function(t,e,r){"use strict";r.r(e);var a={search:function(c,O){for(var C=0,M=c.length-1,D=null,A=null;C<=M;){D=(C+M)/2|0,A=c[D];var _=O(A);if(_>0)C=D+1;else if(_<0)M=D-1;else return A}return null}};e.default=a},"./src/utils/buffer-helper.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"BufferHelper",function(){return c});var a=r("./src/utils/logger.ts"),o={length:0,start:function(){return 0},end:function(){return 0}},c=function(){function O(){}return O.isBuffered=function(M,D){try{if(M){for(var A=O.getBuffered(M),_=0;_<A.length;_++)if(D>=A.start(_)&&D<=A.end(_))return!0}}catch{}return!1},O.bufferInfo=function(M,D,A){try{if(M){var _=O.getBuffered(M),I=[],S;for(S=0;S<_.length;S++)I.push({start:_.start(S),end:_.end(S)});return this.bufferedInfo(I,D,A)}}catch{}return{len:0,start:D,end:D,nextStart:void 0}},O.bufferedInfo=function(M,D,A){D=Math.max(0,D),M.sort(function(s,h){var E=s.start-h.start;return E||h.end-s.end});var _=[];if(A)for(var I=0;I<M.length;I++){var S=_.length;if(S){var T=_[S-1].end;M[I].start-T<A?M[I].end>T&&(_[S-1].end=M[I].end):_.push(M[I])}else _.push(M[I])}else _=M;for(var x=0,v,i=D,u=D,p=0;p<_.length;p++){var b=_[p].start,l=_[p].end;if(D+A>=b&&D<l)i=b,u=l,x=u-D;else if(D+A<b){v=b;break}}return{len:x,start:i||0,end:u||0,nextStart:v}},O.getBuffered=function(M){try{return M.buffered}catch(D){return a.logger.log("failed to get media.buffered",D),o}},O}()},"./src/utils/cea-608-parser.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"Row",function(){return u}),r.d(e,"CaptionScreen",function(){return p});var a=r("./src/utils/logger.ts"),o={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},c=function(d){var m=d;return o.hasOwnProperty(d)&&(m=o[d]),String.fromCharCode(m)},O=15,C=100,M={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},D={17:2,18:4,21:6,22:8,23:10,19:13,20:15},A={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},_={25:2,26:4,29:6,30:8,31:10,27:13,28:15},I=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],S;(function(n){n[n.ERROR=0]="ERROR",n[n.TEXT=1]="TEXT",n[n.WARNING=2]="WARNING",n[n.INFO=2]="INFO",n[n.DEBUG=3]="DEBUG",n[n.DATA=3]="DATA"})(S||(S={}));var T=function(){function n(){this.time=null,this.verboseLevel=S.ERROR}var d=n.prototype;return d.log=function(f,g){this.verboseLevel>=f&&a.logger.log(this.time+" ["+f+"] "+g)},n}(),x=function(d){for(var m=[],f=0;f<d.length;f++)m.push(d[f].toString(16));return m},v=function(){function n(m,f,g,y,R){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=m||"white",this.underline=f||!1,this.italics=g||!1,this.background=y||"black",this.flash=R||!1}var d=n.prototype;return d.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},d.setStyles=function(f){for(var g=["foreground","underline","italics","background","flash"],y=0;y<g.length;y++){var R=g[y];f.hasOwnProperty(R)&&(this[R]=f[R])}},d.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},d.equals=function(f){return this.foreground===f.foreground&&this.underline===f.underline&&this.italics===f.italics&&this.background===f.background&&this.flash===f.flash},d.copy=function(f){this.foreground=f.foreground,this.underline=f.underline,this.italics=f.italics,this.background=f.background,this.flash=f.flash},d.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},n}(),i=function(){function n(m,f,g,y,R,L){this.uchar=void 0,this.penState=void 0,this.uchar=m||" ",this.penState=new v(f,g,y,R,L)}var d=n.prototype;return d.reset=function(){this.uchar=" ",this.penState.reset()},d.setChar=function(f,g){this.uchar=f,this.penState.copy(g)},d.setPenState=function(f){this.penState.copy(f)},d.equals=function(f){return this.uchar===f.uchar&&this.penState.equals(f.penState)},d.copy=function(f){this.uchar=f.uchar,this.penState.copy(f.penState)},d.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},n}(),u=function(){function n(m){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var f=0;f<C;f++)this.chars.push(new i);this.logger=m,this.pos=0,this.currPenState=new v}var d=n.prototype;return d.equals=function(f){for(var g=!0,y=0;y<C;y++)if(!this.chars[y].equals(f.chars[y])){g=!1;break}return g},d.copy=function(f){for(var g=0;g<C;g++)this.chars[g].copy(f.chars[g])},d.isEmpty=function(){for(var f=!0,g=0;g<C;g++)if(!this.chars[g].isEmpty()){f=!1;break}return f},d.setCursor=function(f){this.pos!==f&&(this.pos=f),this.pos<0?(this.logger.log(S.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>C&&(this.logger.log(S.DEBUG,"Too large cursor position "+this.pos),this.pos=C)},d.moveCursor=function(f){var g=this.pos+f;if(f>1)for(var y=this.pos+1;y<g+1;y++)this.chars[y].setPenState(this.currPenState);this.setCursor(g)},d.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},d.insertChar=function(f){f>=144&&this.backSpace();var g=c(f);if(this.pos>=C){this.logger.log(S.ERROR,"Cannot insert "+f.toString(16)+" ("+g+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(g,this.currPenState),this.moveCursor(1)},d.clearFromPos=function(f){var g;for(g=f;g<C;g++)this.chars[g].reset()},d.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},d.clearToEndOfRow=function(){this.clearFromPos(this.pos)},d.getTextString=function(){for(var f=[],g=!0,y=0;y<C;y++){var R=this.chars[y].uchar;R!==" "&&(g=!1),f.push(R)}return g?"":f.join("")},d.setPenStyles=function(f){this.currPenState.setStyles(f);var g=this.chars[this.pos];g.setPenState(this.currPenState)},n}(),p=function(){function n(m){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var f=0;f<O;f++)this.rows.push(new u(m));this.logger=m,this.currRow=O-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var d=n.prototype;return d.reset=function(){for(var f=0;f<O;f++)this.rows[f].clear();this.currRow=O-1},d.equals=function(f){for(var g=!0,y=0;y<O;y++)if(!this.rows[y].equals(f.rows[y])){g=!1;break}return g},d.copy=function(f){for(var g=0;g<O;g++)this.rows[g].copy(f.rows[g])},d.isEmpty=function(){for(var f=!0,g=0;g<O;g++)if(!this.rows[g].isEmpty()){f=!1;break}return f},d.backSpace=function(){var f=this.rows[this.currRow];f.backSpace()},d.clearToEndOfRow=function(){var f=this.rows[this.currRow];f.clearToEndOfRow()},d.insertChar=function(f){var g=this.rows[this.currRow];g.insertChar(f)},d.setPen=function(f){var g=this.rows[this.currRow];g.setPenStyles(f)},d.moveCursor=function(f){var g=this.rows[this.currRow];g.moveCursor(f)},d.setCursor=function(f){this.logger.log(S.INFO,"setCursor: "+f);var g=this.rows[this.currRow];g.setCursor(f)},d.setPAC=function(f){this.logger.log(S.INFO,"pacData = "+JSON.stringify(f));var g=f.row-1;if(this.nrRollUpRows&&g<this.nrRollUpRows-1&&(g=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==g){for(var y=0;y<O;y++)this.rows[y].clear();var R=this.currRow+1-this.nrRollUpRows,L=this.lastOutputScreen;if(L){var P=L.rows[R].cueStartTime,N=this.logger.time;if(P&&N!==null&&P<N)for(var B=0;B<this.nrRollUpRows;B++)this.rows[g-this.nrRollUpRows+B+1].copy(L.rows[R+B])}}this.currRow=g;var F=this.rows[this.currRow];if(f.indent!==null){var H=f.indent,j=Math.max(H-1,0);F.setCursor(f.indent),f.color=F.chars[j].penState.foreground}var X={foreground:f.color,underline:f.underline,italics:f.italics,background:"black",flash:!1};this.setPen(X)},d.setBkgData=function(f){this.logger.log(S.INFO,"bkgData = "+JSON.stringify(f)),this.backSpace(),this.setPen(f),this.insertChar(32)},d.setRollUpRows=function(f){this.nrRollUpRows=f},d.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(S.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(S.TEXT,this.getDisplayText());var f=this.currRow+1-this.nrRollUpRows,g=this.rows.splice(f,1)[0];g.clear(),this.rows.splice(this.currRow,0,g),this.logger.log(S.INFO,"Rolling up")},d.getDisplayText=function(f){f=f||!1;for(var g=[],y="",R=-1,L=0;L<O;L++){var P=this.rows[L].getTextString();P&&(R=L+1,f?g.push("Row "+R+": '"+P+"'"):g.push(P.trim()))}return g.length>0&&(f?y="["+g.join(" | ")+"]":y=g.join(`
`)),y},d.getTextAndFormat=function(){return this.rows},n}(),b=function(){function n(m,f,g){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=m,this.outputFilter=f,this.mode=null,this.verbose=0,this.displayedMemory=new p(g),this.nonDisplayedMemory=new p(g),this.lastOutputScreen=new p(g),this.currRollUpRow=this.displayedMemory.rows[O-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=g}var d=n.prototype;return d.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[O-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},d.getHandler=function(){return this.outputFilter},d.setHandler=function(f){this.outputFilter=f},d.setPAC=function(f){this.writeScreen.setPAC(f)},d.setBkgData=function(f){this.writeScreen.setBkgData(f)},d.setMode=function(f){f!==this.mode&&(this.mode=f,this.logger.log(S.INFO,"MODE="+f),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=f)},d.insertChars=function(f){for(var g=0;g<f.length;g++)this.writeScreen.insertChar(f[g]);var y=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(S.INFO,y+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(S.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},d.ccRCL=function(){this.logger.log(S.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},d.ccBS=function(){this.logger.log(S.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},d.ccAOF=function(){},d.ccAON=function(){},d.ccDER=function(){this.logger.log(S.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},d.ccRU=function(f){this.logger.log(S.INFO,"RU("+f+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(f)},d.ccFON=function(){this.logger.log(S.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},d.ccRDC=function(){this.logger.log(S.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},d.ccTR=function(){this.logger.log(S.INFO,"TR"),this.setMode("MODE_TEXT")},d.ccRTD=function(){this.logger.log(S.INFO,"RTD"),this.setMode("MODE_TEXT")},d.ccEDM=function(){this.logger.log(S.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},d.ccCR=function(){this.logger.log(S.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},d.ccENM=function(){this.logger.log(S.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},d.ccEOC=function(){if(this.logger.log(S.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var f=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=f,this.writeScreen=this.nonDisplayedMemory,this.logger.log(S.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},d.ccTO=function(f){this.logger.log(S.INFO,"TO("+f+") - Tab Offset"),this.writeScreen.moveCursor(f)},d.ccMIDROW=function(f){var g={flash:!1};if(g.underline=f%2===1,g.italics=f>=46,g.italics)g.foreground="white";else{var y=Math.floor(f/2)-16,R=["white","green","blue","cyan","red","yellow","magenta"];g.foreground=R[y]}this.logger.log(S.INFO,"MIDROW: "+JSON.stringify(g)),this.writeScreen.setPen(g)},d.outputDataUpdate=function(f){f===void 0&&(f=!1);var g=this.logger.time;g!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=g:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,g,this.lastOutputScreen),f&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:g),this.lastOutputScreen.copy(this.displayedMemory))},d.cueSplitAtTime=function(f){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,f,this.displayedMemory),this.cueStartTime=f))},n}(),l=function(){function n(m,f,g){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var y=new T;this.channels=[null,new b(m,f,y),new b(m+1,g,y)],this.cmdHistory=E(),this.logger=y}var d=n.prototype;return d.getHandler=function(f){return this.channels[f].getHandler()},d.setHandler=function(f,g){this.channels[f].setHandler(g)},d.addData=function(f,g){var y,R,L,P=!1;this.logger.time=f;for(var N=0;N<g.length;N+=2)if(R=g[N]&127,L=g[N+1]&127,!(R===0&&L===0)){if(this.logger.log(S.DATA,"["+x([g[N],g[N+1]])+"] -> ("+x([R,L])+")"),y=this.parseCmd(R,L),y||(y=this.parseMidrow(R,L)),y||(y=this.parsePAC(R,L)),y||(y=this.parseBackgroundAttributes(R,L)),!y&&(P=this.parseChars(R,L),P)){var B=this.currentChannel;if(B&&B>0){var F=this.channels[B];F.insertChars(P)}else this.logger.log(S.WARNING,"No channel found yet. TEXT-MODE?")}!y&&!P&&this.logger.log(S.WARNING,"Couldn't parse cleaned data "+x([R,L])+" orig: "+x([g[N],g[N+1]]))}},d.parseCmd=function(f,g){var y=this.cmdHistory,R=(f===20||f===28||f===21||f===29)&&g>=32&&g<=47,L=(f===23||f===31)&&g>=33&&g<=35;if(!(R||L))return!1;if(h(f,g,y))return s(null,null,y),this.logger.log(S.DEBUG,"Repeated command ("+x([f,g])+") is dropped"),!0;var P=f===20||f===21||f===23?1:2,N=this.channels[P];return f===20||f===21||f===28||f===29?g===32?N.ccRCL():g===33?N.ccBS():g===34?N.ccAOF():g===35?N.ccAON():g===36?N.ccDER():g===37?N.ccRU(2):g===38?N.ccRU(3):g===39?N.ccRU(4):g===40?N.ccFON():g===41?N.ccRDC():g===42?N.ccTR():g===43?N.ccRTD():g===44?N.ccEDM():g===45?N.ccCR():g===46?N.ccENM():g===47&&N.ccEOC():N.ccTO(g-32),s(f,g,y),this.currentChannel=P,!0},d.parseMidrow=function(f,g){var y=0;if((f===17||f===25)&&g>=32&&g<=47){if(f===17?y=1:y=2,y!==this.currentChannel)return this.logger.log(S.ERROR,"Mismatch channel in midrow parsing"),!1;var R=this.channels[y];return R?(R.ccMIDROW(g),this.logger.log(S.DEBUG,"MIDROW ("+x([f,g])+")"),!0):!1}return!1},d.parsePAC=function(f,g){var y,R=this.cmdHistory,L=(f>=17&&f<=23||f>=25&&f<=31)&&g>=64&&g<=127,P=(f===16||f===24)&&g>=64&&g<=95;if(!(L||P))return!1;if(h(f,g,R))return s(null,null,R),!0;var N=f<=23?1:2;g>=64&&g<=95?y=N===1?M[f]:A[f]:y=N===1?D[f]:_[f];var B=this.channels[N];return B?(B.setPAC(this.interpretPAC(y,g)),s(f,g,R),this.currentChannel=N,!0):!1},d.interpretPAC=function(f,g){var y,R={color:null,italics:!1,indent:null,underline:!1,row:f};return g>95?y=g-96:y=g-64,R.underline=(y&1)===1,y<=13?R.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(y/2)]:y<=15?(R.italics=!0,R.color="white"):R.indent=Math.floor((y-16)/2)*4,R},d.parseChars=function(f,g){var y,R=null,L=null;if(f>=25?(y=2,L=f-8):(y=1,L=f),L>=17&&L<=19){var P;L===17?P=g+80:L===18?P=g+112:P=g+144,this.logger.log(S.INFO,"Special char '"+c(P)+"' in channel "+y),R=[P]}else f>=32&&f<=127&&(R=g===0?[f]:[f,g]);if(R){var N=x(R);this.logger.log(S.DEBUG,"Char codes =  "+N.join(",")),s(f,g,this.cmdHistory)}return R},d.parseBackgroundAttributes=function(f,g){var y=(f===16||f===24)&&g>=32&&g<=47,R=(f===23||f===31)&&g>=45&&g<=47;if(!(y||R))return!1;var L,P={};f===16||f===24?(L=Math.floor((g-32)/2),P.background=I[L],g%2===1&&(P.background=P.background+"_semi")):g===45?P.background="transparent":(P.foreground="black",g===47&&(P.underline=!0));var N=f<=23?1:2,B=this.channels[N];return B.setBkgData(P),s(f,g,this.cmdHistory),!0},d.reset=function(){for(var f=0;f<Object.keys(this.channels).length;f++){var g=this.channels[f];g&&g.reset()}this.cmdHistory=E()},d.cueSplitAtTime=function(f){for(var g=0;g<this.channels.length;g++){var y=this.channels[g];y&&y.cueSplitAtTime(f)}},n}();function s(n,d,m){m.a=n,m.b=d}function h(n,d,m){return m.a===n&&m.b===d}function E(){return{a:null,b:null}}e.default=l},"./src/utils/codecs.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"isCodecType",function(){return o}),r.d(e,"isCodecSupportedInMp4",function(){return c});var a={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function o(O,C){var M=a[C];return!!M&&M[O.slice(0,4)]===!0}function c(O,C){return MediaSource.isTypeSupported((C||"video")+'/mp4;codecs="'+O+'"')}},"./src/utils/cues.ts":function(t,e,r){"use strict";r.r(e);var a=r("./src/utils/vttparser.ts"),o=r("./src/utils/webvtt-parser.ts"),c=r("./src/utils/texttrack-utils.ts"),O=/\s/,C={newCue:function(D,A,_,I){for(var S=[],T,x,v,i,u,p=self.VTTCue||self.TextTrackCue,b=0;b<I.rows.length;b++)if(T=I.rows[b],v=!0,i=0,u="",!T.isEmpty()){for(var l=0;l<T.chars.length;l++)O.test(T.chars[l].uchar)&&v?i++:(u+=T.chars[l].uchar,v=!1);T.cueStartTime=A,A===_&&(_+=1e-4),i>=16?i--:i++;var s=Object(a.fixLineBreaks)(u.trim()),h=Object(o.generateCueId)(A,_,s);(!D||!D.cues||!D.cues.getCueById(h))&&(x=new p(A,_,s),x.id=h,x.line=b+1,x.align="left",x.position=10+Math.min(80,Math.floor(i*8/32)*10),S.push(x))}return D&&S.length&&(S.sort(function(E,n){return E.line==="auto"||n.line==="auto"?0:E.line>8&&n.line>8?n.line-E.line:E.line-n.line}),S.forEach(function(E){return Object(c.addCueToTrack)(D,E)})),S}};e.default=C},"./src/utils/discontinuities.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"findFirstFragWithCC",function(){return O}),r.d(e,"shouldAlignOnDiscontinuities",function(){return C}),r.d(e,"findDiscontinuousReferenceFrag",function(){return M}),r.d(e,"adjustSlidingStart",function(){return A}),r.d(e,"alignStream",function(){return _}),r.d(e,"alignPDT",function(){return S}),r.d(e,"alignFragmentByPDTDelta",function(){return T}),r.d(e,"alignMediaPlaylistByPDT",function(){return x});var a=r("./src/polyfills/number.ts"),o=r("./src/utils/logger.ts"),c=r("./src/controller/level-helper.ts");function O(v,i){for(var u=null,p=0,b=v.length;p<b;p++){var l=v[p];if(l&&l.cc===i){u=l;break}}return u}function C(v,i,u){return!!(i.details&&(u.endCC>u.startCC||v&&v.cc<u.startCC))}function M(v,i){var u=v.fragments,p=i.fragments;if(!p.length||!u.length){o.logger.log("No fragments to align");return}var b=O(u,p[0].cc);if(!b||b&&!b.startPTS){o.logger.log("No frag in previous level to align on");return}return b}function D(v,i){if(v){var u=v.start+i;v.start=v.startPTS=u,v.endPTS=u+v.duration}}function A(v,i){for(var u=i.fragments,p=0,b=u.length;p<b;p++)D(u[p],v);i.fragmentHint&&D(i.fragmentHint,v),i.alignedSliding=!0}function _(v,i,u){!i||(I(v,u,i),!u.alignedSliding&&i.details&&S(u,i.details),!u.alignedSliding&&i.details&&!u.skippedSegments&&Object(c.adjustSliding)(i.details,u))}function I(v,i,u){if(C(v,u,i)){var p=M(u.details,i);p&&Object(a.isFiniteNumber)(p.start)&&(o.logger.log("Adjusting PTS using last level due to CC increase within current level "+i.url),A(p.start,i))}}function S(v,i){if(!(!i.fragments.length||!v.hasProgramDateTime||!i.hasProgramDateTime)){var u=i.fragments[0].programDateTime,p=v.fragments[0].programDateTime,b=(p-u)/1e3+i.fragments[0].start;b&&Object(a.isFiniteNumber)(b)&&(o.logger.log("Adjusting PTS using programDateTime delta "+(p-u)+"ms, sliding:"+b.toFixed(3)+" "+v.url+" "),A(b,v))}}function T(v,i){var u=v.programDateTime;if(!!u){var p=(u-i)/1e3;v.start=v.startPTS=p,v.endPTS=p+v.duration}}function x(v,i){if(!(!i.fragments.length||!v.hasProgramDateTime||!i.hasProgramDateTime)){var u=i.fragments[0].programDateTime,p=i.fragments[0].start,b=u-p*1e3;v.fragments.forEach(function(l){T(l,b)}),v.fragmentHint&&T(v.fragmentHint,b),v.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(t,e,r){"use strict";r.r(e);var a=r("./src/utils/ewma.ts"),o=function(){function c(C,M,D){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=D,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new a.default(C),this.fast_=new a.default(M)}var O=c.prototype;return O.update=function(M,D){var A=this.slow_,_=this.fast_;this.slow_.halfLife!==M&&(this.slow_=new a.default(M,A.getEstimate(),A.getTotalWeight())),this.fast_.halfLife!==D&&(this.fast_=new a.default(D,_.getEstimate(),_.getTotalWeight()))},O.sample=function(M,D){M=Math.max(M,this.minDelayMs_);var A=8*D,_=M/1e3,I=A/_;this.fast_.sample(_,I),this.slow_.sample(_,I)},O.canEstimate=function(){var M=this.fast_;return M&&M.getTotalWeight()>=this.minWeight_},O.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},O.destroy=function(){},c}();e.default=o},"./src/utils/ewma.ts":function(t,e,r){"use strict";r.r(e);var a=function(){function o(O,C,M){C===void 0&&(C=0),M===void 0&&(M=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=O,this.alpha_=O?Math.exp(Math.log(.5)/O):0,this.estimate_=C,this.totalWeight_=M}var c=o.prototype;return c.sample=function(C,M){var D=Math.pow(this.alpha_,C);this.estimate_=M*(1-D)+D*this.estimate_,this.totalWeight_+=C},c.getTotalWeight=function(){return this.totalWeight_},c.getEstimate=function(){if(this.alpha_){var C=1-Math.pow(this.alpha_,this.totalWeight_);if(C)return this.estimate_/C}return this.estimate_},o}();e.default=a},"./src/utils/fetch-loader.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"fetchSupported",function(){return T});var a=r("./src/polyfills/number.ts"),o=r("./src/loader/load-stats.ts"),c=r("./src/demux/chunk-cache.ts");function O(p,b){p.prototype=Object.create(b.prototype),p.prototype.constructor=p,_(p,b)}function C(p){var b=typeof Map=="function"?new Map:void 0;return C=function(s){if(s===null||!A(s))return s;if(typeof s!="function")throw new TypeError("Super expression must either be null or a function");if(typeof b!="undefined"){if(b.has(s))return b.get(s);b.set(s,h)}function h(){return M(s,arguments,I(this).constructor)}return h.prototype=Object.create(s.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),_(h,s)},C(p)}function M(p,b,l){return D()?M=Reflect.construct.bind():M=function(h,E,n){var d=[null];d.push.apply(d,E);var m=Function.bind.apply(h,d),f=new m;return n&&_(f,n.prototype),f},M.apply(null,arguments)}function D(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function A(p){return Function.toString.call(p).indexOf("[native code]")!==-1}function _(p,b){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s},_(p,b)}function I(p){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},I(p)}function S(){return S=Object.assign?Object.assign.bind():function(p){for(var b=1;b<arguments.length;b++){var l=arguments[b];for(var s in l)Object.prototype.hasOwnProperty.call(l,s)&&(p[s]=l[s])}return p},S.apply(this,arguments)}function T(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var x=function(){function p(l){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=l.fetchSetup||i,this.controller=new self.AbortController,this.stats=new o.LoadStats}var b=p.prototype;return b.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},b.abortInternal=function(){var s=this.response;(!s||!s.ok)&&(this.stats.aborted=!0,this.controller.abort())},b.abort=function(){var s;this.abortInternal(),(s=this.callbacks)!==null&&s!==void 0&&s.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},b.load=function(s,h,E){var n=this,d=this.stats;if(d.loading.start)throw new Error("Loader can only be used once.");d.loading.start=self.performance.now();var m=v(s,this.controller.signal),f=E.onProgress,g=s.responseType==="arraybuffer",y=g?"byteLength":"length";this.context=s,this.config=h,this.callbacks=E,this.request=this.fetchSetup(s,m),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){n.abortInternal(),E.onTimeout(d,s,n.response)},h.timeout),self.fetch(this.request).then(function(R){if(n.response=n.loader=R,!R.ok){var L=R.status,P=R.statusText;throw new u(P||"fetch, bad network response",L,R)}return d.loading.first=Math.max(self.performance.now(),d.loading.start),d.total=parseInt(R.headers.get("Content-Length")||"0"),f&&Object(a.isFiniteNumber)(h.highWaterMark)?n.loadProgressively(R,d,s,h.highWaterMark,f):g?R.arrayBuffer():R.text()}).then(function(R){var L=n.response;self.clearTimeout(n.requestTimeout),d.loading.end=Math.max(self.performance.now(),d.loading.first),d.loaded=d.total=R[y];var P={url:L.url,data:R};f&&!Object(a.isFiniteNumber)(h.highWaterMark)&&f(d,s,R,L),E.onSuccess(P,d,s,L)}).catch(function(R){if(self.clearTimeout(n.requestTimeout),!d.aborted){var L=R&&R.code||0,P=R?R.message:null;E.onError({code:L,text:P},s,R?R.details:null)}})},b.getCacheAge=function(){var s=null;if(this.response){var h=this.response.headers.get("age");s=h?parseFloat(h):null}return s},b.loadProgressively=function(s,h,E,n,d){n===void 0&&(n=0);var m=new c.default,f=s.body.getReader(),g=function y(){return f.read().then(function(R){if(R.done)return m.dataLength&&d(h,E,m.flush(),s),Promise.resolve(new ArrayBuffer(0));var L=R.value,P=L.length;return h.loaded+=P,P<n||m.dataLength?(m.push(L),m.dataLength>=n&&d(h,E,m.flush(),s)):d(h,E,L,s),y()}).catch(function(){return Promise.reject()})};return g()},p}();function v(p,b){var l={method:"GET",mode:"cors",credentials:"same-origin",signal:b,headers:new self.Headers(S({},p.headers))};return p.rangeEnd&&l.headers.set("Range","bytes="+p.rangeStart+"-"+String(p.rangeEnd-1)),l}function i(p,b){return new self.Request(p.url,b)}var u=function(p){O(b,p);function b(l,s,h){var E;return E=p.call(this,l)||this,E.code=void 0,E.details=void 0,E.code=s,E.details=h,E}return b}(C(Error));e.default=x},"./src/utils/imsc1-ttml-parser.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"IMSC1_CODEC",function(){return A}),r.d(e,"parseIMSC1",function(){return T});var a=r("./src/utils/mp4-tools.ts"),o=r("./src/utils/vttparser.ts"),c=r("./src/utils/vttcue.ts"),O=r("./src/demux/id3.ts"),C=r("./src/utils/timescale-conversion.ts"),M=r("./src/utils/webvtt-parser.ts");function D(){return D=Object.assign?Object.assign.bind():function(n){for(var d=1;d<arguments.length;d++){var m=arguments[d];for(var f in m)Object.prototype.hasOwnProperty.call(m,f)&&(n[f]=m[f])}return n},D.apply(this,arguments)}var A="stpp.ttml.im1t",_=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,I=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,S={left:"start",center:"center",right:"end",start:"start",end:"end"};function T(n,d,m,f,g){var y=Object(a.findBox)(new Uint8Array(n),["mdat"]);if(y.length===0){g(new Error("Could not parse IMSC1 mdat"));return}var R=y.map(function(P){return Object(O.utf8ArrayToStr)(P)}),L=Object(C.toTimescaleFromScale)(d,1,m);try{R.forEach(function(P){return f(x(P,L))})}catch(P){g(P)}}function x(n,d){var m=new DOMParser,f=m.parseFromString(n,"text/xml"),g=f.getElementsByTagName("tt")[0];if(!g)throw new Error("Invalid ttml");var y={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},R=Object.keys(y).reduce(function(F,H){return F[H]=g.getAttribute("ttp:"+H)||y[H],F},{}),L=g.getAttribute("xml:space")!=="preserve",P=i(v(g,"styling","style")),N=i(v(g,"layout","region")),B=v(g,"body","[begin]");return[].map.call(B,function(F){var H=u(F,L);if(!H||!F.hasAttribute("begin"))return null;var j=s(F.getAttribute("begin"),R),X=s(F.getAttribute("dur"),R),$=s(F.getAttribute("end"),R);if(j===null)throw l(F);if($===null){if(X===null)throw l(F);$=j+X}var G=new c.default(j-d,$-d,H);G.id=Object(M.generateCueId)(G.startTime,G.endTime,G.text);var J=N[F.getAttribute("region")],ee=P[F.getAttribute("style")];G.position=10,G.size=80;var te=p(J,ee,P),oe=te.textAlign;if(oe){var ue=S[oe];ue&&(G.lineAlign=ue),G.align=oe}return D(G,te),G}).filter(function(F){return F!==null})}function v(n,d,m){var f=n.getElementsByTagName(d)[0];return f?[].slice.call(f.querySelectorAll(m)):[]}function i(n){return n.reduce(function(d,m){var f=m.getAttribute("xml:id");return f&&(d[f]=m),d},{})}function u(n,d){return[].slice.call(n.childNodes).reduce(function(m,f,g){var y;return f.nodeName==="br"&&g?m+`
`:(y=f.childNodes)!==null&&y!==void 0&&y.length?u(f,d):d?m+f.textContent.trim().replace(/\s+/g," "):m+f.textContent},"")}function p(n,d,m){var f="http://www.w3.org/ns/ttml#styling",g=null,y=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],R=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return R&&m.hasOwnProperty(R)&&(g=m[R]),y.reduce(function(L,P){var N=b(d,f,P)||b(n,f,P)||b(g,f,P);return N&&(L[P]=N),L},{})}function b(n,d,m){return n&&n.hasAttributeNS(d,m)?n.getAttributeNS(d,m):null}function l(n){return new Error("Could not parse ttml timestamp "+n)}function s(n,d){if(!n)return null;var m=Object(o.parseTimeStamp)(n);return m===null&&(_.test(n)?m=h(n,d):I.test(n)&&(m=E(n,d))),m}function h(n,d){var m=_.exec(n),f=(m[4]|0)+(m[5]|0)/d.subFrameRate;return(m[1]|0)*3600+(m[2]|0)*60+(m[3]|0)+f/d.frameRate}function E(n,d){var m=I.exec(n),f=Number(m[1]),g=m[2];switch(g){case"h":return f*3600;case"m":return f*60;case"ms":return f*1e3;case"f":return f/d.frameRate;case"t":return f/d.tickRate}return f}},"./src/utils/logger.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"enableLogs",function(){return M}),r.d(e,"logger",function(){return D});var a=function(){},o={trace:a,debug:a,log:a,warn:a,info:a,error:a},c=o;function O(A){var _=self.console[A];return _?_.bind(self.console,"["+A+"] >"):a}function C(A){for(var _=arguments.length,I=new Array(_>1?_-1:0),S=1;S<_;S++)I[S-1]=arguments[S];I.forEach(function(T){c[T]=A[T]?A[T].bind(A):O(T)})}function M(A){if(self.console&&A===!0||typeof A=="object"){C(A,"debug","log","info","warn","error");try{c.log()}catch{c=o}}else c=o}var D=c},"./src/utils/mediakeys-helper.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"KeySystems",function(){return a}),r.d(e,"requestMediaKeySystemAccess",function(){return o});var a;(function(c){c.WIDEVINE="com.widevine.alpha",c.PLAYREADY="com.microsoft.playready"})(a||(a={}));var o=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"getMediaSource",function(){return a});function a(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"RemuxerTrackIdConfig",function(){return M}),r.d(e,"bin2str",function(){return D}),r.d(e,"readUint16",function(){return A}),r.d(e,"readUint32",function(){return _}),r.d(e,"readSint32",function(){return I}),r.d(e,"writeUint32",function(){return S}),r.d(e,"findBox",function(){return T}),r.d(e,"parseSegmentIndex",function(){return x}),r.d(e,"parseInitSegment",function(){return v}),r.d(e,"getStartDTS",function(){return i}),r.d(e,"getDuration",function(){return u}),r.d(e,"computeRawDurationFromSamples",function(){return p}),r.d(e,"offsetStartDTS",function(){return b}),r.d(e,"segmentValidRange",function(){return l}),r.d(e,"appendUint8Array",function(){return s}),r.d(e,"parseSamples",function(){return h}),r.d(e,"parseSEIMessageFromNALu",function(){return d}),r.d(e,"parseEmsg",function(){return f});var a=r("./src/utils/typed-array.ts"),o=r("./src/loader/fragment.ts"),c=r("./src/demux/id3.ts"),O=Math.pow(2,32)-1,C=[].push,M={video:1,audio:2,id3:3,text:4};function D(g){return String.fromCharCode.apply(null,g)}function A(g,y){var R=g[y]<<8|g[y+1];return R<0?65536+R:R}function _(g,y){var R=I(g,y);return R<0?4294967296+R:R}function I(g,y){return g[y]<<24|g[y+1]<<16|g[y+2]<<8|g[y+3]}function S(g,y,R){g[y]=R>>24,g[y+1]=R>>16&255,g[y+2]=R>>8&255,g[y+3]=R&255}function T(g,y){var R=[];if(!y.length)return R;for(var L=g.byteLength,P=0;P<L;){var N=_(g,P),B=D(g.subarray(P+4,P+8)),F=N>1?P+N:L;if(B===y[0])if(y.length===1)R.push(g.subarray(P+8,F));else{var H=T(g.subarray(P+8,F),y.slice(1));H.length&&C.apply(R,H)}P=F}return R}function x(g){var y=[],R=g[0],L=8,P=_(g,L);L+=4;var N=0,B=0;R===0?L+=8:L+=16,L+=2;var F=g.length+B,H=A(g,L);L+=2;for(var j=0;j<H;j++){var X=L,$=_(g,X);X+=4;var G=$&2147483647,J=($&2147483648)>>>31;if(J===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var ee=_(g,X);X+=4,y.push({referenceSize:G,subsegmentDuration:ee,info:{duration:ee/P,start:F,end:F+G-1}}),F+=G,X+=4,L=X}return{earliestPresentationTime:N,timescale:P,version:R,referencesCount:H,references:y}}function v(g){for(var y=[],R=T(g,["moov","trak"]),L=0;L<R.length;L++){var P=R[L],N=T(P,["tkhd"])[0];if(N){var B=N[0],F=B===0?12:20,H=_(N,F),j=T(P,["mdia","mdhd"])[0];if(j){B=j[0],F=B===0?12:20;var X=_(j,F),$=T(P,["mdia","hdlr"])[0];if($){var G=D($.subarray(8,12)),J={soun:o.ElementaryStreamTypes.AUDIO,vide:o.ElementaryStreamTypes.VIDEO}[G];if(J){var ee=T(P,["mdia","minf","stbl","stsd"])[0],te=void 0;ee&&(te=D(ee.subarray(12,16))),y[H]={timescale:X,type:J},y[J]={timescale:X,id:H,codec:te}}}}}}var oe=T(g,["moov","mvex","trex"]);return oe.forEach(function(ue){var ae=_(ue,4),he=y[ae];he&&(he.default={duration:_(ue,12),flags:_(ue,20)})}),y}function i(g,y){return T(y,["moof","traf"]).reduce(function(R,L){var P=T(L,["tfdt"])[0],N=P[0],B=T(L,["tfhd"]).reduce(function(F,H){var j=_(H,4),X=g[j];if(X){var $=_(P,4);N===1&&($*=Math.pow(2,32),$+=_(P,8));var G=X.timescale||9e4,J=$/G;if(isFinite(J)&&(F===null||J<F))return J}return F},null);return B!==null&&isFinite(B)&&(R===null||B<R)?B:R},null)||0}function u(g,y){for(var R=0,L=0,P=0,N=T(g,["moof","traf"]),B=0;B<N.length;B++){var F=N[B],H=T(F,["tfhd"])[0],j=_(H,4),X=y[j];if(!!X){var $=X.default,G=_(H,0)|($==null?void 0:$.flags),J=$==null?void 0:$.duration;G&8&&(G&2?J=_(H,12):J=_(H,8));for(var ee=X.timescale||9e4,te=T(F,["trun"]),oe=0;oe<te.length;oe++){if(R=p(te[oe]),!R&&J){var ue=_(te[oe],4);R=J*ue}X.type===o.ElementaryStreamTypes.VIDEO?L+=R/ee:X.type===o.ElementaryStreamTypes.AUDIO&&(P+=R/ee)}}}if(L===0&&P===0){for(var ae=0,he=T(g,["sidx"]),me=0;me<he.length;me++){var ne=x(he[me]);ne!=null&&ne.references&&(ae+=ne.references.reduce(function(Me,_e){return Me+_e.info.duration||0},0))}return ae}return L||P}function p(g){var y=_(g,0),R=8;y&1&&(R+=4),y&4&&(R+=4);for(var L=0,P=_(g,4),N=0;N<P;N++){if(y&256){var B=_(g,R);L+=B,R+=4}y&512&&(R+=4),y&1024&&(R+=4),y&2048&&(R+=4)}return L}function b(g,y,R){T(y,["moof","traf"]).forEach(function(L){T(L,["tfhd"]).forEach(function(P){var N=_(P,4),B=g[N];if(!!B){var F=B.timescale||9e4;T(L,["tfdt"]).forEach(function(H){var j=H[0],X=_(H,4);if(j===0)X-=R*F,X=Math.max(X,0),S(H,4,X);else{X*=Math.pow(2,32),X+=_(H,8),X-=R*F,X=Math.max(X,0);var $=Math.floor(X/(O+1)),G=Math.floor(X%(O+1));S(H,4,$),S(H,8,G)}})}})})}function l(g){var y={valid:null,remainder:null},R=T(g,["moof"]);if(R){if(R.length<2)return y.remainder=g,y}else return y;var L=R[R.length-1];return y.valid=Object(a.sliceUint8)(g,0,L.byteOffset-8),y.remainder=Object(a.sliceUint8)(g,L.byteOffset-8),y}function s(g,y){var R=new Uint8Array(g.length+y.length);return R.set(g),R.set(y,g.length),R}function h(g,y){var R=[],L=y.samples,P=y.timescale,N=y.id,B=!1,F=T(L,["moof"]);return F.map(function(H){var j=H.byteOffset-8,X=T(H,["traf"]);X.map(function($){var G=T($,["tfdt"]).map(function(J){var ee=J[0],te=_(J,4);return ee===1&&(te*=Math.pow(2,32),te+=_(J,8)),te/P})[0];return G!==void 0&&(g=G),T($,["tfhd"]).map(function(J){var ee=_(J,4),te=_(J,0)&16777215,oe=(te&1)!==0,ue=(te&2)!==0,ae=(te&8)!==0,he=0,me=(te&16)!==0,ne=0,Me=(te&32)!==0,_e=8;ee===N&&(oe&&(_e+=8),ue&&(_e+=4),ae&&(he=_(J,_e),_e+=4),me&&(ne=_(J,_e),_e+=4),Me&&(_e+=4),y.type==="video"&&(B=E(y.codec)),T($,["trun"]).map(function(Se){var be=Se[0],Ue=_(Se,0)&16777215,Ze=(Ue&1)!==0,We=0,tt=(Ue&4)!==0,Fe=(Ue&256)!==0,ot=0,ft=(Ue&512)!==0,ht=0,lt=(Ue&1024)!==0,It=(Ue&2048)!==0,rt=0,Rt=_(Se,4),Ye=8;Ze&&(We=_(Se,Ye),Ye+=4),tt&&(Ye+=4);for(var Je=We+j,Et=0;Et<Rt;Et++){if(Fe?(ot=_(Se,Ye),Ye+=4):ot=he,ft?(ht=_(Se,Ye),Ye+=4):ht=ne,lt&&(Ye+=4),It&&(be===0?rt=_(Se,Ye):rt=I(Se,Ye),Ye+=4),y.type===o.ElementaryStreamTypes.VIDEO)for(var qe=0;qe<ht;){var He=_(L,Je);Je+=4;var Pt=L[Je]&31;if(n(B,Pt)){var vt=L.subarray(Je,Je+He);d(vt,g+rt/P,R)}Je+=He,qe+=He+4}g+=ot/P}}))})})}),R}function E(g){if(!g)return!1;var y=g.indexOf("."),R=y<0?g:g.substring(0,y);return R==="hvc1"||R==="hev1"||R==="dvh1"||R==="dvhe"}function n(g,y){return g?y===39||y===40:y===6}function d(g,y,R){var L=m(g),P=0;P++;for(var N=0,B=0,F=!1,H=0;P<L.length;){N=0;do{if(P>=L.length)break;H=L[P++],N+=H}while(H===255);B=0;do{if(P>=L.length)break;H=L[P++],B+=H}while(H===255);var j=L.length-P;if(!F&&N===4&&P<L.length){F=!0;var X=L[P++];if(X===181){var $=A(L,P);if(P+=2,$===49){var G=_(L,P);if(P+=4,G===1195456820){var J=L[P++];if(J===3){var ee=L[P++],te=31&ee,oe=64&ee,ue=oe?2+te*3:0,ae=new Uint8Array(ue);if(oe){ae[0]=ee;for(var he=1;he<ue;he++)ae[he]=L[P++]}R.push({type:J,payloadType:N,pts:y,bytes:ae})}}}}}else if(N===5&&B<j){if(F=!0,B>16){for(var me=[],ne=0;ne<16;ne++){var Me=L[P++].toString(16);me.push(Me.length==1?"0"+Me:Me),(ne===3||ne===5||ne===7||ne===9)&&me.push("-")}for(var _e=B-16,Se=new Uint8Array(_e),be=0;be<_e;be++)Se[be]=L[P++];R.push({payloadType:N,pts:y,uuid:me.join(""),userData:Object(c.utf8ArrayToStr)(Se),userDataBytes:Se})}}else if(B<j)P+=B;else if(B>j)break}}function m(g){for(var y=g.byteLength,R=[],L=1;L<y-2;)g[L]===0&&g[L+1]===0&&g[L+2]===3?(R.push(L+2),L+=2):L++;if(R.length===0)return g;var P=y-R.length,N=new Uint8Array(P),B=0;for(L=0;L<P;B++,L++)B===R[0]&&(B++,R.shift()),N[L]=g[B];return N}function f(g){var y=g[0],R="",L="",P=0,N=0,B=0,F=0,H=0,j=0;if(y===0){for(;D(g.subarray(j,j+1))!=="\0";)R+=D(g.subarray(j,j+1)),j+=1;for(R+=D(g.subarray(j,j+1)),j+=1;D(g.subarray(j,j+1))!=="\0";)L+=D(g.subarray(j,j+1)),j+=1;L+=D(g.subarray(j,j+1)),j+=1,P=_(g,12),N=_(g,16),F=_(g,20),H=_(g,24),j=28}else if(y===1){j+=4,P=_(g,j),j+=4;var X=_(g,j);j+=4;var $=_(g,j);for(j+=4,B=Math.pow(2,32)*X+$,Number.isSafeInteger(B)||(B=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),F=_(g,j),j+=4,H=_(g,j),j+=4;D(g.subarray(j,j+1))!=="\0";)R+=D(g.subarray(j,j+1)),j+=1;for(R+=D(g.subarray(j,j+1)),j+=1;D(g.subarray(j,j+1))!=="\0";)L+=D(g.subarray(j,j+1)),j+=1;L+=D(g.subarray(j,j+1)),j+=1}var G=g.subarray(j,g.byteLength);return{schemeIdUri:R,value:L,timeScale:P,presentationTime:B,presentationTimeDelta:N,eventDuration:F,id:H,payload:G}}},"./src/utils/output-filter.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return a});var a=function(){function o(O,C){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=O,this.trackName=C}var c=o.prototype;return c.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},c.newCue=function(C,M,D){(this.startTime===null||this.startTime>C)&&(this.startTime=C),this.endTime=M,this.screen=D,this.timelineController.createCaptionsTrack(this.trackName)},c.reset=function(){this.cueRanges=[],this.startTime=null},o}()},"./src/utils/texttrack-utils.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"sendAddTrackEvent",function(){return o}),r.d(e,"addCueToTrack",function(){return c}),r.d(e,"clearCurrentCues",function(){return O}),r.d(e,"removeCuesInRange",function(){return C}),r.d(e,"getCuesInRange",function(){return D});var a=r("./src/utils/logger.ts");function o(A,_){var I;try{I=new Event("addtrack")}catch{I=document.createEvent("Event"),I.initEvent("addtrack",!1,!1)}I.track=A,_.dispatchEvent(I)}function c(A,_){var I=A.mode;if(I==="disabled"&&(A.mode="hidden"),A.cues&&!A.cues.getCueById(_.id))try{if(A.addCue(_),!A.cues.getCueById(_.id))throw new Error("addCue is failed for: "+_)}catch(T){a.logger.debug("[texttrack-utils]: "+T);var S=new self.TextTrackCue(_.startTime,_.endTime,_.text);S.id=_.id,A.addCue(S)}I==="disabled"&&(A.mode=I)}function O(A){var _=A.mode;if(_==="disabled"&&(A.mode="hidden"),A.cues)for(var I=A.cues.length;I--;)A.removeCue(A.cues[I]);_==="disabled"&&(A.mode=_)}function C(A,_,I,S){var T=A.mode;if(T==="disabled"&&(A.mode="hidden"),A.cues&&A.cues.length>0)for(var x=D(A.cues,_,I),v=0;v<x.length;v++)(!S||S(x[v]))&&A.removeCue(x[v]);T==="disabled"&&(A.mode=T)}function M(A,_){if(_<A[0].startTime)return 0;var I=A.length-1;if(_>A[I].endTime)return-1;for(var S=0,T=I;S<=T;){var x=Math.floor((T+S)/2);if(_<A[x].startTime)T=x-1;else if(_>A[x].startTime&&S<I)S=x+1;else return x}return A[S].startTime-_<_-A[T].startTime?S:T}function D(A,_,I){var S=[],T=M(A,_);if(T>-1)for(var x=T,v=A.length;x<v;x++){var i=A[x];if(i.startTime>=_&&i.endTime<=I)S.push(i);else if(i.startTime>I)return S}return S}},"./src/utils/time-ranges.ts":function(t,e,r){"use strict";r.r(e);var a={toString:function(c){for(var O="",C=c.length,M=0;M<C;M++)O+="["+c.start(M).toFixed(3)+","+c.end(M).toFixed(3)+"]";return O}};e.default=a},"./src/utils/timescale-conversion.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"toTimescaleFromBase",function(){return o}),r.d(e,"toTimescaleFromScale",function(){return c}),r.d(e,"toMsFromMpegTsClock",function(){return O}),r.d(e,"toMpegTsClockFromTimescale",function(){return C});var a=9e4;function o(M,D,A,_){A===void 0&&(A=1),_===void 0&&(_=!1);var I=M*D*A;return _?Math.round(I):I}function c(M,D,A,_){return A===void 0&&(A=1),_===void 0&&(_=!1),o(M,D,1/A,_)}function O(M,D){return D===void 0&&(D=!1),o(M,1e3,1/a,D)}function C(M,D){return D===void 0&&(D=1),o(M,a,1/D)}},"./src/utils/typed-array.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"sliceUint8",function(){return a});function a(o,c,O){return Uint8Array.prototype.slice?o.slice(c,O):new Uint8Array(Array.prototype.slice.call(o,c,O))}},"./src/utils/vttcue.ts":function(t,e,r){"use strict";r.r(e),e.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var a=["","lr","rl"],o=["start","middle","end","left","right"];function c(A,_){if(typeof _!="string"||!Array.isArray(A))return!1;var I=_.toLowerCase();return~A.indexOf(I)?I:!1}function O(A){return c(a,A)}function C(A){return c(o,A)}function M(A){for(var _=arguments.length,I=new Array(_>1?_-1:0),S=1;S<_;S++)I[S-1]=arguments[S];for(var T=1;T<arguments.length;T++){var x=arguments[T];for(var v in x)A[v]=x[v]}return A}function D(A,_,I){var S=this,T={enumerable:!0};S.hasBeenReset=!1;var x="",v=!1,i=A,u=_,p=I,b=null,l="",s=!0,h="auto",E="start",n=50,d="middle",m=50,f="middle";Object.defineProperty(S,"id",M({},T,{get:function(){return x},set:function(y){x=""+y}})),Object.defineProperty(S,"pauseOnExit",M({},T,{get:function(){return v},set:function(y){v=!!y}})),Object.defineProperty(S,"startTime",M({},T,{get:function(){return i},set:function(y){if(typeof y!="number")throw new TypeError("Start time must be set to a number.");i=y,this.hasBeenReset=!0}})),Object.defineProperty(S,"endTime",M({},T,{get:function(){return u},set:function(y){if(typeof y!="number")throw new TypeError("End time must be set to a number.");u=y,this.hasBeenReset=!0}})),Object.defineProperty(S,"text",M({},T,{get:function(){return p},set:function(y){p=""+y,this.hasBeenReset=!0}})),Object.defineProperty(S,"region",M({},T,{get:function(){return b},set:function(y){b=y,this.hasBeenReset=!0}})),Object.defineProperty(S,"vertical",M({},T,{get:function(){return l},set:function(y){var R=O(y);if(R===!1)throw new SyntaxError("An invalid or illegal string was specified.");l=R,this.hasBeenReset=!0}})),Object.defineProperty(S,"snapToLines",M({},T,{get:function(){return s},set:function(y){s=!!y,this.hasBeenReset=!0}})),Object.defineProperty(S,"line",M({},T,{get:function(){return h},set:function(y){if(typeof y!="number"&&y!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");h=y,this.hasBeenReset=!0}})),Object.defineProperty(S,"lineAlign",M({},T,{get:function(){return E},set:function(y){var R=C(y);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");E=R,this.hasBeenReset=!0}})),Object.defineProperty(S,"position",M({},T,{get:function(){return n},set:function(y){if(y<0||y>100)throw new Error("Position must be between 0 and 100.");n=y,this.hasBeenReset=!0}})),Object.defineProperty(S,"positionAlign",M({},T,{get:function(){return d},set:function(y){var R=C(y);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");d=R,this.hasBeenReset=!0}})),Object.defineProperty(S,"size",M({},T,{get:function(){return m},set:function(y){if(y<0||y>100)throw new Error("Size must be between 0 and 100.");m=y,this.hasBeenReset=!0}})),Object.defineProperty(S,"align",M({},T,{get:function(){return f},set:function(y){var R=C(y);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");f=R,this.hasBeenReset=!0}})),S.displayState=void 0}return D.prototype.getCueAsHTML=function(){var A=self.WebVTT;return A.convertCueToDOMTree(self,this.text)},D}()},"./src/utils/vttparser.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"parseTimeStamp",function(){return c}),r.d(e,"fixLineBreaks",function(){return _}),r.d(e,"VTTParser",function(){return I});var a=r("./src/utils/vttcue.ts"),o=function(){function S(){}var T=S.prototype;return T.decode=function(v,i){if(!v)return"";if(typeof v!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(v))},S}();function c(S){function T(v,i,u,p){return(v|0)*3600+(i|0)*60+(u|0)+parseFloat(p||0)}var x=S.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return x?parseFloat(x[2])>59?T(x[2],x[3],0,x[4]):T(x[1],x[2],x[3],x[4]):null}var O=function(){function S(){this.values=Object.create(null)}var T=S.prototype;return T.set=function(v,i){!this.get(v)&&i!==""&&(this.values[v]=i)},T.get=function(v,i,u){return u?this.has(v)?this.values[v]:i[u]:this.has(v)?this.values[v]:i},T.has=function(v){return v in this.values},T.alt=function(v,i,u){for(var p=0;p<u.length;++p)if(i===u[p]){this.set(v,i);break}},T.integer=function(v,i){/^-?\d+$/.test(i)&&this.set(v,parseInt(i,10))},T.percent=function(v,i){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(i)){var u=parseFloat(i);if(u>=0&&u<=100)return this.set(v,u),!0}return!1},S}();function C(S,T,x,v){var i=v?S.split(v):[S];for(var u in i)if(typeof i[u]=="string"){var p=i[u].split(x);if(p.length===2){var b=p[0],l=p[1];T(b,l)}}}var M=new a.default(0,0,""),D=M.align==="middle"?"middle":"center";function A(S,T,x){var v=S;function i(){var b=c(S);if(b===null)throw new Error("Malformed timestamp: "+v);return S=S.replace(/^[^\sa-zA-Z-]+/,""),b}function u(b,l){var s=new O;C(b,function(n,d){var m;switch(n){case"region":for(var f=x.length-1;f>=0;f--)if(x[f].id===d){s.set(n,x[f].region);break}break;case"vertical":s.alt(n,d,["rl","lr"]);break;case"line":m=d.split(","),s.integer(n,m[0]),s.percent(n,m[0])&&s.set("snapToLines",!1),s.alt(n,m[0],["auto"]),m.length===2&&s.alt("lineAlign",m[1],["start",D,"end"]);break;case"position":m=d.split(","),s.percent(n,m[0]),m.length===2&&s.alt("positionAlign",m[1],["start",D,"end","line-left","line-right","auto"]);break;case"size":s.percent(n,d);break;case"align":s.alt(n,d,["start",D,"end","left","right"]);break}},/:/,/\s/),l.region=s.get("region",null),l.vertical=s.get("vertical","");var h=s.get("line","auto");h==="auto"&&M.line===-1&&(h=-1),l.line=h,l.lineAlign=s.get("lineAlign","start"),l.snapToLines=s.get("snapToLines",!0),l.size=s.get("size",100),l.align=s.get("align",D);var E=s.get("position","auto");E==="auto"&&M.position===50&&(E=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=E}function p(){S=S.replace(/^\s+/,"")}if(p(),T.startTime=i(),p(),S.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+v);S=S.slice(3),p(),T.endTime=i(),p(),u(S,T)}function _(S){return S.replace(/<br(?: \/)?>/gi,`
`)}var I=function(){function S(){this.state="INITIAL",this.buffer="",this.decoder=new o,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var T=S.prototype;return T.parse=function(v){var i=this;v&&(i.buffer+=i.decoder.decode(v,{stream:!0}));function u(){var E=i.buffer,n=0;for(E=_(E);n<E.length&&E[n]!=="\r"&&E[n]!==`
`;)++n;var d=E.slice(0,n);return E[n]==="\r"&&++n,E[n]===`
`&&++n,i.buffer=E.slice(n),d}function p(E){C(E,function(n,d){},/:/)}try{var b="";if(i.state==="INITIAL"){if(!/\r\n|\n/.test(i.buffer))return this;b=u();var l=b.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!l||!l[0])throw new Error("Malformed WebVTT signature.");i.state="HEADER"}for(var s=!1;i.buffer;){if(!/\r\n|\n/.test(i.buffer))return this;switch(s?s=!1:b=u(),i.state){case"HEADER":/:/.test(b)?p(b):b||(i.state="ID");continue;case"NOTE":b||(i.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(b)){i.state="NOTE";break}if(!b)continue;if(i.cue=new a.default(0,0,""),i.state="CUE",b.indexOf("-->")===-1){i.cue.id=b;continue}case"CUE":if(!i.cue){i.state="BADCUE";continue}try{A(b,i.cue,i.regionList)}catch{i.cue=null,i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":{var h=b.indexOf("-->")!==-1;if(!b||h&&(s=!0)){i.oncue&&i.cue&&i.oncue(i.cue),i.cue=null,i.state="ID";continue}if(i.cue===null)continue;i.cue.text&&(i.cue.text+=`
`),i.cue.text+=b}continue;case"BADCUE":b||(i.state="ID")}}}catch{i.state==="CUETEXT"&&i.cue&&i.oncue&&i.oncue(i.cue),i.cue=null,i.state=i.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},T.flush=function(){var v=this;try{if((v.cue||v.state==="HEADER")&&(v.buffer+=`

`,v.parse()),v.state==="INITIAL"||v.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(i){v.onparsingerror&&v.onparsingerror(i)}return v.onflush&&v.onflush(),this},S}()},"./src/utils/webvtt-parser.ts":function(t,e,r){"use strict";r.r(e),r.d(e,"generateCueId",function(){return I}),r.d(e,"parseWebVTT",function(){return T});var a=r("./src/polyfills/number.ts"),o=r("./src/utils/vttparser.ts"),c=r("./src/demux/id3.ts"),O=r("./src/utils/timescale-conversion.ts"),C=r("./src/remux/mp4-remuxer.ts"),M=/\r\n|\n\r|\n|\r/g,D=function(v,i,u){return u===void 0&&(u=0),v.slice(u,u+i.length)===i},A=function(v){var i=parseInt(v.slice(-3)),u=parseInt(v.slice(-6,-4)),p=parseInt(v.slice(-9,-7)),b=v.length>9?parseInt(v.substring(0,v.indexOf(":"))):0;if(!Object(a.isFiniteNumber)(i)||!Object(a.isFiniteNumber)(u)||!Object(a.isFiniteNumber)(p)||!Object(a.isFiniteNumber)(b))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+v);return i+=1e3*u,i+=60*1e3*p,i+=60*60*1e3*b,i},_=function(v){for(var i=5381,u=v.length;u;)i=i*33^v.charCodeAt(--u);return(i>>>0).toString()};function I(x,v,i){return _(x.toString())+_(v.toString())+_(i)}var S=function(v,i,u){var p=v[i],b=v[p.prevCC];if(!b||!b.new&&p.new){v.ccOffset=v.presentationOffset=p.start,p.new=!1;return}for(;(l=b)!==null&&l!==void 0&&l.new;){var l;v.ccOffset+=p.start-b.start,p.new=!1,p=b,b=v[p.prevCC]}v.presentationOffset=u};function T(x,v,i,u,p,b,l,s){var h=new o.VTTParser,E=Object(c.utf8ArrayToStr)(new Uint8Array(x)).trim().replace(M,`
`).split(`
`),n=[],d=Object(O.toMpegTsClockFromTimescale)(v,i),m="00:00.000",f=0,g=0,y,R=!0;h.oncue=function(L){var P=u[p],N=u.ccOffset,B=(f-d)/9e4;P!=null&&P.new&&(g!==void 0?N=u.ccOffset=P.start:S(u,p,B)),B&&(N=B-u.presentationOffset);var F=L.endTime-L.startTime,H=Object(C.normalizePts)((L.startTime+N-g)*9e4,b*9e4)/9e4;L.startTime=Math.max(H,0),L.endTime=Math.max(H+F,0);var j=L.text.trim();L.text=decodeURIComponent(encodeURIComponent(j)),L.id||(L.id=I(L.startTime,L.endTime,j)),L.endTime>0&&n.push(L)},h.onparsingerror=function(L){y=L},h.onflush=function(){if(y){s(y);return}l(n)},E.forEach(function(L){if(R)if(D(L,"X-TIMESTAMP-MAP=")){R=!1,L.slice(16).split(",").forEach(function(P){D(P,"LOCAL:")?m=P.slice(6):D(P,"MPEGTS:")&&(f=parseInt(P.slice(7)))});try{g=A(m)/1e3}catch(P){y=P}return}else L===""&&(R=!1);h.parse(L+`
`)}),h.flush()}},"./src/utils/xhr-loader.ts":function(t,e,r){"use strict";r.r(e);var a=r("./src/utils/logger.ts"),o=r("./src/loader/load-stats.ts"),c=/^age:\s*[\d.]+\s*$/m,O=function(){function C(D){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=D?D.xhrSetup:null,this.stats=new o.LoadStats,this.retryDelay=0}var M=C.prototype;return M.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},M.abortInternal=function(){var A=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),A&&(A.onreadystatechange=null,A.onprogress=null,A.readyState!==4&&(this.stats.aborted=!0,A.abort()))},M.abort=function(){var A;this.abortInternal(),(A=this.callbacks)!==null&&A!==void 0&&A.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},M.load=function(A,_,I){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=A,this.config=_,this.callbacks=I,this.retryDelay=_.retryDelay,this.loadInternal()},M.loadInternal=function(){var A=this.config,_=this.context;if(!!A){var I=this.loader=new self.XMLHttpRequest,S=this.stats;S.loading.first=0,S.loaded=0;var T=this.xhrSetup;try{if(T)try{T(I,_.url)}catch{I.open("GET",_.url,!0),T(I,_.url)}I.readyState||I.open("GET",_.url,!0);var x=this.context.headers;if(x)for(var v in x)I.setRequestHeader(v,x[v])}catch(i){this.callbacks.onError({code:I.status,text:i.message},_,I);return}_.rangeEnd&&I.setRequestHeader("Range","bytes="+_.rangeStart+"-"+(_.rangeEnd-1)),I.onreadystatechange=this.readystatechange.bind(this),I.onprogress=this.loadprogress.bind(this),I.responseType=_.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),A.timeout),I.send()}},M.readystatechange=function(){var A=this.context,_=this.loader,I=this.stats;if(!(!A||!_)){var S=_.readyState,T=this.config;if(!I.aborted&&S>=2)if(self.clearTimeout(this.requestTimeout),I.loading.first===0&&(I.loading.first=Math.max(self.performance.now(),I.loading.start)),S===4){_.onreadystatechange=null,_.onprogress=null;var x=_.status;if(x>=200&&x<300){I.loading.end=Math.max(self.performance.now(),I.loading.first);var v,i;if(A.responseType==="arraybuffer"?(v=_.response,i=v.byteLength):(v=_.responseText,i=v.length),I.loaded=I.total=i,!this.callbacks)return;var u=this.callbacks.onProgress;if(u&&u(I,A,v,_),!this.callbacks)return;var p={url:_.responseURL,data:v};this.callbacks.onSuccess(p,I,A,_)}else I.retry>=T.maxRetry||x>=400&&x<499?(a.logger.error(x+" while loading "+A.url),this.callbacks.onError({code:x,text:_.statusText},A,_)):(a.logger.warn(x+" while loading "+A.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,T.maxRetryDelay),I.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),T.timeout)}},M.loadtimeout=function(){a.logger.warn("timeout while loading "+this.context.url);var A=this.callbacks;A&&(this.abortInternal(),A.onTimeout(this.stats,this.context,this.loader))},M.loadprogress=function(A){var _=this.stats;_.loaded=A.loaded,A.lengthComputable&&(_.total=A.total)},M.getCacheAge=function(){var A=null;if(this.loader&&c.test(this.loader.getAllResponseHeaders())){var _=this.loader.getResponseHeader("age");A=_?parseFloat(_):null}return A},C}();e.default=O}}).default})});var Ys={};md(Ys,{MediaError:()=>Ge,default:()=>gh,getVideoAttribute:()=>hr});var fe={MEDIA_PLAY_REQUEST:"mediaplayrequest",MEDIA_PAUSE_REQUEST:"mediapauserequest",MEDIA_MUTE_REQUEST:"mediamuterequest",MEDIA_UNMUTE_REQUEST:"mediaunmuterequest",MEDIA_VOLUME_REQUEST:"mediavolumerequest",MEDIA_SEEK_REQUEST:"mediaseekrequest",MEDIA_AIRPLAY_REQUEST:"mediaairplayrequest",MEDIA_ENTER_FULLSCREEN_REQUEST:"mediaenterfullscreenrequest",MEDIA_EXIT_FULLSCREEN_REQUEST:"mediaexitfullscreenrequest",MEDIA_PREVIEW_REQUEST:"mediapreviewrequest",MEDIA_ENTER_PIP_REQUEST:"mediaenterpiprequest",MEDIA_EXIT_PIP_REQUEST:"mediaexitpiprequest",MEDIA_ENTER_CAST_REQUEST:"mediaentercastrequest",MEDIA_EXIT_CAST_REQUEST:"mediaexitcastrequest",MEDIA_SHOW_TEXT_TRACKS_REQUEST:"mediashowtexttracksrequest",MEDIA_HIDE_TEXT_TRACKS_REQUEST:"mediahidetexttracksrequest",MEDIA_SHOW_CAPTIONS_REQUEST:"mediashowcaptionsrequest",MEDIA_SHOW_SUBTITLES_REQUEST:"mediashowsubtitlesrequest",MEDIA_DISABLE_CAPTIONS_REQUEST:"mediadisablecaptionsrequest",MEDIA_DISABLE_SUBTITLES_REQUEST:"mediadisablesubtitlesrequest",MEDIA_PLAYBACK_RATE_REQUEST:"mediaplaybackraterequest",REGISTER_MEDIA_STATE_RECEIVER:"registermediastatereceiver",UNREGISTER_MEDIA_STATE_RECEIVER:"unregistermediastatereceiver"},ui={MEDIA_AIRPLAY_UNAVAILABLE:"mediaairplayunavailablechange",MEDIA_PIP_UNAVAILABLE:"mediapipunavailablechange",MEDIA_PAUSED:"mediapausedchange",MEDIA_HAS_PLAYED:"mediahasplayedchange",MEDIA_MUTED:"mediamutedchange",MEDIA_VOLUME_LEVEL:"mediavolumelevelchange",MEDIA_VOLUME:"mediavolumechange",MEDIA_VOLUME_UNAVAILABLE:"mediavolumeunavailablechange",MEDIA_IS_PIP:"mediaispipchange",MEDIA_IS_CASTING:"mediaiscastingchange",MEDIA_CAPTIONS_LIST:"mediacaptionslistchange",MEDIA_SUBTITLES_LIST:"mediasubtitleslistchange",MEDIA_CAPTIONS_SHOWING:"mediacaptionsshowingchange",MEDIA_SUBTITLES_SHOWING:"mediasubtitlesshowingchange",MEDIA_IS_FULLSCREEN:"mediaisfullscreenchange",MEDIA_PLAYBACK_RATE:"mediaplaybackratechange",MEDIA_CURRENT_TIME:"mediacurrenttimechange",MEDIA_DURATION:"mediadurationchange",MEDIA_SEEKABLE:"mediaseekablechange",MEDIA_PREVIEW_IMAGE:"mediapreviewimagechange",MEDIA_PREVIEW_COORDS:"mediapreviewcoordschange",MEDIA_LOADING:"medialoadingchange",USER_INACTIVE:"userinactivechange"},xe={MEDIA_CHROME_ATTRIBUTES:"media-chrome-attributes",MEDIA_CONTROLLER:"media-controller"},V={MEDIA_AIRPLAY_UNAVAILABLE:"media-airplay-unavailable",MEDIA_FULLSCREEN_UNAVAILABLE:"media-fullscreen-unavailable",MEDIA_PIP_UNAVAILABLE:"media-pip-unavailable",MEDIA_CAST_UNAVAILABLE:"media-cast-unavailable",MEDIA_PAUSED:"media-paused",MEDIA_HAS_PLAYED:"media-has-played",MEDIA_MUTED:"media-muted",MEDIA_VOLUME_LEVEL:"media-volume-level",MEDIA_VOLUME:"media-volume",MEDIA_VOLUME_UNAVAILABLE:"media-volume-unavailable",MEDIA_IS_PIP:"media-is-pip",MEDIA_IS_CASTING:"media-is-casting",MEDIA_CAPTIONS_LIST:"media-captions-list",MEDIA_SUBTITLES_LIST:"media-subtitles-list",MEDIA_CAPTIONS_SHOWING:"media-captions-showing",MEDIA_SUBTITLES_SHOWING:"media-subtitles-showing",MEDIA_IS_FULLSCREEN:"media-is-fullscreen",MEDIA_PLAYBACK_RATE:"media-playback-rate",MEDIA_CURRENT_TIME:"media-current-time",MEDIA_DURATION:"media-duration",MEDIA_SEEKABLE:"media-seekable",MEDIA_PREVIEW_TIME:"media-preview-time",MEDIA_PREVIEW_IMAGE:"media-preview-image",MEDIA_PREVIEW_COORDS:"media-preview-coords",MEDIA_LOADING:"media-loading",MEDIA_BUFFERED:"media-buffered",MEDIA_STREAM_TYPE:"media-stream-type"},Eh=Object.entries(ui).reduce((t,[e,r])=>{let a=V[e];return a&&(t[r]=a),t},{userinactivechange:"user-inactive"}),io=Object.entries(V).reduce((t,[e,r])=>{let a=ui[e];return a&&(t[r]=a),t},{"user-inactive":"userinactivechange"}),wr={SUBTITLES:"subtitles",CAPTIONS:"captions",DESCRIPTIONS:"descriptions",CHAPTERS:"chapters",METADATA:"metadata"},Tr={DISABLED:"disabled",HIDDEN:"hidden",SHOWING:"showing"};var vn={MOUSE:"mouse",PEN:"pen",TOUCH:"touch"},Nt={UNAVAILABLE:"unavailable",UNSUPPORTED:"unsupported"},zi={LIVE:"live",ON_DEMAND:"on-demand"};var ut={AUDIO_PLAYER:()=>"audio player",VIDEO_PLAYER:()=>"video player",VOLUME:()=>"volume",SEEK:()=>"seek",CLOSED_CAPTIONS:()=>"closed captions",PLAYBACK_RATE:({playbackRate:t=1}={})=>`current playback rate ${t}`,PLAYBACK_TIME:()=>"playback time",MEDIA_LOADING:()=>"media loading"},Xe={PLAY:()=>"play",PAUSE:()=>"pause",MUTE:()=>"mute",UNMUTE:()=>"unmute",AIRPLAY:()=>"air play",ENTER_CAST:()=>"start casting",EXIT_CAST:()=>"stop casting",ENTER_FULLSCREEN:()=>"enter fullscreen mode",EXIT_FULLSCREEN:()=>"exit fullscreen mode",ENTER_PIP:()=>"enter picture in picture mode",EXIT_PIP:()=>"exit picture in picture mode",SEEK_FORWARD_N_SECS:({seekOffset:t=30}={})=>`seek forward ${t} seconds`,SEEK_BACK_N_SECS:({seekOffset:t=30}={})=>`seek back ${t} seconds`},Ed={...ut,...Xe};function Xi(t,e=!1){return t.split("_").map(function(r,a){return(a||e?r[0].toUpperCase():r[0].toLowerCase())+r.slice(1).toLowerCase()}).join("")}function mn(t){return t.replace(/[-_]([a-z])/g,(e,r)=>r.toUpperCase())}function ao(t){return typeof t=="number"&&!Number.isNaN(t)&&Number.isFinite(t)}function no(t){return typeof t!="string"?!1:!isNaN(t)&&!isNaN(parseFloat(t))}var so=[{singular:"hour",plural:"hours"},{singular:"minute",plural:"minutes"},{singular:"second",plural:"seconds"}],yd=(t,e)=>{let r=t===1?so[e].singular:so[e].plural;return`${t} ${r}`},br=t=>{if(!ao(t))return"";let e=Math.abs(t),r=e!==t,a=new Date(0,0,0,0,0,e,0);return`${[a.getHours(),a.getMinutes(),a.getSeconds()].map((C,M)=>C&&yd(C,M)).filter(C=>C).join(", ")}${r?" remaining":""}`};function Yt(t,e){let r=!1;t<0&&(r=!0,t=0-t),t=t<0?0:t;let a=Math.floor(t%60),o=Math.floor(t/60%60),c=Math.floor(t/3600),O=Math.floor(e/60%60),C=Math.floor(e/3600);return(isNaN(t)||t===1/0)&&(c=o=a="-"),c=c>0||C>0?c+":":"",o=((c||O>=10)&&o<10?"0"+o:o)+":",a=a<10?"0"+a:a,(r?"-":"")+c+o+a}var Qi=class{addEventListener(){}removeEventListener(){}dispatchEvent(){return!0}},oo={HTMLElement:class extends Qi{},DocumentFragment:class extends Qi{},customElements:{get:function(){},define:function(){},whenDefined:function(){}},CustomEvent:function(){}},bd={createElement:function(){return new oo.HTMLElement}},lo=typeof window=="undefined"||typeof window.customElements=="undefined",ie=lo?oo:window,re=lo?bd:window.document;function ce(t,e){ie.customElements.get(t)||(ie.customElements.define(t,e),ie[e.name]=e)}var Ad=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},Ar=(t,e,r)=>(Ad(t,e,"read from private field"),r?r.call(t):e.get(t)),gn=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},Zi,Ur,pn,uo=re.createElement("template");uo.innerHTML=`
<style>
  :host {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    vertical-align: middle;
    box-sizing: border-box;
    background: var(--media-control-background, rgba(20,20,30, 0.7));

    padding: var(--media-control-padding, 10px);

    
    font-size: 14px;
    line-height: var(--media-text-content-height, var(--media-control-height, 24px));
    font-weight: bold;
    color: #fff;

    transition: background 0.15s linear;

    pointer-events: auto;
    cursor: pointer;
    font-family: Arial, sans-serif;
  }

  
  :host(:focus-visible) {
    box-shadow: inset 0 0 0 2px rgba(27, 127, 204, 0.9);
    outline: 0;
  }
  
  :host(:where(:focus)) {
    box-shadow: none;
    outline: 0;
  }

  :host(:hover) {
    background: var(--media-control-hover-background, rgba(50,50,70, 0.7));
  }

  svg, img, ::slotted(svg), ::slotted(img) {
    width: var(--media-button-icon-width);
    height: var(--media-button-icon-height, var(--media-control-height, 24px));
    transform: var(--media-button-icon-transform);
    transition: var(--media-button-icon-transition);
    fill: var(--media-icon-color, #eee);
    vertical-align: middle;
    max-width: 100%;
    max-height: 100%;
    min-width: 100%;
  }
</style>
`;var Ji=class extends ie.HTMLElement{constructor(e={}){super(),gn(this,Zi,c=>{this.handleClick(c)}),gn(this,Ur,c=>{let{key:O}=c;if(!this.keysUsed.includes(O)){this.removeEventListener("keyup",Ar(this,Ur));return}this.handleClick(c)}),gn(this,pn,c=>{let{metaKey:O,altKey:C,key:M}=c;if(O||C||!this.keysUsed.includes(M)){this.removeEventListener("keyup",Ar(this,Ur));return}this.addEventListener("keyup",Ar(this,Ur),{once:!0})});let r=this.attachShadow({mode:"open"}),a=uo.content.cloneNode(!0);this.nativeEl=a;let o=e.slotTemplate;o||(o=re.createElement("template"),o.innerHTML=`<slot>${e.defaultContent||""}</slot>`),this.nativeEl.appendChild(o.content.cloneNode(!0)),r.appendChild(a)}static get observedAttributes(){return["disabled",xe.MEDIA_CONTROLLER]}enable(){this.addEventListener("click",Ar(this,Zi)),this.addEventListener("keydown",Ar(this,pn)),this.setAttribute("tabindex","0")}disable(){this.removeEventListener("click",Ar(this,Zi)),this.removeEventListener("keyup",Ar(this,Ur)),this.removeAttribute("tabindex")}attributeChangedCallback(e,r,a){var o,c;if(e===xe.MEDIA_CONTROLLER){if(r){let O=re.getElementById(r);(o=O==null?void 0:O.unassociateElement)==null||o.call(O,this)}if(a){let O=re.getElementById(a);(c=O==null?void 0:O.associateElement)==null||c.call(O,this)}}else e==="disabled"&&a!==r&&(a==null?this.enable():this.disable())}connectedCallback(){var e;this.hasAttribute("disabled")||this.enable(),this.setAttribute("role","button");let r=this.getAttribute(xe.MEDIA_CONTROLLER);if(r){let a=re.getElementById(r);(e=a==null?void 0:a.associateElement)==null||e.call(a,this)}}disconnectedCallback(){var e;this.disable();let r=this.getAttribute(xe.MEDIA_CONTROLLER);if(r){let a=re.getElementById(r);(e=a==null?void 0:a.unassociateElement)==null||e.call(a,this)}}get keysUsed(){return["Enter"," "]}handleClick(e){}};Zi=new WeakMap;Ur=new WeakMap;pn=new WeakMap;ce("media-chrome-button",Ji);var Qe=Ji;var _d=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M22.13 3H3.87a.87.87 0 0 0-.87.87v13.26a.87.87 0 0 0 .87.87h3.4L9 16H5V5h16v11h-4l1.72 2h3.4a.87.87 0 0 0 .87-.87V3.87a.87.87 0 0 0-.86-.87Zm-8.75 11.44a.5.5 0 0 0-.76 0l-4.91 5.73a.5.5 0 0 0 .38.83h9.82a.501.501 0 0 0 .38-.83l-4.91-5.73Z"/>
</svg>
`,co=re.createElement("template");co.innerHTML=`
  <slot name="airplay">${_d}</slot>
`;var En=class extends Qe{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_AIRPLAY_UNAVAILABLE]}constructor(e={}){super({slotTemplate:co,...e})}connectedCallback(){this.setAttribute("aria-label",Xe.AIRPLAY()),super.connectedCallback()}handleClick(){let e=new ie.CustomEvent(fe.MEDIA_AIRPLAY_REQUEST,{composed:!0,bubbles:!0});this.dispatchEvent(e)}};ce("media-airplay-button",En);var Sd='<svg aria-hidden="true" viewBox="0 0 24 24"><g><path class="cast_caf_icon_arch0" d="M1,18 L1,21 L4,21 C4,19.3 2.66,18 1,18 L1,18 Z"/><path class="cast_caf_icon_arch1" d="M1,14 L1,16 C3.76,16 6,18.2 6,21 L8,21 C8,17.13 4.87,14 1,14 L1,14 Z"/><path class="cast_caf_icon_arch2" d="M1,10 L1,12 C5.97,12 10,16.0 10,21 L12,21 C12,14.92 7.07,10 1,10 L1,10 Z"/><path class="cast_caf_icon_box" d="M21,3 L3,3 C1.9,3 1,3.9 1,5 L1,8 L3,8 L3,5 L21,5 L21,19 L14,19 L14,21 L21,21 C22.1,21 23,20.1 23,19 L23,5 C23,3.9 22.1,3 21,3 L21,3 Z"/></g></svg>',xd='<svg aria-hidden="true" viewBox="0 0 24 24"><g><path class="cast_caf_icon_arch0" d="M1,18 L1,21 L4,21 C4,19.3 2.66,18 1,18 L1,18 Z"/><path class="cast_caf_icon_arch1" d="M1,14 L1,16 C3.76,16 6,18.2 6,21 L8,21 C8,17.13 4.87,14 1,14 L1,14 Z"/><path class="cast_caf_icon_arch2" d="M1,10 L1,12 C5.97,12 10,16.0 10,21 L12,21 C12,14.92 7.07,10 1,10 L1,10 Z"/><path class="cast_caf_icon_box" d="M21,3 L3,3 C1.9,3 1,3.9 1,5 L1,8 L3,8 L3,5 L21,5 L21,19 L14,19 L14,21 L21,21 C22.1,21 23,20.1 23,19 L23,5 C23,3.9 22.1,3 21,3 L21,3 Z"/><path class="cast_caf_icon_boxfill" d="M5,7 L5,8.63 C8,8.6 13.37,14 13.37,17 L19,17 L19,7 Z"/></g></svg>',ho=re.createElement("template");ho.innerHTML=`
  <style>
  :host([${V.MEDIA_IS_CASTING}]) slot:not([name=exit]) > *,
  :host([${V.MEDIA_IS_CASTING}]) ::slotted(:not([slot=exit])) {
    display: none !important;
  }

  
  :host(:not([${V.MEDIA_IS_CASTING}])) slot:not([name=enter]) > *,
  :host(:not([${V.MEDIA_IS_CASTING}])) ::slotted(:not([slot=enter])) {
    display: none !important;
  }
  </style>

  <slot name="enter">${Sd}</slot>
  <slot name="exit">${xd}</slot>
`;var fo=t=>{let r=t.getAttribute(V.MEDIA_IS_CASTING)!=null?Xe.EXIT_CAST():Xe.ENTER_CAST();t.setAttribute("aria-label",r)},yn=class extends Qe{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_IS_CASTING,V.MEDIA_CAST_UNAVAILABLE]}constructor(e={}){super({slotTemplate:ho,...e})}connectedCallback(){fo(this),super.connectedCallback()}attributeChangedCallback(e,r,a){e===V.MEDIA_IS_CASTING&&fo(this),super.attributeChangedCallback(e,r,a)}handleClick(){let e=this.getAttribute(V.MEDIA_IS_CASTING)!=null?fe.MEDIA_EXIT_CAST_REQUEST:fe.MEDIA_ENTER_CAST_REQUEST;this.dispatchEvent(new ie.CustomEvent(e,{composed:!0,bubbles:!0}))}};ce("media-cast-button",yn);var qi=(t,e,r=".value")=>{let a=t.querySelector(r);!a||(a.textContent=e)},Dd=(t,e)=>{let r=`slot[name="${e}"]`,a=t.shadowRoot.querySelector(r);return a?a.children:[]},ea=(t,e)=>Dd(t,e)[0],di=(t,e)=>!t||!e?!1:t.contains(e)?!0:di(t,e.getRootNode().host),ci=(t,e)=>{if(!t)return null;let r=t.closest(e);return r||ci(t.getRootNode().host,e)};function Qt(t,e){var r;let a;for(a of t.querySelectorAll("style")){let o;try{o=(r=a.sheet)==null?void 0:r.cssRules}catch{continue}for(let c of o!=null?o:[])if(c.selectorText===e)return c}return a!=null&&a.sheet?(a.sheet.insertRule(`${e}{}`,a.sheet.cssRules.length),a.sheet.cssRules[a.sheet.cssRules.length-1]):{style:{setProperty:()=>{}}}}var mo=re.createElement("template");mo.innerHTML=`
<style>
  :host {
    display: inline-block;
    box-sizing: border-box;
  }
</style>
`;var Tn=class extends ie.HTMLElement{static get observedAttributes(){return[xe.MEDIA_CONTROLLER,V.MEDIA_PAUSED]}constructor(e={}){super();let r=this.attachShadow({mode:"open"}),a=mo.content.cloneNode(!0);this.nativeEl=a;let o=e.slotTemplate;o||(o=re.createElement("template"),o.innerHTML=`<slot>${e.defaultContent||""}</slot>`),this.nativeEl.appendChild(o.content.cloneNode(!0)),r.appendChild(a)}attributeChangedCallback(e,r,a){var o,c;if(e===xe.MEDIA_CONTROLLER){if(r){let O=re.getElementById(r);(o=O==null?void 0:O.unassociateElement)==null||o.call(O,this)}if(a){let O=re.getElementById(a);(c=O==null?void 0:O.associateElement)==null||c.call(O,this)}}}connectedCallback(){var e;this.setAttribute("tabindex",-1),this.setAttribute("aria-hidden",!0);let r=vo(this);this.getAttribute(xe.MEDIA_CONTROLLER)&&((e=r==null?void 0:r.associateElement)==null||e.call(r,this)),r==null||r.addEventListener("pointerdown",this),r==null||r.addEventListener("click",this)}disconnectedCallback(){var e;let r=vo(this);this.getAttribute(xe.MEDIA_CONTROLLER)&&((e=r==null?void 0:r.unassociateElement)==null||e.call(r,this)),r==null||r.removeEventListener("pointerdown",this),r==null||r.removeEventListener("click",this)}handleEvent(e){var r;let a=(r=e.composedPath())==null?void 0:r[0];if(!!["video","media-controller"].includes(a==null?void 0:a.localName)){if(e.type==="pointerdown")this._pointerType=e.pointerType;else if(e.type==="click"){let{clientX:c,clientY:O}=e,{left:C,top:M,width:D,height:A}=this.getBoundingClientRect(),_=c-C,I=O-M;if(_<0||I<0||_>D||I>A||D===0&&A===0)return;let{pointerType:S=this._pointerType}=e;if(this._pointerType=void 0,S===vn.TOUCH){this.handleTap(e);return}else if(S===vn.MOUSE){this.handleMouseClick(e);return}}}}handleTap(e){}handleMouseClick(e){let r=this.getAttribute(V.MEDIA_PAUSED)!=null?fe.MEDIA_PLAY_REQUEST:fe.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new ie.CustomEvent(r,{composed:!0,bubbles:!0}))}};function vo(t){let e=t.getAttribute(xe.MEDIA_CONTROLLER);return e?re.getElementById(e):ci(t,"media-controller")}ce("media-gesture-receiver",Tn);var go=re.createElement("template");go.innerHTML=`
  <style>
    
    :host([media-is-fullscreen])  ::slotted([slot=media]) {
      outline: none;
    }

    :host {
      box-sizing: border-box;
      position: relative;
      display: inline-block;
      line-height: 0;
      background-color: var(--media-background-color, #000);
    }

    :host(:not([audio])) [part~=layer]:not([part~=media-layer]) {
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      display: flex;
      flex-flow: column nowrap;
      align-items: start;
      pointer-events: none;
      background: none;
    }

    
    :host([audio]) [part~=layer][part~=gesture-layer] {
      height: 0;
      display: block;
    }

    
    :host(:not([audio])[gestures-disabled]) ::slotted([slot=gestures-chrome]),
    :host(:not([audio])[gestures-disabled]) media-gesture-receiver[slot=gestures-chrome] {
      display: none;
    }

    
    ::slotted(:not([slot=media]):not([slot=poster]):not(media-loading-indicator)) {
      pointer-events: auto;
    }

    :host(:not([audio])) *[part~=layer][part~=centered-layer] {
      align-items: center;
      justify-content: center;
    }

    :host(:not([audio])) ::slotted(media-gesture-receiver[slot=gestures-chrome]),
    :host(:not([audio])) media-gesture-receiver[slot=gestures-chrome] {
      align-self: stretch;
      flex-grow: 1;
    }

    slot[name=middle-chrome] {
      display: inline;
      flex-grow: 1;
      pointer-events: none;
      background: none;
    }

    
    ::slotted([slot=media]),
    ::slotted([slot=poster]) {
      width: 100%;
      height: 100%;
    }

    
    :host(:not([audio])) .spacer {
      flex-grow: 1;
    }

    
    :host(:-webkit-full-screen) {
      
      width: 100% !important;
      height: 100% !important;
    }

    
    ::slotted(:not([slot=media]):not([no-auto-hide])) {
      opacity: 1;
      transition: opacity 0.25s;
    }

    
    :host([user-inactive]:not([${V.MEDIA_PAUSED}]):not([${V.MEDIA_IS_CASTING}]):not([audio])) ::slotted(:not([slot=media]):not([no-auto-hide])) {
      opacity: 0;
      transition: opacity 1s;
    }

    ::slotted(media-control-bar)  {
      align-self: stretch;
    }
  </style>

  <slot name="media" part="layer media-layer"></slot>
  <slot name="poster" part="layer poster-layer"></slot>
  <slot name="gestures-chrome" part="layer gesture-layer">
    <media-gesture-receiver slot="gestures-chrome"></media-gesture-receiver>
  </slot>
  <span part="layer vertical-layer">
    <slot name="top-chrome" part="top chrome"></slot>
    <slot name="middle-chrome" part="middle chrome"></slot>
    <slot name="centered-chrome" part="layer centered-layer center centered chrome"></slot>
    
    <slot part="bottom chrome"></slot>
  </span>
`;var Ld=Object.values(V),ta=class extends ie.HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(go.content.cloneNode(!0));let e=c=>{let O=this.media;for(let C of c)C.type==="childList"&&(C.removedNodes.forEach(M=>{if(M.slot=="media"&&C.target==this){let D=C.previousSibling&&C.previousSibling.previousElementSibling;if(!D||!O)this.mediaUnsetCallback(M);else{let A=D.slot!=="media";for(;(D=D.previousSibling)!==null;)D.slot=="media"&&(A=!1);A&&this.mediaUnsetCallback(M)}}}),O&&C.addedNodes.forEach(M=>{M==O&&this.handleMediaUpdated(O).then(D=>this.mediaSetCallback(D))}))};new MutationObserver(e).observe(this,{childList:!0,subtree:!0});let a=this.media,o=this.querySelector(":scope > slot[slot=media]");o&&o.addEventListener("slotchange",()=>{if(!o.assignedElements({flatten:!0}).length){this.mediaUnsetCallback(a);return}this.media&&(a=this.media,this.handleMediaUpdated(this.media).then(O=>this.mediaSetCallback(O)))})}static get observedAttributes(){return["autohide","gestures-disabled"].concat(Ld)}attributeChangedCallback(e,r,a){e.toLowerCase()=="autohide"&&(this.autohide=a)}get media(){let e=this.querySelector(":scope > [slot=media]");return(e==null?void 0:e.nodeName)=="SLOT"&&(e=e.assignedElements({flatten:!0})[0]),e}mediaSetCallback(e){this._mediaClickPlayToggle=()=>{let r=e.paused?fe.MEDIA_PLAY_REQUEST:fe.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new ie.CustomEvent(r,{composed:!0,bubbles:!0}))}}handleMediaUpdated(e){let r=c=>Promise.resolve(c),a=c=>(console.error('<media-chrome>: Media element set with slot="media" does not appear to be compatible.',c),Promise.reject(c));if(!e)return a(e);let o=e.nodeName.toLowerCase();return o.includes("-")?ie.customElements.whenDefined(o).then(()=>r(e)):r(e)}mediaUnsetCallback(e){}connectedCallback(){let r=this.getAttribute("audio")!=null?ut.AUDIO_PLAYER():ut.VIDEO_PLAYER();this.setAttribute("role","region"),this.setAttribute("aria-label",r),this.media&&this.handleMediaUpdated(this.media).then(O=>this.mediaSetCallback(O)),this.setAttribute("user-inactive","user-inactive");let a=()=>{if(this.autohide<0)return;this.setAttribute("user-inactive","user-inactive");let O=new ie.CustomEvent(ui.USER_INACTIVE,{composed:!0,bubbles:!0,detail:!0});this.dispatchEvent(O)},o=()=>{this.removeAttribute("user-inactive");let O=new ie.CustomEvent(ui.USER_INACTIVE,{composed:!0,bubbles:!0,detail:!1});this.dispatchEvent(O)},c=()=>{o(),ie.clearTimeout(this._inactiveTimeout),!(this.autohide<0)&&(this._inactiveTimeout=ie.setTimeout(()=>{a()},this.autohide*1e3))};this.addEventListener("keyup",()=>{c()}),this.addEventListener("pointerup",O=>{O.pointerType==="touch"?[this,this.media].includes(O.target)&&!this.hasAttribute("user-inactive")?a():c():O.composedPath().some(C=>{var M;return["media-play-button","media-fullscreen-button"].includes((M=C==null?void 0:C.nodeName)==null?void 0:M.toLowerCase())})&&c()}),this.addEventListener("pointermove",O=>{O.pointerType==="mouse"&&O.target!==this&&(o(),ie.clearTimeout(this._inactiveTimeout),[this,this.media].includes(O.target)&&c())}),this.addEventListener("mouseleave",()=>{a()}),this.addEventListener("keyup",()=>{this.setAttribute("media-keyboard-control","")}),this.addEventListener("mouseup",()=>{this.removeAttribute("media-keyboard-control")})}set autohide(e){e=Number(e),this._autohide=isNaN(e)?0:e}get autohide(){return this._autohide===void 0?2:this._autohide}};ce("media-container-temp",ta);var po=ta;var Eo=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},st=(t,e,r)=>(Eo(t,e,"read from private field"),r?r.call(t):e.get(t)),bn=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},An=(t,e,r,a)=>(Eo(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),Nr,Br,Tt,ra=class{constructor(e,r){bn(this,Nr,void 0),bn(this,Br,void 0),bn(this,Tt,[]),An(this,Nr,e),An(this,Br,r)}[Symbol.iterator](){return st(this,Tt).values()}get length(){return st(this,Tt).length}get value(){var e;return(e=st(this,Tt).join(" "))!=null?e:""}set value(e){var r;e!==this.value&&(An(this,Tt,[]),this.add(...(r=e==null?void 0:e.split(" "))!=null?r:[]))}toString(){return this.value}item(e){return st(this,Tt)[e]}values(){return st(this,Tt).values()}keys(){return st(this,Tt).keys()}forEach(e){st(this,Tt).forEach(e)}add(...e){var r,a;e.forEach(o=>{this.contains(o)||st(this,Tt).push(o)}),!(this.value===""&&!((r=st(this,Nr))!=null&&r.hasAttribute(`${st(this,Br)}`)))&&((a=st(this,Nr))==null||a.setAttribute(`${st(this,Br)}`,`${this.value}`))}remove(...e){var r;e.forEach(a=>{st(this,Tt).splice(st(this,Tt).indexOf(a),1)}),(r=st(this,Nr))==null||r.setAttribute(`${st(this,Br)}`,`${this.value}`)}contains(e){return st(this,Tt).includes(e)}toggle(e,r){return typeof r!="undefined"?r?(this.add(e),!0):(this.remove(e),!1):this.contains(e)?(this.remove(e),!1):(this.add(e),!0)}replace(e,r){this.remove(e),this.add(r)}};Nr=new WeakMap;Br=new WeakMap;Tt=new WeakMap;var it={enter:"requestFullscreen",exit:"exitFullscreen",event:"fullscreenchange",element:"fullscreenElement",error:"fullscreenerror",enabled:"fullscreenEnabled"};re.fullscreenElement===void 0&&(it.enter="webkitRequestFullScreen",it.exit=re.webkitExitFullscreen!=null?"webkitExitFullscreen":"webkitCancelFullScreen",it.event="webkitfullscreenchange",it.element="webkitFullscreenElement",it.error="webkitfullscreenerror",it.enabled="webkitFullscreenEnabled");var _n=(t="")=>t.split(/\s+/),yo=(t="")=>{let[e,r]=t.split(":"),a=r?decodeURIComponent(r):void 0;return{language:e,label:a}},Id=(t="",e={})=>_n(t).map(r=>{let a=yo(r);return{...e,...a}}),Rd=t=>Array.isArray(t)?t.map(e=>typeof e=="string"?yo(e):e):typeof t=="string"?Id(t):[t],Md=({label:t,language:e}={})=>t?`${e}:${encodeURIComponent(t)}`:e,Bt=(t=[])=>Array.prototype.map.call(t,Md).join(" "),Cd=(t,e)=>r=>r[t]===e,To=t=>{let e=Object.entries(t).map(([r,a])=>Cd(r,a));return r=>e.every(a=>a(r))},fi=(t,e=[],r=[])=>{let a=Rd(r).map(To),o=c=>a.some(O=>O(c));Array.from(e).filter(o).forEach(c=>{c.mode=t})},Fr=(t,e=()=>!0)=>{if(!(t!=null&&t.textTracks))return[];let r=typeof e=="function"?e:To(e);return Array.from(t.textTracks).filter(r)},Sn=t=>{let e=!!t.getAttribute(V.MEDIA_CAPTIONS_SHOWING),r=!t.hasAttribute("no-subtitles-fallback")&&!!t.getAttribute(V.MEDIA_SUBTITLES_SHOWING);return e||r},ia=t=>{var e,r,a,o;if(Sn(t)){let O=t.getAttribute(V.MEDIA_CAPTIONS_SHOWING);if(O){let M=new window.CustomEvent(fe.MEDIA_DISABLE_CAPTIONS_REQUEST,{composed:!0,bubbles:!0,detail:O});t.dispatchEvent(M)}let C=t.getAttribute(V.MEDIA_SUBTITLES_SHOWING);if(C&&!t.hasAttribute("no-subtitles-fallback")){let M=new window.CustomEvent(fe.MEDIA_DISABLE_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:C});t.dispatchEvent(M)}}else{let[O]=(r=_n((e=t.getAttribute(V.MEDIA_CAPTIONS_LIST))!=null?e:""))!=null?r:[];if(O){let C=new window.CustomEvent(fe.MEDIA_SHOW_CAPTIONS_REQUEST,{composed:!0,bubbles:!0,detail:O});t.dispatchEvent(C)}else if(t.hasAttribute("no-subtitles-fallback"))console.error("Attempting to enable closed captions but none are available! Please verify your media content if this is unexpected.");else{let[C]=(o=_n((a=t.getAttribute(V.MEDIA_SUBTITLES_LIST))!=null?a:""))!=null?o:[];if(C){let M=new window.CustomEvent(fe.MEDIA_SHOW_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:C});t.dispatchEvent(M)}}}};var So=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},Kr=(t,e,r)=>(So(t,e,"read from private field"),r?r.call(t):e.get(t)),xn=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},Wr=(t,e,r)=>(So(t,e,"access private method"),r),nr,Hr,gi,sa,Dn,Od=Object.values(zi),xo=["ArrowLeft","ArrowRight","Enter"," ","f","m","k","c"],Pd=10,bo=0,la=class extends po{constructor(){super(),xn(this,Hr),xn(this,sa),xn(this,nr,new ra(this,"hotkeys")),Hd||(this._airplayUnavailable=Nt.UNSUPPORTED),_o||(this._fullscreenUnavailable=Nt.UNAVAILABLE),Gd||(this._castUnavailable=Nt.UNSUPPORTED),Kd||(this._pipUnavailable=Nt.UNSUPPORTED),mi!==void 0?mi||(this._volumeUnavailable=Nt.UNSUPPORTED):Wd.then(()=>{mi||(this._volumeUnavailable=Nt.UNSUPPORTED,this.propagateMediaState(V.MEDIA_VOLUME_UNAVAILABLE,this._volumeUnavailable))}),this.mediaStateReceivers=[],this.associatedElementSubscriptions=new Map,this.associatedElements=[],this.associateElement(this);let e={MEDIA_PLAY_REQUEST:()=>this.media.play(),MEDIA_PAUSE_REQUEST:()=>this.media.pause(),MEDIA_MUTE_REQUEST:()=>this.media.muted=!0,MEDIA_UNMUTE_REQUEST:()=>{let r=this.media;r.muted=!1,r.volume===0&&(r.volume=.25)},MEDIA_VOLUME_REQUEST:r=>{let a=this.media,o=r.detail;a.volume=o,o>0&&a.muted&&(a.muted=!1);try{ie.localStorage.setItem("media-chrome-pref-volume",o.toString())}catch{}},MEDIA_ENTER_FULLSCREEN_REQUEST:()=>{if(!_o){console.warn("Fullscreen support is unavailable; not entering fullscreen");return}let r=this.media;re.pictureInPictureElement&&re.exitPictureInPicture(),super[it.enter]?super[it.enter]():r.webkitEnterFullscreen?r.webkitEnterFullscreen():r.requestFullscreen?r.requestFullscreen():console.warn("MediaChrome: Fullscreen not supported")},MEDIA_EXIT_FULLSCREEN_REQUEST:()=>{re[it.exit]()},MEDIA_ENTER_PIP_REQUEST:()=>{let r=this.media;if(!re.pictureInPictureEnabled){console.warn("MediaChrome: Picture-in-picture is not enabled");return}if(!r.requestPictureInPicture){console.warn("MediaChrome: The current media does not support picture-in-picture");return}re[it.element]&&re[it.exit]();let a=()=>{console.warn("MediaChrome: The media is not ready for picture-in-picture. It must have a readyState > 0.")};r.requestPictureInPicture().catch(o=>{if(o.code===11)if(r.readyState===0&&r.preload==="none"){let c=()=>{r.removeEventListener("loadedmetadata",O),r.preload="none"},O=()=>{r.requestPictureInPicture().catch(a),c()};r.addEventListener("loadedmetadata",O),r.preload="metadata",setTimeout(()=>{r.readyState===0&&a(),c()},1e3)}else throw o;else throw o})},MEDIA_EXIT_PIP_REQUEST:()=>{re.pictureInPictureElement&&re.exitPictureInPicture()},MEDIA_ENTER_CAST_REQUEST:()=>{var r;let a=this.media;!((r=globalThis.CastableVideoElement)!=null&&r.castEnabled)||(re[it.element]&&re[it.exit](),a.requestCast())},MEDIA_EXIT_CAST_REQUEST:async()=>{var r;(r=globalThis.CastableVideoElement)!=null&&r.castElement&&globalThis.CastableVideoElement.exitCast()},MEDIA_SEEK_REQUEST:r=>{let a=this.media,o=r.detail;(a.readyState>0||a.readyState===void 0)&&(a.currentTime=o)},MEDIA_PLAYBACK_RATE_REQUEST:r=>{this.media.playbackRate=r.detail},MEDIA_PREVIEW_REQUEST:r=>{var a;let o=this.media;if(!o)return;let c=r.detail;c===null&&this.propagateMediaState(V.MEDIA_PREVIEW_TIME,void 0),this.propagateMediaState(V.MEDIA_PREVIEW_TIME,c);let[O]=Fr(o,{kind:wr.METADATA,label:"thumbnails"});if(!(O&&O.cues))return;if(c===null){this.propagateMediaState(V.MEDIA_PREVIEW_IMAGE,void 0),this.propagateMediaState(V.MEDIA_PREVIEW_COORDS,void 0);return}let C=Array.prototype.find.call(O.cues,_=>_.startTime>=c);if(!C)return;let M=/'^(?:[a-z]+:)?\/\//i.test(C.text)||(a=o.querySelector('track[label="thumbnails"]'))==null?void 0:a.src,D=new URL(C.text,M),A=new URLSearchParams(D.hash).get("#xywh");this.propagateMediaState(V.MEDIA_PREVIEW_IMAGE,D.href),this.propagateMediaState(V.MEDIA_PREVIEW_COORDS,A.split(",").join(" "))},MEDIA_SHOW_CAPTIONS_REQUEST:r=>{let a=oa(this),{detail:o=[]}=r;fi(Tr.SHOWING,a,o)},MEDIA_DISABLE_CAPTIONS_REQUEST:r=>{let a=oa(this),{detail:o=[]}=r;fi(Tr.DISABLED,a,o)},MEDIA_SHOW_SUBTITLES_REQUEST:r=>{let a=vi(this),{detail:o=[]}=r;fi(Tr.SHOWING,a,o)},MEDIA_DISABLE_SUBTITLES_REQUEST:r=>{let a=vi(this),{detail:o=[]}=r;fi(Tr.DISABLED,a,o)},MEDIA_AIRPLAY_REQUEST:()=>{let{media:r}=this;if(!!r){if(!(r.webkitShowPlaybackTargetPicker&&ie.WebKitPlaybackTargetAvailabilityEvent)){console.warn("received a request to select AirPlay but AirPlay is not supported in this environment");return}r.webkitShowPlaybackTargetPicker()}}};if(Object.keys(e).forEach(r=>{let a=`_handle${Xi(r,!0)}`;this[a]=o=>{if(o.stopPropagation(),!this.media){console.warn("MediaController: No media available.");return}e[r](o,this.media)},this.addEventListener(fe[r],this[a])}),this._mediaStatePropagators={"play,pause,emptied":()=>{this.propagateMediaState(V.MEDIA_PAUSED,Do(this))},"playing,emptied":()=>{var r;this.propagateMediaState(V.MEDIA_HAS_PLAYED,!((r=this.media)!=null&&r.paused))},volumechange:()=>{this.propagateMediaState(V.MEDIA_MUTED,Lo(this)),this.propagateMediaState(V.MEDIA_VOLUME,Io(this)),this.propagateMediaState(V.MEDIA_VOLUME_LEVEL,Ro(this))},[it.event]:r=>{let o=!!re[it.element]&&(r==null?void 0:r.target),c=di(this,o);this.propagateMediaState(V.MEDIA_IS_FULLSCREEN,c)},"enterpictureinpicture,leavepictureinpicture":r=>{var a;let o;if(r)o=r.type=="enterpictureinpicture";else{let c=(a=this.getRootNode().pictureInPictureElement)!=null?a:re.pictureInPictureElement;o=this.media&&di(this.media,c)}this.propagateMediaState(V.MEDIA_IS_PIP,o)},"entercast,leavecast,castchange":r=>{var a;let o=(a=globalThis.CastableVideoElement)==null?void 0:a.castElement,c=this.media&&di(this.media,o);(r==null?void 0:r.type)==="castchange"&&(r==null?void 0:r.detail)==="CONNECTING"&&(c="connecting"),this.propagateMediaState(V.MEDIA_IS_CASTING,c)},"timeupdate,loadedmetadata":()=>{this.propagateMediaState(V.MEDIA_CURRENT_TIME,Mo(this))},"durationchange,loadedmetadata,emptied":()=>{this.propagateMediaState(V.MEDIA_DURATION,Co(this)),this.propagateMediaState(V.MEDIA_STREAM_TYPE)},"loadedmetadata,emptied,progress":()=>{var r;this.propagateMediaState(V.MEDIA_SEEKABLE,(r=Oo(this))==null?void 0:r.join(":"))},"progress,emptied":()=>{var r;this.propagateMediaState(V.MEDIA_BUFFERED,$d((r=this.media)==null?void 0:r.buffered))},"ratechange,loadstart":()=>{this.propagateMediaState(V.MEDIA_PLAYBACK_RATE,Po(this))},"waiting,playing,emptied":()=>{var r;let a=((r=this.media)==null?void 0:r.readyState)<3;this.propagateMediaState(V.MEDIA_LOADING,a)}},this._airplayUnavailable!==Nt.UNSUPPORTED){let r=a=>{(a==null?void 0:a.availability)==="available"?this._airplayUnavailable=void 0:(a==null?void 0:a.availability)==="not-available"&&(this._airplayUnavailable=Nt.UNAVAILABLE),this.propagateMediaState(V.MEDIA_AIRPLAY_UNAVAILABLE,this._airplayUnavailable)};this._mediaStatePropagators.webkitplaybacktargetavailabilitychanged=r}if(this._castUnavailable!==Nt.UNSUPPORTED){let r=()=>{var a;let o=(a=globalThis.CastableVideoElement)==null?void 0:a.castState;o!=null&&o.includes("CONNECT")?this._castUnavailable=void 0:this._castUnavailable=Nt.UNAVAILABLE,this.propagateMediaState(V.MEDIA_CAST_UNAVAILABLE,this._castUnavailable)};this._mediaStatePropagators.castchange=r}this._textTrackMediaStatePropagators={"addtrack,removetrack,loadstart":()=>{this.propagateMediaState(V.MEDIA_CAPTIONS_LIST,Bt(oa(this))||void 0),this.propagateMediaState(V.MEDIA_SUBTITLES_LIST,Bt(vi(this))||void 0),this.propagateMediaState(V.MEDIA_CAPTIONS_SHOWING,Bt(Ln(this))||void 0),this.propagateMediaState(V.MEDIA_SUBTITLES_SHOWING,Bt(Ao(this))||void 0)},change:()=>{this.propagateMediaState(V.MEDIA_CAPTIONS_SHOWING,Bt(Ln(this))||void 0),this.propagateMediaState(V.MEDIA_SUBTITLES_SHOWING,Bt(Ao(this))||void 0)}},this.enableHotkeys()}static get observedAttributes(){return super.observedAttributes.concat("nohotkeys","hotkeys","default-stream-type")}attributeChangedCallback(e,r,a){e==="nohotkeys"?a!==r&&a===""?(this.hasAttribute("hotkeys")&&console.warn("Both `hotkeys` and `nohotkeys` have been set. All hotkeys will be disabled."),this.disableHotkeys()):a!==r&&a===null&&this.enableHotkeys():e==="hotkeys"?Kr(this,nr).value=a:e==="default-stream-type"&&this.propagateMediaState(V.MEDIA_STREAM_TYPE),super.attributeChangedCallback(e,r,a)}mediaSetCallback(e){super.mediaSetCallback(e),e.hasAttribute("tabindex")||e.setAttribute("tabindex",-1),Object.keys(this._mediaStatePropagators).forEach(r=>{let a=r.split(","),o=this._mediaStatePropagators[r];a.forEach(c=>{(c==it.event?this.getRootNode():e).addEventListener(c,o)}),o()}),Object.entries(this._textTrackMediaStatePropagators).forEach(([r,a])=>{r.split(",").forEach(c=>{e.textTracks&&e.textTracks.addEventListener(c,a)}),a()});try{let r=ie.localStorage.getItem("media-chrome-pref-volume");r!==null&&(e.volume=r)}catch(r){console.debug("Error getting volume pref",r)}}mediaUnsetCallback(e){super.mediaUnsetCallback(e),Object.keys(this._mediaStatePropagators).forEach(r=>{let a=r.split(","),o=this._mediaStatePropagators[r];a.forEach(c=>{(c==it.event?this.getRootNode():e).removeEventListener(c,o)})}),Object.entries(this._textTrackMediaStatePropagators).forEach(([r,a])=>{r.split(",").forEach(c=>{e.textTracks&&e.textTracks.removeEventListener(c,a)}),a()}),this.propagateMediaState(V.MEDIA_PAUSED,!0)}propagateMediaState(e,r){arguments.length===1&&(r=aa[e](this)),_r(this.mediaStateReceivers,e,r);let a=new ie.CustomEvent(io[e],{composed:!0,bubbles:!0,detail:r});this.dispatchEvent(a)}associateElement(e){if(!e)return;let{associatedElementSubscriptions:r}=this;if(r.has(e))return;let a=this.registerMediaStateReceiver.bind(this),o=this.unregisterMediaStateReceiver.bind(this),c=Nd(e,a,o);Object.keys(fe).forEach(O=>{e.addEventListener(fe[O],this[`_handle${Xi(O,!0)}`])}),r.set(e,c)}unassociateElement(e){if(!e)return;let{associatedElementSubscriptions:r}=this;if(!r.has(e))return;r.get(e)(),r.delete(e),Object.keys(fe).forEach(o=>{e.removeEventListener(fe[o],this[`_handle${Xi(o,!0)}`])})}registerMediaStateReceiver(e){if(!e)return;let r=this.mediaStateReceivers;r.indexOf(e)>-1||(r.push(e),_r([e],V.MEDIA_VOLUME_UNAVAILABLE,this._volumeUnavailable),_r([e],V.MEDIA_AIRPLAY_UNAVAILABLE,this._airplayUnavailable),_r([e],V.MEDIA_FULLSCREEN_UNAVAILABLE,this._fullscreenUnavailable),_r([e],V.MEDIA_CAST_UNAVAILABLE,this._castUnavailable),_r([e],V.MEDIA_PIP_UNAVAILABLE,this._pipUnavailable),this.media&&Object.keys(V).forEach(o=>{o.includes("UNAVAILABLE")||_r([e],V[o],aa[V[o]]?aa[V[o]](this):aa.default(this,V[o]))}))}unregisterMediaStateReceiver(e){let r=this.mediaStateReceivers,a=r.indexOf(e);a<0||r.splice(a,1)}enableHotkeys(){this.addEventListener("keydown",Wr(this,sa,Dn))}disableHotkeys(){this.removeEventListener("keydown",Wr(this,sa,Dn)),this.removeEventListener("keyup",Wr(this,Hr,gi))}get hotkeys(){return Kr(this,nr)}keyboardShortcutHandler(e){var r,a,o,c;if(((c=(o=(r=e.target.getAttribute("keysused"))==null?void 0:r.split(" "))!=null?o:(a=e.target)==null?void 0:a.keysUsed)!=null?c:[]).map(S=>S==="Space"?" ":S).filter(Boolean).includes(e.key))return;let C,M,D,A,_,I=Pd;if(!Kr(this,nr).contains(`no${e.key.toLowerCase()}`)&&!(e.key===" "&&Kr(this,nr).contains("nospace")))switch(e.key){case" ":case"k":C=this.getAttribute(V.MEDIA_PAUSED)!=null?fe.MEDIA_PLAY_REQUEST:fe.MEDIA_PAUSE_REQUEST,this.dispatchEvent(new ie.CustomEvent(C,{composed:!0,bubbles:!0}));break;case"m":C=this.getAttribute(V.MEDIA_VOLUME_LEVEL)==="off"?fe.MEDIA_UNMUTE_REQUEST:fe.MEDIA_MUTE_REQUEST,this.dispatchEvent(new ie.CustomEvent(C,{composed:!0,bubbles:!0}));break;case"f":C=this.getAttribute(V.MEDIA_IS_FULLSCREEN)!=null?fe.MEDIA_EXIT_FULLSCREEN_REQUEST:fe.MEDIA_ENTER_FULLSCREEN_REQUEST,this.dispatchEvent(new ie.CustomEvent(C,{composed:!0,bubbles:!0}));break;case"c":ia(this);break;case"ArrowLeft":M=this.getAttribute(V.MEDIA_CURRENT_TIME),D=M&&!Number.isNaN(+M)?+M:bo,A=Math.max(D-I,0),_=new ie.CustomEvent(fe.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:A}),this.dispatchEvent(_);break;case"ArrowRight":M=this.getAttribute(V.MEDIA_CURRENT_TIME),D=M&&!Number.isNaN(+M)?+M:bo,A=Math.max(D+I,0),_=new ie.CustomEvent(fe.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:A}),this.dispatchEvent(_);break;default:break}}};nr=new WeakMap;Hr=new WeakSet;gi=function(t){let{key:e}=t;if(!xo.includes(e)){this.removeEventListener("keyup",Wr(this,Hr,gi));return}this.keyboardShortcutHandler(t)};sa=new WeakSet;Dn=function(t){let{metaKey:e,altKey:r,key:a}=t;if(e||r||!xo.includes(a)){this.removeEventListener("keyup",Wr(this,Hr,gi));return}[" ","ArrowLeft","ArrowRight"].includes(a)&&!(Kr(this,nr).contains(`no${a.toLowerCase()}`)||a===" "&&Kr(this,nr).contains("nospace"))&&t.preventDefault(),this.addEventListener("keyup",Wr(this,Hr,gi),{once:!0})};var aa={default(t,e){return t.getAttribute(e)},[V.MEDIA_CAPTIONS_LIST](t){return Bt(oa(t))||void 0},[V.MEDIA_SUBTITLES_LIST](t){return Bt(vi(t))||void 0},[V.MEDIA_SUBTITLES_LIST](t){return Bt(vi(t))||void 0},[V.MEDIA_CAPTIONS_SHOWING](t){return Bt(Ln(t))||void 0},[V.MEDIA_PAUSED](t){return Do(t)},[V.MEDIA_MUTED](t){return Lo(t)},[V.MEDIA_VOLUME](t){return Io(t)},[V.MEDIA_VOLUME_LEVEL](t){return Ro(t)},[V.MEDIA_CURRENT_TIME](t){return Mo(t)},[V.MEDIA_DURATION](t){return Co(t)},[V.MEDIA_SEEKABLE](t){var e;return(e=Oo(t))==null?void 0:e.join(":")},[V.MEDIA_PLAYBACK_RATE](t){return Po(t)},[V.MEDIA_STREAM_TYPE](t){let e=t.media;if(!e)return;let r=e.duration;if(r===1/0)return zi.LIVE;if(Number.isFinite(r))return zi.ON_DEMAND;{let a=t.getAttribute("default-stream-type");if(Od.includes(a))return a}return null}},Do=t=>t.media?t.media.paused:!0,Lo=t=>!!(t.media&&t.media.muted),Io=t=>{let e=t.media;return e?e.volume:1},Ro=t=>{let e="high";if(!t.media)return e;let{muted:r,volume:a}=t.media;return a===0||r?e="off":a<.5?e="low":a<.75&&(e="medium"),e},Mo=t=>{let e=t.media;return e?e.currentTime:0},Co=t=>{let e=t==null?void 0:t.media;return Number.isFinite(e==null?void 0:e.duration)?e.duration:NaN},Oo=t=>{var e;let r=t==null?void 0:t.media;if(!((e=r==null?void 0:r.seekable)!=null&&e.length))return;let a=r.seekable.start(0),o=r.seekable.end(r.seekable.length-1);if(!(!a&&!o))return[Number(a.toFixed(3)),Number(o.toFixed(3))]},Po=t=>{let e=t.media;return e?e.playbackRate:1},vi=t=>Fr(t.media,{kind:wr.SUBTITLES}),oa=t=>Fr(t.media,{kind:wr.CAPTIONS}),Ao=t=>Fr(t.media,{kind:wr.SUBTITLES,mode:Tr.SHOWING}),Ln=t=>Fr(t.media,{kind:wr.CAPTIONS,mode:Tr.SHOWING}),kd=Object.values(V),ko=t=>{var e,r,a,o;let{observedAttributes:c}=t.constructor;!c&&((e=t.nodeName)==null?void 0:e.includes("-"))&&(ie.customElements.upgrade(t),{observedAttributes:c}=t.constructor);let O=(o=(a=(r=t==null?void 0:t.getAttribute)==null?void 0:r.call(t,xe.MEDIA_CHROME_ATTRIBUTES))==null?void 0:a.split)==null?void 0:o.call(a,/\s+/);return Array.isArray(c||O)?(c||O).filter(C=>kd.includes(C)):[]},In=t=>!!ko(t).length,wd=async(t,e,r)=>(t.isConnected||await wo(0),r==null?t.removeAttribute(e):typeof r=="boolean"?r?t.setAttribute(e,""):t.removeAttribute(e):Number.isNaN(r)?t.removeAttribute(e):t.setAttribute(e,r)),Ud=t=>{var e;return!!((e=t.closest)!=null&&e.call(t,'*[slot="media"]'))},hi=(t,e)=>{if(Ud(t))return;let r=(o,c)=>{var O,C;In(o)&&c(o);let{children:M=[]}=o!=null?o:{},D=(C=(O=o==null?void 0:o.shadowRoot)==null?void 0:O.children)!=null?C:[];[...M,...D].forEach(_=>hi(_,c))},a=t==null?void 0:t.nodeName.toLowerCase();if(a.includes("-")&&!In(t)){ie.customElements.whenDefined(a).then(()=>{r(t,e)});return}r(t,e)},_r=(t,e,r)=>{t.forEach(a=>{!ko(a).includes(e)||wd(a,e,r)})},Nd=(t,e,r)=>{hi(t,e);let a=M=>{var D;let A=(D=M==null?void 0:M.composedPath()[0])!=null?D:M.target;e(A)},o=M=>{var D;let A=(D=M==null?void 0:M.composedPath()[0])!=null?D:M.target;r(A)};t.addEventListener(fe.REGISTER_MEDIA_STATE_RECEIVER,a),t.addEventListener(fe.UNREGISTER_MEDIA_STATE_RECEIVER,o);let c=M=>{M.forEach(D=>{let{addedNodes:A=[],removedNodes:_=[],type:I,target:S,attributeName:T}=D;I==="childList"?(Array.prototype.forEach.call(A,x=>hi(x,e)),Array.prototype.forEach.call(_,x=>hi(x,r))):I==="attributes"&&T===xe.MEDIA_CHROME_ATTRIBUTES&&(In(S)?e(S):r(S))})},O=new MutationObserver(c);return O.observe(t,{childList:!0,attributes:!0,subtree:!0}),()=>{hi(t,r),O.disconnect(),t.removeEventListener(fe.REGISTER_MEDIA_STATE_RECEIVER,a),t.removeEventListener(fe.UNREGISTER_MEDIA_STATE_RECEIVER,o)}},na,Rn=()=>{var t,e;return na||(na=(e=(t=re)==null?void 0:t.createElement)==null?void 0:e.call(t,"video"),na)},Bd=async(t=Rn())=>{if(!t)return!1;let e=t.volume;return t.volume=e/2+.1,await wo(0),t.volume!==e},wo=t=>new Promise(e=>setTimeout(e,t)),Fd=(t=Rn())=>typeof(t==null?void 0:t.requestPictureInPicture)=="function",Kd=Fd(),mi,Wd=Bd().then(t=>(mi=t,mi)),Hd=!!ie.WebKitPlaybackTargetAvailabilityEvent,Gd=!!ie.chrome,jd=(t=Rn())=>{let e=re[it.enabled];return!e&&t&&(e="webkitSupportsFullscreen"in t),e},_o=jd(),Vd=Object.freeze({length:0,start(t){let e=t>>>0;if(e>=this.length)throw new DOMException(`Failed to execute 'start' on 'TimeRanges': The index provided (${e}) is greater than or equal to the maximum bound (${this.length}).`);return 0},end(t){let e=t>>>0;if(e>=this.length)throw new DOMException(`Failed to execute 'end' on 'TimeRanges': The index provided (${e}) is greater than or equal to the maximum bound (${this.length}).`);return 0}});function $d(t=Vd){return Array.from(t).map((e,r)=>[Number(t.start(r).toFixed(3)),Number(t.end(r).toFixed(3))].join(":")).join(" ")}ce("media-controller",la);var pi=la;var No=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},Yd=(t,e,r)=>(No(t,e,"read from private field"),r?r.call(t):e.get(t)),zd=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},Xd=(t,e,r,a)=>(No(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),ua,Bo=re.createElement("template"),Uo=`
  height: var(--thumb-height);
  width: var(--media-range-thumb-width, 10px);
  border: var(--media-range-thumb-border, none);
  border-radius: var(--media-range-thumb-border-radius, 10px);
  background: var(--media-range-thumb-background, #fff);
  box-shadow: var(--media-range-thumb-box-shadow, 1px 1px 1px transparent);
  cursor: pointer;
  transition: var(--media-range-thumb-transition, none);
  transform: var(--media-range-thumb-transform, none);
  opacity: var(--media-range-thumb-opacity, 1);
`,Mn=`
  width: var(--media-range-track-width, 100%);
  min-width: 40px;
  height: var(--track-height);
  border: var(--media-range-track-border, none);
  outline: var(--media-range-track-outline);
  outline-offset: var(--media-range-track-outline-offset);
  border-radius: var(--media-range-track-border-radius, 0);
  background: var(--media-range-track-progress-internal, var(--media-range-track-background, #eee));
  box-shadow: var(--media-range-track-box-shadow, none);
  transition: var(--media-range-track-transition, none);
  transform: translate(var(--media-range-track-translate-x, 0), var(--media-range-track-translate-y, 0));
  cursor: pointer;
`;Bo.innerHTML=`
  <style>
    :host {
      --thumb-height: var(--media-range-thumb-height, 10px);
      --track-height: var(--media-range-track-height, 4px);
      --media-range-padding: var(--media-control-padding, 10px);
      --_media-range-padding: var(--media-range-padding, 10px);

      vertical-align: middle;
      box-sizing: border-box;
      display: inline-block;
      position: relative;
      background: var(--media-control-background, rgba(20,20,30, 0.7));
      transition: background 0.15s linear;
      width: 100px;
      height: calc(var(--media-control-height, 24px) + 2 * var(--_media-range-padding));
      padding-left: var(--media-range-padding-left, var(--_media-range-padding));
      padding-right: var(--media-range-padding-right, var(--_media-range-padding));
      pointer-events: auto;
      
      font-size: 0;
    }

    :host(:hover) {
      background: var(--media-control-hover-background, rgba(50,50,60, 0.7));
    }

    #container {
      position: relative;
      height: 100%;
    }

    input[type=range] {
      
      -webkit-appearance: none; 
      background: transparent; 

      
      min-height: 100%;
      width: var(--media-range-track-width, 100%); 

      box-sizing: border-box;
      padding: 0;
      margin: 0;
    }

    
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      ${Uo}
      
      margin-top: calc(calc(0px - var(--thumb-height) + var(--track-height)) / 2);
    }

    
    input[type=range]::-moz-range-thumb {
      ${Uo}
      translate: var(--media-range-track-translate-x, 0) var(--media-range-track-translate-y, 0);
    }

    input[type=range]::-webkit-slider-runnable-track { ${Mn} }
    input[type=range]::-moz-range-track { ${Mn} }
    input[type=range]::-ms-track {
      
      width: 100%;
      cursor: pointer;
      
      background: transparent;
      border-color: transparent;
      color: transparent;

      ${Mn}
    }

    #background,
    #pointer {
      min-width: 40px;
      width: var(--media-range-track-width, 100%);
      height: var(--track-height);
      border-radius: var(--media-range-track-border-radius, 0);
      position: absolute;
      top: 50%;
      transform: translate(var(--media-range-track-translate-x, 0px), calc(var(--media-range-track-translate-y, 0px) - 50%));
      background: var(--media-range-track-background, #333);
    }

    #pointer {
      min-width: auto;
      background: var(--media-range-track-pointer-background);
      border-right: var(--media-range-track-pointer-border-right);
      transition: visibility .25s, opacity .25s;
      visibility: hidden;
      opacity: 0;
    }

    :host(:hover) #pointer {
      transition: visibility .5s, opacity .5s;
      visibility: visible;
      opacity: 1;
    }

    #hoverzone {
      
      z-index: 1;
      display: var(--media-time-range-hover-display, none);
      position: absolute;
      width: 100%;
      bottom: var(--media-time-range-hover-bottom, -5px);
      height: var(--media-time-range-hover-height, max(calc(100% + 5px), 20px));
    }

    #range {
      z-index: 2;
      position: relative;
      height: var(--media-range-track-height, 4px);
    }

    
    :host-context([media-keyboard-control]):host(:focus),
    :host-context([media-keyboard-control]):host(:focus-within) {
      box-shadow: inset 0 0 0 2px rgba(27, 127, 204, 0.9);
    }
    :host-context([media-keyboard-control]) input[type=range]:focus-visible {
      box-shadow: none;
    }
    input[type=range]:focus-visible {
      box-shadow: inset 0 0 0 2px rgba(27, 127, 204, 0.9);
    }
    input[type=range]:focus {
      outline: 0;
    }
    input[type=range]:focus::-webkit-slider-runnable-track {
      outline: 0;
    }

    input[type=range]:disabled::-webkit-slider-thumb {
      background-color: #777;
    }

    input[type=range]:disabled::-webkit-slider-runnable-track {
      background-color: #777;
    }
  </style>
  <div id="container">
    <div id="background"></div>
    <div id="pointer"></div>
    <div id="hoverzone"></div>
    <input id="range" type="range" min="0" max="1000" step="any" value="0">
  </div>
`;var da=class extends ie.HTMLElement{constructor(){super(),zd(this,ua,void 0),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Bo.content.cloneNode(!0)),this.container=this.shadowRoot.querySelector("#container"),this.range=this.shadowRoot.querySelector("#range"),this.range.addEventListener("input",this.updateBar.bind(this)),Xd(this,ua,parseInt(getComputedStyle(this).getPropertyValue("--media-range-thumb-width")||"10",10))}static get observedAttributes(){return["disabled","aria-disabled",xe.MEDIA_CONTROLLER]}attributeChangedCallback(e,r,a){var o,c;if(e===xe.MEDIA_CONTROLLER){if(r){let O=re.getElementById(r);(o=O==null?void 0:O.unassociateElement)==null||o.call(O,this)}if(a){let O=re.getElementById(a);(c=O==null?void 0:O.associateElement)==null||c.call(O,this)}}else(e==="disabled"||e==="aria-disabled"&&r!==a)&&(a==null?this.range.removeAttribute(e):this.range.setAttribute(e,a))}connectedCallback(){var e;let r=this.getAttribute(xe.MEDIA_CONTROLLER);if(r){let a=re.getElementById(r);(e=a==null?void 0:a.associateElement)==null||e.call(a,this)}this.updateBar()}disconnectedCallback(){var e;let r=this.getAttribute(xe.MEDIA_CONTROLLER);if(r){let a=re.getElementById(r);(e=a==null?void 0:a.unassociateElement)==null||e.call(a,this)}}updatePointerBar(e){let r=this.range.getBoundingClientRect(),a=(e.clientX-r.left)/r.width;a=Math.max(0,Math.min(1,a));let{style:o}=Qt(this.shadowRoot,"#pointer");o.setProperty("width",`${a*r.width}px`)}updateBar(){let e=this.getBarColors(),r="linear-gradient(to right, ",a=0;e.forEach(c=>{c[1]<a||(r=r+`${c[0]} ${a}%, ${c[0]} ${c[1]}%,`,a=c[1])}),r=r.slice(0,r.length-1)+")";let{style:o}=Qt(this.shadowRoot,"#range");o.setProperty("--media-range-track-progress-internal",r)}getBarColors(){let e=this.range,r=e.value-e.min,a=e.max-e.min,o=r/a*100,c=0;return e.value>e.min&&e.value<e.max&&(c=Yd(this,ua)*(.5-o/100)/e.offsetWidth*100),[["var(--media-range-bar-color, #fff)",o+c],["transparent",100]]}get keysUsed(){return["ArrowUp","ArrowRight","ArrowDown","ArrowLeft"]}};ua=new WeakMap;ce("media-chrome-range",da);var Ei=da;var Fo=re.createElement("template");Fo.innerHTML=`
  <style>
    :host {
      
      box-sizing: border-box;
      display: inline-flex;
      color: var(--media-icon-color, #eee);
      --media-loading-icon-width: 44px;
    }

    media-time-range,
    ::slotted(media-time-range),
    ::slotted(media-progress-range),
    ::slotted(media-clip-selector) {
      flex-grow: 1;
    }
  </style>

  <slot></slot>
`;var Cn=class extends ie.HTMLElement{static get observedAttributes(){return[xe.MEDIA_CONTROLLER]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Fo.content.cloneNode(!0))}attributeChangedCallback(e,r,a){var o,c;if(e===xe.MEDIA_CONTROLLER){if(r){let O=re.getElementById(r);(o=O==null?void 0:O.unassociateElement)==null||o.call(O,this)}if(a){let O=re.getElementById(a);(c=O==null?void 0:O.associateElement)==null||c.call(O,this)}}}connectedCallback(){var e;let r=this.getAttribute(xe.MEDIA_CONTROLLER);if(r){let a=re.getElementById(r);(e=a==null?void 0:a.associateElement)==null||e.call(a,this)}}disconnectedCallback(){var e;let r=this.getAttribute(xe.MEDIA_CONTROLLER);if(r){let a=re.getElementById(r);(e=a==null?void 0:a.unassociateElement)==null||e.call(a,this)}}};ce("media-control-bar",Cn);var Ko=re.createElement("template");Ko.innerHTML=`
  <style>
    :host {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      vertical-align: middle;
      box-sizing: border-box;
      background: var(--media-control-background, rgba(20,20,30, 0.7));
  
      padding: var(--media-control-padding, 10px);

      font-size: 14px;
      line-height: var(--media-text-content-height, var(--media-control-height, 24px));
      font-family: Arial, sans-serif;
      text-align: center;
      color: #ffffff;
      pointer-events: auto;
    }

    
    :host(:focus-visible) {
      box-shadow: inset 0 0 0 2px rgba(27, 127, 204, 0.9);
      outline: 0;
    }

    
    :host(:where(:focus)) {
      box-shadow: none;
      outline: 0;
    }
  </style>
  <span id="container">
  <slot></slot>
  </span>
`;var ca=class extends ie.HTMLElement{static get observedAttributes(){return[xe.MEDIA_CONTROLLER]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Ko.content.cloneNode(!0)),this.container=this.shadowRoot.querySelector("#container")}attributeChangedCallback(e,r,a){var o,c;if(e===xe.MEDIA_CONTROLLER){if(r){let O=re.getElementById(r);(o=O==null?void 0:O.unassociateElement)==null||o.call(O,this)}if(a){let O=re.getElementById(a);(c=O==null?void 0:O.associateElement)==null||c.call(O,this)}}}connectedCallback(){var e;let r=this.getAttribute(xe.MEDIA_CONTROLLER);if(r){let a=re.getElementById(r);(e=a==null?void 0:a.associateElement)==null||e.call(a,this)}}disconnectedCallback(){var e;let r=this.getAttribute(xe.MEDIA_CONTROLLER);if(r){let a=re.getElementById(r);(e=a==null?void 0:a.unassociateElement)==null||e.call(a,this)}}};ce("media-text-display",ca);var sr=ca;var On=class extends sr{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_CURRENT_TIME]}attributeChangedCallback(e,r,a){e===V.MEDIA_CURRENT_TIME&&(this.container.innerHTML=Yt(a)),super.attributeChangedCallback(e,r,a)}};ce("media-current-time-display",On);var Pn=class extends sr{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_DURATION]}attributeChangedCallback(e,r,a){e===V.MEDIA_DURATION&&(this.container.innerHTML=Yt(a)),super.attributeChangedCallback(e,r,a)}};ce("media-duration-display",Pn);var Qd="&nbsp;/&nbsp;",Zd=(t,{timesSep:e=Qd}={})=>{var r,a,o;let c=t.getAttribute("remaining")!=null,O=t.getAttribute("show-duration")!=null,C=(r=t.mediaCurrentTime)!=null?r:0,M=(o=(a=t.mediaDuration)!=null?a:t.mediaSeekableEnd)!=null?o:0,D=c?Yt(0-(M-C)):Yt(C);return O?`${D}${e}${Yt(M)}`:D},Jd="video not loaded, unknown time.",qd=t=>{let e=t.mediaCurrentTime,r=t.mediaDuration||t.mediaSeekableEnd;if(e==null||r==null){t.setAttribute("aria-valuetext",Jd);return}let a=t.hasAttribute("remaining"),o=t.hasAttribute("show-duration"),c=a?br(0-(r-e)):br(e);if(!o){t.setAttribute("aria-valuetext",c);return}let O=br(r),C=`${c} of ${O}`;t.setAttribute("aria-valuetext",C)},kn=class extends sr{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_CURRENT_TIME,V.MEDIA_DURATION,V.MEDIA_SEEKABLE,"remaining","show-duration","disabled"]}constructor(){super()}connectedCallback(){this.hasAttribute("disabled")||this.enable(),this.setAttribute("role","progressbar"),this.setAttribute("aria-label",ut.PLAYBACK_TIME()),super.connectedCallback()}disconnectedCallback(){this.disable()}attributeChangedCallback(e,r,a){if([V.MEDIA_CURRENT_TIME,V.MEDIA_DURATION,V.MEDIA_SEEKABLE,"remaining","show-duration"].includes(e)){let o=Zd(this);qd(this),this.container.innerHTML=o}else e==="disabled"&&a!==r&&(a==null?this.enable():this.disable());super.attributeChangedCallback(e,r,a)}enable(){this.setAttribute("tabindex",0)}disable(){this.removeAttribute("tabindex")}get mediaDuration(){let e=this.getAttribute(V.MEDIA_DURATION);return e!=null?+e:void 0}get mediaCurrentTime(){let e=this.getAttribute(V.MEDIA_CURRENT_TIME);return e!=null?+e:void 0}get mediaSeekable(){let e=this.getAttribute(V.MEDIA_SEEKABLE);if(!!e)return e.split(":").map(r=>+r)}get mediaSeekableEnd(){var e;let[,r]=(e=this.mediaSeekable)!=null?e:[];return r}get mediaSeekableStart(){var e;let[r]=(e=this.mediaSeekable)!=null?e:[];return r}};ce("media-time-display",kn);var ec=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M22.83 5.68a2.58 2.58 0 0 0-2.3-2.5c-3.62-.24-11.44-.24-15.06 0a2.58 2.58 0 0 0-2.3 2.5c-.23 4.21-.23 8.43 0 12.64a2.58 2.58 0 0 0 2.3 2.5c3.62.24 11.44.24 15.06 0a2.58 2.58 0 0 0 2.3-2.5c.23-4.21.23-8.43 0-12.64Zm-11.39 9.45a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.92 3.92 0 0 1 .92-2.77 3.18 3.18 0 0 1 2.43-1 2.94 2.94 0 0 1 2.13.78c.364.359.62.813.74 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.17 1.61 1.61 0 0 0-1.29.58 2.79 2.79 0 0 0-.5 1.89 3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.48 1.48 0 0 0 1-.37 2.1 2.1 0 0 0 .59-1.14l1.4.44a3.23 3.23 0 0 1-1.07 1.69Zm7.22 0a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.88 3.88 0 0 1 .93-2.77 3.14 3.14 0 0 1 2.42-1 3 3 0 0 1 2.16.82 2.8 2.8 0 0 1 .73 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.21 1.61 1.61 0 0 0-1.29.58A2.79 2.79 0 0 0 15 12a3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.44 1.44 0 0 0 1-.37 2.1 2.1 0 0 0 .6-1.15l1.4.44a3.17 3.17 0 0 1-1.1 1.7Z"/>
</svg>`,tc=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M17.73 14.09a1.4 1.4 0 0 1-1 .37 1.579 1.579 0 0 1-1.27-.58A3 3 0 0 1 15 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34A2.89 2.89 0 0 0 19 9.07a3 3 0 0 0-2.14-.78 3.14 3.14 0 0 0-2.42 1 3.91 3.91 0 0 0-.93 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.17 3.17 0 0 0 1.07-1.74l-1.4-.45c-.083.43-.3.822-.62 1.12Zm-7.22 0a1.43 1.43 0 0 1-1 .37 1.58 1.58 0 0 1-1.27-.58A3 3 0 0 1 7.76 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34a2.81 2.81 0 0 0-.74-1.32 2.94 2.94 0 0 0-2.13-.78 3.18 3.18 0 0 0-2.43 1 4 4 0 0 0-.92 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.23 3.23 0 0 0 1.07-1.74l-1.4-.45a2.06 2.06 0 0 1-.6 1.07Zm12.32-8.41a2.59 2.59 0 0 0-2.3-2.51C18.72 3.05 15.86 3 13 3c-2.86 0-5.72.05-7.53.17a2.59 2.59 0 0 0-2.3 2.51c-.23 4.207-.23 8.423 0 12.63a2.57 2.57 0 0 0 2.3 2.5c1.81.13 4.67.19 7.53.19 2.86 0 5.72-.06 7.53-.19a2.57 2.57 0 0 0 2.3-2.5c.23-4.207.23-8.423 0-12.63Zm-1.49 12.53a1.11 1.11 0 0 1-.91 1.11c-1.67.11-4.45.18-7.43.18-2.98 0-5.76-.07-7.43-.18a1.11 1.11 0 0 1-.91-1.11c-.21-4.14-.21-8.29 0-12.43a1.11 1.11 0 0 1 .91-1.11C7.24 4.56 10 4.49 13 4.49s5.76.07 7.43.18a1.11 1.11 0 0 1 .91 1.11c.21 4.14.21 8.29 0 12.43Z"/>
</svg>`,Ho=re.createElement("template");Ho.innerHTML=`
  <style>
  :host([aria-checked="true"]) slot:not([name=on]) > *,
  :host([aria-checked="true"]) ::slotted(:not([slot=on])) {
    display: none !important;
  }

  
  :host(:not([aria-checked="true"])) slot:not([name=off]) > *, 
  :host(:not([aria-checked="true"])) ::slotted(:not([slot=off])) {
    display: none !important;
  }
  </style>

  <slot name="on">${ec}</slot>
  <slot name="off">${tc}</slot>
`;var Wo=t=>{t.setAttribute("aria-checked",Sn(t))},wn=class extends Qe{static get observedAttributes(){return[...super.observedAttributes,"no-subtitles-fallback","default-showing",V.MEDIA_CAPTIONS_LIST,V.MEDIA_CAPTIONS_SHOWING,V.MEDIA_SUBTITLES_LIST,V.MEDIA_SUBTITLES_SHOWING]}constructor(e={}){super({slotTemplate:Ho,...e}),this._captionsReady=!1}connectedCallback(){super.connectedCallback(),this.setAttribute("role","switch"),this.setAttribute("aria-label",ut.CLOSED_CAPTIONS()),Wo(this)}attributeChangedCallback(e,r,a){if([V.MEDIA_CAPTIONS_SHOWING,V.MEDIA_SUBTITLES_SHOWING].includes(e)&&Wo(this),this.hasAttribute("default-showing")&&this.getAttribute("aria-checked")!=="true"){let o=!this.hasAttribute("no-subtitles-fallback");if((o?[V.MEDIA_CAPTIONS_LIST,V.MEDIA_SUBTITLES_LIST]:[V.MEDIA_CAPTIONS_LIST]).includes(e)){let O=!!this.getAttribute(V.MEDIA_CAPTIONS_LIST)||!!(o&&this.getAttribute(V.MEDIA_SUBTITLES_LIST));this._captionsReady!==O&&(this._captionsReady=O,this._captionsReady&&this.handleClick())}}super.attributeChangedCallback(e,r,a)}handleClick(){ia(this)}};ce("media-captions-button",wn);var Un="30",rc=`<svg aria-hidden="true" viewBox="0 0 20 24"><defs><style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style></defs><text class="text value" transform="translate(8.9 19.87)">${Un}</text><path d="M10 6V3l5.61 4L10 10.94V8a5.54 5.54 0 0 0-1.9 10.48v2.12A7.5 7.5 0 0 1 10 6Z"/></svg>`,Vo=re.createElement("template");Vo.innerHTML=`  
  <slot name="forward">${rc}</slot>
`;var ic=0,Go=t=>{let e=Math.abs(+t.getAttribute("seek-offset")),r=Xe.SEEK_FORWARD_N_SECS({seekOffset:e});t.setAttribute("aria-label",r)},jo=t=>{let e=ea(t,"forward"),r=t.getAttribute("seek-offset");qi(e,r)},Nn=class extends Qe{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_CURRENT_TIME,"seek-offset"]}constructor(e={}){super({slotTemplate:Vo,...e})}connectedCallback(){this.hasAttribute("seek-offset")||this.setAttribute("seek-offset",Un),Go(this),jo(this),super.connectedCallback()}attributeChangedCallback(e,r,a){e==="seek-offset"&&(a==null&&this.setAttribute("seek-offset",Un),jo(this),Go(this)),super.attributeChangedCallback(e,r,a)}handleClick(){let e=this.getAttribute(V.MEDIA_CURRENT_TIME),r=+this.getAttribute("seek-offset"),o=(e&&!Number.isNaN(+e)?+e:ic)+r,c=new ie.CustomEvent(fe.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:o});this.dispatchEvent(c)}};ce("media-seek-forward-button",Nn);var ac=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M16 3v2.5h3.5V9H22V3h-6ZM4 9h2.5V5.5H10V3H4v6Zm15.5 9.5H16V21h6v-6h-2.5v3.5ZM6.5 15H4v6h6v-2.5H6.5V15Z"/>
</svg>`,nc=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M18.5 6.5V3H16v6h6V6.5h-3.5ZM16 21h2.5v-3.5H22V15h-6v6ZM4 17.5h3.5V21H10v-6H4v2.5Zm3.5-11H4V9h6V3H7.5v3.5Z"/>
</svg>`,Yo=re.createElement("template");Yo.innerHTML=`
  <style>
  :host([${V.MEDIA_IS_FULLSCREEN}]) slot:not([name=exit]) > *,
  :host([${V.MEDIA_IS_FULLSCREEN}]) ::slotted(:not([slot=exit])) {
    display: none !important;
  }

  
  :host(:not([${V.MEDIA_IS_FULLSCREEN}])) slot:not([name=enter]) > *,
  :host(:not([${V.MEDIA_IS_FULLSCREEN}])) ::slotted(:not([slot=enter])) {
    display: none !important;
  }
  </style>

  <slot name="enter">${ac}</slot>
  <slot name="exit">${nc}</slot>
`;var $o=t=>{let r=t.getAttribute(V.MEDIA_IS_FULLSCREEN)!=null?Xe.EXIT_FULLSCREEN():Xe.ENTER_FULLSCREEN();t.setAttribute("aria-label",r)},Bn=class extends Qe{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_IS_FULLSCREEN,V.MEDIA_FULLSCREEN_UNAVAILABLE]}constructor(e={}){super({slotTemplate:Yo,...e})}connectedCallback(){$o(this),super.connectedCallback()}attributeChangedCallback(e,r,a){e===V.MEDIA_IS_FULLSCREEN&&$o(this),super.attributeChangedCallback(e,r,a)}handleClick(){let e=this.getAttribute(V.MEDIA_IS_FULLSCREEN)!=null?fe.MEDIA_EXIT_FULLSCREEN_REQUEST:fe.MEDIA_ENTER_FULLSCREEN_REQUEST;this.dispatchEvent(new ie.CustomEvent(e,{composed:!0,bubbles:!0}))}};ce("media-fullscreen-button",Bn);var sc=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M16.5 12A4.5 4.5 0 0 0 14 8v2.18l2.45 2.45a4.22 4.22 0 0 0 .05-.63Zm2.5 0a6.84 6.84 0 0 1-.54 2.64L20 16.15A8.8 8.8 0 0 0 21 12a9 9 0 0 0-7-8.77v2.06A7 7 0 0 1 19 12ZM4.27 3 3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25A6.92 6.92 0 0 1 14 18.7v2.06A9 9 0 0 0 17.69 19l2 2.05L21 19.73l-9-9L4.27 3ZM12 4 9.91 6.09 12 8.18V4Z"/>
</svg>`,zo=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M3 9v6h4l5 5V4L7 9H3Zm13.5 3A4.5 4.5 0 0 0 14 8v8a4.47 4.47 0 0 0 2.5-4Z"/>
</svg>`,oc=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M3 9v6h4l5 5V4L7 9H3Zm13.5 3A4.5 4.5 0 0 0 14 8v8a4.47 4.47 0 0 0 2.5-4ZM14 3.23v2.06a7 7 0 0 1 0 13.42v2.06a9 9 0 0 0 0-17.54Z"/>
</svg>`,Qo=re.createElement("template");Qo.innerHTML=`
  <style>
  
  :host(:not([${V.MEDIA_VOLUME_LEVEL}])) slot:not([name=high]) > *, 
  :host(:not([${V.MEDIA_VOLUME_LEVEL}])) ::slotted(:not([slot=high])),
  :host([${V.MEDIA_VOLUME_LEVEL}=high]) slot:not([name=high]) > *, 
  :host([${V.MEDIA_VOLUME_LEVEL}=high]) ::slotted(:not([slot=high])) {
    display: none !important;
  }

  :host([${V.MEDIA_VOLUME_LEVEL}=off]) slot:not([name=off]) > *, 
  :host([${V.MEDIA_VOLUME_LEVEL}=off]) ::slotted(:not([slot=off])) {
    display: none !important;
  }

  :host([${V.MEDIA_VOLUME_LEVEL}=low]) slot:not([name=low]) > *, 
  :host([${V.MEDIA_VOLUME_LEVEL}=low]) ::slotted(:not([slot=low])) {
    display: none !important;
  }

  :host([${V.MEDIA_VOLUME_LEVEL}=medium]) slot:not([name=medium]) > *, 
  :host([${V.MEDIA_VOLUME_LEVEL}=medium]) ::slotted(:not([slot=medium])) {
    display: none !important;
  }
  </style>

  <slot name="off">${sc}</slot>
  <slot name="low">${zo}</slot>
  <slot name="medium">${zo}</slot>
  <slot name="high">${oc}</slot>
`;var Xo=t=>{let r=t.getAttribute(V.MEDIA_VOLUME_LEVEL)==="off"?Xe.UNMUTE():Xe.MUTE();t.setAttribute("aria-label",r)},Fn=class extends Qe{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_VOLUME_LEVEL]}constructor(e={}){super({slotTemplate:Qo,...e})}connectedCallback(){Xo(this),super.connectedCallback()}attributeChangedCallback(e,r,a){e===V.MEDIA_VOLUME_LEVEL&&Xo(this),super.attributeChangedCallback(e,r,a)}handleClick(){let e=this.getAttribute(V.MEDIA_VOLUME_LEVEL)==="off"?fe.MEDIA_UNMUTE_REQUEST:fe.MEDIA_MUTE_REQUEST;this.dispatchEvent(new ie.CustomEvent(e,{composed:!0,bubbles:!0}))}};ce("media-mute-button",Fn);var Zo=`<svg aria-hidden="true" viewBox="0 0 28 24">
  <path d="M24 3H4a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h20a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1Zm-1 16H5V5h18v14Zm-3-8h-7v5h7v-5Z"/>
</svg>`,qo=re.createElement("template");qo.innerHTML=`
  <style>
  :host([${V.MEDIA_IS_PIP}]) slot:not([name=exit]) > *, 
  :host([${V.MEDIA_IS_PIP}]) ::slotted(:not([slot=exit])) {
    display: none !important;
  }

  
  :host(:not([${V.MEDIA_IS_PIP}])) slot:not([name=enter]) > *, 
  :host(:not([${V.MEDIA_IS_PIP}])) ::slotted(:not([slot=enter])) {
    display: none !important;
  }
  </style>

  <slot name="enter">${Zo}</slot>
  <slot name="exit">${Zo}</slot>
`;var Jo=t=>{let r=t.getAttribute(V.MEDIA_IS_PIP)!=null?Xe.EXIT_PIP():Xe.ENTER_PIP();t.setAttribute("aria-label",r)},Kn=class extends Qe{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_IS_PIP,V.MEDIA_PIP_UNAVAILABLE]}constructor(e={}){super({slotTemplate:qo,...e})}connectedCallback(){Jo(this),super.connectedCallback()}attributeChangedCallback(e,r,a){e===V.MEDIA_IS_PIP&&Jo(this),super.attributeChangedCallback(e,r,a)}handleClick(){let e=this.getAttribute(V.MEDIA_IS_PIP)!=null?fe.MEDIA_EXIT_PIP_REQUEST:fe.MEDIA_ENTER_PIP_REQUEST;this.dispatchEvent(new ie.CustomEvent(e,{composed:!0,bubbles:!0}))}};ce("media-pip-button",Kn);var lc=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="m6 21 15-9L6 3v18Z"/>
</svg>`,uc=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M6 20h4V4H6v16Zm8-16v16h4V4h-4Z"/>
</svg>`,tl=re.createElement("template");tl.innerHTML=`
  <style>
  :host([${V.MEDIA_PAUSED}]) slot[name=pause] > *, 
  :host([${V.MEDIA_PAUSED}]) ::slotted([slot=pause]) {
    display: none !important;
  }

  :host(:not([${V.MEDIA_PAUSED}])) slot[name=play] > *, 
  :host(:not([${V.MEDIA_PAUSED}])) ::slotted([slot=play]) {
    display: none !important;
  }
  </style>

  <slot name="play">${lc}</slot>
  <slot name="pause">${uc}</slot>
`;var el=t=>{let r=t.getAttribute(V.MEDIA_PAUSED)!=null?Xe.PLAY():Xe.PAUSE();t.setAttribute("aria-label",r)},Wn=class extends Qe{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_PAUSED]}constructor(e={}){super({slotTemplate:tl,...e})}connectedCallback(){el(this),super.connectedCallback()}attributeChangedCallback(e,r,a){e===V.MEDIA_PAUSED&&el(this),super.attributeChangedCallback(e,r,a)}handleClick(){let e=this.getAttribute(V.MEDIA_PAUSED)!=null?fe.MEDIA_PLAY_REQUEST:fe.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new ie.CustomEvent(e,{composed:!0,bubbles:!0}))}};ce("media-play-button",Wn);var rl=[1,1.25,1.5,1.75,2],fa=1,il=re.createElement("template");il.innerHTML=`
  <span id="container"></span>
`;var Hn=class extends Qe{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_PLAYBACK_RATE,"rates"]}constructor(e={}){super({slotTemplate:il,...e}),this._rates=rl,this.container=this.shadowRoot.querySelector("#container"),this.container.innerHTML=`${fa}x`}attributeChangedCallback(e,r,a){if(e==="rates"){let o=(a!=null?a:"").trim().split(/\s*,?\s+/).map(c=>Number(c)).filter(c=>!Number.isNaN(c)).sort((c,O)=>c-O);this._rates=o.length?o:rl;return}if(e===V.MEDIA_PLAYBACK_RATE){let o=a?+a:Number.NaN,c=Number.isNaN(o)?fa:o;this.container.innerHTML=`${c}x`,this.setAttribute("aria-label",ut.PLAYBACK_RATE({playbackRate:c}));return}super.attributeChangedCallback(e,r,a)}handleClick(){var e,r;let a=+this.getAttribute(V.MEDIA_PLAYBACK_RATE)||fa,o=(r=(e=this._rates.find(O=>O>a))!=null?e:this._rates[0])!=null?r:fa,c=new ie.CustomEvent(fe.MEDIA_PLAYBACK_RATE_REQUEST,{composed:!0,bubbles:!0,detail:o});this.dispatchEvent(c)}};ce("media-playback-rate-button",Hn);var al=re.createElement("template");al.innerHTML=`
  <style>
    :host {
      pointer-events: none;
      display: inline-block;
      box-sizing: border-box;
    }

    img {
      max-width: 100%;
      max-height: 100%;
      min-width: 100%;
      min-height: 100%;
      background-repeat: no-repeat;
      background-position: var(--media-background-position, var(--media-object-position, center));
      background-size: var(--media-background-size, var(--media-object-fit, contain));
      object-fit: var(--media-object-fit, contain);
      object-position: var(--media-object-position, center);
    }

    :host([${V.MEDIA_HAS_PLAYED}]) img {
      display: none;
    }
  </style>

  <img aria-hidden="true" id="image"/>
`;var dc=t=>{t.style.removeProperty("background-image")},cc=(t,e)=>{t.style["background-image"]=`url('${e}')`},Gn=class extends ie.HTMLElement{static get observedAttributes(){return[V.MEDIA_HAS_PLAYED,"placeholder-src","src"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(al.content.cloneNode(!0)),this.image=this.shadowRoot.querySelector("#image")}attributeChangedCallback(e,r,a){e==="src"&&(a==null?this.image.removeAttribute("src"):this.image.setAttribute("src",a)),e==="placeholder-src"&&(a==null?dc(this.image):cc(this.image,a))}};ce("media-poster-image",Gn);var Xn=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},nt=(t,e,r)=>(Xn(t,e,"read from private field"),r?r.call(t):e.get(t)),bt=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},or=(t,e,r,a)=>(Xn(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),yi=(t,e,r)=>(Xn(t,e,"access private method"),r),Ti,ha,bi,pa,Ea,va,Vn,ma,Gr,Ai,$n,ya,ba,ga,Yn,zn,nl,fc="video not loaded, unknown time.",jn=t=>{let e=t.range,r=br(+e.value),a=br(+e.max),o=r&&a?`${r} of ${a}`:fc;e.setAttribute("aria-valuetext",o)},sl=re.createElement("template");sl.innerHTML=`
  <style>
    :host {
      --media-preview-background-color: rgba(20,20,30, .5);
      --media-preview-background: var(--media-control-background,
        var(--media-preview-background-color));
      --media-preview-border-radius: 3px;
      --media-box-padding-left: 10px;
      --media-box-padding-right: 10px;
      color: #fff;
    }

    #preview-rail,
    #current-rail {
      
      width: 1%;
      position: absolute;
      left: 0;
      bottom: 100%;
      pointer-events: none;
    }

    [part~="box"] {
      
      position: absolute;
      bottom: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      transform: translateX(-50%);
    }

    [part~="preview-box"] {
      transition: visibility .25s, opacity .25s;
      visibility: hidden;
      opacity: 0;
    }

    media-preview-thumbnail,
    ::slotted(media-preview-thumbnail) {
      visibility: hidden;
      transition: visibility 0s .25s;
      background: var(--media-preview-time-background, var(--media-preview-background));
      box-shadow: var(--media-preview-thumbnail-box-shadow, 0 0 4px rgba(0,0,0, .2));
      max-width: var(--media-preview-thumbnail-max-width, 180px);
      max-height: var(--media-preview-thumbnail-max-height, 160px);
      min-width: var(--media-preview-thumbnail-min-width, 120px);
      min-height: var(--media-preview-thumbnail-min-height, 80px);
      border: var(--media-preview-thumbnail-border);
      border-radius: var(--media-preview-thumbnail-border-radius,
        var(--media-preview-border-radius) var(--media-preview-border-radius) 0 0);
    }

    :host([${V.MEDIA_PREVIEW_IMAGE}]:hover) media-preview-thumbnail,
    :host([${V.MEDIA_PREVIEW_IMAGE}]:hover) ::slotted(media-preview-thumbnail) {
      transition-delay: 0s;
      visibility: visible;
    }

    media-preview-time-display,
    ::slotted(media-preview-time-display) {
      color: unset;
      min-width: 0;
      
      transition: min-width 0s .25s, border-radius 0s .25s;
      background: var(--media-preview-time-background, var(--media-preview-background));
      border-radius: var(--media-preview-time-border-radius,
        var(--media-preview-border-radius) var(--media-preview-border-radius)
        var(--media-preview-border-radius) var(--media-preview-border-radius));
      padding: var(--media-preview-time-padding, 1px 10px 0);
      margin: var(--media-preview-time-margin, 0 0 10px);
      text-shadow: var(--media-preview-time-text-shadow, 0 0 4px rgba(0,0,0, .75));
    }

    :host([${V.MEDIA_PREVIEW_IMAGE}]) media-preview-time-display,
    :host([${V.MEDIA_PREVIEW_IMAGE}]) ::slotted(media-preview-time-display) {
      transition-delay: 0s;
      min-width: 100%;
      border-radius: var(--media-preview-time-border-radius,
        0 0 var(--media-preview-border-radius) var(--media-preview-border-radius));
    }

    :host([${V.MEDIA_PREVIEW_IMAGE}]:hover) [part~="preview-box"],
    :host([${V.MEDIA_PREVIEW_TIME}]:hover) [part~="preview-box"] {
      transition: visibility .5s, opacity .5s;
      visibility: visible;
      opacity: 1;
    }

    :host([${V.MEDIA_PREVIEW_TIME}]:hover) {
      --media-time-range-hover-display: block;
    }
  </style>
  <div id="preview-rail">
    <slot name="preview" part="box preview-box">
      <media-preview-thumbnail></media-preview-thumbnail>
      <media-preview-time-display></media-preview-time-display>
    </slot>
  </div>
  <div id="current-rail">
    <slot name="current" part="box current-box">
      
    </slot>
  </div>
`;var Ta=class extends Ei{constructor(){super(),bt(this,va),bt(this,ga),bt(this,zn),bt(this,Ti,void 0),bt(this,ha,void 0),bt(this,bi,void 0),bt(this,pa,void 0),bt(this,Ea,void 0),bt(this,ma,r=>{if([...nt(this,Ti)].some(A=>r.composedPath().includes(A)))return;this.updatePointerBar(r);let a=+this.getAttribute(V.MEDIA_DURATION);if(!a)return;let o=this.range.getBoundingClientRect(),c=(r.clientX-o.left)/o.width;c=Math.max(0,Math.min(1,c));let O=yi(this,va,Vn).call(this,nt(this,ha),c),{style:C}=Qt(this.shadowRoot,"#preview-rail");C.transform=`translateX(${O})`;let M=c*a,D=new ie.CustomEvent(fe.MEDIA_PREVIEW_REQUEST,{composed:!0,bubbles:!0,detail:M});this.dispatchEvent(D)}),bt(this,Gr,!1),bt(this,Ai,r=>{(!r.composedPath().includes(this)||[...nt(this,Ti)].some(a=>r.composedPath().includes(a)))&&(ie.removeEventListener("pointermove",nt(this,Ai)),or(this,Gr,!1),nt(this,ya).call(this))}),bt(this,$n,()=>{ie.addEventListener("pointermove",nt(this,ma),!1)}),bt(this,ya,()=>{ie.removeEventListener("pointermove",nt(this,ma));let r=new ie.CustomEvent(fe.MEDIA_PREVIEW_REQUEST,{composed:!0,bubbles:!0,detail:null});this.dispatchEvent(r)}),bt(this,ba,()=>{let r=this.getAttribute(V.MEDIA_DURATION);!nt(this,Gr)&&r&&(or(this,Gr,!0),nt(this,$n).call(this),ie.addEventListener("pointermove",nt(this,Ai),!1))}),this.container.appendChild(sl.content.cloneNode(!0)),this.range.addEventListener("input",()=>{cancelAnimationFrame(this._refreshId);let a=this.range.value,o=new ie.CustomEvent(fe.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:a});this.dispatchEvent(o)}),this._refreshBar=()=>{let r=(performance.now()-this._updateTimestamp)/1e3;this.range.value=this.mediaCurrentTime+r*this.mediaPlaybackRate,this.updateBar(),this.updateCurrentBox(),this._refreshId=requestAnimationFrame(this._refreshBar)},or(this,Ti,this.shadowRoot.querySelectorAll('[part~="box"]')),or(this,ha,this.shadowRoot.querySelector('[part~="preview-box"]')),or(this,bi,this.shadowRoot.querySelector('[part~="current-box"]'));let e=getComputedStyle(this);or(this,pa,parseInt(e.getPropertyValue("--media-box-padding-left"))),or(this,Ea,parseInt(e.getPropertyValue("--media-box-padding-right"))),yi(this,ga,Yn).call(this)}static get observedAttributes(){return[...super.observedAttributes,"thumbnails","disabled",V.MEDIA_PAUSED,V.MEDIA_DURATION,V.MEDIA_SEEKABLE,V.MEDIA_CURRENT_TIME,V.MEDIA_PREVIEW_IMAGE,V.MEDIA_PREVIEW_TIME,V.MEDIA_BUFFERED,V.MEDIA_PLAYBACK_RATE,V.MEDIA_LOADING]}connectedCallback(){this.range.setAttribute("aria-label",ut.SEEK()),super.connectedCallback()}disconnectedCallback(){cancelAnimationFrame(this._refreshId),super.disconnectedCallback()}attributeChangedCallback(e,r,a){var o,c,O,C,M;(e===V.MEDIA_CURRENT_TIME||e===V.MEDIA_PAUSED||e===V.MEDIA_LOADING)&&(this._updateTimestamp=performance.now(),this.range.value=this.mediaCurrentTime,jn(this),this.updateBar(),this.updateCurrentBox(),cancelAnimationFrame(this._refreshId),!this.mediaPaused&&!this.mediaLoading&&(this._refreshId=requestAnimationFrame(this._refreshBar))),e===V.MEDIA_DURATION&&(this.range.max=Math.floor((c=(o=this.mediaSeekableEnd)!=null?o:this.mediaDuration)!=null?c:1e3),jn(this),this.updateBar(),this.updateCurrentBox()),e===V.MEDIA_SEEKABLE&&(this.range.min=(O=this.mediaSeekableStart)!=null?O:0,this.range.max=Math.floor((M=(C=this.mediaSeekableEnd)!=null?C:this.mediaDuration)!=null?M:1e3),jn(this),this.updateBar()),e===V.MEDIA_BUFFERED&&this.updateBar(),e==="disabled"&&(a==null?yi(this,ga,Yn).call(this):yi(this,zn,nl).call(this)),super.attributeChangedCallback(e,r,a)}get mediaPaused(){return this.hasAttribute(V.MEDIA_PAUSED)}get mediaLoading(){return this.hasAttribute(V.MEDIA_LOADING)}get mediaDuration(){let e=this.getAttribute(V.MEDIA_DURATION);return e!=null?+e:void 0}get mediaCurrentTime(){let e=this.getAttribute(V.MEDIA_CURRENT_TIME);return e!=null?+e:void 0}get mediaPlaybackRate(){let e=this.getAttribute(V.MEDIA_PLAYBACK_RATE);return e!=null?+e:1}get mediaBuffered(){let e=this.getAttribute(V.MEDIA_BUFFERED);return e?e.split(" ").map(r=>r.split(":").map(a=>+a)):[]}get mediaSeekable(){let e=this.getAttribute(V.MEDIA_SEEKABLE);if(!!e)return e.split(":").map(r=>+r)}get mediaSeekableEnd(){var e;let[,r]=(e=this.mediaSeekable)!=null?e:[];return r}get mediaSeekableStart(){var e;let[r]=(e=this.mediaSeekable)!=null?e:[];return r}getBarColors(){var e;let r=super.getBarColors(),{range:a}=this,o=a.max-a.min,c=this.mediaBuffered;if(!c.length||!Number.isFinite(o)||o<=0)return r;let O=this.mediaCurrentTime,[,C=a.min]=(e=c.find(([A,_])=>A<=O&&O<=_))!=null?e:[],D=(C-a.min)/o*100;return r.splice(1,0,["var(--media-time-buffered-color, rgba(255,255,255, .4))",D]),r}updateCurrentBox(){if(!nt(this,bi).assignedElements().length)return;let e=this.range.value/(this.range.max-this.range.min),r=yi(this,va,Vn).call(this,nt(this,bi),e),{style:a}=Qt(this.shadowRoot,"#current-rail");a.transform=`translateX(${r})`}};Ti=new WeakMap;ha=new WeakMap;bi=new WeakMap;pa=new WeakMap;Ea=new WeakMap;va=new WeakSet;Vn=function(t,e){var r;let a=`${e*100*100}%`,o=t.offsetWidth;if(!o)return a;let c=(r=this.getAttribute("bounds")?ci(this,`#${this.getAttribute("bounds")}`):this.parentElement)!=null?r:this,O=this.range.getBoundingClientRect(),C=c.getBoundingClientRect(),M=(nt(this,pa)-(O.left-C.left-o/2))/O.width*100,D=(C.right-O.left-o/2-nt(this,Ea))/O.width*100;return Number.isNaN(M)||(a=`max(${M*100}%, ${a})`),Number.isNaN(D)||(a=`min(${a}, ${D*100}%)`),a};ma=new WeakMap;Gr=new WeakMap;Ai=new WeakMap;$n=new WeakMap;ya=new WeakMap;ba=new WeakMap;ga=new WeakSet;Yn=function(){this.addEventListener("pointermove",nt(this,ba),!1)};zn=new WeakSet;nl=function(){ie.removeEventListener("pointermove",nt(this,Ai)),this.removeEventListener("pointermove",nt(this,ba)),or(this,Gr,!1),nt(this,ya).call(this)};ce("media-time-range",Ta);var Qn=Ta;var Zn=class extends Qn{constructor(){super(),console.warn("MediaChrome: <media-progress-range> is deprecated. Use <media-time-range> instead.")}};ce("media-progress-range",Zn);var Jn="30",hc=`<svg aria-hidden="true" viewBox="0 0 20 24"><defs><style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style></defs><text class="text value" transform="translate(2.18 19.87)">${Jn}</text><path d="M10 6V3L4.37 7 10 10.94V8a5.54 5.54 0 0 1 1.9 10.48v2.12A7.5 7.5 0 0 0 10 6Z"/></svg>`,ul=re.createElement("template");ul.innerHTML=`  
  <slot name="backward">${hc}</slot>
`;var vc=0,ol=t=>{let e=Math.abs(+t.getAttribute("seek-offset")),r=Xe.SEEK_BACK_N_SECS({seekOffset:e});t.setAttribute("aria-label",r)},ll=t=>{let e=ea(t,"backward"),r=t.getAttribute("seek-offset");qi(e,r)},qn=class extends Qe{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_CURRENT_TIME]}constructor(e={}){super({slotTemplate:ul,...e})}connectedCallback(){this.hasAttribute("seek-offset")||this.setAttribute("seek-offset",Jn),ol(this),ll(this),super.connectedCallback()}attributeChangedCallback(e,r,a){e==="seek-offset"&&(a==null&&this.setAttribute("seek-offset",Jn),ll(this),ol(this)),super.attributeChangedCallback(e,r,a)}handleClick(){let e=this.getAttribute(V.MEDIA_CURRENT_TIME),r=+this.getAttribute("seek-offset"),a=e&&!Number.isNaN(+e)?+e:vc,o=Math.max(a-r,0),c=new ie.CustomEvent(fe.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:o});this.dispatchEvent(c)}};ce("media-seek-backward-button",qn);var es=class extends sr{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_PREVIEW_TIME]}attributeChangedCallback(e,r,a){e===V.MEDIA_PREVIEW_TIME&&a!=null&&(this.container.textContent=Yt(a)),super.attributeChangedCallback(e,r,a)}};ce("media-preview-time-display",es);var dl=re.createElement("template");dl.innerHTML=`
  <style>
    :host {
      box-sizing: border-box;
      display: inline-block;
      overflow: hidden;
    }

    img {
      display: none;
      position: relative;
    }
  </style>
  <img crossorigin loading="eager" decoding="async" />
`;var ts=class extends ie.HTMLElement{static get observedAttributes(){return[xe.MEDIA_CONTROLLER,"time",V.MEDIA_PREVIEW_IMAGE,V.MEDIA_PREVIEW_COORDS]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(dl.content.cloneNode(!0))}connectedCallback(){var e;let r=this.getAttribute(xe.MEDIA_CONTROLLER);if(r){let a=re.getElementById(r);(e=a==null?void 0:a.associateElement)==null||e.call(a,this)}}disconnectedCallback(){var e;let r=this.getAttribute(xe.MEDIA_CONTROLLER);if(r){let a=re.getElementById(r);(e=a==null?void 0:a.unassociateElement)==null||e.call(a,this)}}attributeChangedCallback(e,r,a){var o,c;if(["time",V.MEDIA_PREVIEW_IMAGE,V.MEDIA_PREVIEW_COORDS].includes(e)&&this.update(),e===xe.MEDIA_CONTROLLER){if(r){let O=re.getElementById(r);(o=O==null?void 0:O.unassociateElement)==null||o.call(O,this)}if(a){let O=re.getElementById(a);(c=O==null?void 0:O.associateElement)==null||c.call(O,this)}}}update(){let e=this.getAttribute(V.MEDIA_PREVIEW_COORDS),r=this.getAttribute(V.MEDIA_PREVIEW_IMAGE);if(!(e&&r))return;let[a,o,c,O]=e.split(/\s+/).map(s=>+s),C=r.split("#")[0],M=getComputedStyle(this),{maxWidth:D,maxHeight:A,minWidth:_,minHeight:I}=M,S=Math.min(parseInt(D)/c,parseInt(A)/O),T=Math.max(parseInt(_)/c,parseInt(I)/O),x=S<1,v=x?S:T>1?T:1,{style:i}=Qt(this.shadowRoot,":host"),u=Qt(this.shadowRoot,"img").style,p=this.shadowRoot.querySelector("img"),b=x?"min":"max";i.setProperty(`${b}-width`,"initial","important"),i.setProperty(`${b}-height`,"initial","important"),i.width=`${c*v}px`,i.height=`${O*v}px`;let l=()=>{u.width=`${this.imgWidth*v}px`,u.height=`${this.imgHeight*v}px`,u.display="block"};p.src!==C&&(p.onload=()=>{this.imgWidth=p.naturalWidth,this.imgHeight=p.naturalHeight,l()},p.src=C,l()),l(),u.transform=`translate(-${a*v}px, -${o*v}px)`}};ce("media-preview-thumbnail",ts);var cl=re.createElement("template"),mc=`
<svg aria-hidden="true" viewBox="0 0 100 100">
  <path d="M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50">
    <animateTransform
       attributeName="transform"
       attributeType="XML"
       type="rotate"
       dur="1s"
       from="0 50 50"
       to="360 50 50"
       repeatCount="indefinite" />
  </path>
</svg>
`;cl.innerHTML=`
<style>
:host {
  display: inline-block;
  vertical-align: middle;
  box-sizing: border-box;
}

#status {
  color: rgba(0,0,0,0);
  width: 0px;
  height: 0px;
}

:host slot[name=loading] > *,
:host ::slotted([slot=loading]) {
  opacity: 1;
  transition: opacity 0.15s;
}

:host(:not([is-loading])) slot[name=loading] > *, 
:host(:not([is-loading])) ::slotted([slot=loading]) {
  opacity: 0;
}

:host(:not([is-loading])) #status {
  display: none;
}

svg, img, ::slotted(svg), ::slotted(img) {
  width: var(--media-loading-icon-width, 100px);
  height: var(--media-loading-icon-height);
  fill: var(--media-icon-color, #fff);
  vertical-align: middle;
}
</style>

<slot name="loading">${mc}</slot>
<div id="status" role="status" aria-live="polite">${ut.MEDIA_LOADING()}</div>
`;var gc=500,rs=class extends ie.HTMLElement{static get observedAttributes(){return[xe.MEDIA_CONTROLLER,V.MEDIA_PAUSED,V.MEDIA_LOADING,"loading-delay"]}constructor(){super();let e=this.attachShadow({mode:"open"}),r=cl.content.cloneNode(!0);e.appendChild(r)}attributeChangedCallback(e,r,a){var o,c,O;if(e===V.MEDIA_LOADING||e===V.MEDIA_PAUSED){let C=this.getAttribute(V.MEDIA_PAUSED)!=null,M=this.getAttribute(V.MEDIA_LOADING)!=null,D=!C&&M;if(!D)this.loadingDelayHandle&&(clearTimeout(this.loadingDelayHandle),this.loadingDelayHandle=void 0),this.removeAttribute("is-loading");else if(!this.loadingDelayHandle&&D){let A=+((o=this.getAttribute("loading-delay"))!=null?o:gc);this.loadingDelayHandle=setTimeout(()=>{this.setAttribute("is-loading",""),this.loadingDelayHandle=void 0},A)}}else if(e===xe.MEDIA_CONTROLLER){if(r){let C=re.getElementById(r);(c=C==null?void 0:C.unassociateElement)==null||c.call(C,this)}if(a){let C=re.getElementById(a);(O=C==null?void 0:C.associateElement)==null||O.call(C,this)}}}connectedCallback(){var e;let r=this.getAttribute(xe.MEDIA_CONTROLLER);if(r){let a=re.getElementById(r);(e=a==null?void 0:a.associateElement)==null||e.call(a,this)}}disconnectedCallback(){var e;this.loadingDelayHandle&&(clearTimeout(this.loadingDelayHandle),this.loadingDelayHandle=void 0);let r=this.getAttribute(xe.MEDIA_CONTROLLER);if(r){let a=re.getElementById(r);(e=a==null?void 0:a.unassociateElement)==null||e.call(a,this)}}};ce("media-loading-indicator",rs);var fl=re.createElement("template");fl.innerHTML=`
  <style>
    :host {
    }
  </style>
  <slot></slot>
`;var is=class extends ie.HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(fl.content.cloneNode(!0))}};ce("media-title-bar",is);var pc=100,Ec=t=>{var e;if(t.getAttribute(V.MEDIA_MUTED)!=null)return 0;let a=+((e=t.getAttribute(V.MEDIA_VOLUME))!=null?e:1);return Math.round(a*t.range.max)},yc=({value:t,max:e})=>`${Math.round(t/e*100)}%`,as=class extends Ei{static get observedAttributes(){return[...super.observedAttributes,V.MEDIA_VOLUME,V.MEDIA_MUTED,V.MEDIA_VOLUME_UNAVAILABLE]}constructor(){super(),this.range.max=pc,this.range.addEventListener("input",()=>{let r=this.range.value/this.range.max,a=new ie.CustomEvent(fe.MEDIA_VOLUME_REQUEST,{composed:!0,bubbles:!0,detail:r});this.dispatchEvent(a)})}connectedCallback(){this.range.setAttribute("aria-label",ut.VOLUME()),super.connectedCallback()}attributeChangedCallback(e,r,a){if(e===V.MEDIA_VOLUME||e===V.MEDIA_MUTED){let o=Ec(this);this.range.value=o,this.range.setAttribute("aria-valuetext",yc(this.range)),this.updateBar()}super.attributeChangedCallback(e,r,a)}};ce("media-volume-range",as);var Tc=Object.defineProperty,bc=(t,e,r)=>e in t?Tc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ac=(t,e,r)=>(bc(t,typeof e!="symbol"?e+"":e,r),r),Aa=class extends ie.HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}render(){this.shadowRoot.textContent="";let e=re.createElement("template");e.innerHTML=this.constructor.template,this.shadowRoot.append(e.content.cloneNode(!0))}get mediaController(){return this.shadowRoot.querySelector("media-controller")}};Ac(Aa,"template","");ce("media-theme-base",Aa);var ns=class extends pi{};ie.customElements.get("media-chrome")||ie.customElements.define("media-chrome",ns);var ss=class extends pi{constructor(){super(),console.warn("MediaChrome: <media-container> is deprecated. Use <media-controller>.")}};ie.customElements.get("media-container")||ie.customElements.define("media-container",ss);var xa=Yi(hl(),1),Sr=Yi(Sa(),1),ds=Yi(Sa(),1),jr=Yi(Sa(),1),Si=class extends Error{constructor(t,e=Si.MEDIA_ERR_CUSTOM,r){var a;super(t),this.name="MediaError",this.code=e,this.fatal=r!=null?r:e>=Si.MEDIA_ERR_NETWORK&&e<=Si.MEDIA_ERR_ENCRYPTED,this.message||(this.message=(a=Si.defaultMessages[this.code])!=null?a:"")}},Ge=Si;Ge.MEDIA_ERR_ABORTED=1,Ge.MEDIA_ERR_NETWORK=2,Ge.MEDIA_ERR_DECODE=3,Ge.MEDIA_ERR_SRC_NOT_SUPPORTED=4,Ge.MEDIA_ERR_ENCRYPTED=5,Ge.MEDIA_ERR_CUSTOM=100,Ge.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail.",3:"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.",4:"An unsupported error occurred. The server or network failed, or your browser does not support this format.",5:"The media is encrypted and there are no keys to decrypt it."};var yl=(t,e)=>t in e,cs={ANY:"any",MUTED:"muted"},we={VOD:"on-demand",ON_DEMAND:"on-demand",LIVE:"live",LL_LIVE:"ll-live",DVR:"live:dvr",LL_DVR:"ll-live:dvr"},Ot={MSE:"mse",NATIVE:"native"},fs={HEADER:"header",QUERY:"query",NONE:"none"},$r=Object.values(fs),Vr={M3U8:"application/vnd.apple.mpegurl",MP4:"video/mp4"},hs={HLS:Vr.M3U8},Mp=Object.keys(hs),Cp=[...Object.values(Vr),"hls","HLS"],xi=(t,e,r,a)=>{t.addEventListener(e,r,a),t.addEventListener("teardown",()=>{t.removeEventListener(e,r)},{once:!0})};function _c(t,e,r){e&&r>e&&(r=e);for(let a=0;a<t.length;a++)if(t.start(a)<=r&&t.end(a)>=r)return!0;return!1}var Sc=t=>{let e=t.indexOf("?");if(e<0)return[t];let r=t.slice(0,e),a=t.slice(e);return[r,a]},Tl=t=>{let e=t.type;if(e){let a=e.toUpperCase();return yl(a,hs)?hs[a]:e}let{src:r}=t;return r?xc(r):""},xc=t=>{let e="";try{e=new URL(t).pathname}catch{console.error("invalid url")}let r=e.lastIndexOf(".");if(r<0)return"";let a=e.slice(r+1).toUpperCase();return yl(a,Vr)?Vr[a]:""},Dc=Object.values(cs),vl=t=>typeof t=="boolean"||typeof t=="string"&&Dc.includes(t),Lc=({autoplay:t},e,r)=>{let a=!1,o=!1,c=vl(t)?t:!!t,O=()=>{a||xi(e,"playing",()=>{a=!0},{once:!0})};if(O(),xi(e,"loadstart",()=>{a=!1,O(),us(e,c)},{once:!0}),xi(e,"loadstart",()=>{r||(o=!Number.isFinite(e.duration)),us(e,c)},{once:!0}),r&&r.once(ds.default.Events.LEVEL_LOADED,(C,M)=>{var D;o=(D=M.details.live)!=null?D:!1}),!c){let C=()=>{!o||(r!=null&&r.liveSyncPosition?e.currentTime=r.liveSyncPosition:Number.isFinite(e.seekable.end(0))&&(e.currentTime=e.seekable.end(0)))};r&&xi(e,"play",()=>{e.preload==="metadata"?r.once(ds.default.Events.LEVEL_UPDATED,C):C()},{once:!0})}return C=>{a||(c=vl(C)?C:!!C,us(e,c))}},us=(t,e)=>{if(!e)return;let r=t.muted,a=()=>t.muted=r;switch(e){case cs.ANY:t.play().catch(()=>{t.muted=!0,t.play().catch(a)});break;case cs.MUTED:t.muted=!0,t.play().catch(a);break;default:t.play().catch(()=>{});break}},Ic=({preload:t,src:e},r,a)=>{let o=_=>{_!=null&&["","none","metadata","auto"].includes(_)?r.setAttribute("preload",_):r.removeAttribute("preload")};if(!a)return o(t),o;let c=!1,O=!1,C=a.config.maxBufferLength,M=a.config.maxBufferSize,D=_=>{o(_);let I=_!=null?_:r.preload;O||I==="none"||(I==="metadata"?(a.config.maxBufferLength=1,a.config.maxBufferSize=1):(a.config.maxBufferLength=C,a.config.maxBufferSize=M),A())},A=()=>{!c&&e&&(c=!0,a.loadSource(e))};return xi(r,"play",()=>{O=!0,a.config.maxBufferLength=C,a.config.maxBufferSize=M,A()},{once:!0}),D(t),D};function Rc(t,e){e.on(jr.default.Events.NON_NATIVE_TEXT_TRACKS_FOUND,(o,{tracks:c})=>{c.forEach(O=>{var C;let M=(C=O.subtitleTrack)!=null?C:O.closedCaptions,D=e.subtitleTracks.findIndex(({lang:A,name:_,type:I})=>A==(M==null?void 0:M.lang)&&_===O.label&&I.toLowerCase()===O.kind);ms(t,O.kind,O.label,M==null?void 0:M.lang,`${O.kind}${D}`)})});let r=()=>{var o;if(!e.subtitleTracks.length)return;let c=Array.from(t.textTracks).find(C=>C.id&&C.mode==="showing"&&["subtitles","captions"].includes(C.kind)),O=`${(o=e.subtitleTracks[e.subtitleTrack])==null?void 0:o.type.toLowerCase()}${e.subtitleTrack}`;if(c&&(e.subtitleTrack<0||(c==null?void 0:c.id)!==O)){let C=e.subtitleTracks.findIndex(({lang:M,name:D,type:A})=>M==c.language&&D===c.label&&A.toLowerCase()===c.kind);e.subtitleTrack=C}c&&(c==null?void 0:c.id)===O&&c.cues&&Array.from(c.cues).forEach(C=>{c.addCue(C)})};t.textTracks.addEventListener("change",r),e.on(jr.default.Events.CUES_PARSED,(o,{track:c,cues:O})=>{let C=t.textTracks.getTrackById(c);if(!C)return;let M=C.mode==="disabled";M&&(C.mode="hidden"),O.forEach(D=>{var A;(A=C.cues)!=null&&A.getCueById(D.id)||C.addCue(D)}),M&&(C.mode="disabled")}),e.once(jr.default.Events.DESTROYING,()=>{t.textTracks.removeEventListener("change",r),t.querySelectorAll("track[data-removeondestroy]").forEach(o=>{o.remove()})});let a=()=>{Array.from(t.textTracks).forEach(o=>{var c,O;if(!["subtitles","caption"].includes(o.kind)&&o.label==="thumbnails"){if(!((c=o.cues)!=null&&c.length)){let C=t.querySelector('track[label="thumbnails"]'),M=(O=C==null?void 0:C.getAttribute("src"))!=null?O:"";C==null||C.removeAttribute("src"),setTimeout(()=>{C==null||C.setAttribute("src",M)},0)}o.mode!=="hidden"&&(o.mode="hidden")}})};e.once(jr.default.Events.MANIFEST_LOADED,a),e.once(jr.default.Events.MEDIA_ATTACHED,a)}function ms(t,e,r,a,o){let c=document.createElement("track");return c.kind=e,c.label=r,a&&(c.srclang=a),o&&(c.id=o),c.track.mode="disabled",c.setAttribute("data-removeondestroy",""),t.append(c),c.track}function bl(t,e){let r=Array.prototype.find.call(t.querySelectorAll("track"),a=>a.track===e);r==null||r.remove()}var ml,gl,Mc=(gl=(ml=globalThis==null?void 0:globalThis.navigator)==null?void 0:ml.userAgent)!=null?gl:"",Cc=Mc.toLowerCase().indexOf("android")!==-1,Yr=new WeakMap,Al="mux.com",pl,El,_l=(El=(pl=Sr.default).isSupported)==null?void 0:El.call(pl),Oc=Cc,Sl=()=>xa.default.utils.now(),Pc=xa.default.utils.generateUUID,xl=(t,{domain:e=Al}={})=>{if(!t)return;let[r,a=""]=Sc(t);return`https://stream.${e}/${r}.m3u8${a}`},kc=t=>{if(!t)return;let[e]=t.split("?");return e||void 0},wc=t=>{if(!t||!t.startsWith("https://stream."))return;let[e]=new URL(t).pathname.slice(1).split(".m3u8");return e||void 0},Uc=t=>{var e,r,a;return(e=t==null?void 0:t.metadata)!=null&&e.video_id?t.metadata.video_id:Rl(t)&&(a=(r=kc(t.playbackId))!=null?r:wc(t.src))!=null?a:t.src},Dl=t=>{var e;return(e=Yr.get(t))==null?void 0:e.error},Ll=(t,e,r)=>{gs(e,r);let{metadata:a={}}=t,{view_session_id:o=Pc()}=a,c=Uc(t);a.view_session_id=o,a.video_id=c,t.metadata=a,Yr.set(e,{});let O=Nc(t,e);Fc(t,e,O),Kc(t,e,O);let C=Lc(t,e,O),M=Ic(t,e,O);return{engine:O,setAutoplay:C,setPreload:M}},gs=(t,e)=>{let r=e==null?void 0:e.engine;r&&(r.detachMedia(),r.destroy()),(t==null?void 0:t.mux)&&!t.mux.deleted&&(t.mux.destroy(),delete t.mux),t&&(t.removeAttribute("src"),t.load(),t.removeEventListener("error",Cl),t.removeEventListener("error",vs),t.removeEventListener("durationchange",Ml),Yr.delete(t),t.dispatchEvent(new Event("teardown")))};function Il(t,e){var r;let a=Tl(t);if(a!==Vr.M3U8)return!0;let o=!a||((r=e.canPlayType(a))!=null?r:!0),{preferPlayback:c}=t,O=c===Ot.MSE,C=c===Ot.NATIVE;return o&&(C||!(_l&&(O||Oc)))}var Nc=(t,e)=>{let{debug:r,streamType:a,startTime:o=-1,metadata:c,preferCmcd:O}=t,C=Tl(t)===Vr.M3U8,M=Il(t,e);if(C&&!M&&_l){let D={backBufferLength:30,renderTextTracksNatively:!1,liveDurationInfinity:!0},A=Bc(a),_=O!==fs.NONE?{useHeaders:O===fs.HEADER,sessionId:c.view_session_id,contentId:c.video_id}:void 0;return new Sr.default({debug:r,startPosition:o,cmcd:_,...D,...A})}},Bc=t=>[we.LIVE,we.DVR].includes(t)?{backBufferLength:8}:[we.LL_LIVE,we.LL_DVR].includes(t)?{backBufferLength:4,maxFragLookUpTolerance:.001}:{},Rl=({playbackId:t,src:e,customDomain:r})=>{if(t)return!0;if(typeof e!="string")return!1;let a=window==null?void 0:window.location.href,o=new URL(e,a).hostname.toLocaleLowerCase();return o.includes(Al)||!!r&&o.includes(r.toLocaleLowerCase())},Fc=(t,e,r)=>{var a;let{envKey:o}=t,c=Rl(t);if(o||c){let{playerInitTime:O,playerSoftwareName:C,playerSoftwareVersion:M,beaconCollectionDomain:D,debug:A,disableCookies:_}=t,I={...t.metadata,video_title:((a=t==null?void 0:t.metadata)==null?void 0:a.video_title)||void 0},S=T=>typeof T.player_error_code=="string"?!1:typeof t.errorTranslator=="function"?t.errorTranslator(T):T;xa.default.monitor(e,{debug:A,beaconCollectionDomain:D,hlsjs:r,Hls:r?Sr.default:void 0,automaticErrorTracking:!1,errorTranslator:S,disableCookies:_,data:{...o?{env_key:o}:{},player_software_name:C,player_software:C,player_software_version:M,player_init_time:O,...I}})}},Kc=(t,e,r)=>{var a;let o=Il(t,e),{src:c}=t;e&&o?(typeof c=="string"?(e.setAttribute("src",c),t.startTime&&(((a=Yr.get(e))!=null?a:{}).startTime=t.startTime,e.addEventListener("durationchange",Ml,{once:!0}))):e.removeAttribute("src"),e.addEventListener("error",Cl),e.addEventListener("error",vs)):r&&c?(r.on(Sr.default.Events.ERROR,(O,C)=>{let M={[Sr.default.ErrorTypes.NETWORK_ERROR]:Ge.MEDIA_ERR_NETWORK,[Sr.default.ErrorTypes.MEDIA_ERROR]:Ge.MEDIA_ERR_DECODE},D=new Ge("",M[C.type]);D.fatal=C.fatal,D.data=C,e.dispatchEvent(new CustomEvent("error",{detail:D}))}),e.addEventListener("error",vs),Rc(e,r),r.attachMedia(e)):console.error("It looks like the video you're trying to play will not work on this system! If possible, try upgrading to the newest versions of your browser or software.")};function Ml(t){var e;let r=t.target,a=(e=Yr.get(r))==null?void 0:e.startTime;if(!!a&&_c(r.seekable,r.duration,a)){let o=r.preload==="auto";o&&(r.preload="none"),r.currentTime=a,o&&(r.preload="auto")}}async function Cl(t){if(!t.isTrusted)return;t.stopImmediatePropagation();let e=t.target;if(!(e!=null&&e.error))return;let{message:r,code:a}=e.error,o=new Ge(r,a);if(e.src&&(a!==Ge.MEDIA_ERR_DECODE||a!==void 0))try{let{status:c}=await fetch(e.src);o.data={response:{code:c}}}catch{}e.dispatchEvent(new CustomEvent("error",{detail:o}))}function vs(t){var e,r;if(!(t instanceof CustomEvent)||!(t.detail instanceof Ge))return;let a=t.target,o=t.detail;!o||!o.fatal||(((e=Yr.get(a))!=null?e:{}).error=o,(r=a.mux)==null||r.emit("error",{player_error_code:o.code,player_error_message:o.message}))}var Wc=Object.defineProperty,Hc=(t,e,r)=>e in t?Wc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Da=(t,e,r)=>(Hc(t,typeof e!="symbol"?e+"":e,r),r),Ts=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},de=(t,e,r)=>(Ts(t,e,"read from private field"),r?r.call(t):e.get(t)),Ce=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},je=(t,e,r,a)=>(Ts(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),et=(t,e,r)=>(Ts(t,e,"access private method"),r),Ua=class{addEventListener(){}removeEventListener(){}dispatchEvent(t){return!0}};if(typeof DocumentFragment=="undefined"){class t extends Ua{}globalThis.DocumentFragment=t}var bs=class extends Ua{},Gc=class extends Ua{},jc={get(t){},define(t,e,r){},upgrade(t){},whenDefined(t){return Promise.resolve(bs)}},La,Vc=class{constructor(t,e={}){Ce(this,La,void 0),je(this,La,e==null?void 0:e.detail)}get detail(){return de(this,La)}initCustomEvent(){}};La=new WeakMap;function $c(t,e){return new bs}var Pl={document:{createElement:$c},DocumentFragment,customElements:jc,CustomEvent:Vc,EventTarget:Ua,HTMLElement:bs,HTMLVideoElement:Gc},kl=typeof window=="undefined"||typeof globalThis.customElements=="undefined",lr=kl?Pl:globalThis,wl=kl?Pl.document:globalThis.document,Yc=()=>{try{return"0.12.0"}catch{}return"UNKNOWN"},zc=Yc(),Xc=()=>zc,Qc=class extends Set{add(t){super.add(new WeakRef(t))}forEach(t){super.forEach(e=>{let r=e.deref();r&&t(r)})}},Zc=t=>{var e,r,a,o,c,O,C,M,D,A,_,I,S,T,x,v,i,u,p,b,l,s,h,E,n,d,m,f,g,y,R,L,P,N,B,F,H,j,X,$;return e=class extends t{constructor(){super(),Ce(this,m),Ce(this,g),Ce(this,R),Ce(this,P),Ce(this,B),Ce(this,H),Ce(this,X),Da(this,"castEnabled",!1),Ce(this,l,{paused:!1}),Ce(this,s,void 0),Ce(this,h,{}),Ce(this,E,void 0),Ce(this,n,void 0),Ce(this,d,void 0),e.instances.add(this),et(this,B,F).call(this)}static get castElement(){return de(e,r)}static get castEnabled(){return de(e,a)}static get castState(){var G;return(G=de(e,D,A))==null?void 0:G.getCastState()}static async exitCast(){try{await de(e,D,A).endCurrentSession(!0)}catch(G){console.error(G);return}}get castPlayer(){if(e.castElement===this)return de(this,s)}attributeChangedCallback(G){if(this.castPlayer)switch(G){case"cast-stream-type":case"cast-src":this.load();break}}async requestCast(G={}){var J;et(J=e,p,b).call(J,G),je(e,r,this),Object.entries(de(this,h)).forEach(([ee,te])=>{de(this,s).controller.addEventListener(ee,te)});try{await de(e,D,A).requestSession()}catch{je(e,r,void 0);return}de(this,l).paused=super.paused,super.pause(),this.muted=super.muted;try{await this.load()}catch(ee){console.error(ee)}}async load(){var G,J;if(!this.castPlayer)return super.load();let ee=new chrome.cast.media.MediaInfo(this.castSrc,this.castContentType),te=[...this.querySelectorAll("track")].filter(({kind:he,src:me})=>me&&(he==="subtitles"||he==="captions")),oe=[],ue=0;te.length&&(ee.tracks=te.map(he=>{let me=++ue;oe.length===0&&he.track.mode==="showing"&&oe.push(me);let ne=new chrome.cast.media.Track(me,chrome.cast.media.TrackType.TEXT);return ne.trackContentId=he.src,ne.trackContentType="text/vtt",ne.subtype=he.kind==="captions"?chrome.cast.media.TextTrackType.CAPTIONS:chrome.cast.media.TextTrackType.SUBTITLES,ne.name=he.label,ne.language=he.srclang,ne})),this.castStreamType==="live"?ee.streamType=chrome.cast.media.StreamType.LIVE:ee.streamType=chrome.cast.media.StreamType.BUFFERED,ee.metadata=new chrome.cast.media.GenericMediaMetadata,ee.metadata.title=this.title,ee.metadata.images=[{url:this.poster}];let ae=new chrome.cast.media.LoadRequest(ee);ae.currentTime=(G=super.currentTime)!=null?G:0,ae.autoplay=!de(this,l).paused,ae.activeTrackIds=oe,await((J=de(e,_,I))==null?void 0:J.loadMedia(ae)),this.dispatchEvent(new Event("volumechange"))}play(){var G;if(this.castPlayer){this.castPlayer.isPaused&&((G=this.castPlayer.controller)==null||G.playOrPause());return}return super.play()}pause(){var G;if(this.castPlayer){this.castPlayer.isPaused||(G=this.castPlayer.controller)==null||G.playOrPause();return}super.pause()}get castSrc(){var G,J,ee;return(ee=(J=this.getAttribute("cast-src"))!=null?J:(G=this.querySelector("source"))==null?void 0:G.src)!=null?ee:this.currentSrc}set castSrc(G){this.castSrc!=G&&this.setAttribute("cast-src",`${G}`)}get castContentType(){var G;return(G=this.getAttribute("cast-content-type"))!=null?G:void 0}set castContentType(G){this.setAttribute("cast-content-type",`${G}`)}get castStreamType(){var G;return(G=this.getAttribute("cast-stream-type"))!=null?G:void 0}set castStreamType(G){this.setAttribute("cast-stream-type",`${G}`)}get readyState(){if(this.castPlayer)switch(this.castPlayer.playerState){case chrome.cast.media.PlayerState.IDLE:return 0;case chrome.cast.media.PlayerState.BUFFERING:return 2;default:return 3}return super.readyState}get paused(){return this.castPlayer?this.castPlayer.isPaused:super.paused}get muted(){var G;return this.castPlayer?(G=this.castPlayer)==null?void 0:G.isMuted:super.muted}set muted(G){var J;if(this.castPlayer){(G&&!this.castPlayer.isMuted||!G&&this.castPlayer.isMuted)&&((J=this.castPlayer.controller)==null||J.muteOrUnmute());return}super.muted=G}get volume(){var G,J;return this.castPlayer?(J=(G=this.castPlayer)==null?void 0:G.volumeLevel)!=null?J:1:super.volume}set volume(G){var J;if(this.castPlayer){this.castPlayer.volumeLevel=G,(J=this.castPlayer.controller)==null||J.setVolumeLevel();return}super.volume=G}get duration(){var G,J;return this.castPlayer&&de(this,m,f)?(J=(G=this.castPlayer)==null?void 0:G.duration)!=null?J:NaN:super.duration}get currentTime(){var G,J;return this.castPlayer&&de(this,m,f)?(J=(G=this.castPlayer)==null?void 0:G.currentTime)!=null?J:0:super.currentTime}set currentTime(G){var J;if(this.castPlayer){this.castPlayer.currentTime=G,(J=this.castPlayer.controller)==null||J.seek();return}super.currentTime=G}get onentercast(){return de(this,E)}set onentercast(G){de(this,E)&&(this.removeEventListener("entercast",de(this,E)),je(this,E,null)),typeof G=="function"&&(je(this,E,G),this.addEventListener("entercast",G))}get onleavecast(){return de(this,n)}set onleavecast(G){de(this,n)&&(this.removeEventListener("leavecast",de(this,n)),je(this,n,null)),typeof G=="function"&&(je(this,n,G),this.addEventListener("leavecast",G))}get oncastchange(){return de(this,d)}set oncastchange(G){de(this,d)&&(this.removeEventListener("castchange",de(this,d)),je(this,d,null)),typeof G=="function"&&(je(this,d,G),this.addEventListener("castchange",G))}},r=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakSet,O=function(){return typeof chrome!="undefined"&&chrome.cast&&chrome.cast.isAvailable},C=new WeakSet,M=function(){return typeof cast!="undefined"&&cast.framework},D=new WeakSet,A=function(){if(de(e,C,M))return cast.framework.CastContext.getInstance()},_=new WeakSet,I=function(){var G;return(G=de(e,D,A))==null?void 0:G.getCurrentSession()},S=new WeakSet,T=function(){var G;return(G=de(e,_,I))==null?void 0:G.getSessionObj().media[0]},x=new WeakSet,v=function(G){return new Promise((J,ee)=>{de(e,S,T).editTracksInfo(G,J,ee)})},i=new WeakSet,u=function(G){return new Promise((J,ee)=>{de(e,S,T).getStatus(G,J,ee)})},p=new WeakSet,b=function(G){return de(e,D,A).setOptions({receiverApplicationId:chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED,androidReceiverCompatible:!1,language:"en-US",resumeSavedSession:!0,...G})},l=new WeakMap,s=new WeakMap,h=new WeakMap,E=new WeakMap,n=new WeakMap,d=new WeakMap,m=new WeakSet,f=function(){var G;return(G=this.castPlayer)==null?void 0:G.isMediaLoaded},g=new WeakSet,y=function(){de(e,r)===this&&(Object.entries(de(this,h)).forEach(([G,J])=>{de(this,s).controller.removeEventListener(G,J)}),je(e,r,void 0),this.muted=de(this,s).isMuted,this.currentTime=de(this,s).savedPlayerState.currentTime,de(this,s).savedPlayerState.isPaused===!1&&this.play())},R=new WeakSet,L=function(){this.dispatchEvent(new CustomEvent("castchange",{detail:de(e,D,A).getCastState()}))},P=new WeakSet,N=async function(){var G,J;let{SESSION_RESUMED:ee}=cast.framework.SessionState;if(de(e,D,A).getSessionState()===ee&&this.castSrc===((G=de(e,S,T))==null?void 0:G.media.contentId)){je(e,r,this),Object.entries(de(this,h)).forEach(([te,oe])=>{de(this,s).controller.addEventListener(te,oe)});try{await et(J=e,i,u).call(J,new chrome.cast.media.GetStatusRequest)}catch(te){console.error(te)}de(this,h)[cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED](),de(this,h)[cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED]()}},B=new WeakSet,F=function(){var G;!de(e,C,M)||this.castEnabled||(this.castEnabled=!0,et(G=e,p,b).call(G),this.textTracks.addEventListener("change",et(this,X,$).bind(this)),et(this,R,L).call(this),je(this,s,new cast.framework.RemotePlayer),new cast.framework.RemotePlayerController(de(this,s)),je(this,h,{[cast.framework.RemotePlayerEventType.IS_CONNECTED_CHANGED]:({value:J})=>{J===!1&&et(this,g,y).call(this),this.dispatchEvent(new Event(J?"entercast":"leavecast"))},[cast.framework.RemotePlayerEventType.DURATION_CHANGED]:()=>{this.dispatchEvent(new Event("durationchange"))},[cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED]:()=>{this.dispatchEvent(new Event("volumechange"))},[cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED]:()=>{this.dispatchEvent(new Event("volumechange"))},[cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED]:()=>{!de(this,m,f)||this.dispatchEvent(new Event("timeupdate"))},[cast.framework.RemotePlayerEventType.VIDEO_INFO_CHANGED]:()=>{this.dispatchEvent(new Event("resize"))},[cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED]:()=>{this.dispatchEvent(new Event(this.paused?"pause":"play"))},[cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED]:()=>{var J,ee;((J=this.castPlayer)==null?void 0:J.playerState)!==chrome.cast.media.PlayerState.PAUSED&&this.dispatchEvent(new Event({[chrome.cast.media.PlayerState.PLAYING]:"playing",[chrome.cast.media.PlayerState.BUFFERING]:"waiting",[chrome.cast.media.PlayerState.IDLE]:"emptied"}[(ee=this.castPlayer)==null?void 0:ee.playerState]))},[cast.framework.RemotePlayerEventType.IS_MEDIA_LOADED_CHANGED]:async()=>{!de(this,m,f)||(await Promise.resolve(),et(this,H,j).call(this))}}))},H=new WeakSet,j=function(){et(this,X,$).call(this)},X=new WeakSet,$=async function(){var G,J,ee,te,oe,ue;if(!this.castPlayer)return;let ae=((J=(G=de(this,s).mediaInfo)==null?void 0:G.tracks)!=null?J:[]).filter(({type:be})=>be===chrome.cast.media.TrackType.TEXT),he=[...this.textTracks].filter(({kind:be})=>be==="subtitles"||be==="captions"),me=ae.map(({language:be,name:Ue,trackId:Ze})=>{var We;let{mode:tt}=(We=he.find(Fe=>Fe.language===be&&Fe.label===Ue))!=null?We:{};return tt?{mode:tt,trackId:Ze}:!1}).filter(Boolean),ne=me.filter(({mode:be})=>be!=="showing").map(({trackId:be})=>be),Me=me.find(({mode:be})=>be==="showing"),_e=(oe=(te=(ee=de(e,_,I))==null?void 0:ee.getSessionObj().media[0])==null?void 0:te.activeTrackIds)!=null?oe:[],Se=_e;if(_e.length&&(Se=Se.filter(be=>!ne.includes(be))),Me!=null&&Me.trackId&&(Se=[...Se,Me.trackId]),Se=[...new Set(Se)],!((be,Ue)=>be.length===Ue.length&&be.every(Ze=>Ue.includes(Ze)))(_e,Se))try{let be=new chrome.cast.media.EditTracksInfoRequest(Se);await et(ue=e,x,v).call(ue,be)}catch(be){console.error(be)}},Ce(e,c),Ce(e,C),Ce(e,D),Ce(e,_),Ce(e,S),Ce(e,x),Ce(e,i),Ce(e,p),Da(e,"observedAttributes",["cast-src","cast-content-type","cast-stream-type"]),Da(e,"instances",new Qc),Ce(e,r,void 0),Ce(e,a,!1),Da(e,"initCast",()=>{var G;de(e,c,O)?de(e,C,M)?de(G=e,o).call(G,chrome.cast.isAvailable):customElements.whenDefined("google-cast-button").then(()=>{var J;return de(J=e,o).call(J,chrome.cast.isAvailable)}):globalThis.__onGCastApiAvailable=()=>{customElements.whenDefined("google-cast-button").then(()=>{var J;return de(J=e,o).call(J,chrome.cast.isAvailable)})}}),Ce(e,o,G=>{if(G){je(e,a,!0);let{CAST_STATE_CHANGED:J}=cast.framework.CastContextEventType;de(e,D,A).addEventListener(J,te=>{e.instances.forEach(oe=>{var ue;return et(ue=oe,R,L).call(ue,te)})});let{SESSION_STATE_CHANGED:ee}=cast.framework.CastContextEventType;de(e,D,A).addEventListener(ee,te=>{e.instances.forEach(oe=>{var ue;return et(ue=oe,P,N).call(ue,te)})}),e.instances.forEach(te=>{var oe;return et(oe=te,B,F).call(oe)})}}),e};if(globalThis.HTMLVideoElement&&globalThis.customElements){let t=Zc(HTMLVideoElement);globalThis.customElements.get("castable-video")||(globalThis.customElements.define("castable-video",t,{extends:"video"}),globalThis.CastableVideoElement=t),t.initCast()}var As=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting","waitingforkey","resize","enterpictureinpicture","leavepictureinpicture","castchange","entercast","leavecast"],Ul=wl.createElement("template");Ul.innerHTML=`
<style>
  :host {
    display: inline-block;
    line-height: 0;
    width: auto;
    height: auto;
  }

  video {
    max-width: 100%;
    max-height: 100%;
    min-width: 100%;
    min-height: 100%;
    object-fit: var(--media-object-fit, contain);
    object-position: var(--media-object-position, 50% 50%);
  }
</style>
<video is="castable-video" part="video" crossorigin></video>
<slot></slot>
`;var Ia,Di,Ra,wa,ps,zr=class extends lr.HTMLElement{constructor(){super(),Ce(this,Di),Ce(this,wa),Ce(this,Ia,void 0),this.attachShadow({mode:"open"}),this.isConnected&&et(this,Di,Ra).call(this)}static get observedAttributes(){let t=[],e=a=>a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();Object.getOwnPropertyNames(this.prototype).forEach(a=>{let o=!1;try{typeof this.prototype[a]=="function"&&(o=!0)}catch{}!o&&a!==a.toUpperCase()&&t.push(a.toLowerCase(),e(a))});let r=Object.getPrototypeOf(this).observedAttributes;return r&&(t=t.concat(r)),t}attributeChangedCallback(t,e,r){et(this,Di,Ra).call(this),et(this,wa,ps).call(this,t,e,r)}connectedCallback(){et(this,Di,Ra).call(this)}};Ia=new WeakMap,Di=new WeakSet,Ra=function(){if(de(this,Ia))return;je(this,Ia,!0),this.shadowRoot.append(Ul.content.cloneNode(!0)),this.nativeEl=this.shadowRoot.querySelector("video"),As.forEach(e=>{this.nativeEl.addEventListener(e,r=>{this.dispatchEvent(new CustomEvent(r.type,{detail:r.detail}))})});let t=this.shadowRoot.querySelector("slot");t.addEventListener("slotchange",()=>{t.assignedElements().forEach(e=>{!["track","source"].includes(e.localName)||this.nativeEl.append(e)})}),Array.prototype.forEach.call(this.attributes,e=>{et(this,wa,ps).call(this,e.name,null,e.value)}),this.nativeEl.defaultMuted&&(this.nativeEl.muted=!0)},wa=new WeakSet,ps=function(t,e,r){let a=Object.getOwnPropertyNames(Object.getPrototypeOf(this)),o=qc(a,t),c=Object.getPrototypeOf(this.constructor).toString().indexOf("function HTMLElement")===0;o&&!c?typeof this[o]=="boolean"?r===null?this[o]=!1:this[o]=!0:this[o]=r:r===null?this.nativeEl.removeAttribute(t):["id","class"].indexOf(t)===-1&&this.nativeEl.setAttribute(t,r)};var Nl=[],Bl=wl.createElement("video",{is:"castable-video"}),Jc=["webkitDisplayingFullscreen","webkitSupportsFullscreen"];for(let t=Object.getPrototypeOf(Bl);t&&t!==lr.HTMLElement.prototype;t=Object.getPrototypeOf(t))Object.getOwnPropertyNames(t).forEach(e=>{Jc.indexOf(e)===-1&&Nl.push(e)});Nl.forEach(t=>{if(!(t in zr.prototype))if(typeof Bl[t]=="function")zr.prototype[t]=function(){return this.nativeEl[t].apply(this.nativeEl,arguments)};else{let e={get(){return this.nativeEl[t]}};t!==t.toUpperCase()&&(e.set=function(r){this.nativeEl[t]=r}),Object.defineProperty(zr.prototype,t,e)}});function qc(t,e){let r=null;return t.forEach(a=>{a.toLowerCase()==e.toLowerCase()&&(r=a)}),r}lr.customElements.get("custom-video")||(lr.customElements.define("custom-video",zr),lr.CustomVideoElement=zr);var Ol=zr,le={ENV_KEY:"env-key",DEBUG:"debug",PLAYBACK_ID:"playback-id",METADATA_URL:"metadata-url",PREFER_PLAYBACK:"prefer-playback",PLAYER_SOFTWARE_VERSION:"player-software-version",PLAYER_SOFTWARE_NAME:"player-software-name",BEACON_COLLECTION_DOMAIN:"beacon-collection-domain",CUSTOM_DOMAIN:"custom-domain",DISABLE_COOKIES:"disable-cookies",TYPE:"type",STREAM_TYPE:"stream-type",START_TIME:"start-time",PREFER_CMCD:"prefer-cmcd"},ef=Object.values(le),tf=Xc(),rf="mux-video",Zt,Li,Ma,Ii,Ca,Oa,Pa,ka,Es,ys=class extends Ol{constructor(){super(),Ce(this,ka),Ce(this,Zt,void 0),Ce(this,Li,void 0),Ce(this,Ma,void 0),Ce(this,Ii,{}),Ce(this,Ca,void 0),Ce(this,Oa,void 0),Ce(this,Pa,void 0),je(this,Ma,Sl())}static get observedAttributes(){var t;return[...ef,...(t=Ol.observedAttributes)!=null?t:[]]}get preferCmcd(){var t;return(t=this.getAttribute(le.PREFER_CMCD))!=null?t:void 0}set preferCmcd(t){t!==this.preferCmcd&&(t?$r.includes(t)?this.setAttribute(le.PREFER_CMCD,t):console.warn(`Invalid value for preferCmcd. Must be one of ${$r.join()}`):this.removeAttribute(le.PREFER_CMCD))}get playerInitTime(){return de(this,Ma)}get playerSoftwareName(){var t;return(t=de(this,Oa))!=null?t:rf}set playerSoftwareName(t){je(this,Oa,t)}get playerSoftwareVersion(){var t;return(t=de(this,Ca))!=null?t:tf}set playerSoftwareVersion(t){je(this,Ca,t)}get _hls(){var t;return(t=de(this,Zt))==null?void 0:t.engine}get mux(){return this.nativeEl.mux}get error(){var t;return(t=Dl(this.nativeEl))!=null?t:null}get errorTranslator(){return de(this,Pa)}set errorTranslator(t){je(this,Pa,t)}get src(){return this.getAttribute("src")}set src(t){t!==this.src&&(t==null?this.removeAttribute("src"):this.setAttribute("src",t))}get type(){var t;return(t=this.getAttribute(le.TYPE))!=null?t:void 0}set type(t){t!==this.type&&(t?this.setAttribute(le.TYPE,t):this.removeAttribute(le.TYPE))}get autoplay(){let t=this.getAttribute("autoplay");return t===null?!1:t===""?!0:t}set autoplay(t){let e=this.autoplay;t!==e&&(t?this.setAttribute("autoplay",typeof t=="string"?t:""):this.removeAttribute("autoplay"))}get preload(){let t=this.getAttribute("preload");return t===""?"auto":["none","metadata","auto"].includes(t)?t:super.preload}set preload(t){t!=this.getAttribute("preload")&&(["","none","metadata","auto"].includes(t)?this.setAttribute("preload",t):this.removeAttribute("preload"))}get debug(){return this.getAttribute(le.DEBUG)!=null}set debug(t){t!==this.debug&&(t?this.setAttribute(le.DEBUG,""):this.removeAttribute(le.DEBUG))}get disableCookies(){return this.hasAttribute(le.DISABLE_COOKIES)}set disableCookies(t){t!==this.disableCookies&&(t?this.setAttribute(le.DISABLE_COOKIES,""):this.removeAttribute(le.DISABLE_COOKIES))}get startTime(){let t=this.getAttribute(le.START_TIME);if(t==null)return;let e=+t;return Number.isNaN(e)?void 0:e}set startTime(t){t!==this.startTime&&(t==null?this.removeAttribute(le.START_TIME):this.setAttribute(le.START_TIME,`${t}`))}get playbackId(){var t;return(t=this.getAttribute(le.PLAYBACK_ID))!=null?t:void 0}set playbackId(t){t!==this.playbackId&&(t?this.setAttribute(le.PLAYBACK_ID,t):this.removeAttribute(le.PLAYBACK_ID))}get customDomain(){var t;return(t=this.getAttribute(le.CUSTOM_DOMAIN))!=null?t:void 0}set customDomain(t){t!==this.customDomain&&(t?this.setAttribute(le.CUSTOM_DOMAIN,t):this.removeAttribute(le.CUSTOM_DOMAIN))}get envKey(){var t;return(t=this.getAttribute(le.ENV_KEY))!=null?t:void 0}set envKey(t){t!==this.envKey&&(t?this.setAttribute(le.ENV_KEY,t):this.removeAttribute(le.ENV_KEY))}get beaconCollectionDomain(){var t;return(t=this.getAttribute(le.BEACON_COLLECTION_DOMAIN))!=null?t:void 0}set beaconCollectionDomain(t){t!==this.beaconCollectionDomain&&(t?this.setAttribute(le.BEACON_COLLECTION_DOMAIN,t):this.removeAttribute(le.BEACON_COLLECTION_DOMAIN))}get streamType(){var t;return(t=this.getAttribute(le.STREAM_TYPE))!=null?t:void 0}set streamType(t){t!==this.streamType&&(t?this.setAttribute(le.STREAM_TYPE,t):this.removeAttribute(le.STREAM_TYPE))}get preferPlayback(){let t=this.getAttribute(le.PREFER_PLAYBACK);if(t===Ot.MSE||t===Ot.NATIVE)return t}set preferPlayback(t){t!==this.preferPlayback&&(t===Ot.MSE||t===Ot.NATIVE?this.setAttribute(le.PREFER_PLAYBACK,t):this.removeAttribute(le.PREFER_PLAYBACK))}get metadata(){return{...this.getAttributeNames().filter(t=>t.startsWith("metadata-")&&![le.METADATA_URL].includes(t)).reduce((t,e)=>{let r=this.getAttribute(e);return r!=null&&(t[e.replace(/^metadata-/,"").replace(/-/g,"_")]=r),t},{}),...de(this,Ii)}}set metadata(t){je(this,Ii,t!=null?t:{}),this.mux&&this.mux.emit("hb",de(this,Ii))}load(){je(this,Zt,Ll(this,this.nativeEl,de(this,Zt)))}unload(){gs(this.nativeEl,de(this,Zt)),je(this,Zt,void 0)}attributeChangedCallback(t,e,r){var a,o;switch(super.attributeChangedCallback(t,e,r),t){case le.PLAYER_SOFTWARE_NAME:this.playerSoftwareName=r!=null?r:void 0;break;case le.PLAYER_SOFTWARE_VERSION:this.playerSoftwareVersion=r!=null?r:void 0;break;case"src":{let c=!!e,O=!!r;!c&&O?et(this,ka,Es).call(this):c&&!O?this.unload():c&&O&&(this.unload(),et(this,ka,Es).call(this));break}case"autoplay":if(r===e)break;(a=de(this,Zt))==null||a.setAutoplay(this.autoplay);break;case"preload":if(r===e)break;(o=de(this,Zt))==null||o.setPreload(r);break;case le.PLAYBACK_ID:this.src=xl(r!=null?r:void 0,{domain:this.customDomain});break;case le.DEBUG:{let c=this.debug;this.mux&&console.info("Cannot toggle debug mode of mux data after initialization. Make sure you set all metadata to override before setting the src."),this._hls&&(this._hls.config.debug=c);break}case le.METADATA_URL:r&&fetch(r).then(c=>c.json()).then(c=>this.metadata=c).catch(c=>console.error(`Unable to load or parse metadata JSON from metadata-url ${r}!`));break;default:break}}disconnectedCallback(){this.unload()}};Zt=new WeakMap,Li=new WeakMap,Ma=new WeakMap,Ii=new WeakMap,Ca=new WeakMap,Oa=new WeakMap,Pa=new WeakMap,ka=new WeakSet,Es=async function(){de(this,Li)||(await je(this,Li,Promise.resolve()),je(this,Li,null),this.load())};lr.customElements.get("mux-video")||(lr.customElements.define("mux-video",ys),lr.MuxVideoElement=ys);var Fl=ys;var af=Object.defineProperty,nf=(t,e,r)=>e in t?af(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,sf=(t,e,r)=>(nf(t,typeof e!="symbol"?e+"":e,r),r),jl=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},De=(t,e,r)=>(jl(t,e,"read from private field"),r?r.call(t):e.get(t)),zt=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},Jt=(t,e,r,a)=>(jl(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),Xr,Na,xr,Ri,ur,dr,cr,Dr,Qr,Ba,Ft,Kl=1,Wl=0,of=1,lf={processCallback(t,e,r){if(!!r){for(let[a,o]of e)if(a in r){let c=r[a];typeof c=="boolean"&&o instanceof pt&&typeof o.element[o.attributeName]=="boolean"?o.booleanValue=c:typeof c=="function"&&o instanceof pt?o.element[o.attributeName]=c:o.value=c}}}},qt=class extends ie.DocumentFragment{constructor(e,r,a=lf){var o;super(),zt(this,Xr,void 0),zt(this,Na,void 0),this.append(e.content.cloneNode(!0)),Jt(this,Xr,Vl(this)),Jt(this,Na,a),(o=a.createCallback)==null||o.call(a,this,De(this,Xr),r),a.processCallback(this,De(this,Xr),r)}update(e){De(this,Na).processCallback(this,De(this,Xr),e)}};Xr=new WeakMap;Na=new WeakMap;var Vl=(t,e=[])=>{let r,a;for(let o of t.attributes||[])if(o.value.includes("{{")){let c=new _s;for([r,a]of Gl(o.value))if(!r)c.append(a);else{let O=new pt(t,o.name,o.namespaceURI);c.append(O),e.push([a,O])}o.value=c.toString()}for(let o of t.childNodes)if(o.nodeType===Kl&&!(o instanceof HTMLTemplateElement))Vl(o,e);else if(o.nodeType===Kl||o.data.includes("{{")){let c=[];if(o.data)for([r,a]of Gl(o.data))if(!r)c.push(new Text(a));else{let O=new er(t);c.push(O),e.push([a,O])}else if(o instanceof HTMLTemplateElement){let O=new Mi(t,o);c.push(O),e.push([O.expression,O])}o.replaceWith(...c.flatMap(O=>O.replacementNodes||[O]))}return e},Hl={},Gl=t=>{let e="",r=0,a=Hl[t],o=0,c;if(a)return a;for(a=[];c=t[o];o++)c==="{"&&t[o+1]==="{"&&t[o-1]!=="\\"&&t[o+2]&&++r==1?(e&&a.push([Wl,e]),e="",o++):c==="}"&&t[o+1]==="}"&&t[o-1]!=="\\"&&!--r?(a.push([of,e.trim()]),e="",o++):e+=c||"";return e&&a.push([Wl,(r>0?"{{":"")+e]),Hl[t]=a},uf=11,Fa=class{get value(){return""}set value(e){}toString(){return this.value}},$l=new WeakMap,_s=class{constructor(){zt(this,xr,[])}[Symbol.iterator](){return De(this,xr).values()}get length(){return De(this,xr).length}item(e){return De(this,xr)[e]}append(...e){for(let r of e)r instanceof pt&&$l.set(r,this),De(this,xr).push(r)}toString(){return De(this,xr).join("")}};xr=new WeakMap;var pt=class extends Fa{constructor(e,r,a){super(),zt(this,Dr),zt(this,Ri,""),zt(this,ur,void 0),zt(this,dr,void 0),zt(this,cr,void 0),Jt(this,ur,e),Jt(this,dr,r),Jt(this,cr,a)}get attributeName(){return De(this,dr)}get attributeNamespace(){return De(this,cr)}get element(){return De(this,ur)}get value(){return De(this,Ri)}set value(e){De(this,Ri)!==e&&(Jt(this,Ri,e),!De(this,Dr,Qr)||De(this,Dr,Qr).length===1?e==null?De(this,ur).removeAttributeNS(De(this,cr),De(this,dr)):De(this,ur).setAttributeNS(De(this,cr),De(this,dr),e):De(this,ur).setAttributeNS(De(this,cr),De(this,dr),De(this,Dr,Qr)))}get booleanValue(){return De(this,ur).hasAttributeNS(De(this,cr),De(this,dr))}set booleanValue(e){if(!De(this,Dr,Qr)||De(this,Dr,Qr).length===1)this.value=e?"":null;else throw new DOMException("Value is not fully templatized")}};Ri=new WeakMap;ur=new WeakMap;dr=new WeakMap;cr=new WeakMap;Dr=new WeakSet;Qr=function(){return $l.get(this)};var er=class extends Fa{constructor(e,r){super(),zt(this,Ba,void 0),zt(this,Ft,void 0),Jt(this,Ba,e),Jt(this,Ft,r?[...r]:[new Text])}get replacementNodes(){return De(this,Ft)}get parentNode(){return De(this,Ba)}get nextSibling(){return De(this,Ft)[De(this,Ft).length-1].nextSibling}get previousSibling(){return De(this,Ft)[0].previousSibling}get value(){return De(this,Ft).map(e=>e.textContent).join("")}set value(e){this.replace(e)}replace(...e){let r=e.flat().flatMap(a=>a==null?[new Text]:a.forEach?[...a]:a.nodeType===uf?[...a.childNodes]:a.nodeType?[a]:[new Text(a)]);r.length||r.push(new Text("")),De(this,Ft)[0].before(...r);for(let a of De(this,Ft))r.includes(a)||a.remove();Jt(this,Ft,r)}};Ba=new WeakMap;Ft=new WeakMap;var Mi=class extends er{constructor(e,r){let a=r.getAttribute("directive")||r.getAttribute("type"),o=r.getAttribute("expression")||r.getAttribute(a)||"";o.startsWith("{{")&&(o=o.trim().slice(2,-2).trim()),super(e),sf(this,"directive"),this.expression=o,this.template=r,this.directive=a}};var df=/([>&])?\s*(\w+)\s*(.*)/,cf=/^(\?\?|\|)?\s*(['"\w]*)/,ff={"|":{string:t=>String(t)},"??":(t,e)=>t!=null?t:e},Ka=class{constructor(e){this.template=e}},xs={partial:(t,e)=>{e[t.expression]=new Ka(t.template)},if:(t,e)=>{mf(t.expression,e)?t.replace(new qt(t.template,e,Wa)):t.replace("")}},hf=Object.keys(xs),Wa={processCallback(t,e,r){var a,o,c;if(!!r)for(let[O,C]of e){if(C instanceof Mi){if(!C.directive){let x=hf.find(v=>C.template.hasAttribute(v));x&&(C.directive=x,C.expression=C.template.getAttribute(x))}(a=xs[C.directive])==null||a.call(xs,C,r);continue}let[,M,D,A]=(o=O.match(df))!=null?o:[],_=r[D],[,I,S]=(c=A.match(cf))!=null?c:[],T=ff[I];if(typeof T=="function")_=T(_,Ci(S,r));else if(T&&_!=null){let x=T[S];x&&(_=x(_))}if(_){if(_ instanceof Ka){if(M!==">")continue;let x={...r},v=O.matchAll(/(\w+)\s*=\s*(['"\w]*)/g);for(let[,i,u]of v)x[i]=Ci(u,r);_=new qt(_.template,x,Wa)}C instanceof pt&&C.attributeName.startsWith("aria-")&&(_=String(_)),C instanceof pt?typeof _=="boolean"?C.booleanValue=_:typeof _=="function"?C.element[C.attributeName]=_:C.value=_:C.value=_}else C instanceof pt&&(C.booleanValue=!1)}}},vf={"==":(t,e)=>t==e,"!=":(t,e)=>t!=e};function mf(t,e){var r;let a=gf(t,{boolean:/true|false/,number:/-?\d+\.?\d*/,string:/(["'])((?:\\.|[^\\])*?)\1/,operator:/[!=]=/,ws:/\s+/,param:/[$a-z_][$\w]*/i});if(a.length===0||a.some(({type:c})=>!c))return console.warn(`Warning: invalid expression \`${t}\``),!1;if(a.length===1)return Ss(a[0])?Ci(a[0].token,e):(console.warn(`Warning: invalid expression \`${t}\``),!1);let o=a.filter(({type:c})=>c!=="ws");if(o.length===3){let c=vf[(r=o[1])==null?void 0:r.token];return!c||!Ss(o[0])||!Ss(o[2])?(console.warn(`Warning: invalid expression \`${t}\``),!1):c(Ci(o[0].token,e),Ci(o[2].token,e))}}function Ss({type:t}){return["number","boolean","string","param"].includes(t)}function Ci(t,e){let r=t[0],a=t.slice(-1);return t==="true"||t==="false"?t==="true":r===a&&["'",'"'].includes(r)?t.slice(1,-1):no(t)?parseFloat(t):e[t]}function gf(t,e){let r,a,o,c=[];for(;t;){o=null,r=t.length;for(let O in e)a=e[O].exec(t),a&&a.index<r&&(o={token:a[0],type:O,matches:a.slice(1)},r=a.index);r&&c.push({token:t.substr(0,r),type:void 0}),o&&c.push(o),t=t.substr(r+(o?o.token.length:0))}return c}var pf=Object.defineProperty,Ef=(t,e,r)=>e in t?pf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Oi=(t,e,r)=>(Ef(t,typeof e!="symbol"?e+"":e,r),r),Ql=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},Yl=(t,e,r)=>(Ql(t,e,"read from private field"),r?r.call(t):e.get(t)),zl=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},Xl=(t,e,r,a)=>(Ql(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),Ha,Ga,Zr=class extends ie.HTMLElement{constructor(){super(),Oi(this,"renderRoot"),Oi(this,"renderer"),zl(this,Ha,void 0),zl(this,Ga,void 0),this.renderRoot=this.attachShadow({mode:"open"}),new MutationObserver(()=>this.render()).observe(this,{attributes:!0}),this.createRenderer()}get mediaController(){return this.renderRoot.querySelector("media-controller")}get template(){var e,r;let a=this.getAttribute("template");if(a){let o=(e=this.getRootNode())==null?void 0:e.getElementById(a);if(o)return o}return(r=Yl(this,Ha))!=null?r:this.constructor.template}set template(e){Xl(this,Ha,e),this.createRenderer()}get props(){let e={};for(let r of this.attributes)r.value!=null?e[mn(r.name)]=r.value===""?!0:r.value:e[mn(r.name)]=!1;return e}attributeChangedCallback(e,r,a){e==="template"&&r!=a&&this.createRenderer()}createRenderer(){this.template&&this.template!==Yl(this,Ga)&&(Xl(this,Ga,this.template),this.renderer=new qt(this.template,this.props,this.constructor.processor),this.renderRoot.textContent="",this.renderRoot.append(this.renderer))}render(){var e;(e=this.renderer)==null||e.update(this.props)}};Ha=new WeakMap;Ga=new WeakMap;Oi(Zr,"template");Oi(Zr,"observedAttributes",["template"]);Oi(Zr,"processor",Wa);ce("media-theme",Zr);var Hs=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},Re=(t,e,r)=>(Hs(t,e,"read from private field"),r?r.call(t):e.get(t)),Ve=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},Kt=(t,e,r,a)=>(Hs(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),$e=(t,e,r)=>(Hs(t,e,"access private method"),r),en=class{addEventListener(){}removeEventListener(){}dispatchEvent(t){return!0}};if(typeof DocumentFragment=="undefined"){class t extends en{}globalThis.DocumentFragment=t}var Gs=class extends en{},yf=class extends en{},Tf={get(t){},define(t,e,r){},upgrade(t){},whenDefined(t){return Promise.resolve(Gs)}},ja,bf=class{constructor(t,e={}){Ve(this,ja,void 0),Kt(this,ja,e==null?void 0:e.detail)}get detail(){return Re(this,ja)}initCustomEvent(){}};ja=new WeakMap;function Af(t,e){return new Gs}var cu={document:{createElement:Af},DocumentFragment,customElements:Tf,CustomEvent:bf,EventTarget:en,HTMLElement:Gs,HTMLVideoElement:yf},fu=typeof window=="undefined"||typeof globalThis.customElements=="undefined",ct=fu?cu:globalThis,ir=fu?cu.document:globalThis.document,_f="en",Fi={code:_f},hu="en";function ke(t,e=!0){var r,a;let o=e&&(a=(r=Fi)==null?void 0:r[t])!=null?a:t,c=e?Fi.code:hu;return new Sf(o,c)}var Sf=class{constructor(t,e=(r=>(r=Fi.code)!=null?r:hu)()){this.message=t,this.locale=e}format(t){return this.message.replace(/\{(\w+)\}/g,(e,r)=>{var a;return(a=t[r])!=null?a:""})}toString(){return this.message}};function xf(t){let e="";return Object.entries(t).forEach(([r,a])=>{a!=null&&(e+=`${Df(r)}: ${a}; `)}),e?e.trim():void 0}function Df(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Lf(t){return t.replace(/[-_]([a-z])/g,(e,r)=>r.toUpperCase())}function Rr(t){if(t==null)return;let e=+t;return Number.isNaN(e)?void 0:e}function js(t){let e=If(t).toString();return e?"?"+e:""}function If(t){let e={};for(let r in t)t[r]!=null&&(e[r]=t[r]);return new URLSearchParams(e)}function Ki(t){let e=(t!=null?t:"").split(".")[1];if(!e)return{};let r=e.replace(/-/g,"+").replace(/_/g,"/"),a=decodeURIComponent(atob(r).split("").map(function(o){return"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(a)}var vu=(t,e)=>!t||!e?!1:t.contains(e)?!0:vu(t,e.getRootNode().host),Vs="mux.com",Rf=()=>{try{return"1.5.1"}catch{}return"UNKNOWN"},Mf=Rf(),mu=()=>Mf,Zl=(t,{token:e,domain:r=Vs}={})=>`https://stream.${r}/${t}.m3u8${js(e?{token:e}:{redundant_streams:!0})}`,Cf=(t,{token:e,thumbnailTime:r,domain:a=Vs}={})=>{let o=e==null?r:void 0,{aud:c}=Ki(e);if(!(e&&c!=="t"))return`https://image.${a}/${t}/thumbnail.webp${js({token:e,time:o})}`},Of=(t,{token:e,domain:r=Vs}={})=>{let{aud:a}=Ki(e);if(!(e&&a!=="s"))return`https://image.${r}/${t}/storyboard.vtt${js({token:e,format:"webp"})}`},Pf={crossorigin:"crossOrigin",playsinline:"playsInline"};function kf(t){var e;return(e=Pf[t])!=null?e:Lf(t)}var gu=t=>{var e,r;let{media:a}=t;return(r=(e=a==null?void 0:a._hls)==null?void 0:e.liveSyncPosition)!=null?r:a!=null&&a.seekable.length?a==null?void 0:a.seekable.end(a.seekable.length-1):void 0},pu=t=>{let e=gu(t);if(e==null){console.warn("attempting to seek to live but cannot determine live edge time!");return}t.currentTime=e},wf=1,Uf=5,Jl=3,ql=.5,Nf=t=>{var e;let{streamType:r}=t,a=gu(t),o=(e=t.media)==null?void 0:e.currentTime;if(a==null||o==null)return!1;let c=a-o;return r===we.LL_LIVE||r===we.LL_DVR?c<=wf*(Jl+ql):r===we.LIVE||r===we.DVR?c<=Uf*(Jl+ql):!1},Jr,qr,At,Bf=class{constructor(t,e){Ve(this,Jr,void 0),Ve(this,qr,void 0),Ve(this,At,[]),Kt(this,Jr,t),Kt(this,qr,e)}[Symbol.iterator](){return Re(this,At).values()}get length(){return Re(this,At).length}get value(){var t;return(t=Re(this,At).join(" "))!=null?t:""}set value(t){var e;t!==this.value&&(Kt(this,At,[]),this.add(...(e=t==null?void 0:t.split(" "))!=null?e:[]))}toString(){return this.value}item(t){return Re(this,At)[t]}values(){return Re(this,At).values()}keys(){return Re(this,At).keys()}forEach(t){Re(this,At).forEach(t)}add(...t){var e,r;t.forEach(a=>{this.contains(a)||Re(this,At).push(a)}),!(this.value===""&&!((e=Re(this,Jr))!=null&&e.hasAttribute(`${Re(this,qr)}`)))&&((r=Re(this,Jr))==null||r.setAttribute(`${Re(this,qr)}`,`${this.value}`))}remove(...t){var e;t.forEach(r=>{Re(this,At).splice(Re(this,At).indexOf(r),1)}),(e=Re(this,Jr))==null||e.setAttribute(`${Re(this,qr)}`,`${this.value}`)}contains(t){return Re(this,At).includes(t)}toggle(t,e){return typeof e!="undefined"?e?(this.add(t),!0):(this.remove(t),!1):this.contains(t)?(this.remove(t),!1):(this.add(t),!0)}replace(t,e){this.remove(t),this.add(e)}};Jr=new WeakMap,qr=new WeakMap,At=new WeakMap;var Eu=`[mux-player ${mu()}]`;function Mr(...t){console.warn(Eu,...t)}function vr(...t){console.error(Eu,...t)}function Is(t){var e;let r=(e=t.message)!=null?e:"";if(t.file){let a="https://github.com/muxinc/elements/blob/main/errors/";r+=` ${ke("Read more: ")}
${a}${t.file}`}Mr(r)}var dt={AUTOPLAY:"autoplay",CROSSORIGIN:"crossorigin",LOOP:"loop",MUTED:"muted",PLAYSINLINE:"playsinline",PRELOAD:"preload"},Lr={VOLUME:"volume",PLAYBACKRATE:"playbackrate",MUTED:"muted"},eu=Object.freeze({length:0,start(t){let e=t>>>0;if(e>=this.length)throw new DOMException(`Failed to execute 'start' on 'TimeRanges': The index provided (${e}) is greater than or equal to the maximum bound (${this.length}).`);return 0},end(t){let e=t>>>0;if(e>=this.length)throw new DOMException(`Failed to execute 'end' on 'TimeRanges': The index provided (${e}) is greater than or equal to the maximum bound (${this.length}).`);return 0}}),Ff=As.filter(t=>t!=="error"),Kf=Object.values(dt).filter(t=>![dt.PLAYSINLINE].includes(t)),Wf=Object.values(Lr);function Hf(t){t.querySelectorAll(":scope > track").forEach(e=>{var r;(r=t.media)==null||r.append(e.cloneNode())}),Ff.forEach(e=>{var r;(r=t.media)==null||r.addEventListener(e,a=>{t.dispatchEvent(new Event(a.type))})})}var Gf=class extends ct.HTMLElement{static get observedAttributes(){return[...Kf,...Wf]}constructor(){super(),this.querySelectorAll(":scope > track").forEach(e=>{var r;(r=this.media)==null||r.append(e.cloneNode())});let t=e=>{for(let r of e)r.type==="childList"&&(r.removedNodes.forEach(a=>{var o,c;let O=(o=this.media)==null?void 0:o.querySelector(`track[src="${a.src}"]`);O&&((c=this.media)==null||c.removeChild(O))}),r.addedNodes.forEach(a=>{var o;(o=this.media)==null||o.append(a.cloneNode())}))};new MutationObserver(t).observe(this,{childList:!0,subtree:!0})}attributeChangedCallback(t,e,r){var a,o;switch(t){case Lr.MUTED:{this.media&&(this.media.muted=r!=null,this.media.defaultMuted=r!=null);return}case Lr.VOLUME:{let c=(a=Rr(r))!=null?a:1;this.media&&(this.media.volume=c);return}case Lr.PLAYBACKRATE:{let c=(o=Rr(r))!=null?o:1;this.media&&(this.media.playbackRate=c,this.media.defaultPlaybackRate=c);return}}}play(){var t,e;return(e=(t=this.media)==null?void 0:t.play())!=null?e:Promise.reject()}pause(){var t;(t=this.media)==null||t.pause()}requestCast(t){var e;return(e=this.media)==null?void 0:e.requestCast(t)}get media(){var t;return(t=this.shadowRoot)==null?void 0:t.querySelector("mux-video")}get paused(){var t,e;return(e=(t=this.media)==null?void 0:t.paused)!=null?e:!0}get duration(){var t,e;return(e=(t=this.media)==null?void 0:t.duration)!=null?e:NaN}get ended(){var t,e;return(e=(t=this.media)==null?void 0:t.ended)!=null?e:!1}get buffered(){var t,e;return(e=(t=this.media)==null?void 0:t.buffered)!=null?e:eu}get seekable(){var t,e;return(e=(t=this.media)==null?void 0:t.seekable)!=null?e:eu}get readyState(){var t,e;return(e=(t=this.media)==null?void 0:t.readyState)!=null?e:0}get videoWidth(){var t,e;return(e=(t=this.media)==null?void 0:t.videoWidth)!=null?e:0}get videoHeight(){var t,e;return(e=(t=this.media)==null?void 0:t.videoHeight)!=null?e:0}get currentTime(){var t,e;return(e=(t=this.media)==null?void 0:t.currentTime)!=null?e:0}set currentTime(t){this.media&&(this.media.currentTime=Number(t))}get volume(){var t,e;return(e=(t=this.media)==null?void 0:t.volume)!=null?e:1}set volume(t){this.media&&(this.media.volume=Number(t))}get playbackRate(){var t,e;return(e=(t=this.media)==null?void 0:t.playbackRate)!=null?e:1}set playbackRate(t){this.media&&(this.media.playbackRate=Number(t))}get defaultPlaybackRate(){var t;return(t=Rr(this.getAttribute(Lr.PLAYBACKRATE)))!=null?t:1}set defaultPlaybackRate(t){t!=null?this.setAttribute(Lr.PLAYBACKRATE,`${t}`):this.removeAttribute(Lr.PLAYBACKRATE)}get crossOrigin(){return Pi(this,dt.CROSSORIGIN)}set crossOrigin(t){this.setAttribute(dt.CROSSORIGIN,`${t}`)}get autoplay(){return Pi(this,dt.AUTOPLAY)!=null}set autoplay(t){t?this.setAttribute(dt.AUTOPLAY,typeof t=="string"?t:""):this.removeAttribute(dt.AUTOPLAY)}get loop(){return Pi(this,dt.LOOP)!=null}set loop(t){t?this.setAttribute(dt.LOOP,""):this.removeAttribute(dt.LOOP)}get muted(){var t,e;return(e=(t=this.media)==null?void 0:t.muted)!=null?e:!1}set muted(t){this.media&&(this.media.muted=Boolean(t))}get defaultMuted(){return Pi(this,dt.MUTED)!=null}set defaultMuted(t){t?this.setAttribute(dt.MUTED,""):this.removeAttribute(dt.MUTED)}get playsInline(){return Pi(this,dt.PLAYSINLINE)!=null}set playsInline(t){vr("playsInline is set to true by default and is not currently supported as a setter.")}get preload(){return this.media?this.media.preload:this.getAttribute("preload")}set preload(t){["","none","metadata","auto"].includes(t)?this.setAttribute(dt.PRELOAD,t):this.removeAttribute(dt.PRELOAD)}};function Pi(t,e){return t.media?t.media.getAttribute(e):t.getAttribute(e)}var tu=Gf,yu=`
  :host {
    cursor: pointer;
  }
  media-time-display {
    color: inherit;
  }
`,Tu=ir.createElement("template");Tu.innerHTML=`
  <style>
    ${yu}
  </style>
  <media-time-display show-duration></media-time-display>
`;var ru=["Enter"," "],Va,wi,$a,Ja=class extends ct.HTMLElement{constructor(){var t,e;super(),Ve(this,wi),Ve(this,Va,void 0),this.attachShadow({mode:"open"}),(t=this.shadowRoot)==null||t.appendChild(this.constructor.template.content.cloneNode(!0)),this.timeDisplayEl=(e=this.shadowRoot)==null?void 0:e.querySelector("media-time-display")}static get observedAttributes(){return["hide-duration","remaining","disabled","aria-disabled"]}toggleTimeDisplay(){var t,e,r;(t=this.timeDisplayEl)!=null&&t.hasAttribute("remaining")?(e=this.timeDisplayEl)==null||e.removeAttribute("remaining"):(r=this.timeDisplayEl)==null||r.setAttribute("remaining","")}connectedCallback(){let t=e=>{let{key:r}=e;if(!ru.includes(r)){this.removeEventListener("keyup",t);return}this.toggleTimeDisplay()};this.addEventListener("keydown",e=>{let{metaKey:r,altKey:a,key:o}=e;if(r||a||!ru.includes(o)){this.removeEventListener("keyup",t);return}this.addEventListener("keyup",t)}),this.addEventListener("click",this.toggleTimeDisplay),Kt(this,Va,setInterval($e(this,wi,$a).bind(this),200)),requestAnimationFrame(()=>$e(this,wi,$a).call(this))}disconnectedCallback(){clearInterval(Re(this,Va))}attributeChangedCallback(t,e,r){var a,o;t==="hide-duration"&&$e(this,wi,$a).call(this),["remaining","disabled","aria-disabled"].includes(t)&&e!==r&&(r==null?(a=this.timeDisplayEl)==null||a.removeAttribute(t):(o=this.timeDisplayEl)==null||o.setAttribute(t,r))}};Va=new WeakMap,wi=new WeakSet,$a=function(){var t,e,r,a;getComputedStyle(this).getPropertyValue("--media-duration-display").trim()==="none"||this.getAttribute("hide-duration")!=null?(t=this.timeDisplayEl)!=null&&t.hasAttribute("show-duration")&&((e=this.timeDisplayEl)==null||e.removeAttribute("show-duration")):(r=this.timeDisplayEl)!=null&&r.hasAttribute("show-duration")||(a=this.timeDisplayEl)==null||a.setAttribute("show-duration","")},Ja.styles=yu,Ja.template=Tu;ct.customElements.get("mxp-time-display")||(ct.customElements.define("mxp-time-display",Ja),ct.MxpTimeDisplay=Ja);var jf=`:host {
  display: inline-block;
  width: 100%;
}

/* Hide custom elements that are not defined yet */
:not(:defined) {
  display: none;
}

a {
  color: #fff;
  font-size: 0.9em;
  text-decoration: underline;
}

[audio] [part~='seek-live'] {
  margin: 0;
  height: 42px;
  border-radius: 0;
  background-color: var(--media-control-background, rgba(20, 20, 30, 0.7));
}

[part~='seek-live'] {
  margin-left: 10px;
  margin-right: 5px;
  align-self: center;
  position: relative;
  box-sizing: border-box;
  padding: 4px 6px;
  border-radius: 12px;
  background-color: rgba(20, 20, 30, 0.7);
  font-size: 0.75rem;
  line-height: 1;
  color: #fff;
  border: none;
  cursor: pointer;
}

[part~='seek-live'] svg {
  width: 8px;
  fill: rgb(118, 118, 118);
}
[part~='seek-live'][in-live-window] svg {
  fill: #fb3c4d;
}

[part~='seek-live'][disabled] {
  opacity: 60%;
  cursor: not-allowed;
}
[part~='seek-live'][in-live-window] {
  opacity: 100%;
  cursor: unset;
}

::part(top),
[part~='top'] {
  --media-controls: var(--controls, var(--top-controls));
  --media-play-button: var(--play-button, var(--top-play-button));
  --media-seek-live-button: var(--seek-live-button, var(--top-seek-live-button));
  --media-seek-backward-button: var(--seek-backward-button, var(--top-seek-backward-button));
  --media-seek-forward-button: var(--seek-forward-button, var(--top-seek-forward-button));
  --media-mute-button: var(--mute-button, var(--top-mute-button));
  --media-captions-button: var(--captions-button, var(--top-captions-button));
  --media-airplay-button: var(--airplay-button, var(--top-airplay-button));
  --media-pip-button: var(--pip-button, var(--top-pip-button));
  --media-fullscreen-button: var(--fullscreen-button, var(--top-fullscreen-button));
  --media-cast-button: var(--cast-button, var(--top-cast-button));
  --media-playback-rate-button: var(--playback-rate-button, var(--top-playback-rate-button));
  --media-volume-range: var(--volume-range, var(--top-volume-range));
  --media-time-range: var(--time-range, var(--top-time-range));
  --media-time-display: var(--time-display, var(--top-time-display));
  --media-duration-display: var(--duration-display, var(--top-duration-display));
  --media-title-display: var(--title-display, var(--top-title-display));
}

::part(center),
[part~='center'] {
  --media-controls: var(--controls, var(--center-controls));
  --media-play-button: var(--play-button, var(--center-play-button));
  --media-seek-live-button: var(--seek-live-button, var(--center-seek-live-button));
  --media-seek-backward-button: var(--seek-backward-button, var(--center-seek-backward-button));
  --media-seek-forward-button: var(--seek-forward-button, var(--center-seek-forward-button));
  --media-mute-button: var(--mute-button, var(--center-mute-button));
  --media-captions-button: var(--captions-button, var(--center-captions-button));
  --media-airplay-button: var(--airplay-button, var(--center-airplay-button));
  --media-pip-button: var(--pip-button, var(--center-pip-button));
  --media-fullscreen-button: var(--fullscreen-button, var(--center-fullscreen-button));
  --media-cast-button: var(--cast-button, var(--center-cast-button));
  --media-playback-rate-button: var(--playback-rate-button, var(--center-playback-rate-button));
  --media-volume-range: var(--volume-range, var(--center-volume-range));
  --media-time-range: var(--time-range, var(--center-time-range));
  --media-time-display: var(--time-display, var(--center-time-display));
  --media-duration-display: var(--duration-display, var(--center-duration-display));
}

::part(bottom),
[part~='bottom'] {
  --media-controls: var(--controls, var(--bottom-controls));
  --media-play-button: var(--play-button, var(--bottom-play-button));
  --media-seek-live-button: var(--seek-live-button, var(--bottom-seek-live-button));
  --media-seek-backward-button: var(--seek-backward-button, var(--bottom-seek-backward-button));
  --media-seek-forward-button: var(--seek-forward-button, var(--bottom-seek-forward-button));
  --media-mute-button: var(--mute-button, var(--bottom-mute-button));
  --media-captions-button: var(--captions-button, var(--bottom-captions-button));
  --media-airplay-button: var(--airplay-button, var(--bottom-airplay-button));
  --media-pip-button: var(--pip-button, var(--bottom-pip-button));
  --media-fullscreen-button: var(--fullscreen-button, var(--bottom-fullscreen-button));
  --media-cast-button: var(--cast-button, var(--bottom-cast-button));
  --media-playback-rate-button: var(--playback-rate-button, var(--bottom-playback-rate-button));
  --media-volume-range: var(--volume-range, var(--bottom-volume-range));
  --media-time-range: var(--time-range, var(--bottom-time-range));
  --media-time-display: var(--time-display, var(--bottom-time-display));
  --media-duration-display: var(--duration-display, var(--bottom-duration-display));
  --media-title-display: var(--title-display, var(--bottom-title-display));
}

[part*='seek-live button'] {
  display: var(--media-controls, var(--media-seek-live-button));
}

/** Once we implement these CSS vars in Media Chrome below selectors can be deleted! */

::part(play button) {
  display: var(--media-controls, var(--media-play-button));
}
::part(seek-backward button) {
  display: var(--media-controls, var(--media-seek-backward-button));
}
::part(seek-forward button) {
  display: var(--media-controls, var(--media-seek-forward-button));
}
::part(mute button) {
  display: var(--media-controls, var(--media-mute-button));
}
::part(captions button) {
  display: var(--media-controls, var(--media-captions-button));
}
::part(airplay button) {
  display: var(--media-controls, var(--media-airplay-button));
}
::part(pip button) {
  display: var(--media-controls, var(--media-pip-button));
}
::part(fullscreen button) {
  display: var(--media-controls, var(--media-fullscreen-button));
}
::part(cast button) {
  display: var(--media-controls, var(--media-cast-button));
}
::part(playback-rate button) {
  display: var(--media-controls, var(--media-playback-rate-button));
}
::part(volume range) {
  display: var(--media-controls, var(--media-volume-range));
}
::part(time range) {
  display: var(--media-controls, var(--media-time-range));
}
::part(time display) {
  display: var(--media-controls, var(--media-time-display));
}
::part(title display) {
  display: var(--media-controls, var(--media-title-display));
}
`,Vf=`<template id="media-theme-mux">
  <style>
    :host(:not([audio])) {
      --secondary-color: transparent;
    }

    :host {
      --_primary-color: var(--primary-color, #fff);

      --media-icon-color: var(--_primary-color);
      --media-range-thumb-background: var(--_primary-color);
      --media-range-bar-color: var(--_primary-color);
      --media-control-background: var(--secondary-color);
      --media-control-hover-background: var(--secondary-color);
      --media-time-buffered-color: rgba(255, 255, 255, 0.4);
      --media-range-track-background: rgba(255, 255, 255, 0.5);
      --media-range-track-border-radius: 3px;
      --media-preview-thumbnail-border: 1px solid #fff;
      --media-preview-thumbnail-border-radius: 2px;
      --media-preview-time-margin: 5px 0 2px;
      color: var(--_primary-color);
      display: inline-block;
      width: 100%;
      height: 100%;
    }

    :host(.two-tone:not([audio])) {
      --mux-time-range-padding: 0px; /* px is needed in calc() */
      --media-preview-thumbnail-border: 0;
      --media-preview-thumbnail-border-radius: 2px 2px 0 0;
      --media-preview-time-border-radius: 0 0 2px 2px;
      --media-preview-time-margin: 0 0 8px;
      --media-preview-time-text-shadow: none;
    }

    :host([audio]) {
      --media-preview-time-border-radius: 3px;
      --media-preview-time-margin: 0 0 5px;
      --media-preview-time-text-shadow: none;
    }

    :host(.two-tone:not([audio])) media-time-range {
      --media-range-track-border-radius: 0;
    }

    :host([audio]) ::slotted([slot='media']) {
      height: 0px;
    }

    :host([audio]) :is(media-poster-image, media-loading-indicator) {
      display: none;
    }

    :host([audio]) media-controller {
      background: transparent;
    }

    :host([audio]) media-controller::part(vertical-layer) {
      background: transparent;
    }

    :host([audio]) media-control-bar {
      width: 100%;
    }

    [disabled],
    [aria-disabled='true'] {
      opacity: 60%;
      cursor: not-allowed;
    }

    media-captions-button:not(:is([media-captions-list], [media-subtitles-list])) {
      --captions-button: none;
    }

    media-volume-range[media-volume-unavailable] {
      --volume-range: none;
    }

    media-airplay-button[media-airplay-unavailable] {
      --airplay-button: none;
    }

    media-fullscreen-button[media-fullscreen-unavailable] {
      --fullscreen-button: none;
    }

    media-cast-button[media-cast-unavailable] {
      --cast-button: none;
    }

    media-pip-button[media-pip-unavailable] {
      --pip-button: none;
    }

    media-controller {
      width: 100%;
      height: 100%;
    }

    :host media-time-range {
      color: var(--_primary-color);
      --media-range-thumb-opacity: 0;
    }

    :host(:not([audio])) media-time-range {
      --media-range-padding-left: var(--mux-time-range-padding, 10px);
      --media-range-padding-right: var(--mux-time-range-padding, 10px);
      --media-range-padding: 0;
      z-index: 10;
      height: 10px;
      bottom: -3px;
      background: linear-gradient(
        180deg,
        transparent,
        transparent 3px,
        var(--media-control-background, rgba(20, 20, 30, 0.7)) 3px,
        var(--media-control-background, rgba(20, 20, 30, 0.7)) 7px,
        transparent 7px,
        transparent
      );
      width: 100%;
    }

    media-control-bar {
      --media-control-padding: 9px 7px;
    }

    .size-small media-control-bar {
      --media-control-padding: 9px 5px;
    }

    .size-extra-small media-control-bar {
      --media-control-padding: 4px 3px;
    }

    media-control-bar :is([role='button'], [role='switch'], button) {
      line-height: 0;
    }

    media-control-bar :is(media-text-display, mxp-time-display):first-child {
      --media-control-padding: 9px 5px 9px 10px;
    }

    .spacer {
      flex-grow: 1;
      background-color: var(--media-control-background, rgba(20, 20, 30, 0.7));
    }

    /* Add a small space on the right to have the play button and
     * fullscreen button aligned in relation to the progress bar. */
    media-control-bar:not([slot])::after {
      content: '';
      width: 2px;
      height: 100%;
      background-color: var(--media-control-background, rgba(20, 20, 30, 0.7));
    }

    media-control-bar[slot='top-chrome'] {
      min-height: 42px;
      pointer-events: none;
    }

    :host([title]) media-control-bar[slot='top-chrome']::before {
      content: '';
      position: absolute;
      width: 100%;
      padding-bottom: min(160px, 25%);
      background: linear-gradient(rgb(0 0 0 / 0.4), transparent);
    }

    media-control-bar[slot='top-chrome'] > * {
      --media-control-background: transparent;
      --media-control-hover-background: transparent;
      position: relative;
    }

    media-controller::part(vertical-layer) {
      transition: background-color 1s;
    }

    media-controller:is([media-paused], :not([user-inactive]))::part(vertical-layer) {
      background-color: var(--controls-backdrop-color, var(--controls, transparent));
      transition: background-color 0.25s;
    }

    .center-controls {
      --media-button-icon-width: 100%;
      --media-button-icon-height: auto;
      pointer-events: none;
      width: 100%;
      display: flex;
      flex-flow: row;
      align-items: center;
      justify-content: center;
      filter: drop-shadow(0 0 2px rgb(0 0 0 / 0.25)) drop-shadow(0 0 6px rgb(0 0 0 / 0.25));
      paint-order: stroke;
      stroke: rgba(102, 102, 102, 1);
      stroke-width: 0.3px;
      text-shadow: 0 0 2px rgb(0 0 0 / 0.25), 0 0 6px rgb(0 0 0 / 0.25);
    }

    .center-controls media-play-button {
      --media-control-background: transparent;
      --media-control-hover-background: transparent;
      padding: 0;
      width: max(43px, min(10%, 55px));
    }

    .center-controls media-seek-backward-button,
    .center-controls media-seek-forward-button {
      --media-control-background: transparent;
      --media-control-hover-background: transparent;
      padding: 0;
      margin: 0 2%;
      width: max(33px, min(8%, 40px));
    }

    media-control-bar:not([slot]) media-seek-backward-button {
      padding-right: 5px;
    }

    media-control-bar:not([slot]) media-seek-forward-button {
      padding-left: 5px;
    }

    media-loading-indicator {
      --media-loading-icon-width: 100%;
      --media-button-icon-height: auto;
      pointer-events: none;
      position: absolute;
      width: min(15%, 150px);
      display: flex;
      flex-flow: row;
      align-items: center;
      justify-content: center;
    }

    /* Intentionally don't target the div for transition but the children
     of the div. Prevents messing with media-chrome's autohide feature. */
    media-loading-indicator + div * {
      transition: opacity 0.15s;
      opacity: 1;
    }

    media-loading-indicator[media-loading]:not([media-paused]) ~ div > * {
      opacity: 0;
      transition-delay: 400ms;
    }

    media-volume-range {
      width: min(100%, 100px);
    }

    media-time-display {
      white-space: nowrap;
    }

    :is(media-time-display, media-text-display, media-playback-rate-button[role='button']) {
      color: inherit;
      line-height: 24px;
    }

    .title-display {
      font-size: 16px;
      text-shadow: 0 0 2px rgb(0 0 0 / 0.6);
    }

    :host([audio]) .title-display {
      flex-grow: 1;
      font-size: 21px;
    }
  </style>
  <media-controller
    gestures-disabled="{{disabled}}"
    hotkeys="{{hotkeys}}"
    nohotkeys="{{nohotkeys}}"
    audio="{{audio}}"
    class="size-{{playerSize}}"
    exportparts="layer, media-layer, poster-layer, vertical-layer, centered-layer, gesture-layer"
  >
    <slot name="media" slot="media"></slot>
    <media-poster-image
      slot="poster"
      part="poster"
      src="{{poster}}"
      placeholder-src="{{placeholder}}"
    ></media-poster-image>
    <media-loading-indicator slot="centered-chrome" no-auto-hide></media-loading-indicator>

    <template partial="TitleDisplay">
      <template if="title">
        <media-text-display part="top title display" class="title-display"> {{title}} </media-text-display>
      </template>
    </template>

    <template partial="PlayButton">
      <media-play-button
        part="{{section ?? 'bottom'}} play button"
        disabled="{{disabled}}"
        aria-disabled="{{disabled}}"
      >
        <svg aria-hidden="true" viewBox="0 0 24 24" slot="play">
          <path d="m6.73 20.93 14.05-8.54a.46.46 0 0 0 0-.78L6.73 3.07a.48.48 0 0 0-.73.39v17.07a.48.48 0 0 0 .73.4Z" />
        </svg>
        <svg aria-hidden="true" viewBox="0 0 24 24" slot="pause">
          <path
            d="M6 19.5a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-15a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v15ZM14.5 4a.5.5 0 0 0-.5.5v15a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-15a.5.5 0 0 0-.5-.5h-3Z"
          />
        </svg>
      </media-play-button>
    </template>

    <template partial="SeekBackwardButton">
      <media-seek-backward-button
        seek-offset="{{backwardSeekOffset}}"
        part="{{section ?? 'bottom'}} seek-backward button"
        disabled="{{disabled}}"
        aria-disabled="{{disabled}}"
      >
        <svg aria-hidden="true" viewBox="0 0 22 24" slot="backward">
          <path d="M11 6V3L5.37 7 11 10.94V8a5.54 5.54 0 0 1 1.9 10.48v2.12A7.5 7.5 0 0 0 11 6Z" />
          <text class="value" transform="translate(2.5 21)" style="font-size: 8px; font-family: 'ArialMT', 'Arial'">
            {{backwardSeekOffset}}
          </text>
        </svg>
      </media-seek-backward-button>
    </template>

    <template partial="SeekForwardButton">
      <media-seek-forward-button
        seek-offset="{{forwardSeekOffset}}"
        part="{{section ?? 'bottom'}} seek-forward button"
        disabled="{{disabled}}"
        aria-disabled="{{disabled}}"
      >
        <svg aria-hidden="true" viewBox="0 0 22 24" slot="forward">
          <path d="M11 6V3l5.61 4L11 10.94V8a5.54 5.54 0 0 0-1.9 10.48v2.12A7.5 7.5 0 0 1 11 6Z" />
          <text class="value" transform="translate(10 21)" style="font-size: 8px; font-family: 'ArialMT', 'Arial'">
            {{forwardSeekOffset}}
          </text>
        </svg>
      </media-seek-forward-button>
    </template>

    <template partial="MuteButton">
      <media-mute-button part="bottom mute button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
        <svg aria-hidden="true" viewBox="0 0 24 24" slot="high">
          <path
            d="m11.14 4.86-4 4a.49.49 0 0 1-.35.14H3.25a.25.25 0 0 0-.25.25v5.5a.25.25 0 0 0 .25.25h3.54a.49.49 0 0 1 .36.15l4 4a.5.5 0 0 0 .85-.36V5.21a.5.5 0 0 0-.86-.35Zm2.74-1.56v1.52A7.52 7.52 0 0 1 19.47 12a7.52 7.52 0 0 1-5.59 7.18v1.52A9 9 0 0 0 21 12a9 9 0 0 0-7.12-8.7Zm3.56 8.7a5.49 5.49 0 0 0-3.56-5.1v1.66a3.93 3.93 0 0 1 0 6.88v1.66a5.49 5.49 0 0 0 3.56-5.1Z"
          />
        </svg>
        <svg aria-hidden="true" viewBox="0 0 24 24" slot="low">
          <path
            d="m11.14 4.853-4 4a.49.49 0 0 1-.35.14H3.25a.25.25 0 0 0-.25.25v5.5a.25.25 0 0 0 .25.25h3.54a.49.49 0 0 1 .36.15l4 4a.5.5 0 0 0 .85-.36V5.203a.5.5 0 0 0-.86-.35Zm6.3 7.14a5.49 5.49 0 0 0-3.56-5.1v1.66a3.93 3.93 0 0 1 0 6.88v1.66a5.49 5.49 0 0 0 3.56-5.1Z"
          />
        </svg>
        <svg aria-hidden="true" viewBox="0 0 24 24" slot="medium">
          <path
            d="m11.14 4.853-4 4a.49.49 0 0 1-.35.14H3.25a.25.25 0 0 0-.25.25v5.5a.25.25 0 0 0 .25.25h3.54a.49.49 0 0 1 .36.15l4 4a.5.5 0 0 0 .85-.36V5.203a.5.5 0 0 0-.86-.35Zm6.3 7.14a5.49 5.49 0 0 0-3.56-5.1v1.66a3.93 3.93 0 0 1 0 6.88v1.66a5.49 5.49 0 0 0 3.56-5.1Z"
          />
        </svg>
        <svg aria-hidden="true" viewBox="0 0 24 24" slot="off">
          <path
            d="m3 4.05 4.48 4.47-.33.33a.49.49 0 0 1-.36.15H3.25a.25.25 0 0 0-.25.25v5.5a.25.25 0 0 0 .25.25h3.54a.49.49 0 0 1 .36.15l4 4a.48.48 0 0 0 .36.15.5.5 0 0 0 .5-.5v-5.75l4.67 4.66a7.71 7.71 0 0 1-2.79 1.47v1.52a9.32 9.32 0 0 0 3.87-1.91L20 21l1-1L4.06 3 3 4.05Zm5.36 5.36 2.39 2.39V17L8 14.26a1.74 1.74 0 0 0-1.24-.51H4.25v-3.5h2.54A1.74 1.74 0 0 0 8 9.74l.36-.33ZM19.47 12a7.19 7.19 0 0 1-.89 3.47l1.11 1.1A8.64 8.64 0 0 0 21 12a9 9 0 0 0-7.12-8.7v1.52A7.52 7.52 0 0 1 19.47 12ZM12 8.88V5.21a.5.5 0 0 0-.5-.5.48.48 0 0 0-.36.15L9.56 6.44 12 8.88ZM15.91 12a4.284 4.284 0 0 1-.07.72l1.22 1.22a5.2 5.2 0 0 0 .38-1.94 5.49 5.49 0 0 0-3.56-5.1v1.66A4 4 0 0 1 15.91 12Z"
          />
        </svg>
      </media-mute-button>
    </template>

    <template partial="PipButton">
      <media-pip-button part="bottom pip button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
        <svg aria-hidden="true" viewBox="0 0 26 24" slot="enter">
          <path
            d="M22 3H4a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h6.75v-1.25h-6.5V4.25h17.5v6.5H23V4a1 1 0 0 0-1-1Zm0 10h-8a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1Zm-.5 6.5h-7v-5h7v5Z"
          />
        </svg>
        <svg aria-hidden="true" viewBox="0 0 26 24" slot="exit">
          <path
            d="M22 3H4a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h6.75v-1.25h-6.5V4.25h17.5v6.5H23V4a1 1 0 0 0-1-1Zm0 10h-8a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1Zm-.5 6.5h-7v-5h7v5Z"
          />
        </svg>
      </media-pip-button>
    </template>

    <template partial="CaptionsButton">
      <media-captions-button
        default-showing="{{defaultShowingCaptions}}"
        part="bottom captions button"
        disabled="{{disabled}}"
        aria-disabled="{{disabled}}"
      >
        <svg aria-hidden="true" viewBox="0 0 26 24" slot="on">
          <path
            d="M22.832 5.68a2.58 2.58 0 0 0-2.3-2.5c-3.62-.24-11.44-.24-15.06 0a2.58 2.58 0 0 0-2.3 2.5c-.23 4.21-.23 8.43 0 12.64a2.58 2.58 0 0 0 2.3 2.5c3.62.24 11.44.24 15.06 0a2.58 2.58 0 0 0 2.3-2.5c.23-4.21.23-8.43 0-12.64Zm-11.41 10.1a3.63 3.63 0 0 1-1.51.32 4.76 4.76 0 0 1-1.63-.27 4 4 0 0 1-1.28-.83 3.67 3.67 0 0 1-.84-1.26 4.23 4.23 0 0 1-.3-1.63 4.28 4.28 0 0 1 .3-1.64 3.53 3.53 0 0 1 .84-1.21 3.89 3.89 0 0 1 1.29-.8 4.76 4.76 0 0 1 1.63-.27 4.06 4.06 0 0 1 1.35.24c.225.091.44.205.64.34a2.7 2.7 0 0 1 .55.52l-1.27 1a1.79 1.79 0 0 0-.6-.46 2 2 0 0 0-.83-.16 2 2 0 0 0-1.56.69 2.35 2.35 0 0 0-.46.77 2.78 2.78 0 0 0-.16 1c-.009.34.046.68.16 1 .104.283.26.545.46.77.188.21.415.38.67.5a2 2 0 0 0 .84.18 1.87 1.87 0 0 0 .9-.21 1.78 1.78 0 0 0 .65-.6l1.38 1a2.88 2.88 0 0 1-1.22 1.01Zm7.52 0a3.63 3.63 0 0 1-1.51.32 4.76 4.76 0 0 1-1.63-.27 3.89 3.89 0 0 1-1.28-.83 3.55 3.55 0 0 1-.85-1.26 4.23 4.23 0 0 1-.3-1.63 4.28 4.28 0 0 1 .3-1.64 3.43 3.43 0 0 1 .85-1.25 3.75 3.75 0 0 1 1.28-.8 4.76 4.76 0 0 1 1.63-.27 4 4 0 0 1 1.35.24c.225.091.44.205.64.34.21.144.395.32.55.52l-1.27 1a1.79 1.79 0 0 0-.6-.46 2 2 0 0 0-.83-.16 2 2 0 0 0-1.56.69 2.352 2.352 0 0 0-.46.77 3.01 3.01 0 0 0-.16 1c-.003.34.05.678.16 1 .108.282.263.542.46.77.188.21.416.38.67.5a2 2 0 0 0 .84.18 1.87 1.87 0 0 0 .9-.21 1.78 1.78 0 0 0 .65-.6l1.38 1a2.82 2.82 0 0 1-1.21 1.05Z"
          />
        </svg>
        <svg aria-hidden="true" viewBox="0 0 26 24" slot="off">
          <path
            d="M22.832 5.68a2.58 2.58 0 0 0-2.3-2.5c-1.81-.12-4.67-.18-7.53-.18-2.86 0-5.72.06-7.53.18a2.58 2.58 0 0 0-2.3 2.5c-.23 4.21-.23 8.43 0 12.64a2.58 2.58 0 0 0 2.3 2.5c1.81.12 4.67.18 7.53.18 2.86 0 5.72-.06 7.53-.18a2.58 2.58 0 0 0 2.3-2.5c.23-4.21.23-8.43 0-12.64Zm-1.49 12.53a1.11 1.11 0 0 1-.91 1.11c-1.67.11-4.45.18-7.43.18-2.98 0-5.76-.07-7.43-.18a1.11 1.11 0 0 1-.91-1.11c-.21-4.137-.21-8.283 0-12.42a1.11 1.11 0 0 1 .91-1.11c1.67-.11 4.43-.18 7.43-.18s5.76.07 7.43.18a1.11 1.11 0 0 1 .91 1.11c.21 4.137.21 8.283 0 12.42ZM10.843 14a1.55 1.55 0 0 1-.76.18 1.57 1.57 0 0 1-.71-.18 1.69 1.69 0 0 1-.57-.42 2.099 2.099 0 0 1-.38-.58 2.47 2.47 0 0 1 0-1.64 2 2 0 0 1 .39-.66 1.73 1.73 0 0 1 .58-.42c.23-.103.479-.158.73-.16.241-.004.48.044.7.14.199.088.373.222.51.39l1.08-.89a2.179 2.179 0 0 0-.47-.44 2.81 2.81 0 0 0-.54-.32 2.91 2.91 0 0 0-.58-.15 2.71 2.71 0 0 0-.56 0 4.08 4.08 0 0 0-1.38.15 3.27 3.27 0 0 0-1.09.67 3.14 3.14 0 0 0-.71 1.06 3.62 3.62 0 0 0-.26 1.39 3.57 3.57 0 0 0 .26 1.38 3 3 0 0 0 .71 1.06c.316.293.687.52 1.09.67.443.16.91.238 1.38.23a3.2 3.2 0 0 0 1.28-.27c.401-.183.747-.47 1-.83l-1.17-.88a1.42 1.42 0 0 1-.53.52Zm6.62 0a1.58 1.58 0 0 1-.76.18 1.54 1.54 0 0 1-.7-.18 1.69 1.69 0 0 1-.57-.42 2.12 2.12 0 0 1-.43-.58 2.29 2.29 0 0 1 .39-2.3 1.84 1.84 0 0 1 1.32-.58c.241-.003.48.045.7.14.199.088.373.222.51.39l1.08-.92a2.43 2.43 0 0 0-.47-.44 3.22 3.22 0 0 0-.53-.29 2.999 2.999 0 0 0-.57-.15 2.87 2.87 0 0 0-.57 0 4.06 4.06 0 0 0-1.36.15 3.17 3.17 0 0 0-1.09.67 3 3 0 0 0-.72 1.06 3.62 3.62 0 0 0-.25 1.39 3.57 3.57 0 0 0 .25 1.38c.16.402.405.764.72 1.06a3.17 3.17 0 0 0 1.09.67c.44.16.904.237 1.37.23.441 0 .877-.092 1.28-.27a2.45 2.45 0 0 0 1-.83l-1.15-.85a1.49 1.49 0 0 1-.54.49Z"
          />
        </svg>
      </media-captions-button>
    </template>

    <template partial="AirplayButton">
      <media-airplay-button part="bottom airplay button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
        <svg aria-hidden="true" viewBox="0 0 26 24" slot="airplay">
          <path
            d="M13.19 14.22a.25.25 0 0 0-.38 0l-5.46 6.37a.25.25 0 0 0 .19.41h10.92a.25.25 0 0 0 .19-.41l-5.46-6.37Z"
          />
          <path
            d="M22 3H4a1 1 0 0 0-1 1v13a1 1 0 0 0 1 1h2.94L8 16.75H4.25V4.25h17.5v12.5H18L19.06 18H22a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1Z"
          />
        </svg>
      </media-airplay-button>
    </template>

    <template partial="FullscreenButton">
      <media-fullscreen-button part="bottom fullscreen button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
        <svg aria-hidden="true" viewBox="0 0 24 24" slot="enter">
          <path
            d="M20.25 14.5a.76.76 0 0 0-.75.75v4.25h-4.25a.75.75 0 1 0 0 1.5h5a.76.76 0 0 0 .75-.75v-5a.76.76 0 0 0-.75-.75Zm0-11.5h-5a.76.76 0 0 0-.75.75.76.76 0 0 0 .75.75h4.25v4.25a.75.75 0 1 0 1.5 0v-5a.76.76 0 0 0-.75-.75ZM8.75 19.5H4.5v-4.25a.76.76 0 0 0-.75-.75.76.76 0 0 0-.75.75v5a.76.76 0 0 0 .75.75h5a.75.75 0 1 0 0-1.5Zm0-16.5h-5a.76.76 0 0 0-.75.75v5a.76.76 0 0 0 .75.75.76.76 0 0 0 .75-.75V4.5h4.25a.76.76 0 0 0 .75-.75.76.76 0 0 0-.75-.75Z"
          />
        </svg>
        <svg aria-hidden="true" viewBox="0 0 24 24" slot="exit">
          <path
            d="M20.25 14.5h-5a.76.76 0 0 0-.75.75v5a.75.75 0 1 0 1.5 0V16h4.25a.75.75 0 1 0 0-1.5Zm-5-5h5a.75.75 0 1 0 0-1.5H16V3.75a.75.75 0 1 0-1.5 0v5a.76.76 0 0 0 .75.75Zm-6.5 5h-5a.75.75 0 1 0 0 1.5H8v4.25a.75.75 0 1 0 1.5 0v-5a.76.76 0 0 0-.75-.75Zm0-11.5a.76.76 0 0 0-.75.75V8H3.75a.75.75 0 0 0 0 1.5h5a.76.76 0 0 0 .75-.75v-5A.76.76 0 0 0 8.75 3Z"
          />
        </svg>
      </media-fullscreen-button>
    </template>

    <template partial="CastButton">
      <media-cast-button part="bottom cast button" disabled="{{disabled}}" aria-disabled="{{disabled}}">
        <svg aria-hidden="true" viewBox="0 0 26 24" slot="enter">
          <path d="M3 15.5V17c2.206 0 4 1.794 4 4h1.5A5.5 5.5 0 0 0 3 15.5Zm0 3V21h2.5A2.5 2.5 0 0 0 3 18.5Z" />
          <path d="M3 12.5V14c3.86 0 7 3.14 7 7h1.5A8.5 8.5 0 0 0 3 12.5Z" />
          <path
            d="M22 3H4a1 1 0 0 0-1 1v6.984c.424 0 .84.035 1.25.086V4.25h17.5v15.5h-8.82c.051.41.086.826.086 1.25H22a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1Z"
          />
        </svg>
        <svg aria-hidden="true" viewBox="0 0 26 24" slot="exit">
          <path d="M3 15.5V17c2.206 0 4 1.794 4 4h1.5A5.5 5.5 0 0 0 3 15.5Zm0 3V21h2.5A2.5 2.5 0 0 0 3 18.5Z" />
          <path d="M3 12.5V14c3.86 0 7 3.14 7 7h1.5A8.5 8.5 0 0 0 3 12.5Z" />
          <path
            d="M22 3H4a1 1 0 0 0-1 1v6.984c.424 0 .84.035 1.25.086V4.25h17.5v15.5h-8.82c.051.41.086.826.086 1.25H22a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1Z"
          />
          <path d="M20.5 5.5h-15v5.811c3.52.906 6.283 3.67 7.189 7.19H20.5V5.5Z" />
        </svg>
      </media-cast-button>
    </template>

    <template partial="PlaybackRateButton">
      <media-playback-rate-button
        rates="{{playbackRates}}"
        part="bottom playback-rate button"
        disabled="{{disabled}}"
        aria-disabled="{{disabled}}"
      ></media-playback-rate-button>
    </template>

    <template partial="VolumeRange">
      <media-volume-range
        part="bottom volume range"
        disabled="{{disabled}}"
        aria-disabled="{{disabled}}"
      ></media-volume-range>
    </template>

    <template partial="TimeDisplay">
      <mxp-time-display
        remaining="{{defaultShowRemainingTime}}"
        part="bottom time display"
        disabled="{{disabled}}"
        aria-disabled="{{disabled}}"
      ></mxp-time-display>
    </template>

    <template partial="TimeRange">
      <media-time-range
        part="bottom time range"
        disabled="{{disabled}}"
        aria-disabled="{{disabled}}"
      ></media-time-range>
    </template>

    <template if="layout == 'audio on-demand'">
      <template if="title">
        <media-control-bar>{{>TitleDisplay}}</media-control-bar>
      </template>
      <media-control-bar>
        {{>PlayButton}} {{>SeekBackwardButton}} {{>SeekForwardButton}} {{>TimeDisplay}} {{>TimeRange}} {{>MuteButton}}
        {{>VolumeRange}} {{>PlaybackRateButton}} {{>AirplayButton}} {{>CastButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'audio dvr'">
      <template if="title">
        <media-control-bar>{{>TitleDisplay}}</media-control-bar>
      </template>
      <media-control-bar>
        {{>PlayButton}}
        <slot name="seek-live"></slot>
        {{>SeekBackwardButton}} {{>SeekForwardButton}} {{>TimeDisplay}} {{>TimeRange}} {{>MuteButton}} {{>VolumeRange}}
        {{>PlaybackRateButton}} {{>AirplayButton}} {{>CastButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'audio live'">
      <template if="title">
        <media-control-bar>{{>TitleDisplay}}</media-control-bar>
      </template>
      <media-control-bar>
        {{>PlayButton}}
        <slot name="seek-live"></slot>
        {{>MuteButton}} {{>VolumeRange}}
        <div class="spacer"></div>
        {{>AirplayButton}} {{>CastButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'on-demand extra-small'">
      {{>TimeRange}}
      <media-control-bar>
        {{>PlayButton}} {{>MuteButton}}
        <div class="spacer"></div>
        {{>CaptionsButton}} {{>FullscreenButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'on-demand small'">
      <media-control-bar slot="top-chrome"> {{>TitleDisplay}} </media-control-bar>
      <div slot="centered-chrome" class="center-controls">
        {{>SeekBackwardButton section="center"}} {{>PlayButton section="center"}} {{>SeekForwardButton
        section="center"}}
      </div>
      {{>TimeRange}}
      <media-control-bar>
        {{>TimeDisplay}} {{>MuteButton}} {{>VolumeRange}}
        <div class="spacer"></div>
        {{>PlaybackRateButton}} {{>CaptionsButton}} {{>AirplayButton}} {{>CastButton}} {{>PipButton}}
        {{>FullscreenButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'on-demand large'">
      <media-control-bar slot="top-chrome"> {{>TitleDisplay}} </media-control-bar>
      <div slot="centered-chrome" class="center-controls">{{>PlayButton section="center"}}</div>
      {{>TimeRange}}
      <media-control-bar>
        {{>PlayButton}} {{>SeekBackwardButton}} {{>SeekForwardButton}} {{>TimeDisplay}} {{>MuteButton}} {{>VolumeRange}}
        <div class="spacer"></div>
        {{>PlaybackRateButton}} {{>CaptionsButton}} {{>AirplayButton}} {{>CastButton}} {{>PipButton}}
        {{>FullscreenButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'live extra-small'">
      <media-control-bar slot="top-chrome">
        <slot name="seek-live"></slot>
      </media-control-bar>
      <media-control-bar>
        {{>PlayButton}} {{>MuteButton}}
        <div class="spacer"></div>
        {{>CaptionsButton}} {{>FullscreenButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'live small'">
      <media-control-bar slot="top-chrome">
        <slot name="seek-live"></slot>
        {{>TitleDisplay}}
      </media-control-bar>
      <div slot="centered-chrome" class="center-controls">{{>PlayButton section="center"}}</div>
      <media-control-bar>
        {{>MuteButton}} {{>VolumeRange}}
        <div class="spacer"></div>
        {{>CaptionsButton}} {{>AirplayButton}} {{>CastButton}} {{>PipButton}} {{>FullscreenButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'live large'">
      <media-control-bar slot="top-chrome">
        <slot name="seek-live"></slot>
        {{>TitleDisplay}}
      </media-control-bar>
      <div slot="centered-chrome" class="center-controls">{{>PlayButton section="center"}}</div>
      <media-control-bar>
        {{>PlayButton}} {{>MuteButton}} {{>VolumeRange}}
        <div class="spacer"></div>
        {{>CaptionsButton}} {{>AirplayButton}} {{>CastButton}} {{>PipButton}} {{>FullscreenButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'dvr extra-small'">
      <media-control-bar slot="top-chrome">
        <slot name="seek-live"></slot>
      </media-control-bar>
      {{>TimeRange}}
      <media-control-bar>
        {{>PlayButton}} {{>MuteButton}}
        <div class="spacer"></div>
        {{>CaptionsButton}} {{>FullscreenButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'dvr small'">
      <media-control-bar slot="top-chrome">
        <slot name="seek-live"></slot>
        {{>TitleDisplay}}
      </media-control-bar>
      <div slot="centered-chrome" class="center-controls">
        {{>SeekBackwardButton section="center"}} {{>PlayButton section="center"}} {{>SeekForwardButton
        section="center"}}
      </div>
      {{>TimeRange}}
      <media-control-bar>
        {{>MuteButton}} {{>VolumeRange}}
        <div class="spacer"></div>
        {{>CaptionsButton}} {{>AirplayButton}} {{>CastButton}} {{>PipButton}} {{>FullscreenButton}}
      </media-control-bar>
    </template>

    <template if="layout == 'dvr large'">
      <media-control-bar slot="top-chrome">
        <slot name="seek-live"></slot>
        {{>TitleDisplay}}
      </media-control-bar>
      <div slot="centered-chrome" class="center-controls">{{>PlayButton section="center"}}</div>
      {{>TimeRange}}
      <media-control-bar>
        {{>PlayButton}} {{>SeekBackwardButton}} {{>SeekForwardButton}} {{>MuteButton}} {{>VolumeRange}}
        <div class="spacer"></div>
        {{>CaptionsButton}} {{>AirplayButton}} {{>CastButton}} {{>PipButton}} {{>FullscreenButton}}
      </media-control-bar>
    </template>

    <slot></slot>
  </media-controller>
</template>
`,bu=`
  :host {
    z-index: 100;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    box-sizing: border-box;
    color: #fff;
    line-height: 18px;
    font-family: Arial, sans-serif;
    padding: var(--media-dialog-backdrop-padding, 0);
    background: var(--media-dialog-backdrop-background,
      linear-gradient(to bottom, rgba(20, 20, 30, 0.7) 50%, rgba(20, 20, 30, 0.9))
    );
    /* Needs to use !important to prevent overwrite of media-chrome */
    transition: var(--media-dialog-transition-open, visibility .2s, opacity .2s) !important;
    transform: var(--media-dialog-transform-open, none) !important;
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: auto !important;
  }

  :host(:not([open])) {
    /* Needs to use !important to prevent overwrite of media-chrome */
    transition: var(--media-dialog-transition-close, visibility .1s, opacity .1s) !important;
    transform: var(--media-dialog-transform-close, none) !important;
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
  }

  :focus-visible {
    box-shadow: 0 0 0 2px rgba(27, 127, 204, 0.9);
  }

  .dialog {
    position: relative;
    box-sizing: border-box;
    background: var(--media-dialog-background, none);
    padding: var(--media-dialog-padding, 10px);
    width: min(320px, 100%);
    word-wrap: break-word;
    max-height: 100%;
    overflow: auto;
    text-align: center;
    line-height: 1.4;
  }
`,Au=ir.createElement("template");Au.innerHTML=`
  <style>
    ${bu}
  </style>

  <div class="dialog">
    <slot></slot>
  </div>
`;var ti=class extends ct.HTMLElement{constructor(){var t;super(),this.attachShadow({mode:"open"}),(t=this.shadowRoot)==null||t.appendChild(this.constructor.template.content.cloneNode(!0))}show(){this.setAttribute("open",""),this.dispatchEvent(new CustomEvent("open",{composed:!0,bubbles:!0})),iu(this)}close(){!this.hasAttribute("open")||(this.removeAttribute("open"),this.dispatchEvent(new CustomEvent("close",{composed:!0,bubbles:!0})),$f(this))}attributeChangedCallback(t,e,r){t==="open"&&e!==r&&(r!=null?this.show():this.close())}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","dialog"),this.hasAttribute("open")&&iu(this)}};ti.styles=bu,ti.template=Au,ti.observedAttributes=["open"];function iu(t){let e=new CustomEvent("initfocus",{composed:!0,bubbles:!0,cancelable:!0});if(t.dispatchEvent(e),e.defaultPrevented)return;let r=t.querySelector("[autofocus]:not([disabled])");!r&&t.tabIndex>=0&&(r=t),r||(r=_u(t.shadowRoot)),t._previouslyFocusedElement=ir.activeElement,ir.activeElement instanceof HTMLElement&&ir.activeElement.blur(),t.addEventListener("transitionend",()=>{r instanceof HTMLElement&&r.focus({preventScroll:!0})},{once:!0})}function _u(t){let e=["button","input","keygen","select","textarea"].map(function(a){return a+":not([disabled])"});e.push('[tabindex]:not([disabled]):not([tabindex=""])');let r=t==null?void 0:t.querySelector(e.join(", "));if(!r&&"attachShadow"in Element.prototype){let a=(t==null?void 0:t.querySelectorAll("*"))||[];for(let o=0;o<a.length&&!(a[o].tagName&&a[o].shadowRoot&&(r=_u(a[o].shadowRoot),r));o++);}return r}function $f(t){t._previouslyFocusedElement instanceof HTMLElement&&t._previouslyFocusedElement.focus()}ct.customElements.get("media-dialog")||(ct.customElements.define("media-dialog",ti),ct.MediaDialog=ti);var Su=ti,xu=ir.createElement("template");xu.innerHTML=`
  <style>
    ${Su.styles}

    .close {
      background: none;
      color: inherit;
      border: none;
      padding: 0;
      font: inherit;
      cursor: pointer;
      outline: inherit;
      width: 28px;
      height: 28px;
      position: absolute;
      top: 1rem;
      right: 1rem;
    }
  </style>

  <div class="dialog">
    <slot></slot>
  </div>

  <slot name="close">
    <button class="close" tabindex="0">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </slot>
`;var Rs=class extends Su{constructor(){var t,e;super(),(e=(t=this.shadowRoot)==null?void 0:t.querySelector(".close"))==null||e.addEventListener("click",()=>{this.close()})}};Rs.template=xu;ct.customElements.get("mxp-dialog")||(ct.customElements.define("mxp-dialog",Rs),ct.MxpDialog=Rs);var ki=new WeakMap,Du=class{constructor(t,e){this.element=t,this.type=e,this.element.addEventListener(this.type,this);let r=ki.get(this.element);r&&r.set(this.type,this)}set(t){if(typeof t=="function")this.handleEvent=t.bind(this.element);else if(typeof t=="object"&&typeof t.handleEvent=="function")this.handleEvent=t.handleEvent.bind(t);else{this.element.removeEventListener(this.type,this);let e=ki.get(this.element);e&&e.delete(this.type)}}static for(t){ki.has(t.element)||ki.set(t.element,new Map);let e=t.attributeName.slice(2),r=ki.get(t.element);return r&&r.has(e)?r.get(e):new Du(t.element,e)}};function Yf(t,e){return t instanceof pt&&t.attributeName.startsWith("on")?(Du.for(t).set(e),t.element.removeAttributeNS(t.attributeNamespace,t.attributeName),!0):!1}function zf(t,e){return e instanceof Lu&&t instanceof er?(e.renderInto(t),!0):!1}function Xf(t,e){return e instanceof DocumentFragment&&t instanceof er?(e.childNodes.length&&t.replace(...e.childNodes),!0):!1}function Qf(t,e){if(t instanceof pt){let r=t.attributeNamespace,a=t.element.getAttributeNS(r,t.attributeName);return String(e)!==a&&(t.value=String(e)),!0}return t.value=String(e),!0}function Zf(t,e){if(t instanceof pt&&e instanceof Element){let r=t.element;return r[t.attributeName]!==e&&(t.element.removeAttributeNS(t.attributeNamespace,t.attributeName),r[t.attributeName]=e),!0}return!1}function Jf(t,e){if(typeof e=="boolean"&&t instanceof pt){let r=t.attributeNamespace,a=t.element.hasAttributeNS(r,t.attributeName);return e!==a&&(t.booleanValue=e),!0}return!1}function qf(t,e){return e===!1&&t instanceof er?(t.replace(""),!0):!1}function eh(t,e){Zf(t,e)||Jf(t,e)||Yf(t,e)||qf(t,e)||zf(t,e)||Xf(t,e)||Qf(t,e)}var Ds=new Map,au=new WeakMap,nu=new WeakMap,Lu=class{constructor(t,e,r){this.strings=t,this.values=e,this.processor=r,this.stringsKey=this.strings.join("")}get template(){if(Ds.has(this.stringsKey))return Ds.get(this.stringsKey);{let t=ir.createElement("template"),e=this.strings.length-1;return t.innerHTML=this.strings.reduce((r,a,o)=>r+a+(o<e?`{{ ${o} }}`:""),""),Ds.set(this.stringsKey,t),t}}renderInto(t){let e=this.template;if(au.get(t)!==e){au.set(t,e);let a=new qt(e,this.values,this.processor);nu.set(t,a),t instanceof er?t.replace(...a.children):t.appendChild(a);return}let r=nu.get(t);r&&r.update(this.values)}},th={processCallback(t,e,r){var a;if(r){for(let[o,c]of e)if(o in r){let O=(a=r[o])!=null?a:"";eh(c,O)}}}};function Xt(t,...e){return new Lu(t,e,th)}function rh(t,e){t.renderInto(e)}var Ms=ir.createElement("template");"innerHTML"in Ms&&(Ms.innerHTML=Vf);var ih=t=>Xt`
  <style>
    ${jf}
  </style>
  ${sh(t)}
`,Cs=t=>[we.LIVE,we.LL_LIVE].includes(t.streamType),$s=t=>[we.LIVE,we.LL_LIVE,we.DVR,we.LL_DVR].includes(t.streamType),ah=t=>{let e="";return t.audio&&(e+="audio "),Cs(t)?e+="live":$s(t)?e+="dvr":e+=t.streamType||"on-demand",!t.audio&&t.playerSize&&(e+=` ${t.playerSize}`),e},nh=t=>{let e=t.hotKeys?`${t.hotKeys}`:"";return $s(t)&&(e+=" noarrowleft noarrowright"),e},sh=t=>{var e,r,a,o,c,O,C,M,D,A,_,I,S,T,x,v,i,u,p,b,l,s,h,E,n,d,m,f,g,y,R,L;return Xt`
  <media-theme
    template="${(e=t.theme)!=null?e:Ms.content.children[0]}"
    class="size-${t.playerSize}${t.secondaryColor?" two-tone":""}"
    player-size="${(r=t.playerSize)!=null?r:!1}"
    layout="${ah(t)}"
    hotkeys="${nh(t)||!1}"
    nohotkeys="${t.noHotKeys||!t.hasSrc||t.isDialogOpen||!1}"
    disabled="${!t.hasSrc||t.isDialogOpen}"
    audio="${(a=t.audio)!=null?a:!1}"
    style="${(o=xf({"--primary-color":t.primaryColor,"--secondary-color":t.secondaryColor}))!=null?o:!1}"
    default-showing-captions="${!t.defaultHiddenCaptions}"
    forward-seek-offset="${(c=t.forwardSeekOffset)!=null?c:!1}"
    backward-seek-offset="${(O=t.backwardSeekOffset)!=null?O:!1}"
    playback-rates="${(C=t.playbackRates)!=null?C:!1}"
    default-show-remaining-time="${(M=t.defaultShowRemainingTime)!=null?M:!1}"
    title="${(D=t.title)!=null?D:!1}"
    poster="${t.poster===""?!1:(A=t.poster)!=null?A:!1}"
    placeholder="${(_=t.placeholder)!=null?_:!1}"
    exportparts="top, center, bottom, layer, media-layer, poster-layer, vertical-layer, centered-layer, gesture-layer, poster, seek-live, play, button, seek-backward, seek-forward, mute, captions, airplay, pip, fullscreen, cast, playback-rate, volume, range, time, display"
  >
    <mux-video
      slot="media"
      crossorigin="${(I=t.crossOrigin)!=null?I:""}"
      playsinline
      autoplay="${(S=t.autoplay)!=null?S:!1}"
      muted="${(T=t.muted)!=null?T:!1}"
      loop="${(x=t.loop)!=null?x:!1}"
      preload="${(v=t.preload)!=null?v:!1}"
      debug="${(i=t.debug)!=null?i:!1}"
      prefer-cmcd="${(u=t.preferCmcd)!=null?u:!1}"
      disable-cookies="${(p=t.disableCookies)!=null?p:!1}"
      prefer-playback="${(b=t.preferPlayback)!=null?b:!1}"
      start-time="${t.startTime!=null?t.startTime:!1}"
      beacon-collection-domain="${(l=t.beaconCollectionDomain)!=null?l:!1}"
      player-software-name="${(s=t.playerSoftwareName)!=null?s:!1}"
      player-software-version="${(h=t.playerSoftwareVersion)!=null?h:!1}"
      env-key="${(E=t.envKey)!=null?E:!1}"
      stream-type="${(n=t.streamType)!=null?n:!1}"
      custom-domain="${(d=t.customDomain)!=null?d:!1}"
      src="${t.src?t.src:t.playbackId?Zl(t.playbackId,{domain:t.customDomain,token:t.tokens.playback}):!1}"
      cast-src="${t.src?t.src:t.playbackId?Zl(t.playbackId,{domain:t.customDomain,token:t.tokens.playback}):!1}"
      cast-stream-type="${Cs(t)?"live":!1}"
      exportparts="video"
    >
      ${t.storyboard?Xt`<track label="thumbnails" default kind="metadata" src="${t.storyboard}" />`:Xt``}
    </mux-video>
    ${$s(t)?Xt`<button
          slot="seek-live"
          part="${Cs(t)?"top":"bottom"} seek-live button"
          disabled="${t.inLiveWindow||!t.hasSrc||t.isDialogOpen}"
          aria-disabled="${(t.inLiveWindow||!t.hasSrc||t.isDialogOpen)&&"true"}"
          in-live-window="${t.inLiveWindow}"
          onclick="${function(P){var N;if((N=t.onSeekToLive)==null||N.call(t,P),t.paused){let B=new CustomEvent("mediaplayrequest",{composed:!0,bubbles:!0});this.dispatchEvent(B)}}}"
        >
          <svg viewBox="0 0 8 8"><circle cx="4" cy="4" r="4"></circle></svg>
          Live
        </button>`:Xt``}
    <mxp-dialog
      no-auto-hide
      open="${(m=t.isDialogOpen)!=null?m:!1}"
      onclose="${t.onCloseErrorDialog}"
      oninitfocus="${t.onInitFocusDialog}"
    >
      ${(f=t.dialog)!=null&&f.title?Xt`<h3>${t.dialog.title}</h3>`:Xt``}
      <p>
        ${(g=t.dialog)==null?void 0:g.message}
        ${(y=t.dialog)!=null&&y.linkUrl?Xt`<a
              href="${t.dialog.linkUrl}"
              target="_blank"
              rel="external noopener"
              aria-label="${(R=t.dialog.linkText)!=null?R:""} ${ke("(opens in a new window)")}"
              >${(L=t.dialog.linkText)!=null?L:t.dialog.linkUrl}</a
            >`:Xt``}
      </p>
    </mxp-dialog>
  </media-theme>
`};function Os(t,e,r,a,o){var c,O,C;let M={},D={};switch(t.code){case Ge.MEDIA_ERR_NETWORK:{switch(M.title=ke("Network Error",o),M.message=t.message,(c=t.data)==null?void 0:c.response.code){case 412:{M.title=ke("Video is not currently available",o),M.message=ke("The live stream or video file are not yet ready.",o),D.message=ke("This playback-id may belong to a live stream that is not currently active or an asset that is not ready.",o),D.file="412-not-playable.md";break}case 404:{M.title=ke("Video does not exist",o),M.message="",D.message=ke("This playback-id does not exist. You may have used an Asset ID or an ID from a different resource.",o),D.file="404-not-found.md";break}case 403:{if(M.title=ke("Invalid playback URL",o),M.message=ke("The video URL or playback-token are formatted with incorrect or incomplete information.",o),D.message=ke("403 error trying to access this playback URL. If this is a signed URL, you might need to provide a playback-token.",o),D.file="missing-signed-tokens.md",!a)break;let{exp:A,aud:_,sub:I}=Ki(a),S=Date.now()>A*1e3,T=I!==r,x=_!=="v",v={timeStyle:"medium",dateStyle:"medium"};if(S){M.title=ke("Video URL has expired",o),M.message=ke("The video\u2019s secured playback-token has expired.",o),D.message=ke("This playback is using signed URLs and the playback-token has expired. Expired at: {expiredDate}. Current time: {currentDate}.",o).format({expiredDate:new Intl.DateTimeFormat(Fi.code,v).format(A*1e3),currentDate:new Intl.DateTimeFormat(Fi.code,v).format(Date.now())}),D.file="403-expired-token.md";break}if(T){M.title=ke("Video URL is formatted incorrectly",o),M.message=ke("The video\u2019s playback ID does not match the one encoded in the playback-token.",o),D.message=ke("The specified playback ID {playbackId} and the playback ID encoded in the playback-token {tokenPlaybackId} do not match.",o).format({playbackId:r,tokenPlaybackId:I}),D.file="403-playback-id-mismatch.md";break}if(x){M.title=ke("Video URL is formatted incorrectly",o),M.message=ke("The playback-token is formatted with incorrect information.",o),D.message=ke("The playback-token has an incorrect aud value: {tokenType}. aud value should be v.",o).format({tokenType:_}),D.file="403-incorrect-aud-value.md";break}D.message=ke("403 error trying to access this playback URL. If this is a signed playback ID, the token might not have been generated correctly.",o),D.file="403-malformatted-token.md";break}}break}case Ge.MEDIA_ERR_DECODE:{let{message:A}=t;M={title:ke("Media Error",o),message:A},D.file="media-decode-error.md";break}case Ge.MEDIA_ERR_SRC_NOT_SUPPORTED:{let A=(C=(O=t.data)==null?void 0:O.response)==null?void 0:C.code;if(A>=400&&A<500){t.code=Ge.MEDIA_ERR_NETWORK,t.data={response:{code:A}},{dialog:M,devlog:D}=Os(t,e,r,a);break}M={title:ke("Source Not Supported",o),message:t.message},D.file="media-src-not-supported.md";break}default:M={title:ke("Error",o),message:t.message};break}return e&&(M={title:ke("Your device appears to be offline",o),message:ke("Check your internet connection and try reloading this video.",o)}),{dialog:M,devlog:D}}var oh=Object.values(we),lh=700,uh=300,Ls={LG:"large",SM:"small",XS:"extra-small"};function Ya(t){let e=t.getBoundingClientRect();return e.width<uh?Ls.XS:e.width<lh?Ls.SM:Ls.LG}var tr={SRC:"src",POSTER:"poster"},pe={STYLE:"style",DEFAULT_HIDDEN_CAPTIONS:"default-hidden-captions",PRIMARY_COLOR:"primary-color",SECONDARY_COLOR:"secondary-color",FORWARD_SEEK_OFFSET:"forward-seek-offset",BACKWARD_SEEK_OFFSET:"backward-seek-offset",PLAYBACK_TOKEN:"playback-token",THUMBNAIL_TOKEN:"thumbnail-token",STORYBOARD_TOKEN:"storyboard-token",THUMBNAIL_TIME:"thumbnail-time",AUDIO:"audio",NOHOTKEYS:"nohotkeys",HOTKEYS:"hotkeys",PLAYBACK_RATES:"playbackrates",DEFAULT_SHOW_REMAINING_TIME:"default-show-remaining-time",TITLE:"title",PLACEHOLDER:"placeholder"};function dh(t,e){var r,a;return{src:!t.playbackId&&t.src,playbackId:t.playbackId,hasSrc:!!t.playbackId||!!t.src,poster:t.poster,storyboard:t.storyboard,placeholder:t.getAttribute("placeholder"),theme:t.getAttribute("theme"),thumbnailTime:!t.tokens.thumbnail&&t.thumbnailTime,autoplay:t.autoplay,crossOrigin:t.crossOrigin,loop:t.loop,noHotKeys:t.hasAttribute(pe.NOHOTKEYS),hotKeys:t.getAttribute(pe.HOTKEYS),muted:t.muted,paused:t.paused,preload:t.preload,envKey:t.envKey,preferCmcd:t.preferCmcd,debug:t.debug,disableCookies:t.disableCookies,tokens:t.tokens,beaconCollectionDomain:t.beaconCollectionDomain,metadata:t.metadata,playerSoftwareName:t.playerSoftwareName,playerSoftwareVersion:t.playerSoftwareVersion,startTime:t.startTime,preferPlayback:t.preferPlayback,audio:t.audio,streamType:t.streamType,primaryColor:t.primaryColor,secondaryColor:t.secondaryColor,forwardSeekOffset:t.forwardSeekOffset,backwardSeekOffset:t.backwardSeekOffset,defaultHiddenCaptions:t.defaultHiddenCaptions,defaultShowRemainingTime:t.defaultShowRemainingTime,playbackRates:t.getAttribute(pe.PLAYBACK_RATES),customDomain:(r=t.getAttribute(le.CUSTOM_DOMAIN))!=null?r:void 0,playerSize:Ya((a=t.mediaController)!=null?a:t),title:t.getAttribute(pe.TITLE),...e}}var ch=Object.values(le),fh=Object.values(tr),hh=Object.values(pe),vh=mu(),mh="mux-player",su={dialog:void 0,isDialogOpen:!1,inLiveWindow:!1},ri,za,fr,Xa,Ui,rr,Ni,Qa,Ps,Iu,Ir,ei,Bi,Za,qa,ks,ws,Ru,Us,Mu,Ns,ou,Bs,lu,Fs,uu,Ks,du,Ws=class extends tu{constructor(){super(),Ve(this,Ni),Ve(this,Ps),Ve(this,Ir),Ve(this,Bi),Ve(this,qa),Ve(this,ws),Ve(this,Us),Ve(this,Ns),Ve(this,Bs),Ve(this,Fs),Ve(this,Ks),Ve(this,ri,!1),Ve(this,za,{}),Ve(this,fr,!0),Ve(this,Xa,new Bf(this,"hotkeys")),Ve(this,Ui,void 0),Ve(this,rr,{...su,onCloseErrorDialog:()=>$e(this,Ir,ei).call(this,{dialog:void 0,isDialogOpen:!1}),onInitFocusDialog:t=>{vu(this,ir.activeElement)||t.preventDefault()},onSeekToLive:()=>pu(this)}),this.attachShadow({mode:"open"}),$e(this,Ps,Iu).call(this),this.isConnected&&$e(this,Ni,Qa).call(this)}static get observedAttributes(){var t;return[...(t=tu.observedAttributes)!=null?t:[],...fh,...ch,...hh]}get theme(){var t;return(t=this.shadowRoot)==null?void 0:t.querySelector("media-theme")}get mediaController(){var t,e;return(e=(t=this.theme)==null?void 0:t.shadowRoot)==null?void 0:e.querySelector("media-controller")}get metadataFromAttrs(){return this.getAttributeNames().filter(t=>t.startsWith("metadata-")).reduce((t,e)=>{let r=this.getAttribute(e);return r!==null&&(t[e.replace(/^metadata-/,"").replace(/-/g,"_")]=r),t},{})}connectedCallback(){var t;$e(this,qa,ks).call(this);let e=(t=this.shadowRoot)==null?void 0:t.querySelector("mux-video");e&&(e.metadata=this.metadataFromAttrs),$e(this,ws,Ru).call(this)}disconnectedCallback(){$e(this,Us,Mu).call(this)}attributeChangedCallback(t,e,r){switch(Re(this,ri)||$e(this,Ni,Qa).call(this),super.attributeChangedCallback(t,e,r),t){case pe.HOTKEYS:Re(this,Xa).value=r;break;case pe.THUMBNAIL_TIME:{r!=null&&this.tokens.thumbnail&&Mr(ke("Use of thumbnail-time with thumbnail-token is currently unsupported. Ignore thumbnail-time.").format({}));break}case pe.THUMBNAIL_TOKEN:{let{aud:a}=Ki(r);r&&a!=="t"&&Mr(ke("The provided thumbnail-token should have audience value 't' instead of '{aud}'.").format({aud:a}));break}case pe.STORYBOARD_TOKEN:{let{aud:a}=Ki(r);r&&a!=="s"&&Mr(ke("The provided storyboard-token should have audience value 's' instead of '{aud}'.").format({aud:a}));break}case le.PLAYBACK_ID:{r!=null&&r.includes("?token")&&vr(ke("The specificed playback ID {playbackId} contains a token which must be provided via the playback-token attribute.").format({playbackId:r})),this.streamType?this.streamType!=null&&!oh.includes(this.streamType)&&Is({file:"invalid-stream-type.md",message:ke("Invalid stream-type value supplied: `{streamType}`. Please provide stream-type as either: `on-demand`, `live`, `ll-live`, `live:dvr`, or `ll-live:dvr`").format({streamType:this.streamType})}):Is({file:"invalid-stream-type.md",message:String(ke("No stream-type value supplied. Defaulting to `on-demand`. Please provide stream-type as either: `on-demand`, `live`, `ll-live`, `live:dvr`, or `ll-live:dvr`"))});break}}[le.PLAYBACK_ID,tr.SRC,pe.PLAYBACK_TOKEN].includes(t)&&e!==r&&Kt(this,rr,{...Re(this,rr),...su}),$e(this,Bi,Za).call(this,{[kf(t)]:r})}get preferCmcd(){var t;return(t=this.getAttribute(le.PREFER_CMCD))!=null?t:void 0}set preferCmcd(t){t!==this.preferCmcd&&(t?$r.includes(t)?this.setAttribute(le.PREFER_CMCD,t):Mr(`Invalid value for preferCmcd. Must be one of ${$r.join()}`):this.removeAttribute(le.PREFER_CMCD))}get hasPlayed(){var t,e;return(e=(t=this.mediaController)==null?void 0:t.hasAttribute("media-has-played"))!=null?e:!1}get inLiveWindow(){return Re(this,rr).inLiveWindow}get _hls(){var t;return(t=this.media)==null?void 0:t._hls}get mux(){var t;return(t=this.media)==null?void 0:t.mux}get playbackId(){var t;return(t=this.getAttribute(le.PLAYBACK_ID))!=null?t:void 0}set playbackId(t){t?this.setAttribute(le.PLAYBACK_ID,t):this.removeAttribute(le.PLAYBACK_ID)}get src(){var t,e;return this.playbackId?(t=hr(this,tr.SRC))!=null?t:void 0:(e=this.getAttribute(tr.SRC))!=null?e:void 0}set src(t){t?this.setAttribute(tr.SRC,t):this.removeAttribute(tr.SRC)}get poster(){var t;let e=this.getAttribute(tr.POSTER);if(e!=null)return e;if(this.playbackId&&!this.audio)return Cf(this.playbackId,{domain:this.customDomain,thumbnailTime:(t=this.thumbnailTime)!=null?t:this.startTime,token:this.tokens.thumbnail})}set poster(t){t||t===""?this.setAttribute(tr.POSTER,t):this.removeAttribute(tr.POSTER)}get storyboard(){if(this.playbackId&&!this.audio&&(!this.streamType||![we.LIVE,we.LL_LIVE,we.DVR,we.LL_DVR].includes(this.streamType)))return Of(this.playbackId,{domain:this.customDomain,token:this.tokens.storyboard})}get audio(){return this.hasAttribute(pe.AUDIO)}set audio(t){if(!t){this.removeAttribute(pe.AUDIO);return}this.setAttribute(pe.AUDIO,"")}get hotkeys(){return Re(this,Xa)}get nohotkeys(){return this.hasAttribute(pe.NOHOTKEYS)}set nohotkeys(t){if(!t){this.removeAttribute(pe.NOHOTKEYS);return}this.setAttribute(pe.NOHOTKEYS,"")}get thumbnailTime(){return Rr(this.getAttribute(pe.THUMBNAIL_TIME))}set thumbnailTime(t){this.setAttribute(pe.THUMBNAIL_TIME,`${t}`)}get title(){var t;return(t=this.getAttribute(pe.TITLE))!=null?t:""}set title(t){t!==this.title&&(t?this.setAttribute(pe.TITLE,t):this.removeAttribute("title"),super.title=t)}get placeholder(){var t;return(t=hr(this,pe.PLACEHOLDER))!=null?t:""}set placeholder(t){this.setAttribute(pe.PLACEHOLDER,`${t}`)}get primaryColor(){var t;return(t=this.getAttribute(pe.PRIMARY_COLOR))!=null?t:void 0}set primaryColor(t){this.setAttribute(pe.PRIMARY_COLOR,`${t}`)}get secondaryColor(){var t;return(t=this.getAttribute(pe.SECONDARY_COLOR))!=null?t:"rgb(0 0 0 / .65)"}set secondaryColor(t){this.setAttribute(pe.SECONDARY_COLOR,`${t}`)}get defaultShowRemainingTime(){return this.hasAttribute(pe.DEFAULT_SHOW_REMAINING_TIME)}set defaultShowRemainingTime(t){t?this.setAttribute(pe.DEFAULT_SHOW_REMAINING_TIME,""):this.removeAttribute(pe.DEFAULT_SHOW_REMAINING_TIME)}get playbackRates(){if(this.hasAttribute(pe.PLAYBACK_RATES))return this.getAttribute(pe.PLAYBACK_RATES).trim().split(/\s*,?\s+/).map(t=>Number(t)).filter(t=>!Number.isNaN(t)).sort((t,e)=>t-e)}set playbackRates(t){if(!t){this.removeAttribute(pe.PLAYBACK_RATES);return}this.setAttribute(pe.PLAYBACK_RATES,t.join(" "))}get forwardSeekOffset(){var t;return(t=Rr(this.getAttribute(pe.FORWARD_SEEK_OFFSET)))!=null?t:10}set forwardSeekOffset(t){this.setAttribute(pe.FORWARD_SEEK_OFFSET,`${t}`)}get backwardSeekOffset(){var t;return(t=Rr(this.getAttribute(pe.BACKWARD_SEEK_OFFSET)))!=null?t:10}set backwardSeekOffset(t){this.setAttribute(pe.BACKWARD_SEEK_OFFSET,`${t}`)}get defaultHiddenCaptions(){return this.hasAttribute(pe.DEFAULT_HIDDEN_CAPTIONS)}set defaultHiddenCaptions(t){t?this.setAttribute(pe.DEFAULT_HIDDEN_CAPTIONS,""):this.removeAttribute(pe.DEFAULT_HIDDEN_CAPTIONS)}get playerSoftwareName(){var t;return(t=this.getAttribute(le.PLAYER_SOFTWARE_NAME))!=null?t:mh}get playerSoftwareVersion(){var t;return(t=this.getAttribute(le.PLAYER_SOFTWARE_VERSION))!=null?t:vh}get beaconCollectionDomain(){var t;return(t=this.getAttribute(le.BEACON_COLLECTION_DOMAIN))!=null?t:void 0}set beaconCollectionDomain(t){t!==this.beaconCollectionDomain&&(t?this.setAttribute(le.BEACON_COLLECTION_DOMAIN,t):this.removeAttribute(le.BEACON_COLLECTION_DOMAIN))}get customDomain(){var t;return(t=this.getAttribute(le.CUSTOM_DOMAIN))!=null?t:void 0}set customDomain(t){t!==this.customDomain&&(t?this.setAttribute(le.CUSTOM_DOMAIN,t):this.removeAttribute(le.CUSTOM_DOMAIN))}get envKey(){var t;return(t=hr(this,le.ENV_KEY))!=null?t:void 0}set envKey(t){this.setAttribute(le.ENV_KEY,`${t}`)}get debug(){return hr(this,le.DEBUG)!=null}set debug(t){t?this.setAttribute(le.DEBUG,""):this.removeAttribute(le.DEBUG)}get disableCookies(){return hr(this,le.DISABLE_COOKIES)!=null}set disableCookies(t){t?this.setAttribute(le.DISABLE_COOKIES,""):this.removeAttribute(le.DISABLE_COOKIES)}get streamType(){return hr(this,le.STREAM_TYPE)}set streamType(t){this.setAttribute(le.STREAM_TYPE,`${t}`)}get startTime(){return Rr(hr(this,le.START_TIME))}set startTime(t){this.setAttribute(le.START_TIME,`${t}`)}get preferPlayback(){let t=this.getAttribute(le.PREFER_PLAYBACK);if(t===Ot.MSE||t===Ot.NATIVE)return t}set preferPlayback(t){t!==this.preferPlayback&&(t===Ot.MSE||t===Ot.NATIVE?this.setAttribute(le.PREFER_PLAYBACK,t):this.removeAttribute(le.PREFER_PLAYBACK))}get metadata(){var t;return(t=this.media)==null?void 0:t.metadata}set metadata(t){if(Re(this,ri)||$e(this,Ni,Qa).call(this),!this.media){vr("underlying media element missing when trying to set metadata. metadata will not be set.");return}this.media.metadata={...this.metadataFromAttrs,...t}}get tokens(){let t=this.getAttribute(pe.PLAYBACK_TOKEN),e=this.getAttribute(pe.THUMBNAIL_TOKEN),r=this.getAttribute(pe.STORYBOARD_TOKEN);return{...Re(this,za),...t!=null?{playback:t}:{},...e!=null?{thumbnail:e}:{},...r!=null?{storyboard:r}:{}}}set tokens(t){Kt(this,za,t!=null?t:{})}get playbackToken(){var t;return(t=this.getAttribute(pe.PLAYBACK_TOKEN))!=null?t:void 0}set playbackToken(t){this.setAttribute(pe.PLAYBACK_TOKEN,`${t}`)}get thumbnailToken(){var t;return(t=this.getAttribute(pe.THUMBNAIL_TOKEN))!=null?t:void 0}set thumbnailToken(t){this.setAttribute(pe.THUMBNAIL_TOKEN,`${t}`)}get storyboardToken(){var t;return(t=this.getAttribute(pe.STORYBOARD_TOKEN))!=null?t:void 0}set storyboardToken(t){this.setAttribute(pe.STORYBOARD_TOKEN,`${t}`)}addTextTrack(t,e,r,a){var o;let c=(o=this.media)==null?void 0:o.nativeEl;if(c)return ms(c,t,e,r,a)}removeTextTrack(t){var e;let r=(e=this.media)==null?void 0:e.nativeEl;if(r)return bl(r,t)}get textTracks(){var t;return(t=this.media)==null?void 0:t.textTracks}};ri=new WeakMap,za=new WeakMap,fr=new WeakMap,Xa=new WeakMap,Ui=new WeakMap,rr=new WeakMap,Ni=new WeakSet,Qa=function(){var t,e;if(!Re(this,ri)){Kt(this,ri,!0),$e(this,Ir,ei).call(this,{playerSize:Ya(this)});try{if(customElements.upgrade(this.theme),!(this.theme instanceof ct.HTMLElement))throw""}catch{vr("<media-theme> failed to upgrade!")}try{if(customElements.upgrade(this.media),!(this.media instanceof Fl))throw""}catch{vr("<mux-video> failed to upgrade!")}try{if(customElements.upgrade(this.mediaController),!(this.mediaController instanceof pi))throw""}catch{vr("<media-controller> failed to upgrade!")}Hf(this),$e(this,Bs,lu).call(this),$e(this,Fs,uu).call(this),$e(this,Ns,ou).call(this),Kt(this,fr,(e=(t=this.mediaController)==null?void 0:t.hasAttribute("user-inactive"))!=null?e:!0),$e(this,Ks,du).call(this)}},Ps=new WeakSet,Iu=function(){var t,e;try{(t=window==null?void 0:window.CSS)==null||t.registerProperty({name:"--primary-color",syntax:"<color>",inherits:!0,initialValue:"white"}),(e=window==null?void 0:window.CSS)==null||e.registerProperty({name:"--secondary-color",syntax:"<color>",inherits:!0,initialValue:"transparent"})}catch{}},Ir=new WeakSet,ei=function(t){Object.assign(Re(this,rr),t),$e(this,Bi,Za).call(this)},Bi=new WeakSet,Za=function(t={}){rh(ih(dh(this,{...Re(this,rr),...t})),this.shadowRoot)},qa=new WeakSet,ks=function(){var t,e;Re(this,rr).playerSize!=Ya((t=this.mediaController)!=null?t:this)&&$e(this,Ir,ei).call(this,{playerSize:Ya((e=this.mediaController)!=null?e:this)})},ws=new WeakSet,Ru=function(){var t;Kt(this,Ui,new ResizeObserver(()=>$e(this,qa,ks).call(this))),Re(this,Ui).observe((t=this.mediaController)!=null?t:this)},Us=new WeakSet,Mu=function(){var t;(t=Re(this,Ui))==null||t.disconnect()},Ns=new WeakSet,ou=function(){var t,e,r,a,o;(t=this.mediaController)==null||t.addEventListener("mediaplayrequest",O=>{var C;((C=O.target)==null?void 0:C.localName)==="media-play-button"&&this.streamType&&[we.LIVE,we.LL_LIVE,we.DVR,we.LL_DVR].includes(this.streamType)&&this.hasPlayed&&pu(this)});let c=()=>{let O=Nf(this),C=Re(this,rr).inLiveWindow;O!==C&&($e(this,Ir,ei).call(this,{inLiveWindow:O}),this.dispatchEvent(new CustomEvent("inlivewindowchange",{composed:!0,bubbles:!0,detail:this.inLiveWindow})))};(e=this.media)==null||e.addEventListener("progress",c),(r=this.media)==null||r.addEventListener("waiting",c),(a=this.media)==null||a.addEventListener("timeupdate",c),(o=this.media)==null||o.addEventListener("emptied",c)},Bs=new WeakSet,lu=function(){var t;let e=r=>{let{detail:a}=r;if(a instanceof Ge||(a=new Ge(a.message,a.code,a.fatal)),!(a!=null&&a.fatal)){Mr(a),a.data&&Mr(`${a.name} data:`,a.data);return}let{dialog:o,devlog:c}=Os(a,!window.navigator.onLine,this.playbackId,this.playbackToken);c.message&&Is(c),vr(a),a.data&&vr(`${a.name} data:`,a.data),$e(this,Ir,ei).call(this,{isDialogOpen:!0,dialog:o})};this.addEventListener("error",e),this.media&&(this.media.errorTranslator=(r={})=>{var a,o,c;if(!((a=this.media)!=null&&a.error))return r;let{devlog:O}=Os((o=this.media)==null?void 0:o.error,!window.navigator.onLine,this.playbackId,this.playbackToken,!1);return{player_error_code:(c=this.media)==null?void 0:c.error.code,player_error_message:O.message?String(O.message):r.player_error_message}}),(t=this.media)==null||t.addEventListener("error",r=>{var a,o;let{detail:c}=r;if(!c){let{message:O,code:C}=(o=(a=this.media)==null?void 0:a.error)!=null?o:{};c=new Ge(O,C)}!(c!=null&&c.fatal)||this.dispatchEvent(new CustomEvent("error",{detail:c}))})},Fs=new WeakSet,uu=function(){var t,e,r,a;let o=()=>$e(this,Bi,Za).call(this);(e=(t=this.media)==null?void 0:t.textTracks)==null||e.addEventListener("addtrack",o),(a=(r=this.media)==null?void 0:r.textTracks)==null||a.addEventListener("removetrack",o)},Ks=new WeakSet,du=function(){var t,e,r;let a=this.mediaController,o=/.*Version\/.*Safari\/.*/.test(navigator.userAgent);if(o)return;let c,O=new WeakMap,C=()=>this.streamType&&[we.LIVE,we.LL_LIVE].includes(this.streamType)&&!this.secondaryColor&&this.offsetWidth>=800,M=(_,I,S=!1)=>{C()||Array.from(_&&_.activeCues||[]).forEach(T=>{if(!(!T.snapToLines||T.line<-5||T.line>=0&&T.line<10))if(!I||this.paused){let x=T.text.split(`
`).length,v=o?-2:-3;this.streamType&&[we.LIVE,we.LL_LIVE].includes(this.streamType)&&(v=o?-1:-2);let i=v-x;if(T.line===i&&!S)return;O.has(T)||O.set(T,T.line),T.line=i-1,T.line=i}else setTimeout(()=>{T.line=O.get(T)||"auto"},500)})},D=()=>{var _;M(c,(_=a==null?void 0:a.hasAttribute("user-inactive"))!=null?_:!1)},A=()=>{var _;let I=Array.from(((_=a==null?void 0:a.media)==null?void 0:_.textTracks)||[]).filter(S=>["subtitles","captions"].includes(S.kind)&&S.mode==="showing")[0];I!==c&&(c==null||c.removeEventListener("cuechange",D)),c=I,c==null||c.addEventListener("cuechange",D),M(c,Re(this,fr))};if(A(),(t=a==null?void 0:a.media)==null||t.textTracks.addEventListener("change",A),(e=a==null?void 0:a.media)==null||e.textTracks.addEventListener("addtrack",A),navigator.userAgent.includes("Chrome/")){let _=()=>{M(c,Re(this,fr),!0),this.paused||window.requestAnimationFrame(_)};(r=a==null?void 0:a.media)==null||r.addEventListener("playing",()=>{_()})}a==null||a.addEventListener("userinactivechange",()=>{let _=a==null?void 0:a.hasAttribute("user-inactive");Re(this,fr)!==_&&(Kt(this,fr,_),M(c,Re(this,fr)))})};function hr(t,e){return t.media?t.media.getAttribute(e):t.getAttribute(e)}ct.customElements.get("mux-player")||(ct.customElements.define("mux-player",Ws),ct.MuxPlayerElement=Ws);var gh=Ws;export{Ys as MuxPlayer};
/*!
 * JavaScript Cookie v2.1.3
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */
/*!
 * mux-embed
 * @version 4.14.0
 * @copyright 2022 Mux, Inc
 */
