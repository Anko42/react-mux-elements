var Qi=Object.create;var xr=Object.defineProperty;var $i=Object.getOwnPropertyDescriptor;var Ji=Object.getOwnPropertyNames;var Zi=Object.getPrototypeOf,qi=Object.prototype.hasOwnProperty;var Hr=(U,O)=>()=>(O||U((O={exports:{}}).exports,O),O.exports),en=(U,O)=>{for(var h in O)xr(U,h,{get:O[h],enumerable:!0})},tn=(U,O,h,P)=>{if(O&&typeof O=="object"||typeof O=="function")for(let _ of Ji(O))!qi.call(U,_)&&_!==h&&xr(U,_,{get:()=>O[_],enumerable:!(P=$i(O,_))||P.enumerable});return U};var qt=(U,O,h)=>(h=U!=null?Qi(Zi(U)):{},tn(O||!U||!U.__esModule?xr(h,"default",{value:U,enumerable:!0}):h,U));var Vr=Hr((er,Sr)=>{(function(){var U,O;U=this,O=function(){return function(){var h={80:function(L,M,R){L.exports=R(728).default},728:function(L,M,R){"use strict";R.d(M,{default:function(){return Xi}});var b=R(48),A=R.n(b),y=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(F){var C=16*Math.random()|0;return(F==="x"?C:3&C|8).toString(16)})},x=function(){return("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6)},D=function(F){return F&&F.nodeName!==void 0?(F.muxId||(F.muxId=F.id||x()),F.muxId):F},E=function(F){var C;F&&F.nodeName!==void 0?F=D(C=F):C=document.querySelector(F);var w=C&&C.nodeName?C.nodeName.toLowerCase():"";return[C,F,w]},m=R(640),p=R.n(m),u=p().methodFactory;p().methodFactory=function(F,C,w){var K=u(F,C,w);return function(){for(var j=["[mux]"],V=0;V<arguments.length;V++)j.push(arguments[V]);K.apply(void 0,j)}},p().setLevel(p().getLevel());var e=p();function s(){return(A().doNotTrack||A().navigator&&A().navigator.doNotTrack)==="1"}var c={now:function(){var F=A().performance,C=F&&F.timing,w=F&&F.timeOrigin||C&&C.navigationStart;return typeof w=="number"&&typeof F.now=="function"?w+F.now():Date.now()}},g=R(678),i=R.n(g),r=function(F){return o(F)[0]},o=function(F){if(typeof F!="string"||F==="")return["localhost"];var C,w=(F.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/)||[])[4];return w&&(C=(w.match(/[^\.]+\.[^\.]+$/)||[])[0]),[w,C]},d={exists:function(){var F=A().performance;return(F&&F.timing)!==void 0},domContentLoadedEventEnd:function(){var F=A().performance,C=F&&F.timing;return C&&C.domContentLoadedEventEnd},navigationStart:function(){var F=A().performance,C=F&&F.timing;return C&&C.navigationStart}};function t(F,C,w){w=w===void 0?1:w,F[C]=F[C]||0,F[C]+=w}var n=["x-cdn","content-type","x-request-id"];function l(F){var C={};return(F=F||"").trim().split(/[\r\n]+/).forEach(function(w){if(w){var K=w.split(": "),j=K.shift();j&&(n.indexOf(j.toLowerCase())>=0||j.toLowerCase().indexOf("x-litix-")===0)&&(C[j]=K.join(": "))}}),C}var a=function(F){var C={};for(var w in F){var K=F[w];K["DATA-ID"].search("io.litix.data.")!==-1&&(C[K["DATA-ID"].replace("io.litix.data.","")]=K.VALUE)}return C};function f(F,C){var w=Object.keys(F);if(Object.getOwnPropertySymbols){var K=Object.getOwnPropertySymbols(F);C&&(K=K.filter(function(j){return Object.getOwnPropertyDescriptor(F,j).enumerable})),w.push.apply(w,K)}return w}function v(F){for(var C=1;C<arguments.length;C++){var w=arguments[C]!=null?arguments[C]:{};C%2?f(Object(w),!0).forEach(function(K){S(F,K,w[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(w)):f(Object(w)).forEach(function(K){Object.defineProperty(F,K,Object.getOwnPropertyDescriptor(w,K))})}return F}function S(F,C,w){return C in F?Object.defineProperty(F,C,{value:w,enumerable:!0,configurable:!0,writable:!0}):F[C]=w,F}var T=function(F){if(!F)return{};var C=d.navigationStart(),w=F.loading,K=w?w.start:F.trequest,j=w?w.first:F.tfirst,V=w?w.end:F.tload;return{bytesLoaded:F.total,requestStart:Math.round(C+K),responseStart:Math.round(C+j),responseEnd:Math.round(C+V)}},I=function(F){if(F&&typeof F.getAllResponseHeaders=="function")return l(F.getAllResponseHeaders())},k=function(F,C){if(!F||typeof F.getRequests!="function")return{};var w=F.getRequests({state:"executed"});if(w.length===0)return{};var K,j=w[w.length-1],V=r(j.url),H=j.bytesLoaded,Q=new Date(j.requestStartDate).getTime(),J=new Date(j.firstByteDate).getTime(),X=new Date(j.requestEndDate).getTime(),ee=isNaN(j.duration)?0:j.duration,ce=typeof C.getMetricsFor=="function"?C.getMetricsFor(j.mediaType).HttpList:C.getDashMetrics().getHttpRequests(j.mediaType);return ce.length>0&&(K=l(ce[ce.length-1]._responseHeaders||"")),{requestStart:Q,requestResponseStart:J,requestResponseEnd:X,requestBytesLoaded:H,requestResponseHeaders:K,requestMediaDuration:ee,requestHostname:V}},B=function(F,C){var w=C.getQualityFor(F),K=C.getCurrentTrackFor(F).bitrateList;return K?{currentLevel:w,renditionWidth:K[w].width||null,renditionHeight:K[w].height||null,renditionBitrate:K[w].bandwidth}:{}};function N(F,C){for(var w=0;w<C.length;w++){var K=C[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(F,K.key,K)}}var W=0,G=function(){function F(){(function(j,V){if(!(j instanceof V))throw new TypeError("Cannot call a class as a function")})(this,F)}var C,w,K;return C=F,w=[{key:"on",value:function(j,V,H){return V._eventEmitterGuid=V._eventEmitterGuid||++W,this._listeners=this._listeners||{},this._listeners[j]=this._listeners[j]||[],H&&(V=V.bind(H)),this._listeners[j].push(V),V}},{key:"off",value:function(j,V){var H=this._listeners&&this._listeners[j];H&&H.forEach(function(Q,J){Q._eventEmitterGuid===V._eventEmitterGuid&&H.splice(J,1)})}},{key:"one",value:function(j,V,H){var Q=this;V._eventEmitterGuid=V._eventEmitterGuid||++W;var J=function X(){Q.off(j,X),V.apply(H||this,arguments)};J._eventEmitterGuid=V._eventEmitterGuid,this.on(j,J)}},{key:"emit",value:function(j,V){var H=this;if(this._listeners){V=V||{};var Q=this._listeners["before*"]||[],J=this._listeners[j]||[],X=this._listeners["after"+j]||[],ee=function(ce,ye){(ce=ce.slice()).forEach(function(ve){ve.call(H,{type:j},ye)})};ee(Q,V),ee(J,V),ee(X,V)}}}],w&&N(C.prototype,w),K&&N(C,K),Object.defineProperty(C,"prototype",{writable:!1}),F}(),z=G;function Y(F,C){for(var w=0;w<C.length;w++){var K=C[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(F,K.key,K)}}var $=function(){function F(j){var V=this;(function(H,Q){if(!(H instanceof Q))throw new TypeError("Cannot call a class as a function")})(this,F),this.pm=j,this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,j.on("playing",function(){V._playheadShouldBeProgressing=!0}),j.on("play",this._startPlaybackHeartbeatInterval.bind(this)),j.on("playing",this._startPlaybackHeartbeatInterval.bind(this)),j.on("adbreakstart",this._startPlaybackHeartbeatInterval.bind(this)),j.on("adplay",this._startPlaybackHeartbeatInterval.bind(this)),j.on("adplaying",this._startPlaybackHeartbeatInterval.bind(this)),j.on("seeking",this._startPlaybackHeartbeatInterval.bind(this)),j.on("devicewake",this._startPlaybackHeartbeatInterval.bind(this)),j.on("viewstart",this._startPlaybackHeartbeatInterval.bind(this)),j.on("rebufferstart",this._startPlaybackHeartbeatInterval.bind(this)),j.on("pause",this._stopPlaybackHeartbeatInterval.bind(this)),j.on("ended",this._stopPlaybackHeartbeatInterval.bind(this)),j.on("viewend",this._stopPlaybackHeartbeatInterval.bind(this)),j.on("error",this._stopPlaybackHeartbeatInterval.bind(this)),j.on("aderror",this._stopPlaybackHeartbeatInterval.bind(this)),j.on("adpause",this._stopPlaybackHeartbeatInterval.bind(this)),j.on("adended",this._stopPlaybackHeartbeatInterval.bind(this)),j.on("adbreakend",this._stopPlaybackHeartbeatInterval.bind(this)),j.on("seeked",function(){j.data.player_is_paused?V._stopPlaybackHeartbeatInterval():V._startPlaybackHeartbeatInterval()}),j.on("timeupdate",function(){V._playbackHeartbeatInterval!==null&&j.emit("playbackheartbeat")}),j.on("devicesleep",function(H,Q){V._playbackHeartbeatInterval!==null&&(A().clearInterval(V._playbackHeartbeatInterval),j.emit("playbackheartbeatend",{viewer_time:Q.viewer_time}),V._playbackHeartbeatInterval=null)})}var C,w,K;return C=F,(w=[{key:"_startPlaybackHeartbeatInterval",value:function(){var j=this;this._playbackHeartbeatInterval===null&&(this.pm.emit("playbackheartbeat"),this._playbackHeartbeatInterval=A().setInterval(function(){j.pm.emit("playbackheartbeat")},this.pm.playbackHeartbeatTime))}},{key:"_stopPlaybackHeartbeatInterval",value:function(){this._playheadShouldBeProgressing=!1,this._playbackHeartbeatInterval!==null&&(A().clearInterval(this._playbackHeartbeatInterval),this.pm.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)}}])&&Y(C.prototype,w),K&&Y(C,K),Object.defineProperty(C,"prototype",{writable:!1}),F}();function Z(F,C){for(var w=0;w<C.length;w++){var K=C[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(F,K.key,K)}}function q(F,C,w){return C&&Z(F.prototype,C),w&&Z(F,w),Object.defineProperty(F,"prototype",{writable:!1}),F}var ie=q(function F(C){var w=this;(function(K,j){if(!(K instanceof j))throw new TypeError("Cannot call a class as a function")})(this,F),C.on("viewinit",function(){w.viewErrored=!1}),C.on("error",function(){try{var K=C.errorTranslator({player_error_code:C.data.player_error_code,player_error_message:C.data.player_error_message});K?(C.data.player_error_code=K.player_error_code,C.data.player_error_message=K.player_error_message,w.viewErrored=!0):(delete C.data.player_error_code,delete C.data.player_error_message)}catch(j){C.mux.log.warn("Exception in error translator callback.",j),w.viewErrored=!0}})});function ne(F,C){for(var w=0;w<C.length;w++){var K=C[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(F,K.key,K)}}var ae=function(){function F(j){(function(V,H){if(!(V instanceof H))throw new TypeError("Cannot call a class as a function")})(this,F),this.pm=j,this._watchTimeTrackerLastCheckedTime=null,j.on("playbackheartbeat",this._updateWatchTime.bind(this)),j.on("playbackheartbeatend",this._clearWatchTimeState.bind(this))}var C,w,K;return C=F,(w=[{key:"_updateWatchTime",value:function(j,V){var H=V.viewer_time;this._watchTimeTrackerLastCheckedTime===null&&(this._watchTimeTrackerLastCheckedTime=H),t(this.pm.data,"view_watch_time",H-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=H}},{key:"_clearWatchTimeState",value:function(j,V){this._updateWatchTime(j,V),this._watchTimeTrackerLastCheckedTime=null}}])&&ne(C.prototype,w),K&&ne(C,K),Object.defineProperty(C,"prototype",{writable:!1}),F}();function te(F,C){for(var w=0;w<C.length;w++){var K=C[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(F,K.key,K)}}var fe=function(){function F(j){(function(V,H){if(!(V instanceof H))throw new TypeError("Cannot call a class as a function")})(this,F),this.pm=j,this._playbackTimeTrackerLastPlayheadPosition=-1,j.on("playbackheartbeat",this._updatePlaybackTime.bind(this)),j.on("playbackheartbeatend",this._clearPlaybackTimeState.bind(this)),j.on("seeking",this._clearPlaybackTimeState.bind(this))}var C,w,K;return C=F,(w=[{key:"_updatePlaybackTime",value:function(){var j=this.pm.data.player_playhead_time;if(this._playbackTimeTrackerLastPlayheadPosition>=0&&j>this._playbackTimeTrackerLastPlayheadPosition){var V=j-this._playbackTimeTrackerLastPlayheadPosition;V<=1e3&&t(this.pm.data,"view_content_playback_time",V)}this._playbackTimeTrackerLastPlayheadPosition=j}},{key:"_clearPlaybackTimeState",value:function(){this._updatePlaybackTime(),this._playbackTimeTrackerLastPlayheadPosition=-1}}])&&te(C.prototype,w),K&&te(C,K),Object.defineProperty(C,"prototype",{writable:!1}),F}();function de(F,C){for(var w=0;w<C.length;w++){var K=C[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(F,K.key,K)}}var re=function(){function F(j){(function(H,Q){if(!(H instanceof Q))throw new TypeError("Cannot call a class as a function")})(this,F),this.pm=j;var V=this._updatePlayheadTime.bind(this);j.on("playbackheartbeat",V),j.on("playbackheartbeatend",V),j.on("timeupdate",V),j.on("destroy",function(){j.off("timeupdate",V)})}var C,w,K;return C=F,(w=[{key:"_updateMaxPlayheadPosition",value:function(){this.pm.data.view_max_playhead_position=this.pm.data.view_max_playhead_position===void 0?this.pm.data.player_playhead_time:Math.max(this.pm.data.view_max_playhead_position,this.pm.data.player_playhead_time)}},{key:"_updatePlayheadTime",value:function(j,V){var H=this,Q=function(){H.pm.currentFragmentPDT&&H.pm.currentFragmentStart&&(H.pm.data.player_program_time=H.pm.currentFragmentPDT+H.pm.data.player_playhead_time-H.pm.currentFragmentStart)};if(V&&V.player_playhead_time)this.pm.data.player_playhead_time=V.player_playhead_time,Q(),this._updateMaxPlayheadPosition();else if(this.pm.getPlayheadTime){var J=this.pm.getPlayheadTime();J!==void 0&&(this.pm.data.player_playhead_time=J,Q(),this._updateMaxPlayheadPosition())}}}])&&de(C.prototype,w),K&&de(C,K),Object.defineProperty(C,"prototype",{writable:!1}),F}();function Ee(F,C){for(var w=0;w<C.length;w++){var K=C[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(F,K.key,K)}}function me(F,C,w){return C&&Ee(F.prototype,C),w&&Ee(F,w),Object.defineProperty(F,"prototype",{writable:!1}),F}var Te=me(function F(C){if(function(j,V){if(!(j instanceof V))throw new TypeError("Cannot call a class as a function")}(this,F),!C.disableRebufferTracking){var w,K=function(){if(w){var j=C.data.viewer_time-w;t(C.data,"view_rebuffer_duration",j),w=C.data.viewer_time}C.data.view_watch_time>=0&&C.data.view_rebuffer_count>0&&(C.data.view_rebuffer_frequency=C.data.view_rebuffer_count/C.data.view_watch_time,C.data.view_rebuffer_percentage=C.data.view_rebuffer_duration/C.data.view_watch_time)};C.on("playbackheartbeat",function(){return K()}),C.on("rebufferstart",function(){w||(t(C.data,"view_rebuffer_count",1),w=C.data.viewer_time,C.one("rebufferend",function(){K(),w=void 0}))})}});function Me(F,C){for(var w=0;w<C.length;w++){var K=C[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(F,K.key,K)}}var _e=function(){function F(j){var V=this;(function(H,Q){if(!(H instanceof Q))throw new TypeError("Cannot call a class as a function")})(this,F),this.pm=j,j.disableRebufferTracking||j.disablePlayheadRebufferTracking||(this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,j.on("playbackheartbeat",this._checkIfRebuffering.bind(this)),j.on("playbackheartbeatend",this._cleanupRebufferTracker.bind(this)),j.on("seeking",function(){V._cleanupRebufferTracker(null,{viewer_time:c.now()})}))}var C,w,K;return C=F,w=[{key:"_checkIfRebuffering",value:function(j,V){if(this.pm.seekingTracker.isSeeking||this.pm.adTracker.isAdBreak||!this.pm.playbackHeartbeat._playheadShouldBeProgressing)this._cleanupRebufferTracker(j,V);else if(this._lastCheckedTime!==null)if(this._lastPlayheadTime===this.pm.data.player_playhead_time){var H=V.viewer_time-this._lastPlayheadTimeUpdatedTime;typeof this.pm.sustainedRebufferThreshold=="number"&&H>=this.pm.sustainedRebufferThreshold&&(this._rebuffering||(this._rebuffering=!0,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}))),this._lastCheckedTime=V.viewer_time}else this._cleanupRebufferTracker(j,V,!0);else this._prepareRebufferTrackerState(V.viewer_time)}},{key:"_clearRebufferTrackerState",value:function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null}},{key:"_prepareRebufferTrackerState",value:function(j){this._lastCheckedTime=j,this._lastPlayheadTime=this.pm.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=j}},{key:"_cleanupRebufferTracker",value:function(j,V){var H=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(this._rebuffering)this._rebuffering=!1,this.pm.emit("rebufferend",{viewer_time:V.viewer_time});else{if(this._lastCheckedTime===null)return;var Q=this.pm.data.player_playhead_time-this._lastPlayheadTime,J=V.viewer_time-this._lastPlayheadTimeUpdatedTime;typeof this.pm.minimumRebufferDuration=="number"&&Q>0&&J-Q>this.pm.minimumRebufferDuration&&(this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.pm.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+J-Q}))}H?this._prepareRebufferTrackerState(V.viewer_time):this._clearRebufferTrackerState()}}],w&&Me(C.prototype,w),K&&Me(C,K),Object.defineProperty(C,"prototype",{writable:!1}),F}(),ke=_e;function Ie(F,C){for(var w=0;w<C.length;w++){var K=C[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(F,K.key,K)}}var Be=function(){function F(j){var V=this;(function(H,Q){if(!(H instanceof Q))throw new TypeError("Cannot call a class as a function")})(this,F),this.pm=j,j.on("viewinit",function(){var H=j.data,Q=H.view_id;if(!H.view_program_changed){var J=function(X,ee){var ce=ee.viewer_time;X.type==="playing"&&j.data.view_time_to_first_frame===void 0?V.calculateTimeToFirstFrame(ce||c.now(),Q):X.type!=="adplaying"||j.data.view_time_to_first_frame!==void 0&&!V._inPrerollPosition()||V.calculateTimeToFirstFrame(ce||c.now(),Q)};j.one("playing",J),j.one("adplaying",J),j.one("viewend",function(){j.off("playing",J),j.off("adplaying",J)})}})}var C,w,K;return C=F,(w=[{key:"_inPrerollPosition",value:function(){return this.pm.data.view_content_playback_time===void 0||this.pm.data.view_content_playback_time<=1e3}},{key:"calculateTimeToFirstFrame",value:function(j,V){V===this.pm.data.view_id&&(this.pm.watchTimeTracker._updateWatchTime(null,{viewer_time:j}),this.pm.data.view_time_to_first_frame=this.pm.data.view_watch_time,(this.pm.data.player_autoplay_on||this.pm.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.pm.data.view_aggregate_startup_time=this.pm.data.view_start+this.pm.data.view_watch_time-this.NAVIGATION_START))}}])&&Ie(C.prototype,w),K&&Ie(C,K),Object.defineProperty(C,"prototype",{writable:!1}),F}();function be(F,C){for(var w=0;w<C.length;w++){var K=C[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(F,K.key,K)}}function Ue(F,C,w){return C&&be(F.prototype,C),w&&be(F,w),Object.defineProperty(F,"prototype",{writable:!1}),F}var Ke=Ue(function F(C){var w=this;(function(K,j){if(!(K instanceof j))throw new TypeError("Cannot call a class as a function")})(this,F),C.on("viewinit",function(){w._lastPlayheadPosition=-1}),["pause","rebufferstart","seeking","error","adbreakstart","hb"].forEach(function(K){C.on(K,function(){if(w._lastPlayheadPosition>=0&&C.data.player_playhead_time>=0&&w._lastPlayerWidth>=0&&w._lastSourceWidth>0&&w._lastPlayerHeight>=0&&w._lastSourceHeight>0){var j=C.data.player_playhead_time-w._lastPlayheadPosition;if(j<0)return void(w._lastPlayheadPosition=-1);var V=Math.min(w._lastPlayerWidth/w._lastSourceWidth,w._lastPlayerHeight/w._lastSourceHeight),H=Math.max(0,V-1),Q=Math.max(0,1-V);C.data.view_max_upscale_percentage=Math.max(C.data.view_max_upscale_percentage||0,H),C.data.view_max_downscale_percentage=Math.max(C.data.view_max_downscale_percentage||0,Q),t(C.data,"view_total_content_playback_time",j),t(C.data,"view_total_upscaling",H*j),t(C.data,"view_total_downscaling",Q*j)}w._lastPlayheadPosition=-1})}),["playing","hb"].forEach(function(K){C.on(K,function(){w._lastPlayheadPosition=C.data.player_playhead_time,w._lastPlayerWidth=C.data.player_width,w._lastPlayerHeight=C.data.player_height,w._lastSourceWidth=C.data.video_source_width,w._lastSourceHeight=C.data.video_source_height})})});function je(F,C){for(var w=0;w<C.length;w++){var K=C[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(F,K.key,K)}}function Ne(F,C,w){return C&&je(F.prototype,C),w&&je(F,w),Object.defineProperty(F,"prototype",{writable:!1}),F}var qe=Ne(function F(C){var w=this;(function(K,j){if(!(K instanceof j))throw new TypeError("Cannot call a class as a function")})(this,F),this.isSeeking=!1,C.on("seeking",function(K,j){i()(C.data,j),w._lastSeekingTime=c.now(),w.isSeeking===!1&&(w.isSeeking=!0,C.send("seeking"))}),C.on("seeked",function(){w.isSeeking=!1;var K=w._lastSeekingTime||c.now(),j=c.now()-K;t(C.data,"view_seek_count",1),t(C.data,"view_seek_duration",j);var V=C.data.view_max_seek_time||0;C.data.view_max_seek_time=Math.max(V,j)}),C.on("viewend",function(){w.isSeeking=!1})});function we(F,C){return function(w){if(Array.isArray(w))return w}(F)||function(w,K){var j=w==null?null:typeof Symbol!="undefined"&&w[Symbol.iterator]||w["@@iterator"];if(j!=null){var V,H,Q=[],J=!0,X=!1;try{for(j=j.call(w);!(J=(V=j.next()).done)&&(Q.push(V.value),!K||Q.length!==K);J=!0);}catch(ee){X=!0,H=ee}finally{try{J||j.return==null||j.return()}finally{if(X)throw H}}return Q}}(F,C)||function(w,K){if(w){if(typeof w=="string")return et(w,K);var j=Object.prototype.toString.call(w).slice(8,-1);return j==="Object"&&w.constructor&&(j=w.constructor.name),j==="Map"||j==="Set"?Array.from(w):j==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(j)?et(w,K):void 0}}(F,C)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function et(F,C){(C==null||C>F.length)&&(C=F.length);for(var w=0,K=new Array(C);w<C;w++)K[w]=F[w];return K}function Oe(F,C){for(var w=0;w<C.length;w++){var K=C[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(F,K.key,K)}}var Pe=function(F,C){F.push(C),F.sort(function(w,K){return w.viewer_time-K.viewer_time})},Ye=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror"],Ce=function(){function F(j){var V=this;(function(Q,J){if(!(Q instanceof J))throw new TypeError("Cannot call a class as a function")})(this,F),this.pm=j,j.on("viewinit",function(){V.isAdBreak=!1,V._currentAdRequestNumber=0,V._currentAdResponseNumber=0,V._adRequests=[],V._adResponses=[],V._adHasPlayed=!1,V._wouldBeNewAdPlay=!0,V._prerollPlayTime=void 0}),Ye.forEach(function(Q){return j.on(Q,V._updateAdData.bind(V))});var H=function(){V.isAdBreak=!1};j.on("adbreakstart",function(){V.isAdBreak=!0}),j.on("play",H),j.on("playing",H),j.on("viewend",H),j.on("adrequest",function(Q,J){J=i()({ad_request_id:"generatedAdRequestId"+V._currentAdRequestNumber++},J),Pe(V._adRequests,J),t(j.data,"view_ad_request_count"),V.inPrerollPosition()&&(j.data.view_preroll_requested=!0,V._adHasPlayed||t(j.data,"view_preroll_request_count"))}),j.on("adresponse",function(Q,J){J=i()({ad_request_id:"generatedAdRequestId"+V._currentAdResponseNumber++},J),Pe(V._adResponses,J);var X=V.findAdRequest(J.ad_request_id);X&&t(j.data,"view_ad_request_time",Math.max(0,J.viewer_time-X.viewer_time))}),j.on("adplay",function(Q,J){V._adHasPlayed=!0,V._wouldBeNewAdPlay&&(V._wouldBeNewAdPlay=!1,t(j.data,"view_ad_played_count")),V.inPrerollPosition()&&!j.data.view_preroll_played&&(j.data.view_preroll_played=!0,V._adRequests.length>0&&(j.data.view_preroll_request_time=Math.max(0,J.viewer_time-V._adRequests[0].viewer_time)),j.data.view_start&&(j.data.view_startup_preroll_request_time=Math.max(0,J.viewer_time-j.data.view_start)),V._prerollPlayTime=J.viewer_time)}),j.on("adplaying",function(Q,J){V.inPrerollPosition()&&j.data.view_preroll_load_time===void 0&&V._prerollPlayTime!==void 0&&(j.data.view_preroll_load_time=J.viewer_time-V._prerollPlayTime,j.data.view_startup_preroll_load_time=J.viewer_time-V._prerollPlayTime)}),j.on("adended",function(){V._wouldBeNewAdPlay=!0}),j.on("aderror",function(){V._wouldBeNewAdPlay=!0})}var C,w,K;return C=F,(w=[{key:"inPrerollPosition",value:function(){return this.pm.data.view_content_playback_time===void 0||this.pm.data.view_content_playback_time<=1e3}},{key:"findAdRequest",value:function(j){for(var V=0;V<this._adRequests.length;V++)if(this._adRequests[V].ad_request_id===j)return this._adRequests[V]}},{key:"_updateAdData",value:function(j,V){if(this.inPrerollPosition()){if(!this.pm.data.view_preroll_ad_tag_hostname&&V.ad_tag_url){var H=we(o(V.ad_tag_url),2),Q=H[0],J=H[1];this.pm.data.view_preroll_ad_tag_domain=J,this.pm.data.view_preroll_ad_tag_hostname=Q}if(!this.pm.data.view_preroll_ad_asset_hostname&&V.ad_asset_url){var X=we(o(V.ad_asset_url),2),ee=X[0],ce=X[1];this.pm.data.view_preroll_ad_asset_domain=ce,this.pm.data.view_preroll_ad_asset_hostname=ee}}}}])&&Oe(C.prototype,w),K&&Oe(C,K),Object.defineProperty(C,"prototype",{writable:!1}),F}();function Ae(F,C){for(var w=0;w<C.length;w++){var K=C[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(F,K.key,K)}}function it(F,C,w){return C&&Ae(F.prototype,C),w&&Ae(F,w),Object.defineProperty(F,"prototype",{writable:!1}),F}var We=it(function F(C){var w,K;(function(Q,J){if(!(Q instanceof J))throw new TypeError("Cannot call a class as a function")})(this,F);var j=function(){C.disableRebufferTracking||w&&(t(C.data,"view_waiting_rebuffer_duration",c.now()-w),w=!1,A().clearInterval(K))},V=!1,H=function(){V=!1,j()};C.on("waiting",function(){V&&(C.disableRebufferTracking||(t(C.data,"view_waiting_rebuffer_count",1),w=c.now(),K=A().setInterval(function(){if(w){var Q=c.now();t(C.data,"view_waiting_rebuffer_duration",Q-w),w=Q}},250)))}),C.on("playing",function(){j(),V=!0}),C.on("pause",H),C.on("seeking",H)});function lt(F,C){for(var w=0;w<C.length;w++){var K=C[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(F,K.key,K)}}function yt(F,C,w){return C&&lt(F.prototype,C),w&&lt(F,w),Object.defineProperty(F,"prototype",{writable:!1}),F}var Xe=yt(function F(C){var w=this;(function(V,H){if(!(V instanceof H))throw new TypeError("Cannot call a class as a function")})(this,F);var K=function(){w.lastWallClockTime=c.now(),C.on("before*",j)},j=function(V){var H=c.now(),Q=w.lastWallClockTime;w.lastWallClockTime=H,H-Q>3e4&&(C.emit("devicesleep",{viewer_time:Q}),i()(C.data,{viewer_time:Q}),C.send("devicesleep"),C.emit("devicewake",{viewer_time:H}),i()(C.data,{viewer_time:H}),C.send("devicewake"))};C.one("playbackheartbeat",K),C.on("playbackheartbeatend",function(){C.off("before*",j),C.one("playbackheartbeat",K)})}),_t=R(375),Tt=R(655),nt=R.n(Tt),ut="muxData",at=function(){var F;try{F=_t.parse(nt().get(ut)||"")}catch{F={}}return F},xt=function(F){try{nt().set(ut,_t.stringify(F),{expires:7300})}catch{}},gt=function(){var F=at();return F.mux_viewer_id=F.mux_viewer_id||y(),F.msn=F.msn||Math.random(),xt(F),{mux_viewer_id:F.mux_viewer_id,mux_sample_number:F.msn}};function fr(F,C){var w=C.beaconCollectionDomain,K=C.beaconDomain;if(w)return"https://"+w;var j=K||"litix.io";return(F=F||"inferred").match(/^[a-z0-9]+$/)?"https://"+F+"."+j:"https://img.litix.io/a.gif"}var Ct=function(){var F;switch(bt()){case"cellular":F="cellular";break;case"ethernet":F="wired";break;case"wifi":F="wifi";break;case void 0:break;default:F="other"}return F},bt=function(){var F=A().navigator,C=F&&(F.connection||F.mozConnection||F.webkitConnection);return C&&C.type};Ct.getConnectionFromAPI=bt;var Qe=Ct,zt=Xt({a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",i:"internal",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"}),Mt=Xt({ad:"ad",ag:"aggregate",ap:"api",al:"application",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",br:"break",bw:"browser",by:"bytes",ca:"cached",cb:"cancel",cd:"code",cg:"category",ch:"changed",cn:"config",co:"count",ce:"counter",cp:"complete",cr:"creative",ct:"content",cu:"current",cx:"connection",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",du:"duration",dv:"device",ec:"encoding",ed:"edge",en:"end",eg:"engine",em:"embed",er:"error",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",ep:"experiments",fi:"first",fm:"family",ft:"format",fp:"fps",fq:"frequency",fr:"frame",fs:"fullscreen",hb:"holdback",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mf:"manifest",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",ne:"newest",nm:"name",no:"number",on:"on",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pr:"preload",ps:"position",pt:"part",py:"property",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",se:"session",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",st:"start",su:"startup",sv:"server",sw:"software",ta:"tag",tc:"tech",te:"text",tg:"target",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"});function Xt(F){var C={};for(var w in F)F.hasOwnProperty(w)&&(C[F[w]]=w);return C}function wt(F){var C={},w={};return Object.keys(F).forEach(function(K){var j=!1;if(F.hasOwnProperty(K)&&F[K]!==void 0){var V=K.split("_"),H=V[0],Q=zt[H];Q||(e.info("Data key word `"+V[0]+"` not expected in "+K),Q=H+"_"),V.splice(1).forEach(function(J){J==="url"&&(j=!0),Mt[J]?Q+=Mt[J]:Number(J)&&Math.floor(Number(J))===Number(J)?Q+=J:(e.info("Data key word `"+J+"` not expected in "+K),Q+="_"+J+"_")}),j?w[Q]=F[K]:C[Q]=F[K]}}),i()(C,w)}var dr={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:1e4,maxPayloadKBSize:500},cr=["hb","requestcompleted","requestfailed","requestcanceled"],st=function(F,C){this._beaconUrl=F||"https://img.litix.io",this._eventQueue=[],this._postInFlight=!1,this._failureCount=0,this._sendTimeout=!1,this._options=i()({},dr,C)};st.prototype.queueEvent=function(F,C){var w=i()({},C);return(this._eventQueue.length<=this._options.maxQueueLength||F==="eventrateexceeded")&&(this._eventQueue.push(w),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength)},st.prototype.flushEvents=function(){this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending()},st.prototype.destroy=function(){var F=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.destroyed=!0,F?this._clearBeaconQueue():this.flushEvents(),A().clearTimeout(this._sendTimeout)},st.prototype._clearBeaconQueue=function(){var F=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,C=this._eventQueue.slice(F);F>0&&i()(C[C.length-1],wt({mux_view_message:"event queue truncated"}));var w=this._createPayload(C);Ot(this._beaconUrl,w,!0,function(){})},st.prototype._sendBeaconQueue=function(){var F=this;if(!this._postInFlight){var C=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0;var w=this._createPayload(C),K=c.now();Ot(this._beaconUrl,w,!1,function(j,V){V?(F._eventQueue=C.concat(F._eventQueue),F._failureCount+=1,e.info("Error sending beacon: "+V)):F._failureCount=0,F._roundTripTime=c.now()-K,F._postInFlight=!1})}},st.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var F=Math.pow(2,this._failureCount-1);return(1+(F*=Math.random()))*this._options.baseTimeBetweenBeacons},st.prototype._startBeaconSending=function(){var F=this;A().clearTimeout(this._sendTimeout),this.destroyed||(this._sendTimeout=A().setTimeout(function(){F._eventQueue.length&&F._sendBeaconQueue(),F._startBeaconSending()},this._getNextBeaconTime()))},st.prototype._createPayload=function(F){var C,w,K,j=this,V={transmission_timestamp:Math.round(c.now())};this._roundTripTime&&(V.rtt_ms=Math.round(this._roundTripTime));var H=function(){C=JSON.stringify({metadata:V,events:w||F}),K=C.length/1024},Q=function(){return K<=j._options.maxPayloadKBSize};return H(),Q()||(e.info("Payload size is too big ("+K+" kb). Removing unnecessary events."),w=F.filter(function(J){return cr.indexOf(J.e)===-1}),H()),Q()||(e.info("Payload size still too big ("+K+" kb). Cropping fields.."),w.forEach(function(J){for(var X in J){var ee=J[X];typeof ee=="string"&&ee.length>51200&&(J[X]=ee.substring(0,51200))}}),H()),C};var Ot=function(F,C,w,K){if(w&&navigator&&navigator.sendBeacon&&navigator.sendBeacon(F,C))K();else if(A().fetch)A().fetch(F,{method:"POST",body:C,headers:{"Content-Type":"text/plain"},keepalive:!0}).then(function(V){return K(null,V.ok?null:"Error")}).catch(function(V){return K(null,V)});else{if(A().XMLHttpRequest){var j=new(A()).XMLHttpRequest;return j.onreadystatechange=function(){if(j.readyState===4)return K(null,j.status!==200?"error":void 0)},j.open("POST",F),j.setRequestHeader("Content-Type","text/plain"),void j.send(C)}K()}},Qt=st;function St(F){return St=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},St(F)}var hr=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id"],mi=["viewstart","error","ended","viewend"],$t=function(F,C){var w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.mux=F,this.envKey=C,this.eventQueue=new Qt(fr(C,w)),this.previousBeaconData=null,this.lastEventTime=null,this.sampleRate=w.sampleRate,this.disableCookies=w.disableCookies,this.respectDoNotTrack=w.respectDoNotTrack;var K=w.platform||{};this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:K.name,viewer_application_version:K.version,viewer_application_engine:K.layout,viewer_device_name:K.product,viewer_device_category:"",viewer_device_manufacturer:K.manufacturer,viewer_os_family:K.os&&K.os.family,viewer_os_architecture:K.os&&K.os.architecture,viewer_os_version:K.os&&K.os.version};var j=Qe();j&&(this.pageLevelData=i()(this.pageLevelData,{viewer_connection_type:j})),A()!==void 0&&A().location&&A().location.href&&(this.pageLevelData.page_url=A().location.href),this.viewerData=this.disableCookies?{}:gt()};$t.prototype.send=function(F,C){if(F){if(this.respectDoNotTrack&&s())return e.info("Not sending `"+F+"` because Do Not Track is enabled");if(!C||St(C)!=="object")return e.error("A data object was expected in send() but was not provided");var w,K,j=this.disableCookies?{}:(w=at(),K=c.now(),w.session_start&&(w.sst=w.session_start,delete w.session_start),w.session_id&&(w.sid=w.session_id,delete w.session_id),w.session_expires&&(w.sex=w.session_expires,delete w.session_expires),(!w.sex||w.sex<K)&&(w.sid=y(),w.sst=K),w.sex=K+15e5,xt(w),{session_id:w.sid,session_start:w.sst,session_expires:w.sex}),V={};i()(V,this.pageLevelData),i()(V,C),i()(V,j),i()(V,this.viewerData),V.event=F,V.env_key=this.envKey,V.user_id&&(V.viewer_user_id=V.user_id,delete V.user_id);var H=V.mux_sample_number>=this.sampleRate,Q=wt(this._deduplicateBeaconData(F,V));if(this.lastEventTime=this.mux.utils.now(),H)return e.info("Not sending event due to sample rate restriction",F,V,Q);if(this.envKey||e.info("Missing environment key (envKey) - beacons will be dropped if the video source is not a valid mux video URL",F,V,Q),!this.rateLimited){if(e.info("Sending event",F,V,Q),this.rateLimited=!this.eventQueue.queueEvent(F,Q),this.mux.WINDOW_UNLOADING&&F==="viewend")this.eventQueue.destroy(!0);else if((mi.indexOf(F)>=0||this.mux.WINDOW_HIDDEN&&F==="hb")&&this.eventQueue.flushEvents(),this.rateLimited)return V.event="eventrateexceeded",Q=wt(V),this.eventQueue.queueEvent(V.event,Q),e.error("Beaconing disabled due to rate limit.")}}},$t.prototype.destroy=function(){this.eventQueue.destroy(!1)},$t.prototype._deduplicateBeaconData=function(F,C){var w=this,K={},j=C.view_id;if(!j||F==="viewstart"||F==="viewend"||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=6e5)K=i()({},C),j&&(this.previousBeaconData=K),j&&F==="viewend"&&(this.previousBeaconData=null);else{var V=F.indexOf("request")===0;Object.keys(C).forEach(function(H){var Q=C[H];(Q!==w.previousBeaconData[H]||hr.indexOf(H)>-1||function(J,X,ee,ce){return!(!J||X.indexOf("request_")!==0||X!=="request_response_headers"&&St(ee)==="object"&&St(ce)==="object"&&Object.keys(ee||{}).length===Object.keys(ce||{}).length)}(V,H,Q,w.previousBeaconData[H])||function(J,X){return J==="renditionchange"&&X.indexOf("video_source_")===0}(F,H))&&(K[H]=Q,w.previousBeaconData[H]=Q)})}return K};var pi=$t;function kr(F,C){for(var w=0;w<C.length;w++){var K=C[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(F,K.key,K)}}function Ei(F,C,w){return C&&kr(F.prototype,C),w&&kr(F,w),Object.defineProperty(F,"prototype",{writable:!1}),F}var yi=Ei(function F(C){(function(X,ee){if(!(X instanceof ee))throw new TypeError("Cannot call a class as a function")})(this,F);var w=0,K=0,j=0,V=0,H=0,Q=0,J=0;C.on("requestcompleted",function(X,ee){var ce,ye,ve=ee.request_start,se=ee.request_response_start,le=ee.request_response_end,Se=ee.request_bytes_loaded;if(V++,se?(ce=se-ve,ye=le-se):ye=le-ve,ye>0&&Se>0){var ze=Se/ye*8e3;H++,K+=Se,j+=ye,C.data.view_min_request_throughput=Math.min(C.data.view_min_request_throughput||1/0,ze),C.data.view_average_request_throughput=K/j*8e3,C.data.view_request_count=V,ce>0&&(w+=ce,C.data.view_max_request_latency=Math.max(C.data.view_max_request_latency||0,ce),C.data.view_average_request_latency=w/H)}}),C.on("requestfailed",function(X,ee){V++,Q++,C.data.view_request_count=V,C.data.view_request_failed_count=Q}),C.on("requestcanceled",function(X,ee){V++,J++,C.data.view_request_count=V,C.data.view_request_canceled_count=J})});function Br(F,C){for(var w=0;w<C.length;w++){var K=C[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(F,K.key,K)}}function Ti(F,C,w){return C&&Br(F.prototype,C),w&&Br(F,w),Object.defineProperty(F,"prototype",{writable:!1}),F}var xi=Ti(function F(C){var w=this;(function(K,j){if(!(K instanceof j))throw new TypeError("Cannot call a class as a function")})(this,F),C.on("before*",function(K,j){var V=j.viewer_time,H=c.now(),Q=w._lastEventTime;if(w._lastEventTime=H,Q&&H-Q>36e5){var J=Object.keys(C.data).reduce(function(X,ee){return ee.indexOf("video_")===0?i()(X,function(ce,ye,ve){return ye in ce?Object.defineProperty(ce,ye,{value:ve,enumerable:!0,configurable:!0,writable:!0}):ce[ye]=ve,ce}({},ee,C.data[ee])):X},{});C.mux.log.info("Received event after at least an hour inactivity, creating a new view"),C.emit("viewinit",i()({viewer_time:V},J)),C.playbackHeartbeat._playheadShouldBeProgressing&&K.type!=="play"&&K.type!=="adbreakstart"&&(C.emit("play",{viewer_time:V}),K.type!=="playing"&&C.emit("playing",{viewer_time:V}))}})});function vr(F){return vr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},vr(F)}function Si(F,C){return function(w){if(Array.isArray(w))return w}(F)||function(w,K){var j=w==null?null:typeof Symbol!="undefined"&&w[Symbol.iterator]||w["@@iterator"];if(j!=null){var V,H,Q=[],J=!0,X=!1;try{for(j=j.call(w);!(J=(V=j.next()).done)&&(Q.push(V.value),!K||Q.length!==K);J=!0);}catch(ee){X=!0,H=ee}finally{try{J||j.return==null||j.return()}finally{if(X)throw H}}return Q}}(F,C)||function(w,K){if(w){if(typeof w=="string")return Ur(w,K);var j=Object.prototype.toString.call(w).slice(8,-1);return j==="Object"&&w.constructor&&(j=w.constructor.name),j==="Map"||j==="Set"?Array.from(w):j==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(j)?Ur(w,K):void 0}}(F,C)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Ur(F,C){(C==null||C>F.length)&&(C=F.length);for(var w=0,K=new Array(C);w<C;w++)K[w]=F[w];return K}function Nr(F,C){for(var w=0;w<C.length;w++){var K=C[w];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(F,K.key,K)}}function gr(F,C){return gr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(w,K){return w.__proto__=K,w},gr(F,C)}function Di(F){var C=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var w,K=Jt(F);if(C){var j=Jt(this).constructor;w=Reflect.construct(K,arguments,j)}else w=K.apply(this,arguments);return Li(this,w)}}function Li(F,C){if(C&&(vr(C)==="object"||typeof C=="function"))return C;if(C!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Fe(F)}function Fe(F){if(F===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return F}function Jt(F){return Jt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(C){return C.__proto__||Object.getPrototypeOf(C)},Jt(F)}var Ai=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],_i=function(F){(function(H,Q){if(typeof Q!="function"&&Q!==null)throw new TypeError("Super expression must either be null or a function");H.prototype=Object.create(Q&&Q.prototype,{constructor:{value:H,writable:!0,configurable:!0}}),Object.defineProperty(H,"prototype",{writable:!1}),Q&&gr(H,Q)})(V,F);var C,w,K,j=Di(V);function V(H,Q,J){var X;(function(se,le){if(!(se instanceof le))throw new TypeError("Cannot call a class as a function")})(this,V),(X=j.call(this)).DOM_CONTENT_LOADED_EVENT_END=d.domContentLoadedEventEnd(),X.NAVIGATION_START=d.navigationStart(),X.mux=H,X.id=Q,(J=i()({debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,disablePlayheadRebufferTracking:!1,errorTranslator:function(se){return se}},J)).data=J.data||{},J.data.property_key&&(J.data.env_key=J.data.property_key,delete J.data.property_key),e.setLevel(J.debug?"debug":"warn"),X.getPlayheadTime=J.getPlayheadTime,X.getStateData=J.getStateData||function(){return{}},X.getAdData=J.getAdData||function(){},X.minimumRebufferDuration=J.minimumRebufferDuration,X.sustainedRebufferThreshold=J.sustainedRebufferThreshold,X.playbackHeartbeatTime=J.playbackHeartbeatTime,X.disableRebufferTracking=J.disableRebufferTracking,X.disableRebufferTracking&&X.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),X.disablePlayheadRebufferTracking=J.disablePlayheadRebufferTracking,X.errorTranslator=J.errorTranslator,X.playbackEventDispatcher=new pi(H,J.data.env_key,J),X.data={player_instance_id:y(),mux_sample_rate:J.sampleRate,beacon_domain:J.beaconCollectionDomain?J.beaconCollectionDomain:J.beaconDomain},X.data.view_sequence_number=1,X.data.player_sequence_number=1,X.oldEmit=X.emit,X.emit=function(se,le){le=i()({viewer_time:this.mux.utils.now()},le),this.oldEmit(se,le)};var ee=function(){this.data.view_start===void 0&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}.bind(Fe(X));X.on("viewinit",function(se,le){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),i()(this.data,le),this._initializeViewData(),this.one("play",ee),this.one("adbreakstart",ee)});var ce=function(se){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",se)}.bind(Fe(X));if(X.on("videochange",function(se,le){ce(le)}),X.on("programchange",function(se,le){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),ce(i()(le,{view_program_changed:!0})),ee(),this.emit("play"),this.emit("playing")}),X.on("fragmentchange",function(se,le){this.currentFragmentPDT=le.currentFragmentPDT,this.currentFragmentStart=le.currentFragmentStart}),X.on("destroy",X.destroy),typeof window!="undefined"&&typeof window.addEventListener=="function"&&typeof window.removeEventListener=="function"){var ye=function(){var se=X.data.view_start!==void 0;X.mux.WINDOW_HIDDEN=document.visibilityState==="hidden",se&&X.mux.WINDOW_HIDDEN&&(X.data.player_is_paused||X.emit("hb"))};window.addEventListener("visibilitychange",ye,!1);var ve=function(se){se.persisted||X.destroy()};window.addEventListener("pagehide",ve,!1),X.on("destroy",function(){window.removeEventListener("visibilitychange",ye),window.removeEventListener("pagehide",ve)})}return X.on("playerready",function(se,le){i()(this.data,le)}),Ai.forEach(function(se){X.on(se,function(le,Se){se.indexOf("ad")!==0&&this._updateStateData(),i()(this.data,Se),this._sanitizeData()}),X.on("after"+se,function(){(se!=="error"||this.errorTracker.viewErrored)&&this.send(se)})}),X.on("viewend",function(se,le){i()(X.data,le)}),X.one("playerready",function(se){var le=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=le-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time}),X.longResumeTracker=new xi(Fe(X)),X.errorTracker=new ie(Fe(X)),new Xe(Fe(X)),X.seekingTracker=new qe(Fe(X)),X.playheadTime=new re(Fe(X)),X.playbackHeartbeat=new $(Fe(X)),new Ke(Fe(X)),X.watchTimeTracker=new ae(Fe(X)),new fe(Fe(X)),X.adTracker=new Ce(Fe(X)),new ke(Fe(X)),new Te(Fe(X)),new Be(Fe(X)),new We(Fe(X)),new yi(Fe(X)),J.hlsjs&&X.addHLSJS(J),J.dashjs&&X.addDashJS(J),X.emit("viewinit",J.data),X}return C=V,w=[{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,this.data.view_start!==void 0&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),window.clearTimeout(this._heartBeatTimeout))}},{key:"send",value:function(H){var Q=i()({},this.data);if(Q.video_source_is_live===void 0&&(Q.player_source_duration===1/0||Q.video_source_duration===1/0?Q.video_source_is_live=!0:(Q.player_source_duration>0||Q.video_source_duration>0)&&(Q.video_source_is_live=!1)),Q.video_source_is_live||["player_program_time","player_manifest_newest_program_time","player_live_edge_program_time","player_program_time","video_holdback","video_part_holdback","video_target_duration","video_part_target_duration"].forEach(function(ce){Q[ce]=void 0}),Q.video_source_url=Q.video_source_url||Q.player_source_url,Q.video_source_url){var J=Si(o(Q.video_source_url),2),X=J[0],ee=J[1];Q.video_source_domain=ee,Q.video_source_hostname=X}delete Q.ad_request_id,this.playbackEventDispatcher.send(H,Q),this.data.view_sequence_number++,this.data.player_sequence_number++,this._restartHeartBeat()}},{key:"_updateStateData",value:function(){i()(this.data,this.getStateData()),this.playheadTime._updatePlayheadTime(),this._sanitizeData()}},{key:"_sanitizeData",value:function(){var H=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach(function(Q){var J=parseInt(H.data[Q],10);H.data[Q]=isNaN(J)?void 0:J}),["player_source_url","video_source_url"].forEach(function(Q){if(H.data[Q]){var J=H.data[Q].toLowerCase();J.indexOf("data:")!==0&&J.indexOf("blob:")!==0||(H.data[Q]="MSE style URL")}})}},{key:"_resetVideoData",value:function(H,Q){var J=this;Object.keys(this.data).forEach(function(X){X.indexOf("video_")===0&&delete J.data[X]})}},{key:"_resetViewData",value:function(){var H=this;Object.keys(this.data).forEach(function(Q){Q.indexOf("view_")===0&&delete H.data[Q]}),this.data.view_sequence_number=1}},{key:"_resetErrorData",value:function(H,Q){delete this.data.player_error_code,delete this.data.player_error_message}},{key:"_initializeViewData",value:function(){var H=this,Q=this.data.view_id=y(),J=function(){Q===H.data.view_id&&t(H.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",J):J()}},{key:"_restartHeartBeat",value:function(){var H=this;window.clearTimeout(this._heartBeatTimeout),this.errorTracker.viewErrored||(this._heartBeatTimeout=window.setTimeout(function(){H.data.player_is_paused||H.emit("hb")},1e4))}},{key:"addHLSJS",value:function(H){H.hlsjs?this.hlsjs?this.mux.log.warn("An instance of HLS.js is already being monitored for this player."):(this.hlsjs=H.hlsjs,function(Q,J,X){var ee=arguments.length>4?arguments[4]:void 0,ce=Q.log,ye=Q.utils.secondsToMs,ve=function(pe){var oe,he=parseInt(ee.version);return he===1&&pe.programDateTime!==null&&(oe=pe.programDateTime),he===0&&pe.pdt!==null&&(oe=pe.pdt),oe};if(d.exists()){var se=function(pe,oe){return Q.emit(J,pe,oe)},le=function(pe,oe){var he=oe.levels,ue=oe.audioTracks,ge=oe.url,Re=oe.stats,Le=oe.networkDetails,rt=oe.sessionData,Ze={},ft={};he.forEach(function(ht,Bt){Ze[Bt]={width:ht.width,height:ht.height,bitrate:ht.bitrate,attrs:ht.attrs}}),ue.forEach(function(ht,Bt){ft[Bt]={name:ht.name,language:ht.lang,bitrate:ht.bitrate}});var dt=T(Re),ct=dt.bytesLoaded,He=dt.requestStart,yr=dt.responseStart,Tr=dt.responseEnd;se("requestcompleted",v(v({},a(rt)),{},{request_event_type:pe,request_bytes_loaded:ct,request_start:He,request_response_start:yr,request_response_end:Tr,request_type:"manifest",request_hostname:r(ge),request_response_headers:I(Le),request_rendition_lists:{media:Ze,audio:ft,video:{}}}))};X.on(ee.Events.MANIFEST_LOADED,le);var Se=function(pe,oe){var he=oe.details,ue=oe.level,ge=oe.networkDetails,Re=oe.stats,Le=T(Re),rt=Le.bytesLoaded,Ze=Le.requestStart,ft=Le.responseStart,dt=Le.responseEnd,ct=he.fragments[he.fragments.length-1],He=ve(ct)+ye(ct.duration);se("requestcompleted",{request_event_type:pe,request_bytes_loaded:rt,request_start:Ze,request_response_start:ft,request_response_end:dt,request_current_level:ue,request_type:"manifest",request_hostname:r(he.url),request_response_headers:I(ge),video_holdback:he.holdBack&&ye(he.holdBack),video_part_holdback:he.partHoldBack&&ye(he.partHoldBack),video_part_target_duration:he.partTarget&&ye(he.partTarget),video_target_duration:he.targetduration&&ye(he.targetduration),video_source_is_live:he.live,player_manifest_newest_program_time:isNaN(He)?void 0:He})};X.on(ee.Events.LEVEL_LOADED,Se);var ze=function(pe,oe){var he=oe.details,ue=oe.networkDetails,ge=oe.stats,Re=T(ge),Le=Re.bytesLoaded,rt=Re.requestStart,Ze=Re.responseStart,ft=Re.responseEnd;se("requestcompleted",{request_event_type:pe,request_bytes_loaded:Le,request_start:rt,request_response_start:Ze,request_response_end:ft,request_type:"manifest",request_hostname:r(he.url),request_response_headers:I(ue)})};X.on(ee.Events.AUDIO_TRACK_LOADED,ze);var $e=function(pe,oe){var he=oe.stats,ue=oe.networkDetails,ge=oe.frag;he=he||ge.stats;var Re=T(he),Le={request_event_type:pe,request_bytes_loaded:Re.bytesLoaded,request_start:Re.requestStart,request_response_start:Re.responseStart,request_response_end:Re.responseEnd,request_hostname:ue?r(ue.responseURL):void 0,request_response_headers:I(ue),request_media_duration:ge.duration};ge.type==="main"?(Le.request_type="media",Le.request_current_level=ge.level,Le.request_video_width=(X.levels[ge.level]||{}).width,Le.request_video_height=(X.levels[ge.level]||{}).height):Le.request_type=ge.type,se("requestcompleted",Le)};X.on(ee.Events.FRAG_LOADED,$e);var Dt=function(pe,oe){var he=oe.frag,ue=he.start,ge={currentFragmentPDT:ve(he),currentFragmentStart:ye(ue)};se("fragmentchange",ge)};X.on(ee.Events.FRAG_CHANGED,Dt);var De=function(pe,oe){var he=oe.type,ue=oe.details,ge=oe.response,Re=oe.fatal,Le=oe.context,rt=oe.frag;if(ue===ee.ErrorDetails.MANIFEST_LOAD_ERROR||ue===ee.ErrorDetails.MANIFEST_LOAD_TIMEOUT||ue===ee.ErrorDetails.FRAG_LOAD_ERROR||ue===ee.ErrorDetails.FRAG_LOAD_TIMEOUT||ue===ee.ErrorDetails.LEVEL_LOAD_ERROR||ue===ee.ErrorDetails.LEVEL_LOAD_TIMEOUT){var Ze=rt&&rt.url||Le&&Le.url||"";se("requestfailed",{request_error:ue,request_url:Ze,request_hostname:r(Ze),request_type:ue===ee.ErrorDetails.FRAG_LOAD_ERROR||ue===ee.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":"manifest",request_error_code:ge&&ge.code,request_error_text:ge&&ge.text})}Re&&se("error",{player_error_code:he,player_error_message:ue})};X.on(ee.Events.ERROR,De);var Je=function(pe,oe){var he=oe.frag,ue=he&&he._url||"";se("requestcanceled",{request_event_type:pe,request_url:ue,request_type:"media",request_hostname:r(ue)})};X.on(ee.Events.FRAG_LOAD_EMERGENCY_ABORTED,Je);var Ge=function(pe,oe){var he=oe.level,ue=X.levels[he];if(ue&&ue.attrs&&ue.attrs.BANDWIDTH){var ge,Re=ue.attrs.BANDWIDTH,Le=parseFloat(ue.attrs["FRAME-RATE"]);isNaN(Le)||(ge=Le),Re?se("renditionchange",{video_source_fps:ge,video_source_bitrate:Re,video_source_width:ue.width,video_source_height:ue.height}):ce.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};X.on(ee.Events.LEVEL_SWITCHED,Ge),X._stopMuxMonitor=function(){X.off(ee.Events.MANIFEST_LOADED,le),X.off(ee.Events.LEVEL_LOADED,Se),X.off(ee.Events.AUDIO_TRACK_LOADED,ze),X.off(ee.Events.FRAG_LOADED,$e),X.off(ee.Events.FRAG_CHANGED,Dt),X.off(ee.Events.ERROR,De),X.off(ee.Events.FRAG_LOAD_EMERGENCY_ABORTED,Je),X.off(ee.Events.LEVEL_SWITCHED,Ge),X.off(ee.Events.DESTROYING,X._stopMuxMonitor),delete X._stopMuxMonitor},X.on(ee.Events.DESTROYING,X._stopMuxMonitor)}else ce.warn("performance timing not supported. Not tracking HLS.js.")}(this.mux,this.id,H.hlsjs,{},H.Hls||window.Hls)):this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.")}},{key:"removeHLSJS",value:function(){var H;this.hlsjs&&((H=this.hlsjs)&&typeof H._stopMuxMonitor=="function"&&H._stopMuxMonitor(),this.hlsjs=void 0)}},{key:"addDashJS",value:function(H){H.dashjs?this.dashjs?this.mux.log.warn("An instance of Dash.js is already being monitored for this player."):(this.dashjs=H.dashjs,function(Q,J,X){var ee=Q.log;if(X&&X.on){var ce=function(De,Je){return Q.emit(J,De,Je)},ye=function(De){var Je=De.type,Ge=(De.data||{}).url;ce("requestcompleted",{request_event_type:Je,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:r(Ge)})};X.on("manifestLoaded",ye);var ve={},se=function(De){var Je=De.type,Ge=De.fragmentModel,pe=(De.chunk||{}).mediaInfo||{},oe=pe.type,he=pe.bitrateList,ue={};(he=he||[]).forEach(function(ct,He){ue[He]={},ue[He].width=ct.width,ue[He].height=ct.height,ue[He].bitrate=ct.bandwidth,ue[He].attrs={}}),oe==="video"?ve.video=ue:oe==="audio"?ve.audio=ue:ve.media=ue;var ge=k(Ge,X),Re=ge.requestStart,Le=ge.requestResponseStart,rt=ge.requestResponseEnd,Ze=ge.requestResponseHeaders,ft=ge.requestMediaDuration,dt=ge.requestHostname;ce("requestcompleted",{request_event_type:Je,request_start:Re,request_response_start:Le,request_response_end:rt,request_bytes_loaded:-1,request_type:oe+"_init",request_response_headers:Ze,request_hostname:dt,request_media_duration:ft,request_rendition_lists:ve})};X.on("initFragmentLoaded",se);var le=function(De){var Je=De.type,Ge=De.fragmentModel,pe=De.chunk||{},oe=pe.mediaInfo,he=pe.start,ue=(oe||{}).type,ge=k(Ge,X),Re=ge.requestStart,Le=ge.requestResponseStart,rt=ge.requestResponseEnd,Ze=ge.requestBytesLoaded,ft=ge.requestResponseHeaders,dt=ge.requestMediaDuration,ct=ge.requestHostname,He=B(ue,X),yr=He.currentLevel,Tr=He.renditionWidth,ht=He.renditionHeight,Bt=He.renditionBitrate;ce("requestcompleted",{request_event_type:Je,request_start:Re,request_response_start:Le,request_response_end:rt,request_bytes_loaded:Ze,request_type:ue,request_response_headers:ft,request_hostname:ct,request_media_start_time:he,request_media_duration:dt,request_current_level:yr,request_labeled_bitrate:Bt,request_video_width:Tr,request_video_height:ht})};X.on("mediaFragmentLoaded",le);var Se={video:void 0,audio:void 0,totalBitrate:void 0},ze=function(){if(Se.video&&typeof Se.video.bitrate=="number"){if(Se.video.width&&Se.video.height){var De=Se.video.bitrate;return Se.audio&&typeof Se.audio.bitrate=="number"&&(De+=Se.audio.bitrate),De!==Se.totalBitrate?(Se.totalBitrate=De,{video_source_bitrate:De,video_source_height:Se.video.height,video_source_width:Se.video.width}):void 0}ee.warn("have bitrate info for video but missing width/height")}},$e=function(De,Je,Ge){if(typeof De.newQuality=="number"){var pe=De.mediaType;if(pe==="audio"||pe==="video"){var oe=X.getBitrateInfoListFor(pe).find(function(ue){return ue.qualityIndex===De.newQuality});if(oe&&typeof oe.bitrate=="number"){Se[pe]=oe;var he=ze();he&&ce("renditionchange",he)}else ee.warn("missing bitrate info for ".concat(pe))}}else ee.warn("missing evt.newQuality in qualityChangeRendered event",De)};X.on("qualityChangeRendered",$e);var Dt=function(De){var Je=De.error,Ge=De.event,pe=(Ge=Ge||{}).request||{},oe=A().event&&A().event.currentTarget||{};ce("requestfailed",{request_error:Je+"_"+Ge.id+"_"+pe.type,request_url:Ge.url,request_hostname:r(Ge.url),request_type:pe.mediaType,request_error_code:oe.status,request_error_type:oe.statusText})};X.on("error",Dt),X._stopMuxMonitor=function(){X.off("manifestLoaded",ye),X.off("initFragmentLoaded",se),X.off("mediaFragmentLoaded",le),X.off("qualityChangeRendered",$e),X.off("error",Dt),delete X._stopMuxMonitor}}else ee.warn("Invalid dash.js player reference. Monitoring blocked.")}(this.mux,this.id,H.dashjs)):this.mux.log.warn("You must pass a valid dashjs instance in order to track it.")}},{key:"removeDashJS",value:function(){var H;this.dashjs&&((H=this.dashjs)&&typeof H._stopMuxMonitor=="function"&&H._stopMuxMonitor(),this.dashjs=void 0)}}],w&&Nr(C.prototype,w),K&&Nr(C,K),Object.defineProperty(C,"prototype",{writable:!1}),V}(z),bi=_i,Oi=R(153),Ft=R.n(Oi);function mr(F){return mr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},mr(F)}function Kr(F,C){return function(w){if(Array.isArray(w))return w}(F)||function(w,K){var j=w==null?null:typeof Symbol!="undefined"&&w[Symbol.iterator]||w["@@iterator"];if(j!=null){var V,H,Q=[],J=!0,X=!1;try{for(j=j.call(w);!(J=(V=j.next()).done)&&(Q.push(V.value),!K||Q.length!==K);J=!0);}catch(ee){X=!0,H=ee}finally{try{J||j.return==null||j.return()}finally{if(X)throw H}}return Q}}(F,C)||function(w,K){if(w){if(typeof w=="string")return jr(w,K);var j=Object.prototype.toString.call(w).slice(8,-1);return j==="Object"&&w.constructor&&(j=w.constructor.name),j==="Map"||j==="Set"?Array.from(w):j==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(j)?jr(w,K):void 0}}(F,C)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function jr(F,C){(C==null||C>F.length)&&(C=F.length);for(var w=0,K=new Array(C);w<C;w++)K[w]=F[w];return K}var Rt,Ri=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],Ii={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"};A()&&A().WeakMap&&(Rt=new WeakMap);var Pi="#EXT-X-TARGETDURATION",Ci="#EXT-X-PART-INF",Mi="#EXT-X-SERVER-CONTROL",wi="#EXTINF",Fi="#EXT-X-PROGRAM-DATE-TIME",ki="#EXT-X-VERSION",Bi="#EXT-X-SESSION-DATA",Zt=function(F){return this.buffer="",this.manifest={segments:[],serverControl:{},sessionData:{}},this.currentUri={},this.process(F),this.manifest};Zt.prototype.process=function(F){var C;for(this.buffer+=F,C=this.buffer.indexOf(`
`);C>-1;C=this.buffer.indexOf(`
`))this.processLine(this.buffer.substring(0,C)),this.buffer=this.buffer.substring(C+1)},Zt.prototype.processLine=function(F){var C=F.indexOf(":"),w=ji(F,C),K=w[0],j=w.length===2?Er(w[1]):void 0;if(K[0]!=="#")this.currentUri.uri=K,this.manifest.segments.push(this.currentUri),this.manifest.targetDuration&&!("duration"in this.currentUri)&&(this.currentUri.duration=this.manifest.targetDuration),this.currentUri={};else switch(K){case Pi:if(!isFinite(j)||j<0)return;this.manifest.targetDuration=j,this.setHoldBack();break;case Ci:pr(this.manifest,w),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),this.setHoldBack();break;case Mi:pr(this.manifest,w),this.setHoldBack();break;case wi:j===0?this.currentUri.duration=.01:j>0&&(this.currentUri.duration=j);break;case Fi:var V=j,H=new Date(V);this.manifest.dateTimeString||(this.manifest.dateTimeString=V,this.manifest.dateTimeObject=H),this.currentUri.dateTimeString=V,this.currentUri.dateTimeObject=H;break;case ki:pr(this.manifest,w);break;case Bi:var Q=Wi(w[1]),J=a(Q);i()(this.manifest.sessionData,J)}},Zt.prototype.setHoldBack=function(){var F=this.manifest,C=F.serverControl,w=F.targetDuration,K=F.partTargetDuration;if(C){var j="holdBack",V="partHoldBack",H=w&&3*w,Q=K&&2*K;w&&!C.hasOwnProperty(j)&&(C[j]=H),H&&C[j]<H&&(C[j]=H),K&&!C.hasOwnProperty(V)&&(C[V]=3*K),K&&C[V]<Q&&(C[V]=Q)}};var pr=function(F,C){var w,K=Wr(C[0].replace("#EXT-X-",""));Ki(C[1])?(w={},w=i()(Ni(C[1]),w)):w=Er(C[1]),F[K]=w},Wr=function(F){return F.toLowerCase().replace(/-(\w)/g,function(C){return C[1].toUpperCase()})},Er=function(F){if(F.toLowerCase()==="yes"||F.toLowerCase()==="no")return F.toLowerCase()==="yes";var C=F.indexOf(":")!==-1?F:parseFloat(F);return isNaN(C)?F:C},Ui=function(F){var C={},w=F.split("=");return w.length>1&&(C[Wr(w[0])]=Er(w[1])),C},Ni=function(F){for(var C=F.split(","),w={},K=0;C.length>K;K++){var j=C[K],V=Ui(j);w=i()(V,w)}return w},Ki=function(F){return F.indexOf("=")>-1},ji=function(F,C){return C===-1?[F]:[F.substring(0,C),F.substring(C+1)]},Wi=function(F){var C={};if(F){var w=F.search(",");return[F.slice(0,w),F.slice(w+1)].forEach(function(K,j){for(var V=K.replace(/['"]+/g,"").split("="),H=0;H<V.length;H++)V[H]==="DATA-ID"&&(C["DATA-ID"]=V[1-H]),V[H]==="VALUE"&&(C.VALUE=V[1-H])}),{data:C}}},Gi=Zt,Hi={safeCall:function(F,C,w,K){var j=K;if(F&&typeof F[C]=="function")try{j=F[C].apply(F,w)}catch(V){e.info("safeCall error",V)}return j},safeIncrement:t,getComputedStyle:function(F,C){var w;if(F&&C&&A()&&typeof A().getComputedStyle=="function")return Rt&&Rt.has(F)&&(w=Rt.get(F)),w||(w=A().getComputedStyle(F,null),Rt&&Rt.set(F,w)),w.getPropertyValue(C)},secondsToMs:function(F){return Math.floor(1e3*F)},assign:i(),headersStringToObject:l,extractHostnameAndDomain:o,extractHostname:r,manifestParser:Gi,generateShortID:x,generateUUID:y,now:c.now},Vi={PLAYER_READY:"playerready",VIEW_INIT:"viewinit",VIDEO_CHANGE:"videochange",PLAY:"play",PAUSE:"pause",PLAYING:"playing",TIME_UPDATE:"timeupdate",SEEKING:"seeking",SEEKED:"seeked",REBUFFER_START:"rebufferstart",REBUFFER_END:"rebufferend",ERROR:"error",ENDED:"ended",RENDITION_CHANGE:"renditionchange",ORIENTATION_CHANGE:"orientationchange",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_BREAK_START:"adbreakstart",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_FIRST_QUARTILE:"adfirstquartile",AD_MID_POINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile",AD_ENDED:"adended",AD_BREAK_END:"adbreakend",AD_ERROR:"aderror",REQUEST_COMPLETED:"requestcompleted",REQUEST_FAILED:"requestfailed",REQUEST_CANCELLED:"requestcanceled"};function Yi(F,C){return function(w){if(Array.isArray(w))return w}(F)||function(w,K){var j=w==null?null:typeof Symbol!="undefined"&&w[Symbol.iterator]||w["@@iterator"];if(j!=null){var V,H,Q=[],J=!0,X=!1;try{for(j=j.call(w);!(J=(V=j.next()).done)&&(Q.push(V.value),!K||Q.length!==K);J=!0);}catch(ee){X=!0,H=ee}finally{try{J||j.return==null||j.return()}finally{if(X)throw H}}return Q}}(F,C)||function(w,K){if(w){if(typeof w=="string")return Gr(w,K);var j=Object.prototype.toString.call(w).slice(8,-1);return j==="Object"&&w.constructor&&(j=w.constructor.name),j==="Map"||j==="Set"?Array.from(w):j==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(j)?Gr(w,K):void 0}}(F,C)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Gr(F,C){(C==null||C>F.length)&&(C=F.length);for(var w=0,K=new Array(C);w<C;w++)K[w]=F[w];return K}var tt={},kt=function F(C){var w=arguments;typeof C=="string"?F.hasOwnProperty(C)?A().setTimeout(function(){w=Array.prototype.splice.call(w,1),F[C].apply(null,w)},0):e.warn("`"+C+"` is an unknown task"):typeof C=="function"?A().setTimeout(function(){C(F)},0):e.warn("`"+C+"` is invalid.")},zi={loaded:c.now(),NAME:"mux-embed",VERSION:"4.14.0",API_VERSION:"2.1",PLAYER_TRACKED:!1,monitor:function(F,C){return function(w,K,j){var V=Kr(E(K),3),H=V[0],Q=V[1],J=V[2],X=w.log,ee=w.utils.getComputedStyle,ce=w.utils.secondsToMs;if(!H)return X.error("No element was found with the `"+Q+"` query selector.");if(J!=="video"&&J!=="audio")return X.error("The element of `"+Q+"` was not a media element.");H.mux&&(H.mux.destroy(),delete H.mux,X.warn("Already monitoring this video element, replacing existing event listeners")),(j=i()({automaticErrorTracking:!0},j)).data=i()({player_software:"HTML5 Video Element",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:w.VERSION},j.data),j.getPlayheadTime=function(){return ce(H.currentTime)},j.getStateData=function(){var ve=this.hlsjs&&this.hlsjs.url,se=this.dashjs&&mr(this.dashjs.getSource==="function")&&this.dashjs.getSource(),le={player_is_paused:H.paused,player_playhead_time:ce(H.currentTime),player_width:parseInt(ee(H,"width")),player_height:parseInt(ee(H,"height")),player_autoplay_on:H.autoplay,player_preload_on:H.preload,player_language_code:H.lang,player_is_fullscreen:Ft()&&!!(Ft().fullscreenElement||Ft().webkitFullscreenElement||Ft().mozFullScreenElement||Ft().msFullscreenElement),video_poster_url:H.poster,video_source_url:ve||se||H.currentSrc,video_source_duration:ce(H.duration),video_source_height:H.videoHeight,video_source_width:H.videoWidth},Se=j.getPlayheadTime();if(H.getStartDate&&Se>0){var ze=H.getStartDate();if(ze&&typeof ze.getTime=="function"&&ze.getTime()){var $e=ze.getTime();if(le.player_program_time=$e+Se,H.seekable.length>0){var Dt=$e+H.seekable.end(H.seekable.length-1);le.player_live_edge_program_time=Dt}}}return le},H.mux=H.mux||{},H.mux.deleted=!1,H.mux.emit=function(ve,se){w.emit(Q,ve,se)};var ye=function(){X.error("The monitor for this video element has already been destroyed.")};H.mux.destroy=function(){Object.keys(H.mux.listeners).forEach(function(ve){H.removeEventListener(ve,H.mux.listeners[ve],!1)}),delete H.mux.listeners,H.mux.destroy=ye,H.mux.swapElement=ye,H.mux.emit=ye,H.mux.addHLSJS=ye,H.mux.addDashJS=ye,H.mux.removeHLSJS=ye,H.mux.removeDashJS=ye,H.mux.deleted=!0,w.emit(Q,"destroy")},H.mux.swapElement=function(ve){var se=Kr(E(ve),3),le=se[0],Se=se[1],ze=se[2];return le?ze!=="video"&&ze!=="audio"?w.log.error("The element of `"+Se+"` was not a media element."):(le.muxId=H.muxId,delete H.muxId,le.mux=le.mux||{},le.mux.listeners=i()({},H.mux.listeners),delete H.mux.listeners,Object.keys(le.mux.listeners).forEach(function($e){H.removeEventListener($e,le.mux.listeners[$e],!1),le.addEventListener($e,le.mux.listeners[$e],!1)}),le.mux.swapElement=H.mux.swapElement,le.mux.destroy=H.mux.destroy,delete H.mux,void(H=le)):w.log.error("No element was found with the `"+Se+"` query selector.")},H.mux.addHLSJS=function(ve){w.addHLSJS(Q,ve)},H.mux.addDashJS=function(ve){w.addDashJS(Q,ve)},H.mux.removeHLSJS=function(){w.removeHLSJS(Q)},H.mux.removeDashJS=function(){w.removeDashJS(Q)},w.init(Q,j),w.emit(Q,"playerready"),H.paused||(w.emit(Q,"play"),H.readyState>2&&w.emit(Q,"playing")),H.mux.listeners={},Ri.forEach(function(ve){(ve!=="error"||j.automaticErrorTracking)&&(H.mux.listeners[ve]=function(){var se={};if(ve==="error"){if(!H.error||H.error.code===1)return;se.player_error_code=H.error.code,se.player_error_message=Ii[H.error.code]||H.error.message}w.emit(Q,ve,se)},H.addEventListener(ve,H.mux.listeners[ve],!1))})}(kt,F,C)},destroyMonitor:function(F){var C=Yi(E(F),1)[0];C&&C.mux&&typeof C.mux.destroy=="function"?C.mux.destroy():e.error("A video element monitor for `"+F+"` has not been initialized via `mux.monitor`.")},addHLSJS:function(F,C){var w=D(F);tt[w]?tt[w].addHLSJS(C):e.error("A monitor for `"+w+"` has not been initialized.")},addDashJS:function(F,C){var w=D(F);tt[w]?tt[w].addDashJS(C):e.error("A monitor for `"+w+"` has not been initialized.")},removeHLSJS:function(F){var C=D(F);tt[C]?tt[C].removeHLSJS():e.error("A monitor for `"+C+"` has not been initialized.")},removeDashJS:function(F){var C=D(F);tt[C]?tt[C].removeDashJS():e.error("A monitor for `"+C+"` has not been initialized.")},init:function(F,C){s()&&C&&C.respectDoNotTrack&&e.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var w=D(F);tt[w]=new bi(kt,w,C)},emit:function(F,C,w){var K=D(F);tt[K]?(tt[K].emit(C,w),C==="destroy"&&delete tt[K]):e.error("A monitor for `"+K+"` has not been initialized.")},checkDoNotTrack:s,log:e,utils:Hi,events:Vi,WINDOW_HIDDEN:!1,WINDOW_UNLOADING:!1};Object.assign(kt,zi),A()!==void 0&&typeof A().addEventListener=="function"&&A().addEventListener("pagehide",function(F){F.persisted||(kt.WINDOW_UNLOADING=!0)},!1);var Xi=kt},655:function(L,M,R){var b,A;function y(x){return y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},y(x);}(function(x){var D=!1;if((A=typeof(b=x)=="function"?b.call(M,R,M,L):b)===void 0||(L.exports=A),D=!0,y(M)==="object"&&(L.exports=x(),D=!0),!D){var E=window.Cookies,m=window.Cookies=x();m.noConflict=function(){return window.Cookies=E,m}}})(function(){var x=function(){for(var D=0,E={};D<arguments.length;D++){var m=arguments[D];for(var p in m)E[p]=m[p]}return E};return function D(E){function m(p,u,e){var s;if(typeof document!="undefined"){if(arguments.length>1){if(typeof(e=x({path:"/"},m.defaults,e)).expires=="number"){var c=new Date;c.setMilliseconds(c.getMilliseconds()+864e5*e.expires),e.expires=c}try{s=JSON.stringify(u),/^[\{\[]/.test(s)&&(u=s)}catch{}return u=E.write?E.write(u,p):encodeURIComponent(String(u)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),p=(p=(p=encodeURIComponent(String(p))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[p,"=",u,e.expires?"; expires="+e.expires.toUTCString():"",e.path?"; path="+e.path:"",e.domain?"; domain="+e.domain:"",e.secure?"; secure":""].join("")}p||(s={});for(var g=document.cookie?document.cookie.split("; "):[],i=/(%[0-9A-Z]{2})+/g,r=0;r<g.length;r++){var o=g[r].split("="),d=o.slice(1).join("=");d.charAt(0)==='"'&&(d=d.slice(1,-1));try{var t=o[0].replace(i,decodeURIComponent);if(d=E.read?E.read(d,t):E(d,t)||d.replace(i,decodeURIComponent),this.json)try{d=JSON.parse(d)}catch{}if(p===t){s=d;break}p||(s[t]=d)}catch{}}return s}}return m.set=m,m.get=function(p){return m.call(m,p)},m.getJSON=function(){return m.apply({json:!0},[].slice.call(arguments))},m.defaults={},m.remove=function(p,u){m(p,"",x(u,{expires:-1}))},m.withConverter=D,m}(function(){})})},153:function(L,M,R){var b,A=R.g!==void 0?R.g:typeof window!="undefined"?window:{},y=R(558);typeof document!="undefined"?b=document:(b=A["__GLOBAL_DOCUMENT_CACHE@4"])||(b=A["__GLOBAL_DOCUMENT_CACHE@4"]=y),L.exports=b},48:function(L,M,R){var b;b=typeof window!="undefined"?window:R.g!==void 0?R.g:typeof self!="undefined"?self:{},L.exports=b},678:function(L){var M=9007199254740991,R="[object Arguments]",b="[object Function]",A="[object GeneratorFunction]",y=/^(?:0|[1-9]\d*)$/;function x(S,T,I){switch(I.length){case 0:return S.call(T);case 1:return S.call(T,I[0]);case 2:return S.call(T,I[0],I[1]);case 3:return S.call(T,I[0],I[1],I[2])}return S.apply(T,I)}var D,E,m=Object.prototype,p=m.hasOwnProperty,u=m.toString,e=m.propertyIsEnumerable,s=(D=Object.keys,E=Object,function(S){return D(E(S))}),c=Math.max,g=!e.call({valueOf:1},"valueOf");function i(S,T){var I=n(S)||function(W){return function(G){return function(z){return!!z&&typeof z=="object"}(G)&&l(G)}(W)&&p.call(W,"callee")&&(!e.call(W,"callee")||u.call(W)==R)}(S)?function(W,G){for(var z=-1,Y=Array(W);++z<W;)Y[z]=G(z);return Y}(S.length,String):[],k=I.length,B=!!k;for(var N in S)!T&&!p.call(S,N)||B&&(N=="length"||o(N,k))||I.push(N);return I}function r(S,T,I){var k=S[T];p.call(S,T)&&t(k,I)&&(I!==void 0||T in S)||(S[T]=I)}function o(S,T){return!!(T=T==null?M:T)&&(typeof S=="number"||y.test(S))&&S>-1&&S%1==0&&S<T}function d(S){var T=S&&S.constructor;return S===(typeof T=="function"&&T.prototype||m)}function t(S,T){return S===T||S!=S&&T!=T}var n=Array.isArray;function l(S){return S!=null&&function(T){return typeof T=="number"&&T>-1&&T%1==0&&T<=M}(S.length)&&!function(T){var I=a(T)?u.call(T):"";return I==b||I==A}(S)}function a(S){var T=typeof S;return!!S&&(T=="object"||T=="function")}var f,v=(f=function(S,T){if(g||d(T)||l(T))(function(k,B,N,W){N||(N={});for(var G=-1,z=B.length;++G<z;){var Y=B[G],$=W?W(N[Y],k[Y],Y,N,k):void 0;r(N,Y,$===void 0?k[Y]:$)}})(T,function(k){return l(k)?i(k):function(B){if(!d(B))return s(B);var N=[];for(var W in Object(B))p.call(B,W)&&W!="constructor"&&N.push(W);return N}(k)}(T),S);else for(var I in T)p.call(T,I)&&r(S,I,T[I])},function(S,T){return T=c(T===void 0?S.length-1:T,0),function(){for(var I=arguments,k=-1,B=c(I.length-T,0),N=Array(B);++k<B;)N[k]=I[T+k];k=-1;for(var W=Array(T+1);++k<T;)W[k]=I[k];return W[T]=N,x(S,this,W)}}(function(S,T){var I=-1,k=T.length,B=k>1?T[k-1]:void 0,N=k>2?T[2]:void 0;for(B=f.length>3&&typeof B=="function"?(k--,B):void 0,N&&function(G,z,Y){if(!a(Y))return!1;var $=typeof z;return!!($=="number"?l(Y)&&o(z,Y.length):$=="string"&&z in Y)&&t(Y[z],G)}(T[0],T[1],N)&&(B=k<3?void 0:B,k=1),S=Object(S);++I<k;){var W=T[I];W&&f(S,W,I,B)}return S}));L.exports=v},640:function(L,M,R){var b,A;(function(y,x){"use strict";b=function(){var D=function(){},E="undefined",m=typeof window!==E&&typeof window.navigator!==E&&/Trident\/|MSIE /.test(window.navigator.userAgent),p=["trace","debug","info","warn","error"];function u(n,l){var a=n[l];if(typeof a.bind=="function")return a.bind(n);try{return Function.prototype.bind.call(a,n)}catch{return function(){return Function.prototype.apply.apply(a,[n,arguments])}}}function e(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(n){return n==="debug"&&(n="log"),typeof console!==E&&(n==="trace"&&m?e:console[n]!==void 0?u(console,n):console.log!==void 0?u(console,"log"):D)}function c(n,l){for(var a=0;a<p.length;a++){var f=p[a];this[f]=a<n?D:this.methodFactory(f,n,l)}this.log=this.debug}function g(n,l,a){return function(){typeof console!==E&&(c.call(this,l,a),this[n].apply(this,arguments))}}function i(n,l,a){return s(n)||g.apply(this,arguments)}function r(n,l,a){var f,v=this;l=l==null?"WARN":l;var S="loglevel";function T(N){var W=(p[N]||"silent").toUpperCase();if(typeof window!==E&&S){try{return void(window.localStorage[S]=W)}catch{}try{window.document.cookie=encodeURIComponent(S)+"="+W+";"}catch{}}}function I(){var N;if(typeof window!==E&&S){try{N=window.localStorage[S]}catch{}if(typeof N===E)try{var W=window.document.cookie,G=W.indexOf(encodeURIComponent(S)+"=");G!==-1&&(N=/^([^;]+)/.exec(W.slice(G))[1])}catch{}return v.levels[N]===void 0&&(N=void 0),N}}function k(){if(typeof window!==E&&S){try{return void window.localStorage.removeItem(S)}catch{}try{window.document.cookie=encodeURIComponent(S)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}typeof n=="string"?S+=":"+n:typeof n=="symbol"&&(S=void 0),v.name=n,v.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},v.methodFactory=a||i,v.getLevel=function(){return f},v.setLevel=function(N,W){if(typeof N=="string"&&v.levels[N.toUpperCase()]!==void 0&&(N=v.levels[N.toUpperCase()]),!(typeof N=="number"&&N>=0&&N<=v.levels.SILENT))throw"log.setLevel() called with invalid level: "+N;if(f=N,W!==!1&&T(N),c.call(v,N,n),typeof console===E&&N<v.levels.SILENT)return"No console available for logging"},v.setDefaultLevel=function(N){l=N,I()||v.setLevel(N,!1)},v.resetLevel=function(){v.setLevel(l,!1),k()},v.enableAll=function(N){v.setLevel(v.levels.TRACE,N)},v.disableAll=function(N){v.setLevel(v.levels.SILENT,N)};var B=I();B==null&&(B=l),v.setLevel(B,!1)}var o=new r,d={};o.getLogger=function(n){if(typeof n!="symbol"&&typeof n!="string"||n==="")throw new TypeError("You must supply a name when creating a logger.");var l=d[n];return l||(l=d[n]=new r(n,o.getLevel(),o.methodFactory)),l};var t=typeof window!==E?window.log:void 0;return o.noConflict=function(){return typeof window!==E&&window.log===o&&(window.log=t),o},o.getLoggers=function(){return d},o.default=o,o},(A=typeof b=="function"?b.call(M,R,M,L):b)===void 0||(L.exports=A)})()},375:function(L,M){"use strict";var R=Object.prototype.hasOwnProperty;function b(y){try{return decodeURIComponent(y.replace(/\+/g," "))}catch{return null}}function A(y){try{return encodeURIComponent(y)}catch{return null}}M.stringify=function(y,x){x=x||"";var D,E,m=[];for(E in typeof x!="string"&&(x="?"),y)if(R.call(y,E)){if((D=y[E])||D!=null&&!isNaN(D)||(D=""),E=A(E),D=A(D),E===null||D===null)continue;m.push(E+"="+D)}return m.length?x+m.join("&"):""},M.parse=function(y){for(var x,D=/([^=?#&]+)=?([^&]*)/g,E={};x=D.exec(y);){var m=b(x[1]),p=b(x[2]);m===null||p===null||m in E||(E[m]=p)}return E}},558:function(){}},P={};function _(L){var M=P[L];if(M!==void 0)return M.exports;var R=P[L]={exports:{}};return h[L].call(R.exports,R,R.exports,_),R.exports}return _.n=function(L){var M=L&&L.__esModule?function(){return L.default}:function(){return L};return _.d(M,{a:M}),M},_.d=function(L,M){for(var R in M)_.o(M,R)&&!_.o(L,R)&&Object.defineProperty(L,R,{enumerable:!0,get:M[R]})},_.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),_.o=function(L,M){return Object.prototype.hasOwnProperty.call(L,M)},_(80)}()},typeof er=="object"&&typeof Sr=="object"?Sr.exports=O():typeof er=="object"?er.mux=O():U.mux=O()})()});var tr=Hr((Ut,Dr)=>{typeof window!="undefined"&&function(O,h){typeof Ut=="object"&&typeof Dr=="object"?Dr.exports=h():typeof define=="function"&&define.amd?define([],h):typeof Ut=="object"?Ut.Hls=h():O.Hls=h()}(Ut,function(){return function(U){var O={};function h(P){if(O[P])return O[P].exports;var _=O[P]={i:P,l:!1,exports:{}};return U[P].call(_.exports,_,_.exports,h),_.l=!0,_.exports}return h.m=U,h.c=O,h.d=function(P,_,L){h.o(P,_)||Object.defineProperty(P,_,{enumerable:!0,get:L})},h.r=function(P){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(P,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(P,"__esModule",{value:!0})},h.t=function(P,_){if(_&1&&(P=h(P)),_&8||_&4&&typeof P=="object"&&P&&P.__esModule)return P;var L=Object.create(null);if(h.r(L),Object.defineProperty(L,"default",{enumerable:!0,value:P}),_&2&&typeof P!="string")for(var M in P)h.d(L,M,function(R){return P[R]}.bind(null,M));return L},h.n=function(P){var _=P&&P.__esModule?function(){return P.default}:function(){return P};return h.d(_,"a",_),_},h.o=function(P,_){return Object.prototype.hasOwnProperty.call(P,_)},h.p="/dist/",h(h.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(U,O,h){"use strict";var P=Object.prototype.hasOwnProperty,_="~";function L(){}Object.create&&(L.prototype=Object.create(null),new L().__proto__||(_=!1));function M(y,x,D){this.fn=y,this.context=x,this.once=D||!1}function R(y,x,D,E,m){if(typeof D!="function")throw new TypeError("The listener must be a function");var p=new M(D,E||y,m),u=_?_+x:x;return y._events[u]?y._events[u].fn?y._events[u]=[y._events[u],p]:y._events[u].push(p):(y._events[u]=p,y._eventsCount++),y}function b(y,x){--y._eventsCount===0?y._events=new L:delete y._events[x]}function A(){this._events=new L,this._eventsCount=0}A.prototype.eventNames=function(){var x=[],D,E;if(this._eventsCount===0)return x;for(E in D=this._events)P.call(D,E)&&x.push(_?E.slice(1):E);return Object.getOwnPropertySymbols?x.concat(Object.getOwnPropertySymbols(D)):x},A.prototype.listeners=function(x){var D=_?_+x:x,E=this._events[D];if(!E)return[];if(E.fn)return[E.fn];for(var m=0,p=E.length,u=new Array(p);m<p;m++)u[m]=E[m].fn;return u},A.prototype.listenerCount=function(x){var D=_?_+x:x,E=this._events[D];return E?E.fn?1:E.length:0},A.prototype.emit=function(x,D,E,m,p,u){var e=_?_+x:x;if(!this._events[e])return!1;var s=this._events[e],c=arguments.length,g,i;if(s.fn){switch(s.once&&this.removeListener(x,s.fn,void 0,!0),c){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,D),!0;case 3:return s.fn.call(s.context,D,E),!0;case 4:return s.fn.call(s.context,D,E,m),!0;case 5:return s.fn.call(s.context,D,E,m,p),!0;case 6:return s.fn.call(s.context,D,E,m,p,u),!0}for(i=1,g=new Array(c-1);i<c;i++)g[i-1]=arguments[i];s.fn.apply(s.context,g)}else{var r=s.length,o;for(i=0;i<r;i++)switch(s[i].once&&this.removeListener(x,s[i].fn,void 0,!0),c){case 1:s[i].fn.call(s[i].context);break;case 2:s[i].fn.call(s[i].context,D);break;case 3:s[i].fn.call(s[i].context,D,E);break;case 4:s[i].fn.call(s[i].context,D,E,m);break;default:if(!g)for(o=1,g=new Array(c-1);o<c;o++)g[o-1]=arguments[o];s[i].fn.apply(s[i].context,g)}}return!0},A.prototype.on=function(x,D,E){return R(this,x,D,E,!1)},A.prototype.once=function(x,D,E){return R(this,x,D,E,!0)},A.prototype.removeListener=function(x,D,E,m){var p=_?_+x:x;if(!this._events[p])return this;if(!D)return b(this,p),this;var u=this._events[p];if(u.fn)u.fn===D&&(!m||u.once)&&(!E||u.context===E)&&b(this,p);else{for(var e=0,s=[],c=u.length;e<c;e++)(u[e].fn!==D||m&&!u[e].once||E&&u[e].context!==E)&&s.push(u[e]);s.length?this._events[p]=s.length===1?s[0]:s:b(this,p)}return this},A.prototype.removeAllListeners=function(x){var D;return x?(D=_?_+x:x,this._events[D]&&b(this,D)):(this._events=new L,this._eventsCount=0),this},A.prototype.off=A.prototype.removeListener,A.prototype.addListener=A.prototype.on,A.prefixed=_,A.EventEmitter=A,U.exports=A},"./node_modules/url-toolkit/src/url-toolkit.js":function(U,O,h){(function(P){var _=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,L=/^(?=([^\/?#]*))\1([^]*)$/,M=/(?:\/|^)\.(?=\/)/g,R=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,b={buildAbsoluteURL:function(A,y,x){if(x=x||{},A=A.trim(),y=y.trim(),!y){if(!x.alwaysNormalize)return A;var D=b.parseURL(A);if(!D)throw new Error("Error trying to parse base URL.");return D.path=b.normalizePath(D.path),b.buildURLFromParts(D)}var E=b.parseURL(y);if(!E)throw new Error("Error trying to parse relative URL.");if(E.scheme)return x.alwaysNormalize?(E.path=b.normalizePath(E.path),b.buildURLFromParts(E)):y;var m=b.parseURL(A);if(!m)throw new Error("Error trying to parse base URL.");if(!m.netLoc&&m.path&&m.path[0]!=="/"){var p=L.exec(m.path);m.netLoc=p[1],m.path=p[2]}m.netLoc&&!m.path&&(m.path="/");var u={scheme:m.scheme,netLoc:E.netLoc,path:null,params:E.params,query:E.query,fragment:E.fragment};if(!E.netLoc&&(u.netLoc=m.netLoc,E.path[0]!=="/"))if(!E.path)u.path=m.path,E.params||(u.params=m.params,E.query||(u.query=m.query));else{var e=m.path,s=e.substring(0,e.lastIndexOf("/")+1)+E.path;u.path=b.normalizePath(s)}return u.path===null&&(u.path=x.alwaysNormalize?b.normalizePath(E.path):E.path),b.buildURLFromParts(u)},parseURL:function(A){var y=_.exec(A);return y?{scheme:y[1]||"",netLoc:y[2]||"",path:y[3]||"",params:y[4]||"",query:y[5]||"",fragment:y[6]||""}:null},normalizePath:function(A){for(A=A.split("").reverse().join("").replace(M,"");A.length!==(A=A.replace(R,"")).length;);return A.split("").reverse().join("")},buildURLFromParts:function(A){return A.scheme+A.netLoc+A.path+A.params+A.query+A.fragment}};U.exports=b})(this)},"./node_modules/webworkify-webpack/index.js":function(U,O,h){function P(x){var D={};function E(p){if(D[p])return D[p].exports;var u=D[p]={i:p,l:!1,exports:{}};return x[p].call(u.exports,u,u.exports,E),u.l=!0,u.exports}E.m=x,E.c=D,E.i=function(p){return p},E.d=function(p,u,e){E.o(p,u)||Object.defineProperty(p,u,{configurable:!1,enumerable:!0,get:e})},E.r=function(p){Object.defineProperty(p,"__esModule",{value:!0})},E.n=function(p){var u=p&&p.__esModule?function(){return p.default}:function(){return p};return E.d(u,"a",u),u},E.o=function(p,u){return Object.prototype.hasOwnProperty.call(p,u)},E.p="/",E.oe=function(p){throw console.error(p),p};var m=E(E.s=ENTRY_MODULE);return m.default||m}var _="[\\.|\\-|\\+|\\w|/|@]+",L="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+_+").*?\\)";function M(x){return(x+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function R(x){return!isNaN(1*x)}function b(x,D,E){var m={};m[E]=[];var p=D.toString(),u=p.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!u)return m;for(var e=u[1],s=new RegExp("(\\\\n|\\W)"+M(e)+L,"g"),c;c=s.exec(p);)c[3]!=="dll-reference"&&m[E].push(c[3]);for(s=new RegExp("\\("+M(e)+'\\("(dll-reference\\s('+_+'))"\\)\\)'+L,"g");c=s.exec(p);)x[c[2]]||(m[E].push(c[1]),x[c[2]]=h(c[1]).m),m[c[2]]=m[c[2]]||[],m[c[2]].push(c[4]);for(var g=Object.keys(m),i=0;i<g.length;i++)for(var r=0;r<m[g[i]].length;r++)R(m[g[i]][r])&&(m[g[i]][r]=1*m[g[i]][r]);return m}function A(x){var D=Object.keys(x);return D.reduce(function(E,m){return E||x[m].length>0},!1)}function y(x,D){for(var E={main:[D]},m={main:[]},p={main:{}};A(E);)for(var u=Object.keys(E),e=0;e<u.length;e++){var s=u[e],c=E[s],g=c.pop();if(p[s]=p[s]||{},!(p[s][g]||!x[s][g])){p[s][g]=!0,m[s]=m[s]||[],m[s].push(g);for(var i=b(x,x[s][g],s),r=Object.keys(i),o=0;o<r.length;o++)E[r[o]]=E[r[o]]||[],E[r[o]]=E[r[o]].concat(i[r[o]])}}return m}U.exports=function(x,D){D=D||{};var E={main:h.m},m=D.all?{main:Object.keys(E.main)}:y(E,x),p="";Object.keys(m).filter(function(g){return g!=="main"}).forEach(function(g){for(var i=0;m[g][i];)i++;m[g].push(i),E[g][i]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",p=p+"var "+g+" = ("+P.toString().replace("ENTRY_MODULE",JSON.stringify(i))+")({"+m[g].map(function(r){return""+JSON.stringify(r)+": "+E[g][r].toString()}).join(",")+`});
`}),p=p+"new (("+P.toString().replace("ENTRY_MODULE",JSON.stringify(x))+")({"+m.main.map(function(g){return""+JSON.stringify(g)+": "+E.main[g].toString()}).join(",")+"}))(self);";var u=new window.Blob([p],{type:"text/javascript"});if(D.bare)return u;var e=window.URL||window.webkitURL||window.mozURL||window.msURL,s=e.createObjectURL(u),c=new window.Worker(s);return c.objectURL=s,c}},"./src/config.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"hlsDefaultConfig",function(){return o}),h.d(O,"mergeConfig",function(){return t}),h.d(O,"enableStreamingMode",function(){return n});var P=h("./src/controller/abr-controller.ts"),_=h("./src/controller/audio-stream-controller.ts"),L=h("./src/controller/audio-track-controller.ts"),M=h("./src/controller/subtitle-stream-controller.ts"),R=h("./src/controller/subtitle-track-controller.ts"),b=h("./src/controller/buffer-controller.ts"),A=h("./src/controller/timeline-controller.ts"),y=h("./src/controller/cap-level-controller.ts"),x=h("./src/controller/fps-controller.ts"),D=h("./src/controller/eme-controller.ts"),E=h("./src/controller/cmcd-controller.ts"),m=h("./src/utils/xhr-loader.ts"),p=h("./src/utils/fetch-loader.ts"),u=h("./src/utils/cues.ts"),e=h("./src/utils/mediakeys-helper.ts"),s=h("./src/utils/logger.ts");function c(){return c=Object.assign?Object.assign.bind():function(l){for(var a=1;a<arguments.length;a++){var f=arguments[a];for(var v in f)Object.prototype.hasOwnProperty.call(f,v)&&(l[v]=f[v])}return l},c.apply(this,arguments)}function g(l,a){var f=Object.keys(l);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(l);a&&(v=v.filter(function(S){return Object.getOwnPropertyDescriptor(l,S).enumerable})),f.push.apply(f,v)}return f}function i(l){for(var a=1;a<arguments.length;a++){var f=arguments[a]!=null?arguments[a]:{};a%2?g(Object(f),!0).forEach(function(v){r(l,v,f[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(f)):g(Object(f)).forEach(function(v){Object.defineProperty(l,v,Object.getOwnPropertyDescriptor(f,v))})}return l}function r(l,a,f){return a in l?Object.defineProperty(l,a,{value:f,enumerable:!0,configurable:!0,writable:!0}):l[a]=f,l}var o=i(i({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:m.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:P.default,bufferController:b.default,capLevelController:y.default,fpsController:x.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},d()),{},{subtitleStreamController:M.SubtitleStreamController,subtitleTrackController:R.default,timelineController:A.TimelineController,audioStreamController:_.default,audioTrackController:L.default,emeController:D.default,cmcdController:E.default});function d(){return{cueHandler:u.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function t(l,a){if((a.liveSyncDurationCount||a.liveMaxLatencyDurationCount)&&(a.liveSyncDuration||a.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(a.liveMaxLatencyDurationCount!==void 0&&(a.liveSyncDurationCount===void 0||a.liveMaxLatencyDurationCount<=a.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(a.liveMaxLatencyDuration!==void 0&&(a.liveSyncDuration===void 0||a.liveMaxLatencyDuration<=a.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return c({},l,a)}function n(l){var a=l.loader;if(a!==p.default&&a!==m.default)s.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),l.progressive=!1;else{var f=Object(p.fetchSupported)();f&&(l.loader=p.default,l.progressive=!0,l.enableSoftwareAES=!0,s.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(U,O,h){"use strict";h.r(O);var P=h("./src/polyfills/number.ts"),_=h("./src/utils/ewma-bandwidth-estimator.ts"),L=h("./src/events.ts"),M=h("./src/utils/buffer-helper.ts"),R=h("./src/errors.ts"),b=h("./src/types/loader.ts"),A=h("./src/utils/logger.ts");function y(E,m){for(var p=0;p<m.length;p++){var u=m[p];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(E,u.key,u)}}function x(E,m,p){return m&&y(E.prototype,m),p&&y(E,p),Object.defineProperty(E,"prototype",{writable:!1}),E}var D=function(){function E(p){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=p;var u=p.config;this.bwEstimator=new _.default(u.abrEwmaSlowVoD,u.abrEwmaFastVoD,u.abrEwmaDefaultEstimate),this.registerListeners()}var m=E.prototype;return m.registerListeners=function(){var u=this.hls;u.on(L.Events.FRAG_LOADING,this.onFragLoading,this),u.on(L.Events.FRAG_LOADED,this.onFragLoaded,this),u.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),u.on(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.on(L.Events.ERROR,this.onError,this)},m.unregisterListeners=function(){var u=this.hls;u.off(L.Events.FRAG_LOADING,this.onFragLoading,this),u.off(L.Events.FRAG_LOADED,this.onFragLoaded,this),u.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),u.off(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.off(L.Events.ERROR,this.onError,this)},m.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},m.onFragLoading=function(u,e){var s=e.frag;if(s.type===b.PlaylistLevelType.MAIN&&!this.timer){var c;this.fragCurrent=s,this.partCurrent=(c=e.part)!=null?c:null,this.timer=self.setInterval(this.onCheck,100)}},m.onLevelLoaded=function(u,e){var s=this.hls.config;e.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD)},m._abandonRulesCheck=function(){var u=this.fragCurrent,e=this.partCurrent,s=this.hls,c=s.autoLevelEnabled,g=s.config,i=s.media;if(!(!u||!i)){var r=e?e.stats:u.stats,o=e?e.duration:u.duration;if(r.aborted){A.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!c||i.paused||!i.playbackRate||!i.readyState)){var d=performance.now()-r.loading.start,t=Math.abs(i.playbackRate);if(!(d<=500*o/t)){var n=s.levels,l=s.minAutoLevel,a=n[u.level],f=r.total||Math.max(r.loaded,Math.round(o*a.maxBitrate/8)),v=Math.max(1,r.bwEstimate?r.bwEstimate/8:r.loaded*1e3/d),S=(f-r.loaded)/v,T=i.currentTime,I=(M.BufferHelper.bufferInfo(i,T,g.maxBufferHole).end-T)/t;if(!(I>=2*o/t||S<=I)){var k=Number.POSITIVE_INFINITY,B;for(B=u.level-1;B>l;B--){var N=n[B].maxBitrate;if(k=o*N/(8*.8*v),k<I)break}if(!(k>=S)){var W=this.bwEstimator.getEstimate();A.logger.warn("Fragment "+u.sn+(e?" part "+e.index:"")+" of level "+u.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+B+`
      Current BW estimate: `+(Object(P.isFiniteNumber)(W)?(W/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+S.toFixed(3)+` s
      Estimated load time for the next fragment: `+k.toFixed(3)+` s
      Time to underbuffer: `+I.toFixed(3)+" s"),s.nextLoadLevel=B,this.bwEstimator.sample(d,r.loaded),this.clearTimer(),u.loader&&(this.fragCurrent=this.partCurrent=null,u.loader.abort()),s.trigger(L.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:u,part:e,stats:r})}}}}}},m.onFragLoaded=function(u,e){var s=e.frag,c=e.part;if(s.type===b.PlaylistLevelType.MAIN&&Object(P.isFiniteNumber)(s.sn)){var g=c?c.stats:s.stats,i=c?c.duration:s.duration;if(this.clearTimer(),this.lastLoadedFragLevel=s.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var r=this.hls.levels[s.level],o=(r.loaded?r.loaded.bytes:0)+g.loaded,d=(r.loaded?r.loaded.duration:0)+i;r.loaded={bytes:o,duration:d},r.realBitrate=Math.round(8*o/d)}if(s.bitrateTest){var t={stats:g,frag:s,part:c,id:s.type};this.onFragBuffered(L.Events.FRAG_BUFFERED,t)}}},m.onFragBuffered=function(u,e){var s=e.frag,c=e.part,g=c?c.stats:s.stats;if(!g.aborted&&!(s.type!==b.PlaylistLevelType.MAIN||s.sn==="initSegment")){var i=g.parsing.end-g.loading.start;this.bwEstimator.sample(i,g.loaded),g.bwEstimate=this.bwEstimator.getEstimate(),s.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}},m.onError=function(u,e){switch(e.details){case R.ErrorDetails.FRAG_LOAD_ERROR:case R.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}},m.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},m.getNextABRAutoLevel=function(){var u=this.fragCurrent,e=this.partCurrent,s=this.hls,c=s.maxAutoLevel,g=s.config,i=s.minAutoLevel,r=s.media,o=e?e.duration:u?u.duration:0,d=r?r.currentTime:0,t=r&&r.playbackRate!==0?Math.abs(r.playbackRate):1,n=this.bwEstimator?this.bwEstimator.getEstimate():g.abrEwmaDefaultEstimate,l=(M.BufferHelper.bufferInfo(r,d,g.maxBufferHole).end-d)/t,a=this.findBestLevel(n,i,c,l,g.abrBandWidthFactor,g.abrBandWidthUpFactor);if(a>=0)return a;A.logger.trace((l?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var f=o?Math.min(o,g.maxStarvationDelay):g.maxStarvationDelay,v=g.abrBandWidthFactor,S=g.abrBandWidthUpFactor;if(!l){var T=this.bitrateTestDelay;if(T){var I=o?Math.min(o,g.maxLoadingDelay):g.maxLoadingDelay;f=I-T,A.logger.trace("bitrate test took "+Math.round(1e3*T)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*f)+" ms"),v=S=1}}return a=this.findBestLevel(n,i,c,l+f,v,S),Math.max(a,0)},m.findBestLevel=function(u,e,s,c,g,i){for(var r,o=this.fragCurrent,d=this.partCurrent,t=this.lastLoadedFragLevel,n=this.hls.levels,l=n[t],a=!!(l!=null&&(r=l.details)!==null&&r!==void 0&&r.live),f=l==null?void 0:l.codecSet,v=d?d.duration:o?o.duration:0,S=s;S>=e;S--){var T=n[S];if(!(!T||f&&T.codecSet!==f)){var I=T.details,k=(d?I==null?void 0:I.partTarget:I==null?void 0:I.averagetargetduration)||v,B=void 0;S<=t?B=g*u:B=i*u;var N=n[S].maxBitrate,W=N*k/B;if(A.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+S+"/"+Math.round(B)+"/"+N+"/"+k+"/"+c+"/"+W),B>N&&(!W||a&&!this.bitrateTestDelay||W<c))return S}}return-1},x(E,[{key:"nextAutoLevel",get:function(){var u=this._nextAutoLevel,e=this.bwEstimator;if(u!==-1&&!e.canEstimate())return u;var s=this.getNextABRAutoLevel();return u!==-1&&this.hls.levels[s].loadError?u:(u!==-1&&(s=Math.min(u,s)),s)},set:function(u){this._nextAutoLevel=u}}]),E}();O.default=D},"./src/controller/audio-stream-controller.ts":function(U,O,h){"use strict";h.r(O);var P=h("./src/polyfills/number.ts"),_=h("./src/controller/base-stream-controller.ts"),L=h("./src/events.ts"),M=h("./src/utils/buffer-helper.ts"),R=h("./src/controller/fragment-tracker.ts"),b=h("./src/types/level.ts"),A=h("./src/types/loader.ts"),y=h("./src/loader/fragment.ts"),x=h("./src/demux/chunk-cache.ts"),D=h("./src/demux/transmuxer-interface.ts"),E=h("./src/types/transmuxer.ts"),m=h("./src/controller/fragment-finders.ts"),p=h("./src/utils/discontinuities.ts"),u=h("./src/errors.ts");function e(){return e=Object.assign?Object.assign.bind():function(r){for(var o=1;o<arguments.length;o++){var d=arguments[o];for(var t in d)Object.prototype.hasOwnProperty.call(d,t)&&(r[t]=d[t])}return r},e.apply(this,arguments)}function s(r,o){r.prototype=Object.create(o.prototype),r.prototype.constructor=r,c(r,o)}function c(r,o){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},c(r,o)}var g=100,i=function(r){s(o,r);function o(t,n){var l;return l=r.call(this,t,n,"[audio-stream-controller]")||this,l.videoBuffer=null,l.videoTrackCC=-1,l.waitingVideoCC=-1,l.audioSwitch=!1,l.trackId=-1,l.waitingData=null,l.mainDetails=null,l.bufferFlushed=!1,l.cachedTrackLoadedData=null,l._registerListeners(),l}var d=o.prototype;return d.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},d._registerListeners=function(){var n=this.hls;n.on(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(L.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.on(L.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.on(L.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(L.Events.ERROR,this.onError,this),n.on(L.Events.BUFFER_RESET,this.onBufferReset,this),n.on(L.Events.BUFFER_CREATED,this.onBufferCreated,this),n.on(L.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.on(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this)},d._unregisterListeners=function(){var n=this.hls;n.off(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(L.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.off(L.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.off(L.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(L.Events.ERROR,this.onError,this),n.off(L.Events.BUFFER_RESET,this.onBufferReset,this),n.off(L.Events.BUFFER_CREATED,this.onBufferCreated,this),n.off(L.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.off(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this)},d.onInitPtsFound=function(n,l){var a=l.frag,f=l.id,v=l.initPTS;if(f==="main"){var S=a.cc;this.initPTS[a.cc]=v,this.log("InitPTS for cc: "+S+" found from main: "+v),this.videoTrackCC=S,this.state===_.State.WAITING_INIT_PTS&&this.tick()}},d.startLoad=function(n){if(!this.levels){this.startPosition=n,this.state=_.State.STOPPED;return}var l=this.lastCurrentTime;this.stopLoad(),this.setInterval(g),this.fragLoadError=0,l>0&&n===-1?(this.log("Override startPosition with lastCurrentTime @"+l.toFixed(3)),n=l,this.state=_.State.IDLE):(this.loadedmetadata=!1,this.state=_.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=n,this.tick()},d.doTick=function(){switch(this.state){case _.State.IDLE:this.doTickIdle();break;case _.State.WAITING_TRACK:{var n,l=this.levels,a=this.trackId,f=l==null||(n=l[a])===null||n===void 0?void 0:n.details;if(f){if(this.waitForCdnTuneIn(f))break;this.state=_.State.WAITING_INIT_PTS}break}case _.State.FRAG_LOADING_WAITING_RETRY:{var v,S=performance.now(),T=this.retryDate;(!T||S>=T||(v=this.media)!==null&&v!==void 0&&v.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=_.State.IDLE);break}case _.State.WAITING_INIT_PTS:{var I=this.waitingData;if(I){var k=I.frag,B=I.part,N=I.cache,W=I.complete;if(this.initPTS[k.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=_.State.FRAG_LOADING;var G=N.flush(),z={frag:k,part:B,payload:G,networkDetails:null};this._handleFragmentLoadProgress(z),W&&r.prototype._handleFragmentLoadComplete.call(this,z)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+k.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var Y=this.getLoadPosition(),$=M.BufferHelper.bufferInfo(this.mediaBuffer,Y,this.config.maxBufferHole),Z=Object(m.fragmentWithinToleranceTest)($.end,this.config.maxFragLookUpTolerance,k);Z<0&&(this.log("Waiting fragment cc ("+k.cc+") @ "+k.start+" cancelled because another fragment at "+$.end+" is needed"),this.clearWaitingFragment())}}else this.state=_.State.IDLE}}this.onTickEnd()},d.clearWaitingFragment=function(){var n=this.waitingData;n&&(this.fragmentTracker.removeFragment(n.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=_.State.IDLE)},d.resetLoadingState=function(){this.clearWaitingFragment(),r.prototype.resetLoadingState.call(this)},d.onTickEnd=function(){var n=this.media;if(!(!n||!n.readyState)){var l=this.mediaBuffer?this.mediaBuffer:n,a=l.buffered;!this.loadedmetadata&&a.length&&(this.loadedmetadata=!0),this.lastCurrentTime=n.currentTime}},d.doTickIdle=function(){var n,l,a=this.hls,f=this.levels,v=this.media,S=this.trackId,T=a.config;if(!(!f||!f[S])&&!(!v&&(this.startFragRequested||!T.startFragPrefetch))){var I=f[S],k=I.details;if(!k||k.live&&this.levelLastLoaded!==S||this.waitForCdnTuneIn(k)){this.state=_.State.WAITING_TRACK;return}var B=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&B&&(this.bufferFlushed=!1,this.afterBufferFlushed(B,y.ElementaryStreamTypes.AUDIO,A.PlaylistLevelType.AUDIO));var N=this.getFwdBufferInfo(B,A.PlaylistLevelType.AUDIO);if(N!==null){var W=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,A.PlaylistLevelType.MAIN),G=N.len,z=this.getMaxBufferLength(W==null?void 0:W.len),Y=this.audioSwitch;if(!(G>=z&&!Y)){if(!Y&&this._streamEnded(N,k)){a.trigger(L.Events.BUFFER_EOS,{type:"audio"}),this.state=_.State.ENDED;return}var $=k.fragments,Z=$[0].start,q=N.end;if(Y&&v){var ie=this.getLoadPosition();q=ie,k.PTSKnown&&ie<Z&&(N.end>Z||N.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),v.currentTime=Z+.05)}if(!(W&&q>W.end+k.targetduration)&&!((!W||!W.len)&&N.len)){var ne=this.getNextFragment(q,k);if(!ne){this.bufferFlushed=!0;return}((n=ne.decryptdata)===null||n===void 0?void 0:n.keyFormat)==="identity"&&!((l=ne.decryptdata)!==null&&l!==void 0&&l.key)?this.loadKey(ne,k):this.loadFragment(ne,k,q)}}}}},d.getMaxBufferLength=function(n){var l=r.prototype.getMaxBufferLength.call(this);return n?Math.max(l,n):l},d.onMediaDetaching=function(){this.videoBuffer=null,r.prototype.onMediaDetaching.call(this)},d.onAudioTracksUpdated=function(n,l){var a=l.audioTracks;this.resetTransmuxer(),this.levels=a.map(function(f){return new b.Level(f)})},d.onAudioTrackSwitching=function(n,l){var a=!!l.url;this.trackId=l.id;var f=this.fragCurrent;f!=null&&f.loader&&f.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),a?this.setInterval(g):this.resetTransmuxer(),a?(this.audioSwitch=!0,this.state=_.State.IDLE):this.state=_.State.STOPPED,this.tick()},d.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},d.onLevelLoaded=function(n,l){this.mainDetails=l.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(L.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},d.onAudioTrackLoaded=function(n,l){var a;if(this.mainDetails==null){this.cachedTrackLoadedData=l;return}var f=this.levels,v=l.details,S=l.id;if(!f){this.warn("Audio tracks were reset while loading level "+S);return}this.log("Track "+S+" loaded ["+v.startSN+","+v.endSN+"],duration:"+v.totalduration);var T=f[S],I=0;if(v.live||(a=T.details)!==null&&a!==void 0&&a.live){var k=this.mainDetails;if(v.fragments[0]||(v.deltaUpdateFailed=!0),v.deltaUpdateFailed||!k)return;!T.details&&v.hasProgramDateTime&&k.hasProgramDateTime?(Object(p.alignMediaPlaylistByPDT)(v,k),I=v.fragments[0].start):I=this.alignPlaylists(v,T.details)}T.details=v,this.levelLastLoaded=S,!this.startFragRequested&&(this.mainDetails||!v.live)&&this.setStartPosition(T.details,I),this.state===_.State.WAITING_TRACK&&!this.waitForCdnTuneIn(v)&&(this.state=_.State.IDLE),this.tick()},d._handleFragmentLoadProgress=function(n){var l,a=n.frag,f=n.part,v=n.payload,S=this.config,T=this.trackId,I=this.levels;if(!I){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+a.sn+" of level "+a.level+" will not be buffered");return}var k=I[T];console.assert(k,"Audio track is defined on fragment load progress");var B=k.details;console.assert(B,"Audio track details are defined on fragment load progress");var N=S.defaultAudioCodec||k.audioCodec||"mp4a.40.2",W=this.transmuxer;W||(W=this.transmuxer=new D.default(this.hls,A.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var G=this.initPTS[a.cc],z=(l=a.initSegment)===null||l===void 0?void 0:l.data;if(G!==void 0){var Y=!1,$=f?f.index:-1,Z=$!==-1,q=new E.ChunkMetadata(a.level,a.sn,a.stats.chunkCount,v.byteLength,$,Z);W.push(v,z,N,"",a,f,B.totalduration,Y,q,G)}else{this.log("Unknown video PTS for cc "+a.cc+", waiting for video PTS before demuxing audio frag "+a.sn+" of ["+B.startSN+" ,"+B.endSN+"],track "+T);var ie=this.waitingData=this.waitingData||{frag:a,part:f,cache:new x.default,complete:!1},ne=ie.cache;ne.push(new Uint8Array(v)),this.waitingVideoCC=this.videoTrackCC,this.state=_.State.WAITING_INIT_PTS}},d._handleFragmentLoadComplete=function(n){if(this.waitingData){this.waitingData.complete=!0;return}r.prototype._handleFragmentLoadComplete.call(this,n)},d.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},d.onBufferCreated=function(n,l){var a=l.tracks.audio;a&&(this.mediaBuffer=a.buffer||null),l.tracks.video&&(this.videoBuffer=l.tracks.video.buffer||null)},d.onFragBuffered=function(n,l){var a=l.frag,f=l.part;if(a.type===A.PlaylistLevelType.AUDIO){if(this.fragContextChanged(a)){this.warn("Fragment "+a.sn+(f?" p: "+f.index:"")+" of level "+a.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}a.sn!=="initSegment"&&(this.fragPrevious=a,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(L.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(a,f)}},d.onError=function(n,l){switch(l.details){case u.ErrorDetails.FRAG_LOAD_ERROR:case u.ErrorDetails.FRAG_LOAD_TIMEOUT:case u.ErrorDetails.KEY_LOAD_ERROR:case u.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(A.PlaylistLevelType.AUDIO,l);break;case u.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case u.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==_.State.ERROR&&this.state!==_.State.STOPPED&&(this.state=l.fatal?_.State.ERROR:_.State.IDLE,this.warn(l.details+" while loading frag, switching to "+this.state+" state"));break;case u.ErrorDetails.BUFFER_FULL_ERROR:if(l.parent==="audio"&&(this.state===_.State.PARSING||this.state===_.State.PARSED)){var a=!0,f=this.getFwdBufferInfo(this.mediaBuffer,A.PlaylistLevelType.AUDIO);f&&f.len>.5&&(a=!this.reduceMaxBufferLength(f.len)),a&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,r.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break;default:break}},d.onBufferFlushed=function(n,l){var a=l.type;a===y.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},d._handleTransmuxComplete=function(n){var l,a="audio",f=this.hls,v=n.remuxResult,S=n.chunkMeta,T=this.getCurrentContext(S);if(!T){this.warn("The loading context changed while buffering fragment "+S.sn+" of level "+S.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(S.level);return}var I=T.frag,k=T.part,B=T.level.details,N=v.audio,W=v.text,G=v.id3,z=v.initSegment;if(!(this.fragContextChanged(I)||!B)){if(this.state=_.State.PARSING,this.audioSwitch&&N&&this.completeAudioSwitch(),z!=null&&z.tracks&&(this._bufferInitSegment(z.tracks,I,S),f.trigger(L.Events.FRAG_PARSING_INIT_SEGMENT,{frag:I,id:a,tracks:z.tracks})),N){var Y=N.startPTS,$=N.endPTS,Z=N.startDTS,q=N.endDTS;k&&(k.elementaryStreams[y.ElementaryStreamTypes.AUDIO]={startPTS:Y,endPTS:$,startDTS:Z,endDTS:q}),I.setElementaryStreamInfo(y.ElementaryStreamTypes.AUDIO,Y,$,Z,q),this.bufferFragmentData(N,I,k,S)}if(G!=null&&(l=G.samples)!==null&&l!==void 0&&l.length){var ie=e({id:a,frag:I,details:B},G);f.trigger(L.Events.FRAG_PARSING_METADATA,ie)}if(W){var ne=e({id:a,frag:I,details:B},W);f.trigger(L.Events.FRAG_PARSING_USERDATA,ne)}}},d._bufferInitSegment=function(n,l,a){if(this.state===_.State.PARSING){n.video&&delete n.video;var f=n.audio;if(!!f){f.levelCodec=f.codec,f.id="audio",this.log("Init audio buffer, container:"+f.container+", codecs[parsed]=["+f.codec+"]"),this.hls.trigger(L.Events.BUFFER_CODECS,n);var v=f.initSegment;if(v!=null&&v.byteLength){var S={type:"audio",frag:l,part:null,chunkMeta:a,parent:l.type,data:v};this.hls.trigger(L.Events.BUFFER_APPENDING,S)}this.tick()}}},d.loadFragment=function(n,l,a){var f=this.fragmentTracker.getState(n);this.fragCurrent=n,(this.audioSwitch||f===R.FragmentState.NOT_LOADED||f===R.FragmentState.PARTIAL)&&(n.sn==="initSegment"?this._loadInitSegment(n):l.live&&!Object(P.isFiniteNumber)(this.initPTS[n.cc])?(this.log("Waiting for video PTS in continuity counter "+n.cc+" of live stream before loading audio fragment "+n.sn+" of level "+this.trackId),this.state=_.State.WAITING_INIT_PTS):(this.startFragRequested=!0,r.prototype.loadFragment.call(this,n,l,a)))},d.completeAudioSwitch=function(){var n=this.hls,l=this.media,a=this.trackId;l&&(this.log("Switching audio track : flushing all audio"),r.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,n.trigger(L.Events.AUDIO_TRACK_SWITCHED,{id:a})},o}(_.default);O.default=i},"./src/controller/audio-track-controller.ts":function(U,O,h){"use strict";h.r(O);var P=h("./src/events.ts"),_=h("./src/errors.ts"),L=h("./src/controller/base-playlist-controller.ts"),M=h("./src/types/loader.ts");function R(D,E){for(var m=0;m<E.length;m++){var p=E[m];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(D,p.key,p)}}function b(D,E,m){return E&&R(D.prototype,E),m&&R(D,m),Object.defineProperty(D,"prototype",{writable:!1}),D}function A(D,E){D.prototype=Object.create(E.prototype),D.prototype.constructor=D,y(D,E)}function y(D,E){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(p,u){return p.__proto__=u,p},y(D,E)}var x=function(D){A(E,D);function E(p){var u;return u=D.call(this,p,"[audio-track-controller]")||this,u.tracks=[],u.groupId=null,u.tracksInGroup=[],u.trackId=-1,u.trackName="",u.selectDefaultTrack=!0,u.registerListeners(),u}var m=E.prototype;return m.registerListeners=function(){var u=this.hls;u.on(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.on(P.Events.LEVEL_LOADING,this.onLevelLoading,this),u.on(P.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),u.on(P.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),u.on(P.Events.ERROR,this.onError,this)},m.unregisterListeners=function(){var u=this.hls;u.off(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.off(P.Events.LEVEL_LOADING,this.onLevelLoading,this),u.off(P.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),u.off(P.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),u.off(P.Events.ERROR,this.onError,this)},m.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,D.prototype.destroy.call(this)},m.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},m.onManifestParsed=function(u,e){this.tracks=e.audioTracks||[]},m.onAudioTrackLoaded=function(u,e){var s=e.id,c=e.details,g=this.tracksInGroup[s];if(!g){this.warn("Invalid audio track id "+s);return}var i=g.details;g.details=e.details,this.log("audioTrack "+s+" loaded ["+c.startSN+"-"+c.endSN+"]"),s===this.trackId&&(this.retryCount=0,this.playlistLoaded(s,e,i))},m.onLevelLoading=function(u,e){this.switchLevel(e.level)},m.onLevelSwitching=function(u,e){this.switchLevel(e.level)},m.switchLevel=function(u){var e=this.hls.levels[u];if(!!(e!=null&&e.audioGroupIds)){var s=e.audioGroupIds[e.urlId];if(this.groupId!==s){this.groupId=s;var c=this.tracks.filter(function(i){return!s||i.groupId===s});this.selectDefaultTrack&&!c.some(function(i){return i.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=c;var g={audioTracks:c};this.log("Updating audio tracks, "+c.length+' track(s) found in "'+s+'" group-id'),this.hls.trigger(P.Events.AUDIO_TRACKS_UPDATED,g),this.selectInitialTrack()}}},m.onError=function(u,e){D.prototype.onError.call(this,u,e),!(e.fatal||!e.context)&&e.context.type===M.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},m.setAudioTrack=function(u){var e=this.tracksInGroup;if(u<0||u>=e.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var s=e[this.trackId];this.log("Now switching to audio-track index "+u);var c=e[u],g=c.id,i=c.groupId,r=i===void 0?"":i,o=c.name,d=c.type,t=c.url;if(this.trackId=u,this.trackName=o,this.selectDefaultTrack=!1,this.hls.trigger(P.Events.AUDIO_TRACK_SWITCHING,{id:g,groupId:r,name:o,type:d,url:t}),!(c.details&&!c.details.live)){var n=this.switchParams(c.url,s==null?void 0:s.details);this.loadPlaylist(n)}},m.selectInitialTrack=function(){var u=this.tracksInGroup;console.assert(u.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,s=this.findTrackId(e)||this.findTrackId();s!==-1?this.setAudioTrack(s):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(P.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},m.findTrackId=function(u){for(var e=this.tracksInGroup,s=0;s<e.length;s++){var c=e[s];if((!this.selectDefaultTrack||c.default)&&(!u||u===c.name))return c.id}return-1},m.loadPlaylist=function(u){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var s=e.id,c=e.groupId,g=e.url;if(u)try{g=u.addDirectives(g)}catch(i){this.warn("Could not construct new URL with HLS Delivery Directives: "+i)}this.log("loading audio-track playlist for id: "+s),this.clearTimer(),this.hls.trigger(P.Events.AUDIO_TRACK_LOADING,{url:g,id:s,groupId:c,deliveryDirectives:u||null})}},b(E,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(u){this.selectDefaultTrack=!1,this.setAudioTrack(u)}}]),E}(L.default);O.default=x},"./src/controller/base-playlist-controller.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return b});var P=h("./src/polyfills/number.ts"),_=h("./src/types/level.ts"),L=h("./src/controller/level-helper.ts"),M=h("./src/utils/logger.ts"),R=h("./src/errors.ts"),b=function(){function A(x,D){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=M.logger.log.bind(M.logger,D+":"),this.warn=M.logger.warn.bind(M.logger,D+":"),this.hls=x}var y=A.prototype;return y.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},y.onError=function(D,E){E.fatal&&E.type===R.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},y.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},y.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},y.stopLoad=function(){this.canLoad=!1,this.clearTimer()},y.switchParams=function(D,E){var m=E==null?void 0:E.renditionReports;if(m)for(var p=0;p<m.length;p++){var u=m[p],e=""+u.URI;if(e===D.slice(-e.length)){var s=parseInt(u["LAST-MSN"]),c=parseInt(u["LAST-PART"]);if(E&&this.hls.config.lowLatencyMode){var g=Math.min(E.age-E.partTarget,E.targetduration);c!==void 0&&g>E.partTarget&&(c+=1)}if(Object(P.isFiniteNumber)(s))return new _.HlsUrlParameters(s,Object(P.isFiniteNumber)(c)?c:void 0,_.HlsSkip.No)}}},y.loadPlaylist=function(D){},y.shouldLoadTrack=function(D){return this.canLoad&&D&&!!D.url&&(!D.details||D.details.live)},y.playlistLoaded=function(D,E,m){var p=this,u=E.details,e=E.stats,s=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(u.advancedDateTime=Date.now()-s,u.live||m!=null&&m.live){if(u.reloaded(m),m&&this.log("live playlist "+D+" "+(u.advanced?"REFRESHED "+u.lastPartSn+"-"+u.lastPartIndex:"MISSED")),m&&u.fragments.length>0&&Object(L.mergeDetails)(m,u),!this.canLoad||!u.live)return;var c,g=void 0,i=void 0;if(u.canBlockReload&&u.endSN&&u.advanced){var r=this.hls.config.lowLatencyMode,o=u.lastPartSn,d=u.endSN,t=u.lastPartIndex,n=t!==-1,l=o===d,a=r?0:t;n?(g=l?d+1:o,i=l?a:t+1):g=d+1;var f=u.age,v=f+u.ageHeader,S=Math.min(v-u.partTarget,u.targetduration*1.5);if(S>0){if(m&&S>m.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+m.tuneInGoal+" to: "+S+" with playlist age: "+u.age),S=0;else{var T=Math.floor(S/u.targetduration);if(g+=T,i!==void 0){var I=Math.round(S%u.targetduration/u.partTarget);i+=I}this.log("CDN Tune-in age: "+u.ageHeader+"s last advanced "+f.toFixed(2)+"s goal: "+S+" skip sn "+T+" to part "+i)}u.tuneInGoal=S}if(c=this.getDeliveryDirectives(u,E.deliveryDirectives,g,i),r||!l){this.loadPlaylist(c);return}}else c=this.getDeliveryDirectives(u,E.deliveryDirectives,g,i);var k=Object(L.computeReloadInterval)(u,e);g!==void 0&&u.canBlockReload&&(k-=u.partTarget||1),this.log("reload live playlist "+D+" in "+Math.round(k)+" ms"),this.timer=self.setTimeout(function(){return p.loadPlaylist(c)},k)}else this.clearTimer()},y.getDeliveryDirectives=function(D,E,m,p){var u=Object(_.getSkipValue)(D,m);return E!=null&&E.skip&&D.deltaUpdateFailed&&(m=E.msn,p=E.part,u=_.HlsSkip.No),new _.HlsUrlParameters(m,p,u)},y.retryLoadingOrFail=function(D){var E=this,m=this.hls.config,p=this.retryCount<m.levelLoadingMaxRetry;if(p){var u;if(this.retryCount++,D.details.indexOf("LoadTimeOut")>-1&&(u=D.context)!==null&&u!==void 0&&u.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+D.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*m.levelLoadingRetryDelay,m.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return E.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+D.details+'"')}}else this.warn('cannot recover from error "'+D.details+'"'),this.clearTimer(),D.fatal=!0;return p},A}()},"./src/controller/base-stream-controller.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"State",function(){return d}),h.d(O,"default",function(){return t});var P=h("./src/polyfills/number.ts"),_=h("./src/task-loop.ts"),L=h("./src/controller/fragment-tracker.ts"),M=h("./src/utils/buffer-helper.ts"),R=h("./src/utils/logger.ts"),b=h("./src/events.ts"),A=h("./src/errors.ts"),y=h("./src/types/transmuxer.ts"),x=h("./src/utils/mp4-tools.ts"),D=h("./src/utils/discontinuities.ts"),E=h("./src/controller/fragment-finders.ts"),m=h("./src/controller/level-helper.ts"),p=h("./src/loader/fragment-loader.ts"),u=h("./src/crypt/decrypter.ts"),e=h("./src/utils/time-ranges.ts"),s=h("./src/types/loader.ts");function c(n,l){for(var a=0;a<l.length;a++){var f=l[a];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(n,f.key,f)}}function g(n,l,a){return l&&c(n.prototype,l),a&&c(n,a),Object.defineProperty(n,"prototype",{writable:!1}),n}function i(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function r(n,l){n.prototype=Object.create(l.prototype),n.prototype.constructor=n,o(n,l)}function o(n,l){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,v){return f.__proto__=v,f},o(n,l)}var d={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},t=function(n){r(l,n);function l(f,v,S){var T;return T=n.call(this)||this,T.hls=void 0,T.fragPrevious=null,T.fragCurrent=null,T.fragmentTracker=void 0,T.transmuxer=null,T._state=d.STOPPED,T.media=null,T.mediaBuffer=null,T.config=void 0,T.bitrateTest=!1,T.lastCurrentTime=0,T.nextLoadPosition=0,T.startPosition=0,T.loadedmetadata=!1,T.fragLoadError=0,T.retryDate=0,T.levels=null,T.fragmentLoader=void 0,T.levelLastLoaded=null,T.startFragRequested=!1,T.decrypter=void 0,T.initPTS=[],T.onvseeking=null,T.onvended=null,T.logPrefix="",T.log=void 0,T.warn=void 0,T.logPrefix=S,T.log=R.logger.log.bind(R.logger,S+":"),T.warn=R.logger.warn.bind(R.logger,S+":"),T.hls=f,T.fragmentLoader=new p.default(f.config),T.fragmentTracker=v,T.config=f.config,T.decrypter=new u.default(f,f.config),f.on(b.Events.KEY_LOADED,T.onKeyLoaded,i(T)),f.on(b.Events.LEVEL_SWITCHING,T.onLevelSwitching,i(T)),T}var a=l.prototype;return a.doTick=function(){this.onTickEnd()},a.onTickEnd=function(){},a.startLoad=function(v){},a.stopLoad=function(){this.fragmentLoader.abort();var v=this.fragCurrent;v&&this.fragmentTracker.removeFragment(v),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=d.STOPPED},a._streamEnded=function(v,S){var T=this.fragCurrent,I=this.fragmentTracker;if(!S.live&&T&&this.media&&T.sn>=S.endSN&&!v.nextStart){var k=S.partList;if(k!=null&&k.length){var B=k[k.length-1],N=M.BufferHelper.isBuffered(this.media,B.start+B.duration/2);return N}var W=I.getState(T);return W===L.FragmentState.PARTIAL||W===L.FragmentState.OK}return!1},a.onMediaAttached=function(v,S){var T=this.media=this.mediaBuffer=S.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),T.addEventListener("seeking",this.onvseeking),T.addEventListener("ended",this.onvended);var I=this.config;this.levels&&I.autoStartLoad&&this.state===d.STOPPED&&this.startLoad(I.startPosition)},a.onMediaDetaching=function(){var v=this.media;v!=null&&v.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),v&&this.onvseeking&&this.onvended&&(v.removeEventListener("seeking",this.onvseeking),v.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},a.onMediaSeeking=function(){var v=this.config,S=this.fragCurrent,T=this.media,I=this.mediaBuffer,k=this.state,B=T?T.currentTime:0,N=M.BufferHelper.bufferInfo(I||T,B,v.maxBufferHole);if(this.log("media seeking to "+(Object(P.isFiniteNumber)(B)?B.toFixed(3):B)+", state: "+k),k===d.ENDED)this.resetLoadingState();else if(S&&!N.len){var W=v.maxFragLookUpTolerance,G=S.start-W,z=S.start+S.duration+W,Y=B>z;(B<G||Y)&&(Y&&S.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),S.loader.abort()),this.resetLoadingState())}T&&(this.lastCurrentTime=B),!this.loadedmetadata&&!N.len&&(this.nextLoadPosition=this.startPosition=B),this.tickImmediate()},a.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},a.onKeyLoaded=function(v,S){if(!(this.state!==d.KEY_LOADING||S.frag!==this.fragCurrent||!this.levels)){this.state=d.IDLE;var T=this.levels[S.frag.level].details;T&&this.loadFragment(S.frag,T,S.frag.start)}},a.onLevelSwitching=function(v,S){this.fragLoadError=0},a.onHandlerDestroying=function(){this.stopLoad(),n.prototype.onHandlerDestroying.call(this)},a.onHandlerDestroyed=function(){this.state=d.STOPPED,this.hls.off(b.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(b.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,n.prototype.onHandlerDestroyed.call(this)},a.loadKey=function(v,S){this.log("Loading key for "+v.sn+" of ["+S.startSN+"-"+S.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+v.level),this.state=d.KEY_LOADING,this.fragCurrent=v,this.hls.trigger(b.Events.KEY_LOADING,{frag:v})},a.loadFragment=function(v,S,T){this._loadFragForPlayback(v,S,T)},a._loadFragForPlayback=function(v,S,T){var I=this,k=function(N){if(I.fragContextChanged(v)){I.warn("Fragment "+v.sn+(N.part?" p: "+N.part.index:"")+" of level "+v.level+" was dropped during download."),I.fragmentTracker.removeFragment(v);return}v.stats.chunkCount++,I._handleFragmentLoadProgress(N)};this._doFragLoad(v,S,T,k).then(function(B){if(!!B){I.fragLoadError=0;var N=I.state;if(I.fragContextChanged(v)){(N===d.FRAG_LOADING||!I.fragCurrent&&N===d.PARSING)&&(I.fragmentTracker.removeFragment(v),I.state=d.IDLE);return}"payload"in B&&(I.log("Loaded fragment "+v.sn+" of level "+v.level),I.hls.trigger(b.Events.FRAG_LOADED,B)),I._handleFragmentLoadComplete(B)}}).catch(function(B){I.state===d.STOPPED||I.state===d.ERROR||(I.warn(B),I.resetFragmentLoading(v))})},a.flushMainBuffer=function(v,S,T){if(T===void 0&&(T=null),!!(v-S)){var I={startOffset:v,endOffset:S,type:T};this.fragLoadError=0,this.hls.trigger(b.Events.BUFFER_FLUSHING,I)}},a._loadInitSegment=function(v){var S=this;this._doFragLoad(v).then(function(T){if(!T||S.fragContextChanged(v)||!S.levels)throw new Error("init load aborted");return T}).then(function(T){var I=S.hls,k=T.payload,B=v.decryptdata;if(k&&k.byteLength>0&&B&&B.key&&B.iv&&B.method==="AES-128"){var N=self.performance.now();return S.decrypter.webCryptoDecrypt(new Uint8Array(k),B.key.buffer,B.iv.buffer).then(function(W){var G=self.performance.now();return I.trigger(b.Events.FRAG_DECRYPTED,{frag:v,payload:W,stats:{tstart:N,tdecrypt:G}}),T.payload=W,T})}return T}).then(function(T){var I=S.fragCurrent,k=S.hls,B=S.levels;if(!B)throw new Error("init load aborted, missing levels");var N=B[v.level].details;console.assert(N,"Level details are defined when init segment is loaded");var W=v.stats;S.state=d.IDLE,S.fragLoadError=0,v.data=new Uint8Array(T.payload),W.parsing.start=W.buffering.start=self.performance.now(),W.parsing.end=W.buffering.end=self.performance.now(),T.frag===I&&k.trigger(b.Events.FRAG_BUFFERED,{stats:W,frag:I,part:null,id:v.type}),S.tick()}).catch(function(T){S.state===d.STOPPED||S.state===d.ERROR||(S.warn(T),S.resetFragmentLoading(v))})},a.fragContextChanged=function(v){var S=this.fragCurrent;return!v||!S||v.level!==S.level||v.sn!==S.sn||v.urlId!==S.urlId},a.fragBufferedComplete=function(v,S){var T=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+v.type+" sn: "+v.sn+(S?" part: "+S.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+v.level+" "+(T?e.default.toString(M.BufferHelper.getBuffered(T)):"(detached)")),this.state=d.IDLE,T&&(!this.loadedmetadata&&T.buffered.length&&this.fragCurrent===this.fragPrevious&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},a.seekToStartPos=function(){},a._handleFragmentLoadComplete=function(v){var S=this.transmuxer;if(!!S){var T=v.frag,I=v.part,k=v.partsLoaded,B=!k||k.length===0||k.some(function(W){return!W}),N=new y.ChunkMetadata(T.level,T.sn,T.stats.chunkCount+1,0,I?I.index:-1,!B);S.flush(N)}},a._handleFragmentLoadProgress=function(v){},a._doFragLoad=function(v,S,T,I){var k=this;if(T===void 0&&(T=null),!this.levels)throw new Error("frag load aborted, missing levels");if(T=Math.max(v.start,T||0),this.config.lowLatencyMode&&S){var B=S.partList;if(B&&I){T>v.end&&S.fragmentHint&&(v=S.fragmentHint);var N=this.getNextPart(B,v,T);if(N>-1){var W=B[N];return this.log("Loading part sn: "+v.sn+" p: "+W.index+" cc: "+v.cc+" of playlist ["+S.startSN+"-"+S.endSN+"] parts [0-"+N+"-"+(B.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+v.level+", target: "+parseFloat(T.toFixed(3))),this.nextLoadPosition=W.start+W.duration,this.state=d.FRAG_LOADING,this.hls.trigger(b.Events.FRAG_LOADING,{frag:v,part:B[N],targetBufferTime:T}),this.doFragPartsLoad(v,B,N,I).catch(function(G){return k.handleFragLoadError(G)})}else if(!v.url||this.loadedEndOfParts(B,T))return Promise.resolve(null)}}return this.log("Loading fragment "+v.sn+" cc: "+v.cc+" "+(S?"of ["+S.startSN+"-"+S.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+v.level+", target: "+parseFloat(T.toFixed(3))),Object(P.isFiniteNumber)(v.sn)&&!this.bitrateTest&&(this.nextLoadPosition=v.start+v.duration),this.state=d.FRAG_LOADING,this.hls.trigger(b.Events.FRAG_LOADING,{frag:v,targetBufferTime:T}),this.fragmentLoader.load(v,I).catch(function(G){return k.handleFragLoadError(G)})},a.doFragPartsLoad=function(v,S,T,I){var k=this;return new Promise(function(B,N){var W=[],G=function z(Y){var $=S[Y];k.fragmentLoader.loadPart(v,$,I).then(function(Z){W[$.index]=Z;var q=Z.part;k.hls.trigger(b.Events.FRAG_LOADED,Z);var ie=S[Y+1];if(ie&&ie.fragment===v)z(Y+1);else return B({frag:v,part:q,partsLoaded:W})}).catch(N)};G(T)})},a.handleFragLoadError=function(v){var S=v.data;return S&&S.details===A.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(S.frag,S.part):this.hls.trigger(b.Events.ERROR,S),null},a._handleTransmuxerFlush=function(v){var S=this.getCurrentContext(v);if(!S||this.state!==d.PARSING){this.fragCurrent||(this.state=d.IDLE);return}var T=S.frag,I=S.part,k=S.level,B=self.performance.now();T.stats.parsing.end=B,I&&(I.stats.parsing.end=B),this.updateLevelTiming(T,I,k,v.partial)},a.getCurrentContext=function(v){var S=this.levels,T=v.level,I=v.sn,k=v.part;if(!S||!S[T])return this.warn("Levels object was unset while buffering fragment "+I+" of level "+T+". The current chunk will not be buffered."),null;var B=S[T],N=k>-1?Object(m.getPartWith)(B,I,k):null,W=N?N.fragment:Object(m.getFragmentWithSN)(B,I,this.fragCurrent);return W?{frag:W,part:N,level:B}:null},a.bufferFragmentData=function(v,S,T,I){if(!(!v||this.state!==d.PARSING)){var k=v.data1,B=v.data2,N=k;if(k&&B&&(N=Object(x.appendUint8Array)(k,B)),!(!N||!N.length)){var W={type:v.type,frag:S,part:T,chunkMeta:I,parent:S.type,data:N};this.hls.trigger(b.Events.BUFFER_APPENDING,W),v.dropped&&v.independent&&!T&&this.flushBufferGap(S)}}},a.flushBufferGap=function(v){var S=this.media;if(!!S){if(!M.BufferHelper.isBuffered(S,S.currentTime)){this.flushMainBuffer(0,v.start);return}var T=S.currentTime,I=M.BufferHelper.bufferInfo(S,T,0),k=v.duration,B=Math.min(this.config.maxFragLookUpTolerance*2,k*.25),N=Math.max(Math.min(v.start-B,I.end-B),T+B);v.start-N>B&&this.flushMainBuffer(N,v.start)}},a.getFwdBufferInfo=function(v,S){var T=this.config,I=this.getLoadPosition();if(!Object(P.isFiniteNumber)(I))return null;var k=M.BufferHelper.bufferInfo(v,I,T.maxBufferHole);if(k.len===0&&k.nextStart!==void 0){var B=this.fragmentTracker.getBufferedFrag(I,S);if(B&&k.nextStart<B.end)return M.BufferHelper.bufferInfo(v,I,Math.max(k.nextStart,T.maxBufferHole))}return k},a.getMaxBufferLength=function(v){var S=this.config,T;return v?T=Math.max(8*S.maxBufferSize/v,S.maxBufferLength):T=S.maxBufferLength,Math.min(T,S.maxMaxBufferLength)},a.reduceMaxBufferLength=function(v){var S=this.config,T=v||S.maxBufferLength;return S.maxMaxBufferLength>=T?(S.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+S.maxMaxBufferLength+"s"),!0):!1},a.getNextFragment=function(v,S){var T=S.fragments,I=T.length;if(!I)return null;var k=this.config,B=T[0].start,N;if(S.live){var W=k.initialLiveManifestSize;if(I<W)return this.warn("Not enough fragments to start playback (have: "+I+", need: "+W+")"),null;!S.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(N=this.getInitialLiveFragment(S,T),this.startPosition=N?this.hls.liveSyncPosition||N.start:v)}else v<=B&&(N=T[0]);if(!N){var G=k.lowLatencyMode?S.partEnd:S.fragmentEnd;N=this.getFragmentAtPosition(v,G,S)}return this.mapToInitFragWhenRequired(N)},a.mapToInitFragWhenRequired=function(v){return v!=null&&v.initSegment&&!(v!=null&&v.initSegment.data)&&!this.bitrateTest?v.initSegment:v},a.getNextPart=function(v,S,T){for(var I=-1,k=!1,B=!0,N=0,W=v.length;N<W;N++){var G=v[N];if(B=B&&!G.independent,I>-1&&T<G.start)break;var z=G.loaded;!z&&(k||G.independent||B)&&G.fragment===S&&(I=N),k=z}return I},a.loadedEndOfParts=function(v,S){var T=v[v.length-1];return T&&S>T.start&&T.loaded},a.getInitialLiveFragment=function(v,S){var T=this.fragPrevious,I=null;if(T){if(v.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+T.programDateTime),I=Object(E.findFragmentByPDT)(S,T.endProgramDateTime,this.config.maxFragLookUpTolerance)),!I){var k=T.sn+1;if(k>=v.startSN&&k<=v.endSN){var B=S[k-v.startSN];T.cc===B.cc&&(I=B,this.log("Live playlist, switching playlist, load frag with next SN: "+I.sn))}I||(I=Object(E.findFragWithCC)(S,T.cc),I&&this.log("Live playlist, switching playlist, load frag with same CC: "+I.sn))}}else{var N=this.hls.liveSyncPosition;N!==null&&(I=this.getFragmentAtPosition(N,this.bitrateTest?v.fragmentEnd:v.edge,v))}return I},a.getFragmentAtPosition=function(v,S,T){var I=this.config,k=this.fragPrevious,B=T.fragments,N=T.endSN,W=T.fragmentHint,G=I.maxFragLookUpTolerance,z=!!(I.lowLatencyMode&&T.partList&&W);z&&W&&!this.bitrateTest&&(B=B.concat(W),N=W.sn);var Y;if(v<S){var $=v>S-G?0:G;Y=Object(E.findFragmentByPTS)(k,B,v,$)}else Y=B[B.length-1];if(Y){var Z=Y.sn-T.startSN;if(k&&Y.sn===k.sn&&!z){var q=k&&Y.level===k.level;if(q){var ie=B[Z+1];Y.sn<N&&this.fragmentTracker.getState(ie)!==L.FragmentState.OK?(this.log("SN "+Y.sn+" just loaded, load next one: "+ie.sn),Y=ie):Y=null}}}return Y},a.synchronizeToLiveEdge=function(v){var S=this.config,T=this.media;if(!!T){var I=this.hls.liveSyncPosition,k=T.currentTime,B=v.fragments[0].start,N=v.edge,W=k>=B-S.maxFragLookUpTolerance&&k<=N;if(I!==null&&T.duration>I&&(k<I||!W)){var G=S.liveMaxLatencyDuration!==void 0?S.liveMaxLatencyDuration:S.liveMaxLatencyDurationCount*v.targetduration;(!W&&T.readyState<4||k<N-G)&&(this.loadedmetadata||(this.nextLoadPosition=I),T.readyState&&(this.warn("Playback: "+k.toFixed(3)+" is located too far from the end of live sliding playlist: "+N+", reset currentTime to : "+I.toFixed(3)),T.currentTime=I))}}},a.alignPlaylists=function(v,S){var T=this.levels,I=this.levelLastLoaded,k=this.fragPrevious,B=I!==null?T[I]:null,N=v.fragments.length;if(!N)return this.warn("No fragments in live playlist"),0;var W=v.fragments[0].start,G=!S,z=v.alignedSliding&&Object(P.isFiniteNumber)(W);if(G||!z&&!W){Object(D.alignStream)(k,B,v);var Y=v.fragments[0].start;return this.log("Live playlist sliding: "+Y.toFixed(2)+" start-sn: "+(S?S.startSN:"na")+"->"+v.startSN+" prev-sn: "+(k?k.sn:"na")+" fragments: "+N),Y}return W},a.waitForCdnTuneIn=function(v){var S=3;return v.live&&v.canBlockReload&&v.partTarget&&v.tuneInGoal>Math.max(v.partHoldBack,v.partTarget*S)},a.setStartPosition=function(v,S){var T=this.startPosition;if(T<S&&(T=-1),T===-1||this.lastCurrentTime===-1){var I=v.startTimeOffset;Object(P.isFiniteNumber)(I)?(T=S+I,I<0&&(T+=v.totalduration),T=Math.min(Math.max(S,T),S+v.totalduration),this.log("Start time offset "+I+" found in playlist, adjust startPosition to "+T),this.startPosition=T):v.live?T=this.hls.liveSyncPosition||S:this.startPosition=T=0,this.lastCurrentTime=T}this.nextLoadPosition=T},a.getLoadPosition=function(){var v=this.media,S=0;return this.loadedmetadata&&v?S=v.currentTime:this.nextLoadPosition&&(S=this.nextLoadPosition),S},a.handleFragLoadAborted=function(v,S){this.transmuxer&&v.sn!=="initSegment"&&v.stats.aborted&&(this.warn("Fragment "+v.sn+(S?" part"+S.index:"")+" of level "+v.level+" was aborted"),this.resetFragmentLoading(v))},a.resetFragmentLoading=function(v){(!this.fragCurrent||!this.fragContextChanged(v)&&this.state!==d.FRAG_LOADING_WAITING_RETRY)&&(this.state=d.IDLE)},a.onFragmentOrKeyLoadError=function(v,S){if(!S.fatal){var T=S.frag;if(!(!T||T.type!==v)){var I=this.fragCurrent;console.assert(I&&T.sn===I.sn&&T.level===I.level&&T.urlId===I.urlId,"Frag load error must match current frag to retry");var k=this.config;if(this.fragLoadError+1<=k.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var B=Math.min(Math.pow(2,this.fragLoadError)*k.fragLoadingRetryDelay,k.fragLoadingMaxRetryTimeout);this.warn("Fragment "+T.sn+" of "+v+" "+T.level+" failed to load, retrying in "+B+"ms"),this.retryDate=self.performance.now()+B,this.fragLoadError++,this.state=d.FRAG_LOADING_WAITING_RETRY}else S.levelRetry?(v===s.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=d.IDLE):(R.logger.error(S.details+" reaches max retry, redispatch as fatal ..."),S.fatal=!0,this.hls.stopLoad(),this.state=d.ERROR)}}},a.afterBufferFlushed=function(v,S,T){if(!!v){var I=M.BufferHelper.getBuffered(v);this.fragmentTracker.detectEvictedFragments(S,I,T),this.state===d.ENDED&&this.resetLoadingState()}},a.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=d.IDLE},a.resetStartWhenNotLoaded=function(v){if(!this.loadedmetadata){this.startFragRequested=!1;var S=this.levels?this.levels[v].details:null;S!=null&&S.live?(this.startPosition=-1,this.setStartPosition(S,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},a.updateLevelTiming=function(v,S,T,I){var k=this,B=T.details;console.assert(!!B,"level.details must be defined");var N=Object.keys(v.elementaryStreams).reduce(function(W,G){var z=v.elementaryStreams[G];if(z){var Y=z.endPTS-z.startPTS;if(Y<=0)return k.warn("Could not parse fragment "+v.sn+" "+G+" duration reliably ("+Y+")"),W||!1;var $=I?0:Object(m.updateFragPTSDTS)(B,v,z.startPTS,z.endPTS,z.startDTS,z.endDTS);return k.hls.trigger(b.Events.LEVEL_PTS_UPDATED,{details:B,level:T,drift:$,type:G,frag:v,start:z.startPTS,end:z.endPTS}),!0}return W},!1);N||(this.warn("Found no media in fragment "+v.sn+" of level "+T.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=d.PARSED,this.hls.trigger(b.Events.FRAG_PARSED,{frag:v,part:S})},a.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},g(l,[{key:"state",get:function(){return this._state},set:function(v){var S=this._state;S!==v&&(this._state=v,this.log(S+"->"+v))}}]),l}(_.default)},"./src/controller/buffer-controller.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return E});var P=h("./src/polyfills/number.ts"),_=h("./src/events.ts"),L=h("./src/utils/logger.ts"),M=h("./src/errors.ts"),R=h("./src/utils/buffer-helper.ts"),b=h("./src/utils/mediasource-helper.ts"),A=h("./src/loader/fragment.ts"),y=h("./src/controller/buffer-operation-queue.ts"),x=Object(b.getMediaSource)(),D=/([ha]vc.)(?:\.[^.,]+)+/,E=function(){function m(u){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var s=e.hls,c=e.media,g=e.mediaSource;L.logger.log("[buffer-controller]: Media source opened"),c&&(e.updateMediaElementDuration(),s.trigger(_.Events.MEDIA_ATTACHED,{media:c})),g&&g.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){L.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){L.logger.log("[buffer-controller]: Media source ended")},this.hls=u,this._initSourceBuffer(),this.registerListeners()}var p=m.prototype;return p.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},p.destroy=function(){this.unregisterListeners(),this.details=null},p.registerListeners=function(){var e=this.hls;e.on(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.Events.BUFFER_RESET,this.onBufferReset,this),e.on(_.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(_.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(_.Events.BUFFER_EOS,this.onBufferEos,this),e.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(_.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(_.Events.FRAG_PARSED,this.onFragParsed,this),e.on(_.Events.FRAG_CHANGED,this.onFragChanged,this)},p.unregisterListeners=function(){var e=this.hls;e.off(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.Events.BUFFER_RESET,this.onBufferReset,this),e.off(_.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(_.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(_.Events.BUFFER_EOS,this.onBufferEos,this),e.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(_.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(_.Events.FRAG_PARSED,this.onFragParsed,this),e.off(_.Events.FRAG_CHANGED,this.onFragChanged,this)},p._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new y.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},p.onManifestParsed=function(e,s){var c=2;(s.audio&&!s.video||!s.altAudio)&&(c=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=c,this.details=null,L.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},p.onMediaAttaching=function(e,s){var c=this.media=s.media;if(c&&x){var g=this.mediaSource=new x;g.addEventListener("sourceopen",this._onMediaSourceOpen),g.addEventListener("sourceended",this._onMediaSourceEnded),g.addEventListener("sourceclose",this._onMediaSourceClose),c.src=self.URL.createObjectURL(g),this._objectUrl=c.src}},p.onMediaDetaching=function(){var e=this.media,s=this.mediaSource,c=this._objectUrl;if(s){if(L.logger.log("[buffer-controller]: media source detaching"),s.readyState==="open")try{s.endOfStream()}catch(g){L.logger.warn("[buffer-controller]: onMediaDetaching: "+g.message+" while calling endOfStream")}this.onBufferReset(),s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(c&&self.URL.revokeObjectURL(c),e.src===c?(e.removeAttribute("src"),e.load()):L.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(_.Events.MEDIA_DETACHED,void 0)},p.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(s){var c=e.sourceBuffer[s];try{c&&(e.removeBufferListeners(s),e.mediaSource&&e.mediaSource.removeSourceBuffer(c),e.sourceBuffer[s]=void 0)}catch(g){L.logger.warn("[buffer-controller]: Failed to reset the "+s+" buffer",g)}}),this._initSourceBuffer()},p.onBufferCodecs=function(e,s){var c=this,g=this.getSourceBufferTypes().length;Object.keys(s).forEach(function(i){if(g){var r=c.tracks[i];if(r&&typeof r.buffer.changeType=="function"){var o=s[i],d=o.id,t=o.codec,n=o.levelCodec,l=o.container,a=o.metadata,f=(r.levelCodec||r.codec).replace(D,"$1"),v=(n||t).replace(D,"$1");if(f!==v){var S=l+";codecs="+(n||t);c.appendChangeType(i,S),L.logger.log("[buffer-controller]: switching codec "+f+" to "+v),c.tracks[i]={buffer:r.buffer,codec:t,container:l,levelCodec:n,metadata:a,id:d}}}}else c.pendingTracks[i]=s[i]}),!g&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},p.appendChangeType=function(e,s){var c=this,g=this.operationQueue,i={execute:function(){var o=c.sourceBuffer[e];o&&(L.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+s),o.changeType(s)),g.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(o){L.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",o)}};g.append(i,e)},p.onBufferAppending=function(e,s){var c=this,g=this.hls,i=this.operationQueue,r=this.tracks,o=s.data,d=s.type,t=s.frag,n=s.part,l=s.chunkMeta,a=l.buffering[d],f=self.performance.now();a.start=f;var v=t.stats.buffering,S=n?n.stats.buffering:null;v.start===0&&(v.start=f),S&&S.start===0&&(S.start=f);var T=r.audio,I=d==="audio"&&l.id===1&&(T==null?void 0:T.container)==="audio/mpeg",k={execute:function(){if(a.executeStart=self.performance.now(),I){var N=c.sourceBuffer[d];if(N){var W=t.start-N.timestampOffset;Math.abs(W)>=.1&&(L.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+t.start+" (delta: "+W+") sn: "+t.sn+")"),N.timestampOffset=t.start)}}c.appendExecutor(o,d)},onStart:function(){},onComplete:function(){var N=self.performance.now();a.executeEnd=a.end=N,v.first===0&&(v.first=N),S&&S.first===0&&(S.first=N);var W=c.sourceBuffer,G={};for(var z in W)G[z]=R.BufferHelper.getBuffered(W[z]);c.appendError=0,c.hls.trigger(_.Events.BUFFER_APPENDED,{type:d,frag:t,part:n,chunkMeta:l,parent:t.type,timeRanges:G})},onError:function(N){L.logger.error("[buffer-controller]: Error encountered while trying to append to the "+d+" SourceBuffer",N);var W={type:M.ErrorTypes.MEDIA_ERROR,parent:t.type,details:M.ErrorDetails.BUFFER_APPEND_ERROR,err:N,fatal:!1};N.code===DOMException.QUOTA_EXCEEDED_ERR?W.details=M.ErrorDetails.BUFFER_FULL_ERROR:(c.appendError++,W.details=M.ErrorDetails.BUFFER_APPEND_ERROR,c.appendError>g.config.appendErrorMaxRetry&&(L.logger.error("[buffer-controller]: Failed "+g.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),W.fatal=!0,g.stopLoad())),g.trigger(_.Events.ERROR,W)}};i.append(k,d)},p.onBufferFlushing=function(e,s){var c=this,g=this.operationQueue,i=function(o){return{execute:c.removeExecutor.bind(c,o,s.startOffset,s.endOffset),onStart:function(){},onComplete:function(){c.hls.trigger(_.Events.BUFFER_FLUSHED,{type:o})},onError:function(t){L.logger.warn("[buffer-controller]: Failed to remove from "+o+" SourceBuffer",t)}}};s.type?g.append(i(s.type),s.type):this.getSourceBufferTypes().forEach(function(r){g.append(i(r),r)})},p.onFragParsed=function(e,s){var c=this,g=s.frag,i=s.part,r=[],o=i?i.elementaryStreams:g.elementaryStreams;o[A.ElementaryStreamTypes.AUDIOVIDEO]?r.push("audiovideo"):(o[A.ElementaryStreamTypes.AUDIO]&&r.push("audio"),o[A.ElementaryStreamTypes.VIDEO]&&r.push("video"));var d=function(){var n=self.performance.now();g.stats.buffering.end=n,i&&(i.stats.buffering.end=n);var l=i?i.stats:g.stats;c.hls.trigger(_.Events.FRAG_BUFFERED,{frag:g,part:i,stats:l,id:g.type})};r.length===0&&L.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+g.type+" level: "+g.level+" sn: "+g.sn),this.blockBuffers(d,r)},p.onFragChanged=function(e,s){this.flushBackBuffer()},p.onBufferEos=function(e,s){var c=this,g=this.getSourceBufferTypes().reduce(function(i,r){var o=c.sourceBuffer[r];return(!s.type||s.type===r)&&o&&!o.ended&&(o.ended=!0,L.logger.log("[buffer-controller]: "+r+" sourceBuffer now EOS")),i&&!!(!o||o.ended)},!0);g&&this.blockBuffers(function(){var i=c.mediaSource;!i||i.readyState!=="open"||i.endOfStream()})},p.onLevelUpdated=function(e,s){var c=s.details;!c.fragments.length||(this.details=c,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},p.flushBackBuffer=function(){var e=this.hls,s=this.details,c=this.media,g=this.sourceBuffer;if(!(!c||s===null)){var i=this.getSourceBufferTypes();if(!!i.length){var r=s.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(!(!Object(P.isFiniteNumber)(r)||r<0)){var o=c.currentTime,d=s.levelTargetDuration,t=Math.max(r,d),n=Math.floor(o/d)*d-t;i.forEach(function(l){var a=g[l];if(a){var f=R.BufferHelper.getBuffered(a);f.length>0&&n>f.start(0)&&(e.trigger(_.Events.BACK_BUFFER_REACHED,{bufferEnd:n}),s.live&&e.trigger(_.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n}),e.trigger(_.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:l}))}})}}}},p.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var e=this.details,s=this.hls,c=this.media,g=this.mediaSource,i=e.fragments[0].start+e.totalduration,r=c.duration,o=Object(P.isFiniteNumber)(g.duration)?g.duration:0;e.live&&s.config.liveDurationInfinity?(L.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),g.duration=1/0,this.updateSeekableRange(e)):(i>o&&i>r||!Object(P.isFiniteNumber)(r))&&(L.logger.log("[buffer-controller]: Updating Media Source duration to "+i.toFixed(3)),g.duration=i)}},p.updateSeekableRange=function(e){var s=this.mediaSource,c=e.fragments,g=c.length;if(g&&e.live&&s!==null&&s!==void 0&&s.setLiveSeekableRange){var i=Math.max(0,c[0].start),r=Math.max(i,i+e.totalduration);s.setLiveSeekableRange(i,r)}},p.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,s=this.operationQueue,c=this.pendingTracks,g=Object.keys(c).length;if(g&&!e||g===2){this.createSourceBuffers(c),this.pendingTracks={};var i=this.getSourceBufferTypes();if(i.length===0){this.hls.trigger(_.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}i.forEach(function(r){s.executeNext(r)})}},p.createSourceBuffers=function(e){var s=this.sourceBuffer,c=this.mediaSource;if(!c)throw Error("createSourceBuffers called when mediaSource was null");var g=0;for(var i in e)if(!s[i]){var r=e[i];if(!r)throw Error("source buffer exists for track "+i+", however track does not");var o=r.levelCodec||r.codec,d=r.container+";codecs="+o;L.logger.log("[buffer-controller]: creating sourceBuffer("+d+")");try{var t=s[i]=c.addSourceBuffer(d),n=i;this.addBufferListener(n,"updatestart",this._onSBUpdateStart),this.addBufferListener(n,"updateend",this._onSBUpdateEnd),this.addBufferListener(n,"error",this._onSBUpdateError),this.tracks[i]={buffer:t,codec:o,container:r.container,levelCodec:r.levelCodec,metadata:r.metadata,id:r.id},g++}catch(l){L.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+l.message),this.hls.trigger(_.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:l,mimeType:d})}}g&&this.hls.trigger(_.Events.BUFFER_CREATED,{tracks:this.tracks})},p._onSBUpdateStart=function(e){var s=this.operationQueue,c=s.current(e);c.onStart()},p._onSBUpdateEnd=function(e){var s=this.operationQueue,c=s.current(e);c.onComplete(),s.shiftAndExecuteNext(e)},p._onSBUpdateError=function(e,s){L.logger.error("[buffer-controller]: "+e+" SourceBuffer error",s),this.hls.trigger(_.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var c=this.operationQueue.current(e);c&&c.onError(s)},p.removeExecutor=function(e,s,c){var g=this.media,i=this.mediaSource,r=this.operationQueue,o=this.sourceBuffer,d=o[e];if(!g||!i||!d){L.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),r.shiftAndExecuteNext(e);return}var t=Object(P.isFiniteNumber)(g.duration)?g.duration:1/0,n=Object(P.isFiniteNumber)(i.duration)?i.duration:1/0,l=Math.max(0,s),a=Math.min(c,t,n);a>l?(L.logger.log("[buffer-controller]: Removing ["+l+","+a+"] from the "+e+" SourceBuffer"),console.assert(!d.updating,e+" sourceBuffer must not be updating"),d.remove(l,a)):r.shiftAndExecuteNext(e)},p.appendExecutor=function(e,s){var c=this.operationQueue,g=this.sourceBuffer,i=g[s];if(!i){L.logger.warn("[buffer-controller]: Attempting to append to the "+s+" SourceBuffer, but it does not exist"),c.shiftAndExecuteNext(s);return}i.ended=!1,console.assert(!i.updating,s+" sourceBuffer must not be updating"),i.appendBuffer(e)},p.blockBuffers=function(e,s){var c=this;if(s===void 0&&(s=this.getSourceBufferTypes()),!s.length){L.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}var g=this.operationQueue,i=s.map(function(r){return g.appendBlocker(r)});Promise.all(i).then(function(){e(),s.forEach(function(r){var o=c.sourceBuffer[r];(!o||!o.updating)&&g.shiftAndExecuteNext(r)})})},p.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},p.addBufferListener=function(e,s,c){var g=this.sourceBuffer[e];if(!!g){var i=c.bind(this,e);this.listeners[e].push({event:s,listener:i}),g.addEventListener(s,i)}},p.removeBufferListeners=function(e){var s=this.sourceBuffer[e];!s||this.listeners[e].forEach(function(c){s.removeEventListener(c.event,c.listener)})},m}()},"./src/controller/buffer-operation-queue.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return _});var P=h("./src/utils/logger.ts"),_=function(){function L(R){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=R}var M=L.prototype;return M.append=function(b,A){var y=this.queues[A];y.push(b),y.length===1&&this.buffers[A]&&this.executeNext(A)},M.insertAbort=function(b,A){var y=this.queues[A];y.unshift(b),this.executeNext(A)},M.appendBlocker=function(b){var A,y=new Promise(function(D){A=D}),x={execute:A,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(x,b),y},M.executeNext=function(b){var A=this.buffers,y=this.queues,x=A[b],D=y[b];if(D.length){var E=D[0];try{E.execute()}catch(m){P.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),E.onError(m),(!x||!x.updating)&&(D.shift(),this.executeNext(b))}}},M.shiftAndExecuteNext=function(b){this.queues[b].shift(),this.executeNext(b)},M.current=function(b){return this.queues[b][0]},L}()},"./src/controller/cap-level-controller.ts":function(U,O,h){"use strict";h.r(O);var P=h("./src/events.ts");function _(R,b){for(var A=0;A<b.length;A++){var y=b[A];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(R,y.key,y)}}function L(R,b,A){return b&&_(R.prototype,b),A&&_(R,A),Object.defineProperty(R,"prototype",{writable:!1}),R}var M=function(){function R(A){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=A,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var b=R.prototype;return b.setStreamController=function(y){this.streamController=y},b.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},b.registerListeners=function(){var y=this.hls;y.on(P.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),y.on(P.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),y.on(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),y.on(P.Events.BUFFER_CODECS,this.onBufferCodecs,this),y.on(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},b.unregisterListener=function(){var y=this.hls;y.off(P.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),y.off(P.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),y.off(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),y.off(P.Events.BUFFER_CODECS,this.onBufferCodecs,this),y.off(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},b.onFpsDropLevelCapping=function(y,x){R.isLevelAllowed(x.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(x.droppedLevel)},b.onMediaAttaching=function(y,x){this.media=x.media instanceof HTMLVideoElement?x.media:null},b.onManifestParsed=function(y,x){var D=this.hls;this.restrictedLevels=[],this.firstLevel=x.firstLevel,D.config.capLevelToPlayerSize&&x.video&&this.startCapping()},b.onBufferCodecs=function(y,x){var D=this.hls;D.config.capLevelToPlayerSize&&x.video&&this.startCapping()},b.onMediaDetaching=function(){this.stopCapping()},b.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var y=this.hls.levels;if(y.length){var x=this.hls;x.autoLevelCapping=this.getMaxLevel(y.length-1),x.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=x.autoLevelCapping}}},b.getMaxLevel=function(y){var x=this,D=this.hls.levels;if(!D.length)return-1;var E=D.filter(function(m,p){return R.isLevelAllowed(p,x.restrictedLevels)&&p<=y});return this.clientRect=null,R.getMaxLevelByMediaSize(E,this.mediaWidth,this.mediaHeight)},b.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},b.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},b.getDimensions=function(){if(this.clientRect)return this.clientRect;var y=this.media,x={width:0,height:0};if(y){var D=y.getBoundingClientRect();x.width=D.width,x.height=D.height,!x.width&&!x.height&&(x.width=D.right-D.left||y.width||0,x.height=D.bottom-D.top||y.height||0)}return this.clientRect=x,x},R.isLevelAllowed=function(y,x){return x===void 0&&(x=[]),x.indexOf(y)===-1},R.getMaxLevelByMediaSize=function(y,x,D){if(!y||!y.length)return-1;for(var E=function(s,c){return c?s.width!==c.width||s.height!==c.height:!0},m=y.length-1,p=0;p<y.length;p+=1){var u=y[p];if((u.width>=x||u.height>=D)&&E(u,y[p+1])){m=p;break}}return m},L(R,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var y=1;if(!this.hls.config.ignoreDevicePixelRatio)try{y=self.devicePixelRatio}catch{}return y}}]),R}();O.default=M},"./src/controller/cmcd-controller.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return E});var P=h("./src/events.ts"),_=h("./src/types/cmcd.ts"),L=h("./src/utils/buffer-helper.ts"),M=h("./src/utils/logger.ts");function R(m,p){for(var u=0;u<p.length;u++){var e=p[u];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(m,e.key,e)}}function b(m,p,u){return p&&R(m.prototype,p),u&&R(m,u),Object.defineProperty(m,"prototype",{writable:!1}),m}function A(m,p){var u=typeof Symbol!="undefined"&&m[Symbol.iterator]||m["@@iterator"];if(u)return(u=u.call(m)).next.bind(u);if(Array.isArray(m)||(u=y(m))||p&&m&&typeof m.length=="number"){u&&(m=u);var e=0;return function(){return e>=m.length?{done:!0}:{done:!1,value:m[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function y(m,p){if(!!m){if(typeof m=="string")return x(m,p);var u=Object.prototype.toString.call(m).slice(8,-1);if(u==="Object"&&m.constructor&&(u=m.constructor.name),u==="Map"||u==="Set")return Array.from(m);if(u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u))return x(m,p)}}function x(m,p){(p==null||p>m.length)&&(p=m.length);for(var u=0,e=new Array(p);u<p;u++)e[u]=m[u];return e}function D(){return D=Object.assign?Object.assign.bind():function(m){for(var p=1;p<arguments.length;p++){var u=arguments[p];for(var e in u)Object.prototype.hasOwnProperty.call(u,e)&&(m[e]=u[e])}return m},D.apply(this,arguments)}var E=function(){function m(u){var e=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){e.initialized&&(e.starved=!0),e.buffering=!0},this.onPlaying=function(){e.initialized||(e.initialized=!0),e.buffering=!1},this.applyPlaylistData=function(g){try{e.apply(g,{ot:_.CMCDObjectType.MANIFEST,su:!e.initialized})}catch(i){M.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=function(g){try{var i=g.frag,r=e.hls.levels[i.level],o=e.getObjectType(i),d={d:i.duration*1e3,ot:o};(o===_.CMCDObjectType.VIDEO||o===_.CMCDObjectType.AUDIO||o==_.CMCDObjectType.MUXED)&&(d.br=r.bitrate/1e3,d.tb=e.getTopBandwidth(o)/1e3,d.bl=e.getBufferLength(o)),e.apply(g,d)}catch(t){M.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=u;var s=this.config=u.config,c=s.cmcd;c!=null&&(s.pLoader=this.createPlaylistLoader(),s.fLoader=this.createFragmentLoader(),this.sid=c.sessionId||m.uuid(),this.cid=c.contentId,this.useHeaders=c.useHeaders===!0,this.registerListeners())}var p=m.prototype;return p.registerListeners=function(){var e=this.hls;e.on(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(P.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(P.Events.BUFFER_CREATED,this.onBufferCreated,this)},p.unregisterListeners=function(){var e=this.hls;e.off(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(P.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(P.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},p.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},p.onMediaAttached=function(e,s){this.media=s.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},p.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},p.onBufferCreated=function(e,s){var c,g;this.audioBuffer=(c=s.tracks.audio)===null||c===void 0?void 0:c.buffer,this.videoBuffer=(g=s.tracks.video)===null||g===void 0?void 0:g.buffer},p.createData=function(){var e;return{v:_.CMCDVersion,sf:_.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)===null||e===void 0?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},p.apply=function(e,s){s===void 0&&(s={}),D(s,this.createData());var c=s.ot===_.CMCDObjectType.INIT||s.ot===_.CMCDObjectType.VIDEO||s.ot===_.CMCDObjectType.MUXED;if(this.starved&&c&&(s.bs=!0,s.su=!0,this.starved=!1),s.su==null&&(s.su=this.buffering),this.useHeaders){var g=m.toHeaders(s);if(!Object.keys(g).length)return;e.headers||(e.headers={}),D(e.headers,g)}else{var i=m.toQuery(s);if(!i)return;e.url=m.appendQueryToUri(e.url,i)}},p.getObjectType=function(e){var s=e.type;if(s==="subtitle")return _.CMCDObjectType.TIMED_TEXT;if(e.sn==="initSegment")return _.CMCDObjectType.INIT;if(s==="audio")return _.CMCDObjectType.AUDIO;if(s==="main")return this.hls.audioTracks.length?_.CMCDObjectType.VIDEO:_.CMCDObjectType.MUXED},p.getTopBandwidth=function(e){var s=0,c,g=this.hls;if(e===_.CMCDObjectType.AUDIO)c=g.audioTracks;else{var i=g.maxAutoLevel,r=i>-1?i+1:g.levels.length;c=g.levels.slice(0,r)}for(var o=A(c),d;!(d=o()).done;){var t=d.value;t.bitrate>s&&(s=t.bitrate)}return s>0?s:NaN},p.getBufferLength=function(e){var s=this.hls.media,c=e===_.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!c||!s)return NaN;var g=L.BufferHelper.bufferInfo(c,s.currentTime,this.config.maxBufferHole);return g.len*1e3},p.createPlaylistLoader=function(){var e=this.config.pLoader,s=this.applyPlaylistData,c=e||this.config.loader;return function(){function g(r){this.loader=void 0,this.loader=new c(r)}var i=g.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(o,d,t){s(o),this.loader.load(o,d,t)},b(g,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),g}()},p.createFragmentLoader=function(){var e=this.config.fLoader,s=this.applyFragmentData,c=e||this.config.loader;return function(){function g(r){this.loader=void 0,this.loader=new c(r)}var i=g.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(o,d,t){s(o),this.loader.load(o,d,t)},b(g,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),g}()},m.uuid=function(){var e=URL.createObjectURL(new Blob),s=e.toString();return URL.revokeObjectURL(e),s.slice(s.lastIndexOf("/")+1)},m.serialize=function(e){for(var s=[],c=function(I){return!Number.isNaN(I)&&I!=null&&I!==""&&I!==!1},g=function(I){return Math.round(I)},i=function(I){return g(I/100)*100},r=function(I){return encodeURIComponent(I)},o={br:g,d:g,bl:i,dl:i,mtp:i,nor:r,rtp:i,tb:g},d=Object.keys(e||{}).sort(),t=A(d),n;!(n=t()).done;){var l=n.value,a=e[l];if(!!c(a)&&!(l==="v"&&a===1)&&!(l=="pr"&&a===1)){var f=o[l];f&&(a=f(a));var v=typeof a,S=void 0;l==="ot"||l==="sf"||l==="st"?S=l+"="+a:v==="boolean"?S=l:v==="number"?S=l+"="+a:S=l+"="+JSON.stringify(a),s.push(S)}}return s.join(",")},m.toHeaders=function(e){for(var s=Object.keys(e),c={},g=["Object","Request","Session","Status"],i=[{},{},{},{}],r={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},o=0,d=s;o<d.length;o++){var t=d[o],n=r[t]!=null?r[t]:1;i[n][t]=e[t]}for(var l=0;l<i.length;l++){var a=m.serialize(i[l]);a&&(c["CMCD-"+g[l]]=a)}return c},m.toQuery=function(e){return"CMCD="+encodeURIComponent(m.serialize(e))},m.appendQueryToUri=function(e,s){if(!s)return e;var c=e.includes("?")?"&":"?";return""+e+c+s},m}()},"./src/controller/eme-controller.ts":function(U,O,h){"use strict";h.r(O);var P=h("./src/events.ts"),_=h("./src/errors.ts"),L=h("./src/utils/logger.ts"),M=h("./src/utils/mediakeys-helper.ts");function R(E,m){for(var p=0;p<m.length;p++){var u=m[p];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(E,u.key,u)}}function b(E,m,p){return m&&R(E.prototype,m),p&&R(E,p),Object.defineProperty(E,"prototype",{writable:!1}),E}var A=3,y=function(m,p,u){var e={audioCapabilities:[],videoCapabilities:[]};return m.forEach(function(s){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+s+'"',robustness:u.audioRobustness||""})}),p.forEach(function(s){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+s+'"',robustness:u.videoRobustness||""})}),[e]},x=function(m,p,u,e){switch(m){case M.KeySystems.WIDEVINE:return y(p,u,e);default:throw new Error("Unknown key-system: "+m)}},D=function(){function E(p){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=p,this._config=p.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var m=E.prototype;return m.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},m._registerListeners=function(){this.hls.on(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(P.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(P.Events.MANIFEST_PARSED,this.onManifestParsed,this)},m._unregisterListeners=function(){this.hls.off(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(P.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(P.Events.MANIFEST_PARSED,this.onManifestParsed,this)},m.getLicenseServerUrl=function(u){switch(u){case M.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+u+'"')},m._attemptKeySystemAccess=function(u,e,s){var c=this,g=x(u,e,s,this._drmSystemOptions);L.logger.log("Requesting encrypted media key-system access");var i=this.requestMediaKeySystemAccess(u,g);this.mediaKeysPromise=i.then(function(r){return c._onMediaKeySystemAccessObtained(u,r)}),i.catch(function(r){L.logger.error('Failed to obtain key-system "'+u+'" access:',r)})},m._onMediaKeySystemAccessObtained=function(u,e){var s=this;L.logger.log('Access for key-system "'+u+'" obtained');var c={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:u};this._mediaKeysList.push(c);var g=Promise.resolve().then(function(){return e.createMediaKeys()}).then(function(i){return c.mediaKeys=i,L.logger.log('Media-keys created for key-system "'+u+'"'),s._onMediaKeysCreated(),i});return g.catch(function(i){L.logger.error("Failed to create media-keys:",i)}),g},m._onMediaKeysCreated=function(){var u=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),u._onNewMediaKeySession(e.mediaKeysSession))})},m._onNewMediaKeySession=function(u){var e=this;L.logger.log("New key-system session "+u.sessionId),u.addEventListener("message",function(s){e._onKeySessionMessage(u,s.message)},!1)},m._onKeySessionMessage=function(u,e){L.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(s){L.logger.log("Received license data (length: "+(s&&s.byteLength)+"), updating key-session"),u.update(s).catch(function(c){L.logger.warn("Updating key-session failed: "+c)})})},m.onMediaEncrypted=function(u){var e=this;if(L.logger.log('Media is encrypted using "'+u.initDataType+'" init data type'),!this.mediaKeysPromise){L.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(P.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var s=function(g){!e._media||(e._attemptSetMediaKeys(g),e._generateRequestWithPreferredKeySession(u.initDataType,u.initData))};this.mediaKeysPromise.then(s).catch(s)},m._attemptSetMediaKeys=function(u){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys){L.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(P.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}L.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},m._generateRequestWithPreferredKeySession=function(u,e){var s=this,c=this._mediaKeysList[0];if(!c){L.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(P.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(c.mediaKeysSessionInitialized){L.logger.warn("Key-Session already initialized but requested again");return}var g=c.mediaKeysSession;if(!g){L.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(P.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!e){L.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(P.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}L.logger.log('Generating key-session request for "'+u+'" init data type'),c.mediaKeysSessionInitialized=!0,g.generateRequest(u,e).then(function(){L.logger.debug("Key-session generation succeeded")}).catch(function(i){L.logger.error("Error generating key-session request:",i),s.hls.trigger(P.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},m._createLicenseXhr=function(u,e,s){var c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,c,u,e,s);var g=this._licenseXhrSetup;if(g)try{g.call(this.hls,c,u),g=void 0}catch(i){L.logger.error(i)}try{c.readyState||c.open("POST",u,!0),g&&g.call(this.hls,c,u)}catch(i){throw new Error("issue setting up KeySystem license XHR "+i)}return c},m._onLicenseRequestReadyStageChange=function(u,e,s,c){switch(u.readyState){case 4:if(u.status===200){this._requestLicenseFailureCount=0,L.logger.log("License request succeeded");var g=u.response,i=this._licenseResponseCallback;if(i)try{g=i.call(this.hls,u,e)}catch(o){L.logger.error(o)}c(g)}else{if(L.logger.error("License Request XHR failed ("+e+"). Status: "+u.status+" ("+u.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>A){this.hls.trigger(P.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var r=A-this._requestLicenseFailureCount+1;L.logger.warn("Retrying license request, "+r+" attempts left"),this._requestLicense(s,c)}break}},m._generateLicenseRequestChallenge=function(u,e){switch(u.mediaKeySystemDomain){case M.KeySystems.WIDEVINE:return e}throw new Error("unsupported key-system: "+u.mediaKeySystemDomain)},m._requestLicense=function(u,e){L.logger.log("Requesting content license for key-system");var s=this._mediaKeysList[0];if(!s){L.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(P.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var c=this.getLicenseServerUrl(s.mediaKeySystemDomain),g=this._createLicenseXhr(c,u,e);L.logger.log("Sending license request to URL: "+c);var i=this._generateLicenseRequestChallenge(s,u);g.send(i)}catch(r){L.logger.error("Failure requesting DRM license: "+r),this.hls.trigger(P.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},m.onMediaAttached=function(u,e){if(!!this._emeEnabled){var s=e.media;this._media=s,s.addEventListener("encrypted",this._onMediaEncrypted)}},m.onMediaDetached=function(){var u=this._media,e=this._mediaKeysList;!u||(u.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(s){if(s.mediaKeysSession)return s.mediaKeysSession.close().catch(function(){})})).then(function(){return u.setMediaKeys(null)}).catch(function(){}))},m.onManifestParsed=function(u,e){if(!!this._emeEnabled){var s=e.levels.map(function(g){return g.audioCodec}).filter(function(g){return!!g}),c=e.levels.map(function(g){return g.videoCodec}).filter(function(g){return!!g});this._attemptKeySystemAccess(M.KeySystems.WIDEVINE,s,c)}},b(E,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),E}();O.default=D},"./src/controller/fps-controller.ts":function(U,O,h){"use strict";h.r(O);var P=h("./src/events.ts"),_=h("./src/utils/logger.ts"),L=function(){function M(b){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=b,this.registerListeners()}var R=M.prototype;return R.setStreamController=function(A){this.streamController=A},R.registerListeners=function(){this.hls.on(P.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},R.unregisterListeners=function(){this.hls.off(P.Events.MEDIA_ATTACHING,this.onMediaAttaching)},R.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},R.onMediaAttaching=function(A,y){var x=this.hls.config;if(x.capLevelOnFPSDrop){var D=y.media instanceof self.HTMLVideoElement?y.media:null;this.media=D,D&&typeof D.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),x.fpsDroppedMonitoringPeriod)}},R.checkFPS=function(A,y,x){var D=performance.now();if(y){if(this.lastTime){var E=D-this.lastTime,m=x-this.lastDroppedFrames,p=y-this.lastDecodedFrames,u=1e3*m/E,e=this.hls;if(e.trigger(P.Events.FPS_DROP,{currentDropped:m,currentDecoded:p,totalDroppedFrames:x}),u>0&&m>e.config.fpsDroppedMonitoringThreshold*p){var s=e.currentLevel;_.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+s),s>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=s)&&(s=s-1,e.trigger(P.Events.FPS_DROP_LEVEL_CAPPING,{level:s,droppedLevel:e.currentLevel}),e.autoLevelCapping=s,this.streamController.nextLevelSwitch())}}this.lastTime=D,this.lastDroppedFrames=x,this.lastDecodedFrames=y}},R.checkFPSInterval=function(){var A=this.media;if(A)if(this.isVideoPlaybackQualityAvailable){var y=A.getVideoPlaybackQuality();this.checkFPS(A,y.totalVideoFrames,y.droppedVideoFrames)}else this.checkFPS(A,A.webkitDecodedFrameCount,A.webkitDroppedFrameCount)},M}();O.default=L},"./src/controller/fragment-finders.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"findFragmentByPDT",function(){return L}),h.d(O,"findFragmentByPTS",function(){return M}),h.d(O,"fragmentWithinToleranceTest",function(){return R}),h.d(O,"pdtWithinToleranceTest",function(){return b}),h.d(O,"findFragWithCC",function(){return A});var P=h("./src/polyfills/number.ts"),_=h("./src/utils/binary-search.ts");function L(y,x,D){if(x===null||!Array.isArray(y)||!y.length||!Object(P.isFiniteNumber)(x))return null;var E=y[0].programDateTime;if(x<(E||0))return null;var m=y[y.length-1].endProgramDateTime;if(x>=(m||0))return null;D=D||0;for(var p=0;p<y.length;++p){var u=y[p];if(b(x,D,u))return u}return null}function M(y,x,D,E){D===void 0&&(D=0),E===void 0&&(E=0);var m=null;if(y?m=x[y.sn-x[0].sn+1]||null:D===0&&x[0].start===0&&(m=x[0]),m&&R(D,E,m)===0)return m;var p=_.default.search(x,R.bind(null,D,E));return p||m}function R(y,x,D){y===void 0&&(y=0),x===void 0&&(x=0);var E=Math.min(x,D.duration+(D.deltaPTS?D.deltaPTS:0));return D.start+D.duration-E<=y?1:D.start-E>y&&D.start?-1:0}function b(y,x,D){var E=Math.min(x,D.duration+(D.deltaPTS?D.deltaPTS:0))*1e3,m=D.endProgramDateTime||0;return m-E>y}function A(y,x){return _.default.search(y,function(D){return D.cc<x?1:D.cc>x?-1:0})}},"./src/controller/fragment-tracker.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"FragmentState",function(){return L}),h.d(O,"FragmentTracker",function(){return M});var P=h("./src/events.ts"),_=h("./src/types/loader.ts"),L;(function(A){A.NOT_LOADED="NOT_LOADED",A.APPENDING="APPENDING",A.PARTIAL="PARTIAL",A.OK="OK"})(L||(L={}));var M=function(){function A(x){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=x,this._registerListeners()}var y=A.prototype;return y._registerListeners=function(){var D=this.hls;D.on(P.Events.BUFFER_APPENDED,this.onBufferAppended,this),D.on(P.Events.FRAG_BUFFERED,this.onFragBuffered,this),D.on(P.Events.FRAG_LOADED,this.onFragLoaded,this)},y._unregisterListeners=function(){var D=this.hls;D.off(P.Events.BUFFER_APPENDED,this.onBufferAppended,this),D.off(P.Events.FRAG_BUFFERED,this.onFragBuffered,this),D.off(P.Events.FRAG_LOADED,this.onFragLoaded,this)},y.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},y.getAppendedFrag=function(D,E){if(E===_.PlaylistLevelType.MAIN){var m=this.activeFragment,p=this.activeParts;if(!m)return null;if(p)for(var u=p.length;u--;){var e=p[u],s=e?e.end:m.appendedPTS;if(e.start<=D&&s!==void 0&&D<=s)return u>9&&(this.activeParts=p.slice(u-9)),e}else if(m.start<=D&&m.appendedPTS!==void 0&&D<=m.appendedPTS)return m}return this.getBufferedFrag(D,E)},y.getBufferedFrag=function(D,E){for(var m=this.fragments,p=Object.keys(m),u=p.length;u--;){var e=m[p[u]];if((e==null?void 0:e.body.type)===E&&e.buffered){var s=e.body;if(s.start<=D&&D<=s.end)return s}}return null},y.detectEvictedFragments=function(D,E,m){var p=this;Object.keys(this.fragments).forEach(function(u){var e=p.fragments[u];if(!!e){if(!e.buffered){e.body.type===m&&p.removeFragment(e.body);return}var s=e.range[D];!s||s.time.some(function(c){var g=!p.isTimeBuffered(c.startPTS,c.endPTS,E);return g&&p.removeFragment(e.body),g})}})},y.detectPartialFragments=function(D){var E=this,m=this.timeRanges,p=D.frag,u=D.part;if(!(!m||p.sn==="initSegment")){var e=b(p),s=this.fragments[e];!s||(Object.keys(m).forEach(function(c){var g=p.elementaryStreams[c];if(!!g){var i=m[c],r=u!==null||g.partial===!0;s.range[c]=E.getBufferedTimes(p,u,r,i)}}),s.loaded=null,Object.keys(s.range).length?s.buffered=!0:this.removeFragment(s.body))}},y.fragBuffered=function(D){var E=b(D),m=this.fragments[E];m&&(m.loaded=null,m.buffered=!0)},y.getBufferedTimes=function(D,E,m,p){for(var u={time:[],partial:m},e=E?E.start:D.start,s=E?E.end:D.end,c=D.minEndPTS||s,g=D.maxStartPTS||e,i=0;i<p.length;i++){var r=p.start(i)-this.bufferPadding,o=p.end(i)+this.bufferPadding;if(g>=r&&c<=o){u.time.push({startPTS:Math.max(e,p.start(i)),endPTS:Math.min(s,p.end(i))});break}else if(e<o&&s>r)u.partial=!0,u.time.push({startPTS:Math.max(e,p.start(i)),endPTS:Math.min(s,p.end(i))});else if(s<=r)break}return u},y.getPartialFragment=function(D){var E=null,m,p,u,e=0,s=this.bufferPadding,c=this.fragments;return Object.keys(c).forEach(function(g){var i=c[g];!i||R(i)&&(p=i.body.start-s,u=i.body.end+s,D>=p&&D<=u&&(m=Math.min(D-p,u-D),e<=m&&(E=i.body,e=m)))}),E},y.getState=function(D){var E=b(D),m=this.fragments[E];return m?m.buffered?R(m)?L.PARTIAL:L.OK:L.APPENDING:L.NOT_LOADED},y.isTimeBuffered=function(D,E,m){for(var p,u,e=0;e<m.length;e++){if(p=m.start(e)-this.bufferPadding,u=m.end(e)+this.bufferPadding,D>=p&&E<=u)return!0;if(E<=p)return!1}return!1},y.onFragLoaded=function(D,E){var m=E.frag,p=E.part;if(!(m.sn==="initSegment"||m.bitrateTest||p)){var u=b(m);this.fragments[u]={body:m,loaded:E,buffered:!1,range:Object.create(null)}}},y.onBufferAppended=function(D,E){var m=this,p=E.frag,u=E.part,e=E.timeRanges;if(p.type===_.PlaylistLevelType.MAIN)if(this.activeFragment=p,u){var s=this.activeParts;s||(this.activeParts=s=[]),s.push(u)}else this.activeParts=null;this.timeRanges=e,Object.keys(e).forEach(function(c){var g=e[c];if(m.detectEvictedFragments(c,g),!u)for(var i=0;i<g.length;i++)p.appendedPTS=Math.max(g.end(i),p.appendedPTS||0)})},y.onFragBuffered=function(D,E){this.detectPartialFragments(E)},y.hasFragment=function(D){var E=b(D);return!!this.fragments[E]},y.removeFragmentsInRange=function(D,E,m){var p=this;Object.keys(this.fragments).forEach(function(u){var e=p.fragments[u];if(!!e&&e.buffered){var s=e.body;s.type===m&&s.start<E&&s.end>D&&p.removeFragment(s)}})},y.removeFragment=function(D){var E=b(D);D.stats.loaded=0,D.clearElementaryStreamInfo(),delete this.fragments[E]},y.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},A}();function R(A){var y,x;return A.buffered&&(((y=A.range.video)===null||y===void 0?void 0:y.partial)||((x=A.range.audio)===null||x===void 0?void 0:x.partial))}function b(A){return A.type+"_"+A.level+"_"+A.urlId+"_"+A.sn}},"./src/controller/gap-controller.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"STALL_MINIMUM_DURATION_MS",function(){return R}),h.d(O,"MAX_START_GAP_JUMP",function(){return b}),h.d(O,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return A}),h.d(O,"SKIP_BUFFER_RANGE_START",function(){return y}),h.d(O,"default",function(){return x});var P=h("./src/utils/buffer-helper.ts"),_=h("./src/errors.ts"),L=h("./src/events.ts"),M=h("./src/utils/logger.ts"),R=250,b=2,A=.1,y=.05,x=function(){function D(m,p,u,e){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=m,this.media=p,this.fragmentTracker=u,this.hls=e}var E=D.prototype;return E.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},E.poll=function(p,u){var e=this.config,s=this.media,c=this.stalled;if(s!==null){var g=s.currentTime,i=s.seeking,r=this.seeking&&!i,o=!this.seeking&&i;if(this.seeking=i,g!==p){if(this.moved=!0,c!==null){if(this.stallReported){var d=self.performance.now()-c;M.logger.warn("playback not stuck anymore @"+g+", after "+Math.round(d)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((o||r)&&(this.stalled=null),!(s.paused&&!i||s.ended||s.playbackRate===0||!P.BufferHelper.getBuffered(s).length)){var t=P.BufferHelper.bufferInfo(s,g,0),n=t.len>0,l=t.nextStart||0;if(!(!n&&!l)){if(i){var a=t.len>b,f=!l||u&&u.start<=g||l-g>b&&!this.fragmentTracker.getPartialFragment(g);if(a||f)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var v,S=Math.max(l,t.start||0)-g,T=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,I=T==null||(v=T.details)===null||v===void 0?void 0:v.live,k=I?T.details.targetduration*2:b;if(S>0&&S<=k){this._trySkipBufferHole(null);return}}var B=self.performance.now();if(c===null){this.stalled=B;return}var N=B-c;if(!(!i&&N>=R&&(this._reportStall(t),!this.media))){var W=P.BufferHelper.bufferInfo(s,g,e.maxBufferHole);this._tryFixBufferStall(W,N)}}}}},E._tryFixBufferStall=function(p,u){var e=this.config,s=this.fragmentTracker,c=this.media;if(c!==null){var g=c.currentTime,i=s.getPartialFragment(g);if(i){var r=this._trySkipBufferHole(i);if(r||!this.media)return}p.len>e.maxBufferHole&&u>e.highBufferWatchdogPeriod*1e3&&(M.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},E._reportStall=function(p){var u=this.hls,e=this.media,s=this.stallReported;!s&&e&&(this.stallReported=!0,M.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer ("+JSON.stringify(p)+")"),u.trigger(L.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:p.len}))},E._trySkipBufferHole=function(p){var u=this.config,e=this.hls,s=this.media;if(s===null)return 0;for(var c=s.currentTime,g=0,i=P.BufferHelper.getBuffered(s),r=0;r<i.length;r++){var o=i.start(r);if(c+u.maxBufferHole>=g&&c<o){var d=Math.max(o+y,s.currentTime+A);return M.logger.warn("skipping hole, adjusting currentTime from "+c+" to "+d),this.moved=!0,this.stalled=null,s.currentTime=d,p&&e.trigger(L.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+c+" to "+d,frag:p}),d}g=i.end(r)}return 0},E._tryNudgeBuffer=function(){var p=this.config,u=this.hls,e=this.media,s=this.nudgeRetry;if(e!==null){var c=e.currentTime;if(this.nudgeRetry++,s<p.nudgeMaxRetry){var g=c+(s+1)*p.nudgeOffset;M.logger.warn("Nudging 'currentTime' from "+c+" to "+g),e.currentTime=g,u.trigger(L.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else M.logger.error("Playhead still not moving while enough data buffered @"+c+" after "+p.nudgeMaxRetry+" nudges"),u.trigger(L.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},D}()},"./src/controller/id3-track-controller.ts":function(U,O,h){"use strict";h.r(O);var P=h("./src/polyfills/number.ts"),_=h("./src/events.ts"),L=h("./src/utils/texttrack-utils.ts"),M=h("./src/demux/id3.ts"),R=h("./src/loader/date-range.ts"),b=h("./src/types/demuxer.ts"),A=.25;function y(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function x(m,p){return m.getTime()/1e3-p}function D(m){return Uint8Array.from(m.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var E=function(){function m(u){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=u,this._registerListeners()}var p=m.prototype;return p.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},p._registerListeners=function(){var e=this.hls;e.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(_.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},p._unregisterListeners=function(){var e=this.hls;e.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(_.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},p.onMediaAttached=function(e,s){this.media=s.media},p.onMediaDetaching=function(){!this.id3Track||(Object(L.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},p.onManifestLoading=function(){this.dateRangeCuesAppended={}},p.createTrack=function(e){var s=this.getID3Track(e.textTracks);return s.mode="hidden",s},p.getID3Track=function(e){if(!!this.media){for(var s=0;s<e.length;s++){var c=e[s];if(c.kind==="metadata"&&c.label==="id3")return Object(L.sendAddTrackEvent)(c,this.media),c}return this.media.addTextTrack("metadata","id3")}},p.onFragParsingMetadata=function(e,s){if(!!this.media){var c=this.hls.config,g=c.enableEmsgMetadataCues,i=c.enableID3MetadataCues;if(!(!g&&!i)){var r=s.frag,o=s.samples,d=s.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var t=d.edge||r.end,n=y(),l=!1,a={},f=0;f<o.length;f++){var v=o[f].type;if(!(v===b.MetadataSchema.emsg&&!g||!i)){var S=M.getID3Frames(o[f].data);if(S){var T=o[f].pts,I=t,k=I-T;k<=0&&(I=T+A);for(var B=0;B<S.length;B++){var N=S[B];if(!M.isTimeStampFrame(N)){var W=new n(T,I,"");W.value=N,v&&(W.type=v),this.id3Track.addCue(W),a[N.key]=null,l=!0}}}}}l&&this.updateId3CueEnds(a)}}},p.updateId3CueEnds=function(e){var s,c=(s=this.id3Track)===null||s===void 0?void 0:s.cues;if(c)for(var g=c.length;g--;){var i,r=c[g],o=(i=r.value)===null||i===void 0?void 0:i.key;if(o&&o in e){var d=e[o];d&&r.endTime!==d&&(r.endTime=d),e[o]=r.startTime}}},p.onBufferFlushing=function(e,s){var c=s.startOffset,g=s.endOffset,i=s.type,r=this.id3Track,o=this.hls;if(!!o){var d=o.config,t=d.enableEmsgMetadataCues,n=d.enableID3MetadataCues;if(r&&(t||n)){var l;i==="audio"?l=function(f){return f.type===b.MetadataSchema.audioId3&&n}:i==="video"?l=function(f){return f.type===b.MetadataSchema.emsg&&t}:l=function(f){return f.type===b.MetadataSchema.audioId3&&n||f.type===b.MetadataSchema.emsg&&t},Object(L.removeCuesInRange)(r,c,g,l)}}},p.onLevelUpdated=function(e,s){var c=this,g=s.details;if(!(!this.media||!g.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var i=this.dateRangeCuesAppended,r=this.id3Track,o=g.dateRanges,d=Object.keys(o);if(r)for(var t=Object.keys(i).filter(function(k){return!d.includes(k)}),n=function(B){var N=t[B];Object.keys(i[N].cues).forEach(function(W){r.removeCue(i[N].cues[W])}),delete i[N]},l=t.length;l--;)n(l);var a=g.fragments[g.fragments.length-1];if(!(d.length===0||!Object(P.isFiniteNumber)(a==null?void 0:a.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var f=a.programDateTime/1e3-a.start,v=g.edge||a.end,S=y(),T=function(B){var N=d[B],W=o[N],G=i[N],z=(G==null?void 0:G.cues)||{},Y=(G==null?void 0:G.durationKnown)||!1,$=x(W.startDate,f),Z=v,q=W.endDate;if(q)Z=x(q,f),Y=!0;else if(W.endOnNext&&!Y){var ie=d.reduce(function(re,Ee){var me=o[Ee];return me.class===W.class&&me.id!==Ee&&me.startDate>W.startDate&&re.push(me),re},[]).sort(function(re,Ee){return re.startDate.getTime()-Ee.startDate.getTime()})[0];ie&&(Z=x(ie.startDate,f),Y=!0)}for(var ne=Object.keys(W.attr),ae=0;ae<ne.length;ae++){var te=ne[ae];if(!(te===R.DateRangeAttribute.ID||te===R.DateRangeAttribute.CLASS||te===R.DateRangeAttribute.START_DATE||te===R.DateRangeAttribute.DURATION||te===R.DateRangeAttribute.END_DATE||te===R.DateRangeAttribute.END_ON_NEXT)){var fe=z[te];if(fe)Y&&!G.durationKnown&&(fe.endTime=Z);else{var de=W.attr[te];fe=new S($,Z,""),(te===R.DateRangeAttribute.SCTE35_OUT||te===R.DateRangeAttribute.SCTE35_IN)&&(de=D(de)),fe.value={key:te,data:de},fe.type=b.MetadataSchema.dateRange,c.id3Track.addCue(fe),z[te]=fe}}}i[N]={cues:z,dateRange:W,durationKnown:Y}},I=0;I<d.length;I++)T(I)}}},m}();O.default=E},"./src/controller/latency-controller.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return b});var P=h("./src/errors.ts"),_=h("./src/events.ts"),L=h("./src/utils/logger.ts");function M(A,y){for(var x=0;x<y.length;x++){var D=y[x];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(A,D.key,D)}}function R(A,y,x){return y&&M(A.prototype,y),x&&M(A,x),Object.defineProperty(A,"prototype",{writable:!1}),A}var b=function(){function A(x){var D=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return D.timeupdate()},this.hls=x,this.config=x.config,this.registerListeners()}var y=A.prototype;return y.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},y.registerListeners=function(){this.hls.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(_.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(_.Events.ERROR,this.onError,this)},y.unregisterListeners=function(){this.hls.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(_.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(_.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(_.Events.ERROR,this.onError)},y.onMediaAttached=function(D,E){this.media=E.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},y.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},y.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},y.onLevelUpdated=function(D,E){var m=E.details;this.levelDetails=m,m.advanced&&this.timeupdate(),!m.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},y.onError=function(D,E){E.details===P.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,L.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},y.timeupdate=function(){var D=this.media,E=this.levelDetails;if(!(!D||!E)){this.currentTime=D.currentTime;var m=this.computeLatency();if(m!==null){this._latency=m;var p=this.config,u=p.lowLatencyMode,e=p.maxLiveSyncPlaybackRate;if(!(!u||e===1)){var s=this.targetLatency;if(s!==null){var c=m-s,g=Math.min(this.maxLatency,s+E.targetduration),i=c<g;if(E.live&&i&&c>.05&&this.forwardBufferLength>1){var r=Math.min(2,Math.max(1,e)),o=Math.round(2/(1+Math.exp(-.75*c-this.edgeStalled))*20)/20;D.playbackRate=Math.min(r,Math.max(1,o))}else D.playbackRate!==1&&D.playbackRate!==0&&(D.playbackRate=1)}}}}},y.estimateLiveEdge=function(){var D=this.levelDetails;return D===null?null:D.edge+D.age},y.computeLatency=function(){var D=this.estimateLiveEdge();return D===null?null:D-this.currentTime},R(A,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var D=this.config,E=this.levelDetails;return D.liveMaxLatencyDuration!==void 0?D.liveMaxLatencyDuration:E?D.liveMaxLatencyDurationCount*E.targetduration:0}},{key:"targetLatency",get:function(){var D=this.levelDetails;if(D===null)return null;var E=D.holdBack,m=D.partHoldBack,p=D.targetduration,u=this.config,e=u.liveSyncDuration,s=u.liveSyncDurationCount,c=u.lowLatencyMode,g=this.hls.userConfig,i=c&&m||E;(g.liveSyncDuration||g.liveSyncDurationCount||i===0)&&(i=e!==void 0?e:s*p);var r=p,o=1;return i+Math.min(this.stallCount*o,r)}},{key:"liveSyncPosition",get:function(){var D=this.estimateLiveEdge(),E=this.targetLatency,m=this.levelDetails;if(D===null||E===null||m===null)return null;var p=m.edge,u=D-E-this.edgeStalled,e=p-m.totalduration,s=p-(this.config.lowLatencyMode&&m.partTarget||m.targetduration);return Math.min(Math.max(e,u),s)}},{key:"drift",get:function(){var D=this.levelDetails;return D===null?1:D.drift}},{key:"edgeStalled",get:function(){var D=this.levelDetails;if(D===null)return 0;var E=(this.config.lowLatencyMode&&D.partTarget||D.targetduration)*3;return Math.max(D.age-E,0)}},{key:"forwardBufferLength",get:function(){var D=this.media,E=this.levelDetails;if(!D||!E)return 0;var m=D.buffered.length;return(m?D.buffered.end(m-1):E.edge)-this.currentTime}}]),A}()},"./src/controller/level-controller.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return u});var P=h("./src/types/level.ts"),_=h("./src/events.ts"),L=h("./src/errors.ts"),M=h("./src/utils/codecs.ts"),R=h("./src/controller/level-helper.ts"),b=h("./src/controller/base-playlist-controller.ts"),A=h("./src/types/loader.ts");function y(){return y=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var c=arguments[s];for(var g in c)Object.prototype.hasOwnProperty.call(c,g)&&(e[g]=c[g])}return e},y.apply(this,arguments)}function x(e,s){for(var c=0;c<s.length;c++){var g=s[c];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(e,g.key,g)}}function D(e,s,c){return s&&x(e.prototype,s),c&&x(e,c),Object.defineProperty(e,"prototype",{writable:!1}),e}function E(e,s){e.prototype=Object.create(s.prototype),e.prototype.constructor=e,m(e,s)}function m(e,s){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,i){return g.__proto__=i,g},m(e,s)}var p=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),u=function(e){E(s,e);function s(g){var i;return i=e.call(this,g,"[level-controller]")||this,i._levels=[],i._firstLevel=-1,i._startLevel=void 0,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.onParsedComplete=void 0,i._registerListeners(),i}var c=s.prototype;return c._registerListeners=function(){var i=this.hls;i.on(_.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.on(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(_.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.on(_.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(_.Events.ERROR,this.onError,this)},c._unregisterListeners=function(){var i=this.hls;i.off(_.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.off(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(_.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.off(_.Events.FRAG_LOADED,this.onFragLoaded,this),i.off(_.Events.ERROR,this.onError,this)},c.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},c.startLoad=function(){var i=this._levels;i.forEach(function(r){r.loadError=0}),e.prototype.startLoad.call(this)},c.onManifestLoaded=function(i,r){var o=[],d=[],t=[],n,l={},a,f=!1,v=!1,S=!1;if(r.levels.forEach(function(B){var N=B.attrs;f=f||!!(B.width&&B.height),v=v||!!B.videoCodec,S=S||!!B.audioCodec,p&&B.audioCodec&&B.audioCodec.indexOf("mp4a.40.34")!==-1&&(B.audioCodec=void 0);var W=B.bitrate+"-"+B.attrs.RESOLUTION+"-"+B.attrs.CODECS;a=l[W],a?a.url.push(B.url):(a=new P.Level(B),l[W]=a,o.push(a)),N&&(N.AUDIO&&Object(R.addGroupId)(a,"audio",N.AUDIO),N.SUBTITLES&&Object(R.addGroupId)(a,"text",N.SUBTITLES))}),(f||v)&&S&&(o=o.filter(function(B){var N=B.videoCodec,W=B.width,G=B.height;return!!N||!!(W&&G)})),o=o.filter(function(B){var N=B.audioCodec,W=B.videoCodec;return(!N||Object(M.isCodecSupportedInMp4)(N,"audio"))&&(!W||Object(M.isCodecSupportedInMp4)(W,"video"))}),r.audioTracks&&(d=r.audioTracks.filter(function(B){return!B.audioCodec||Object(M.isCodecSupportedInMp4)(B.audioCodec,"audio")}),Object(R.assignTrackIdsByGroup)(d)),r.subtitles&&(t=r.subtitles,Object(R.assignTrackIdsByGroup)(t)),o.length>0){n=o[0].bitrate,o.sort(function(B,N){return B.bitrate-N.bitrate}),this._levels=o;for(var T=0;T<o.length;T++)if(o[T].bitrate===n){this._firstLevel=T,this.log("manifest loaded, "+o.length+" level(s) found, first bitrate: "+n);break}var I=S&&!v,k={levels:o,audioTracks:d,subtitleTracks:t,firstLevel:this._firstLevel,stats:r.stats,audio:S,video:v,altAudio:!I&&d.some(function(B){return!!B.url})};this.hls.trigger(_.Events.MANIFEST_PARSED,k),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(_.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:r.url,reason:"no level with compatible codecs found in manifest"})},c.onError=function(i,r){var o;if(e.prototype.onError.call(this,i,r),!r.fatal){var d=r.context,t=this._levels[this.currentLevelIndex];if(d&&(d.type===A.PlaylistContextType.AUDIO_TRACK&&t.audioGroupIds&&d.groupId===t.audioGroupIds[t.urlId]||d.type===A.PlaylistContextType.SUBTITLE_TRACK&&t.textGroupIds&&d.groupId===t.textGroupIds[t.urlId])){this.redundantFailover(this.currentLevelIndex);return}var n=!1,l=!0,a;switch(r.details){case L.ErrorDetails.FRAG_LOAD_ERROR:case L.ErrorDetails.FRAG_LOAD_TIMEOUT:case L.ErrorDetails.KEY_LOAD_ERROR:case L.ErrorDetails.KEY_LOAD_TIMEOUT:if(r.frag){var f=r.frag.type===A.PlaylistLevelType.MAIN?r.frag.level:this.currentLevelIndex,v=this._levels[f];v?(v.fragmentError++,v.fragmentError>this.hls.config.fragLoadingMaxRetry&&(a=f)):a=f}break;case L.ErrorDetails.LEVEL_LOAD_ERROR:case L.ErrorDetails.LEVEL_LOAD_TIMEOUT:d&&(d.deliveryDirectives&&(l=!1),a=d.level),n=!0;break;case L.ErrorDetails.REMUX_ALLOC_ERROR:a=(o=r.level)!=null?o:this.currentLevelIndex,n=!0;break}a!==void 0&&this.recoverLevel(r,a,n,l)}},c.recoverLevel=function(i,r,o,d){var t=i.details,n=this._levels[r];if(n.loadError++,o){var l=this.retryLoadingOrFail(i);if(l)i.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(d){var a=n.url.length;if(a>1&&n.loadError<a)i.levelRetry=!0,this.redundantFailover(r);else if(this.manualLevelIndex===-1){for(var f=-1,v=this._levels,S=v.length;S--;){var T=(S+this.currentLevelIndex)%v.length;if(T!==this.currentLevelIndex&&v[T].loadError===0){f=T;break}}f>-1&&this.currentLevelIndex!==f&&(this.warn(t+": switch to "+f),i.levelRetry=!0,this.hls.nextAutoLevel=f)}}},c.redundantFailover=function(i){var r=this._levels[i],o=r.url.length;if(o>1){var d=(r.urlId+1)%o;this.warn("Switching to redundant URL-id "+d),this._levels.forEach(function(t){t.urlId=d}),this.level=i}},c.onFragLoaded=function(i,r){var o=r.frag;if(o!==void 0&&o.type===A.PlaylistLevelType.MAIN){var d=this._levels[o.level];d!==void 0&&(d.fragmentError=0,d.loadError=0)}},c.onLevelLoaded=function(i,r){var o,d=r.level,t=r.details,n=this._levels[d];if(!n){var l;this.warn("Invalid level index "+d),(l=r.deliveryDirectives)!==null&&l!==void 0&&l.skip&&(t.deltaUpdateFailed=!0);return}d===this.currentLevelIndex?(n.fragmentError===0&&(n.loadError=0,this.retryCount=0),this.playlistLoaded(d,r,n.details)):(o=r.deliveryDirectives)!==null&&o!==void 0&&o.skip&&(t.deltaUpdateFailed=!0)},c.onAudioTrackSwitched=function(i,r){var o=this.hls.levels[this.currentLevelIndex];if(!!o&&o.audioGroupIds){for(var d=-1,t=this.hls.audioTracks[r.id].groupId,n=0;n<o.audioGroupIds.length;n++)if(o.audioGroupIds[n]===t){d=n;break}d!==o.urlId&&(o.urlId=d,this.startLoad())}},c.loadPlaylist=function(i){var r=this.currentLevelIndex,o=this._levels[r];if(this.canLoad&&o&&o.url.length>0){var d=o.urlId,t=o.url[d];if(i)try{t=i.addDirectives(t)}catch(n){this.warn("Could not construct new URL with HLS Delivery Directives: "+n)}this.log("Attempt loading level index "+r+(i?" at sn "+i.msn+" part "+i.part:"")+" with URL-id "+d+" "+t),this.clearTimer(),this.hls.trigger(_.Events.LEVEL_LOADING,{url:t,level:r,id:d,deliveryDirectives:i||null})}},c.removeLevel=function(i,r){var o=function(n,l){return l!==r},d=this._levels.filter(function(t,n){return n!==i?!0:t.url.length>1&&r!==void 0?(t.url=t.url.filter(o),t.audioGroupIds&&(t.audioGroupIds=t.audioGroupIds.filter(o)),t.textGroupIds&&(t.textGroupIds=t.textGroupIds.filter(o)),t.urlId=0,!0):!1}).map(function(t,n){var l=t.details;return l!=null&&l.fragments&&l.fragments.forEach(function(a){a.level=n}),t});this._levels=d,this.hls.trigger(_.Events.LEVELS_UPDATED,{levels:d})},D(s,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(i){var r,o=this._levels;if(o.length!==0&&!(this.currentLevelIndex===i&&(r=o[i])!==null&&r!==void 0&&r.details)){if(i<0||i>=o.length){var d=i<0;if(this.hls.trigger(_.Events.ERROR,{type:L.ErrorTypes.OTHER_ERROR,details:L.ErrorDetails.LEVEL_SWITCH_ERROR,level:i,fatal:d,reason:"invalid level idx"}),d)return;i=Math.min(i,o.length-1)}this.clearTimer();var t=this.currentLevelIndex,n=o[t],l=o[i];this.log("switching to level "+i+" from "+t),this.currentLevelIndex=i;var a=y({},l,{level:i,maxBitrate:l.maxBitrate,uri:l.uri,urlId:l.urlId});delete a._urlId,this.hls.trigger(_.Events.LEVEL_SWITCHING,a);var f=l.details;if(!f||f.live){var v=this.switchParams(l.uri,n==null?void 0:n.details);this.loadPlaylist(v)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(i){this.manualLevelIndex=i,this._startLevel===void 0&&(this._startLevel=i),i!==-1&&(this.level=i)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(i){this._firstLevel=i}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var i=this.hls.config.startLevel;return i!==void 0?i:this._firstLevel}else return this._startLevel},set:function(i){this._startLevel=i}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(i){this.level=i,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=i)}}]),s}(b.default)},"./src/controller/level-helper.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"addGroupId",function(){return R}),h.d(O,"assignTrackIdsByGroup",function(){return b}),h.d(O,"updatePTS",function(){return A}),h.d(O,"updateFragPTSDTS",function(){return x}),h.d(O,"mergeDetails",function(){return D}),h.d(O,"mapPartIntersection",function(){return m}),h.d(O,"mapFragmentIntersection",function(){return p}),h.d(O,"adjustSliding",function(){return u}),h.d(O,"addSliding",function(){return e}),h.d(O,"computeReloadInterval",function(){return s}),h.d(O,"getFragmentWithSN",function(){return c}),h.d(O,"getPartWith",function(){return g});var P=h("./src/polyfills/number.ts"),_=h("./src/utils/logger.ts"),L=h("./src/loader/date-range.ts");function M(){return M=Object.assign?Object.assign.bind():function(i){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var d in o)Object.prototype.hasOwnProperty.call(o,d)&&(i[d]=o[d])}return i},M.apply(this,arguments)}function R(i,r,o){switch(r){case"audio":i.audioGroupIds||(i.audioGroupIds=[]),i.audioGroupIds.push(o);break;case"text":i.textGroupIds||(i.textGroupIds=[]),i.textGroupIds.push(o);break}}function b(i){var r={};i.forEach(function(o){var d=o.groupId||"";o.id=r[d]=r[d]||0,r[d]++})}function A(i,r,o){var d=i[r],t=i[o];y(d,t)}function y(i,r){var o=r.startPTS;if(Object(P.isFiniteNumber)(o)){var d=0,t;r.sn>i.sn?(d=o-i.start,t=i):(d=i.start-o,t=r),t.duration!==d&&(t.duration=d)}else if(r.sn>i.sn){var n=i.cc===r.cc;n&&i.minEndPTS?r.start=i.start+(i.minEndPTS-i.start):r.start=i.start+i.duration}else r.start=Math.max(i.start-r.duration,0)}function x(i,r,o,d,t,n){var l=d-o;l<=0&&(_.logger.warn("Fragment should have a positive duration",r),d=o+r.duration,n=t+r.duration);var a=o,f=d,v=r.startPTS,S=r.endPTS;if(Object(P.isFiniteNumber)(v)){var T=Math.abs(v-o);Object(P.isFiniteNumber)(r.deltaPTS)?r.deltaPTS=Math.max(T,r.deltaPTS):r.deltaPTS=T,a=Math.max(o,v),o=Math.min(o,v),t=Math.min(t,r.startDTS),f=Math.min(d,S),d=Math.max(d,S),n=Math.max(n,r.endDTS)}r.duration=d-o;var I=o-r.start;r.appendedPTS=d,r.start=r.startPTS=o,r.maxStartPTS=a,r.startDTS=t,r.endPTS=d,r.minEndPTS=f,r.endDTS=n;var k=r.sn;if(!i||k<i.startSN||k>i.endSN)return 0;var B,N=k-i.startSN,W=i.fragments;for(W[N]=r,B=N;B>0;B--)y(W[B],W[B-1]);for(B=N;B<W.length-1;B++)y(W[B],W[B+1]);return i.fragmentHint&&y(W[W.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,I}function D(i,r){for(var o=null,d=i.fragments,t=d.length-1;t>=0;t--){var n=d[t].initSegment;if(n){o=n;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;var l=0,a;if(p(i,r,function(B,N){B.relurl&&(l=B.cc-N.cc),Object(P.isFiniteNumber)(B.startPTS)&&Object(P.isFiniteNumber)(B.endPTS)&&(N.start=N.startPTS=B.startPTS,N.startDTS=B.startDTS,N.appendedPTS=B.appendedPTS,N.maxStartPTS=B.maxStartPTS,N.endPTS=B.endPTS,N.endDTS=B.endDTS,N.minEndPTS=B.minEndPTS,N.duration=B.endPTS-B.startPTS,N.duration&&(a=N),r.PTSKnown=r.alignedSliding=!0),N.elementaryStreams=B.elementaryStreams,N.loader=B.loader,N.stats=B.stats,N.urlId=B.urlId,B.initSegment&&(N.initSegment=B.initSegment,o=B.initSegment)}),o){var f=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;f.forEach(function(B){var N;(!B.initSegment||B.initSegment.relurl===((N=o)===null||N===void 0?void 0:N.relurl))&&(B.initSegment=o)})}if(r.skippedSegments)if(r.deltaUpdateFailed=r.fragments.some(function(B){return!B}),r.deltaUpdateFailed){_.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var v=r.skippedSegments;v--;)r.fragments.shift();r.startSN=r.fragments[0].sn,r.startCC=r.fragments[0].cc}else r.canSkipDateRanges&&(r.dateRanges=E(i.dateRanges,r.dateRanges,r.recentlyRemovedDateranges));var S=r.fragments;if(l){_.logger.warn("discontinuity sliding from playlist, take drift into account");for(var T=0;T<S.length;T++)S[T].cc+=l}r.skippedSegments&&(r.startCC=r.fragments[0].cc),m(i.partList,r.partList,function(B,N){N.elementaryStreams=B.elementaryStreams,N.stats=B.stats}),a?x(r,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS):u(i,r),S.length&&(r.totalduration=r.edge-S[0].start),r.driftStartTime=i.driftStartTime,r.driftStart=i.driftStart;var I=r.advancedDateTime;if(r.advanced&&I){var k=r.edge;r.driftStart||(r.driftStartTime=I,r.driftStart=k),r.driftEndTime=I,r.driftEnd=k}else r.driftEndTime=i.driftEndTime,r.driftEnd=i.driftEnd,r.advancedDateTime=i.advancedDateTime}function E(i,r,o){var d=M({},i);return o&&o.forEach(function(t){delete d[t]}),Object.keys(r).forEach(function(t){var n=new L.DateRange(r[t].attr,d[t]);n.isValid?d[t]=n:_.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(r[t].attr)+'"')}),d}function m(i,r,o){if(i&&r)for(var d=0,t=0,n=i.length;t<=n;t++){var l=i[t],a=r[t+d];l&&a&&l.index===a.index&&l.fragment.sn===a.fragment.sn?o(l,a):d--}}function p(i,r,o){for(var d=r.skippedSegments,t=Math.max(i.startSN,r.startSN)-r.startSN,n=(i.fragmentHint?1:0)+(d?r.endSN:Math.min(i.endSN,r.endSN))-r.startSN,l=r.startSN-i.startSN,a=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments,f=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments,v=t;v<=n;v++){var S=f[l+v],T=a[v];d&&!T&&v<d&&(T=r.fragments[v]=S),S&&T&&o(S,T)}}function u(i,r){var o=r.startSN+r.skippedSegments-i.startSN,d=i.fragments;o<0||o>=d.length||e(r,d[o].start)}function e(i,r){if(r){for(var o=i.fragments,d=i.skippedSegments;d<o.length;d++)o[d].start+=r;i.fragmentHint&&(i.fragmentHint.start+=r)}}function s(i,r){var o=1e3*i.levelTargetDuration,d=o/2,t=i.age,n=t>0&&t<o*3,l=r.loading.end-r.loading.start,a,f=i.availabilityDelay;if(i.updated===!1)if(n){var v=333*i.misses;a=Math.max(Math.min(d,l*2),v),i.availabilityDelay=(i.availabilityDelay||0)+a}else a=d;else n?(f=Math.min(f||o/2,t),i.availabilityDelay=f,a=f+o-t):a=o-l;return Math.round(a)}function c(i,r,o){if(!i||!i.details)return null;var d=i.details,t=d.fragments[r-d.startSN];return t||(t=d.fragmentHint,t&&t.sn===r)?t:r<d.startSN&&o&&o.sn===r?o:null}function g(i,r,o){if(!i||!i.details)return null;var d=i.details.partList;if(d)for(var t=d.length;t--;){var n=d[t];if(n.index===o&&n.fragment.sn===r)return n}return null}},"./src/controller/stream-controller.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return g});var P=h("./src/polyfills/number.ts"),_=h("./src/controller/base-stream-controller.ts"),L=h("./src/is-supported.ts"),M=h("./src/events.ts"),R=h("./src/utils/buffer-helper.ts"),b=h("./src/controller/fragment-tracker.ts"),A=h("./src/types/loader.ts"),y=h("./src/loader/fragment.ts"),x=h("./src/demux/transmuxer-interface.ts"),D=h("./src/types/transmuxer.ts"),E=h("./src/controller/gap-controller.ts"),m=h("./src/errors.ts");function p(i,r){for(var o=0;o<r.length;o++){var d=r[o];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(i,d.key,d)}}function u(i,r,o){return r&&p(i.prototype,r),o&&p(i,o),Object.defineProperty(i,"prototype",{writable:!1}),i}function e(i,r){i.prototype=Object.create(r.prototype),i.prototype.constructor=i,s(i,r)}function s(i,r){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,t){return d.__proto__=t,d},s(i,r)}var c=100,g=function(i){e(r,i);function r(d,t){var n;return n=i.call(this,d,t,"[stream-controller]")||this,n.audioCodecSwap=!1,n.gapController=null,n.level=-1,n._forceStartLoad=!1,n.altAudio=!1,n.audioOnly=!1,n.fragPlaying=null,n.onvplaying=null,n.onvseeked=null,n.fragLastKbps=0,n.couldBacktrack=!1,n.backtrackFragment=null,n.audioCodecSwitch=!1,n.videoBuffer=null,n._registerListeners(),n}var o=r.prototype;return o._registerListeners=function(){var t=this.hls;t.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(M.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(M.Events.ERROR,this.onError,this),t.on(M.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(M.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(M.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(M.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(M.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(M.Events.FRAG_BUFFERED,this.onFragBuffered,this)},o._unregisterListeners=function(){var t=this.hls;t.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(M.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(M.Events.ERROR,this.onError,this),t.off(M.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(M.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(M.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(M.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(M.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(M.Events.FRAG_BUFFERED,this.onFragBuffered,this)},o.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},o.startLoad=function(t){if(this.levels){var n=this.lastCurrentTime,l=this.hls;if(this.stopLoad(),this.setInterval(c),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var a=l.startLevel;a===-1&&(l.config.testBandwidth&&this.levels.length>1?(a=0,this.bitrateTest=!0):a=l.nextAutoLevel),this.level=l.nextLoadLevel=a,this.loadedmetadata=!1}n>0&&t===-1&&(this.log("Override startPosition with lastCurrentTime @"+n.toFixed(3)),t=n),this.state=_.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=_.State.STOPPED},o.stopLoad=function(){this._forceStartLoad=!1,i.prototype.stopLoad.call(this)},o.doTick=function(){switch(this.state){case _.State.IDLE:this.doTickIdle();break;case _.State.WAITING_LEVEL:{var t,n=this.levels,l=this.level,a=n==null||(t=n[l])===null||t===void 0?void 0:t.details;if(a&&(!a.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(a))break;this.state=_.State.IDLE;break}break}case _.State.FRAG_LOADING_WAITING_RETRY:{var f,v=self.performance.now(),S=this.retryDate;(!S||v>=S||(f=this.media)!==null&&f!==void 0&&f.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=_.State.IDLE)}break;default:break}this.onTickEnd()},o.onTickEnd=function(){i.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},o.doTickIdle=function(){var t,n,l=this.hls,a=this.levelLastLoaded,f=this.levels,v=this.media,S=l.config,T=l.nextLoadLevel;if(!(a===null||!v&&(this.startFragRequested||!S.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!f||!f[T])){var I=f[T];this.level=l.nextLoadLevel=T;var k=I.details;if(!k||this.state===_.State.WAITING_LEVEL||k.live&&this.levelLastLoaded!==T){this.state=_.State.WAITING_LEVEL;return}var B=this.getMainFwdBufferInfo();if(B!==null){var N=B.len,W=this.getMaxBufferLength(I.maxBitrate);if(!(N>=W)){if(this._streamEnded(B,k)){var G={};this.altAudio&&(G.type="video"),this.hls.trigger(M.Events.BUFFER_EOS,G),this.state=_.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>B.end&&(this.backtrackFragment=null);var z=this.backtrackFragment?this.backtrackFragment.start:B.end,Y=this.getNextFragment(z,k);if(this.couldBacktrack&&!this.fragPrevious&&Y&&Y.sn!=="initSegment"&&this.fragmentTracker.getState(Y)!==b.FragmentState.OK){var $,Z=(($=this.backtrackFragment)!=null?$:Y).sn,q=Z-k.startSN,ie=k.fragments[q-1];ie&&Y.cc===ie.cc&&(Y=ie,this.fragmentTracker.removeFragment(ie))}else this.backtrackFragment&&B.len&&(this.backtrackFragment=null);if(Y&&this.fragmentTracker.getState(Y)===b.FragmentState.OK&&this.nextLoadPosition>z){var ne=this.audioOnly&&!this.altAudio?y.ElementaryStreamTypes.AUDIO:y.ElementaryStreamTypes.VIDEO;v&&this.afterBufferFlushed(v,ne,A.PlaylistLevelType.MAIN),Y=this.getNextFragment(this.nextLoadPosition,k)}!Y||(Y.initSegment&&!Y.initSegment.data&&!this.bitrateTest&&(Y=Y.initSegment),((t=Y.decryptdata)===null||t===void 0?void 0:t.keyFormat)==="identity"&&!((n=Y.decryptdata)!==null&&n!==void 0&&n.key)?this.loadKey(Y,k):this.loadFragment(Y,k,z))}}}},o.loadFragment=function(t,n,l){var a,f=this.fragmentTracker.getState(t);this.fragCurrent=t,f===b.FragmentState.NOT_LOADED?t.sn==="initSegment"?this._loadInitSegment(t):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t)):(this.startFragRequested=!0,i.prototype.loadFragment.call(this,t,n,l)):f===b.FragmentState.APPENDING?this.reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t):((a=this.media)===null||a===void 0?void 0:a.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},o.getAppendedFrag=function(t){var n=this.fragmentTracker.getAppendedFrag(t,A.PlaylistLevelType.MAIN);return n&&"fragment"in n?n.fragment:n},o.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,A.PlaylistLevelType.MAIN)},o.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},o.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},o.nextLevelSwitch=function(){var t=this.levels,n=this.media;if(n!=null&&n.readyState){var l,a=this.getAppendedFrag(n.currentTime);if(a&&a.start>1&&this.flushMainBuffer(0,a.start-1),!n.paused&&t){var f=this.hls.nextLoadLevel,v=t[f],S=this.fragLastKbps;S&&this.fragCurrent?l=this.fragCurrent.duration*v.maxBitrate/(1e3*S)+1:l=0}else l=0;var T=this.getBufferedFrag(n.currentTime+l);if(T){var I=this.followingBufferedFrag(T);if(I){this.abortCurrentFrag();var k=I.maxStartPTS?I.maxStartPTS:I.start,B=I.duration,N=Math.max(T.end,k+Math.min(Math.max(B-this.config.maxFragLookUpTolerance,B*.5),B*.75));this.flushMainBuffer(N,Number.POSITIVE_INFINITY)}}}},o.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t!=null&&t.loader&&t.loader.abort(),this.state){case _.State.KEY_LOADING:case _.State.FRAG_LOADING:case _.State.FRAG_LOADING_WAITING_RETRY:case _.State.PARSING:case _.State.PARSED:this.state=_.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},o.flushMainBuffer=function(t,n){i.prototype.flushMainBuffer.call(this,t,n,this.altAudio?"video":null)},o.onMediaAttached=function(t,n){i.prototype.onMediaAttached.call(this,t,n);var l=n.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),l.addEventListener("playing",this.onvplaying),l.addEventListener("seeked",this.onvseeked),this.gapController=new E.default(this.config,l,this.fragmentTracker,this.hls)},o.onMediaDetaching=function(){var t=this.media;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),i.prototype.onMediaDetaching.call(this)},o.onMediaPlaying=function(){this.tick()},o.onMediaSeeked=function(){var t=this.media,n=t?t.currentTime:null;Object(P.isFiniteNumber)(n)&&this.log("Media seeked to "+n.toFixed(3)),this.tick()},o.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(M.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},o.onManifestParsed=function(t,n){var l=!1,a=!1,f;n.levels.forEach(function(v){f=v.audioCodec,f&&(f.indexOf("mp4a.40.2")!==-1&&(l=!0),f.indexOf("mp4a.40.5")!==-1&&(a=!0))}),this.audioCodecSwitch=l&&a&&!Object(L.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=n.levels,this.startFragRequested=!1},o.onLevelLoading=function(t,n){var l=this.levels;if(!(!l||this.state!==_.State.IDLE)){var a=l[n.level];(!a.details||a.details.live&&this.levelLastLoaded!==n.level||this.waitForCdnTuneIn(a.details))&&(this.state=_.State.WAITING_LEVEL)}},o.onLevelLoaded=function(t,n){var l,a=this.levels,f=n.level,v=n.details,S=v.totalduration;if(!a){this.warn("Levels were reset while loading level "+f);return}this.log("Level "+f+" loaded ["+v.startSN+","+v.endSN+"], cc ["+v.startCC+", "+v.endCC+"] duration:"+S);var T=this.fragCurrent;T&&(this.state===_.State.FRAG_LOADING||this.state===_.State.FRAG_LOADING_WAITING_RETRY)&&T.level!==n.level&&T.loader&&(this.state=_.State.IDLE,this.backtrackFragment=null,T.loader.abort());var I=a[f],k=0;if(v.live||(l=I.details)!==null&&l!==void 0&&l.live){if(v.fragments[0]||(v.deltaUpdateFailed=!0),v.deltaUpdateFailed)return;k=this.alignPlaylists(v,I.details)}if(I.details=v,this.levelLastLoaded=f,this.hls.trigger(M.Events.LEVEL_UPDATED,{details:v,level:f}),this.state===_.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(v))return;this.state=_.State.IDLE}this.startFragRequested?v.live&&this.synchronizeToLiveEdge(v):this.setStartPosition(v,k),this.tick()},o._handleFragmentLoadProgress=function(t){var n,l=t.frag,a=t.part,f=t.payload,v=this.levels;if(!v){this.warn("Levels were reset while fragment load was in progress. Fragment "+l.sn+" of level "+l.level+" will not be buffered");return}var S=v[l.level],T=S.details;if(!T){this.warn("Dropping fragment "+l.sn+" of level "+l.level+" after level details were reset");return}var I=S.videoCodec,k=T.PTSKnown||!T.live,B=(n=l.initSegment)===null||n===void 0?void 0:n.data,N=this._getAudioCodec(S),W=this.transmuxer=this.transmuxer||new x.default(this.hls,A.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),G=a?a.index:-1,z=G!==-1,Y=new D.ChunkMetadata(l.level,l.sn,l.stats.chunkCount,f.byteLength,G,z),$=this.initPTS[l.cc];W.push(f,B,N,I,l,a,T.totalduration,k,Y,$)},o.onAudioTrackSwitching=function(t,n){var l=this.altAudio,a=!!n.url,f=n.id;if(!a){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var v=this.fragCurrent;v!=null&&v.loader&&(this.log("Switching to main audio track, cancel main fragment load"),v.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var S=this.hls;l&&S.trigger(M.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),S.trigger(M.Events.AUDIO_TRACK_SWITCHED,{id:f})}},o.onAudioTrackSwitched=function(t,n){var l=n.id,a=!!this.hls.audioTracks[l].url;if(a){var f=this.videoBuffer;f&&this.mediaBuffer!==f&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=f)}this.altAudio=a,this.tick()},o.onBufferCreated=function(t,n){var l=n.tracks,a,f,v=!1;for(var S in l){var T=l[S];if(T.id==="main"){if(f=S,a=T,S==="video"){var I=l[S];I&&(this.videoBuffer=I.buffer)}}else v=!0}v&&a?(this.log("Alternate track found, use "+f+".buffered to schedule main fragment loading"),this.mediaBuffer=a.buffer):this.mediaBuffer=this.media},o.onFragBuffered=function(t,n){var l=n.frag,a=n.part;if(!(l&&l.type!==A.PlaylistLevelType.MAIN)){if(this.fragContextChanged(l)){this.warn("Fragment "+l.sn+(a?" p: "+a.index:"")+" of level "+l.level+" finished buffering, but was aborted. state: "+this.state),this.state===_.State.PARSED&&(this.state=_.State.IDLE);return}var f=a?a.stats:l.stats;this.fragLastKbps=Math.round(8*f.total/(f.buffering.end-f.loading.first)),l.sn!=="initSegment"&&(this.fragPrevious=l),this.fragBufferedComplete(l,a)}},o.onError=function(t,n){switch(n.details){case m.ErrorDetails.FRAG_LOAD_ERROR:case m.ErrorDetails.FRAG_LOAD_TIMEOUT:case m.ErrorDetails.KEY_LOAD_ERROR:case m.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(A.PlaylistLevelType.MAIN,n);break;case m.ErrorDetails.LEVEL_LOAD_ERROR:case m.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==_.State.ERROR&&(n.fatal?(this.warn(""+n.details),this.state=_.State.ERROR):!n.levelRetry&&this.state===_.State.WAITING_LEVEL&&(this.state=_.State.IDLE));break;case m.ErrorDetails.BUFFER_FULL_ERROR:if(n.parent==="main"&&(this.state===_.State.PARSING||this.state===_.State.PARSED)){var l=!0,a=this.getFwdBufferInfo(this.media,A.PlaylistLevelType.MAIN);a&&a.len>.5&&(l=!this.reduceMaxBufferLength(a.len)),l&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break;default:break}},o.checkBuffer=function(){var t=this.media,n=this.gapController;if(!(!t||!n||!t.readyState)){if(this.loadedmetadata||!R.BufferHelper.getBuffered(t).length){var l=this.state!==_.State.IDLE?this.fragCurrent:null;n.poll(this.lastCurrentTime,l)}this.lastCurrentTime=t.currentTime}},o.onFragLoadEmergencyAborted=function(){this.state=_.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},o.onBufferFlushed=function(t,n){var l=n.type;if(l!==y.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var a=(l===y.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(a,l,A.PlaylistLevelType.MAIN)}},o.onLevelsUpdated=function(t,n){this.levels=n.levels},o.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},o.seekToStartPos=function(){var t=this.media;if(!!t){var n=t.currentTime,l=this.startPosition;if(l>=0&&n<l){if(t.seeking){this.log("could not seek to "+l+", already seeking at "+n);return}var a=R.BufferHelper.getBuffered(t),f=a.length?a.start(0):0,v=f-l;v>0&&(v<this.config.maxBufferHole||v<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+v+" to match buffer start"),l+=v,this.startPosition=l),this.log("seek to target start position "+l+" from current time "+n),t.currentTime=l}}},o._getAudioCodec=function(t){var n=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&n&&(this.log("Swapping audio codec"),n.indexOf("mp4a.40.5")!==-1?n="mp4a.40.2":n="mp4a.40.5"),n},o._loadBitrateTestFrag=function(t){var n=this;t.bitrateTest=!0,this._doFragLoad(t).then(function(l){var a=n.hls;if(!(!l||a.nextLoadLevel||n.fragContextChanged(t))){n.fragLoadError=0,n.state=_.State.IDLE,n.startFragRequested=!1,n.bitrateTest=!1;var f=t.stats;f.parsing.start=f.parsing.end=f.buffering.start=f.buffering.end=self.performance.now(),a.trigger(M.Events.FRAG_LOADED,l),t.bitrateTest=!1}})},o._handleTransmuxComplete=function(t){var n,l="main",a=this.hls,f=t.remuxResult,v=t.chunkMeta,S=this.getCurrentContext(v);if(!S){this.warn("The loading context changed while buffering fragment "+v.sn+" of level "+v.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(v.level);return}var T=S.frag,I=S.part,k=S.level,B=f.video,N=f.text,W=f.id3,G=f.initSegment,z=k.details,Y=this.altAudio?void 0:f.audio;if(!this.fragContextChanged(T)){if(this.state=_.State.PARSING,G){G.tracks&&(this._bufferInitSegment(k,G.tracks,T,v),a.trigger(M.Events.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:l,tracks:G.tracks}));var $=G.initPTS,Z=G.timescale;Object(P.isFiniteNumber)($)&&(this.initPTS[T.cc]=$,a.trigger(M.Events.INIT_PTS_FOUND,{frag:T,id:l,initPTS:$,timescale:Z}))}if(B&&f.independent!==!1){if(z){var q=B.startPTS,ie=B.endPTS,ne=B.startDTS,ae=B.endDTS;if(I)I.elementaryStreams[B.type]={startPTS:q,endPTS:ie,startDTS:ne,endDTS:ae};else if(B.firstKeyFrame&&B.independent&&(this.couldBacktrack=!0),B.dropped&&B.independent){var te=this.getMainFwdBufferInfo(),fe=(te?te.end:this.getLoadPosition())+this.config.maxBufferHole,de=B.firstKeyFramePTS?B.firstKeyFramePTS:q;if(fe<de-this.config.maxBufferHole){this.backtrack(T);return}T.setElementaryStreamInfo(B.type,T.start,ie,T.start,ae,!0)}T.setElementaryStreamInfo(B.type,q,ie,ne,ae),this.backtrackFragment&&(this.backtrackFragment=T),this.bufferFragmentData(B,T,I,v)}}else if(f.independent===!1){this.backtrack(T);return}if(Y){var re=Y.startPTS,Ee=Y.endPTS,me=Y.startDTS,Te=Y.endDTS;I&&(I.elementaryStreams[y.ElementaryStreamTypes.AUDIO]={startPTS:re,endPTS:Ee,startDTS:me,endDTS:Te}),T.setElementaryStreamInfo(y.ElementaryStreamTypes.AUDIO,re,Ee,me,Te),this.bufferFragmentData(Y,T,I,v)}if(z&&W!==null&&W!==void 0&&(n=W.samples)!==null&&n!==void 0&&n.length){var Me={id:l,frag:T,details:z,samples:W.samples};a.trigger(M.Events.FRAG_PARSING_METADATA,Me)}if(z&&N){var _e={id:l,frag:T,details:z,samples:N.samples};a.trigger(M.Events.FRAG_PARSING_USERDATA,_e)}}},o._bufferInitSegment=function(t,n,l,a){var f=this;if(this.state===_.State.PARSING){this.audioOnly=!!n.audio&&!n.video,this.altAudio&&!this.audioOnly&&delete n.audio;var v=n.audio,S=n.video,T=n.audiovideo;if(v){var I=t.audioCodec,k=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(I&&(I.indexOf("mp4a.40.5")!==-1?I="mp4a.40.2":I="mp4a.40.5"),v.metadata.channelCount!==1&&k.indexOf("firefox")===-1&&(I="mp4a.40.5")),k.indexOf("android")!==-1&&v.container!=="audio/mpeg"&&(I="mp4a.40.2",this.log("Android: force audio codec to "+I)),t.audioCodec&&t.audioCodec!==I&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+I+'"'),v.levelCodec=I,v.id="main",this.log("Init audio buffer, container:"+v.container+", codecs[selected/level/parsed]=["+(I||"")+"/"+(t.audioCodec||"")+"/"+v.codec+"]")}S&&(S.levelCodec=t.videoCodec,S.id="main",this.log("Init video buffer, container:"+S.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+S.codec+"]")),T&&this.log("Init audiovideo buffer, container:"+T.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+T.codec+"]"),this.hls.trigger(M.Events.BUFFER_CODECS,n),Object.keys(n).forEach(function(B){var N=n[B],W=N.initSegment;W!=null&&W.byteLength&&f.hls.trigger(M.Events.BUFFER_APPENDING,{type:B,data:W,frag:l,part:null,chunkMeta:a,parent:l.type})}),this.tick()}},o.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,A.PlaylistLevelType.MAIN)},o.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=_.State.IDLE},o.checkFragmentChanged=function(){var t=this.media,n=null;if(t&&t.readyState>1&&t.seeking===!1){var l=t.currentTime;if(R.BufferHelper.isBuffered(t,l)?n=this.getAppendedFrag(l):R.BufferHelper.isBuffered(t,l+.1)&&(n=this.getAppendedFrag(l+.1)),n){this.backtrackFragment=null;var a=this.fragPlaying,f=n.level;(!a||n.sn!==a.sn||a.level!==f||n.urlId!==a.urlId)&&(this.hls.trigger(M.Events.FRAG_CHANGED,{frag:n}),(!a||a.level!==f)&&this.hls.trigger(M.Events.LEVEL_SWITCHED,{level:f}),this.fragPlaying=n)}}},u(r,[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}},{key:"currentProgramDateTime",get:function(){var t=this.media;if(t){var n=t.currentTime,l=this.currentFrag;if(l&&Object(P.isFiniteNumber)(n)&&Object(P.isFiniteNumber)(l.programDateTime)){var a=l.programDateTime+(n-l.start)*1e3;return new Date(a)}}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),r}(_.default)},"./src/controller/subtitle-stream-controller.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"SubtitleStreamController",function(){return e});var P=h("./src/events.ts"),_=h("./src/utils/buffer-helper.ts"),L=h("./src/controller/fragment-finders.ts"),M=h("./src/utils/discontinuities.ts"),R=h("./src/controller/level-helper.ts"),b=h("./src/controller/fragment-tracker.ts"),A=h("./src/controller/base-stream-controller.ts"),y=h("./src/types/loader.ts"),x=h("./src/types/level.ts");function D(c,g){for(var i=0;i<g.length;i++){var r=g[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(c,r.key,r)}}function E(c,g,i){return g&&D(c.prototype,g),i&&D(c,i),Object.defineProperty(c,"prototype",{writable:!1}),c}function m(c,g){c.prototype=Object.create(g.prototype),c.prototype.constructor=c,p(c,g)}function p(c,g){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},p(c,g)}var u=500,e=function(c){m(g,c);function g(r,o){var d;return d=c.call(this,r,o,"[subtitle-stream-controller]")||this,d.levels=[],d.currentTrackId=-1,d.tracksBuffered=[],d.mainDetails=null,d._registerListeners(),d}var i=g.prototype;return i.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},i._registerListeners=function(){var o=this.hls;o.on(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.on(P.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.on(P.Events.ERROR,this.onError,this),o.on(P.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),o.on(P.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),o.on(P.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),o.on(P.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),o.on(P.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},i._unregisterListeners=function(){var o=this.hls;o.off(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(P.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.off(P.Events.ERROR,this.onError,this),o.off(P.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),o.off(P.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),o.off(P.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),o.off(P.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),o.off(P.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},i.startLoad=function(){this.stopLoad(),this.state=A.State.IDLE,this.setInterval(u),this.tick()},i.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},i.onLevelLoaded=function(o,d){this.mainDetails=d.details},i.onSubtitleFragProcessed=function(o,d){var t=d.frag,n=d.success;if(this.fragPrevious=t,this.state=A.State.IDLE,!!n){var l=this.tracksBuffered[this.currentTrackId];if(!!l){for(var a,f=t.start,v=0;v<l.length;v++)if(f>=l[v].start&&f<=l[v].end){a=l[v];break}var S=t.start+t.duration;a?a.end=S:(a={start:f,end:S},l.push(a)),this.fragmentTracker.fragBuffered(t)}}},i.onBufferFlushing=function(o,d){var t=d.startOffset,n=d.endOffset;if(t===0&&n!==Number.POSITIVE_INFINITY){var l=this.currentTrackId,a=this.levels;if(!a.length||!a[l]||!a[l].details)return;var f=a[l].details,v=f.targetduration,S=n-v;if(S<=0)return;d.endOffsetSubtitles=Math.max(0,S),this.tracksBuffered.forEach(function(T){for(var I=0;I<T.length;){if(T[I].end<=S){T.shift();continue}else if(T[I].start<S)T[I].start=S;else break;I++}}),this.fragmentTracker.removeFragmentsInRange(t,S,y.PlaylistLevelType.SUBTITLE)}},i.onError=function(o,d){var t,n=d.frag;!n||n.type!==y.PlaylistLevelType.SUBTITLE||((t=this.fragCurrent)!==null&&t!==void 0&&t.loader&&this.fragCurrent.loader.abort(),this.state=A.State.IDLE)},i.onSubtitleTracksUpdated=function(o,d){var t=this,n=d.subtitleTracks;this.tracksBuffered=[],this.levels=n.map(function(l){return new x.Level(l)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(l){t.tracksBuffered[l.id]=[]}),this.mediaBuffer=null},i.onSubtitleTrackSwitch=function(o,d){if(this.currentTrackId=d.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var t=this.levels[this.currentTrackId];t!=null&&t.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,t&&this.setInterval(u)},i.onSubtitleTrackLoaded=function(o,d){var t,n=d.details,l=d.id,a=this.currentTrackId,f=this.levels;if(!!f.length){var v=f[a];if(!(l>=f.length||l!==a||!v)){if(this.mediaBuffer=this.mediaBufferTimeRanges,n.live||(t=v.details)!==null&&t!==void 0&&t.live){var S=this.mainDetails;if(n.deltaUpdateFailed||!S)return;var T=S.fragments[0];if(!v.details)n.hasProgramDateTime&&S.hasProgramDateTime?Object(M.alignMediaPlaylistByPDT)(n,S):T&&Object(R.addSliding)(n,T.start);else{var I=this.alignPlaylists(n,v.details);I===0&&T&&Object(R.addSliding)(n,T.start)}}if(v.details=n,this.levelLastLoaded=l,this.tick(),n.live&&!this.fragCurrent&&this.media&&this.state===A.State.IDLE){var k=Object(L.findFragmentByPTS)(null,n.fragments,this.media.currentTime,0);k||(this.warn("Subtitle playlist not aligned with playback"),v.details=void 0)}}}},i._handleFragmentLoadComplete=function(o){var d=o.frag,t=o.payload,n=d.decryptdata,l=this.hls;if(!this.fragContextChanged(d)&&t&&t.byteLength>0&&n&&n.key&&n.iv&&n.method==="AES-128"){var a=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(t),n.key.buffer,n.iv.buffer).then(function(f){var v=performance.now();l.trigger(P.Events.FRAG_DECRYPTED,{frag:d,payload:f,stats:{tstart:a,tdecrypt:v}})})}},i.doTick=function(){if(!this.media){this.state=A.State.IDLE;return}if(this.state===A.State.IDLE){var o=this.currentTrackId,d=this.levels;if(!d.length||!d[o]||!d[o].details)return;var t=d[o].details,n=t.targetduration,l=this.config,a=this.media,f=_.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],a.currentTime-n,l.maxBufferHole),v=f.end,S=f.len,T=this.getMaxBufferLength()+n;if(S>T)return;console.assert(t,"Subtitle track details are defined on idle subtitle stream controller tick");var I=t.fragments,k=I.length,B=t.edge,N,W=this.fragPrevious;if(v<B){var G=l.maxFragLookUpTolerance;N=Object(L.findFragmentByPTS)(W,I,Math.max(I[0].start,v),G),!N&&W&&W.start<I[0].start&&(N=I[0])}else N=I[k-1];if(N=this.mapToInitFragWhenRequired(N),!N||this.fragmentTracker.getState(N)!==b.FragmentState.NOT_LOADED)return;N.encrypted?this.loadKey(N,t):this.loadFragment(N,t,v)}},i.loadFragment=function(o,d,t){this.fragCurrent=o,o.sn==="initSegment"?this._loadInitSegment(o):c.prototype.loadFragment.call(this,o,d,t)},E(g,[{key:"mediaBufferTimeRanges",get:function(){return new s(this.tracksBuffered[this.currentTrackId]||[])}}]),g}(A.default),s=function(g){this.buffered=void 0;var i=function(o,d,t){if(d=d>>>0,d>t-1)throw new DOMException("Failed to execute '"+o+"' on 'TimeRanges': The index provided ("+d+") is greater than the maximum bound ("+t+")");return g[d][o]};this.buffered={get length(){return g.length},end:function(o){return i("end",o,g.length)},start:function(o){return i("start",o,g.length)}}}},"./src/controller/subtitle-track-controller.ts":function(U,O,h){"use strict";h.r(O);var P=h("./src/events.ts"),_=h("./src/utils/texttrack-utils.ts"),L=h("./src/controller/base-playlist-controller.ts"),M=h("./src/types/loader.ts");function R(E,m){for(var p=0;p<m.length;p++){var u=m[p];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(E,u.key,u)}}function b(E,m,p){return m&&R(E.prototype,m),p&&R(E,p),Object.defineProperty(E,"prototype",{writable:!1}),E}function A(E,m){E.prototype=Object.create(m.prototype),E.prototype.constructor=E,y(E,m)}function y(E,m){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,e){return u.__proto__=e,u},y(E,m)}var x=function(E){A(m,E);function m(u){var e;return e=E.call(this,u,"[subtitle-track-controller]")||this,e.media=null,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.trackChangeListener=function(){return e.onTextTracksChanged()},e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e._subtitleDisplay=!0,e.registerListeners(),e}var p=m.prototype;return p.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,E.prototype.destroy.call(this)},p.registerListeners=function(){var e=this.hls;e.on(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(P.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(P.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(P.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(P.Events.ERROR,this.onError,this)},p.unregisterListeners=function(){var e=this.hls;e.off(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(P.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(P.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(P.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(P.Events.ERROR,this.onError,this)},p.onMediaAttached=function(e,s){this.media=s.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},p.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},p.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var e=D(this.media.textTracks);e.forEach(function(s){Object(_.clearCurrentCues)(s)}),this.subtitleTrack=-1,this.media=null}},p.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},p.onManifestParsed=function(e,s){this.tracks=s.subtitleTracks},p.onSubtitleTrackLoaded=function(e,s){var c=s.id,g=s.details,i=this.trackId,r=this.tracksInGroup[i];if(!r){this.warn("Invalid subtitle track id "+c);return}var o=r.details;r.details=s.details,this.log("subtitle track "+c+" loaded ["+g.startSN+"-"+g.endSN+"]"),c===this.trackId&&(this.retryCount=0,this.playlistLoaded(c,s,o))},p.onLevelLoading=function(e,s){this.switchLevel(s.level)},p.onLevelSwitching=function(e,s){this.switchLevel(s.level)},p.switchLevel=function(e){var s=this.hls.levels[e];if(!!(s!=null&&s.textGroupIds)){var c=s.textGroupIds[s.urlId];if(this.groupId!==c){var g=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,i=this.tracks.filter(function(d){return!c||d.groupId===c});this.tracksInGroup=i;var r=this.findTrackId(g==null?void 0:g.name)||this.findTrackId();this.groupId=c;var o={subtitleTracks:i};this.log("Updating subtitle tracks, "+i.length+' track(s) found in "'+c+'" group-id'),this.hls.trigger(P.Events.SUBTITLE_TRACKS_UPDATED,o),r!==-1&&this.setSubtitleTrack(r,g)}}},p.findTrackId=function(e){for(var s=this.tracksInGroup,c=0;c<s.length;c++){var g=s[c];if((!this.selectDefaultTrack||g.default)&&(!e||e===g.name))return g.id}return-1},p.onError=function(e,s){E.prototype.onError.call(this,e,s),!(s.fatal||!s.context)&&s.context.type===M.PlaylistContextType.SUBTITLE_TRACK&&s.context.id===this.trackId&&s.context.groupId===this.groupId&&this.retryLoadingOrFail(s)},p.loadPlaylist=function(e){var s=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(s)){var c=s.id,g=s.groupId,i=s.url;if(e)try{i=e.addDirectives(i)}catch(r){this.warn("Could not construct new URL with HLS Delivery Directives: "+r)}this.log("Loading subtitle playlist for id "+c),this.hls.trigger(P.Events.SUBTITLE_TRACK_LOADING,{url:i,id:c,groupId:g,deliveryDirectives:e||null})}},p.toggleTrackModes=function(e){var s=this,c=this.media,g=this.trackId;if(!!c){var i=D(c.textTracks),r=i.filter(function(t){return t.groupId===s.groupId});if(e===-1)[].slice.call(i).forEach(function(t){t.mode="disabled"});else{var o=r[g];o&&(o.mode="disabled")}var d=r[e];d&&(d.mode=this.subtitleDisplay?"showing":"hidden")}},p.setSubtitleTrack=function(e,s){var c,g=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(e===-1||(c=g[e])!==null&&c!==void 0&&c.details)||e<-1||e>=g.length)){this.clearTimer();var i=g[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,i){var r=i.id,o=i.groupId,d=o===void 0?"":o,t=i.name,n=i.type,l=i.url;this.hls.trigger(P.Events.SUBTITLE_TRACK_SWITCH,{id:r,groupId:d,name:t,type:n,url:l});var a=this.switchParams(i.url,s==null?void 0:s.details);this.loadPlaylist(a)}else this.hls.trigger(P.Events.SUBTITLE_TRACK_SWITCH,{id:e})}},p.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var e=-1,s=D(this.media.textTracks),c=0;c<s.length;c++)if(s[c].mode==="hidden")e=c;else if(s[c].mode==="showing"){e=c;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},b(m,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,s)}}]),m}(L.default);function D(E){for(var m=[],p=0;p<E.length;p++){var u=E[p];u.kind==="subtitles"&&u.label&&m.push(E[p])}return m}O.default=x},"./src/controller/timeline-controller.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"TimelineController",function(){return E});var P=h("./src/polyfills/number.ts"),_=h("./src/events.ts"),L=h("./src/utils/cea-608-parser.ts"),M=h("./src/utils/output-filter.ts"),R=h("./src/utils/webvtt-parser.ts"),b=h("./src/utils/texttrack-utils.ts"),A=h("./src/utils/imsc1-ttml-parser.ts"),y=h("./src/utils/mp4-tools.ts"),x=h("./src/types/loader.ts"),D=h("./src/utils/logger.ts"),E=function(){function e(c){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=u(),this.captionsProperties=void 0,this.hls=c,this.config=c.config,this.Cues=c.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var g=new M.default(this,"textTrack1"),i=new M.default(this,"textTrack2"),r=new M.default(this,"textTrack3"),o=new M.default(this,"textTrack4");this.cea608Parser1=new L.default(1,g,i),this.cea608Parser2=new L.default(3,r,o)}c.on(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),c.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),c.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),c.on(_.Events.MANIFEST_LOADED,this.onManifestLoaded,this),c.on(_.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),c.on(_.Events.FRAG_LOADING,this.onFragLoading,this),c.on(_.Events.FRAG_LOADED,this.onFragLoaded,this),c.on(_.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),c.on(_.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),c.on(_.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),c.on(_.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),c.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var s=e.prototype;return s.destroy=function(){var g=this.hls;g.off(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),g.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.off(_.Events.MANIFEST_LOADED,this.onManifestLoaded,this),g.off(_.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),g.off(_.Events.FRAG_LOADING,this.onFragLoading,this),g.off(_.Events.FRAG_LOADED,this.onFragLoaded,this),g.off(_.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),g.off(_.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),g.off(_.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),g.off(_.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),g.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},s.addCues=function(g,i,r,o,d){for(var t=!1,n=d.length;n--;){var l=d[n],a=p(l[0],l[1],i,r);if(a>=0&&(l[0]=Math.min(l[0],i),l[1]=Math.max(l[1],r),t=!0,a/(r-i)>.5))return}if(t||d.push([i,r]),this.config.renderTextTracksNatively){var f=this.captionsTracks[g];this.Cues.newCue(f,i,r,o)}else{var v=this.Cues.newCue(null,i,r,o);this.hls.trigger(_.Events.CUES_PARSED,{type:"captions",cues:v,track:g})}},s.onInitPtsFound=function(g,i){var r=this,o=i.frag,d=i.id,t=i.initPTS,n=i.timescale,l=this.unparsedVttFrags;d==="main"&&(this.initPTS[o.cc]=t,this.timescale[o.cc]=n),l.length&&(this.unparsedVttFrags=[],l.forEach(function(a){r.onFragLoaded(_.Events.FRAG_LOADED,a)}))},s.getExistingTrack=function(g){var i=this.media;if(i)for(var r=0;r<i.textTracks.length;r++){var o=i.textTracks[r];if(o[g])return o}return null},s.createCaptionsTrack=function(g){this.config.renderTextTracksNatively?this.createNativeTrack(g):this.createNonNativeTrack(g)},s.createNativeTrack=function(g){if(!this.captionsTracks[g]){var i=this.captionsProperties,r=this.captionsTracks,o=this.media,d=i[g],t=d.label,n=d.languageCode,l=this.getExistingTrack(g);if(l)r[g]=l,Object(b.clearCurrentCues)(r[g]),Object(b.sendAddTrackEvent)(r[g],o);else{var a=this.createTextTrack("captions",t,n);a&&(a[g]=!0,r[g]=a)}}},s.createNonNativeTrack=function(g){if(!this.nonNativeCaptionsTracks[g]){var i=this.captionsProperties[g];if(!!i){var r=i.label,o={_id:g,label:r,kind:"captions",default:i.media?!!i.media.default:!1,closedCaptions:i.media};this.nonNativeCaptionsTracks[g]=o,this.hls.trigger(_.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[o]})}}},s.createTextTrack=function(g,i,r){var o=this.media;if(!!o)return o.addTextTrack(g,i,r)},s.onMediaAttaching=function(g,i){this.media=i.media,this._cleanTracks()},s.onMediaDetaching=function(){var g=this.captionsTracks;Object.keys(g).forEach(function(i){Object(b.clearCurrentCues)(g[i]),delete g[i]}),this.nonNativeCaptionsTracks={}},s.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=u(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},s._cleanTracks=function(){var g=this.media;if(!!g){var i=g.textTracks;if(i)for(var r=0;r<i.length;r++)Object(b.clearCurrentCues)(i[r])}},s.onSubtitleTracksUpdated=function(g,i){var r=this;this.textTracks=[];var o=i.subtitleTracks||[],d=o.some(function(a){return a.textCodec===A.IMSC1_CODEC});if(this.config.enableWebVTT||d&&this.config.enableIMSC1){var t=this.tracks&&o&&this.tracks.length===o.length;if(this.tracks=o||[],this.config.renderTextTracksNatively){var n=this.media?this.media.textTracks:[];this.tracks.forEach(function(a,f){var v;if(f<n.length){for(var S=null,T=0;T<n.length;T++)if(m(n[T],a)){S=n[T];break}S&&(v=S)}if(v)Object(b.clearCurrentCues)(v);else{var I=r._captionsOrSubtitlesFromCharacteristics(a);v=r.createTextTrack(I,a.name,a.lang),v&&(v.mode="disabled")}v&&(v.groupId=a.groupId,r.textTracks.push(v))})}else if(!t&&this.tracks&&this.tracks.length){var l=this.tracks.map(function(a){return{label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}});this.hls.trigger(_.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}},s._captionsOrSubtitlesFromCharacteristics=function(g){var i;if((i=g.attrs)!==null&&i!==void 0&&i.CHARACTERISTICS){var r=/transcribes-spoken-dialog/gi.test(g.attrs.CHARACTERISTICS),o=/describes-music-and-sound/gi.test(g.attrs.CHARACTERISTICS);if(r&&o)return"captions"}return"subtitles"},s.onManifestLoaded=function(g,i){var r=this;this.config.enableCEA708Captions&&i.captions&&i.captions.forEach(function(o){var d=/(?:CC|SERVICE)([1-4])/.exec(o.instreamId);if(!!d){var t="textTrack"+d[1],n=r.captionsProperties[t];!n||(n.label=o.name,o.lang&&(n.languageCode=o.lang),n.media=o)}})},s.onFragLoading=function(g,i){var r=this.cea608Parser1,o=this.cea608Parser2,d=this.lastSn,t=this.lastPartIndex;if(!(!this.enabled||!(r&&o))&&i.frag.type===x.PlaylistLevelType.MAIN){var n,l,a=i.frag.sn,f=(n=i==null||(l=i.part)===null||l===void 0?void 0:l.index)!=null?n:-1;a===d+1||a===d&&f===t+1||(r.reset(),o.reset()),this.lastSn=a,this.lastPartIndex=f}},s.onFragLoaded=function(g,i){var r=i.frag,o=i.payload,d=this.initPTS,t=this.unparsedVttFrags;if(r.type===x.PlaylistLevelType.SUBTITLE)if(o.byteLength){if(!Object(P.isFiniteNumber)(d[r.cc])){t.push(i),d.length&&this.hls.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")});return}var n=r.decryptdata,l="stats"in i;if(n==null||n.key==null||n.method!=="AES-128"||l){var a=this.tracks[r.level],f=this.vttCCs;f[r.cc]||(f[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),a&&a.textCodec===A.IMSC1_CODEC?this._parseIMSC1(r,o):this._parseVTTs(r,o,f)}}else this.hls.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},s._parseIMSC1=function(g,i){var r=this,o=this.hls;Object(A.parseIMSC1)(i,this.initPTS[g.cc],this.timescale[g.cc],function(d){r._appendCues(d,g.level),o.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:g})},function(d){D.logger.log("Failed to parse IMSC1: "+d),o.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:g,error:d})})},s._parseVTTs=function(g,i,r){var o,d=this,t=this.hls,n=(o=g.initSegment)!==null&&o!==void 0&&o.data?Object(y.appendUint8Array)(g.initSegment.data,new Uint8Array(i)):i;Object(R.parseWebVTT)(n,this.initPTS[g.cc],this.timescale[g.cc],r,g.cc,g.start,function(l){d._appendCues(l,g.level),t.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:g})},function(l){d._fallbackToIMSC1(g,i),D.logger.log("Failed to parse VTT cue: "+l),t.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:g,error:l})})},s._fallbackToIMSC1=function(g,i){var r=this,o=this.tracks[g.level];o.textCodec||Object(A.parseIMSC1)(i,this.initPTS[g.cc],this.timescale[g.cc],function(){o.textCodec=A.IMSC1_CODEC,r._parseIMSC1(g,i)},function(){o.textCodec="wvtt"})},s._appendCues=function(g,i){var r=this.hls;if(this.config.renderTextTracksNatively){var o=this.textTracks[i];if(!o||o.mode==="disabled")return;g.forEach(function(n){return Object(b.addCueToTrack)(o,n)})}else{var d=this.tracks[i];if(!d)return;var t=d.default?"default":"subtitles"+i;r.trigger(_.Events.CUES_PARSED,{type:"subtitles",cues:g,track:t})}},s.onFragDecrypted=function(g,i){var r=i.frag;if(r.type===x.PlaylistLevelType.SUBTITLE){if(!Object(P.isFiniteNumber)(this.initPTS[r.cc])){this.unparsedVttFrags.push(i);return}this.onFragLoaded(_.Events.FRAG_LOADED,i)}},s.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},s.onFragParsingUserdata=function(g,i){var r=this.cea608Parser1,o=this.cea608Parser2;if(!(!this.enabled||!(r&&o)))for(var d=0;d<i.samples.length;d++){var t=i.samples[d].bytes;if(t){var n=this.extractCea608Data(t);r.addData(i.samples[d].pts,n[0]),o.addData(i.samples[d].pts,n[1])}}},s.onBufferFlushing=function(g,i){var r=i.startOffset,o=i.endOffset,d=i.endOffsetSubtitles,t=i.type,n=this.media;if(!(!n||n.currentTime<o)){if(!t||t==="video"){var l=this.captionsTracks;Object.keys(l).forEach(function(f){return Object(b.removeCuesInRange)(l[f],r,o)})}if(this.config.renderTextTracksNatively&&r===0&&d!==void 0){var a=this.textTracks;Object.keys(a).forEach(function(f){return Object(b.removeCuesInRange)(a[f],r,d)})}}},s.extractCea608Data=function(g){for(var i=[[],[]],r=g[0]&31,o=2,d=0;d<r;d++){var t=g[o++],n=127&g[o++],l=127&g[o++];if(!(n===0&&l===0)){var a=(4&t)!==0;if(a){var f=3&t;(f===0||f===1)&&(i[f].push(n),i[f].push(l))}}}return i},e}();function m(e,s){return e&&e.label===s.name&&!(e.textTrack1||e.textTrack2)}function p(e,s,c,g){return Math.min(s,g)-Math.max(e,c)}function u(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return P});var P=function(){function _(M,R){this.subtle=void 0,this.aesIV=void 0,this.subtle=M,this.aesIV=R}var L=_.prototype;return L.decrypt=function(R,b){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},b,R)},_}()},"./src/crypt/aes-decryptor.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"removePadding",function(){return _}),h.d(O,"default",function(){return L});var P=h("./src/utils/typed-array.ts");function _(M){var R=M.byteLength,b=R&&new DataView(M.buffer).getUint8(R-1);return b?Object(P.sliceUint8)(M,0,R-b):M}var L=function(){function M(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var R=M.prototype;return R.uint8ArrayToUint32Array_=function(A){for(var y=new DataView(A),x=new Uint32Array(4),D=0;D<4;D++)x[D]=y.getUint32(D*4);return x},R.initTable=function(){var A=this.sBox,y=this.invSBox,x=this.subMix,D=x[0],E=x[1],m=x[2],p=x[3],u=this.invSubMix,e=u[0],s=u[1],c=u[2],g=u[3],i=new Uint32Array(256),r=0,o=0,d=0;for(d=0;d<256;d++)d<128?i[d]=d<<1:i[d]=d<<1^283;for(d=0;d<256;d++){var t=o^o<<1^o<<2^o<<3^o<<4;t=t>>>8^t&255^99,A[r]=t,y[t]=r;var n=i[r],l=i[n],a=i[l],f=i[t]*257^t*16843008;D[r]=f<<24|f>>>8,E[r]=f<<16|f>>>16,m[r]=f<<8|f>>>24,p[r]=f,f=a*16843009^l*65537^n*257^r*16843008,e[t]=f<<24|f>>>8,s[t]=f<<16|f>>>16,c[t]=f<<8|f>>>24,g[t]=f,r?(r=n^i[i[i[a^n]]],o^=i[i[o]]):r=o=1}},R.expandKey=function(A){for(var y=this.uint8ArrayToUint32Array_(A),x=!0,D=0;D<y.length&&x;)x=y[D]===this.key[D],D++;if(!x){this.key=y;var E=this.keySize=y.length;if(E!==4&&E!==6&&E!==8)throw new Error("Invalid aes key size="+E);var m=this.ksRows=(E+6+1)*4,p,u,e=this.keySchedule=new Uint32Array(m),s=this.invKeySchedule=new Uint32Array(m),c=this.sBox,g=this.rcon,i=this.invSubMix,r=i[0],o=i[1],d=i[2],t=i[3],n,l;for(p=0;p<m;p++){if(p<E){n=e[p]=y[p];continue}l=n,p%E===0?(l=l<<8|l>>>24,l=c[l>>>24]<<24|c[l>>>16&255]<<16|c[l>>>8&255]<<8|c[l&255],l^=g[p/E|0]<<24):E>6&&p%E===4&&(l=c[l>>>24]<<24|c[l>>>16&255]<<16|c[l>>>8&255]<<8|c[l&255]),e[p]=n=(e[p-E]^l)>>>0}for(u=0;u<m;u++)p=m-u,u&3?l=e[p]:l=e[p-4],u<4||p<=4?s[u]=l:s[u]=r[c[l>>>24]]^o[c[l>>>16&255]]^d[c[l>>>8&255]]^t[c[l&255]],s[u]=s[u]>>>0}},R.networkToHostOrderSwap=function(A){return A<<24|(A&65280)<<8|(A&16711680)>>8|A>>>24},R.decrypt=function(A,y,x){for(var D=this.keySize+6,E=this.invKeySchedule,m=this.invSBox,p=this.invSubMix,u=p[0],e=p[1],s=p[2],c=p[3],g=this.uint8ArrayToUint32Array_(x),i=g[0],r=g[1],o=g[2],d=g[3],t=new Int32Array(A),n=new Int32Array(t.length),l,a,f,v,S,T,I,k,B,N,W,G,z,Y,$=this.networkToHostOrderSwap;y<t.length;){for(B=$(t[y]),N=$(t[y+1]),W=$(t[y+2]),G=$(t[y+3]),S=B^E[0],T=G^E[1],I=W^E[2],k=N^E[3],z=4,Y=1;Y<D;Y++)l=u[S>>>24]^e[T>>16&255]^s[I>>8&255]^c[k&255]^E[z],a=u[T>>>24]^e[I>>16&255]^s[k>>8&255]^c[S&255]^E[z+1],f=u[I>>>24]^e[k>>16&255]^s[S>>8&255]^c[T&255]^E[z+2],v=u[k>>>24]^e[S>>16&255]^s[T>>8&255]^c[I&255]^E[z+3],S=l,T=a,I=f,k=v,z=z+4;l=m[S>>>24]<<24^m[T>>16&255]<<16^m[I>>8&255]<<8^m[k&255]^E[z],a=m[T>>>24]<<24^m[I>>16&255]<<16^m[k>>8&255]<<8^m[S&255]^E[z+1],f=m[I>>>24]<<24^m[k>>16&255]<<16^m[S>>8&255]<<8^m[T&255]^E[z+2],v=m[k>>>24]<<24^m[S>>16&255]<<16^m[T>>8&255]<<8^m[I&255]^E[z+3],n[y]=$(l^i),n[y+1]=$(v^r),n[y+2]=$(f^o),n[y+3]=$(a^d),i=B,r=N,o=W,d=G,y=y+4}return n.buffer},M}()},"./src/crypt/decrypter.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return y});var P=h("./src/crypt/aes-crypto.ts"),_=h("./src/crypt/fast-aes-key.ts"),L=h("./src/crypt/aes-decryptor.ts"),M=h("./src/utils/logger.ts"),R=h("./src/utils/mp4-tools.ts"),b=h("./src/utils/typed-array.ts"),A=16,y=function(){function x(E,m,p){var u=p===void 0?{}:p,e=u.removePKCS7Padding,s=e===void 0?!0:e;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=E,this.config=m,this.removePKCS7Padding=s,s)try{var c=self.crypto;c&&(this.subtle=c.subtle||c.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var D=x.prototype;return D.destroy=function(){this.observer=null},D.isSync=function(){return this.config.enableSoftwareAES},D.flush=function(){var m=this.currentResult;if(!m){this.reset();return}var p=new Uint8Array(m);return this.reset(),this.removePKCS7Padding?Object(L.removePadding)(p):p},D.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},D.decrypt=function(m,p,u,e){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(m),p,u);var s=this.flush();s&&e(s.buffer)}else this.webCryptoDecrypt(new Uint8Array(m),p,u).then(e)},D.softwareDecrypt=function(m,p,u){var e=this.currentIV,s=this.currentResult,c=this.remainderData;this.logOnce("JS AES decrypt"),c&&(m=Object(R.appendUint8Array)(c,m),this.remainderData=null);var g=this.getValidChunk(m);if(!g.length)return null;e&&(u=e);var i=this.softwareDecrypter;i||(i=this.softwareDecrypter=new L.default),i.expandKey(p);var r=s;return this.currentResult=i.decrypt(g.buffer,0,u),this.currentIV=Object(b.sliceUint8)(g,-16).buffer,r||null},D.webCryptoDecrypt=function(m,p,u){var e=this,s=this.subtle;return(this.key!==p||!this.fastAesKey)&&(this.key=p,this.fastAesKey=new _.default(s,p)),this.fastAesKey.expandKey().then(function(c){if(!s)return Promise.reject(new Error("web crypto not initialized"));var g=new P.default(s,u);return g.decrypt(m.buffer,c)}).catch(function(c){return e.onWebCryptoError(c,m,p,u)})},D.onWebCryptoError=function(m,p,u,e){return M.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",m),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(p,u,e)},D.getValidChunk=function(m){var p=m,u=m.length-m.length%A;return u!==m.length&&(p=Object(b.sliceUint8)(m,0,u),this.remainderData=Object(b.sliceUint8)(m,u)),p},D.logOnce=function(m){!this.logEnabled||(M.logger.log("[decrypter.ts]: "+m),this.logEnabled=!1)},x}()},"./src/crypt/fast-aes-key.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return P});var P=function(){function _(M,R){this.subtle=void 0,this.key=void 0,this.subtle=M,this.key=R}var L=_.prototype;return L.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},_}()},"./src/demux/aacdemuxer.ts":function(U,O,h){"use strict";h.r(O);var P=h("./src/demux/base-audio-demuxer.ts"),_=h("./src/demux/adts.ts"),L=h("./src/utils/logger.ts"),M=h("./src/demux/id3.ts");function R(y,x){y.prototype=Object.create(x.prototype),y.prototype.constructor=y,b(y,x)}function b(y,x){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(E,m){return E.__proto__=m,E},b(y,x)}var A=function(y){R(x,y);function x(E,m){var p;return p=y.call(this)||this,p.observer=void 0,p.config=void 0,p.observer=E,p.config=m,p}var D=x.prototype;return D.resetInitSegment=function(m,p,u,e){y.prototype.resetInitSegment.call(this,m,p,u,e),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:p,duration:e,inputTimeScale:9e4,dropped:0}},x.probe=function(m){if(!m)return!1;for(var p=M.getID3Data(m,0)||[],u=p.length,e=m.length;u<e;u++)if(_.probe(m,u))return L.logger.log("ADTS sync word found !"),!0;return!1},D.canParse=function(m,p){return _.canParse(m,p)},D.appendFrame=function(m,p,u){_.initTrackConfig(m,this.observer,p,u,m.manifestCodec);var e=_.appendFrame(m,p,u,this.basePTS,this.frameIndex);if(e&&e.missing===0)return e},x}(P.default);O.default=A},"./src/demux/adts.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"getAudioConfig",function(){return M}),h.d(O,"isHeaderPattern",function(){return R}),h.d(O,"getHeaderLength",function(){return b}),h.d(O,"getFullFrameLength",function(){return A}),h.d(O,"canGetFrameLength",function(){return y}),h.d(O,"isHeader",function(){return x}),h.d(O,"canParse",function(){return D}),h.d(O,"probe",function(){return E}),h.d(O,"initTrackConfig",function(){return m}),h.d(O,"getFrameDuration",function(){return p}),h.d(O,"parseFrameHeader",function(){return u}),h.d(O,"appendFrame",function(){return e});var P=h("./src/utils/logger.ts"),_=h("./src/errors.ts"),L=h("./src/events.ts");function M(s,c,g,i){var r,o,d,t,n=navigator.userAgent.toLowerCase(),l=i,a=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=((c[g+2]&192)>>>6)+1;var f=(c[g+2]&60)>>>2;if(f>a.length-1){s.trigger(L.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+f});return}return d=(c[g+2]&1)<<2,d|=(c[g+3]&192)>>>6,P.logger.log("manifest codec:"+i+", ADTS type:"+r+", samplingIndex:"+f),/firefox/i.test(n)?f>=6?(r=5,t=new Array(4),o=f-3):(r=2,t=new Array(2),o=f):n.indexOf("android")!==-1?(r=2,t=new Array(2),o=f):(r=5,t=new Array(4),i&&(i.indexOf("mp4a.40.29")!==-1||i.indexOf("mp4a.40.5")!==-1)||!i&&f>=6?o=f-3:((i&&i.indexOf("mp4a.40.2")!==-1&&(f>=6&&d===1||/vivaldi/i.test(n))||!i&&d===1)&&(r=2,t=new Array(2)),o=f)),t[0]=r<<3,t[0]|=(f&14)>>1,t[1]|=(f&1)<<7,t[1]|=d<<3,r===5&&(t[1]|=(o&14)>>1,t[2]=(o&1)<<7,t[2]|=2<<2,t[3]=0),{config:t,samplerate:a[f],channelCount:d,codec:"mp4a.40."+r,manifestCodec:l}}function R(s,c){return s[c]===255&&(s[c+1]&246)===240}function b(s,c){return s[c+1]&1?7:9}function A(s,c){return(s[c+3]&3)<<11|s[c+4]<<3|(s[c+5]&224)>>>5}function y(s,c){return c+5<s.length}function x(s,c){return c+1<s.length&&R(s,c)}function D(s,c){return y(s,c)&&R(s,c)&&A(s,c)<=s.length-c}function E(s,c){if(x(s,c)){var g=b(s,c);if(c+g>=s.length)return!1;var i=A(s,c);if(i<=g)return!1;var r=c+i;return r===s.length||x(s,r)}return!1}function m(s,c,g,i,r){if(!s.samplerate){var o=M(c,g,i,r);if(!o)return;s.config=o.config,s.samplerate=o.samplerate,s.channelCount=o.channelCount,s.codec=o.codec,s.manifestCodec=o.manifestCodec,P.logger.log("parsed codec:"+s.codec+", rate:"+o.samplerate+", channels:"+o.channelCount)}}function p(s){return 1024*9e4/s}function u(s,c){var g=b(s,c);if(c+g<=s.length){var i=A(s,c)-g;if(i>0)return{headerLength:g,frameLength:i}}}function e(s,c,g,i,r){var o=p(s.samplerate),d=i+r*o,t=u(c,g),n;if(t){var l=t.frameLength,a=t.headerLength,f=a+l,v=Math.max(0,g+f-c.length);v?(n=new Uint8Array(f-a),n.set(c.subarray(g+a,c.length),0)):n=c.subarray(g+a,g+f);var S={unit:n,pts:d};return v||s.samples.push(S),{sample:S,length:f,missing:v}}var T=c.length-g;n=new Uint8Array(T),n.set(c.subarray(g,c.length),0);var I={unit:n,pts:d};return{sample:I,length:T,missing:-1}}},"./src/demux/base-audio-demuxer.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"initPTSFn",function(){return y});var P=h("./src/polyfills/number.ts"),_=h("./src/demux/id3.ts"),L=h("./src/types/demuxer.ts"),M=h("./src/demux/dummy-demuxed-track.ts"),R=h("./src/utils/mp4-tools.ts"),b=h("./src/utils/typed-array.ts"),A=function(){function x(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null}var D=x.prototype;return D.resetInitSegment=function(m,p,u,e){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},D.resetTimeStamp=function(m){this.initPTS=m,this.resetContiguity()},D.resetContiguity=function(){this.basePTS=null,this.frameIndex=0},D.canParse=function(m,p){return!1},D.appendFrame=function(m,p,u){},D.demux=function(m,p){this.cachedData&&(m=Object(R.appendUint8Array)(this.cachedData,m),this.cachedData=null);var u=_.getID3Data(m,0),e=u?u.length:0,s,c,g=this._audioTrack,i=this._id3Track,r=u?_.getTimeStamp(u):void 0,o=m.length;for((this.basePTS===null||this.frameIndex===0&&Object(P.isFiniteNumber)(r))&&(this.basePTS=y(r,p,this.initPTS)),u&&u.length>0&&i.samples.push({pts:this.basePTS,dts:this.basePTS,data:u,type:L.MetadataSchema.audioId3}),c=this.basePTS;e<o;){if(this.canParse(m,e)){var d=this.appendFrame(g,m,e);d?(this.frameIndex++,c=d.sample.pts,e+=d.length,s=e):e=o}else _.canParse(m,e)?(u=_.getID3Data(m,e),i.samples.push({pts:c,dts:c,data:u,type:L.MetadataSchema.audioId3}),e+=u.length,s=e):e++;if(e===o&&s!==o){var t=Object(b.sliceUint8)(m,s);this.cachedData?this.cachedData=Object(R.appendUint8Array)(this.cachedData,t):this.cachedData=t}}return{audioTrack:g,videoTrack:Object(M.dummyTrack)(),id3Track:i,textTrack:Object(M.dummyTrack)()}},D.demuxSampleAes=function(m,p,u){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},D.flush=function(m){var p=this.cachedData;return p&&(this.cachedData=null,this.demux(p,0)),{audioTrack:this._audioTrack,videoTrack:Object(M.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(M.dummyTrack)()}},D.destroy=function(){},x}(),y=function(D,E,m){return Object(P.isFiniteNumber)(D)?D*90:E*9e4+(m||0)};O.default=A},"./src/demux/chunk-cache.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return P});var P=function(){function L(){this.chunks=[],this.dataLength=0}var M=L.prototype;return M.push=function(b){this.chunks.push(b),this.dataLength+=b.length},M.flush=function(){var b=this.chunks,A=this.dataLength,y;if(b.length)b.length===1?y=b[0]:y=_(b,A);else return new Uint8Array(0);return this.reset(),y},M.reset=function(){this.chunks.length=0,this.dataLength=0},L}();function _(L,M){for(var R=new Uint8Array(M),b=0,A=0;A<L.length;A++){var y=L[A];R.set(y,b),b+=y.length}return R}},"./src/demux/dummy-demuxed-track.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"dummyTrack",function(){return P});function P(_,L){return _===void 0&&(_=""),L===void 0&&(L=9e4),{type:_,id:-1,pid:-1,inputTimeScale:L,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(U,O,h){"use strict";h.r(O);var P=h("./src/utils/logger.ts"),_=function(){function L(R){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=R,this.bytesAvailable=R.byteLength,this.word=0,this.bitsAvailable=0}var M=L.prototype;return M.loadWord=function(){var b=this.data,A=this.bytesAvailable,y=b.byteLength-A,x=new Uint8Array(4),D=Math.min(4,A);if(D===0)throw new Error("no bytes available");x.set(b.subarray(y,y+D)),this.word=new DataView(x.buffer).getUint32(0),this.bitsAvailable=D*8,this.bytesAvailable-=D},M.skipBits=function(b){var A;this.bitsAvailable>b?(this.word<<=b,this.bitsAvailable-=b):(b-=this.bitsAvailable,A=b>>3,b-=A>>3,this.bytesAvailable-=A,this.loadWord(),this.word<<=b,this.bitsAvailable-=b)},M.readBits=function(b){var A=Math.min(this.bitsAvailable,b),y=this.word>>>32-A;return b>32&&P.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=A,this.bitsAvailable>0?this.word<<=A:this.bytesAvailable>0&&this.loadWord(),A=b-A,A>0&&this.bitsAvailable?y<<A|this.readBits(A):y},M.skipLZ=function(){var b;for(b=0;b<this.bitsAvailable;++b)if((this.word&2147483648>>>b)!==0)return this.word<<=b,this.bitsAvailable-=b,b;return this.loadWord(),b+this.skipLZ()},M.skipUEG=function(){this.skipBits(1+this.skipLZ())},M.skipEG=function(){this.skipBits(1+this.skipLZ())},M.readUEG=function(){var b=this.skipLZ();return this.readBits(b+1)-1},M.readEG=function(){var b=this.readUEG();return 1&b?1+b>>>1:-1*(b>>>1)},M.readBoolean=function(){return this.readBits(1)===1},M.readUByte=function(){return this.readBits(8)},M.readUShort=function(){return this.readBits(16)},M.readUInt=function(){return this.readBits(32)},M.skipScalingList=function(b){for(var A=8,y=8,x,D=0;D<b;D++)y!==0&&(x=this.readEG(),y=(A+x+256)%256),A=y===0?A:y},M.readSPS=function(){var b=0,A=0,y=0,x=0,D,E,m,p=this.readUByte.bind(this),u=this.readBits.bind(this),e=this.readUEG.bind(this),s=this.readBoolean.bind(this),c=this.skipBits.bind(this),g=this.skipEG.bind(this),i=this.skipUEG.bind(this),r=this.skipScalingList.bind(this);p();var o=p();if(u(5),c(3),p(),i(),o===100||o===110||o===122||o===244||o===44||o===83||o===86||o===118||o===128){var d=e();if(d===3&&c(1),i(),i(),c(1),s())for(E=d!==3?8:12,m=0;m<E;m++)s()&&(m<6?r(16):r(64))}i();var t=e();if(t===0)e();else if(t===1)for(c(1),g(),g(),D=e(),m=0;m<D;m++)g();i(),c(1);var n=e(),l=e(),a=u(1);a===0&&c(1),c(1),s()&&(b=e(),A=e(),y=e(),x=e());var f=[1,1];if(s()&&s()){var v=p();switch(v){case 1:f=[1,1];break;case 2:f=[12,11];break;case 3:f=[10,11];break;case 4:f=[16,11];break;case 5:f=[40,33];break;case 6:f=[24,11];break;case 7:f=[20,11];break;case 8:f=[32,11];break;case 9:f=[80,33];break;case 10:f=[18,11];break;case 11:f=[15,11];break;case 12:f=[64,33];break;case 13:f=[160,99];break;case 14:f=[4,3];break;case 15:f=[3,2];break;case 16:f=[2,1];break;case 255:{f=[p()<<8|p(),p()<<8|p()];break}}}return{width:Math.ceil((n+1)*16-b*2-A*2),height:(2-a)*(l+1)*16-(a?2:4)*(y+x),pixelRatio:f}},M.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},L}();O.default=_},"./src/demux/id3.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"isHeader",function(){return P}),h.d(O,"isFooter",function(){return _}),h.d(O,"getID3Data",function(){return L}),h.d(O,"canParse",function(){return R}),h.d(O,"getTimeStamp",function(){return b}),h.d(O,"isTimeStampFrame",function(){return A}),h.d(O,"getID3Frames",function(){return x}),h.d(O,"decodeFrame",function(){return D}),h.d(O,"utf8ArrayToStr",function(){return e}),h.d(O,"testables",function(){return s});var P=function(r,o){return o+10<=r.length&&r[o]===73&&r[o+1]===68&&r[o+2]===51&&r[o+3]<255&&r[o+4]<255&&r[o+6]<128&&r[o+7]<128&&r[o+8]<128&&r[o+9]<128},_=function(r,o){return o+10<=r.length&&r[o]===51&&r[o+1]===68&&r[o+2]===73&&r[o+3]<255&&r[o+4]<255&&r[o+6]<128&&r[o+7]<128&&r[o+8]<128&&r[o+9]<128},L=function(r,o){for(var d=o,t=0;P(r,o);){t+=10;var n=M(r,o+6);t+=n,_(r,o+10)&&(t+=10),o+=t}if(t>0)return r.subarray(d,d+t)},M=function(r,o){var d=0;return d=(r[o]&127)<<21,d|=(r[o+1]&127)<<14,d|=(r[o+2]&127)<<7,d|=r[o+3]&127,d},R=function(r,o){return P(r,o)&&M(r,o+6)+10<=r.length-o},b=function(r){for(var o=x(r),d=0;d<o.length;d++){var t=o[d];if(A(t))return u(t)}},A=function(r){return r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp"},y=function(r){var o=String.fromCharCode(r[0],r[1],r[2],r[3]),d=M(r,4),t=10;return{type:o,size:d,data:r.subarray(t,t+d)}},x=function(r){for(var o=0,d=[];P(r,o);){var t=M(r,o+6);o+=10;for(var n=o+t;o+8<n;){var l=y(r.subarray(o)),a=D(l);a&&d.push(a),o+=l.size+10}_(r,o)&&(o+=10)}return d},D=function(r){return r.type==="PRIV"?E(r):r.type[0]==="W"?p(r):m(r)},E=function(r){if(!(r.size<2)){var o=e(r.data,!0),d=new Uint8Array(r.data.subarray(o.length+1));return{key:r.type,info:o,data:d.buffer}}},m=function(r){if(!(r.size<2)){if(r.type==="TXXX"){var o=1,d=e(r.data.subarray(o),!0);o+=d.length+1;var t=e(r.data.subarray(o));return{key:r.type,info:d,data:t}}var n=e(r.data.subarray(1));return{key:r.type,data:n}}},p=function(r){if(r.type==="WXXX"){if(r.size<2)return;var o=1,d=e(r.data.subarray(o),!0);o+=d.length+1;var t=e(r.data.subarray(o));return{key:r.type,info:d,data:t}}var n=e(r.data);return{key:r.type,data:n}},u=function(r){if(r.data.byteLength===8){var o=new Uint8Array(r.data),d=o[3]&1,t=(o[4]<<23)+(o[5]<<15)+(o[6]<<7)+o[7];return t/=45,d&&(t+=4772185884e-2),Math.round(t)}},e=function(r,o){o===void 0&&(o=!1);var d=g();if(d){var t=d.decode(r);if(o){var n=t.indexOf("\0");return n!==-1?t.substring(0,n):t}return t.replace(/\0/g,"")}for(var l=r.length,a,f,v,S="",T=0;T<l;){if(a=r[T++],a===0&&o)return S;if(a===0||a===3)continue;switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:S+=String.fromCharCode(a);break;case 12:case 13:f=r[T++],S+=String.fromCharCode((a&31)<<6|f&63);break;case 14:f=r[T++],v=r[T++],S+=String.fromCharCode((a&15)<<12|(f&63)<<6|(v&63)<<0);break;default:}}return S},s={decodeTextFrame:m},c;function g(){return!c&&typeof self.TextDecoder!="undefined"&&(c=new self.TextDecoder("utf-8")),c}},"./src/demux/mp3demuxer.ts":function(U,O,h){"use strict";h.r(O);var P=h("./src/demux/base-audio-demuxer.ts"),_=h("./src/demux/id3.ts"),L=h("./src/utils/logger.ts"),M=h("./src/demux/mpegaudio.ts");function R(y,x){y.prototype=Object.create(x.prototype),y.prototype.constructor=y,b(y,x)}function b(y,x){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(E,m){return E.__proto__=m,E},b(y,x)}var A=function(y){R(x,y);function x(){return y.apply(this,arguments)||this}var D=x.prototype;return D.resetInitSegment=function(m,p,u,e){y.prototype.resetInitSegment.call(this,m,p,u,e),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:p,duration:e,inputTimeScale:9e4,dropped:0}},x.probe=function(m){if(!m)return!1;for(var p=_.getID3Data(m,0)||[],u=p.length,e=m.length;u<e;u++)if(M.probe(m,u))return L.logger.log("MPEG Audio sync word found !"),!0;return!1},D.canParse=function(m,p){return M.canParse(m,p)},D.appendFrame=function(m,p,u){if(this.basePTS!==null)return M.appendFrame(m,p,u,this.basePTS,this.frameIndex)},x}(P.default);O.default=A},"./src/demux/mp4demuxer.ts":function(U,O,h){"use strict";h.r(O);var P=h("./src/polyfills/number.ts"),_=h("./src/types/demuxer.ts"),L=h("./src/utils/mp4-tools.ts"),M=h("./src/demux/dummy-demuxed-track.ts"),R=/\/emsg[-/]ID3/i,b=function(){function A(x,D){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=D}var y=A.prototype;return y.resetTimeStamp=function(){},y.resetInitSegment=function(D,E,m,p){var u=Object(L.parseInitSegment)(D),e=this.videoTrack=Object(M.dummyTrack)("video",1),s=this.audioTrack=Object(M.dummyTrack)("audio",1),c=this.txtTrack=Object(M.dummyTrack)("text",1);if(this.id3Track=Object(M.dummyTrack)("id3",1),this.timeOffset=0,u.video){var g=u.video,i=g.id,r=g.timescale,o=g.codec;e.id=i,e.timescale=c.timescale=r,e.codec=o}if(u.audio){var d=u.audio,t=d.id,n=d.timescale,l=d.codec;s.id=t,s.timescale=n,s.codec=l}c.id=L.RemuxerTrackIdConfig.text,e.sampleDuration=0,e.duration=s.duration=p},y.resetContiguity=function(){},A.probe=function(D){return D=D.length>16384?D.subarray(0,16384):D,Object(L.findBox)(D,["moof"]).length>0},y.demux=function(D,E){this.timeOffset=E;var m=D,p=this.videoTrack,u=this.txtTrack;if(this.config.progressive){this.remainderData&&(m=Object(L.appendUint8Array)(this.remainderData,D));var e=Object(L.segmentValidRange)(m);this.remainderData=e.remainder,p.samples=e.valid||new Uint8Array}else p.samples=m;var s=this.extractID3Track(p,E);return u.samples=Object(L.parseSamples)(E,p),{videoTrack:p,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}},y.flush=function(){var D=this.timeOffset,E=this.videoTrack,m=this.txtTrack;E.samples=this.remainderData||new Uint8Array,this.remainderData=null;var p=this.extractID3Track(E,this.timeOffset);return m.samples=Object(L.parseSamples)(D,E),{videoTrack:E,audioTrack:Object(M.dummyTrack)(),id3Track:p,textTrack:Object(M.dummyTrack)()}},y.extractID3Track=function(D,E){var m=this.id3Track;if(D.samples.length){var p=Object(L.findBox)(D.samples,["emsg"]);p&&p.forEach(function(u){var e=Object(L.parseEmsg)(u);if(R.test(e.schemeIdUri)){var s=Object(P.isFiniteNumber)(e.presentationTime)?e.presentationTime/e.timeScale:E+e.presentationTimeDelta/e.timeScale,c=e.payload;m.samples.push({data:c,len:c.byteLength,dts:s,pts:s,type:_.MetadataSchema.emsg})}})}return m},y.demuxSampleAes=function(D,E,m){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},y.destroy=function(){},A}();O.default=b},"./src/demux/mpegaudio.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"appendFrame",function(){return b}),h.d(O,"parseHeader",function(){return A}),h.d(O,"isHeaderPattern",function(){return y}),h.d(O,"isHeader",function(){return x}),h.d(O,"canParse",function(){return D}),h.d(O,"probe",function(){return E});var P=null,_=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],L=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],M=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],R=[0,1,1,4];function b(m,p,u,e,s){if(!(u+24>p.length)){var c=A(p,u);if(c&&u+c.frameLength<=p.length){var g=c.samplesPerFrame*9e4/c.sampleRate,i=e+s*g,r={unit:p.subarray(u,u+c.frameLength),pts:i,dts:i};return m.config=[],m.channelCount=c.channelCount,m.samplerate=c.sampleRate,m.samples.push(r),{sample:r,length:c.frameLength,missing:0}}}}function A(m,p){var u=m[p+1]>>3&3,e=m[p+1]>>1&3,s=m[p+2]>>4&15,c=m[p+2]>>2&3;if(u!==1&&s!==0&&s!==15&&c!==3){var g=m[p+2]>>1&1,i=m[p+3]>>6,r=u===3?3-e:e===3?3:4,o=_[r*14+s-1]*1e3,d=u===3?0:u===2?1:2,t=L[d*3+c],n=i===3?1:2,l=M[u][e],a=R[e],f=l*8*a,v=Math.floor(l*o/t+g)*a;if(P===null){var S=navigator.userAgent||"",T=S.match(/Chrome\/(\d+)/i);P=T?parseInt(T[1]):0}var I=!!P&&P<=87;return I&&e===2&&o>=224e3&&i===0&&(m[p+3]=m[p+3]|128),{sampleRate:t,channelCount:n,frameLength:v,samplesPerFrame:f}}}function y(m,p){return m[p]===255&&(m[p+1]&224)===224&&(m[p+1]&6)!==0}function x(m,p){return p+1<m.length&&y(m,p)}function D(m,p){var u=4;return y(m,p)&&u<=m.length-p}function E(m,p){if(p+1<m.length&&y(m,p)){var u=4,e=A(m,p),s=u;e!=null&&e.frameLength&&(s=e.frameLength);var c=p+s;return c===m.length||x(m,c)}return!1}},"./src/demux/sample-aes.ts":function(U,O,h){"use strict";h.r(O);var P=h("./src/crypt/decrypter.ts"),_=h("./src/demux/tsdemuxer.ts"),L=function(){function M(b,A,y){this.keyData=void 0,this.decrypter=void 0,this.keyData=y,this.decrypter=new P.default(b,A,{removePKCS7Padding:!1})}var R=M.prototype;return R.decryptBuffer=function(A,y){this.decrypter.decrypt(A,this.keyData.key.buffer,this.keyData.iv.buffer,y)},R.decryptAacSample=function(A,y,x,D){var E=A[y].unit;if(!(E.length<=16)){var m=E.subarray(16,E.length-E.length%16),p=m.buffer.slice(m.byteOffset,m.byteOffset+m.length),u=this;this.decryptBuffer(p,function(e){var s=new Uint8Array(e);E.set(s,16),D||u.decryptAacSamples(A,y+1,x)})}},R.decryptAacSamples=function(A,y,x){for(;;y++){if(y>=A.length){x();return}if(!(A[y].unit.length<32)){var D=this.decrypter.isSync();if(this.decryptAacSample(A,y,x,D),!D)return}}},R.getAvcEncryptedData=function(A){for(var y=Math.floor((A.length-48)/160)*16+16,x=new Int8Array(y),D=0,E=32;E<A.length-16;E+=160,D+=16)x.set(A.subarray(E,E+16),D);return x},R.getAvcDecryptedUnit=function(A,y){for(var x=new Uint8Array(y),D=0,E=32;E<A.length-16;E+=160,D+=16)A.set(x.subarray(D,D+16),E);return A},R.decryptAvcSample=function(A,y,x,D,E,m){var p=Object(_.discardEPB)(E.data),u=this.getAvcEncryptedData(p),e=this;this.decryptBuffer(u.buffer,function(s){E.data=e.getAvcDecryptedUnit(p,s),m||e.decryptAvcSamples(A,y,x+1,D)})},R.decryptAvcSamples=function(A,y,x,D){if(A instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;y++,x=0){if(y>=A.length){D();return}for(var E=A[y].units;!(x>=E.length);x++){var m=E[x];if(!(m.data.length<=48||m.type!==1&&m.type!==5)){var p=this.decrypter.isSync();if(this.decryptAvcSample(A,y,x,D,m,p),!p)return}}}},M}();O.default=L},"./src/demux/transmuxer-interface.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return E});var P=h("./node_modules/webworkify-webpack/index.js"),_=h.n(P),L=h("./src/events.ts"),M=h("./src/demux/transmuxer.ts"),R=h("./src/utils/logger.ts"),b=h("./src/errors.ts"),A=h("./src/utils/mediasource-helper.ts"),y=h("./node_modules/eventemitter3/index.js"),x=h.n(y),D=Object(A.getMediaSource)()||{isTypeSupported:function(){return!1}},E=function(){function m(u,e,s,c){var g=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=u,this.id=e,this.onTransmuxComplete=s,this.onFlush=c;var i=u.config,r=function(l,a){a=a||{},a.frag=g.frag,a.id=g.id,u.trigger(l,a)};this.observer=new y.EventEmitter,this.observer.on(L.Events.FRAG_DECRYPTED,r),this.observer.on(L.Events.ERROR,r);var o={mp4:D.isTypeSupported("video/mp4"),mpeg:D.isTypeSupported("audio/mpeg"),mp3:D.isTypeSupported('audio/mp4; codecs="mp3"')},d=navigator.vendor;if(i.enableWorker&&typeof Worker!="undefined"){R.logger.log("demuxing in webworker");var t;try{t=this.worker=P("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),t.addEventListener("message",this.onwmsg),t.onerror=function(n){u.trigger(L.Events.ERROR,{type:b.ErrorTypes.OTHER_ERROR,details:b.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(n.message+"  ("+n.filename+":"+n.lineno+")")})},t.postMessage({cmd:"init",typeSupported:o,vendor:d,id:e,config:JSON.stringify(i)})}catch(n){R.logger.warn("Error in worker:",n),R.logger.error("Error while initializing DemuxerWorker, fallback to inline"),t&&self.URL.revokeObjectURL(t.objectURL),this.transmuxer=new M.default(this.observer,o,i,d,e),this.worker=null}}else this.transmuxer=new M.default(this.observer,o,i,d,e)}var p=m.prototype;return p.destroy=function(){var e=this.worker;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.worker=null,this.onwmsg=void 0;else{var s=this.transmuxer;s&&(s.destroy(),this.transmuxer=null)}var c=this.observer;c&&c.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},p.push=function(e,s,c,g,i,r,o,d,t,n){var l,a,f=this;t.transmuxing.start=self.performance.now();var v=this.transmuxer,S=this.worker,T=r?r.start:i.start,I=i.decryptdata,k=this.frag,B=!(k&&i.cc===k.cc),N=!(k&&t.level===k.level),W=k?t.sn-k.sn:-1,G=this.part?t.part-this.part.index:-1,z=W===0&&t.id>1&&t.id===(k==null?void 0:k.stats.chunkCount),Y=!N&&(W===1||W===0&&(G===1||z&&G<=0)),$=self.performance.now();(N||W||i.stats.parsing.start===0)&&(i.stats.parsing.start=$),r&&(G||!Y)&&(r.stats.parsing.start=$);var Z=!(k&&((l=i.initSegment)===null||l===void 0?void 0:l.url)===((a=k.initSegment)===null||a===void 0?void 0:a.url)),q=new M.TransmuxState(B,Y,d,N,T,Z);if(!Y||B||Z){R.logger.log("[transmuxer-interface, "+i.type+"]: Starting new transmux session for sn: "+t.sn+" p: "+t.part+" level: "+t.level+" id: "+t.id+`
        discontinuity: `+B+`
        trackSwitch: `+N+`
        contiguous: `+Y+`
        accurateTimeOffset: `+d+`
        timeOffset: `+T+`
        initSegmentChange: `+Z);var ie=new M.TransmuxConfig(c,g,s,o,n);this.configureTransmuxer(ie)}if(this.frag=i,this.part=r,S)S.postMessage({cmd:"demux",data:e,decryptdata:I,chunkMeta:t,state:q},e instanceof ArrayBuffer?[e]:[]);else if(v){var ne=v.push(e,I,t,q);Object(M.isPromise)(ne)?ne.then(function(ae){f.handleTransmuxComplete(ae)}):this.handleTransmuxComplete(ne)}},p.flush=function(e){var s=this;e.transmuxing.start=self.performance.now();var c=this.transmuxer,g=this.worker;if(g)g.postMessage({cmd:"flush",chunkMeta:e});else if(c){var i=c.flush(e);Object(M.isPromise)(i)?i.then(function(r){s.handleFlushResult(r,e)}):this.handleFlushResult(i,e)}},p.handleFlushResult=function(e,s){var c=this;e.forEach(function(g){c.handleTransmuxComplete(g)}),this.onFlush(s)},p.onWorkerMessage=function(e){var s=e.data,c=this.hls;switch(s.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(s.data);break}case"flush":{this.onFlush(s.data);break}case"workerLog":R.logger[s.data.logType]&&R.logger[s.data.logType](s.data.message);break;default:{s.data=s.data||{},s.data.frag=this.frag,s.data.id=this.id,c.trigger(s.event,s.data);break}}},p.configureTransmuxer=function(e){var s=this.worker,c=this.transmuxer;s?s.postMessage({cmd:"configure",config:e}):c&&c.configure(e)},p.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},m}()},"./src/demux/transmuxer-worker.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return b});var P=h("./src/demux/transmuxer.ts"),_=h("./src/events.ts"),L=h("./src/utils/logger.ts"),M=h("./node_modules/eventemitter3/index.js"),R=h.n(M);function b(E){var m=new M.EventEmitter,p=function(s,c){E.postMessage({event:s,data:c})};m.on(_.Events.FRAG_DECRYPTED,p),m.on(_.Events.ERROR,p);var u=function(){var s=function(i){var r=function(d){p("workerLog",{logType:i,message:d})};L.logger[i]=r};for(var c in L.logger)s(c)};E.addEventListener("message",function(e){var s=e.data;switch(s.cmd){case"init":{var c=JSON.parse(s.config);E.transmuxer=new P.default(m,s.typeSupported,c,s.vendor,s.id),Object(L.enableLogs)(c.debug),u(),p("init",null);break}case"configure":{E.transmuxer.configure(s.config);break}case"demux":{var g=E.transmuxer.push(s.data,s.decryptdata,s.chunkMeta,s.state);Object(P.isPromise)(g)?g.then(function(o){A(E,o)}):A(E,g);break}case"flush":{var i=s.chunkMeta,r=E.transmuxer.flush(i);Object(P.isPromise)(r)?r.then(function(o){x(E,o,i)}):x(E,r,i);break}default:break}})}function A(E,m){if(D(m.remuxResult))return!1;var p=[],u=m.remuxResult,e=u.audio,s=u.video;return e&&y(p,e),s&&y(p,s),E.postMessage({event:"transmuxComplete",data:m},p),!0}function y(E,m){m.data1&&E.push(m.data1.buffer),m.data2&&E.push(m.data2.buffer)}function x(E,m,p){var u=m.reduce(function(e,s){return A(E,s)||e},!1);u||E.postMessage({event:"transmuxComplete",data:m[0]}),E.postMessage({event:"flush",data:p})}function D(E){return!E.audio&&!E.video&&!E.text&&!E.id3&&!E.initSegment}},"./src/demux/transmuxer.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return p}),h.d(O,"isPromise",function(){return s}),h.d(O,"TransmuxConfig",function(){return c}),h.d(O,"TransmuxState",function(){return g});var P=h("./src/events.ts"),_=h("./src/errors.ts"),L=h("./src/crypt/decrypter.ts"),M=h("./src/demux/aacdemuxer.ts"),R=h("./src/demux/mp4demuxer.ts"),b=h("./src/demux/tsdemuxer.ts"),A=h("./src/demux/mp3demuxer.ts"),y=h("./src/remux/mp4-remuxer.ts"),x=h("./src/remux/passthrough-remuxer.ts"),D=h("./src/utils/logger.ts"),E;try{E=self.performance.now.bind(self.performance)}catch{D.logger.debug("Unable to use Performance API on this environment"),E=self.Date.now}var m=[{demux:b.default,remux:y.default},{demux:R.default,remux:x.default},{demux:M.default,remux:y.default},{demux:A.default,remux:y.default}],p=function(){function i(o,d,t,n,l){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=o,this.typeSupported=d,this.config=t,this.vendor=n,this.id=l}var r=i.prototype;return r.configure=function(d){this.transmuxConfig=d,this.decrypter&&this.decrypter.reset()},r.push=function(d,t,n,l){var a=this,f=n.transmuxing;f.executeStart=E();var v=new Uint8Array(d),S=this.config,T=this.currentTransmuxState,I=this.transmuxConfig;l&&(this.currentTransmuxState=l);var k=l||T,B=k.contiguous,N=k.discontinuity,W=k.trackSwitch,G=k.accurateTimeOffset,z=k.timeOffset,Y=k.initSegmentChange,$=I.audioCodec,Z=I.videoCodec,q=I.defaultInitPts,ie=I.duration,ne=I.initSegmentData;(N||W||Y)&&this.resetInitSegment(ne,$,Z,ie),(N||Y)&&this.resetInitialTimestamp(q),B||this.resetContiguity();var ae=u(v,t);if(ae&&ae.method==="AES-128"){var te=this.getDecrypter();if(S.enableSoftwareAES){var fe=te.softwareDecrypt(v,ae.key.buffer,ae.iv.buffer);if(!fe)return f.executeEnd=E(),e(n);v=new Uint8Array(fe)}else return this.decryptionPromise=te.webCryptoDecrypt(v,ae.key.buffer,ae.iv.buffer).then(function(Ee){var me=a.push(Ee,null,n);return a.decryptionPromise=null,me}),this.decryptionPromise}this.needsProbing(v,N,W)&&this.configureTransmuxer(v,I);var de=this.transmux(v,ae,z,G,n),re=this.currentTransmuxState;return re.contiguous=!0,re.discontinuity=!1,re.trackSwitch=!1,f.executeEnd=E(),de},r.flush=function(d){var t=this,n=d.transmuxing;n.executeStart=E();var l=this.decrypter,a=this.currentTransmuxState,f=this.decryptionPromise;if(f)return f.then(function(){return t.flush(d)});var v=[],S=a.timeOffset;if(l){var T=l.flush();T&&v.push(this.push(T,null,d))}var I=this.demuxer,k=this.remuxer;if(!I||!k)return this.observer.emit(P.Events.ERROR,P.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),n.executeEnd=E(),[e(d)];var B=I.flush(S);return s(B)?B.then(function(N){return t.flushRemux(v,N,d),v}):(this.flushRemux(v,B,d),v)},r.flushRemux=function(d,t,n){var l=t.audioTrack,a=t.videoTrack,f=t.id3Track,v=t.textTrack,S=this.currentTransmuxState,T=S.accurateTimeOffset,I=S.timeOffset;D.logger.log("[transmuxer.ts]: Flushed fragment "+n.sn+(n.part>-1?" p: "+n.part:"")+" of level "+n.level);var k=this.remuxer.remux(l,a,f,v,I,T,!0,this.id);d.push({remuxResult:k,chunkMeta:n}),n.transmuxing.executeEnd=E()},r.resetInitialTimestamp=function(d){var t=this.demuxer,n=this.remuxer;!t||!n||(t.resetTimeStamp(d),n.resetTimeStamp(d))},r.resetContiguity=function(){var d=this.demuxer,t=this.remuxer;!d||!t||(d.resetContiguity(),t.resetNextTimestamp())},r.resetInitSegment=function(d,t,n,l){var a=this.demuxer,f=this.remuxer;!a||!f||(a.resetInitSegment(d,t,n,l),f.resetInitSegment(d,t,n))},r.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},r.transmux=function(d,t,n,l,a){var f;return t&&t.method==="SAMPLE-AES"?f=this.transmuxSampleAes(d,t,n,l,a):f=this.transmuxUnencrypted(d,n,l,a),f},r.transmuxUnencrypted=function(d,t,n,l){var a=this.demuxer.demux(d,t,!1,!this.config.progressive),f=a.audioTrack,v=a.videoTrack,S=a.id3Track,T=a.textTrack,I=this.remuxer.remux(f,v,S,T,t,n,!1,this.id);return{remuxResult:I,chunkMeta:l}},r.transmuxSampleAes=function(d,t,n,l,a){var f=this;return this.demuxer.demuxSampleAes(d,t,n).then(function(v){var S=f.remuxer.remux(v.audioTrack,v.videoTrack,v.id3Track,v.textTrack,n,l,!1,f.id);return{remuxResult:S,chunkMeta:a}})},r.configureTransmuxer=function(d,t){for(var n=this.config,l=this.observer,a=this.typeSupported,f=this.vendor,v=t.audioCodec,S=t.defaultInitPts,T=t.duration,I=t.initSegmentData,k=t.videoCodec,B,N=0,W=m.length;N<W;N++)if(m[N].demux.probe(d)){B=m[N];break}B||(D.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),B={demux:R.default,remux:x.default});var G=this.demuxer,z=this.remuxer,Y=B.remux,$=B.demux;(!z||!(z instanceof Y))&&(this.remuxer=new Y(l,n,a,f)),(!G||!(G instanceof $))&&(this.demuxer=new $(l,n,a),this.probe=$.probe),this.resetInitSegment(I,v,k,T),this.resetInitialTimestamp(S)},r.needsProbing=function(d,t,n){return!this.demuxer||!this.remuxer||t||n},r.getDecrypter=function(){var d=this.decrypter;return d||(d=this.decrypter=new L.default(this.observer,this.config)),d},i}();function u(i,r){var o=null;return i.byteLength>0&&r!=null&&r.key!=null&&r.iv!==null&&r.method!=null&&(o=r),o}var e=function(r){return{remuxResult:{},chunkMeta:r}};function s(i){return"then"in i&&i.then instanceof Function}var c=function(r,o,d,t,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=r,this.videoCodec=o,this.initSegmentData=d,this.duration=t,this.defaultInitPts=n},g=function(r,o,d,t,n,l){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=r,this.contiguous=o,this.accurateTimeOffset=d,this.trackSwitch=t,this.timeOffset=n,this.initSegmentChange=l}},"./src/demux/tsdemuxer.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"discardEPB",function(){return c});var P=h("./src/demux/adts.ts"),_=h("./src/demux/mpegaudio.ts"),L=h("./src/demux/exp-golomb.ts"),M=h("./src/demux/sample-aes.ts"),R=h("./src/events.ts"),b=h("./src/utils/mp4-tools.ts"),A=h("./src/utils/logger.ts"),y=h("./src/errors.ts"),x=h("./src/types/demuxer.ts");function D(){return D=Object.assign?Object.assign.bind():function(g){for(var i=1;i<arguments.length;i++){var r=arguments[i];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(g[o]=r[o])}return g},D.apply(this,arguments)}var E=function(){function g(r,o,d){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=r,this.config=o,this.typeSupported=d}g.probe=function(o){return o[0]===71&&o[188]===71},g.createTrack=function(o,d){return{container:o==="video"||o==="audio"?"video/mp2t":void 0,type:o,id:b.RemuxerTrackIdConfig[o],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:o==="audio"?d:void 0}};var i=g.prototype;return i.resetInitSegment=function(o,d,t,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=g.createTrack("video"),this._audioTrack=g.createTrack("audio",n),this._id3Track=g.createTrack("id3"),this._txtTrack=g.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=d,this.videoCodec=t,this._duration=n},i.resetTimeStamp=function(){},i.resetContiguity=function(){var o=this._audioTrack,d=this._avcTrack,t=this._id3Track;o&&(o.pesData=null),d&&(d.pesData=null),t&&(t.pesData=null),this.aacOverFlow=null},i.demux=function(o,d,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1),t||(this.sampleAes=null);var l,a=this._avcTrack,f=this._audioTrack,v=this._id3Track,S=this._txtTrack,T=a.pid,I=a.pesData,k=f.pid,B=v.pid,N=f.pesData,W=v.pesData,G=null,z=this.pmtParsed,Y=this._pmtId,$=o.length;if(this.remainderData&&(o=Object(b.appendUint8Array)(this.remainderData,o),$=o.length,this.remainderData=null),$<188&&!n)return this.remainderData=o,{audioTrack:f,videoTrack:a,id3Track:v,textTrack:S};$-=$%188,$<o.byteLength&&!n&&(this.remainderData=new Uint8Array(o.buffer,$,o.buffer.byteLength-$));for(var Z=0,q=0;q<$;q+=188)if(o[q]===71){var ie=!!(o[q+1]&64),ne=((o[q+1]&31)<<8)+o[q+2],ae=(o[q+3]&48)>>4,te=void 0;if(ae>1){if(te=q+5+o[q+4],te===q+188)continue}else te=q+4;switch(ne){case T:ie&&(I&&(l=e(I))&&this.parseAVCPES(a,S,l,!1),I={data:[],size:0}),I&&(I.data.push(o.subarray(te,q+188)),I.size+=q+188-te);break;case k:if(ie){if(N&&(l=e(N)))switch(f.segmentCodec){case"aac":this.parseAACPES(f,l);break;case"mp3":this.parseMPEGPES(f,l);break}N={data:[],size:0}}N&&(N.data.push(o.subarray(te,q+188)),N.size+=q+188-te);break;case B:ie&&(W&&(l=e(W))&&this.parseID3PES(v,l),W={data:[],size:0}),W&&(W.data.push(o.subarray(te,q+188)),W.size+=q+188-te);break;case 0:ie&&(te+=o[te]+1),Y=this._pmtId=p(o,te);break;case Y:{ie&&(te+=o[te]+1);var fe=u(o,te,this.typeSupported,t);T=fe.avc,T>0&&(a.pid=T),k=fe.audio,k>0&&(f.pid=k,f.segmentCodec=fe.segmentCodec),B=fe.id3,B>0&&(v.pid=B),G!==null&&!z&&(A.logger.log("unknown PID '"+G+"' in TS found"),G=null),z=this.pmtParsed=!0;break}case 17:case 8191:break;default:G=ne;break}}else Z++;Z>0&&this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+Z+" TS packet/s that do not start with 0x47"}),a.pesData=I,f.pesData=N,v.pesData=W;var de={audioTrack:f,videoTrack:a,id3Track:v,textTrack:S};return n&&this.extractRemainingSamples(de),de},i.flush=function(){var o=this.remainderData;this.remainderData=null;var d;return o?d=this.demux(o,-1,!1,!0):d={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(d),this.sampleAes?this.decrypt(d,this.sampleAes):d},i.extractRemainingSamples=function(o){var d=o.audioTrack,t=o.videoTrack,n=o.id3Track,l=o.textTrack,a=t.pesData,f=d.pesData,v=n.pesData,S;if(a&&(S=e(a))?(this.parseAVCPES(t,l,S,!0),t.pesData=null):t.pesData=a,f&&(S=e(f))){switch(d.segmentCodec){case"aac":this.parseAACPES(d,S);break;case"mp3":this.parseMPEGPES(d,S);break}d.pesData=null}else f!=null&&f.size&&A.logger.log("last AAC PES packet truncated,might overlap between fragments"),d.pesData=f;v&&(S=e(v))?(this.parseID3PES(n,S),n.pesData=null):n.pesData=v},i.demuxSampleAes=function(o,d,t){var n=this.demux(o,t,!0,!this.config.progressive),l=this.sampleAes=new M.default(this.observer,this.config,d);return this.decrypt(n,l)},i.decrypt=function(o,d){return new Promise(function(t){var n=o.audioTrack,l=o.videoTrack;n.samples&&n.segmentCodec==="aac"?d.decryptAacSamples(n.samples,0,function(){l.samples?d.decryptAvcSamples(l.samples,0,0,function(){t(o)}):t(o)}):l.samples&&d.decryptAvcSamples(l.samples,0,0,function(){t(o)})})},i.destroy=function(){this._duration=0},i.parseAVCPES=function(o,d,t,n){var l=this,a=this.parseAVCNALu(o,t.data),f=!1,v=this.avcSample,S,T=!1;t.data=null,v&&a.length&&!o.audFound&&(s(v,o),v=this.avcSample=m(!1,t.pts,t.dts,"")),a.forEach(function(I){switch(I.type){case 1:{S=!0,v||(v=l.avcSample=m(!0,t.pts,t.dts,"")),f&&(v.debug+="NDR "),v.frame=!0;var k=I.data;if(T&&k.length>4){var B=new L.default(k).readSliceType();(B===2||B===4||B===7||B===9)&&(v.key=!0)}break}case 5:S=!0,v||(v=l.avcSample=m(!0,t.pts,t.dts,"")),f&&(v.debug+="IDR "),v.key=!0,v.frame=!0;break;case 6:{S=!0,f&&v&&(v.debug+="SEI "),Object(b.parseSEIMessageFromNALu)(c(I.data),t.pts,d.samples);break}case 7:if(S=!0,T=!0,f&&v&&(v.debug+="SPS "),!o.sps){var N=new L.default(I.data),W=N.readSPS();o.width=W.width,o.height=W.height,o.pixelRatio=W.pixelRatio,o.sps=[I.data],o.duration=l._duration;for(var G=I.data.subarray(1,4),z="avc1.",Y=0;Y<3;Y++){var $=G[Y].toString(16);$.length<2&&($="0"+$),z+=$}o.codec=z}break;case 8:S=!0,f&&v&&(v.debug+="PPS "),o.pps||(o.pps=[I.data]);break;case 9:S=!1,o.audFound=!0,v&&s(v,o),v=l.avcSample=m(!1,t.pts,t.dts,f?"AUD ":"");break;case 12:S=!0;break;default:S=!1,v&&(v.debug+="unknown NAL "+I.type+" ");break}if(v&&S){var Z=v.units;Z.push(I)}}),n&&v&&(s(v,o),this.avcSample=null)},i.getLastNalUnit=function(o){var d,t=this.avcSample,n;if((!t||t.units.length===0)&&(t=o[o.length-1]),(d=t)!==null&&d!==void 0&&d.units){var l=t.units;n=l[l.length-1]}return n},i.parseAVCNALu=function(o,d){var t=d.byteLength,n=o.naluState||0,l=n,a=[],f=0,v,S,T,I=-1,k=0;for(n===-1&&(I=0,k=d[0]&31,n=0,f=1);f<t;){if(v=d[f++],!n){n=v?0:1;continue}if(n===1){n=v?0:2;continue}if(!v)n=3;else if(v===1){if(I>=0){var B={data:d.subarray(I,f-n-1),type:k};a.push(B)}else{var N=this.getLastNalUnit(o.samples);if(N&&(l&&f<=4-l&&N.state&&(N.data=N.data.subarray(0,N.data.byteLength-l)),S=f-n-1,S>0)){var W=new Uint8Array(N.data.byteLength+S);W.set(N.data,0),W.set(d.subarray(0,S),N.data.byteLength),N.data=W,N.state=0}}f<t?(T=d[f]&31,I=f,k=T,n=0):n=-1}else n=0}if(I>=0&&n>=0){var G={data:d.subarray(I,t),type:k,state:n};a.push(G)}if(a.length===0){var z=this.getLastNalUnit(o.samples);if(z){var Y=new Uint8Array(z.data.byteLength+d.byteLength);Y.set(z.data,0),Y.set(d,z.data.byteLength),z.data=Y}}return o.naluState=n,a},i.parseAACPES=function(o,d){var t=0,n=this.aacOverFlow,l=d.data;if(n){this.aacOverFlow=null;var a=n.missing,f=n.sample.unit.byteLength;if(a===-1){var v=new Uint8Array(f+l.byteLength);v.set(n.sample.unit,0),v.set(l,f),l=v}else{var S=f-a;n.sample.unit.set(l.subarray(0,a),S),o.samples.push(n.sample),t=n.missing}}var T,I;for(T=t,I=l.length;T<I-1&&!P.isHeader(l,T);T++);if(T!==t){var k,B;if(T<I-1?(k="AAC PES did not start with ADTS header,offset:"+T,B=!1):(k="no ADTS header found in AAC PES",B=!0),A.logger.warn("parsing error:"+k),this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:B,reason:k}),B)return}P.initTrackConfig(o,this.observer,l,T,this.audioCodec);var N;if(d.pts!==void 0)N=d.pts;else if(n){var W=P.getFrameDuration(o.samplerate);N=n.sample.pts+W}else{A.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var G=0,z;T<I;)if(z=P.appendFrame(o,l,T,N,G),T+=z.length,z.missing){this.aacOverFlow=z;break}else for(G++;T<I-1&&!P.isHeader(l,T);T++);},i.parseMPEGPES=function(o,d){var t=d.data,n=t.length,l=0,a=0,f=d.pts;if(f===void 0){A.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<n;)if(_.isHeader(t,a)){var v=_.appendFrame(o,t,a,f,l);if(v)a+=v.length,l++;else break}else a++},i.parseID3PES=function(o,d){if(d.pts===void 0){A.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var t=D({},d,{type:this._avcTrack?x.MetadataSchema.emsg:x.MetadataSchema.audioId3});o.samples.push(t)},g}();function m(g,i,r,o){return{key:g,frame:!1,pts:i,dts:r,units:[],debug:o,length:0}}function p(g,i){return(g[i+10]&31)<<8|g[i+11]}function u(g,i,r,o){var d={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},t=(g[i+1]&15)<<8|g[i+2],n=i+3+t-4,l=(g[i+10]&15)<<8|g[i+11];for(i+=12+l;i<n;){var a=(g[i+1]&31)<<8|g[i+2];switch(g[i]){case 207:if(!o){A.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:d.audio===-1&&(d.audio=a);break;case 21:d.id3===-1&&(d.id3=a);break;case 219:if(!o){A.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:d.avc===-1&&(d.avc=a);break;case 3:case 4:r.mpeg!==!0&&r.mp3!==!0?A.logger.log("MPEG audio found, not supported in this browser"):d.audio===-1&&(d.audio=a,d.segmentCodec="mp3");break;case 36:A.logger.warn("Unsupported HEVC stream type found");break;default:break}i+=((g[i+3]&15)<<8|g[i+4])+5}return d}function e(g){var i=0,r,o,d,t,n,l=g.data;if(!g||g.size===0)return null;for(;l[0].length<19&&l.length>1;){var a=new Uint8Array(l[0].length+l[1].length);a.set(l[0]),a.set(l[1],l[0].length),l[0]=a,l.splice(1,1)}r=l[0];var f=(r[0]<<16)+(r[1]<<8)+r[2];if(f===1){if(o=(r[4]<<8)+r[5],o&&o>g.size-6)return null;var v=r[7];v&192&&(t=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,v&64?(n=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,t-n>60*9e4&&(A.logger.warn(Math.round((t-n)/9e4)+"s delta between PTS and DTS, align them"),t=n)):n=t),d=r[8];var S=d+9;if(g.size<=S)return null;g.size-=S;for(var T=new Uint8Array(g.size),I=0,k=l.length;I<k;I++){r=l[I];var B=r.byteLength;if(S)if(S>B){S-=B;continue}else r=r.subarray(S),B-=S,S=0;T.set(r,i),i+=B}return o&&(o-=d+3),{data:T,pts:t,dts:n,len:o}}return null}function s(g,i){if(g.units.length&&g.frame){if(g.pts===void 0){var r=i.samples,o=r.length;if(o){var d=r[o-1];g.pts=d.pts,g.dts=d.dts}else{i.dropped++;return}}i.samples.push(g)}g.debug.length&&A.logger.log(g.pts+"/"+g.dts+":"+g.debug)}function c(g){for(var i=g.byteLength,r=[],o=1;o<i-2;)g[o]===0&&g[o+1]===0&&g[o+2]===3?(r.push(o+2),o+=2):o++;if(r.length===0)return g;var d=i-r.length,t=new Uint8Array(d),n=0;for(o=0;o<d;n++,o++)n===r[0]&&(n++,r.shift()),t[o]=g[n];return t}O.default=E},"./src/errors.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"ErrorTypes",function(){return P}),h.d(O,"ErrorDetails",function(){return _});var P;(function(L){L.NETWORK_ERROR="networkError",L.MEDIA_ERROR="mediaError",L.KEY_SYSTEM_ERROR="keySystemError",L.MUX_ERROR="muxError",L.OTHER_ERROR="otherError"})(P||(P={}));var _;(function(L){L.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",L.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",L.KEY_SYSTEM_NO_SESSION="keySystemNoSession",L.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",L.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",L.MANIFEST_LOAD_ERROR="manifestLoadError",L.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",L.MANIFEST_PARSING_ERROR="manifestParsingError",L.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",L.LEVEL_EMPTY_ERROR="levelEmptyError",L.LEVEL_LOAD_ERROR="levelLoadError",L.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",L.LEVEL_SWITCH_ERROR="levelSwitchError",L.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",L.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",L.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",L.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",L.FRAG_LOAD_ERROR="fragLoadError",L.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",L.FRAG_DECRYPT_ERROR="fragDecryptError",L.FRAG_PARSING_ERROR="fragParsingError",L.REMUX_ALLOC_ERROR="remuxAllocError",L.KEY_LOAD_ERROR="keyLoadError",L.KEY_LOAD_TIMEOUT="keyLoadTimeOut",L.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",L.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",L.BUFFER_APPEND_ERROR="bufferAppendError",L.BUFFER_APPENDING_ERROR="bufferAppendingError",L.BUFFER_STALLED_ERROR="bufferStalledError",L.BUFFER_FULL_ERROR="bufferFullError",L.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",L.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",L.INTERNAL_EXCEPTION="internalException",L.INTERNAL_ABORTED="aborted",L.UNKNOWN="unknown"})(_||(_={}))},"./src/events.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"Events",function(){return P});var P;(function(_){_.MEDIA_ATTACHING="hlsMediaAttaching",_.MEDIA_ATTACHED="hlsMediaAttached",_.MEDIA_DETACHING="hlsMediaDetaching",_.MEDIA_DETACHED="hlsMediaDetached",_.BUFFER_RESET="hlsBufferReset",_.BUFFER_CODECS="hlsBufferCodecs",_.BUFFER_CREATED="hlsBufferCreated",_.BUFFER_APPENDING="hlsBufferAppending",_.BUFFER_APPENDED="hlsBufferAppended",_.BUFFER_EOS="hlsBufferEos",_.BUFFER_FLUSHING="hlsBufferFlushing",_.BUFFER_FLUSHED="hlsBufferFlushed",_.MANIFEST_LOADING="hlsManifestLoading",_.MANIFEST_LOADED="hlsManifestLoaded",_.MANIFEST_PARSED="hlsManifestParsed",_.LEVEL_SWITCHING="hlsLevelSwitching",_.LEVEL_SWITCHED="hlsLevelSwitched",_.LEVEL_LOADING="hlsLevelLoading",_.LEVEL_LOADED="hlsLevelLoaded",_.LEVEL_UPDATED="hlsLevelUpdated",_.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",_.LEVELS_UPDATED="hlsLevelsUpdated",_.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",_.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",_.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",_.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",_.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",_.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",_.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",_.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",_.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",_.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",_.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",_.CUES_PARSED="hlsCuesParsed",_.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",_.INIT_PTS_FOUND="hlsInitPtsFound",_.FRAG_LOADING="hlsFragLoading",_.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",_.FRAG_LOADED="hlsFragLoaded",_.FRAG_DECRYPTED="hlsFragDecrypted",_.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",_.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",_.FRAG_PARSING_METADATA="hlsFragParsingMetadata",_.FRAG_PARSED="hlsFragParsed",_.FRAG_BUFFERED="hlsFragBuffered",_.FRAG_CHANGED="hlsFragChanged",_.FPS_DROP="hlsFpsDrop",_.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",_.ERROR="hlsError",_.DESTROYING="hlsDestroying",_.KEY_LOADING="hlsKeyLoading",_.KEY_LOADED="hlsKeyLoaded",_.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",_.BACK_BUFFER_REACHED="hlsBackBufferReached"})(P||(P={}))},"./src/hls.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return i});var P=h("./node_modules/url-toolkit/src/url-toolkit.js"),_=h.n(P),L=h("./src/loader/playlist-loader.ts"),M=h("./src/loader/key-loader.ts"),R=h("./src/controller/id3-track-controller.ts"),b=h("./src/controller/latency-controller.ts"),A=h("./src/controller/level-controller.ts"),y=h("./src/controller/fragment-tracker.ts"),x=h("./src/controller/stream-controller.ts"),D=h("./src/is-supported.ts"),E=h("./src/utils/logger.ts"),m=h("./src/config.ts"),p=h("./node_modules/eventemitter3/index.js"),u=h.n(p),e=h("./src/events.ts"),s=h("./src/errors.ts");function c(r,o){for(var d=0;d<o.length;d++){var t=o[d];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function g(r,o,d){return o&&c(r.prototype,o),d&&c(r,d),Object.defineProperty(r,"prototype",{writable:!1}),r}var i=function(){r.isSupported=function(){return Object(D.isSupported)()};function r(d){d===void 0&&(d={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new p.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var t=this.config=Object(m.mergeConfig)(r.DefaultConfig,d);this.userConfig=d,Object(E.enableLogs)(t.debug),this._autoLevelCapping=-1,t.progressive&&Object(m.enableStreamingMode)(t);var n=t.abrController,l=t.bufferController,a=t.capLevelController,f=t.fpsController,v=this.abrController=new n(this),S=this.bufferController=new l(this),T=this.capLevelController=new a(this),I=new f(this),k=new L.default(this),B=new M.default(this),N=new R.default(this),W=this.levelController=new A.default(this),G=new y.FragmentTracker(this),z=this.streamController=new x.default(this,G);T.setStreamController(z),I.setStreamController(z);var Y=[k,B,W,z];this.networkControllers=Y;var $=[v,S,T,I,N,G];this.audioTrackController=this.createController(t.audioTrackController,null,Y),this.createController(t.audioStreamController,G,Y),this.subtitleTrackController=this.createController(t.subtitleTrackController,null,Y),this.createController(t.subtitleStreamController,G,Y),this.createController(t.timelineController,null,$),this.emeController=this.createController(t.emeController,null,$),this.cmcdController=this.createController(t.cmcdController,null,$),this.latencyController=this.createController(b.default,null,$),this.coreComponents=$}var o=r.prototype;return o.createController=function(t,n,l){if(t){var a=n?new t(this,n):new t(this);return l&&l.push(a),a}return null},o.on=function(t,n,l){l===void 0&&(l=this),this._emitter.on(t,n,l)},o.once=function(t,n,l){l===void 0&&(l=this),this._emitter.once(t,n,l)},o.removeAllListeners=function(t){this._emitter.removeAllListeners(t)},o.off=function(t,n,l,a){l===void 0&&(l=this),this._emitter.off(t,n,l,a)},o.listeners=function(t){return this._emitter.listeners(t)},o.emit=function(t,n,l){return this._emitter.emit(t,n,l)},o.trigger=function(t,n){if(this.config.debug)return this.emit(t,t,n);try{return this.emit(t,t,n)}catch(l){E.logger.error("An internal error happened while handling event "+t+'. Error message: "'+l.message+'". Here is a stacktrace:',l),this.trigger(e.Events.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,error:l})}return!1},o.listenerCount=function(t){return this._emitter.listenerCount(t)},o.destroy=function(){E.logger.log("destroy"),this.trigger(e.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(t){return t.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(t){return t.destroy()}),this.coreComponents.length=0},o.attachMedia=function(t){E.logger.log("attachMedia"),this._media=t,this.trigger(e.Events.MEDIA_ATTACHING,{media:t})},o.detachMedia=function(){E.logger.log("detachMedia"),this.trigger(e.Events.MEDIA_DETACHING,void 0),this._media=null},o.loadSource=function(t){this.stopLoad();var n=this.media,l=this.url,a=this.url=P.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});E.logger.log("loadSource:"+a),n&&l&&l!==a&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(n)),this.trigger(e.Events.MANIFEST_LOADING,{url:t})},o.startLoad=function(t){t===void 0&&(t=-1),E.logger.log("startLoad("+t+")"),this.networkControllers.forEach(function(n){n.startLoad(t)})},o.stopLoad=function(){E.logger.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()})},o.swapAudioCodec=function(){E.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},o.recoverMediaError=function(){E.logger.log("recoverMediaError");var t=this._media;this.detachMedia(),t&&this.attachMedia(t)},o.removeLevel=function(t,n){n===void 0&&(n=0),this.levelController.removeLevel(t,n)},g(r,[{key:"levels",get:function(){var t=this.levelController.levels;return t||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){E.logger.log("set currentLevel:"+t),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){E.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){E.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){E.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){E.logger.log("set startLevel:"+t),t!==-1&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(t){var n=!!t;n!==this.config.capLevelToPlayerSize&&(n?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=n)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){this._autoLevelCapping!==t&&(E.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t)}},{key:"bandwidthEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var t=this.levels,n=this.config.minAutoBitrate;if(!t)return 0;for(var l=t.length,a=0;a<l;a++)if(t[a].maxBitrate>=n)return a;return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,n=this.autoLevelCapping,l;return n===-1&&t&&t.length?l=t.length-1:l=n,l}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var n=this.audioTrackController;n&&(n.audioTrack=t)}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var n=this.subtitleTrackController;n&&(n.subtitleTrack=t)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return t?t.subtitleDisplay:!1},set:function(t){var n=this.subtitleTrackController;n&&(n.subtitleDisplay=t)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(t){this.config.lowLatencyMode=t}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.3"}},{key:"Events",get:function(){return e.Events}},{key:"ErrorTypes",get:function(){return s.ErrorTypes}},{key:"ErrorDetails",get:function(){return s.ErrorDetails}},{key:"DefaultConfig",get:function(){return r.defaultConfig?r.defaultConfig:m.hlsDefaultConfig},set:function(t){r.defaultConfig=t}}]),r}();i.defaultConfig=void 0},"./src/is-supported.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"isSupported",function(){return L}),h.d(O,"changeTypeSupported",function(){return M});var P=h("./src/utils/mediasource-helper.ts");function _(){return self.SourceBuffer||self.WebKitSourceBuffer}function L(){var R=Object(P.getMediaSource)();if(!R)return!1;var b=_(),A=R&&typeof R.isTypeSupported=="function"&&R.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),y=!b||b.prototype&&typeof b.prototype.appendBuffer=="function"&&typeof b.prototype.remove=="function";return!!A&&!!y}function M(){var R,b=_();return typeof(b==null||(R=b.prototype)===null||R===void 0?void 0:R.changeType)=="function"}},"./src/loader/date-range.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"DateRangeAttribute",function(){return A}),h.d(O,"DateRange",function(){return y});var P=h("./src/polyfills/number.ts"),_=h("./src/utils/attr-list.ts"),L=h("./src/utils/logger.ts");function M(){return M=Object.assign?Object.assign.bind():function(x){for(var D=1;D<arguments.length;D++){var E=arguments[D];for(var m in E)Object.prototype.hasOwnProperty.call(E,m)&&(x[m]=E[m])}return x},M.apply(this,arguments)}function R(x,D){for(var E=0;E<D.length;E++){var m=D[E];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(x,m.key,m)}}function b(x,D,E){return D&&R(x.prototype,D),E&&R(x,E),Object.defineProperty(x,"prototype",{writable:!1}),x}var A;(function(x){x.ID="ID",x.CLASS="CLASS",x.START_DATE="START-DATE",x.DURATION="DURATION",x.END_DATE="END-DATE",x.END_ON_NEXT="END-ON-NEXT",x.PLANNED_DURATION="PLANNED-DURATION",x.SCTE35_OUT="SCTE35-OUT",x.SCTE35_IN="SCTE35-IN"})(A||(A={}));var y=function(){function x(D,E){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,E){var m=E.attr;for(var p in m)if(Object.prototype.hasOwnProperty.call(D,p)&&D[p]!==m[p]){L.logger.warn('DATERANGE tag attribute: "'+p+'" does not match for tags with ID: "'+D.ID+'"'),this._badValueForSameId=p;break}D=M(new _.AttrList({}),m,D)}if(this.attr=D,this._startDate=new Date(D[A.START_DATE]),A.END_DATE in this.attr){var u=new Date(this.attr[A.END_DATE]);Object(P.isFiniteNumber)(u.getTime())&&(this._endDate=u)}}return b(x,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var E=this.duration;return E!==null?new Date(this._startDate.getTime()+E*1e3):null}},{key:"duration",get:function(){if(A.DURATION in this.attr){var E=this.attr.decimalFloatingPoint(A.DURATION);if(Object(P.isFiniteNumber)(E))return E}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return A.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(A.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(A.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(P.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),x}()},"./src/loader/fragment-loader.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return E}),h.d(O,"LoadError",function(){return p});var P=h("./src/polyfills/number.ts"),_=h("./src/errors.ts");function L(u,e){u.prototype=Object.create(e.prototype),u.prototype.constructor=u,y(u,e)}function M(u){var e=typeof Map=="function"?new Map:void 0;return M=function(c){if(c===null||!A(c))return c;if(typeof c!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e!="undefined"){if(e.has(c))return e.get(c);e.set(c,g)}function g(){return R(c,arguments,x(this).constructor)}return g.prototype=Object.create(c.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),y(g,c)},M(u)}function R(u,e,s){return b()?R=Reflect.construct.bind():R=function(g,i,r){var o=[null];o.push.apply(o,i);var d=Function.bind.apply(g,o),t=new d;return r&&y(t,r.prototype),t},R.apply(null,arguments)}function b(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function A(u){return Function.toString.call(u).indexOf("[native code]")!==-1}function y(u,e){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,g){return c.__proto__=g,c},y(u,e)}function x(u){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},x(u)}var D=Math.pow(2,17),E=function(){function u(s){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=s}var e=u.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(c,g){var i=this,r=c.url;if(!r)return Promise.reject(new p({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:c,networkDetails:null},"Fragment does not have a "+(r?"part list":"url")));this.abort();var o=this.config,d=o.fLoader,t=o.loader;return new Promise(function(n,l){i.loader&&i.loader.destroy();var a=i.loader=c.loader=d?new d(o):new t(o),f=m(c),v={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:c.sn==="initSegment"?1/0:D};c.stats=a.stats,a.load(f,v,{onSuccess:function(T,I,k,B){i.resetLoader(c,a),n({frag:c,part:null,payload:T.data,networkDetails:B})},onError:function(T,I,k){i.resetLoader(c,a),l(new p({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:c,response:T,networkDetails:k}))},onAbort:function(T,I,k){i.resetLoader(c,a),l(new p({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:c,networkDetails:k}))},onTimeout:function(T,I,k){i.resetLoader(c,a),l(new p({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:c,networkDetails:k}))},onProgress:function(T,I,k,B){g&&g({frag:c,part:null,payload:k,networkDetails:B})}})})},e.loadPart=function(c,g,i){var r=this;this.abort();var o=this.config,d=o.fLoader,t=o.loader;return new Promise(function(n,l){r.loader&&r.loader.destroy();var a=r.loader=c.loader=d?new d(o):new t(o),f=m(c,g),v={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:D};g.stats=a.stats,a.load(f,v,{onSuccess:function(T,I,k,B){r.resetLoader(c,a),r.updateStatsFromPart(c,g);var N={frag:c,part:g,payload:T.data,networkDetails:B};i(N),n(N)},onError:function(T,I,k){r.resetLoader(c,a),l(new p({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:c,part:g,response:T,networkDetails:k}))},onAbort:function(T,I,k){c.stats.aborted=g.stats.aborted,r.resetLoader(c,a),l(new p({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:c,part:g,networkDetails:k}))},onTimeout:function(T,I,k){r.resetLoader(c,a),l(new p({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:c,part:g,networkDetails:k}))}})})},e.updateStatsFromPart=function(c,g){var i=c.stats,r=g.stats,o=r.total;if(i.loaded+=r.loaded,o){var d=Math.round(c.duration/g.duration),t=Math.min(Math.round(i.loaded/o),d),n=d-t,l=n*Math.round(i.loaded/t);i.total=i.loaded+l}else i.total=Math.max(i.loaded,i.total);var a=i.loading,f=r.loading;a.start?a.first+=f.first-f.start:(a.start=f.start,a.first=f.first),a.end=f.end},e.resetLoader=function(c,g){c.loader=null,this.loader===g&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),g.destroy()},u}();function m(u,e){e===void 0&&(e=null);var s=e||u,c={frag:u,part:e,responseType:"arraybuffer",url:s.url,headers:{},rangeStart:0,rangeEnd:0},g=s.byteRangeStartOffset,i=s.byteRangeEndOffset;return Object(P.isFiniteNumber)(g)&&Object(P.isFiniteNumber)(i)&&(c.rangeStart=g,c.rangeEnd=i),c}var p=function(u){L(e,u);function e(s){for(var c,g=arguments.length,i=new Array(g>1?g-1:0),r=1;r<g;r++)i[r-1]=arguments[r];return c=u.call.apply(u,[this].concat(i))||this,c.data=void 0,c.data=s,c}return e}(M(Error))},"./src/loader/fragment.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"ElementaryStreamTypes",function(){return E}),h.d(O,"BaseSegment",function(){return m}),h.d(O,"Fragment",function(){return p}),h.d(O,"Part",function(){return u});var P=h("./src/polyfills/number.ts"),_=h("./node_modules/url-toolkit/src/url-toolkit.js"),L=h.n(_),M=h("./src/utils/logger.ts"),R=h("./src/loader/level-key.ts"),b=h("./src/loader/load-stats.ts");function A(e,s){e.prototype=Object.create(s.prototype),e.prototype.constructor=e,y(e,s)}function y(e,s){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,i){return g.__proto__=i,g},y(e,s)}function x(e,s){for(var c=0;c<s.length;c++){var g=s[c];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(e,g.key,g)}}function D(e,s,c){return s&&x(e.prototype,s),c&&x(e,c),Object.defineProperty(e,"prototype",{writable:!1}),e}var E;(function(e){e.AUDIO="audio",e.VIDEO="video",e.AUDIOVIDEO="audiovideo"})(E||(E={}));var m=function(){function e(c){var g;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(g={},g[E.AUDIO]=null,g[E.VIDEO]=null,g[E.AUDIOVIDEO]=null,g),this.baseurl=c}var s=e.prototype;return s.setByteRange=function(g,i){var r=g.split("@",2),o=[];r.length===1?o[0]=i?i.byteRangeEndOffset:0:o[0]=parseInt(r[1]),o[1]=parseInt(r[0])+o[0],this._byteRange=o},D(e,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(_.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(g){this._url=g}}]),e}(),p=function(e){A(s,e);function s(g,i){var r;return r=e.call(this,i)||this,r._decryptdata=null,r.rawProgramDateTime=null,r.programDateTime=null,r.tagList=[],r.duration=0,r.sn=0,r.levelkey=void 0,r.type=void 0,r.loader=null,r.level=-1,r.cc=0,r.startPTS=void 0,r.endPTS=void 0,r.appendedPTS=void 0,r.startDTS=void 0,r.endDTS=void 0,r.start=0,r.deltaPTS=void 0,r.maxStartPTS=void 0,r.minEndPTS=void 0,r.stats=new b.LoadStats,r.urlId=0,r.data=void 0,r.bitrateTest=!1,r.title=null,r.initSegment=null,r.type=g,r}var c=s.prototype;return c.createInitializationVector=function(i){for(var r=new Uint8Array(16),o=12;o<16;o++)r[o]=i>>8*(15-o)&255;return r},c.setDecryptDataFromLevelKey=function(i,r){var o=i;return(i==null?void 0:i.method)==="AES-128"&&i.uri&&!i.iv&&(o=R.LevelKey.fromURI(i.uri),o.method=i.method,o.iv=this.createInitializationVector(r),o.keyFormat="identity"),o},c.setElementaryStreamInfo=function(i,r,o,d,t,n){n===void 0&&(n=!1);var l=this.elementaryStreams,a=l[i];if(!a){l[i]={startPTS:r,endPTS:o,startDTS:d,endDTS:t,partial:n};return}a.startPTS=Math.min(a.startPTS,r),a.endPTS=Math.max(a.endPTS,o),a.startDTS=Math.min(a.startDTS,d),a.endDTS=Math.max(a.endDTS,t)},c.clearElementaryStreamInfo=function(){var i=this.elementaryStreams;i[E.AUDIO]=null,i[E.VIDEO]=null,i[E.AUDIOVIDEO]=null},D(s,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var i=this.sn;typeof i!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&M.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),i=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,i)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(P.isFiniteNumber)(this.programDateTime))return null;var i=Object(P.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+i*1e3}},{key:"encrypted",get:function(){var i;return!!((i=this.decryptdata)!==null&&i!==void 0&&i.keyFormat&&this.decryptdata.uri)}}]),s}(m),u=function(e){A(s,e);function s(c,g,i,r,o){var d;d=e.call(this,i)||this,d.fragOffset=0,d.duration=0,d.gap=!1,d.independent=!1,d.relurl=void 0,d.fragment=void 0,d.index=void 0,d.stats=new b.LoadStats,d.duration=c.decimalFloatingPoint("DURATION"),d.gap=c.bool("GAP"),d.independent=c.bool("INDEPENDENT"),d.relurl=c.enumeratedString("URI"),d.fragment=g,d.index=r;var t=c.enumeratedString("BYTERANGE");return t&&d.setByteRange(t,o),o&&(d.fragOffset=o.fragOffset+o.duration),d}return D(s,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var g=this.elementaryStreams;return!!(g.audio||g.video||g.audiovideo)}}]),s}(m)},"./src/loader/key-loader.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return M});var P=h("./src/events.ts"),_=h("./src/errors.ts"),L=h("./src/utils/logger.ts"),M=function(){function R(A){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=A,this.registerListeners()}var b=R.prototype;return b.startLoad=function(y){},b.stopLoad=function(){this.destroyInternalLoaders()},b.registerListeners=function(){this.hls.on(P.Events.KEY_LOADING,this.onKeyLoading,this)},b.unregisterListeners=function(){this.hls.off(P.Events.KEY_LOADING,this.onKeyLoading)},b.destroyInternalLoaders=function(){for(var y in this.loaders){var x=this.loaders[y];x&&x.destroy()}this.loaders={}},b.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},b.onKeyLoading=function(y,x){var D=x.frag,E=D.type,m=this.loaders[E];if(!D.decryptdata){L.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var p=D.decryptdata.uri;if(p!==this.decrypturl||this.decryptkey===null){var u=this.hls.config;if(m&&(L.logger.warn("abort previous key loader for type:"+E),m.abort()),!p){L.logger.warn("key uri is falsy");return}var e=u.loader,s=D.loader=this.loaders[E]=new e(u);this.decrypturl=p,this.decryptkey=null;var c={url:p,frag:D,responseType:"arraybuffer"},g={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:0},i={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};s.load(c,g,i)}else this.decryptkey&&(D.decryptdata.key=this.decryptkey,this.hls.trigger(P.Events.KEY_LOADED,{frag:D}))},b.loadsuccess=function(y,x,D){var E=D.frag;if(!E.decryptdata){L.logger.error("after key load, decryptdata unset");return}this.decryptkey=E.decryptdata.key=new Uint8Array(y.data),E.loader=null,delete this.loaders[E.type],this.hls.trigger(P.Events.KEY_LOADED,{frag:E})},b.loaderror=function(y,x){var D=x.frag,E=D.loader;E&&E.abort(),delete this.loaders[D.type],this.hls.trigger(P.Events.ERROR,{type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:D,response:y})},b.loadtimeout=function(y,x){var D=x.frag,E=D.loader;E&&E.abort(),delete this.loaders[D.type],this.hls.trigger(P.Events.ERROR,{type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:D})},R}()},"./src/loader/level-details.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"LevelDetails",function(){return R});var P=h("./src/polyfills/number.ts");function _(b,A){for(var y=0;y<A.length;y++){var x=A[y];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(b,x.key,x)}}function L(b,A,y){return A&&_(b.prototype,A),y&&_(b,y),Object.defineProperty(b,"prototype",{writable:!1}),b}var M=10,R=function(){function b(y){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=y}var A=b.prototype;return A.reloaded=function(x){if(!x){this.advanced=!0,this.updated=!0;return}var D=this.lastPartSn-x.lastPartSn,E=this.lastPartIndex-x.lastPartIndex;this.updated=this.endSN!==x.endSN||!!E||!!D,this.advanced=this.endSN>x.endSN||D>0||D===0&&E>0,this.updated||this.advanced?this.misses=Math.floor(x.misses*.6):this.misses=x.misses+1,this.availabilityDelay=x.availabilityDelay},L(b,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(P.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||M}},{key:"drift",get:function(){var x=this.driftEndTime-this.driftStartTime;if(x>0){var D=this.driftEnd-this.driftStart;return D*1e3/x}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var x;return(x=this.partList)!==null&&x!==void 0&&x.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var x;return(x=this.fragments)!==null&&x!==void 0&&x.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var x;return(x=this.partList)!==null&&x!==void 0&&x.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var x;return(x=this.partList)!==null&&x!==void 0&&x.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),b}()},"./src/loader/level-key.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"LevelKey",function(){return R});var P=h("./node_modules/url-toolkit/src/url-toolkit.js"),_=h.n(P);function L(b,A){for(var y=0;y<A.length;y++){var x=A[y];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(b,x.key,x)}}function M(b,A,y){return A&&L(b.prototype,A),y&&L(b,y),Object.defineProperty(b,"prototype",{writable:!1}),b}var R=function(){b.fromURL=function(y,x){return new b(y,x)},b.fromURI=function(y){return new b(y)};function b(A,y){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,y?this._uri=Object(P.buildAbsoluteURL)(A,y,{alwaysNormalize:!0}):this._uri=A}return M(b,[{key:"uri",get:function(){return this._uri}}]),b}()},"./src/loader/load-stats.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"LoadStats",function(){return P});var P=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return c});var P=h("./src/polyfills/number.ts"),_=h("./node_modules/url-toolkit/src/url-toolkit.js"),L=h.n(_),M=h("./src/loader/date-range.ts"),R=h("./src/loader/fragment.ts"),b=h("./src/loader/level-details.ts"),A=h("./src/loader/level-key.ts"),y=h("./src/utils/attr-list.ts"),x=h("./src/utils/logger.ts"),D=h("./src/utils/codecs.ts"),E=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,m=/#EXT-X-MEDIA:(.*)/g,p=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),u=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),e=/\.(mp4|m4s|m4v|m4a)$/i;function s(t){var n,l;return e.test((n=(l=_.parseURL(t))===null||l===void 0?void 0:l.path)!=null?n:"")}var c=function(){function t(){}return t.findGroup=function(l,a){for(var f=0;f<l.length;f++){var v=l[f];if(v.id===a)return v}},t.convertAVC1ToAVCOTI=function(l){var a=l.split(".");if(a.length>2){var f=a.shift()+".";return f+=parseInt(a.shift()).toString(16),f+=("000"+parseInt(a.shift()).toString(16)).slice(-4),f}return l},t.resolve=function(l,a){return _.buildAbsoluteURL(a,l,{alwaysNormalize:!0})},t.parseMasterPlaylist=function(l,a){var f=[],v={},S=!1;E.lastIndex=0;for(var T;(T=E.exec(l))!=null;)if(T[1]){var I=new y.AttrList(T[1]),k={attrs:I,bitrate:I.decimalInteger("AVERAGE-BANDWIDTH")||I.decimalInteger("BANDWIDTH"),name:I.NAME,url:t.resolve(T[2],a)},B=I.decimalResolution("RESOLUTION");B&&(k.width=B.width,k.height=B.height),g((I.CODECS||"").split(/[ ,]+/).filter(function(W){return W}),k),k.videoCodec&&k.videoCodec.indexOf("avc1")!==-1&&(k.videoCodec=t.convertAVC1ToAVCOTI(k.videoCodec)),f.push(k)}else if(T[3]){var N=new y.AttrList(T[3]);N["DATA-ID"]&&(S=!0,v[N["DATA-ID"]]=N)}return{levels:f,sessionData:S?v:null}},t.parseMasterPlaylistMedia=function(l,a,f,v){v===void 0&&(v=[]);var S,T=[],I=0;for(m.lastIndex=0;(S=m.exec(l))!==null;){var k=new y.AttrList(S[1]);if(k.TYPE===f){var B={attrs:k,bitrate:0,id:I++,groupId:k["GROUP-ID"],instreamId:k["INSTREAM-ID"],name:k.NAME||k.LANGUAGE||"",type:f,default:k.bool("DEFAULT"),autoselect:k.bool("AUTOSELECT"),forced:k.bool("FORCED"),lang:k.LANGUAGE,url:k.URI?t.resolve(k.URI,a):""};if(v.length){var N=t.findGroup(v,B.groupId)||v[0];i(B,N,"audioCodec"),i(B,N,"textCodec")}T.push(B)}}return T},t.parseLevelPlaylist=function(l,a,f,v,S){var T=new b.LevelDetails(a),I=T.fragments,k=null,B=0,N=0,W=0,G=0,z=null,Y=new R.Fragment(v,a),$,Z,q,ie=-1,ne=!1;for(p.lastIndex=0,T.m3u8=l;($=p.exec(l))!==null;){ne&&(ne=!1,Y=new R.Fragment(v,a),Y.start=W,Y.sn=B,Y.cc=G,Y.level=f,k&&(Y.initSegment=k,Y.rawProgramDateTime=k.rawProgramDateTime,k.rawProgramDateTime=null));var ae=$[1];if(ae){Y.duration=parseFloat(ae);var te=(" "+$[2]).slice(1);Y.title=te||null,Y.tagList.push(te?["INF",ae,te]:["INF",ae])}else if($[3])Object(P.isFiniteNumber)(Y.duration)&&(Y.start=W,q&&(Y.levelkey=q),Y.sn=B,Y.level=f,Y.cc=G,Y.urlId=S,I.push(Y),Y.relurl=(" "+$[3]).slice(1),o(Y,z),z=Y,W+=Y.duration,B++,N=0,ne=!0);else if($[4]){var fe=(" "+$[4]).slice(1);z?Y.setByteRange(fe,z):Y.setByteRange(fe)}else if($[5])Y.rawProgramDateTime=(" "+$[5]).slice(1),Y.tagList.push(["PROGRAM-DATE-TIME",Y.rawProgramDateTime]),ie===-1&&(ie=I.length);else{if($=$[0].match(u),!$){x.logger.warn("No matches on slow regex match for level playlist!");continue}for(Z=1;Z<$.length&&typeof $[Z]=="undefined";Z++);var de=(" "+$[Z]).slice(1),re=(" "+$[Z+1]).slice(1),Ee=$[Z+2]?(" "+$[Z+2]).slice(1):"";switch(de){case"PLAYLIST-TYPE":T.type=re.toUpperCase();break;case"MEDIA-SEQUENCE":B=T.startSN=parseInt(re);break;case"SKIP":{var me=new y.AttrList(re),Te=me.decimalInteger("SKIPPED-SEGMENTS");if(Object(P.isFiniteNumber)(Te)){T.skippedSegments=Te;for(var Me=Te;Me--;)I.unshift(null);B+=Te}var _e=me.enumeratedString("RECENTLY-REMOVED-DATERANGES");_e&&(T.recentlyRemovedDateranges=_e.split("	"));break}case"TARGETDURATION":T.targetduration=parseFloat(re);break;case"VERSION":T.version=parseInt(re);break;case"EXTM3U":break;case"ENDLIST":T.live=!1;break;case"#":(re||Ee)&&Y.tagList.push(Ee?[re,Ee]:[re]);break;case"DISCONTINUITY":G++,Y.tagList.push(["DIS"]);break;case"GAP":Y.tagList.push([de]);break;case"BITRATE":Y.tagList.push([de,re]);break;case"DATERANGE":{var ke=new y.AttrList(re),Ie=new M.DateRange(ke,T.dateRanges[ke.ID]);Ie.isValid||T.skippedSegments?T.dateRanges[Ie.id]=Ie:x.logger.warn('Ignoring invalid DATERANGE tag: "'+re+'"'),Y.tagList.push(["EXT-X-DATERANGE",re]);break}case"DISCONTINUITY-SEQUENCE":G=parseInt(re);break;case"KEY":{var Be,be=new y.AttrList(re),Ue=be.enumeratedString("METHOD"),Ke=be.URI,je=be.hexadecimalInteger("IV"),Ne=be.enumeratedString("KEYFORMATVERSIONS"),qe=be.enumeratedString("KEYID"),we=(Be=be.enumeratedString("KEYFORMAT"))!=null?Be:"identity",et=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(et.indexOf(we)>-1){x.logger.warn("Keyformat "+we+" is not supported from the manifest");continue}else if(we!=="identity")continue;Ue&&(q=A.LevelKey.fromURL(a,Ke),Ke&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(Ue)>=0&&(q.method=Ue,q.keyFormat=we,qe&&(q.keyID=qe),Ne&&(q.keyFormatVersions=Ne),q.iv=je));break}case"START":{var Oe=new y.AttrList(re),Pe=Oe.decimalFloatingPoint("TIME-OFFSET");Object(P.isFiniteNumber)(Pe)&&(T.startTimeOffset=Pe);break}case"MAP":{var Ye=new y.AttrList(re);if(Y.duration){var Ce=new R.Fragment(v,a);d(Ce,Ye,f,q),k=Ce,Y.initSegment=k,k.rawProgramDateTime&&!Y.rawProgramDateTime&&(Y.rawProgramDateTime=k.rawProgramDateTime)}else d(Y,Ye,f,q),k=Y,ne=!0;break}case"SERVER-CONTROL":{var Ae=new y.AttrList(re);T.canBlockReload=Ae.bool("CAN-BLOCK-RELOAD"),T.canSkipUntil=Ae.optionalFloat("CAN-SKIP-UNTIL",0),T.canSkipDateRanges=T.canSkipUntil>0&&Ae.bool("CAN-SKIP-DATERANGES"),T.partHoldBack=Ae.optionalFloat("PART-HOLD-BACK",0),T.holdBack=Ae.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var it=new y.AttrList(re);T.partTarget=it.decimalFloatingPoint("PART-TARGET");break}case"PART":{var We=T.partList;We||(We=T.partList=[]);var lt=N>0?We[We.length-1]:void 0,yt=N++,Xe=new R.Part(new y.AttrList(re),Y,a,yt,lt);We.push(Xe),Y.duration+=Xe.duration;break}case"PRELOAD-HINT":{var _t=new y.AttrList(re);T.preloadHint=_t;break}case"RENDITION-REPORT":{var Tt=new y.AttrList(re);T.renditionReports=T.renditionReports||[],T.renditionReports.push(Tt);break}default:x.logger.warn("line parsed but not handled: "+$);break}}}z&&!z.relurl?(I.pop(),W-=z.duration,T.partList&&(T.fragmentHint=z)):T.partList&&(o(Y,z),Y.cc=G,T.fragmentHint=Y);var nt=I.length,ut=I[0],at=I[nt-1];if(W+=T.skippedSegments*T.targetduration,W>0&&nt&&at){T.averagetargetduration=W/nt;var xt=at.sn;T.endSN=xt!=="initSegment"?xt:0,ut&&(T.startCC=ut.cc,ut.initSegment||T.fragments.every(function(gt){return gt.relurl&&s(gt.relurl)})&&(x.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),Y=new R.Fragment(v,a),Y.relurl=at.relurl,Y.level=f,Y.sn="initSegment",ut.initSegment=Y,T.needSidxRanges=!0))}else T.endSN=0,T.startCC=0;return T.fragmentHint&&(W+=T.fragmentHint.duration),T.totalduration=W,T.endCC=G,ie>0&&r(I,ie),T},t}();function g(t,n){["video","audio","text"].forEach(function(l){var a=t.filter(function(v){return Object(D.isCodecType)(v,l)});if(a.length){var f=a.filter(function(v){return v.lastIndexOf("avc1",0)===0||v.lastIndexOf("mp4a",0)===0});n[l+"Codec"]=f.length>0?f[0]:a[0],t=t.filter(function(v){return a.indexOf(v)===-1})}}),n.unknownCodecs=t}function i(t,n,l){var a=n[l];a&&(t[l]=a)}function r(t,n){for(var l=t[n],a=n;a--;){var f=t[a];if(!f)return;f.programDateTime=l.programDateTime-f.duration*1e3,l=f}}function o(t,n){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):n!=null&&n.programDateTime&&(t.programDateTime=n.endProgramDateTime),Object(P.isFiniteNumber)(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}function d(t,n,l,a){t.relurl=n.URI,n.BYTERANGE&&t.setByteRange(n.BYTERANGE),t.level=l,t.sn="initSegment",a&&(t.levelkey=a),t.initSegment=null}},"./src/loader/playlist-loader.ts":function(U,O,h){"use strict";h.r(O);var P=h("./src/polyfills/number.ts"),_=h("./src/events.ts"),L=h("./src/errors.ts"),M=h("./src/utils/logger.ts"),R=h("./src/utils/mp4-tools.ts"),b=h("./src/loader/m3u8-parser.ts"),A=h("./src/types/loader.ts"),y=h("./src/utils/attr-list.ts");function x(m){var p=m.type;switch(p){case A.PlaylistContextType.AUDIO_TRACK:return A.PlaylistLevelType.AUDIO;case A.PlaylistContextType.SUBTITLE_TRACK:return A.PlaylistLevelType.SUBTITLE;default:return A.PlaylistLevelType.MAIN}}function D(m,p){var u=m.url;return(u===void 0||u.indexOf("data:")===0)&&(u=p.url),u}var E=function(){function m(u){this.hls=void 0,this.loaders=Object.create(null),this.hls=u,this.registerListeners()}var p=m.prototype;return p.startLoad=function(e){},p.stopLoad=function(){this.destroyInternalLoaders()},p.registerListeners=function(){var e=this.hls;e.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(_.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(_.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},p.unregisterListeners=function(){var e=this.hls;e.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(_.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(_.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},p.createInternalLoader=function(e){var s=this.hls.config,c=s.pLoader,g=s.loader,i=c||g,r=new i(s);return e.loader=r,this.loaders[e.type]=r,r},p.getInternalLoader=function(e){return this.loaders[e.type]},p.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},p.destroyInternalLoaders=function(){for(var e in this.loaders){var s=this.loaders[e];s&&s.destroy(),this.resetInternalLoader(e)}},p.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},p.onManifestLoading=function(e,s){var c=s.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:A.PlaylistContextType.MANIFEST,url:c,deliveryDirectives:null})},p.onLevelLoading=function(e,s){var c=s.id,g=s.level,i=s.url,r=s.deliveryDirectives;this.load({id:c,groupId:null,level:g,responseType:"text",type:A.PlaylistContextType.LEVEL,url:i,deliveryDirectives:r})},p.onAudioTrackLoading=function(e,s){var c=s.id,g=s.groupId,i=s.url,r=s.deliveryDirectives;this.load({id:c,groupId:g,level:null,responseType:"text",type:A.PlaylistContextType.AUDIO_TRACK,url:i,deliveryDirectives:r})},p.onSubtitleTrackLoading=function(e,s){var c=s.id,g=s.groupId,i=s.url,r=s.deliveryDirectives;this.load({id:c,groupId:g,level:null,responseType:"text",type:A.PlaylistContextType.SUBTITLE_TRACK,url:i,deliveryDirectives:r})},p.load=function(e){var s,c=this.hls.config,g=this.getInternalLoader(e);if(g){var i=g.context;if(i&&i.url===e.url){M.logger.trace("[playlist-loader]: playlist request ongoing");return}M.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),g.abort()}var r,o,d,t;switch(e.type){case A.PlaylistContextType.MANIFEST:r=c.manifestLoadingMaxRetry,o=c.manifestLoadingTimeOut,d=c.manifestLoadingRetryDelay,t=c.manifestLoadingMaxRetryTimeout;break;case A.PlaylistContextType.LEVEL:case A.PlaylistContextType.AUDIO_TRACK:case A.PlaylistContextType.SUBTITLE_TRACK:r=0,o=c.levelLoadingTimeOut;break;default:r=c.levelLoadingMaxRetry,o=c.levelLoadingTimeOut,d=c.levelLoadingRetryDelay,t=c.levelLoadingMaxRetryTimeout;break}if(g=this.createInternalLoader(e),(s=e.deliveryDirectives)!==null&&s!==void 0&&s.part){var n;if(e.type===A.PlaylistContextType.LEVEL&&e.level!==null?n=this.hls.levels[e.level].details:e.type===A.PlaylistContextType.AUDIO_TRACK&&e.id!==null?n=this.hls.audioTracks[e.id].details:e.type===A.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(n=this.hls.subtitleTracks[e.id].details),n){var l=n.partTarget,a=n.targetduration;l&&a&&(o=Math.min(Math.max(l*3,a*.8)*1e3,o))}}var f={timeout:o,maxRetry:r,retryDelay:d,maxRetryDelay:t,highWaterMark:0},v={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};g.load(e,f,v)},p.loadsuccess=function(e,s,c,g){if(g===void 0&&(g=null),c.isSidxRequest){this.handleSidxRequest(e,c),this.handlePlaylistLoaded(e,s,c,g);return}this.resetInternalLoader(c.type);var i=e.data;if(i.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(e,c,"no EXTM3U delimiter",g);return}s.parsing.start=performance.now(),i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,s,c,g):this.handleMasterPlaylist(e,s,c,g)},p.loaderror=function(e,s,c){c===void 0&&(c=null),this.handleNetworkError(s,c,!1,e)},p.loadtimeout=function(e,s,c){c===void 0&&(c=null),this.handleNetworkError(s,c,!0)},p.handleMasterPlaylist=function(e,s,c,g){var i=this.hls,r=e.data,o=D(e,c),d=b.default.parseMasterPlaylist(r,o),t=d.levels,n=d.sessionData;if(!t.length){this.handleManifestParsingError(e,c,"no level found in manifest",g);return}var l=t.map(function(I){return{id:I.attrs.AUDIO,audioCodec:I.audioCodec}}),a=t.map(function(I){return{id:I.attrs.SUBTITLES,textCodec:I.textCodec}}),f=b.default.parseMasterPlaylistMedia(r,o,"AUDIO",l),v=b.default.parseMasterPlaylistMedia(r,o,"SUBTITLES",a),S=b.default.parseMasterPlaylistMedia(r,o,"CLOSED-CAPTIONS");if(f.length){var T=f.some(function(I){return!I.url});!T&&t[0].audioCodec&&!t[0].attrs.AUDIO&&(M.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),f.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new y.AttrList({}),bitrate:0,url:""}))}i.trigger(_.Events.MANIFEST_LOADED,{levels:t,audioTracks:f,subtitles:v,captions:S,url:o,stats:s,networkDetails:g,sessionData:n})},p.handleTrackOrLevelPlaylist=function(e,s,c,g){var i=this.hls,r=c.id,o=c.level,d=c.type,t=D(e,c),n=Object(P.isFiniteNumber)(r)?r:0,l=Object(P.isFiniteNumber)(o)?o:n,a=x(c),f=b.default.parseLevelPlaylist(e.data,t,l,a,n);if(!f.fragments.length){i.trigger(_.Events.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:t,reason:"no fragments found in level",level:typeof c.level=="number"?c.level:void 0});return}if(d===A.PlaylistContextType.MANIFEST){var v={attrs:new y.AttrList({}),bitrate:0,details:f,name:"",url:t};i.trigger(_.Events.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:t,stats:s,networkDetails:g,sessionData:null})}if(s.parsing.end=performance.now(),f.needSidxRanges){var S,T=(S=f.fragments[0].initSegment)===null||S===void 0?void 0:S.url;this.load({url:T,isSidxRequest:!0,type:d,level:o,levelDetails:f,id:r,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}c.levelDetails=f,this.handlePlaylistLoaded(e,s,c,g)},p.handleSidxRequest=function(e,s){var c=new Uint8Array(e.data),g=Object(R.findBox)(c,["sidx"])[0];if(!!g){var i=Object(R.parseSegmentIndex)(g);if(!!i){var r=i.references,o=s.levelDetails;r.forEach(function(d,t){var n=d.info,l=o.fragments[t];if(l.byteRange.length===0&&l.setByteRange(String(1+n.end-n.start)+"@"+String(n.start)),l.initSegment){var a=Object(R.findBox)(c,["moov"])[0],f=a?a.length:null;l.initSegment.setByteRange(String(f)+"@0")}})}}},p.handleManifestParsingError=function(e,s,c,g){this.hls.trigger(_.Events.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:s.type===A.PlaylistContextType.MANIFEST,url:e.url,reason:c,response:e,context:s,networkDetails:g})},p.handleNetworkError=function(e,s,c,g){c===void 0&&(c=!1),M.logger.warn("[playlist-loader]: A network "+(c?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var i=L.ErrorDetails.UNKNOWN,r=!1,o=this.getInternalLoader(e);switch(e.type){case A.PlaylistContextType.MANIFEST:i=c?L.ErrorDetails.MANIFEST_LOAD_TIMEOUT:L.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0;break;case A.PlaylistContextType.LEVEL:i=c?L.ErrorDetails.LEVEL_LOAD_TIMEOUT:L.ErrorDetails.LEVEL_LOAD_ERROR,r=!1;break;case A.PlaylistContextType.AUDIO_TRACK:i=c?L.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:L.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,r=!1;break;case A.PlaylistContextType.SUBTITLE_TRACK:i=c?L.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:L.ErrorDetails.SUBTITLE_LOAD_ERROR,r=!1;break}o&&this.resetInternalLoader(e.type);var d={type:L.ErrorTypes.NETWORK_ERROR,details:i,fatal:r,url:e.url,loader:o,context:e,networkDetails:s};g&&(d.response=g),this.hls.trigger(_.Events.ERROR,d)},p.handlePlaylistLoaded=function(e,s,c,g){var i=c.type,r=c.level,o=c.id,d=c.groupId,t=c.loader,n=c.levelDetails,l=c.deliveryDirectives;if(!(n!=null&&n.targetduration)){this.handleManifestParsingError(e,c,"invalid target duration",g);return}if(!!t)switch(n.live&&(t.getCacheAge&&(n.ageHeader=t.getCacheAge()||0),(!t.getCacheAge||isNaN(n.ageHeader))&&(n.ageHeader=0)),i){case A.PlaylistContextType.MANIFEST:case A.PlaylistContextType.LEVEL:this.hls.trigger(_.Events.LEVEL_LOADED,{details:n,level:r||0,id:o||0,stats:s,networkDetails:g,deliveryDirectives:l});break;case A.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(_.Events.AUDIO_TRACK_LOADED,{details:n,id:o||0,groupId:d||"",stats:s,networkDetails:g,deliveryDirectives:l});break;case A.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(_.Events.SUBTITLE_TRACK_LOADED,{details:n,id:o||0,groupId:d||"",stats:s,networkDetails:g,deliveryDirectives:l});break}},m}();O.default=E},"./src/polyfills/number.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"isFiniteNumber",function(){return P}),h.d(O,"MAX_SAFE_INTEGER",function(){return _});var P=Number.isFinite||function(L){return typeof L=="number"&&isFinite(L)},_=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(U,O,h){"use strict";h.r(O);var P=function(){function _(){}return _.getSilentFrame=function(M,R){switch(M){case"mp4a.40.2":if(R===1)return new Uint8Array([0,200,0,128,35,128]);if(R===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(R===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(R===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(R===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(R===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(R===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(R===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(R===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},_}();O.default=P},"./src/remux/mp4-generator.ts":function(U,O,h){"use strict";h.r(O);var P=Math.pow(2,32)-1,_=function(){function L(){}return L.init=function(){L.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var R;for(R in L.types)L.types.hasOwnProperty(R)&&(L.types[R]=[R.charCodeAt(0),R.charCodeAt(1),R.charCodeAt(2),R.charCodeAt(3)]);var b=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),A=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);L.HDLR_TYPES={video:b,audio:A};var y=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),x=new Uint8Array([0,0,0,0,0,0,0,0]);L.STTS=L.STSC=L.STCO=x,L.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),L.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),L.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),L.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var D=new Uint8Array([105,115,111,109]),E=new Uint8Array([97,118,99,49]),m=new Uint8Array([0,0,0,1]);L.FTYP=L.box(L.types.ftyp,D,m,D,E),L.DINF=L.box(L.types.dinf,L.box(L.types.dref,y))},L.box=function(R){for(var b=8,A=arguments.length,y=new Array(A>1?A-1:0),x=1;x<A;x++)y[x-1]=arguments[x];for(var D=y.length,E=D;D--;)b+=y[D].byteLength;var m=new Uint8Array(b);for(m[0]=b>>24&255,m[1]=b>>16&255,m[2]=b>>8&255,m[3]=b&255,m.set(R,4),D=0,b=8;D<E;D++)m.set(y[D],b),b+=y[D].byteLength;return m},L.hdlr=function(R){return L.box(L.types.hdlr,L.HDLR_TYPES[R])},L.mdat=function(R){return L.box(L.types.mdat,R)},L.mdhd=function(R,b){b*=R;var A=Math.floor(b/(P+1)),y=Math.floor(b%(P+1));return L.box(L.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,R&255,A>>24,A>>16&255,A>>8&255,A&255,y>>24,y>>16&255,y>>8&255,y&255,85,196,0,0]))},L.mdia=function(R){return L.box(L.types.mdia,L.mdhd(R.timescale,R.duration),L.hdlr(R.type),L.minf(R))},L.mfhd=function(R){return L.box(L.types.mfhd,new Uint8Array([0,0,0,0,R>>24,R>>16&255,R>>8&255,R&255]))},L.minf=function(R){return R.type==="audio"?L.box(L.types.minf,L.box(L.types.smhd,L.SMHD),L.DINF,L.stbl(R)):L.box(L.types.minf,L.box(L.types.vmhd,L.VMHD),L.DINF,L.stbl(R))},L.moof=function(R,b,A){return L.box(L.types.moof,L.mfhd(R),L.traf(A,b))},L.moov=function(R){for(var b=R.length,A=[];b--;)A[b]=L.trak(R[b]);return L.box.apply(null,[L.types.moov,L.mvhd(R[0].timescale,R[0].duration)].concat(A).concat(L.mvex(R)))},L.mvex=function(R){for(var b=R.length,A=[];b--;)A[b]=L.trex(R[b]);return L.box.apply(null,[L.types.mvex].concat(A))},L.mvhd=function(R,b){b*=R;var A=Math.floor(b/(P+1)),y=Math.floor(b%(P+1)),x=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,R&255,A>>24,A>>16&255,A>>8&255,A&255,y>>24,y>>16&255,y>>8&255,y&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return L.box(L.types.mvhd,x)},L.sdtp=function(R){var b=R.samples||[],A=new Uint8Array(4+b.length),y,x;for(y=0;y<b.length;y++)x=b[y].flags,A[y+4]=x.dependsOn<<4|x.isDependedOn<<2|x.hasRedundancy;return L.box(L.types.sdtp,A)},L.stbl=function(R){return L.box(L.types.stbl,L.stsd(R),L.box(L.types.stts,L.STTS),L.box(L.types.stsc,L.STSC),L.box(L.types.stsz,L.STSZ),L.box(L.types.stco,L.STCO))},L.avc1=function(R){var b=[],A=[],y,x,D;for(y=0;y<R.sps.length;y++)x=R.sps[y],D=x.byteLength,b.push(D>>>8&255),b.push(D&255),b=b.concat(Array.prototype.slice.call(x));for(y=0;y<R.pps.length;y++)x=R.pps[y],D=x.byteLength,A.push(D>>>8&255),A.push(D&255),A=A.concat(Array.prototype.slice.call(x));var E=L.box(L.types.avcC,new Uint8Array([1,b[3],b[4],b[5],255,224|R.sps.length].concat(b).concat([R.pps.length]).concat(A))),m=R.width,p=R.height,u=R.pixelRatio[0],e=R.pixelRatio[1];return L.box(L.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>8&255,m&255,p>>8&255,p&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),E,L.box(L.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),L.box(L.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,e>>24,e>>16&255,e>>8&255,e&255])))},L.esds=function(R){var b=R.config.length;return new Uint8Array([0,0,0,0,3,23+b,0,1,0,4,15+b,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([b]).concat(R.config).concat([6,1,2]))},L.mp4a=function(R){var b=R.samplerate;return L.box(L.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,b>>8&255,b&255,0,0]),L.box(L.types.esds,L.esds(R)))},L.mp3=function(R){var b=R.samplerate;return L.box(L.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,b>>8&255,b&255,0,0]))},L.stsd=function(R){return R.type==="audio"?R.segmentCodec==="mp3"&&R.codec==="mp3"?L.box(L.types.stsd,L.STSD,L.mp3(R)):L.box(L.types.stsd,L.STSD,L.mp4a(R)):L.box(L.types.stsd,L.STSD,L.avc1(R))},L.tkhd=function(R){var b=R.id,A=R.duration*R.timescale,y=R.width,x=R.height,D=Math.floor(A/(P+1)),E=Math.floor(A%(P+1));return L.box(L.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,b&255,0,0,0,0,D>>24,D>>16&255,D>>8&255,D&255,E>>24,E>>16&255,E>>8&255,E&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,y>>8&255,y&255,0,0,x>>8&255,x&255,0,0]))},L.traf=function(R,b){var A=L.sdtp(R),y=R.id,x=Math.floor(b/(P+1)),D=Math.floor(b%(P+1));return L.box(L.types.traf,L.box(L.types.tfhd,new Uint8Array([0,0,0,0,y>>24,y>>16&255,y>>8&255,y&255])),L.box(L.types.tfdt,new Uint8Array([1,0,0,0,x>>24,x>>16&255,x>>8&255,x&255,D>>24,D>>16&255,D>>8&255,D&255])),L.trun(R,A.length+16+20+8+16+8+8),A)},L.trak=function(R){return R.duration=R.duration||4294967295,L.box(L.types.trak,L.tkhd(R),L.mdia(R))},L.trex=function(R){var b=R.id;return L.box(L.types.trex,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,b&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},L.trun=function(R,b){var A=R.samples||[],y=A.length,x=12+16*y,D=new Uint8Array(x),E,m,p,u,e,s;for(b+=8+x,D.set([R.type==="video"?1:0,0,15,1,y>>>24&255,y>>>16&255,y>>>8&255,y&255,b>>>24&255,b>>>16&255,b>>>8&255,b&255],0),E=0;E<y;E++)m=A[E],p=m.duration,u=m.size,e=m.flags,s=m.cts,D.set([p>>>24&255,p>>>16&255,p>>>8&255,p&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,e.isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.paddingValue<<1|e.isNonSync,e.degradPrio&240<<8,e.degradPrio&15,s>>>24&255,s>>>16&255,s>>>8&255,s&255],12+16*E);return L.box(L.types.trun,D)},L.initSegment=function(R){L.types||L.init();var b=L.moov(R),A=new Uint8Array(L.FTYP.byteLength+b.byteLength);return A.set(L.FTYP),A.set(b,L.FTYP.byteLength),A},L}();_.types=void 0,_.HDLR_TYPES=void 0,_.STTS=void 0,_.STSC=void 0,_.STCO=void 0,_.STSZ=void 0,_.VMHD=void 0,_.SMHD=void 0,_.STSD=void 0,_.FTYP=void 0,_.DINF=void 0,O.default=_},"./src/remux/mp4-remuxer.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return e}),h.d(O,"normalizePts",function(){return s}),h.d(O,"flushTextTrackMetadataCueSamples",function(){return g}),h.d(O,"flushTextTrackUserdataCueSamples",function(){return i});var P=h("./src/polyfills/number.ts"),_=h("./src/remux/aac-helper.ts"),L=h("./src/remux/mp4-generator.ts"),M=h("./src/events.ts"),R=h("./src/errors.ts"),b=h("./src/utils/logger.ts"),A=h("./src/types/loader.ts"),y=h("./src/utils/timescale-conversion.ts");function x(){return x=Object.assign?Object.assign.bind():function(d){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(d[l]=n[l])}return d},x.apply(this,arguments)}var D=10*1e3,E=1024,m=1152,p=null,u=null,e=function(){function d(n,l,a,f){if(f===void 0&&(f=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=n,this.config=l,this.typeSupported=a,this.ISGenerated=!1,p===null){var v=navigator.userAgent||"",S=v.match(/Chrome\/(\d+)/i);p=S?parseInt(S[1]):0}if(u===null){var T=navigator.userAgent.match(/Safari\/(\d+)/i);u=T?parseInt(T[1]):0}}var t=d.prototype;return t.destroy=function(){},t.resetTimeStamp=function(l){b.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=l},t.resetNextTimestamp=function(){b.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},t.resetInitSegment=function(){b.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},t.getVideoStartPts=function(l){var a=!1,f=l.reduce(function(v,S){var T=S.pts-v;return T<-4294967296?(a=!0,s(v,S.pts)):T>0?v:S.pts},l[0].pts);return a&&b.logger.debug("PTS rollover detected"),f},t.remux=function(l,a,f,v,S,T,I,k){var B,N,W,G,z,Y,$=S,Z=S,q=l.pid>-1,ie=a.pid>-1,ne=a.samples.length,ae=l.samples.length>0,te=I&&ne>0||ne>1,fe=(!q||ae)&&(!ie||te)||this.ISGenerated||I;if(fe){this.ISGenerated||(W=this.generateIS(l,a,S));var de=this.isVideoContiguous,re=-1,Ee;if(te&&(re=c(a.samples),!de&&this.config.forceKeyFrameOnDiscontinuity))if(Y=!0,re>0){b.logger.warn("[mp4-remuxer]: Dropped "+re+" out of "+ne+" video samples due to a missing keyframe");var me=this.getVideoStartPts(a.samples);a.samples=a.samples.slice(re),a.dropped+=re,Z+=(a.samples[0].pts-me)/a.inputTimeScale,Ee=Z}else re===-1&&(b.logger.warn("[mp4-remuxer]: No keyframe found out of "+ne+" video samples"),Y=!1);if(this.ISGenerated){if(ae&&te){var Te=this.getVideoStartPts(a.samples),Me=s(l.samples[0].pts,Te)-Te,_e=Me/a.inputTimeScale;$+=Math.max(0,_e),Z+=Math.max(0,-_e)}if(ae){if(l.samplerate||(b.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),W=this.generateIS(l,a,S)),N=this.remuxAudio(l,$,this.isAudioContiguous,T,ie||te||k===A.PlaylistLevelType.AUDIO?Z:void 0),te){var ke=N?N.endPTS-N.startPTS:0;a.inputTimeScale||(b.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),W=this.generateIS(l,a,S)),B=this.remuxVideo(a,Z,de,ke)}}else te&&(B=this.remuxVideo(a,Z,de,0));B&&(B.firstKeyFrame=re,B.independent=re!==-1,B.firstKeyFramePTS=Ee)}}return this.ISGenerated&&(f.samples.length&&(z=g(f,S,this._initPTS,this._initDTS)),v.samples.length&&(G=i(v,S,this._initPTS))),{audio:N,video:B,initSegment:W,independent:Y,text:G,id3:z}},t.generateIS=function(l,a,f){var v=l.samples,S=a.samples,T=this.typeSupported,I={},k=!Object(P.isFiniteNumber)(this._initPTS),B="audio/mp4",N,W,G;if(k&&(N=W=1/0),l.config&&v.length){switch(l.timescale=l.samplerate,l.segmentCodec){case"mp3":T.mpeg?(B="audio/mpeg",l.codec=""):T.mp3&&(l.codec="mp3");break}I.audio={id:"audio",container:B,codec:l.codec,initSegment:l.segmentCodec==="mp3"&&T.mpeg?new Uint8Array(0):L.default.initSegment([l]),metadata:{channelCount:l.channelCount}},k&&(G=l.inputTimeScale,N=W=v[0].pts-Math.round(G*f))}if(a.sps&&a.pps&&S.length&&(a.timescale=a.inputTimeScale,I.video={id:"main",container:"video/mp4",codec:a.codec,initSegment:L.default.initSegment([a]),metadata:{width:a.width,height:a.height}},k)){G=a.inputTimeScale;var z=this.getVideoStartPts(S),Y=Math.round(G*f);W=Math.min(W,s(S[0].dts,z)-Y),N=Math.min(N,z-Y)}if(Object.keys(I).length)return this.ISGenerated=!0,k&&(this._initPTS=N,this._initDTS=W),{tracks:I,initPTS:N,timescale:G}},t.remuxVideo=function(l,a,f,v){var S=l.inputTimeScale,T=l.samples,I=[],k=T.length,B=this._initPTS,N=this.nextAvcDts,W=8,G=this.videoSampleDuration,z,Y,$=Number.POSITIVE_INFINITY,Z=Number.NEGATIVE_INFINITY,q=!1;if(!f||N===null){var ie=a*S,ne=T[0].pts-s(T[0].dts,T[0].pts);N=ie-ne}for(var ae=0;ae<k;ae++){var te=T[ae];te.pts=s(te.pts-B,N),te.dts=s(te.dts-B,N),te.dts<T[ae>0?ae-1:ae].dts&&(q=!0)}q&&T.sort(function(Ot,Qt){var St=Ot.dts-Qt.dts,hr=Ot.pts-Qt.pts;return St||hr}),z=T[0].dts,Y=T[T.length-1].dts;var fe=Y-z,de=fe?Math.round(fe/(k-1)):G||l.inputTimeScale/30;if(f){var re=z-N,Ee=re>de,me=re<-1;if(Ee||me){Ee?b.logger.warn("AVC: "+Object(y.toMsFromMpegTsClock)(re,!0)+" ms ("+re+"dts) hole between fragments detected, filling it"):b.logger.warn("AVC: "+Object(y.toMsFromMpegTsClock)(-re,!0)+" ms ("+re+"dts) overlapping between fragments detected"),z=N;var Te=T[0].pts-re;T[0].dts=z,T[0].pts=Te,b.logger.log("Video: First PTS/DTS adjusted: "+Object(y.toMsFromMpegTsClock)(Te,!0)+"/"+Object(y.toMsFromMpegTsClock)(z,!0)+", delta: "+Object(y.toMsFromMpegTsClock)(re,!0)+" ms")}}z=Math.max(0,z);for(var Me=0,_e=0,ke=0;ke<k;ke++){for(var Ie=T[ke],Be=Ie.units,be=Be.length,Ue=0,Ke=0;Ke<be;Ke++)Ue+=Be[Ke].data.length;_e+=Ue,Me+=be,Ie.length=Ue,Ie.dts=Math.max(Ie.dts,z),$=Math.min(Ie.pts,$),Z=Math.max(Ie.pts,Z)}Y=T[k-1].dts;var je=_e+4*Me+8,Ne;try{Ne=new Uint8Array(je)}catch{this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:R.ErrorTypes.MUX_ERROR,details:R.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:je,reason:"fail allocating video mdat "+je});return}var qe=new DataView(Ne.buffer);qe.setUint32(0,je),Ne.set(L.default.types.mdat,4);for(var we=!1,et=Number.POSITIVE_INFINITY,Oe=Number.POSITIVE_INFINITY,Pe=Number.NEGATIVE_INFINITY,Ye=Number.NEGATIVE_INFINITY,Ce=0;Ce<k;Ce++){for(var Ae=T[Ce],it=Ae.units,We=0,lt=0,yt=it.length;lt<yt;lt++){var Xe=it[lt],_t=Xe.data,Tt=Xe.data.byteLength;qe.setUint32(W,Tt),W+=4,Ne.set(_t,W),W+=Tt,We+=4+Tt}var nt=void 0;if(Ce<k-1)G=T[Ce+1].dts-Ae.dts,nt=T[Ce+1].pts-Ae.pts;else{var ut=this.config,at=Ce>0?Ae.dts-T[Ce-1].dts:de;if(nt=Ce>0?Ae.pts-T[Ce-1].pts:de,ut.stretchShortVideoTrack&&this.nextAudioPts!==null){var xt=Math.floor(ut.maxBufferHole*S),gt=(v?$+v*S:this.nextAudioPts)-Ae.pts;gt>xt?(G=gt-at,G<0?G=at:we=!0,b.logger.log("[mp4-remuxer]: It is approximately "+gt/90+" ms to the next segment; using duration "+G/90+" ms for the last video frame.")):G=at}else G=at}var fr=Math.round(Ae.pts-Ae.dts);et=Math.min(et,G),Pe=Math.max(Pe,G),Oe=Math.min(Oe,nt),Ye=Math.max(Ye,nt),I.push(new r(Ae.key,G,We,fr))}if(I.length){if(p){if(p<70){var Ct=I[0].flags;Ct.dependsOn=2,Ct.isNonSync=0}}else if(u&&Ye-Oe<Pe-et&&de/Pe<.025&&I[0].cts===0){b.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var bt=z,Qe=0,zt=I.length;Qe<zt;Qe++){var Mt=bt+I[Qe].duration,Xt=bt+I[Qe].cts;if(Qe<zt-1){var wt=Mt+I[Qe+1].cts;I[Qe].duration=wt-Xt}else I[Qe].duration=Qe?I[Qe-1].duration:de;I[Qe].cts=0,bt=Mt}}}console.assert(G!==null,"mp4SampleDuration must be computed"),G=we||!G?de:G,this.nextAvcDts=N=Y+G,this.videoSampleDuration=G,this.isVideoContiguous=!0;var dr=L.default.moof(l.sequenceNumber++,z,x({},l,{samples:I})),cr="video",st={data1:dr,data2:Ne,startPTS:$/S,endPTS:(Z+G)/S,startDTS:z/S,endDTS:N/S,type:cr,hasAudio:!1,hasVideo:!0,nb:I.length,dropped:l.dropped};return l.samples=[],l.dropped=0,console.assert(Ne.length,"MDAT length must not be zero"),st},t.remuxAudio=function(l,a,f,v,S){var T=l.inputTimeScale,I=l.samplerate?l.samplerate:T,k=T/I,B=l.segmentCodec==="aac"?E:m,N=B*k,W=this._initPTS,G=l.segmentCodec==="mp3"&&this.typeSupported.mpeg,z=[],Y=S!==void 0,$=l.samples,Z=G?0:8,q=this.nextAudioPts||-1,ie=a*T;if(this.isAudioContiguous=f=f||$.length&&q>0&&(v&&Math.abs(ie-q)<9e3||Math.abs(s($[0].pts-W,ie)-q)<20*N),$.forEach(function(Xe){Xe.pts=s(Xe.pts-W,ie)}),!f||q<0){if($=$.filter(function(Xe){return Xe.pts>=0}),!$.length)return;S===0?q=0:v&&!Y?q=Math.max(0,ie):q=$[0].pts}if(l.segmentCodec==="aac")for(var ne=this.config.maxAudioFramesDrift,ae=0,te=q;ae<$.length;ae++){var fe=$[ae],de=fe.pts,re=de-te,Ee=Math.abs(1e3*re/T);if(re<=-ne*N&&Y)ae===0&&(b.logger.warn("Audio frame @ "+(de/T).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*re/T)+" ms."),this.nextAudioPts=q=te=de);else if(re>=ne*N&&Ee<D&&Y){var me=Math.round(re/N);te=de-me*N,te<0&&(me--,te+=N),ae===0&&(this.nextAudioPts=q=te),b.logger.warn("[mp4-remuxer]: Injecting "+me+" audio frame @ "+(te/T).toFixed(3)+"s due to "+Math.round(1e3*re/T)+" ms gap.");for(var Te=0;Te<me;Te++){var Me=Math.max(te,0),_e=_.default.getSilentFrame(l.manifestCodec||l.codec,l.channelCount);_e||(b.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),_e=fe.unit.subarray()),$.splice(ae,0,{unit:_e,pts:Me}),te+=N,ae++}}fe.pts=te,te+=N}for(var ke=null,Ie=null,Be,be=0,Ue=$.length;Ue--;)be+=$[Ue].unit.byteLength;for(var Ke=0,je=$.length;Ke<je;Ke++){var Ne=$[Ke],qe=Ne.unit,we=Ne.pts;if(Ie!==null){var et=z[Ke-1];et.duration=Math.round((we-Ie)/k)}else if(f&&l.segmentCodec==="aac"&&(we=q),ke=we,be>0){be+=Z;try{Be=new Uint8Array(be)}catch{this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:R.ErrorTypes.MUX_ERROR,details:R.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:be,reason:"fail allocating audio mdat "+be});return}if(!G){var Oe=new DataView(Be.buffer);Oe.setUint32(0,be),Be.set(L.default.types.mdat,4)}}else return;Be.set(qe,Z);var Pe=qe.byteLength;Z+=Pe,z.push(new r(!0,B,Pe,0)),Ie=we}var Ye=z.length;if(!!Ye){var Ce=z[z.length-1];this.nextAudioPts=q=Ie+k*Ce.duration;var Ae=G?new Uint8Array(0):L.default.moof(l.sequenceNumber++,ke/k,x({},l,{samples:z}));l.samples=[];var it=ke/T,We=q/T,lt="audio",yt={data1:Ae,data2:Be,startPTS:it,endPTS:We,startDTS:it,endDTS:We,type:lt,hasAudio:!0,hasVideo:!1,nb:Ye};return this.isAudioContiguous=!0,console.assert(Be.length,"MDAT length must not be zero"),yt}},t.remuxEmptyAudio=function(l,a,f,v){var S=l.inputTimeScale,T=l.samplerate?l.samplerate:S,I=S/T,k=this.nextAudioPts,B=(k!==null?k:v.startDTS*S)+this._initDTS,N=v.endDTS*S+this._initDTS,W=I*E,G=Math.ceil((N-B)/W),z=_.default.getSilentFrame(l.manifestCodec||l.codec,l.channelCount);if(b.logger.warn("[mp4-remuxer]: remux empty Audio"),!z){b.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var Y=[],$=0;$<G;$++){var Z=B+$*W;Y.push({unit:z,pts:Z,dts:Z})}return l.samples=Y,this.remuxAudio(l,a,f,!1)},d}();function s(d,t){var n;if(t===null)return d;for(t<d?n=-8589934592:n=8589934592;Math.abs(d-t)>4294967296;)d+=n;return d}function c(d){for(var t=0;t<d.length;t++)if(d[t].key)return t;return-1}function g(d,t,n,l){var a=d.samples.length;if(!!a){for(var f=d.inputTimeScale,v=0;v<a;v++){var S=d.samples[v];S.pts=s(S.pts-n,t*f)/f,S.dts=s(S.dts-l,t*f)/f}var T=d.samples;return d.samples=[],{samples:T}}}function i(d,t,n){var l=d.samples.length;if(!!l){for(var a=d.inputTimeScale,f=0;f<l;f++){var v=d.samples[f];v.pts=s(v.pts-n,t*a)/a}d.samples.sort(function(T,I){return T.pts-I.pts});var S=d.samples;return d.samples=[],{samples:S}}}var r=function(t,n,l,a){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=n,this.size=l,this.cts=a,this.flags=new o(t)},o=function(t){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1}},"./src/remux/passthrough-remuxer.ts":function(U,O,h){"use strict";h.r(O);var P=h("./src/polyfills/number.ts"),_=h("./src/remux/mp4-remuxer.ts"),L=h("./src/utils/mp4-tools.ts"),M=h("./src/loader/fragment.ts"),R=h("./src/utils/logger.ts"),b=function(){function y(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var x=y.prototype;return x.destroy=function(){},x.resetTimeStamp=function(E){this.initPTS=E,this.lastEndTime=null},x.resetNextTimestamp=function(){this.lastEndTime=null},x.resetInitSegment=function(E,m,p){this.audioCodec=m,this.videoCodec=p,this.generateInitSegment(E),this.emitInitSegment=!0},x.generateInitSegment=function(E){var m=this.audioCodec,p=this.videoCodec;if(!E||!E.byteLength){this.initTracks=void 0,this.initData=void 0;return}var u=this.initData=Object(L.parseInitSegment)(E);m||(m=A(u.audio,M.ElementaryStreamTypes.AUDIO)),p||(p=A(u.video,M.ElementaryStreamTypes.VIDEO));var e={};u.audio&&u.video?e.audiovideo={container:"video/mp4",codec:m+","+p,initSegment:E,id:"main"}:u.audio?e.audio={container:"audio/mp4",codec:m,initSegment:E,id:"audio"}:u.video?e.video={container:"video/mp4",codec:p,initSegment:E,id:"main"}:R.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=e},x.remux=function(E,m,p,u,e){var s,c=this.initPTS,g=this.lastEndTime,i={audio:void 0,video:void 0,text:u,id3:p,initSegment:void 0};Object(P.isFiniteNumber)(g)||(g=this.lastEndTime=e||0);var r=m.samples;if(!r||!r.length)return i;var o={initPTS:void 0,timescale:1},d=this.initData;if((!d||!d.length)&&(this.generateInitSegment(r),d=this.initData),!d||!d.length)return R.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),i;this.emitInitSegment&&(o.tracks=this.initTracks,this.emitInitSegment=!1);var t=Object(L.getStartDTS)(d,r);Object(P.isFiniteNumber)(c)||(this.initPTS=o.initPTS=c=t-e);var n=Object(L.getDuration)(r,d),l=E?t-c:g,a=l+n;Object(L.offsetStartDTS)(d,r,c),n>0?this.lastEndTime=a:(R.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var f=!!d.audio,v=!!d.video,S="";f&&(S+="audio"),v&&(S+="video");var T={data1:r,startPTS:l,startDTS:l,endPTS:a,endDTS:a,type:S,hasAudio:f,hasVideo:v,nb:1,dropped:0};i.audio=T.type==="audio"?T:void 0,i.video=T.type!=="audio"?T:void 0,i.initSegment=o;var I=(s=this.initPTS)!=null?s:0;return i.id3=Object(_.flushTextTrackMetadataCueSamples)(p,e,I,I),u.samples.length&&(i.text=Object(_.flushTextTrackUserdataCueSamples)(u,e,I)),i},y}();function A(y,x){var D=y==null?void 0:y.codec;return D&&D.length>4?D:D==="hvc1"||D==="hev1"?"hvc1.1.c.L120.90":D==="av01"?"av01.0.04M.08":D==="avc1"||x===M.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}O.default=b},"./src/task-loop.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return P});var P=function(){function _(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var L=_.prototype;return L.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},L.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},L.onHandlerDestroyed=function(){},L.hasInterval=function(){return!!this._tickInterval},L.hasNextTick=function(){return!!this._tickTimer},L.setInterval=function(R){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,R),!0)},L.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},L.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},L.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},L.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},L.doTick=function(){},_}()},"./src/types/cmcd.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"CMCDVersion",function(){return P}),h.d(O,"CMCDObjectType",function(){return _}),h.d(O,"CMCDStreamingFormat",function(){return L}),h.d(O,"CMCDStreamType",function(){return M});var P=1,_;(function(R){R.MANIFEST="m",R.AUDIO="a",R.VIDEO="v",R.MUXED="av",R.INIT="i",R.CAPTION="c",R.TIMED_TEXT="tt",R.KEY="k",R.OTHER="o"})(_||(_={}));var L;(function(R){R.DASH="d",R.HLS="h",R.SMOOTH="s",R.OTHER="o"})(L||(L={}));var M;(function(R){R.VOD="v",R.LIVE="l"})(M||(M={}))},"./src/types/demuxer.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"MetadataSchema",function(){return P});var P;(function(_){_.audioId3="org.id3",_.dateRange="com.apple.quicktime.HLS",_.emsg="https://aomedia.org/emsg/ID3"})(P||(P={}))},"./src/types/level.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"HlsSkip",function(){return L}),h.d(O,"getSkipValue",function(){return M}),h.d(O,"HlsUrlParameters",function(){return R}),h.d(O,"Level",function(){return b});function P(A,y){for(var x=0;x<y.length;x++){var D=y[x];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(A,D.key,D)}}function _(A,y,x){return y&&P(A.prototype,y),x&&P(A,x),Object.defineProperty(A,"prototype",{writable:!1}),A}var L;(function(A){A.No="",A.Yes="YES",A.v2="v2"})(L||(L={}));function M(A,y){var x=A.canSkipUntil,D=A.canSkipDateRanges,E=A.endSN,m=y!==void 0?y-E:0;return x&&m<x?D?L.v2:L.Yes:L.No}var R=function(){function A(x,D,E){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=x,this.part=D,this.skip=E}var y=A.prototype;return y.addDirectives=function(D){var E=new self.URL(D);return this.msn!==void 0&&E.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&E.searchParams.set("_HLS_part",this.part.toString()),this.skip&&E.searchParams.set("_HLS_skip",this.skip),E.toString()},A}(),b=function(){function A(y){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[y.url],this.attrs=y.attrs,this.bitrate=y.bitrate,y.details&&(this.details=y.details),this.id=y.id||0,this.name=y.name,this.width=y.width||0,this.height=y.height||0,this.audioCodec=y.audioCodec,this.videoCodec=y.videoCodec,this.unknownCodecs=y.unknownCodecs,this.codecSet=[y.videoCodec,y.audioCodec].filter(function(x){return x}).join(",").replace(/\.[^.,]+/g,"")}return _(A,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(x){var D=x%this.url.length;this._urlId!==D&&(this.details=void 0,this._urlId=D)}}]),A}()},"./src/types/loader.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"PlaylistContextType",function(){return P}),h.d(O,"PlaylistLevelType",function(){return _});var P;(function(L){L.MANIFEST="manifest",L.LEVEL="level",L.AUDIO_TRACK="audioTrack",L.SUBTITLE_TRACK="subtitleTrack"})(P||(P={}));var _;(function(L){L.MAIN="main",L.AUDIO="audio",L.SUBTITLE="subtitle"})(_||(_={}))},"./src/types/transmuxer.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"ChunkMetadata",function(){return P});var P=function(M,R,b,A,y,x){A===void 0&&(A=0),y===void 0&&(y=-1),x===void 0&&(x=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=_(),this.buffering={audio:_(),video:_(),audiovideo:_()},this.level=M,this.sn=R,this.id=b,this.size=A,this.part=y,this.partial=x};function _(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"AttrList",function(){return L});var P=/^(\d+)x(\d+)$/,_=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,L=function(){function M(b){typeof b=="string"&&(b=M.parseAttrList(b));for(var A in b)b.hasOwnProperty(A)&&(this[A]=b[A])}var R=M.prototype;return R.decimalInteger=function(A){var y=parseInt(this[A],10);return y>Number.MAX_SAFE_INTEGER?1/0:y},R.hexadecimalInteger=function(A){if(this[A]){var y=(this[A]||"0x").slice(2);y=(y.length&1?"0":"")+y;for(var x=new Uint8Array(y.length/2),D=0;D<y.length/2;D++)x[D]=parseInt(y.slice(D*2,D*2+2),16);return x}else return null},R.hexadecimalIntegerAsNumber=function(A){var y=parseInt(this[A],16);return y>Number.MAX_SAFE_INTEGER?1/0:y},R.decimalFloatingPoint=function(A){return parseFloat(this[A])},R.optionalFloat=function(A,y){var x=this[A];return x?parseFloat(x):y},R.enumeratedString=function(A){return this[A]},R.bool=function(A){return this[A]==="YES"},R.decimalResolution=function(A){var y=P.exec(this[A]);if(y!==null)return{width:parseInt(y[1],10),height:parseInt(y[2],10)}},M.parseAttrList=function(A){var y,x={},D='"';for(_.lastIndex=0;(y=_.exec(A))!==null;){var E=y[2];E.indexOf(D)===0&&E.lastIndexOf(D)===E.length-1&&(E=E.slice(1,-1)),x[y[1]]=E}return x},M}()},"./src/utils/binary-search.ts":function(U,O,h){"use strict";h.r(O);var P={search:function(L,M){for(var R=0,b=L.length-1,A=null,y=null;R<=b;){A=(R+b)/2|0,y=L[A];var x=M(y);if(x>0)R=A+1;else if(x<0)b=A-1;else return y}return null}};O.default=P},"./src/utils/buffer-helper.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"BufferHelper",function(){return L});var P=h("./src/utils/logger.ts"),_={length:0,start:function(){return 0},end:function(){return 0}},L=function(){function M(){}return M.isBuffered=function(b,A){try{if(b){for(var y=M.getBuffered(b),x=0;x<y.length;x++)if(A>=y.start(x)&&A<=y.end(x))return!0}}catch{}return!1},M.bufferInfo=function(b,A,y){try{if(b){var x=M.getBuffered(b),D=[],E;for(E=0;E<x.length;E++)D.push({start:x.start(E),end:x.end(E)});return this.bufferedInfo(D,A,y)}}catch{}return{len:0,start:A,end:A,nextStart:void 0}},M.bufferedInfo=function(b,A,y){A=Math.max(0,A),b.sort(function(r,o){var d=r.start-o.start;return d||o.end-r.end});var x=[];if(y)for(var D=0;D<b.length;D++){var E=x.length;if(E){var m=x[E-1].end;b[D].start-m<y?b[D].end>m&&(x[E-1].end=b[D].end):x.push(b[D])}else x.push(b[D])}else x=b;for(var p=0,u,e=A,s=A,c=0;c<x.length;c++){var g=x[c].start,i=x[c].end;if(A+y>=g&&A<i)e=g,s=i,p=s-A;else if(A+y<g){u=g;break}}return{len:p,start:e||0,end:s||0,nextStart:u}},M.getBuffered=function(b){try{return b.buffered}catch(A){return P.logger.log("failed to get media.buffered",A),_}},M}()},"./src/utils/cea-608-parser.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"Row",function(){return s}),h.d(O,"CaptionScreen",function(){return c});var P=h("./src/utils/logger.ts"),_={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},L=function(n){var l=n;return _.hasOwnProperty(n)&&(l=_[n]),String.fromCharCode(l)},M=15,R=100,b={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},A={17:2,18:4,21:6,22:8,23:10,19:13,20:15},y={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},x={25:2,26:4,29:6,30:8,31:10,27:13,28:15},D=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],E;(function(t){t[t.ERROR=0]="ERROR",t[t.TEXT=1]="TEXT",t[t.WARNING=2]="WARNING",t[t.INFO=2]="INFO",t[t.DEBUG=3]="DEBUG",t[t.DATA=3]="DATA"})(E||(E={}));var m=function(){function t(){this.time=null,this.verboseLevel=E.ERROR}var n=t.prototype;return n.log=function(a,f){this.verboseLevel>=a&&P.logger.log(this.time+" ["+a+"] "+f)},t}(),p=function(n){for(var l=[],a=0;a<n.length;a++)l.push(n[a].toString(16));return l},u=function(){function t(l,a,f,v,S){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=l||"white",this.underline=a||!1,this.italics=f||!1,this.background=v||"black",this.flash=S||!1}var n=t.prototype;return n.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},n.setStyles=function(a){for(var f=["foreground","underline","italics","background","flash"],v=0;v<f.length;v++){var S=f[v];a.hasOwnProperty(S)&&(this[S]=a[S])}},n.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},n.equals=function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash},n.copy=function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash},n.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),e=function(){function t(l,a,f,v,S,T){this.uchar=void 0,this.penState=void 0,this.uchar=l||" ",this.penState=new u(a,f,v,S,T)}var n=t.prototype;return n.reset=function(){this.uchar=" ",this.penState.reset()},n.setChar=function(a,f){this.uchar=a,this.penState.copy(f)},n.setPenState=function(a){this.penState.copy(a)},n.equals=function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)},n.copy=function(a){this.uchar=a.uchar,this.penState.copy(a.penState)},n.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},t}(),s=function(){function t(l){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var a=0;a<R;a++)this.chars.push(new e);this.logger=l,this.pos=0,this.currPenState=new u}var n=t.prototype;return n.equals=function(a){for(var f=!0,v=0;v<R;v++)if(!this.chars[v].equals(a.chars[v])){f=!1;break}return f},n.copy=function(a){for(var f=0;f<R;f++)this.chars[f].copy(a.chars[f])},n.isEmpty=function(){for(var a=!0,f=0;f<R;f++)if(!this.chars[f].isEmpty()){a=!1;break}return a},n.setCursor=function(a){this.pos!==a&&(this.pos=a),this.pos<0?(this.logger.log(E.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>R&&(this.logger.log(E.DEBUG,"Too large cursor position "+this.pos),this.pos=R)},n.moveCursor=function(a){var f=this.pos+a;if(a>1)for(var v=this.pos+1;v<f+1;v++)this.chars[v].setPenState(this.currPenState);this.setCursor(f)},n.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},n.insertChar=function(a){a>=144&&this.backSpace();var f=L(a);if(this.pos>=R){this.logger.log(E.ERROR,"Cannot insert "+a.toString(16)+" ("+f+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(f,this.currPenState),this.moveCursor(1)},n.clearFromPos=function(a){var f;for(f=a;f<R;f++)this.chars[f].reset()},n.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},n.clearToEndOfRow=function(){this.clearFromPos(this.pos)},n.getTextString=function(){for(var a=[],f=!0,v=0;v<R;v++){var S=this.chars[v].uchar;S!==" "&&(f=!1),a.push(S)}return f?"":a.join("")},n.setPenStyles=function(a){this.currPenState.setStyles(a);var f=this.chars[this.pos];f.setPenState(this.currPenState)},t}(),c=function(){function t(l){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var a=0;a<M;a++)this.rows.push(new s(l));this.logger=l,this.currRow=M-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var n=t.prototype;return n.reset=function(){for(var a=0;a<M;a++)this.rows[a].clear();this.currRow=M-1},n.equals=function(a){for(var f=!0,v=0;v<M;v++)if(!this.rows[v].equals(a.rows[v])){f=!1;break}return f},n.copy=function(a){for(var f=0;f<M;f++)this.rows[f].copy(a.rows[f])},n.isEmpty=function(){for(var a=!0,f=0;f<M;f++)if(!this.rows[f].isEmpty()){a=!1;break}return a},n.backSpace=function(){var a=this.rows[this.currRow];a.backSpace()},n.clearToEndOfRow=function(){var a=this.rows[this.currRow];a.clearToEndOfRow()},n.insertChar=function(a){var f=this.rows[this.currRow];f.insertChar(a)},n.setPen=function(a){var f=this.rows[this.currRow];f.setPenStyles(a)},n.moveCursor=function(a){var f=this.rows[this.currRow];f.moveCursor(a)},n.setCursor=function(a){this.logger.log(E.INFO,"setCursor: "+a);var f=this.rows[this.currRow];f.setCursor(a)},n.setPAC=function(a){this.logger.log(E.INFO,"pacData = "+JSON.stringify(a));var f=a.row-1;if(this.nrRollUpRows&&f<this.nrRollUpRows-1&&(f=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==f){for(var v=0;v<M;v++)this.rows[v].clear();var S=this.currRow+1-this.nrRollUpRows,T=this.lastOutputScreen;if(T){var I=T.rows[S].cueStartTime,k=this.logger.time;if(I&&k!==null&&I<k)for(var B=0;B<this.nrRollUpRows;B++)this.rows[f-this.nrRollUpRows+B+1].copy(T.rows[S+B])}}this.currRow=f;var N=this.rows[this.currRow];if(a.indent!==null){var W=a.indent,G=Math.max(W-1,0);N.setCursor(a.indent),a.color=N.chars[G].penState.foreground}var z={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(z)},n.setBkgData=function(a){this.logger.log(E.INFO,"bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)},n.setRollUpRows=function(a){this.nrRollUpRows=a},n.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(E.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(E.TEXT,this.getDisplayText());var a=this.currRow+1-this.nrRollUpRows,f=this.rows.splice(a,1)[0];f.clear(),this.rows.splice(this.currRow,0,f),this.logger.log(E.INFO,"Rolling up")},n.getDisplayText=function(a){a=a||!1;for(var f=[],v="",S=-1,T=0;T<M;T++){var I=this.rows[T].getTextString();I&&(S=T+1,a?f.push("Row "+S+": '"+I+"'"):f.push(I.trim()))}return f.length>0&&(a?v="["+f.join(" | ")+"]":v=f.join(`
`)),v},n.getTextAndFormat=function(){return this.rows},t}(),g=function(){function t(l,a,f){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=l,this.outputFilter=a,this.mode=null,this.verbose=0,this.displayedMemory=new c(f),this.nonDisplayedMemory=new c(f),this.lastOutputScreen=new c(f),this.currRollUpRow=this.displayedMemory.rows[M-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=f}var n=t.prototype;return n.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[M-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},n.getHandler=function(){return this.outputFilter},n.setHandler=function(a){this.outputFilter=a},n.setPAC=function(a){this.writeScreen.setPAC(a)},n.setBkgData=function(a){this.writeScreen.setBkgData(a)},n.setMode=function(a){a!==this.mode&&(this.mode=a,this.logger.log(E.INFO,"MODE="+a),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)},n.insertChars=function(a){for(var f=0;f<a.length;f++)this.writeScreen.insertChar(a[f]);var v=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(E.INFO,v+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(E.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},n.ccRCL=function(){this.logger.log(E.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},n.ccBS=function(){this.logger.log(E.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},n.ccAOF=function(){},n.ccAON=function(){},n.ccDER=function(){this.logger.log(E.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},n.ccRU=function(a){this.logger.log(E.INFO,"RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)},n.ccFON=function(){this.logger.log(E.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},n.ccRDC=function(){this.logger.log(E.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},n.ccTR=function(){this.logger.log(E.INFO,"TR"),this.setMode("MODE_TEXT")},n.ccRTD=function(){this.logger.log(E.INFO,"RTD"),this.setMode("MODE_TEXT")},n.ccEDM=function(){this.logger.log(E.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},n.ccCR=function(){this.logger.log(E.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},n.ccENM=function(){this.logger.log(E.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},n.ccEOC=function(){if(this.logger.log(E.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,this.logger.log(E.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},n.ccTO=function(a){this.logger.log(E.INFO,"TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)},n.ccMIDROW=function(a){var f={flash:!1};if(f.underline=a%2===1,f.italics=a>=46,f.italics)f.foreground="white";else{var v=Math.floor(a/2)-16,S=["white","green","blue","cyan","red","yellow","magenta"];f.foreground=S[v]}this.logger.log(E.INFO,"MIDROW: "+JSON.stringify(f)),this.writeScreen.setPen(f)},n.outputDataUpdate=function(a){a===void 0&&(a=!1);var f=this.logger.time;f!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=f:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,f,this.lastOutputScreen),a&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:f),this.lastOutputScreen.copy(this.displayedMemory))},n.cueSplitAtTime=function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))},t}(),i=function(){function t(l,a,f){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var v=new m;this.channels=[null,new g(l,a,v),new g(l+1,f,v)],this.cmdHistory=d(),this.logger=v}var n=t.prototype;return n.getHandler=function(a){return this.channels[a].getHandler()},n.setHandler=function(a,f){this.channels[a].setHandler(f)},n.addData=function(a,f){var v,S,T,I=!1;this.logger.time=a;for(var k=0;k<f.length;k+=2)if(S=f[k]&127,T=f[k+1]&127,!(S===0&&T===0)){if(this.logger.log(E.DATA,"["+p([f[k],f[k+1]])+"] -> ("+p([S,T])+")"),v=this.parseCmd(S,T),v||(v=this.parseMidrow(S,T)),v||(v=this.parsePAC(S,T)),v||(v=this.parseBackgroundAttributes(S,T)),!v&&(I=this.parseChars(S,T),I)){var B=this.currentChannel;if(B&&B>0){var N=this.channels[B];N.insertChars(I)}else this.logger.log(E.WARNING,"No channel found yet. TEXT-MODE?")}!v&&!I&&this.logger.log(E.WARNING,"Couldn't parse cleaned data "+p([S,T])+" orig: "+p([f[k],f[k+1]]))}},n.parseCmd=function(a,f){var v=this.cmdHistory,S=(a===20||a===28||a===21||a===29)&&f>=32&&f<=47,T=(a===23||a===31)&&f>=33&&f<=35;if(!(S||T))return!1;if(o(a,f,v))return r(null,null,v),this.logger.log(E.DEBUG,"Repeated command ("+p([a,f])+") is dropped"),!0;var I=a===20||a===21||a===23?1:2,k=this.channels[I];return a===20||a===21||a===28||a===29?f===32?k.ccRCL():f===33?k.ccBS():f===34?k.ccAOF():f===35?k.ccAON():f===36?k.ccDER():f===37?k.ccRU(2):f===38?k.ccRU(3):f===39?k.ccRU(4):f===40?k.ccFON():f===41?k.ccRDC():f===42?k.ccTR():f===43?k.ccRTD():f===44?k.ccEDM():f===45?k.ccCR():f===46?k.ccENM():f===47&&k.ccEOC():k.ccTO(f-32),r(a,f,v),this.currentChannel=I,!0},n.parseMidrow=function(a,f){var v=0;if((a===17||a===25)&&f>=32&&f<=47){if(a===17?v=1:v=2,v!==this.currentChannel)return this.logger.log(E.ERROR,"Mismatch channel in midrow parsing"),!1;var S=this.channels[v];return S?(S.ccMIDROW(f),this.logger.log(E.DEBUG,"MIDROW ("+p([a,f])+")"),!0):!1}return!1},n.parsePAC=function(a,f){var v,S=this.cmdHistory,T=(a>=17&&a<=23||a>=25&&a<=31)&&f>=64&&f<=127,I=(a===16||a===24)&&f>=64&&f<=95;if(!(T||I))return!1;if(o(a,f,S))return r(null,null,S),!0;var k=a<=23?1:2;f>=64&&f<=95?v=k===1?b[a]:y[a]:v=k===1?A[a]:x[a];var B=this.channels[k];return B?(B.setPAC(this.interpretPAC(v,f)),r(a,f,S),this.currentChannel=k,!0):!1},n.interpretPAC=function(a,f){var v,S={color:null,italics:!1,indent:null,underline:!1,row:a};return f>95?v=f-96:v=f-64,S.underline=(v&1)===1,v<=13?S.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(v/2)]:v<=15?(S.italics=!0,S.color="white"):S.indent=Math.floor((v-16)/2)*4,S},n.parseChars=function(a,f){var v,S=null,T=null;if(a>=25?(v=2,T=a-8):(v=1,T=a),T>=17&&T<=19){var I;T===17?I=f+80:T===18?I=f+112:I=f+144,this.logger.log(E.INFO,"Special char '"+L(I)+"' in channel "+v),S=[I]}else a>=32&&a<=127&&(S=f===0?[a]:[a,f]);if(S){var k=p(S);this.logger.log(E.DEBUG,"Char codes =  "+k.join(",")),r(a,f,this.cmdHistory)}return S},n.parseBackgroundAttributes=function(a,f){var v=(a===16||a===24)&&f>=32&&f<=47,S=(a===23||a===31)&&f>=45&&f<=47;if(!(v||S))return!1;var T,I={};a===16||a===24?(T=Math.floor((f-32)/2),I.background=D[T],f%2===1&&(I.background=I.background+"_semi")):f===45?I.background="transparent":(I.foreground="black",f===47&&(I.underline=!0));var k=a<=23?1:2,B=this.channels[k];return B.setBkgData(I),r(a,f,this.cmdHistory),!0},n.reset=function(){for(var a=0;a<Object.keys(this.channels).length;a++){var f=this.channels[a];f&&f.reset()}this.cmdHistory=d()},n.cueSplitAtTime=function(a){for(var f=0;f<this.channels.length;f++){var v=this.channels[f];v&&v.cueSplitAtTime(a)}},t}();function r(t,n,l){l.a=t,l.b=n}function o(t,n,l){return l.a===t&&l.b===n}function d(){return{a:null,b:null}}O.default=i},"./src/utils/codecs.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"isCodecType",function(){return _}),h.d(O,"isCodecSupportedInMp4",function(){return L});var P={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function _(M,R){var b=P[R];return!!b&&b[M.slice(0,4)]===!0}function L(M,R){return MediaSource.isTypeSupported((R||"video")+'/mp4;codecs="'+M+'"')}},"./src/utils/cues.ts":function(U,O,h){"use strict";h.r(O);var P=h("./src/utils/vttparser.ts"),_=h("./src/utils/webvtt-parser.ts"),L=h("./src/utils/texttrack-utils.ts"),M=/\s/,R={newCue:function(A,y,x,D){for(var E=[],m,p,u,e,s,c=self.VTTCue||self.TextTrackCue,g=0;g<D.rows.length;g++)if(m=D.rows[g],u=!0,e=0,s="",!m.isEmpty()){for(var i=0;i<m.chars.length;i++)M.test(m.chars[i].uchar)&&u?e++:(s+=m.chars[i].uchar,u=!1);m.cueStartTime=y,y===x&&(x+=1e-4),e>=16?e--:e++;var r=Object(P.fixLineBreaks)(s.trim()),o=Object(_.generateCueId)(y,x,r);(!A||!A.cues||!A.cues.getCueById(o))&&(p=new c(y,x,r),p.id=o,p.line=g+1,p.align="left",p.position=10+Math.min(80,Math.floor(e*8/32)*10),E.push(p))}return A&&E.length&&(E.sort(function(d,t){return d.line==="auto"||t.line==="auto"?0:d.line>8&&t.line>8?t.line-d.line:d.line-t.line}),E.forEach(function(d){return Object(L.addCueToTrack)(A,d)})),E}};O.default=R},"./src/utils/discontinuities.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"findFirstFragWithCC",function(){return M}),h.d(O,"shouldAlignOnDiscontinuities",function(){return R}),h.d(O,"findDiscontinuousReferenceFrag",function(){return b}),h.d(O,"adjustSlidingStart",function(){return y}),h.d(O,"alignStream",function(){return x}),h.d(O,"alignPDT",function(){return E}),h.d(O,"alignFragmentByPDTDelta",function(){return m}),h.d(O,"alignMediaPlaylistByPDT",function(){return p});var P=h("./src/polyfills/number.ts"),_=h("./src/utils/logger.ts"),L=h("./src/controller/level-helper.ts");function M(u,e){for(var s=null,c=0,g=u.length;c<g;c++){var i=u[c];if(i&&i.cc===e){s=i;break}}return s}function R(u,e,s){return!!(e.details&&(s.endCC>s.startCC||u&&u.cc<s.startCC))}function b(u,e){var s=u.fragments,c=e.fragments;if(!c.length||!s.length){_.logger.log("No fragments to align");return}var g=M(s,c[0].cc);if(!g||g&&!g.startPTS){_.logger.log("No frag in previous level to align on");return}return g}function A(u,e){if(u){var s=u.start+e;u.start=u.startPTS=s,u.endPTS=s+u.duration}}function y(u,e){for(var s=e.fragments,c=0,g=s.length;c<g;c++)A(s[c],u);e.fragmentHint&&A(e.fragmentHint,u),e.alignedSliding=!0}function x(u,e,s){!e||(D(u,s,e),!s.alignedSliding&&e.details&&E(s,e.details),!s.alignedSliding&&e.details&&!s.skippedSegments&&Object(L.adjustSliding)(e.details,s))}function D(u,e,s){if(R(u,s,e)){var c=b(s.details,e);c&&Object(P.isFiniteNumber)(c.start)&&(_.logger.log("Adjusting PTS using last level due to CC increase within current level "+e.url),y(c.start,e))}}function E(u,e){if(!(!e.fragments.length||!u.hasProgramDateTime||!e.hasProgramDateTime)){var s=e.fragments[0].programDateTime,c=u.fragments[0].programDateTime,g=(c-s)/1e3+e.fragments[0].start;g&&Object(P.isFiniteNumber)(g)&&(_.logger.log("Adjusting PTS using programDateTime delta "+(c-s)+"ms, sliding:"+g.toFixed(3)+" "+u.url+" "),y(g,u))}}function m(u,e){var s=u.programDateTime;if(!!s){var c=(s-e)/1e3;u.start=u.startPTS=c,u.endPTS=c+u.duration}}function p(u,e){if(!(!e.fragments.length||!u.hasProgramDateTime||!e.hasProgramDateTime)){var s=e.fragments[0].programDateTime,c=e.fragments[0].start,g=s-c*1e3;u.fragments.forEach(function(i){m(i,g)}),u.fragmentHint&&m(u.fragmentHint,g),u.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(U,O,h){"use strict";h.r(O);var P=h("./src/utils/ewma.ts"),_=function(){function L(R,b,A){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=A,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new P.default(R),this.fast_=new P.default(b)}var M=L.prototype;return M.update=function(b,A){var y=this.slow_,x=this.fast_;this.slow_.halfLife!==b&&(this.slow_=new P.default(b,y.getEstimate(),y.getTotalWeight())),this.fast_.halfLife!==A&&(this.fast_=new P.default(A,x.getEstimate(),x.getTotalWeight()))},M.sample=function(b,A){b=Math.max(b,this.minDelayMs_);var y=8*A,x=b/1e3,D=y/x;this.fast_.sample(x,D),this.slow_.sample(x,D)},M.canEstimate=function(){var b=this.fast_;return b&&b.getTotalWeight()>=this.minWeight_},M.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},M.destroy=function(){},L}();O.default=_},"./src/utils/ewma.ts":function(U,O,h){"use strict";h.r(O);var P=function(){function _(M,R,b){R===void 0&&(R=0),b===void 0&&(b=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=M,this.alpha_=M?Math.exp(Math.log(.5)/M):0,this.estimate_=R,this.totalWeight_=b}var L=_.prototype;return L.sample=function(R,b){var A=Math.pow(this.alpha_,R);this.estimate_=b*(1-A)+A*this.estimate_,this.totalWeight_+=R},L.getTotalWeight=function(){return this.totalWeight_},L.getEstimate=function(){if(this.alpha_){var R=1-Math.pow(this.alpha_,this.totalWeight_);if(R)return this.estimate_/R}return this.estimate_},_}();O.default=P},"./src/utils/fetch-loader.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"fetchSupported",function(){return m});var P=h("./src/polyfills/number.ts"),_=h("./src/loader/load-stats.ts"),L=h("./src/demux/chunk-cache.ts");function M(c,g){c.prototype=Object.create(g.prototype),c.prototype.constructor=c,x(c,g)}function R(c){var g=typeof Map=="function"?new Map:void 0;return R=function(r){if(r===null||!y(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof g!="undefined"){if(g.has(r))return g.get(r);g.set(r,o)}function o(){return b(r,arguments,D(this).constructor)}return o.prototype=Object.create(r.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),x(o,r)},R(c)}function b(c,g,i){return A()?b=Reflect.construct.bind():b=function(o,d,t){var n=[null];n.push.apply(n,d);var l=Function.bind.apply(o,n),a=new l;return t&&x(a,t.prototype),a},b.apply(null,arguments)}function A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function y(c){return Function.toString.call(c).indexOf("[native code]")!==-1}function x(c,g){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},x(c,g)}function D(c){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},D(c)}function E(){return E=Object.assign?Object.assign.bind():function(c){for(var g=1;g<arguments.length;g++){var i=arguments[g];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(c[r]=i[r])}return c},E.apply(this,arguments)}function m(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var p=function(){function c(i){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=i.fetchSetup||e,this.controller=new self.AbortController,this.stats=new _.LoadStats}var g=c.prototype;return g.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},g.abortInternal=function(){var r=this.response;(!r||!r.ok)&&(this.stats.aborted=!0,this.controller.abort())},g.abort=function(){var r;this.abortInternal(),(r=this.callbacks)!==null&&r!==void 0&&r.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},g.load=function(r,o,d){var t=this,n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();var l=u(r,this.controller.signal),a=d.onProgress,f=r.responseType==="arraybuffer",v=f?"byteLength":"length";this.context=r,this.config=o,this.callbacks=d,this.request=this.fetchSetup(r,l),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){t.abortInternal(),d.onTimeout(n,r,t.response)},o.timeout),self.fetch(this.request).then(function(S){if(t.response=t.loader=S,!S.ok){var T=S.status,I=S.statusText;throw new s(I||"fetch, bad network response",T,S)}return n.loading.first=Math.max(self.performance.now(),n.loading.start),n.total=parseInt(S.headers.get("Content-Length")||"0"),a&&Object(P.isFiniteNumber)(o.highWaterMark)?t.loadProgressively(S,n,r,o.highWaterMark,a):f?S.arrayBuffer():S.text()}).then(function(S){var T=t.response;self.clearTimeout(t.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first),n.loaded=n.total=S[v];var I={url:T.url,data:S};a&&!Object(P.isFiniteNumber)(o.highWaterMark)&&a(n,r,S,T),d.onSuccess(I,n,r,T)}).catch(function(S){if(self.clearTimeout(t.requestTimeout),!n.aborted){var T=S&&S.code||0,I=S?S.message:null;d.onError({code:T,text:I},r,S?S.details:null)}})},g.getCacheAge=function(){var r=null;if(this.response){var o=this.response.headers.get("age");r=o?parseFloat(o):null}return r},g.loadProgressively=function(r,o,d,t,n){t===void 0&&(t=0);var l=new L.default,a=r.body.getReader(),f=function v(){return a.read().then(function(S){if(S.done)return l.dataLength&&n(o,d,l.flush(),r),Promise.resolve(new ArrayBuffer(0));var T=S.value,I=T.length;return o.loaded+=I,I<t||l.dataLength?(l.push(T),l.dataLength>=t&&n(o,d,l.flush(),r)):n(o,d,T,r),v()}).catch(function(){return Promise.reject()})};return f()},c}();function u(c,g){var i={method:"GET",mode:"cors",credentials:"same-origin",signal:g,headers:new self.Headers(E({},c.headers))};return c.rangeEnd&&i.headers.set("Range","bytes="+c.rangeStart+"-"+String(c.rangeEnd-1)),i}function e(c,g){return new self.Request(c.url,g)}var s=function(c){M(g,c);function g(i,r,o){var d;return d=c.call(this,i)||this,d.code=void 0,d.details=void 0,d.code=r,d.details=o,d}return g}(R(Error));O.default=p},"./src/utils/imsc1-ttml-parser.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"IMSC1_CODEC",function(){return y}),h.d(O,"parseIMSC1",function(){return m});var P=h("./src/utils/mp4-tools.ts"),_=h("./src/utils/vttparser.ts"),L=h("./src/utils/vttcue.ts"),M=h("./src/demux/id3.ts"),R=h("./src/utils/timescale-conversion.ts"),b=h("./src/utils/webvtt-parser.ts");function A(){return A=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a])}return t},A.apply(this,arguments)}var y="stpp.ttml.im1t",x=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,D=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,E={left:"start",center:"center",right:"end",start:"start",end:"end"};function m(t,n,l,a,f){var v=Object(P.findBox)(new Uint8Array(t),["mdat"]);if(v.length===0){f(new Error("Could not parse IMSC1 mdat"));return}var S=v.map(function(I){return Object(M.utf8ArrayToStr)(I)}),T=Object(R.toTimescaleFromScale)(n,1,l);try{S.forEach(function(I){return a(p(I,T))})}catch(I){f(I)}}function p(t,n){var l=new DOMParser,a=l.parseFromString(t,"text/xml"),f=a.getElementsByTagName("tt")[0];if(!f)throw new Error("Invalid ttml");var v={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},S=Object.keys(v).reduce(function(N,W){return N[W]=f.getAttribute("ttp:"+W)||v[W],N},{}),T=f.getAttribute("xml:space")!=="preserve",I=e(u(f,"styling","style")),k=e(u(f,"layout","region")),B=u(f,"body","[begin]");return[].map.call(B,function(N){var W=s(N,T);if(!W||!N.hasAttribute("begin"))return null;var G=r(N.getAttribute("begin"),S),z=r(N.getAttribute("dur"),S),Y=r(N.getAttribute("end"),S);if(G===null)throw i(N);if(Y===null){if(z===null)throw i(N);Y=G+z}var $=new L.default(G-n,Y-n,W);$.id=Object(b.generateCueId)($.startTime,$.endTime,$.text);var Z=k[N.getAttribute("region")],q=I[N.getAttribute("style")];$.position=10,$.size=80;var ie=c(Z,q,I),ne=ie.textAlign;if(ne){var ae=E[ne];ae&&($.lineAlign=ae),$.align=ne}return A($,ie),$}).filter(function(N){return N!==null})}function u(t,n,l){var a=t.getElementsByTagName(n)[0];return a?[].slice.call(a.querySelectorAll(l)):[]}function e(t){return t.reduce(function(n,l){var a=l.getAttribute("xml:id");return a&&(n[a]=l),n},{})}function s(t,n){return[].slice.call(t.childNodes).reduce(function(l,a,f){var v;return a.nodeName==="br"&&f?l+`
`:(v=a.childNodes)!==null&&v!==void 0&&v.length?s(a,n):n?l+a.textContent.trim().replace(/\s+/g," "):l+a.textContent},"")}function c(t,n,l){var a="http://www.w3.org/ns/ttml#styling",f=null,v=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],S=t!=null&&t.hasAttribute("style")?t.getAttribute("style"):null;return S&&l.hasOwnProperty(S)&&(f=l[S]),v.reduce(function(T,I){var k=g(n,a,I)||g(t,a,I)||g(f,a,I);return k&&(T[I]=k),T},{})}function g(t,n,l){return t&&t.hasAttributeNS(n,l)?t.getAttributeNS(n,l):null}function i(t){return new Error("Could not parse ttml timestamp "+t)}function r(t,n){if(!t)return null;var l=Object(_.parseTimeStamp)(t);return l===null&&(x.test(t)?l=o(t,n):D.test(t)&&(l=d(t,n))),l}function o(t,n){var l=x.exec(t),a=(l[4]|0)+(l[5]|0)/n.subFrameRate;return(l[1]|0)*3600+(l[2]|0)*60+(l[3]|0)+a/n.frameRate}function d(t,n){var l=D.exec(t),a=Number(l[1]),f=l[2];switch(f){case"h":return a*3600;case"m":return a*60;case"ms":return a*1e3;case"f":return a/n.frameRate;case"t":return a/n.tickRate}return a}},"./src/utils/logger.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"enableLogs",function(){return b}),h.d(O,"logger",function(){return A});var P=function(){},_={trace:P,debug:P,log:P,warn:P,info:P,error:P},L=_;function M(y){var x=self.console[y];return x?x.bind(self.console,"["+y+"] >"):P}function R(y){for(var x=arguments.length,D=new Array(x>1?x-1:0),E=1;E<x;E++)D[E-1]=arguments[E];D.forEach(function(m){L[m]=y[m]?y[m].bind(y):M(m)})}function b(y){if(self.console&&y===!0||typeof y=="object"){R(y,"debug","log","info","warn","error");try{L.log()}catch{L=_}}else L=_}var A=L},"./src/utils/mediakeys-helper.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"KeySystems",function(){return P}),h.d(O,"requestMediaKeySystemAccess",function(){return _});var P;(function(L){L.WIDEVINE="com.widevine.alpha",L.PLAYREADY="com.microsoft.playready"})(P||(P={}));var _=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"getMediaSource",function(){return P});function P(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"RemuxerTrackIdConfig",function(){return b}),h.d(O,"bin2str",function(){return A}),h.d(O,"readUint16",function(){return y}),h.d(O,"readUint32",function(){return x}),h.d(O,"readSint32",function(){return D}),h.d(O,"writeUint32",function(){return E}),h.d(O,"findBox",function(){return m}),h.d(O,"parseSegmentIndex",function(){return p}),h.d(O,"parseInitSegment",function(){return u}),h.d(O,"getStartDTS",function(){return e}),h.d(O,"getDuration",function(){return s}),h.d(O,"computeRawDurationFromSamples",function(){return c}),h.d(O,"offsetStartDTS",function(){return g}),h.d(O,"segmentValidRange",function(){return i}),h.d(O,"appendUint8Array",function(){return r}),h.d(O,"parseSamples",function(){return o}),h.d(O,"parseSEIMessageFromNALu",function(){return n}),h.d(O,"parseEmsg",function(){return a});var P=h("./src/utils/typed-array.ts"),_=h("./src/loader/fragment.ts"),L=h("./src/demux/id3.ts"),M=Math.pow(2,32)-1,R=[].push,b={video:1,audio:2,id3:3,text:4};function A(f){return String.fromCharCode.apply(null,f)}function y(f,v){var S=f[v]<<8|f[v+1];return S<0?65536+S:S}function x(f,v){var S=D(f,v);return S<0?4294967296+S:S}function D(f,v){return f[v]<<24|f[v+1]<<16|f[v+2]<<8|f[v+3]}function E(f,v,S){f[v]=S>>24,f[v+1]=S>>16&255,f[v+2]=S>>8&255,f[v+3]=S&255}function m(f,v){var S=[];if(!v.length)return S;for(var T=f.byteLength,I=0;I<T;){var k=x(f,I),B=A(f.subarray(I+4,I+8)),N=k>1?I+k:T;if(B===v[0])if(v.length===1)S.push(f.subarray(I+8,N));else{var W=m(f.subarray(I+8,N),v.slice(1));W.length&&R.apply(S,W)}I=N}return S}function p(f){var v=[],S=f[0],T=8,I=x(f,T);T+=4;var k=0,B=0;S===0?T+=8:T+=16,T+=2;var N=f.length+B,W=y(f,T);T+=2;for(var G=0;G<W;G++){var z=T,Y=x(f,z);z+=4;var $=Y&2147483647,Z=(Y&2147483648)>>>31;if(Z===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var q=x(f,z);z+=4,v.push({referenceSize:$,subsegmentDuration:q,info:{duration:q/I,start:N,end:N+$-1}}),N+=$,z+=4,T=z}return{earliestPresentationTime:k,timescale:I,version:S,referencesCount:W,references:v}}function u(f){for(var v=[],S=m(f,["moov","trak"]),T=0;T<S.length;T++){var I=S[T],k=m(I,["tkhd"])[0];if(k){var B=k[0],N=B===0?12:20,W=x(k,N),G=m(I,["mdia","mdhd"])[0];if(G){B=G[0],N=B===0?12:20;var z=x(G,N),Y=m(I,["mdia","hdlr"])[0];if(Y){var $=A(Y.subarray(8,12)),Z={soun:_.ElementaryStreamTypes.AUDIO,vide:_.ElementaryStreamTypes.VIDEO}[$];if(Z){var q=m(I,["mdia","minf","stbl","stsd"])[0],ie=void 0;q&&(ie=A(q.subarray(12,16))),v[W]={timescale:z,type:Z},v[Z]={timescale:z,id:W,codec:ie}}}}}}var ne=m(f,["moov","mvex","trex"]);return ne.forEach(function(ae){var te=x(ae,4),fe=v[te];fe&&(fe.default={duration:x(ae,12),flags:x(ae,20)})}),v}function e(f,v){return m(v,["moof","traf"]).reduce(function(S,T){var I=m(T,["tfdt"])[0],k=I[0],B=m(T,["tfhd"]).reduce(function(N,W){var G=x(W,4),z=f[G];if(z){var Y=x(I,4);k===1&&(Y*=Math.pow(2,32),Y+=x(I,8));var $=z.timescale||9e4,Z=Y/$;if(isFinite(Z)&&(N===null||Z<N))return Z}return N},null);return B!==null&&isFinite(B)&&(S===null||B<S)?B:S},null)||0}function s(f,v){for(var S=0,T=0,I=0,k=m(f,["moof","traf"]),B=0;B<k.length;B++){var N=k[B],W=m(N,["tfhd"])[0],G=x(W,4),z=v[G];if(!!z){var Y=z.default,$=x(W,0)|(Y==null?void 0:Y.flags),Z=Y==null?void 0:Y.duration;$&8&&($&2?Z=x(W,12):Z=x(W,8));for(var q=z.timescale||9e4,ie=m(N,["trun"]),ne=0;ne<ie.length;ne++){if(S=c(ie[ne]),!S&&Z){var ae=x(ie[ne],4);S=Z*ae}z.type===_.ElementaryStreamTypes.VIDEO?T+=S/q:z.type===_.ElementaryStreamTypes.AUDIO&&(I+=S/q)}}}if(T===0&&I===0){for(var te=0,fe=m(f,["sidx"]),de=0;de<fe.length;de++){var re=p(fe[de]);re!=null&&re.references&&(te+=re.references.reduce(function(Ee,me){return Ee+me.info.duration||0},0))}return te}return T||I}function c(f){var v=x(f,0),S=8;v&1&&(S+=4),v&4&&(S+=4);for(var T=0,I=x(f,4),k=0;k<I;k++){if(v&256){var B=x(f,S);T+=B,S+=4}v&512&&(S+=4),v&1024&&(S+=4),v&2048&&(S+=4)}return T}function g(f,v,S){m(v,["moof","traf"]).forEach(function(T){m(T,["tfhd"]).forEach(function(I){var k=x(I,4),B=f[k];if(!!B){var N=B.timescale||9e4;m(T,["tfdt"]).forEach(function(W){var G=W[0],z=x(W,4);if(G===0)z-=S*N,z=Math.max(z,0),E(W,4,z);else{z*=Math.pow(2,32),z+=x(W,8),z-=S*N,z=Math.max(z,0);var Y=Math.floor(z/(M+1)),$=Math.floor(z%(M+1));E(W,4,Y),E(W,8,$)}})}})})}function i(f){var v={valid:null,remainder:null},S=m(f,["moof"]);if(S){if(S.length<2)return v.remainder=f,v}else return v;var T=S[S.length-1];return v.valid=Object(P.sliceUint8)(f,0,T.byteOffset-8),v.remainder=Object(P.sliceUint8)(f,T.byteOffset-8),v}function r(f,v){var S=new Uint8Array(f.length+v.length);return S.set(f),S.set(v,f.length),S}function o(f,v){var S=[],T=v.samples,I=v.timescale,k=v.id,B=!1,N=m(T,["moof"]);return N.map(function(W){var G=W.byteOffset-8,z=m(W,["traf"]);z.map(function(Y){var $=m(Y,["tfdt"]).map(function(Z){var q=Z[0],ie=x(Z,4);return q===1&&(ie*=Math.pow(2,32),ie+=x(Z,8)),ie/I})[0];return $!==void 0&&(f=$),m(Y,["tfhd"]).map(function(Z){var q=x(Z,4),ie=x(Z,0)&16777215,ne=(ie&1)!==0,ae=(ie&2)!==0,te=(ie&8)!==0,fe=0,de=(ie&16)!==0,re=0,Ee=(ie&32)!==0,me=8;q===k&&(ne&&(me+=8),ae&&(me+=4),te&&(fe=x(Z,me),me+=4),de&&(re=x(Z,me),me+=4),Ee&&(me+=4),v.type==="video"&&(B=d(v.codec)),m(Y,["trun"]).map(function(Te){var Me=Te[0],_e=x(Te,0)&16777215,ke=(_e&1)!==0,Ie=0,Be=(_e&4)!==0,be=(_e&256)!==0,Ue=0,Ke=(_e&512)!==0,je=0,Ne=(_e&1024)!==0,qe=(_e&2048)!==0,we=0,et=x(Te,4),Oe=8;ke&&(Ie=x(Te,Oe),Oe+=4),Be&&(Oe+=4);for(var Pe=Ie+G,Ye=0;Ye<et;Ye++){if(be?(Ue=x(Te,Oe),Oe+=4):Ue=fe,Ke?(je=x(Te,Oe),Oe+=4):je=re,Ne&&(Oe+=4),qe&&(Me===0?we=x(Te,Oe):we=D(Te,Oe),Oe+=4),v.type===_.ElementaryStreamTypes.VIDEO)for(var Ce=0;Ce<je;){var Ae=x(T,Pe);Pe+=4;var it=T[Pe]&31;if(t(B,it)){var We=T.subarray(Pe,Pe+Ae);n(We,f+we/I,S)}Pe+=Ae,Ce+=Ae+4}f+=Ue/I}}))})})}),S}function d(f){if(!f)return!1;var v=f.indexOf("."),S=v<0?f:f.substring(0,v);return S==="hvc1"||S==="hev1"||S==="dvh1"||S==="dvhe"}function t(f,v){return f?v===39||v===40:v===6}function n(f,v,S){var T=l(f),I=0;I++;for(var k=0,B=0,N=!1,W=0;I<T.length;){k=0;do{if(I>=T.length)break;W=T[I++],k+=W}while(W===255);B=0;do{if(I>=T.length)break;W=T[I++],B+=W}while(W===255);var G=T.length-I;if(!N&&k===4&&I<T.length){N=!0;var z=T[I++];if(z===181){var Y=y(T,I);if(I+=2,Y===49){var $=x(T,I);if(I+=4,$===1195456820){var Z=T[I++];if(Z===3){var q=T[I++],ie=31&q,ne=64&q,ae=ne?2+ie*3:0,te=new Uint8Array(ae);if(ne){te[0]=q;for(var fe=1;fe<ae;fe++)te[fe]=T[I++]}S.push({type:Z,payloadType:k,pts:v,bytes:te})}}}}}else if(k===5&&B<G){if(N=!0,B>16){for(var de=[],re=0;re<16;re++){var Ee=T[I++].toString(16);de.push(Ee.length==1?"0"+Ee:Ee),(re===3||re===5||re===7||re===9)&&de.push("-")}for(var me=B-16,Te=new Uint8Array(me),Me=0;Me<me;Me++)Te[Me]=T[I++];S.push({payloadType:k,pts:v,uuid:de.join(""),userData:Object(L.utf8ArrayToStr)(Te),userDataBytes:Te})}}else if(B<G)I+=B;else if(B>G)break}}function l(f){for(var v=f.byteLength,S=[],T=1;T<v-2;)f[T]===0&&f[T+1]===0&&f[T+2]===3?(S.push(T+2),T+=2):T++;if(S.length===0)return f;var I=v-S.length,k=new Uint8Array(I),B=0;for(T=0;T<I;B++,T++)B===S[0]&&(B++,S.shift()),k[T]=f[B];return k}function a(f){var v=f[0],S="",T="",I=0,k=0,B=0,N=0,W=0,G=0;if(v===0){for(;A(f.subarray(G,G+1))!=="\0";)S+=A(f.subarray(G,G+1)),G+=1;for(S+=A(f.subarray(G,G+1)),G+=1;A(f.subarray(G,G+1))!=="\0";)T+=A(f.subarray(G,G+1)),G+=1;T+=A(f.subarray(G,G+1)),G+=1,I=x(f,12),k=x(f,16),N=x(f,20),W=x(f,24),G=28}else if(v===1){G+=4,I=x(f,G),G+=4;var z=x(f,G);G+=4;var Y=x(f,G);for(G+=4,B=Math.pow(2,32)*z+Y,Number.isSafeInteger(B)||(B=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),N=x(f,G),G+=4,W=x(f,G),G+=4;A(f.subarray(G,G+1))!=="\0";)S+=A(f.subarray(G,G+1)),G+=1;for(S+=A(f.subarray(G,G+1)),G+=1;A(f.subarray(G,G+1))!=="\0";)T+=A(f.subarray(G,G+1)),G+=1;T+=A(f.subarray(G,G+1)),G+=1}var $=f.subarray(G,f.byteLength);return{schemeIdUri:S,value:T,timeScale:I,presentationTime:B,presentationTimeDelta:k,eventDuration:N,id:W,payload:$}}},"./src/utils/output-filter.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"default",function(){return P});var P=function(){function _(M,R){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=M,this.trackName=R}var L=_.prototype;return L.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},L.newCue=function(R,b,A){(this.startTime===null||this.startTime>R)&&(this.startTime=R),this.endTime=b,this.screen=A,this.timelineController.createCaptionsTrack(this.trackName)},L.reset=function(){this.cueRanges=[],this.startTime=null},_}()},"./src/utils/texttrack-utils.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"sendAddTrackEvent",function(){return _}),h.d(O,"addCueToTrack",function(){return L}),h.d(O,"clearCurrentCues",function(){return M}),h.d(O,"removeCuesInRange",function(){return R}),h.d(O,"getCuesInRange",function(){return A});var P=h("./src/utils/logger.ts");function _(y,x){var D;try{D=new Event("addtrack")}catch{D=document.createEvent("Event"),D.initEvent("addtrack",!1,!1)}D.track=y,x.dispatchEvent(D)}function L(y,x){var D=y.mode;if(D==="disabled"&&(y.mode="hidden"),y.cues&&!y.cues.getCueById(x.id))try{if(y.addCue(x),!y.cues.getCueById(x.id))throw new Error("addCue is failed for: "+x)}catch(m){P.logger.debug("[texttrack-utils]: "+m);var E=new self.TextTrackCue(x.startTime,x.endTime,x.text);E.id=x.id,y.addCue(E)}D==="disabled"&&(y.mode=D)}function M(y){var x=y.mode;if(x==="disabled"&&(y.mode="hidden"),y.cues)for(var D=y.cues.length;D--;)y.removeCue(y.cues[D]);x==="disabled"&&(y.mode=x)}function R(y,x,D,E){var m=y.mode;if(m==="disabled"&&(y.mode="hidden"),y.cues&&y.cues.length>0)for(var p=A(y.cues,x,D),u=0;u<p.length;u++)(!E||E(p[u]))&&y.removeCue(p[u]);m==="disabled"&&(y.mode=m)}function b(y,x){if(x<y[0].startTime)return 0;var D=y.length-1;if(x>y[D].endTime)return-1;for(var E=0,m=D;E<=m;){var p=Math.floor((m+E)/2);if(x<y[p].startTime)m=p-1;else if(x>y[p].startTime&&E<D)E=p+1;else return p}return y[E].startTime-x<x-y[m].startTime?E:m}function A(y,x,D){var E=[],m=b(y,x);if(m>-1)for(var p=m,u=y.length;p<u;p++){var e=y[p];if(e.startTime>=x&&e.endTime<=D)E.push(e);else if(e.startTime>D)return E}return E}},"./src/utils/time-ranges.ts":function(U,O,h){"use strict";h.r(O);var P={toString:function(L){for(var M="",R=L.length,b=0;b<R;b++)M+="["+L.start(b).toFixed(3)+","+L.end(b).toFixed(3)+"]";return M}};O.default=P},"./src/utils/timescale-conversion.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"toTimescaleFromBase",function(){return _}),h.d(O,"toTimescaleFromScale",function(){return L}),h.d(O,"toMsFromMpegTsClock",function(){return M}),h.d(O,"toMpegTsClockFromTimescale",function(){return R});var P=9e4;function _(b,A,y,x){y===void 0&&(y=1),x===void 0&&(x=!1);var D=b*A*y;return x?Math.round(D):D}function L(b,A,y,x){return y===void 0&&(y=1),x===void 0&&(x=!1),_(b,A,1/y,x)}function M(b,A){return A===void 0&&(A=!1),_(b,1e3,1/P,A)}function R(b,A){return A===void 0&&(A=1),_(b,P,1/A)}},"./src/utils/typed-array.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"sliceUint8",function(){return P});function P(_,L,M){return Uint8Array.prototype.slice?_.slice(L,M):new Uint8Array(Array.prototype.slice.call(_,L,M))}},"./src/utils/vttcue.ts":function(U,O,h){"use strict";h.r(O),O.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var P=["","lr","rl"],_=["start","middle","end","left","right"];function L(y,x){if(typeof x!="string"||!Array.isArray(y))return!1;var D=x.toLowerCase();return~y.indexOf(D)?D:!1}function M(y){return L(P,y)}function R(y){return L(_,y)}function b(y){for(var x=arguments.length,D=new Array(x>1?x-1:0),E=1;E<x;E++)D[E-1]=arguments[E];for(var m=1;m<arguments.length;m++){var p=arguments[m];for(var u in p)y[u]=p[u]}return y}function A(y,x,D){var E=this,m={enumerable:!0};E.hasBeenReset=!1;var p="",u=!1,e=y,s=x,c=D,g=null,i="",r=!0,o="auto",d="start",t=50,n="middle",l=50,a="middle";Object.defineProperty(E,"id",b({},m,{get:function(){return p},set:function(v){p=""+v}})),Object.defineProperty(E,"pauseOnExit",b({},m,{get:function(){return u},set:function(v){u=!!v}})),Object.defineProperty(E,"startTime",b({},m,{get:function(){return e},set:function(v){if(typeof v!="number")throw new TypeError("Start time must be set to a number.");e=v,this.hasBeenReset=!0}})),Object.defineProperty(E,"endTime",b({},m,{get:function(){return s},set:function(v){if(typeof v!="number")throw new TypeError("End time must be set to a number.");s=v,this.hasBeenReset=!0}})),Object.defineProperty(E,"text",b({},m,{get:function(){return c},set:function(v){c=""+v,this.hasBeenReset=!0}})),Object.defineProperty(E,"region",b({},m,{get:function(){return g},set:function(v){g=v,this.hasBeenReset=!0}})),Object.defineProperty(E,"vertical",b({},m,{get:function(){return i},set:function(v){var S=M(v);if(S===!1)throw new SyntaxError("An invalid or illegal string was specified.");i=S,this.hasBeenReset=!0}})),Object.defineProperty(E,"snapToLines",b({},m,{get:function(){return r},set:function(v){r=!!v,this.hasBeenReset=!0}})),Object.defineProperty(E,"line",b({},m,{get:function(){return o},set:function(v){if(typeof v!="number"&&v!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");o=v,this.hasBeenReset=!0}})),Object.defineProperty(E,"lineAlign",b({},m,{get:function(){return d},set:function(v){var S=R(v);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");d=S,this.hasBeenReset=!0}})),Object.defineProperty(E,"position",b({},m,{get:function(){return t},set:function(v){if(v<0||v>100)throw new Error("Position must be between 0 and 100.");t=v,this.hasBeenReset=!0}})),Object.defineProperty(E,"positionAlign",b({},m,{get:function(){return n},set:function(v){var S=R(v);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");n=S,this.hasBeenReset=!0}})),Object.defineProperty(E,"size",b({},m,{get:function(){return l},set:function(v){if(v<0||v>100)throw new Error("Size must be between 0 and 100.");l=v,this.hasBeenReset=!0}})),Object.defineProperty(E,"align",b({},m,{get:function(){return a},set:function(v){var S=R(v);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");a=S,this.hasBeenReset=!0}})),E.displayState=void 0}return A.prototype.getCueAsHTML=function(){var y=self.WebVTT;return y.convertCueToDOMTree(self,this.text)},A}()},"./src/utils/vttparser.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"parseTimeStamp",function(){return L}),h.d(O,"fixLineBreaks",function(){return x}),h.d(O,"VTTParser",function(){return D});var P=h("./src/utils/vttcue.ts"),_=function(){function E(){}var m=E.prototype;return m.decode=function(u,e){if(!u)return"";if(typeof u!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(u))},E}();function L(E){function m(u,e,s,c){return(u|0)*3600+(e|0)*60+(s|0)+parseFloat(c||0)}var p=E.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return p?parseFloat(p[2])>59?m(p[2],p[3],0,p[4]):m(p[1],p[2],p[3],p[4]):null}var M=function(){function E(){this.values=Object.create(null)}var m=E.prototype;return m.set=function(u,e){!this.get(u)&&e!==""&&(this.values[u]=e)},m.get=function(u,e,s){return s?this.has(u)?this.values[u]:e[s]:this.has(u)?this.values[u]:e},m.has=function(u){return u in this.values},m.alt=function(u,e,s){for(var c=0;c<s.length;++c)if(e===s[c]){this.set(u,e);break}},m.integer=function(u,e){/^-?\d+$/.test(e)&&this.set(u,parseInt(e,10))},m.percent=function(u,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var s=parseFloat(e);if(s>=0&&s<=100)return this.set(u,s),!0}return!1},E}();function R(E,m,p,u){var e=u?E.split(u):[E];for(var s in e)if(typeof e[s]=="string"){var c=e[s].split(p);if(c.length===2){var g=c[0],i=c[1];m(g,i)}}}var b=new P.default(0,0,""),A=b.align==="middle"?"middle":"center";function y(E,m,p){var u=E;function e(){var g=L(E);if(g===null)throw new Error("Malformed timestamp: "+u);return E=E.replace(/^[^\sa-zA-Z-]+/,""),g}function s(g,i){var r=new M;R(g,function(t,n){var l;switch(t){case"region":for(var a=p.length-1;a>=0;a--)if(p[a].id===n){r.set(t,p[a].region);break}break;case"vertical":r.alt(t,n,["rl","lr"]);break;case"line":l=n.split(","),r.integer(t,l[0]),r.percent(t,l[0])&&r.set("snapToLines",!1),r.alt(t,l[0],["auto"]),l.length===2&&r.alt("lineAlign",l[1],["start",A,"end"]);break;case"position":l=n.split(","),r.percent(t,l[0]),l.length===2&&r.alt("positionAlign",l[1],["start",A,"end","line-left","line-right","auto"]);break;case"size":r.percent(t,n);break;case"align":r.alt(t,n,["start",A,"end","left","right"]);break}},/:/,/\s/),i.region=r.get("region",null),i.vertical=r.get("vertical","");var o=r.get("line","auto");o==="auto"&&b.line===-1&&(o=-1),i.line=o,i.lineAlign=r.get("lineAlign","start"),i.snapToLines=r.get("snapToLines",!0),i.size=r.get("size",100),i.align=r.get("align",A);var d=r.get("position","auto");d==="auto"&&b.position===50&&(d=i.align==="start"||i.align==="left"?0:i.align==="end"||i.align==="right"?100:50),i.position=d}function c(){E=E.replace(/^\s+/,"")}if(c(),m.startTime=e(),c(),E.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+u);E=E.slice(3),c(),m.endTime=e(),c(),s(E,m)}function x(E){return E.replace(/<br(?: \/)?>/gi,`
`)}var D=function(){function E(){this.state="INITIAL",this.buffer="",this.decoder=new _,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var m=E.prototype;return m.parse=function(u){var e=this;u&&(e.buffer+=e.decoder.decode(u,{stream:!0}));function s(){var d=e.buffer,t=0;for(d=x(d);t<d.length&&d[t]!=="\r"&&d[t]!==`
`;)++t;var n=d.slice(0,t);return d[t]==="\r"&&++t,d[t]===`
`&&++t,e.buffer=d.slice(t),n}function c(d){R(d,function(t,n){},/:/)}try{var g="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;g=s();var i=g.match(/^()?WEBVTT([ \t].*)?$/);if(!i||!i[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var r=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(r?r=!1:g=s(),e.state){case"HEADER":/:/.test(g)?c(g):g||(e.state="ID");continue;case"NOTE":g||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(g)){e.state="NOTE";break}if(!g)continue;if(e.cue=new P.default(0,0,""),e.state="CUE",g.indexOf("-->")===-1){e.cue.id=g;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{y(g,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{var o=g.indexOf("-->")!==-1;if(!g||o&&(r=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=g}continue;case"BADCUE":g||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},m.flush=function(){var u=this;try{if((u.cue||u.state==="HEADER")&&(u.buffer+=`

`,u.parse()),u.state==="INITIAL"||u.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){u.onparsingerror&&u.onparsingerror(e)}return u.onflush&&u.onflush(),this},E}()},"./src/utils/webvtt-parser.ts":function(U,O,h){"use strict";h.r(O),h.d(O,"generateCueId",function(){return D}),h.d(O,"parseWebVTT",function(){return m});var P=h("./src/polyfills/number.ts"),_=h("./src/utils/vttparser.ts"),L=h("./src/demux/id3.ts"),M=h("./src/utils/timescale-conversion.ts"),R=h("./src/remux/mp4-remuxer.ts"),b=/\r\n|\n\r|\n|\r/g,A=function(u,e,s){return s===void 0&&(s=0),u.slice(s,s+e.length)===e},y=function(u){var e=parseInt(u.slice(-3)),s=parseInt(u.slice(-6,-4)),c=parseInt(u.slice(-9,-7)),g=u.length>9?parseInt(u.substring(0,u.indexOf(":"))):0;if(!Object(P.isFiniteNumber)(e)||!Object(P.isFiniteNumber)(s)||!Object(P.isFiniteNumber)(c)||!Object(P.isFiniteNumber)(g))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+u);return e+=1e3*s,e+=60*1e3*c,e+=60*60*1e3*g,e},x=function(u){for(var e=5381,s=u.length;s;)e=e*33^u.charCodeAt(--s);return(e>>>0).toString()};function D(p,u,e){return x(p.toString())+x(u.toString())+x(e)}var E=function(u,e,s){var c=u[e],g=u[c.prevCC];if(!g||!g.new&&c.new){u.ccOffset=u.presentationOffset=c.start,c.new=!1;return}for(;(i=g)!==null&&i!==void 0&&i.new;){var i;u.ccOffset+=c.start-g.start,c.new=!1,c=g,g=u[c.prevCC]}u.presentationOffset=s};function m(p,u,e,s,c,g,i,r){var o=new _.VTTParser,d=Object(L.utf8ArrayToStr)(new Uint8Array(p)).trim().replace(b,`
`).split(`
`),t=[],n=Object(M.toMpegTsClockFromTimescale)(u,e),l="00:00.000",a=0,f=0,v,S=!0;o.oncue=function(T){var I=s[c],k=s.ccOffset,B=(a-n)/9e4;I!=null&&I.new&&(f!==void 0?k=s.ccOffset=I.start:E(s,c,B)),B&&(k=B-s.presentationOffset);var N=T.endTime-T.startTime,W=Object(R.normalizePts)((T.startTime+k-f)*9e4,g*9e4)/9e4;T.startTime=Math.max(W,0),T.endTime=Math.max(W+N,0);var G=T.text.trim();T.text=decodeURIComponent(encodeURIComponent(G)),T.id||(T.id=D(T.startTime,T.endTime,G)),T.endTime>0&&t.push(T)},o.onparsingerror=function(T){v=T},o.onflush=function(){if(v){r(v);return}i(t)},d.forEach(function(T){if(S)if(A(T,"X-TIMESTAMP-MAP=")){S=!1,T.slice(16).split(",").forEach(function(I){A(I,"LOCAL:")?l=I.slice(6):A(I,"MPEGTS:")&&(a=parseInt(I.slice(7)))});try{f=y(l)/1e3}catch(I){v=I}return}else T===""&&(S=!1);o.parse(T+`
`)}),o.flush()}},"./src/utils/xhr-loader.ts":function(U,O,h){"use strict";h.r(O);var P=h("./src/utils/logger.ts"),_=h("./src/loader/load-stats.ts"),L=/^age:\s*[\d.]+\s*$/m,M=function(){function R(A){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=A?A.xhrSetup:null,this.stats=new _.LoadStats,this.retryDelay=0}var b=R.prototype;return b.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},b.abortInternal=function(){var y=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),y&&(y.onreadystatechange=null,y.onprogress=null,y.readyState!==4&&(this.stats.aborted=!0,y.abort()))},b.abort=function(){var y;this.abortInternal(),(y=this.callbacks)!==null&&y!==void 0&&y.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},b.load=function(y,x,D){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=y,this.config=x,this.callbacks=D,this.retryDelay=x.retryDelay,this.loadInternal()},b.loadInternal=function(){var y=this.config,x=this.context;if(!!y){var D=this.loader=new self.XMLHttpRequest,E=this.stats;E.loading.first=0,E.loaded=0;var m=this.xhrSetup;try{if(m)try{m(D,x.url)}catch{D.open("GET",x.url,!0),m(D,x.url)}D.readyState||D.open("GET",x.url,!0);var p=this.context.headers;if(p)for(var u in p)D.setRequestHeader(u,p[u])}catch(e){this.callbacks.onError({code:D.status,text:e.message},x,D);return}x.rangeEnd&&D.setRequestHeader("Range","bytes="+x.rangeStart+"-"+(x.rangeEnd-1)),D.onreadystatechange=this.readystatechange.bind(this),D.onprogress=this.loadprogress.bind(this),D.responseType=x.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),y.timeout),D.send()}},b.readystatechange=function(){var y=this.context,x=this.loader,D=this.stats;if(!(!y||!x)){var E=x.readyState,m=this.config;if(!D.aborted&&E>=2)if(self.clearTimeout(this.requestTimeout),D.loading.first===0&&(D.loading.first=Math.max(self.performance.now(),D.loading.start)),E===4){x.onreadystatechange=null,x.onprogress=null;var p=x.status;if(p>=200&&p<300){D.loading.end=Math.max(self.performance.now(),D.loading.first);var u,e;if(y.responseType==="arraybuffer"?(u=x.response,e=u.byteLength):(u=x.responseText,e=u.length),D.loaded=D.total=e,!this.callbacks)return;var s=this.callbacks.onProgress;if(s&&s(D,y,u,x),!this.callbacks)return;var c={url:x.responseURL,data:u};this.callbacks.onSuccess(c,D,y,x)}else D.retry>=m.maxRetry||p>=400&&p<499?(P.logger.error(p+" while loading "+y.url),this.callbacks.onError({code:p,text:x.statusText},y,x)):(P.logger.warn(p+" while loading "+y.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,m.maxRetryDelay),D.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),m.timeout)}},b.loadtimeout=function(){P.logger.warn("timeout while loading "+this.context.url);var y=this.callbacks;y&&(this.abortInternal(),y.onTimeout(this.stats,this.context,this.loader))},b.loadprogress=function(y){var x=this.stats;x.loaded=y.loaded,y.lengthComputable&&(x.total=y.total)},b.getCacheAge=function(){var y=null;if(this.loader&&L.test(this.loader.getAllResponseHeaders())){var x=this.loader.getResponseHeader("age");y=x?parseFloat(x):null}return y},R}();O.default=M}}).default})});var Fr={};en(Fr,{AudioEvents:()=>ci,MediaError:()=>Ve,default:()=>wn});var ir=qt(Vr(),1),Lt=qt(tr(),1),Ar=qt(tr(),1),It=qt(tr(),1),Nt=class extends Error{constructor(U,O=Nt.MEDIA_ERR_CUSTOM,h){var P;super(U),this.name="MediaError",this.code=O,this.fatal=h!=null?h:O>=Nt.MEDIA_ERR_NETWORK&&O<=Nt.MEDIA_ERR_ENCRYPTED,this.message||(this.message=(P=Nt.defaultMessages[this.code])!=null?P:"")}},Ve=Nt;Ve.MEDIA_ERR_ABORTED=1,Ve.MEDIA_ERR_NETWORK=2,Ve.MEDIA_ERR_DECODE=3,Ve.MEDIA_ERR_SRC_NOT_SUPPORTED=4,Ve.MEDIA_ERR_ENCRYPTED=5,Ve.MEDIA_ERR_CUSTOM=100,Ve.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail.",3:"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.",4:"An unsupported error occurred. The server or network failed, or your browser does not support this format.",5:"The media is encrypted and there are no keys to decrypt it."};var Jr=(U,O)=>U in O,_r={ANY:"any",MUTED:"muted"},rr={VOD:"on-demand",ON_DEMAND:"on-demand",LIVE:"live",LL_LIVE:"ll-live",DVR:"live:dvr",LL_DVR:"ll-live:dvr"},At={MSE:"mse",NATIVE:"native"},br={HEADER:"header",QUERY:"query",NONE:"none"},kn=Object.values(br),Pt={M3U8:"application/vnd.apple.mpegurl",MP4:"video/mp4"},Or={HLS:Pt.M3U8},Bn=Object.keys(Or),Un=[...Object.values(Pt),"hls","HLS"],Kt=(U,O,h,P)=>{U.addEventListener(O,h,P),U.addEventListener("teardown",()=>{U.removeEventListener(O,h)},{once:!0})};function rn(U,O,h){O&&h>O&&(h=O);for(let P=0;P<U.length;P++)if(U.start(P)<=h&&U.end(P)>=h)return!0;return!1}var nn=U=>{let O=U.indexOf("?");if(O<0)return[U];let h=U.slice(0,O),P=U.slice(O);return[h,P]},Zr=U=>{let O=U.type;if(O){let P=O.toUpperCase();return Jr(P,Or)?Or[P]:O}let{src:h}=U;return h?an(h):""},an=U=>{let O="";try{O=new URL(U).pathname}catch{console.error("invalid url")}let h=O.lastIndexOf(".");if(h<0)return"";let P=O.slice(h+1).toUpperCase();return Jr(P,Pt)?Pt[P]:""},sn=Object.values(_r),Yr=U=>typeof U=="boolean"||typeof U=="string"&&sn.includes(U),on=({autoplay:U},O,h)=>{let P=!1,_=!1,L=Yr(U)?U:!!U,M=()=>{P||Kt(O,"playing",()=>{P=!0},{once:!0})};if(M(),Kt(O,"loadstart",()=>{P=!1,M(),Lr(O,L)},{once:!0}),Kt(O,"loadstart",()=>{h||(_=!Number.isFinite(O.duration)),Lr(O,L)},{once:!0}),h&&h.once(Ar.default.Events.LEVEL_LOADED,(R,b)=>{var A;_=(A=b.details.live)!=null?A:!1}),!L){let R=()=>{!_||(h!=null&&h.liveSyncPosition?O.currentTime=h.liveSyncPosition:Number.isFinite(O.seekable.end(0))&&(O.currentTime=O.seekable.end(0)))};h&&Kt(O,"play",()=>{O.preload==="metadata"?h.once(Ar.default.Events.LEVEL_UPDATED,R):R()},{once:!0})}return R=>{P||(L=Yr(R)?R:!!R,Lr(O,L))}},Lr=(U,O)=>{if(!O)return;let h=U.muted,P=()=>U.muted=h;switch(O){case _r.ANY:U.play().catch(()=>{U.muted=!0,U.play().catch(P)});break;case _r.MUTED:U.muted=!0,U.play().catch(P);break;default:U.play().catch(()=>{});break}},ln=({preload:U,src:O},h,P)=>{let _=x=>{x!=null&&["","none","metadata","auto"].includes(x)?h.setAttribute("preload",x):h.removeAttribute("preload")};if(!P)return _(U),_;let L=!1,M=!1,R=P.config.maxBufferLength,b=P.config.maxBufferSize,A=x=>{_(x);let D=x!=null?x:h.preload;M||D==="none"||(D==="metadata"?(P.config.maxBufferLength=1,P.config.maxBufferSize=1):(P.config.maxBufferLength=R,P.config.maxBufferSize=b),y())},y=()=>{!L&&O&&(L=!0,P.loadSource(O))};return Kt(h,"play",()=>{M=!0,P.config.maxBufferLength=R,P.config.maxBufferSize=b,y()},{once:!0}),A(U),A};function un(U,O){O.on(It.default.Events.NON_NATIVE_TEXT_TRACKS_FOUND,(_,{tracks:L})=>{L.forEach(M=>{var R;let b=(R=M.subtitleTrack)!=null?R:M.closedCaptions,A=O.subtitleTracks.findIndex(({lang:y,name:x,type:D})=>y==(b==null?void 0:b.lang)&&x===M.label&&D.toLowerCase()===M.kind);fn(U,M.kind,M.label,b==null?void 0:b.lang,`${M.kind}${A}`)})});let h=()=>{var _;if(!O.subtitleTracks.length)return;let L=Array.from(U.textTracks).find(R=>R.id&&R.mode==="showing"&&["subtitles","captions"].includes(R.kind)),M=`${(_=O.subtitleTracks[O.subtitleTrack])==null?void 0:_.type.toLowerCase()}${O.subtitleTrack}`;if(L&&(O.subtitleTrack<0||(L==null?void 0:L.id)!==M)){let R=O.subtitleTracks.findIndex(({lang:b,name:A,type:y})=>b==L.language&&A===L.label&&y.toLowerCase()===L.kind);O.subtitleTrack=R}L&&(L==null?void 0:L.id)===M&&L.cues&&Array.from(L.cues).forEach(R=>{L.addCue(R)})};U.textTracks.addEventListener("change",h),O.on(It.default.Events.CUES_PARSED,(_,{track:L,cues:M})=>{let R=U.textTracks.getTrackById(L);if(!R)return;let b=R.mode==="disabled";b&&(R.mode="hidden"),M.forEach(A=>{var y;(y=R.cues)!=null&&y.getCueById(A.id)||R.addCue(A)}),b&&(R.mode="disabled")}),O.once(It.default.Events.DESTROYING,()=>{U.textTracks.removeEventListener("change",h),U.querySelectorAll("track[data-removeondestroy]").forEach(_=>{_.remove()})});let P=()=>{Array.from(U.textTracks).forEach(_=>{var L,M;if(!["subtitles","caption"].includes(_.kind)&&_.label==="thumbnails"){if(!((L=_.cues)!=null&&L.length)){let R=U.querySelector('track[label="thumbnails"]'),b=(M=R==null?void 0:R.getAttribute("src"))!=null?M:"";R==null||R.removeAttribute("src"),setTimeout(()=>{R==null||R.setAttribute("src",b)},0)}_.mode!=="hidden"&&(_.mode="hidden")}})};O.once(It.default.Events.MANIFEST_LOADED,P),O.once(It.default.Events.MEDIA_ATTACHED,P)}function fn(U,O,h,P,_){let L=document.createElement("track");return L.kind=O,L.label=h,P&&(L.srclang=P),_&&(L.id=_),L.track.mode="disabled",L.setAttribute("data-removeondestroy",""),U.append(L),L.track}var zr,Xr,dn=(Xr=(zr=globalThis==null?void 0:globalThis.navigator)==null?void 0:zr.userAgent)!=null?Xr:"",cn=dn.toLowerCase().indexOf("android")!==-1,jt=new WeakMap,qr="mux.com",Qr,$r,ei=($r=(Qr=Lt.default).isSupported)==null?void 0:$r.call(Qr),hn=cn,ti=()=>ir.default.utils.now(),vn=ir.default.utils.generateUUID,ri=(U,{domain:O=qr}={})=>{if(!U)return;let[h,P=""]=nn(U);return`https://stream.${O}/${h}.m3u8${P}`},gn=U=>{if(!U)return;let[O]=U.split("?");return O||void 0},mn=U=>{if(!U||!U.startsWith("https://stream."))return;let[O]=new URL(U).pathname.slice(1).split(".m3u8");return O||void 0},pn=U=>{var O,h,P;return(O=U==null?void 0:U.metadata)!=null&&O.video_id?U.metadata.video_id:ai(U)&&(P=(h=gn(U.playbackId))!=null?h:mn(U.src))!=null?P:U.src};var ii=(U,O,h)=>{Ir(O,h);let{metadata:P={}}=U,{view_session_id:_=vn()}=P,L=pn(U);P.view_session_id=_,P.video_id=L,U.metadata=P,jt.set(O,{});let M=En(U,O);Tn(U,O,M),xn(U,O,M);let R=on(U,O,M),b=ln(U,O,M);return{engine:M,setAutoplay:R,setPreload:b}},Ir=(U,O)=>{let h=O==null?void 0:O.engine;h&&(h.detachMedia(),h.destroy()),(U==null?void 0:U.mux)&&!U.mux.deleted&&(U.mux.destroy(),delete U.mux),U&&(U.removeAttribute("src"),U.load(),U.removeEventListener("error",oi),U.removeEventListener("error",Rr),U.removeEventListener("durationchange",si),jt.delete(U),U.dispatchEvent(new Event("teardown")))};function ni(U,O){var h;let P=Zr(U);if(P!==Pt.M3U8)return!0;let _=!P||((h=O.canPlayType(P))!=null?h:!0),{preferPlayback:L}=U,M=L===At.MSE,R=L===At.NATIVE;return _&&(R||!(ei&&(M||hn)))}var En=(U,O)=>{let{debug:h,streamType:P,startTime:_=-1,metadata:L,preferCmcd:M}=U,R=Zr(U)===Pt.M3U8,b=ni(U,O);if(R&&!b&&ei){let A={backBufferLength:30,renderTextTracksNatively:!1,liveDurationInfinity:!0},y=yn(P),x=M!==br.NONE?{useHeaders:M===br.HEADER,sessionId:L.view_session_id,contentId:L.video_id}:void 0;return new Lt.default({debug:h,startPosition:_,cmcd:x,...A,...y})}},yn=U=>[rr.LIVE,rr.DVR].includes(U)?{backBufferLength:8}:[rr.LL_LIVE,rr.LL_DVR].includes(U)?{backBufferLength:4,maxFragLookUpTolerance:.001}:{},ai=({playbackId:U,src:O,customDomain:h})=>{if(U)return!0;if(typeof O!="string")return!1;let P=window==null?void 0:window.location.href,_=new URL(O,P).hostname.toLocaleLowerCase();return _.includes(qr)||!!h&&_.includes(h.toLocaleLowerCase())},Tn=(U,O,h)=>{var P;let{envKey:_}=U,L=ai(U);if(_||L){let{playerInitTime:M,playerSoftwareName:R,playerSoftwareVersion:b,beaconCollectionDomain:A,debug:y,disableCookies:x}=U,D={...U.metadata,video_title:((P=U==null?void 0:U.metadata)==null?void 0:P.video_title)||void 0},E=m=>typeof m.player_error_code=="string"?!1:typeof U.errorTranslator=="function"?U.errorTranslator(m):m;ir.default.monitor(O,{debug:y,beaconCollectionDomain:A,hlsjs:h,Hls:h?Lt.default:void 0,automaticErrorTracking:!1,errorTranslator:E,disableCookies:x,data:{..._?{env_key:_}:{},player_software_name:R,player_software:R,player_software_version:b,player_init_time:M,...D}})}},xn=(U,O,h)=>{var P;let _=ni(U,O),{src:L}=U;O&&_?(typeof L=="string"?(O.setAttribute("src",L),U.startTime&&(((P=jt.get(O))!=null?P:{}).startTime=U.startTime,O.addEventListener("durationchange",si,{once:!0}))):O.removeAttribute("src"),O.addEventListener("error",oi),O.addEventListener("error",Rr)):h&&L?(h.on(Lt.default.Events.ERROR,(M,R)=>{let b={[Lt.default.ErrorTypes.NETWORK_ERROR]:Ve.MEDIA_ERR_NETWORK,[Lt.default.ErrorTypes.MEDIA_ERROR]:Ve.MEDIA_ERR_DECODE},A=new Ve("",b[R.type]);A.fatal=R.fatal,A.data=R,O.dispatchEvent(new CustomEvent("error",{detail:A}))}),O.addEventListener("error",Rr),un(O,h),h.attachMedia(O)):console.error("It looks like the video you're trying to play will not work on this system! If possible, try upgrading to the newest versions of your browser or software.")};function si(U){var O;let h=U.target,P=(O=jt.get(h))==null?void 0:O.startTime;if(!!P&&rn(h.seekable,h.duration,P)){let _=h.preload==="auto";_&&(h.preload="none"),h.currentTime=P,_&&(h.preload="auto")}}async function oi(U){if(!U.isTrusted)return;U.stopImmediatePropagation();let O=U.target;if(!(O!=null&&O.error))return;let{message:h,code:P}=O.error,_=new Ve(h,P);if(O.src&&(P!==Ve.MEDIA_ERR_DECODE||P!==void 0))try{let{status:L}=await fetch(O.src);_.data={response:{code:L}}}catch{}O.dispatchEvent(new CustomEvent("error",{detail:_}))}function Rr(U){var O,h;if(!(U instanceof CustomEvent)||!(U.detail instanceof Ve))return;let P=U.target,_=U.detail;!_||!_.fatal||(((O=jt.get(P))!=null?O:{}).error=_,(h=P.mux)==null||h.emit("error",{player_error_code:_.code,player_error_message:_.message}))}var Mr=(U,O,h)=>{if(!O.has(U))throw TypeError("Cannot "+h)},ot=(U,O,h)=>(Mr(U,O,"read from private field"),h?h.call(U):O.get(U)),mt=(U,O,h)=>{if(O.has(U))throw TypeError("Cannot add the same private member more than once");O instanceof WeakSet?O.add(U):O.set(U,h)},pt=(U,O,h,P)=>(Mr(U,O,"write to private field"),P?P.call(U,h):O.set(U,h),h),Vt=(U,O,h)=>(Mr(U,O,"access private method"),h),ur=class{addEventListener(){}removeEventListener(){}dispatchEvent(U){return!0}};if(typeof DocumentFragment=="undefined"){class U extends ur{}globalThis.DocumentFragment=U}var wr=class extends ur{},Sn=class extends ur{},Dn={get(U){},define(U,O,h){},upgrade(U){},whenDefined(U){return Promise.resolve(wr)}},nr,Ln=class{constructor(U,O={}){mt(this,nr,void 0),pt(this,nr,O==null?void 0:O.detail)}get detail(){return ot(this,nr)}initCustomEvent(){}};nr=new WeakMap;function An(U,O){return new wr}var ui={document:{createElement:An},DocumentFragment,customElements:Dn,CustomEvent:Ln,EventTarget:ur,HTMLElement:wr,HTMLVideoElement:Sn},fi=typeof window=="undefined"||typeof globalThis.customElements=="undefined",Et=fi?ui:globalThis,di=fi?ui.document:globalThis.document,_n=()=>{try{return"0.9.0"}catch{}return"UNKNOWN"},bn=_n(),On=()=>bn,ci=["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],hi=di.createElement("template");hi.innerHTML=`
<style>
  :host {
    /* display:inline (like the native el) makes it so you can't fill
      the container with the native el */
    display: inline-block;
    box-sizing: border-box;

    width: auto;
    height: auto;
  }

  audio {
    max-width: 100%;
    max-height: 100%;
    min-width: 100%;
    min-height: 100%;
  }

</style>

<audio part="audio" crossorigin></audio>
<slot></slot>
`;var ar,Wt,sr,Yt=class extends Et.HTMLElement{constructor(){super(),mt(this,Wt),mt(this,ar,void 0),this.attachShadow({mode:"open"}),this.isConnected&&Vt(this,Wt,sr).call(this)}static get observedAttributes(){let U=[];Object.getOwnPropertyNames(this.prototype).forEach(h=>{let P=!1;try{typeof this.prototype[h]=="function"&&(P=!0)}catch{}!P&&h!==h.toUpperCase()&&U.push(h.toLowerCase())});let O=Object.getPrototypeOf(this).observedAttributes;return O&&(U=U.concat(O)),U}attributeChangedCallback(U,O,h){Vt(this,Wt,sr).call(this),this.forwardAttribute(U,O,h)}forwardAttribute(U,O,h){let P=Object.getOwnPropertyNames(Object.getPrototypeOf(this)),_=In(P,U),L=Object.getPrototypeOf(this.constructor).toString().indexOf("function HTMLElement")===0;_&&!L?typeof this[_]=="boolean"?h===null?this[_]=!1:this[_]=!0:this[_]=h:h===null?this.nativeEl.removeAttribute(U):["id","class"].indexOf(U)===-1&&this.nativeEl.setAttribute(U,h)}connectedCallback(){Vt(this,Wt,sr).call(this)}};ar=new WeakMap,Wt=new WeakSet,sr=function(){if(ot(this,ar))return;pt(this,ar,!0),this.shadowRoot.append(hi.content.cloneNode(!0));let U=this.nativeEl=this.shadowRoot.querySelector("audio");ci.forEach(h=>{U.addEventListener(h,P=>{this.dispatchEvent(new CustomEvent(P.type,{detail:P.detail}))})});let O=this.shadowRoot.querySelector("slot");O.addEventListener("slotchange",()=>{O.assignedElements().forEach(h=>{!["track","source"].includes(h.localName)||U.append(h)})}),Array.from(this.attributes).forEach(h=>{this.forwardAttribute(h.name,null,h.value)}),U.defaultMuted&&(U.muted=!0)};var vi=[],gi=di.createElement("audio"),Rn=["webkitDisplayingFullscreen","webkitSupportsFullscreen"];for(let U=Object.getPrototypeOf(gi);U&&U!==Et.HTMLElement.prototype;U=Object.getPrototypeOf(U))Object.keys(U).forEach(O=>{Rn.indexOf(O)===-1&&vi.push(O)});vi.forEach(U=>{if(typeof gi[U]=="function")Yt.prototype[U]=function(){return this.nativeEl[U].apply(this.nativeEl,arguments)};else{let O={get(){return this.nativeEl[U]}};U!==U.toUpperCase()&&(O.set=function(h){this.nativeEl[U]=h}),Object.defineProperty(Yt.prototype,U,O)}});function In(U,O){let h=null;return U.forEach(P=>{P.toLowerCase()==O.toLowerCase()&&(h=P)}),h}Et.customElements.get("custom-audio")||(Et.customElements.define("custom-audio",Yt),Et.CustomAudioElement=Yt);var li=Yt,xe={ENV_KEY:"env-key",DEBUG:"debug",PLAYBACK_ID:"playback-id",METADATA_URL:"metadata-url",PREFER_PLAYBACK:"prefer-playback",BEACON_COLLECTION_DOMAIN:"beacon-collection-domain",DISABLE_COOKIES:"disable-cookies",TYPE:"type",STREAM_TYPE:"stream-type",START_TIME:"start-time"},Pn=Object.values(xe),Cn=On(),Mn="mux-audio",vt,Gt,or,Ht,lr,Pr,Cr=class extends li{constructor(){super(),mt(this,lr),mt(this,vt,void 0),mt(this,Gt,void 0),mt(this,or,void 0),mt(this,Ht,{}),pt(this,or,ti())}static get observedAttributes(){var U;return[...Pn,...(U=li.observedAttributes)!=null?U:[]]}get playerInitTime(){return ot(this,or)}get playerSoftwareName(){return Mn}get playerSoftwareVersion(){return Cn}get _hls(){var U;return(U=ot(this,vt))==null?void 0:U.engine}get mux(){return this.nativeEl.mux}get src(){return this.getAttribute("src")}set src(U){U!==this.src&&(U==null?this.removeAttribute("src"):this.setAttribute("src",U))}get preload(){let U=this.getAttribute("preload");return U===""?"auto":["none","metadata","auto"].includes(U)?U:super.preload}set preload(U){U!=this.getAttribute("preload")&&(["","none","metadata","auto"].includes(U)?this.setAttribute("preload",U):this.removeAttribute("preload"))}get debug(){return this.getAttribute(xe.DEBUG)!=null}set debug(U){U!==this.debug&&(U?this.setAttribute(xe.DEBUG,""):this.removeAttribute(xe.DEBUG))}get disableCookies(){return this.hasAttribute(xe.DISABLE_COOKIES)}set disableCookies(U){U!==this.disableCookies&&(U?this.setAttribute(xe.DISABLE_COOKIES,""):this.removeAttribute(xe.DISABLE_COOKIES))}get startTime(){let U=this.getAttribute(xe.START_TIME);if(U==null)return;let O=+U;return Number.isNaN(O)?void 0:O}set startTime(U){U!==this.startTime&&(U==null?this.removeAttribute(xe.START_TIME):this.setAttribute(xe.START_TIME,`${U}`))}get playbackId(){var U;return(U=this.getAttribute(xe.PLAYBACK_ID))!=null?U:void 0}set playbackId(U){U!==this.playbackId&&(U?this.setAttribute(xe.PLAYBACK_ID,U):this.removeAttribute(xe.PLAYBACK_ID))}get envKey(){var U;return(U=this.getAttribute(xe.ENV_KEY))!=null?U:void 0}set envKey(U){U!==this.envKey&&(U?this.setAttribute(xe.ENV_KEY,U):this.removeAttribute(xe.ENV_KEY))}get beaconCollectionDomain(){var U;return(U=this.getAttribute(xe.BEACON_COLLECTION_DOMAIN))!=null?U:void 0}set beaconCollectionDomain(U){U!==this.beaconCollectionDomain&&(U?this.setAttribute(xe.BEACON_COLLECTION_DOMAIN,U):this.removeAttribute(xe.BEACON_COLLECTION_DOMAIN))}get streamType(){var U;return(U=this.getAttribute(xe.STREAM_TYPE))!=null?U:void 0}set streamType(U){U!==this.streamType&&(U?this.setAttribute(xe.STREAM_TYPE,U):this.removeAttribute(xe.STREAM_TYPE))}get preferPlayback(){let U=this.getAttribute(xe.PREFER_PLAYBACK);if(U===At.MSE||U===At.NATIVE)return U}set preferPlayback(U){U!==this.preferPlayback&&(U===At.MSE||U===At.NATIVE?this.setAttribute(xe.PREFER_PLAYBACK,U):this.removeAttribute(xe.PREFER_PLAYBACK))}get metadata(){return{...this.getAttributeNames().filter(U=>U.startsWith("metadata-")&&![xe.METADATA_URL].includes(U)).reduce((U,O)=>{let h=this.getAttribute(O);return h!=null&&(U[O.replace(/^metadata-/,"").replace(/-/g,"_")]=h),U},{}),...ot(this,Ht)}}set metadata(U){pt(this,Ht,U!=null?U:{}),this.mux&&(console.info("Some metadata values may not be overridable at this time. Make sure you set all metadata to override before setting the src."),this.mux.emit("hb",ot(this,Ht)))}load(){pt(this,vt,ii(this,this.nativeEl,ot(this,vt)))}unload(){Ir(this.nativeEl,ot(this,vt)),pt(this,vt,void 0)}attributeChangedCallback(U,O,h){var P,_;switch(super.attributeChangedCallback(U,O,h),U){case"src":{let L=!!O,M=!!h;!L&&M?Vt(this,lr,Pr).call(this):L&&!M?this.unload():L&&M&&(this.unload(),Vt(this,lr,Pr).call(this));break}case"autoplay":if(h===O)break;(P=ot(this,vt))==null||P.setAutoplay(this.autoplay);break;case"preload":if(h===O)break;(_=ot(this,vt))==null||_.setPreload(h);break;case xe.PLAYBACK_ID:this.src=ri(h!=null?h:void 0);break;case xe.DEBUG:{let L=this.debug;this.mux&&console.info("Cannot toggle debug mode of mux data after initialization. Make sure you set all metadata to override before setting the src."),this._hls&&(this._hls.config.debug=L);break}case xe.METADATA_URL:h&&fetch(h).then(L=>L.json()).then(L=>this.metadata=L).catch(L=>console.error(`Unable to load or parse metadata JSON from metadata-url ${h}!`));break;default:break}}disconnectedCallback(){this.unload()}};vt=new WeakMap,Gt=new WeakMap,or=new WeakMap,Ht=new WeakMap,lr=new WeakSet,Pr=async function(){ot(this,Gt)||(await pt(this,Gt,Promise.resolve()),pt(this,Gt,null),this.load())};Et.customElements.get("mux-audio")||(Et.customElements.define("mux-audio",Cr),Et.MuxAudioElement=Cr);var wn=Cr;export{Fr as MuxAudio};
/*!
 * JavaScript Cookie v2.1.3
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */
/*!
 * mux-embed
 * @version 4.14.0
 * @copyright 2022 Mux, Inc
 */
